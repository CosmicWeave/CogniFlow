import{N as oe,d as de,u as ce,r as d,w as V,G as me,e as W,j as e,B as o,I as l,L as xe}from"./index-aMUeowKE.js";import{D as ue}from"./DeckListItem-CkWM-3h7.js";import{T as he}from"./TruncatedText-D7rtMuLw.js";import"./MasteryBar-Dwb4azIA.js";const F=({icon:c,label:s,value:y,subtext:u,color:g="primary"})=>e.jsxs("div",{className:"bg-surface p-4 rounded-lg shadow-sm border border-border flex items-center gap-4",children:[e.jsx("div",{className:`p-3 rounded-full bg-${g}/10 text-${g}`,children:e.jsx(l,{name:c,className:"w-6 h-6"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-text-muted",children:s}),e.jsx("p",{className:"text-2xl font-bold text-text",children:y}),u&&e.jsx("p",{className:"text-xs text-text-muted mt-0.5",children:u})]})]}),be=c=>{var J;const{series:s,sessionsToResume:y,onUpdateLastOpened:u,onUpdateDeck:g,onDeleteDeck:X,openConfirmModal:$,handleGenerateQuestionsForDeck:Y,handleGenerateContentForLearningDeck:Z,onUpdateSeries:h}=c,p=oe(),{seriesProgress:U,aiGenerationStatus:_}=de(),{aiFeaturesEnabled:D}=ce(),[b,C]=d.useState(!1),[S,L]=d.useState(s.name),[O,I]=d.useState(s.description),[j,x]=d.useState(!1),E=d.useRef(null),[T,N]=d.useState(null),[z,Q]=d.useState(""),k=d.useRef(null);d.useEffect(()=>{u(s.id)},[s.id,u]),d.useEffect(()=>{b||(L(s.name),I(s.description))},[s,b]),d.useEffect(()=>{T!==null&&k.current&&(k.current.focus(),k.current.select())},[T]),d.useEffect(()=>{const r=t=>{E.current&&!E.current.contains(t.target)&&x(!1)};return j&&document.addEventListener("mousedown",r),()=>document.removeEventListener("mousedown",r)},[j]);const ee=()=>{S.trim()&&(h({...s,name:S,description:O},{toastMessage:"Series updated."}),C(!1))},se=()=>{L(s.name),I(s.description),C(!1)},M=(r,t)=>{N(r),Q(t)},P=r=>{if(z.trim()){const t=[...s.levels||[]];t[r]={...t[r],title:z.trim()},h({...s,levels:t},{toastMessage:"Level renamed."})}N(null)},te=()=>{const r={title:`Level ${(s.levels||[]).length+1}: New Level`,deckIds:[]},t=[...s.levels||[],r];h({...s,levels:t},{toastMessage:"New level added."}),setTimeout(()=>{M(t.length-1,r.title),window.scrollTo({top:document.body.scrollHeight,behavior:"smooth"})},100)},re=r=>{const t=s.levels[r],a=t.deckIds&&t.deckIds.length>0,n=()=>{const m=[...s.levels];m.splice(r,1),h({...s,levels:m},{toastMessage:"Level deleted."})};a?$({title:"Delete Level",message:`Are you sure you want to delete "${t.title}"? The ${t.deckIds.length} deck(s) inside will remain in your library but will be removed from this series.`,onConfirm:n}):n()},B=(r,t)=>{if(t==="up"&&r===0||t==="down"&&r===s.levels.length-1)return;const a=[...s.levels],n=t==="up"?r-1:r+1;[a[r],a[n]]=[a[n],a[r]],h({...s,levels:a})},q=(r,t)=>{const a=[...s.levels],n=a[r];a[r]={...n,deckIds:n.deckIds.filter(m=>m!==t)},h({...s,levels:a},{toastMessage:"Deck removed from series."})},{dueCount:A,nextUpDeckId:v,isCompleted:w,completedCount:R,totalCount:G}=V.useMemo(()=>{const r=(s.levels||[]).flatMap(i=>(i==null?void 0:i.deckIds)||[]).map(i=>p.find(f=>f.id===i)).filter(i=>!!i),t=U.get(s.id)||new Set,a=t.size,n=(s.levels||[]).flatMap(i=>(i==null?void 0:i.deckIds)||[]),m=n.length,K=new Set;n.forEach((i,f)=>{f<=a&&K.add(i)});const le=r.reduce((i,f)=>K.has(f.id)?i+me(f):i,0),ne=n.find(i=>!t.has(i))||null,ie=m>0&&a>=m;return{dueCount:le,nextUpDeckId:ne,isCompleted:ie,completedCount:a,totalCount:m}},[s,p,U]),ae=V.useMemo(()=>{const r=new Set((s.levels||[]).flatMap(a=>(a==null?void 0:a.deckIds)||[]));return p.filter(a=>r.has(a.id)).some(a=>{var n;return(a.type===W.Quiz||a.type===W.Learning)&&(((n=a.questions)==null?void 0:n.length)||0)===0})},[s.levels,p]),H=((J=_.currentTask)==null?void 0:J.seriesId)===s.id;return e.jsxs("div",{className:"max-w-5xl mx-auto animate-fade-in space-y-6 pb-20",children:[e.jsx("div",{className:`bg-surface rounded-xl shadow-sm border border-border ${b?"overflow-hidden":""}`,children:b?e.jsxs("div",{className:"p-6 space-y-4 animate-fade-in bg-background/50",children:[e.jsx("h2",{className:"text-xl font-bold text-text mb-4",children:"Edit Series Details"}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"series-name-edit",className:"block text-sm font-medium text-text-muted mb-1",children:"Series Name"}),e.jsx("input",{id:"series-name-edit",type:"text",value:S,onChange:r=>L(r.target.value),className:"w-full p-2 bg-background border border-border rounded-md focus:ring-2 focus:ring-primary focus:outline-none text-xl font-bold",autoFocus:!0})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"series-desc-edit",className:"block text-sm font-medium text-text-muted mb-1",children:"Description"}),e.jsx("textarea",{id:"series-desc-edit",value:O,onChange:r=>I(r.target.value),rows:3,className:"w-full p-2 bg-background border border-border rounded-md focus:ring-2 focus:ring-primary focus:outline-none"})]}),e.jsxs("div",{className:"flex justify-end gap-2 pt-2 border-t border-border mt-4",children:[e.jsx(o,{variant:"secondary",onClick:se,children:"Cancel"}),e.jsxs(o,{onClick:ee,children:[e.jsx(l,{name:"save",className:"mr-2"})," Save Changes"]})]})]}):e.jsxs("div",{className:"p-6 md:p-8 flex flex-col md:flex-row items-start justify-between gap-4",children:[e.jsx("div",{className:"flex-1 min-w-0",children:e.jsxs("div",{className:"flex items-start gap-4",children:[e.jsx("div",{className:"p-3 bg-primary/10 rounded-xl flex-shrink-0",children:e.jsx(l,{name:"layers",className:"w-8 h-8 text-primary"})}),e.jsxs("div",{className:"min-w-0 flex-1",children:[e.jsx("div",{className:"flex items-center text-xs font-semibold text-text-muted mb-1 uppercase tracking-wider",children:e.jsx("span",{children:"Learning Series"})}),e.jsx("h1",{className:"text-3xl font-extrabold text-text break-words leading-tight",children:s.name}),s.description&&e.jsx("div",{className:"mt-2 text-text-muted",children:e.jsx(he,{html:s.description,className:"prose prose-sm dark:prose-invert max-w-none text-text-muted leading-relaxed"})})]})]})}),e.jsxs("div",{className:"relative flex-shrink-0 self-start mt-2 md:mt-0",ref:E,children:[e.jsx(o,{variant:"ghost",onClick:()=>x(!j),className:"p-2 rounded-full hover:bg-border/50",children:e.jsx(l,{name:"more-vertical",className:"w-6 h-6 text-text-muted"})}),j&&e.jsxs("div",{className:"absolute right-0 mt-2 w-64 bg-surface rounded-lg shadow-xl border border-border z-20 py-1 animate-fade-in origin-top-right",children:[e.jsxs("button",{onClick:()=>{C(!0),x(!1)},className:"flex items-center w-full px-4 py-2.5 text-sm text-left text-text hover:bg-primary/5 hover:text-primary transition-colors",children:[e.jsx(l,{name:"edit",className:"w-4 h-4 mr-3"})," Edit Details"]}),D&&e.jsxs(e.Fragment,{children:[e.jsxs("button",{onClick:()=>{c.onAutoExpandSeries(s.id),x(!1)},className:"flex items-center w-full px-4 py-2.5 text-sm text-left text-text hover:bg-primary/5 hover:text-primary transition-colors",children:[e.jsx(l,{name:"layers",className:"w-4 h-4 mr-3"})," Auto-Expand Series"]}),e.jsxs("button",{onClick:()=>{c.onAiAddLevelsToSeries(s.id),x(!1)},className:"flex items-center w-full px-4 py-2.5 text-sm text-left text-text hover:bg-primary/5 hover:text-primary transition-colors",children:[e.jsx(l,{name:"plus",className:"w-4 h-4 mr-3"})," Generate Next Level"]})]}),D&&ae&&e.jsxs("button",{onClick:()=>{c.handleGenerateQuestionsForEmptyDecksInSeries(s.id),x(!1)},disabled:H,className:"flex items-center w-full px-4 py-2.5 text-sm text-left text-text hover:bg-primary/5 hover:text-primary transition-colors disabled:opacity-50",children:[e.jsx(l,{name:"zap",className:"w-4 h-4 mr-3"})," ",H?"Generating...":"Generate All Questions"]}),e.jsxs("button",{onClick:()=>{c.onExportSeries(s),x(!1)},className:"flex items-center w-full px-4 py-2.5 text-sm text-left text-text hover:bg-primary/5 hover:text-primary transition-colors",children:[e.jsx(l,{name:"download",className:"w-4 h-4 mr-3"})," Export JSON"]}),e.jsx("div",{className:"my-1 border-t border-border"}),e.jsxs("button",{onClick:()=>{c.onDeleteSeries(s.id),x(!1)},className:"flex items-center w-full px-4 py-2.5 text-sm text-left text-red-600 dark:text-red-400 hover:bg-red-50 dark:hover:bg-red-900/20 transition-colors",children:[e.jsx(l,{name:"trash-2",className:"w-4 h-4 mr-3"})," Move to Trash"]})]})]})]})}),e.jsxs("div",{className:"flex flex-col md:flex-row gap-4 items-center justify-between p-6 bg-primary/5 rounded-xl border border-primary/10",children:[e.jsxs("div",{className:"flex-1 text-center md:text-left",children:[e.jsx("h3",{className:"text-lg font-bold text-text mb-1",children:w?"Series Completed!":v?"Ready to continue learning?":"Start this series."}),e.jsx("p",{className:"text-sm text-text-muted",children:w?"Great job! Review due items to maintain mastery.":v?"Pick up where you left off.":"Begin the first level."})]}),e.jsxs("div",{className:"flex flex-wrap gap-3 justify-center md:justify-end",children:[!w&&v&&e.jsxs(xe,{href:`/decks/${v}/study?seriesId=${s.id}`,passAs:o,variant:"primary",size:"lg",className:"font-bold px-8 shadow-md",children:[e.jsx(l,{name:"zap",className:"w-5 h-5 mr-2"}),R>0?"Continue":"Start Series"]}),A>0&&e.jsxs(o,{variant:!w&&v?"secondary":"primary",size:"lg",onClick:()=>c.onStartSeriesStudy(s.id),className:"font-bold",children:[e.jsx(l,{name:"refresh-ccw",className:"w-5 h-5 mr-2"}),"Study Due (",A,")"]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-3 gap-4",children:[e.jsx(F,{icon:"layers",label:"Total Decks",value:G,color:"blue"}),e.jsx(F,{icon:"check-circle",label:"Progress",value:`${R} / ${G}`,subtext:`${Math.round(R/(G||1)*100)}% Complete`,color:"green"}),e.jsx(F,{icon:"zap",label:"Due Today",value:A,color:"orange"})]}),e.jsx("div",{className:"space-y-8 mt-8",children:(s.levels||[]).map((r,t)=>e.jsxs("div",{className:"bg-surface rounded-xl p-4 border border-border shadow-sm",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row justify-between items-start sm:items-center mb-4 border-b border-border pb-2 gap-2",children:[T===t?e.jsxs("div",{className:"flex-grow flex items-center gap-2 w-full sm:w-auto",children:[e.jsx("input",{ref:k,type:"text",value:z,onChange:a=>Q(a.target.value),onKeyDown:a=>{a.key==="Enter"&&P(t),a.key==="Escape"&&N(null)},className:"flex-grow p-1 bg-background border border-border rounded focus:ring-2 focus:ring-primary focus:outline-none font-semibold text-lg"}),e.jsx(o,{size:"sm",variant:"primary",onClick:()=>P(t),children:e.jsx(l,{name:"check-circle",className:"w-4 h-4"})}),e.jsx(o,{size:"sm",variant:"ghost",onClick:()=>N(null),children:e.jsx(l,{name:"x",className:"w-4 h-4"})})]}):e.jsx("h3",{className:"text-xl font-bold text-text flex-grow cursor-pointer hover:text-primary transition-colors",onClick:()=>M(t,r.title),children:r.title}),e.jsxs("div",{className:"flex items-center gap-1 self-end sm:self-auto",children:[e.jsx(o,{variant:"ghost",size:"sm",className:"p-1 h-auto text-text-muted hover:text-text",onClick:()=>B(t,"up"),disabled:t===0,title:"Move Up",children:e.jsx(l,{name:"chevron-down",className:"w-4 h-4 rotate-180"})}),e.jsx(o,{variant:"ghost",size:"sm",className:"p-1 h-auto text-text-muted hover:text-text",onClick:()=>B(t,"down"),disabled:t===(s.levels||[]).length-1,title:"Move Down",children:e.jsx(l,{name:"chevron-down",className:"w-4 h-4"})}),e.jsx(o,{variant:"ghost",size:"sm",className:"p-1 h-auto text-text-muted hover:text-text",onClick:()=>M(t,r.title),title:"Rename Level",children:e.jsx(l,{name:"edit",className:"w-4 h-4"})}),e.jsx(o,{variant:"ghost",size:"sm",className:"p-1 h-auto text-text-muted hover:text-red-500",onClick:()=>re(t),title:"Delete Level",children:e.jsx(l,{name:"trash-2",className:"w-4 h-4"})}),D&&e.jsxs("div",{className:"flex gap-1 ml-2 border-l border-border pl-2",children:[e.jsx(o,{variant:"ghost",size:"sm",onClick:()=>c.onAiAddDecksToLevel(s.id,t),title:"AI: Add Empty Decks",children:e.jsx(l,{name:"plus",className:"w-4 h-4"})}),e.jsx(o,{variant:"ghost",size:"sm",onClick:()=>c.onGenerateDeckForLevel(s.id,t),title:"AI: Generate Deck",children:e.jsx(l,{name:"zap",className:"w-4 h-4"})})]})]})]}),e.jsxs("div",{className:"space-y-4",children:[r.deckIds.map(a=>{const n=p.find(m=>m.id===a);return n?e.jsx(ue,{deck:n,sessionsToResume:y,onUpdateLastOpened:()=>u(s.id),draggedDeckId:null,onDragStart:()=>{},onDragEnd:()=>{},onUpdateDeck:g,onDeleteDeck:X,openConfirmModal:$,handleGenerateQuestionsForDeck:Y,handleGenerateContentForLearningDeck:Z,onRemoveFromSeries:()=>q(t,n.id)},n.id):e.jsxs("div",{className:"p-4 bg-red-100 text-red-800 rounded-md flex justify-between items-center",children:[e.jsxs("span",{children:['Deck with ID "',a,'" not found.']}),e.jsx(o,{size:"sm",variant:"ghost",className:"text-red-800 hover:bg-red-200",onClick:()=>q(t,a),children:"Remove"})]},a)}),(r.deckIds||[]).length===0&&e.jsxs("div",{className:"text-center p-8 border-2 border-dashed border-border rounded-lg text-text-muted text-sm",children:[e.jsx(l,{name:"folder",className:"w-8 h-8 mx-auto mb-2 opacity-50"}),"No decks in this level yet."]})]})]},t))}),e.jsx("div",{className:"flex justify-center pt-8 border-t border-border",children:e.jsxs(o,{onClick:te,variant:"secondary",className:"w-full sm:w-auto",children:[e.jsx(l,{name:"plus",className:"w-5 h-5 mr-2"}),"Add New Level"]})})]})};export{be as default};
