(function(){const g=document.createElement("link").relList;if(g&&g.supports&&g.supports("modulepreload"))return;for(const f of document.querySelectorAll('link[rel="modulepreload"]'))u(f);new MutationObserver(f=>{for(const i of f)if(i.type==="childList")for(const o of i.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&u(o)}).observe(document,{childList:!0,subtree:!0});function l(f){const i={};return f.integrity&&(i.integrity=f.integrity),f.referrerPolicy&&(i.referrerPolicy=f.referrerPolicy),f.crossOrigin==="use-credentials"?i.credentials="include":f.crossOrigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function u(f){if(f.ep)return;f.ep=!0;const i=l(f);fetch(f.href,i)}})();var Oo=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function gl(r){return r&&r.__esModule&&Object.prototype.hasOwnProperty.call(r,"default")?r.default:r}function Py(r){if(Object.prototype.hasOwnProperty.call(r,"__esModule"))return r;var g=r.default;if(typeof g=="function"){var l=function u(){return this instanceof u?Reflect.construct(g,arguments,this.constructor):g.apply(this,arguments)};l.prototype=g.prototype}else l={};return Object.defineProperty(l,"__esModule",{value:!0}),Object.keys(r).forEach(function(u){var f=Object.getOwnPropertyDescriptor(r,u);Object.defineProperty(l,u,f.get?f:{enumerable:!0,get:function(){return r[u]}})}),l}var rd={exports:{}},ll={};/**
 * @license React
 * react-jsx-runtime.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var ap;function Jy(){if(ap)return ll;ap=1;var r=Symbol.for("react.transitional.element"),g=Symbol.for("react.fragment");function l(u,f,i){var o=null;if(i!==void 0&&(o=""+i),f.key!==void 0&&(o=""+f.key),"key"in f){i={};for(var m in f)m!=="key"&&(i[m]=f[m])}else i=f;return f=i.ref,{$$typeof:r,type:u,key:o,ref:f!==void 0?f:null,props:i}}return ll.Fragment=g,ll.jsx=l,ll.jsxs=l,ll}var rp;function Vy(){return rp||(rp=1,rd.exports=Jy()),rd.exports}var n=Vy(),sd={exports:{}},ot={};/**
 * @license React
 * react.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var sp;function Ky(){if(sp)return ot;sp=1;var r=Symbol.for("react.transitional.element"),g=Symbol.for("react.portal"),l=Symbol.for("react.fragment"),u=Symbol.for("react.strict_mode"),f=Symbol.for("react.profiler"),i=Symbol.for("react.consumer"),o=Symbol.for("react.context"),m=Symbol.for("react.forward_ref"),x=Symbol.for("react.suspense"),d=Symbol.for("react.memo"),j=Symbol.for("react.lazy"),y=Symbol.for("react.activity"),_=Symbol.iterator;function b(E){return E===null||typeof E!="object"?null:(E=_&&E[_]||E["@@iterator"],typeof E=="function"?E:null)}var D={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},w=Object.assign,N={};function S(E,L,se){this.props=E,this.context=L,this.refs=N,this.updater=se||D}S.prototype.isReactComponent={},S.prototype.setState=function(E,L){if(typeof E!="object"&&typeof E!="function"&&E!=null)throw Error("takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,E,L,"setState")},S.prototype.forceUpdate=function(E){this.updater.enqueueForceUpdate(this,E,"forceUpdate")};function O(){}O.prototype=S.prototype;function C(E,L,se){this.props=E,this.context=L,this.refs=N,this.updater=se||D}var M=C.prototype=new O;M.constructor=C,w(M,S.prototype),M.isPureReactComponent=!0;var R=Array.isArray;function $(){}var X={H:null,A:null,T:null,S:null},J=Object.prototype.hasOwnProperty;function Y(E,L,se){var ie=se.ref;return{$$typeof:r,type:E,key:L,ref:ie!==void 0?ie:null,props:se}}function H(E,L){return Y(E.type,L,E.props)}function K(E){return typeof E=="object"&&E!==null&&E.$$typeof===r}function q(E){var L={"=":"=0",":":"=2"};return"$"+E.replace(/[=:]/g,function(se){return L[se]})}var W=/\/+/g;function A(E,L){return typeof E=="object"&&E!==null&&E.key!=null?q(""+E.key):L.toString(36)}function B(E){switch(E.status){case"fulfilled":return E.value;case"rejected":throw E.reason;default:switch(typeof E.status=="string"?E.then($,$):(E.status="pending",E.then(function(L){E.status==="pending"&&(E.status="fulfilled",E.value=L)},function(L){E.status==="pending"&&(E.status="rejected",E.reason=L)})),E.status){case"fulfilled":return E.value;case"rejected":throw E.reason}}throw E}function z(E,L,se,ie,oe){var Ne=typeof E;(Ne==="undefined"||Ne==="boolean")&&(E=null);var we=!1;if(E===null)we=!0;else switch(Ne){case"bigint":case"string":case"number":we=!0;break;case"object":switch(E.$$typeof){case r:case g:we=!0;break;case j:return we=E._init,z(we(E._payload),L,se,ie,oe)}}if(we)return oe=oe(E),we=ie===""?"."+A(E,0):ie,R(oe)?(se="",we!=null&&(se=we.replace(W,"$&/")+"/"),z(oe,L,se,"",function(Me){return Me})):oe!=null&&(K(oe)&&(oe=H(oe,se+(oe.key==null||E&&E.key===oe.key?"":(""+oe.key).replace(W,"$&/")+"/")+we)),L.push(oe)),1;we=0;var je=ie===""?".":ie+":";if(R(E))for(var ve=0;ve<E.length;ve++)ie=E[ve],Ne=je+A(ie,ve),we+=z(ie,L,se,Ne,oe);else if(ve=b(E),typeof ve=="function")for(E=ve.call(E),ve=0;!(ie=E.next()).done;)ie=ie.value,Ne=je+A(ie,ve++),we+=z(ie,L,se,Ne,oe);else if(Ne==="object"){if(typeof E.then=="function")return z(B(E),L,se,ie,oe);throw L=String(E),Error("Objects are not valid as a React child (found: "+(L==="[object Object]"?"object with keys {"+Object.keys(E).join(", ")+"}":L)+"). If you meant to render a collection of children, use an array instead.")}return we}function Q(E,L,se){if(E==null)return E;var ie=[],oe=0;return z(E,ie,"","",function(Ne){return L.call(se,Ne,oe++)}),ie}function ue(E){if(E._status===-1){var L=E._result;L=L(),L.then(function(se){(E._status===0||E._status===-1)&&(E._status=1,E._result=se)},function(se){(E._status===0||E._status===-1)&&(E._status=2,E._result=se)}),E._status===-1&&(E._status=0,E._result=L)}if(E._status===1)return E._result.default;throw E._result}var ee=typeof reportError=="function"?reportError:function(E){if(typeof window=="object"&&typeof window.ErrorEvent=="function"){var L=new window.ErrorEvent("error",{bubbles:!0,cancelable:!0,message:typeof E=="object"&&E!==null&&typeof E.message=="string"?String(E.message):String(E),error:E});if(!window.dispatchEvent(L))return}else if(typeof process=="object"&&typeof process.emit=="function"){process.emit("uncaughtException",E);return}console.error(E)},V={map:Q,forEach:function(E,L,se){Q(E,function(){L.apply(this,arguments)},se)},count:function(E){var L=0;return Q(E,function(){L++}),L},toArray:function(E){return Q(E,function(L){return L})||[]},only:function(E){if(!K(E))throw Error("React.Children.only expected to receive a single React element child.");return E}};return ot.Activity=y,ot.Children=V,ot.Component=S,ot.Fragment=l,ot.Profiler=f,ot.PureComponent=C,ot.StrictMode=u,ot.Suspense=x,ot.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE=X,ot.__COMPILER_RUNTIME={__proto__:null,c:function(E){return X.H.useMemoCache(E)}},ot.cache=function(E){return function(){return E.apply(null,arguments)}},ot.cacheSignal=function(){return null},ot.cloneElement=function(E,L,se){if(E==null)throw Error("The argument must be a React element, but you passed "+E+".");var ie=w({},E.props),oe=E.key;if(L!=null)for(Ne in L.key!==void 0&&(oe=""+L.key),L)!J.call(L,Ne)||Ne==="key"||Ne==="__self"||Ne==="__source"||Ne==="ref"&&L.ref===void 0||(ie[Ne]=L[Ne]);var Ne=arguments.length-2;if(Ne===1)ie.children=se;else if(1<Ne){for(var we=Array(Ne),je=0;je<Ne;je++)we[je]=arguments[je+2];ie.children=we}return Y(E.type,oe,ie)},ot.createContext=function(E){return E={$$typeof:o,_currentValue:E,_currentValue2:E,_threadCount:0,Provider:null,Consumer:null},E.Provider=E,E.Consumer={$$typeof:i,_context:E},E},ot.createElement=function(E,L,se){var ie,oe={},Ne=null;if(L!=null)for(ie in L.key!==void 0&&(Ne=""+L.key),L)J.call(L,ie)&&ie!=="key"&&ie!=="__self"&&ie!=="__source"&&(oe[ie]=L[ie]);var we=arguments.length-2;if(we===1)oe.children=se;else if(1<we){for(var je=Array(we),ve=0;ve<we;ve++)je[ve]=arguments[ve+2];oe.children=je}if(E&&E.defaultProps)for(ie in we=E.defaultProps,we)oe[ie]===void 0&&(oe[ie]=we[ie]);return Y(E,Ne,oe)},ot.createRef=function(){return{current:null}},ot.forwardRef=function(E){return{$$typeof:m,render:E}},ot.isValidElement=K,ot.lazy=function(E){return{$$typeof:j,_payload:{_status:-1,_result:E},_init:ue}},ot.memo=function(E,L){return{$$typeof:d,type:E,compare:L===void 0?null:L}},ot.startTransition=function(E){var L=X.T,se={};X.T=se;try{var ie=E(),oe=X.S;oe!==null&&oe(se,ie),typeof ie=="object"&&ie!==null&&typeof ie.then=="function"&&ie.then($,ee)}catch(Ne){ee(Ne)}finally{L!==null&&se.types!==null&&(L.types=se.types),X.T=L}},ot.unstable_useCacheRefresh=function(){return X.H.useCacheRefresh()},ot.use=function(E){return X.H.use(E)},ot.useActionState=function(E,L,se){return X.H.useActionState(E,L,se)},ot.useCallback=function(E,L){return X.H.useCallback(E,L)},ot.useContext=function(E){return X.H.useContext(E)},ot.useDebugValue=function(){},ot.useDeferredValue=function(E,L){return X.H.useDeferredValue(E,L)},ot.useEffect=function(E,L){return X.H.useEffect(E,L)},ot.useEffectEvent=function(E){return X.H.useEffectEvent(E)},ot.useId=function(){return X.H.useId()},ot.useImperativeHandle=function(E,L,se){return X.H.useImperativeHandle(E,L,se)},ot.useInsertionEffect=function(E,L){return X.H.useInsertionEffect(E,L)},ot.useLayoutEffect=function(E,L){return X.H.useLayoutEffect(E,L)},ot.useMemo=function(E,L){return X.H.useMemo(E,L)},ot.useOptimistic=function(E,L){return X.H.useOptimistic(E,L)},ot.useReducer=function(E,L,se){return X.H.useReducer(E,L,se)},ot.useRef=function(E){return X.H.useRef(E)},ot.useState=function(E){return X.H.useState(E)},ot.useSyncExternalStore=function(E,L,se){return X.H.useSyncExternalStore(E,L,se)},ot.useTransition=function(){return X.H.useTransition()},ot.version="19.2.0",ot}var ip;function xl(){return ip||(ip=1,sd.exports=Ky()),sd.exports}var U=xl();const Hr=gl(U);var id={exports:{}},ol={},ld={exports:{}},od={};/**
 * @license React
 * scheduler.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var lp;function Zy(){return lp||(lp=1,function(r){function g(z,Q){var ue=z.length;z.push(Q);e:for(;0<ue;){var ee=ue-1>>>1,V=z[ee];if(0<f(V,Q))z[ee]=Q,z[ue]=V,ue=ee;else break e}}function l(z){return z.length===0?null:z[0]}function u(z){if(z.length===0)return null;var Q=z[0],ue=z.pop();if(ue!==Q){z[0]=ue;e:for(var ee=0,V=z.length,E=V>>>1;ee<E;){var L=2*(ee+1)-1,se=z[L],ie=L+1,oe=z[ie];if(0>f(se,ue))ie<V&&0>f(oe,se)?(z[ee]=oe,z[ie]=ue,ee=ie):(z[ee]=se,z[L]=ue,ee=L);else if(ie<V&&0>f(oe,ue))z[ee]=oe,z[ie]=ue,ee=ie;else break e}}return Q}function f(z,Q){var ue=z.sortIndex-Q.sortIndex;return ue!==0?ue:z.id-Q.id}if(r.unstable_now=void 0,typeof performance=="object"&&typeof performance.now=="function"){var i=performance;r.unstable_now=function(){return i.now()}}else{var o=Date,m=o.now();r.unstable_now=function(){return o.now()-m}}var x=[],d=[],j=1,y=null,_=3,b=!1,D=!1,w=!1,N=!1,S=typeof setTimeout=="function"?setTimeout:null,O=typeof clearTimeout=="function"?clearTimeout:null,C=typeof setImmediate<"u"?setImmediate:null;function M(z){for(var Q=l(d);Q!==null;){if(Q.callback===null)u(d);else if(Q.startTime<=z)u(d),Q.sortIndex=Q.expirationTime,g(x,Q);else break;Q=l(d)}}function R(z){if(w=!1,M(z),!D)if(l(x)!==null)D=!0,$||($=!0,q());else{var Q=l(d);Q!==null&&B(R,Q.startTime-z)}}var $=!1,X=-1,J=5,Y=-1;function H(){return N?!0:!(r.unstable_now()-Y<J)}function K(){if(N=!1,$){var z=r.unstable_now();Y=z;var Q=!0;try{e:{D=!1,w&&(w=!1,O(X),X=-1),b=!0;var ue=_;try{t:{for(M(z),y=l(x);y!==null&&!(y.expirationTime>z&&H());){var ee=y.callback;if(typeof ee=="function"){y.callback=null,_=y.priorityLevel;var V=ee(y.expirationTime<=z);if(z=r.unstable_now(),typeof V=="function"){y.callback=V,M(z),Q=!0;break t}y===l(x)&&u(x),M(z)}else u(x);y=l(x)}if(y!==null)Q=!0;else{var E=l(d);E!==null&&B(R,E.startTime-z),Q=!1}}break e}finally{y=null,_=ue,b=!1}Q=void 0}}finally{Q?q():$=!1}}}var q;if(typeof C=="function")q=function(){C(K)};else if(typeof MessageChannel<"u"){var W=new MessageChannel,A=W.port2;W.port1.onmessage=K,q=function(){A.postMessage(null)}}else q=function(){S(K,0)};function B(z,Q){X=S(function(){z(r.unstable_now())},Q)}r.unstable_IdlePriority=5,r.unstable_ImmediatePriority=1,r.unstable_LowPriority=4,r.unstable_NormalPriority=3,r.unstable_Profiling=null,r.unstable_UserBlockingPriority=2,r.unstable_cancelCallback=function(z){z.callback=null},r.unstable_forceFrameRate=function(z){0>z||125<z?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):J=0<z?Math.floor(1e3/z):5},r.unstable_getCurrentPriorityLevel=function(){return _},r.unstable_next=function(z){switch(_){case 1:case 2:case 3:var Q=3;break;default:Q=_}var ue=_;_=Q;try{return z()}finally{_=ue}},r.unstable_requestPaint=function(){N=!0},r.unstable_runWithPriority=function(z,Q){switch(z){case 1:case 2:case 3:case 4:case 5:break;default:z=3}var ue=_;_=z;try{return Q()}finally{_=ue}},r.unstable_scheduleCallback=function(z,Q,ue){var ee=r.unstable_now();switch(typeof ue=="object"&&ue!==null?(ue=ue.delay,ue=typeof ue=="number"&&0<ue?ee+ue:ee):ue=ee,z){case 1:var V=-1;break;case 2:V=250;break;case 5:V=1073741823;break;case 4:V=1e4;break;default:V=5e3}return V=ue+V,z={id:j++,callback:Q,priorityLevel:z,startTime:ue,expirationTime:V,sortIndex:-1},ue>ee?(z.sortIndex=ue,g(d,z),l(x)===null&&z===l(d)&&(w?(O(X),X=-1):w=!0,B(R,ue-ee))):(z.sortIndex=V,g(x,z),D||b||(D=!0,$||($=!0,q()))),z},r.unstable_shouldYield=H,r.unstable_wrapCallback=function(z){var Q=_;return function(){var ue=_;_=Q;try{return z.apply(this,arguments)}finally{_=ue}}}}(od)),od}var op;function Xy(){return op||(op=1,ld.exports=Zy()),ld.exports}var cd={exports:{}},vn={};/**
 * @license React
 * react-dom.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var cp;function Wy(){if(cp)return vn;cp=1;var r=xl();function g(x){var d="https://react.dev/errors/"+x;if(1<arguments.length){d+="?args[]="+encodeURIComponent(arguments[1]);for(var j=2;j<arguments.length;j++)d+="&args[]="+encodeURIComponent(arguments[j])}return"Minified React error #"+x+"; visit "+d+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}function l(){}var u={d:{f:l,r:function(){throw Error(g(522))},D:l,C:l,L:l,m:l,X:l,S:l,M:l},p:0,findDOMNode:null},f=Symbol.for("react.portal");function i(x,d,j){var y=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:f,key:y==null?null:""+y,children:x,containerInfo:d,implementation:j}}var o=r.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE;function m(x,d){if(x==="font")return"";if(typeof d=="string")return d==="use-credentials"?d:""}return vn.__DOM_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE=u,vn.createPortal=function(x,d){var j=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!d||d.nodeType!==1&&d.nodeType!==9&&d.nodeType!==11)throw Error(g(299));return i(x,d,null,j)},vn.flushSync=function(x){var d=o.T,j=u.p;try{if(o.T=null,u.p=2,x)return x()}finally{o.T=d,u.p=j,u.d.f()}},vn.preconnect=function(x,d){typeof x=="string"&&(d?(d=d.crossOrigin,d=typeof d=="string"?d==="use-credentials"?d:"":void 0):d=null,u.d.C(x,d))},vn.prefetchDNS=function(x){typeof x=="string"&&u.d.D(x)},vn.preinit=function(x,d){if(typeof x=="string"&&d&&typeof d.as=="string"){var j=d.as,y=m(j,d.crossOrigin),_=typeof d.integrity=="string"?d.integrity:void 0,b=typeof d.fetchPriority=="string"?d.fetchPriority:void 0;j==="style"?u.d.S(x,typeof d.precedence=="string"?d.precedence:void 0,{crossOrigin:y,integrity:_,fetchPriority:b}):j==="script"&&u.d.X(x,{crossOrigin:y,integrity:_,fetchPriority:b,nonce:typeof d.nonce=="string"?d.nonce:void 0})}},vn.preinitModule=function(x,d){if(typeof x=="string")if(typeof d=="object"&&d!==null){if(d.as==null||d.as==="script"){var j=m(d.as,d.crossOrigin);u.d.M(x,{crossOrigin:j,integrity:typeof d.integrity=="string"?d.integrity:void 0,nonce:typeof d.nonce=="string"?d.nonce:void 0})}}else d==null&&u.d.M(x)},vn.preload=function(x,d){if(typeof x=="string"&&typeof d=="object"&&d!==null&&typeof d.as=="string"){var j=d.as,y=m(j,d.crossOrigin);u.d.L(x,j,{crossOrigin:y,integrity:typeof d.integrity=="string"?d.integrity:void 0,nonce:typeof d.nonce=="string"?d.nonce:void 0,type:typeof d.type=="string"?d.type:void 0,fetchPriority:typeof d.fetchPriority=="string"?d.fetchPriority:void 0,referrerPolicy:typeof d.referrerPolicy=="string"?d.referrerPolicy:void 0,imageSrcSet:typeof d.imageSrcSet=="string"?d.imageSrcSet:void 0,imageSizes:typeof d.imageSizes=="string"?d.imageSizes:void 0,media:typeof d.media=="string"?d.media:void 0})}},vn.preloadModule=function(x,d){if(typeof x=="string")if(d){var j=m(d.as,d.crossOrigin);u.d.m(x,{as:typeof d.as=="string"&&d.as!=="script"?d.as:void 0,crossOrigin:j,integrity:typeof d.integrity=="string"?d.integrity:void 0})}else u.d.m(x)},vn.requestFormReset=function(x){u.d.r(x)},vn.unstable_batchedUpdates=function(x,d){return x(d)},vn.useFormState=function(x,d,j){return o.H.useFormState(x,d,j)},vn.useFormStatus=function(){return o.H.useHostTransitionStatus()},vn.version="19.2.0",vn}var up;function e0(){if(up)return cd.exports;up=1;function r(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(r)}catch(g){console.error(g)}}return r(),cd.exports=Wy(),cd.exports}/**
 * @license React
 * react-dom-client.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var dp;function t0(){if(dp)return ol;dp=1;var r=Xy(),g=xl(),l=e0();function u(e){var t="https://react.dev/errors/"+e;if(1<arguments.length){t+="?args[]="+encodeURIComponent(arguments[1]);for(var a=2;a<arguments.length;a++)t+="&args[]="+encodeURIComponent(arguments[a])}return"Minified React error #"+e+"; visit "+t+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}function f(e){return!(!e||e.nodeType!==1&&e.nodeType!==9&&e.nodeType!==11)}function i(e){var t=e,a=e;if(e.alternate)for(;t.return;)t=t.return;else{e=t;do t=e,(t.flags&4098)!==0&&(a=t.return),e=t.return;while(e)}return t.tag===3?a:null}function o(e){if(e.tag===13){var t=e.memoizedState;if(t===null&&(e=e.alternate,e!==null&&(t=e.memoizedState)),t!==null)return t.dehydrated}return null}function m(e){if(e.tag===31){var t=e.memoizedState;if(t===null&&(e=e.alternate,e!==null&&(t=e.memoizedState)),t!==null)return t.dehydrated}return null}function x(e){if(i(e)!==e)throw Error(u(188))}function d(e){var t=e.alternate;if(!t){if(t=i(e),t===null)throw Error(u(188));return t!==e?null:e}for(var a=e,s=t;;){var c=a.return;if(c===null)break;var h=c.alternate;if(h===null){if(s=c.return,s!==null){a=s;continue}break}if(c.child===h.child){for(h=c.child;h;){if(h===a)return x(c),e;if(h===s)return x(c),t;h=h.sibling}throw Error(u(188))}if(a.return!==s.return)a=c,s=h;else{for(var T=!1,F=c.child;F;){if(F===a){T=!0,a=c,s=h;break}if(F===s){T=!0,s=c,a=h;break}F=F.sibling}if(!T){for(F=h.child;F;){if(F===a){T=!0,a=h,s=c;break}if(F===s){T=!0,s=h,a=c;break}F=F.sibling}if(!T)throw Error(u(189))}}if(a.alternate!==s)throw Error(u(190))}if(a.tag!==3)throw Error(u(188));return a.stateNode.current===a?e:t}function j(e){var t=e.tag;if(t===5||t===26||t===27||t===6)return e;for(e=e.child;e!==null;){if(t=j(e),t!==null)return t;e=e.sibling}return null}var y=Object.assign,_=Symbol.for("react.element"),b=Symbol.for("react.transitional.element"),D=Symbol.for("react.portal"),w=Symbol.for("react.fragment"),N=Symbol.for("react.strict_mode"),S=Symbol.for("react.profiler"),O=Symbol.for("react.consumer"),C=Symbol.for("react.context"),M=Symbol.for("react.forward_ref"),R=Symbol.for("react.suspense"),$=Symbol.for("react.suspense_list"),X=Symbol.for("react.memo"),J=Symbol.for("react.lazy"),Y=Symbol.for("react.activity"),H=Symbol.for("react.memo_cache_sentinel"),K=Symbol.iterator;function q(e){return e===null||typeof e!="object"?null:(e=K&&e[K]||e["@@iterator"],typeof e=="function"?e:null)}var W=Symbol.for("react.client.reference");function A(e){if(e==null)return null;if(typeof e=="function")return e.$$typeof===W?null:e.displayName||e.name||null;if(typeof e=="string")return e;switch(e){case w:return"Fragment";case S:return"Profiler";case N:return"StrictMode";case R:return"Suspense";case $:return"SuspenseList";case Y:return"Activity"}if(typeof e=="object")switch(e.$$typeof){case D:return"Portal";case C:return e.displayName||"Context";case O:return(e._context.displayName||"Context")+".Consumer";case M:var t=e.render;return e=e.displayName,e||(e=t.displayName||t.name||"",e=e!==""?"ForwardRef("+e+")":"ForwardRef"),e;case X:return t=e.displayName||null,t!==null?t:A(e.type)||"Memo";case J:t=e._payload,e=e._init;try{return A(e(t))}catch{}}return null}var B=Array.isArray,z=g.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE,Q=l.__DOM_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE,ue={pending:!1,data:null,method:null,action:null},ee=[],V=-1;function E(e){return{current:e}}function L(e){0>V||(e.current=ee[V],ee[V]=null,V--)}function se(e,t){V++,ee[V]=e.current,e.current=t}var ie=E(null),oe=E(null),Ne=E(null),we=E(null);function je(e,t){switch(se(Ne,t),se(oe,e),se(ie,null),t.nodeType){case 9:case 11:e=(e=t.documentElement)&&(e=e.namespaceURI)?_m(e):0;break;default:if(e=t.tagName,t=t.namespaceURI)t=_m(t),e=km(t,e);else switch(e){case"svg":e=1;break;case"math":e=2;break;default:e=0}}L(ie),se(ie,e)}function ve(){L(ie),L(oe),L(Ne)}function Me(e){e.memoizedState!==null&&se(we,e);var t=ie.current,a=km(t,e.type);t!==a&&(se(oe,e),se(ie,a))}function Fe(e){oe.current===e&&(L(ie),L(oe)),we.current===e&&(L(we),al._currentValue=ue)}var Pe,Re;function k(e){if(Pe===void 0)try{throw Error()}catch(a){var t=a.stack.trim().match(/\n( *(at )?)/);Pe=t&&t[1]||"",Re=-1<a.stack.indexOf(`
    at`)?" (<anonymous>)":-1<a.stack.indexOf("@")?"@unknown:0:0":""}return`
`+Pe+e+Re}var xe=!1;function he(e,t){if(!e||xe)return"";xe=!0;var a=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{var s={DetermineComponentFrameRoot:function(){try{if(t){var Ie=function(){throw Error()};if(Object.defineProperty(Ie.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(Ie,[])}catch(ke){var Se=ke}Reflect.construct(e,[],Ie)}else{try{Ie.call()}catch(ke){Se=ke}e.call(Ie.prototype)}}else{try{throw Error()}catch(ke){Se=ke}(Ie=e())&&typeof Ie.catch=="function"&&Ie.catch(function(){})}}catch(ke){if(ke&&Se&&typeof ke.stack=="string")return[ke.stack,Se.stack]}return[null,null]}};s.DetermineComponentFrameRoot.displayName="DetermineComponentFrameRoot";var c=Object.getOwnPropertyDescriptor(s.DetermineComponentFrameRoot,"name");c&&c.configurable&&Object.defineProperty(s.DetermineComponentFrameRoot,"name",{value:"DetermineComponentFrameRoot"});var h=s.DetermineComponentFrameRoot(),T=h[0],F=h[1];if(T&&F){var re=T.split(`
`),be=F.split(`
`);for(c=s=0;s<re.length&&!re[s].includes("DetermineComponentFrameRoot");)s++;for(;c<be.length&&!be[c].includes("DetermineComponentFrameRoot");)c++;if(s===re.length||c===be.length)for(s=re.length-1,c=be.length-1;1<=s&&0<=c&&re[s]!==be[c];)c--;for(;1<=s&&0<=c;s--,c--)if(re[s]!==be[c]){if(s!==1||c!==1)do if(s--,c--,0>c||re[s]!==be[c]){var Te=`
`+re[s].replace(" at new "," at ");return e.displayName&&Te.includes("<anonymous>")&&(Te=Te.replace("<anonymous>",e.displayName)),Te}while(1<=s&&0<=c);break}}}finally{xe=!1,Error.prepareStackTrace=a}return(a=e?e.displayName||e.name:"")?k(a):""}function Z(e,t){switch(e.tag){case 26:case 27:case 5:return k(e.type);case 16:return k("Lazy");case 13:return e.child!==t&&t!==null?k("Suspense Fallback"):k("Suspense");case 19:return k("SuspenseList");case 0:case 15:return he(e.type,!1);case 11:return he(e.type.render,!1);case 1:return he(e.type,!0);case 31:return k("Activity");default:return""}}function P(e){try{var t="",a=null;do t+=Z(e,a),a=e,e=e.return;while(e);return t}catch(s){return`
Error generating stack: `+s.message+`
`+s.stack}}var ae=Object.prototype.hasOwnProperty,fe=r.unstable_scheduleCallback,Ae=r.unstable_cancelCallback,de=r.unstable_shouldYield,Ue=r.unstable_requestPaint,Le=r.unstable_now,_e=r.unstable_getCurrentPriorityLevel,pe=r.unstable_ImmediatePriority,Be=r.unstable_UserBlockingPriority,He=r.unstable_NormalPriority,Xe=r.unstable_LowPriority,qe=r.unstable_IdlePriority,Ge=r.log,at=r.unstable_setDisableYieldValue,Je=null,xt=null;function Rt(e){if(typeof Ge=="function"&&at(e),xt&&typeof xt.setStrictMode=="function")try{xt.setStrictMode(Je,e)}catch{}}var vt=Math.clz32?Math.clz32:xs,Lt=Math.log,it=Math.LN2;function xs(e){return e>>>=0,e===0?32:31-(Lt(e)/it|0)|0}var ya=256,ba=262144,gn=4194304;function An(e){var t=e&42;if(t!==0)return t;switch(e&-e){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:return 64;case 128:return 128;case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:return e&261888;case 262144:case 524288:case 1048576:case 2097152:return e&3932160;case 4194304:case 8388608:case 16777216:case 33554432:return e&62914560;case 67108864:return 67108864;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 0;default:return e}}function Un(e,t,a){var s=e.pendingLanes;if(s===0)return 0;var c=0,h=e.suspendedLanes,T=e.pingedLanes;e=e.warmLanes;var F=s&134217727;return F!==0?(s=F&~h,s!==0?c=An(s):(T&=F,T!==0?c=An(T):a||(a=F&~e,a!==0&&(c=An(a))))):(F=s&~h,F!==0?c=An(F):T!==0?c=An(T):a||(a=s&~e,a!==0&&(c=An(a)))),c===0?0:t!==0&&t!==c&&(t&h)===0&&(h=c&-c,a=t&-t,h>=a||h===32&&(a&4194048)!==0)?t:c}function lr(e,t){return(e.pendingLanes&~(e.suspendedLanes&~e.pingedLanes)&t)===0}function Ye(e,t){switch(e){case 1:case 2:case 4:case 8:case 64:return t+250;case 16:case 32:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return t+5e3;case 4194304:case 8388608:case 16777216:case 33554432:return-1;case 67108864:case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function ys(){var e=gn;return gn<<=1,(gn&62914560)===0&&(gn=4194304),e}function sn(e){for(var t=[],a=0;31>a;a++)t.push(e);return t}function ia(e,t){e.pendingLanes|=t,t!==268435456&&(e.suspendedLanes=0,e.pingedLanes=0,e.warmLanes=0)}function oi(e,t,a,s,c,h){var T=e.pendingLanes;e.pendingLanes=a,e.suspendedLanes=0,e.pingedLanes=0,e.warmLanes=0,e.expiredLanes&=a,e.entangledLanes&=a,e.errorRecoveryDisabledLanes&=a,e.shellSuspendCounter=0;var F=e.entanglements,re=e.expirationTimes,be=e.hiddenUpdates;for(a=T&~a;0<a;){var Te=31-vt(a),Ie=1<<Te;F[Te]=0,re[Te]=-1;var Se=be[Te];if(Se!==null)for(be[Te]=null,Te=0;Te<Se.length;Te++){var ke=Se[Te];ke!==null&&(ke.lane&=-536870913)}a&=~Ie}s!==0&&ci(e,s,0),h!==0&&c===0&&e.tag!==0&&(e.suspendedLanes|=h&~(T&~t))}function ci(e,t,a){e.pendingLanes|=t,e.suspendedLanes&=~t;var s=31-vt(t);e.entangledLanes|=t,e.entanglements[s]=e.entanglements[s]|1073741824|a&261930}function va(e,t){var a=e.entangledLanes|=t;for(e=e.entanglements;a;){var s=31-vt(a),c=1<<s;c&t|e[s]&t&&(e[s]|=t),a&=~c}}function ui(e,t){var a=t&-t;return a=(a&42)!==0?1:xn(a),(a&(e.suspendedLanes|t))!==0?0:a}function xn(e){switch(e){case 2:e=1;break;case 8:e=4;break;case 32:e=16;break;case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:e=128;break;case 268435456:e=134217728;break;default:e=0}return e}function bs(e){return e&=-e,2<e?8<e?(e&134217727)!==0?32:268435456:8:2}function Oa(){var e=Q.p;return e!==0?e:(e=window.event,e===void 0?32:Km(e.type))}function di(e,t){var a=Q.p;try{return Q.p=e,t()}finally{Q.p=a}}var la=Math.random().toString(36).slice(2),nn="__reactFiber$"+la,Nt="__reactProps$"+la,Ia="__reactContainer$"+la,fi="__reactEvents$"+la,hi="__reactListeners$"+la,yl="__reactHandles$"+la,$r="__reactResources$"+la,yn="__reactMarker$"+la;function or(e){delete e[nn],delete e[Nt],delete e[fi],delete e[hi],delete e[yl]}function wa(e){var t=e[nn];if(t)return t;for(var a=e.parentNode;a;){if(t=a[Ia]||a[nn]){if(a=t.alternate,t.child!==null||a!==null&&a.child!==null)for(e=Rm(e);e!==null;){if(a=e[nn])return a;e=Rm(e)}return t}e=a,a=e.parentNode}return null}function Ra(e){if(e=e[nn]||e[Ia]){var t=e.tag;if(t===5||t===6||t===13||t===31||t===26||t===27||t===3)return e}return null}function cr(e){var t=e.tag;if(t===5||t===26||t===27||t===6)return e.stateNode;throw Error(u(33))}function Ma(e){var t=e[$r];return t||(t=e[$r]={hoistableStyles:new Map,hoistableScripts:new Map}),t}function Bt(e){e[yn]=!0}var mi=new Set,Pr={};function Sa(e,t){zn(e,t),zn(e+"Capture",t)}function zn(e,t){for(Pr[e]=t,e=0;e<t.length;e++)mi.add(t[e])}var pi=RegExp("^[:A-Z_a-z\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02FF\\u0370-\\u037D\\u037F-\\u1FFF\\u200C-\\u200D\\u2070-\\u218F\\u2C00-\\u2FEF\\u3001-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFFD][:A-Z_a-z\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02FF\\u0370-\\u037D\\u037F-\\u1FFF\\u200C-\\u200D\\u2070-\\u218F\\u2C00-\\u2FEF\\u3001-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFFD\\-.0-9\\u00B7\\u0300-\\u036F\\u203F-\\u2040]*$"),gi={},xi={};function bl(e){return ae.call(xi,e)?!0:ae.call(gi,e)?!1:pi.test(e)?xi[e]=!0:(gi[e]=!0,!1)}function vs(e,t,a){if(bl(t))if(a===null)e.removeAttribute(t);else{switch(typeof a){case"undefined":case"function":case"symbol":e.removeAttribute(t);return;case"boolean":var s=t.toLowerCase().slice(0,5);if(s!=="data-"&&s!=="aria-"){e.removeAttribute(t);return}}e.setAttribute(t,""+a)}}function Jr(e,t,a){if(a===null)e.removeAttribute(t);else{switch(typeof a){case"undefined":case"function":case"symbol":case"boolean":e.removeAttribute(t);return}e.setAttribute(t,""+a)}}function $n(e,t,a,s){if(s===null)e.removeAttribute(a);else{switch(typeof s){case"undefined":case"function":case"symbol":case"boolean":e.removeAttribute(a);return}e.setAttributeNS(t,a,""+s)}}function ln(e){switch(typeof e){case"bigint":case"boolean":case"number":case"string":case"undefined":return e;case"object":return e;default:return""}}function yi(e){var t=e.type;return(e=e.nodeName)&&e.toLowerCase()==="input"&&(t==="checkbox"||t==="radio")}function Ot(e,t,a){var s=Object.getOwnPropertyDescriptor(e.constructor.prototype,t);if(!e.hasOwnProperty(t)&&typeof s<"u"&&typeof s.get=="function"&&typeof s.set=="function"){var c=s.get,h=s.set;return Object.defineProperty(e,t,{configurable:!0,get:function(){return c.call(this)},set:function(T){a=""+T,h.call(this,T)}}),Object.defineProperty(e,t,{enumerable:s.enumerable}),{getValue:function(){return a},setValue:function(T){a=""+T},stopTracking:function(){e._valueTracker=null,delete e[t]}}}}function Ua(e){if(!e._valueTracker){var t=yi(e)?"checked":"value";e._valueTracker=Ot(e,t,""+e[t])}}function ws(e){if(!e)return!1;var t=e._valueTracker;if(!t)return!0;var a=t.getValue(),s="";return e&&(s=yi(e)?e.checked?"true":"false":e.value),e=s,e!==a?(t.setValue(e),!0):!1}function Pn(e){if(e=e||(typeof document<"u"?document:void 0),typeof e>"u")return null;try{return e.activeElement||e.body}catch{return e.body}}var Ss=/[\n"\\]/g;function cn(e){return e.replace(Ss,function(t){return"\\"+t.charCodeAt(0).toString(16)+" "})}function ur(e,t,a,s,c,h,T,F){e.name="",T!=null&&typeof T!="function"&&typeof T!="symbol"&&typeof T!="boolean"?e.type=T:e.removeAttribute("type"),t!=null?T==="number"?(t===0&&e.value===""||e.value!=t)&&(e.value=""+ln(t)):e.value!==""+ln(t)&&(e.value=""+ln(t)):T!=="submit"&&T!=="reset"||e.removeAttribute("value"),t!=null?bi(e,T,ln(t)):a!=null?bi(e,T,ln(a)):s!=null&&e.removeAttribute("value"),c==null&&h!=null&&(e.defaultChecked=!!h),c!=null&&(e.checked=c&&typeof c!="function"&&typeof c!="symbol"),F!=null&&typeof F!="function"&&typeof F!="symbol"&&typeof F!="boolean"?e.name=""+ln(F):e.removeAttribute("name")}function dr(e,t,a,s,c,h,T,F){if(h!=null&&typeof h!="function"&&typeof h!="symbol"&&typeof h!="boolean"&&(e.type=h),t!=null||a!=null){if(!(h!=="submit"&&h!=="reset"||t!=null)){Ua(e);return}a=a!=null?""+ln(a):"",t=t!=null?""+ln(t):a,F||t===e.value||(e.value=t),e.defaultValue=t}s=s??c,s=typeof s!="function"&&typeof s!="symbol"&&!!s,e.checked=F?e.checked:!!s,e.defaultChecked=!!s,T!=null&&typeof T!="function"&&typeof T!="symbol"&&typeof T!="boolean"&&(e.name=T),Ua(e)}function bi(e,t,a){t==="number"&&Pn(e.ownerDocument)===e||e.defaultValue===""+a||(e.defaultValue=""+a)}function fr(e,t,a,s){if(e=e.options,t){t={};for(var c=0;c<a.length;c++)t["$"+a[c]]=!0;for(a=0;a<e.length;a++)c=t.hasOwnProperty("$"+e[a].value),e[a].selected!==c&&(e[a].selected=c),c&&s&&(e[a].defaultSelected=!0)}else{for(a=""+ln(a),t=null,c=0;c<e.length;c++){if(e[c].value===a){e[c].selected=!0,s&&(e[c].defaultSelected=!0);return}t!==null||e[c].disabled||(t=e[c])}t!==null&&(t.selected=!0)}}function vi(e,t,a){if(t!=null&&(t=""+ln(t),t!==e.value&&(e.value=t),a==null)){e.defaultValue!==t&&(e.defaultValue=t);return}e.defaultValue=a!=null?""+ln(a):""}function Es(e,t,a,s){if(t==null){if(s!=null){if(a!=null)throw Error(u(92));if(B(s)){if(1<s.length)throw Error(u(93));s=s[0]}a=s}a==null&&(a=""),t=a}a=ln(t),e.defaultValue=a,s=e.textContent,s===a&&s!==""&&s!==null&&(e.value=s),Ua(e)}function za(e,t){if(t){var a=e.firstChild;if(a&&a===e.lastChild&&a.nodeType===3){a.nodeValue=t;return}}e.textContent=t}var wi=new Set("animationIterationCount aspectRatio borderImageOutset borderImageSlice borderImageWidth boxFlex boxFlexGroup boxOrdinalGroup columnCount columns flex flexGrow flexPositive flexShrink flexNegative flexOrder gridArea gridRow gridRowEnd gridRowSpan gridRowStart gridColumn gridColumnEnd gridColumnSpan gridColumnStart fontWeight lineClamp lineHeight opacity order orphans scale tabSize widows zIndex zoom fillOpacity floodOpacity stopOpacity strokeDasharray strokeDashoffset strokeMiterlimit strokeOpacity strokeWidth MozAnimationIterationCount MozBoxFlex MozBoxFlexGroup MozLineClamp msAnimationIterationCount msFlex msZoom msFlexGrow msFlexNegative msFlexOrder msFlexPositive msFlexShrink msGridColumn msGridColumnSpan msGridRow msGridRowSpan WebkitAnimationIterationCount WebkitBoxFlex WebKitBoxFlexGroup WebkitBoxOrdinalGroup WebkitColumnCount WebkitColumns WebkitFlex WebkitFlexGrow WebkitFlexPositive WebkitFlexShrink WebkitLineClamp".split(" "));function js(e,t,a){var s=t.indexOf("--")===0;a==null||typeof a=="boolean"||a===""?s?e.setProperty(t,""):t==="float"?e.cssFloat="":e[t]="":s?e.setProperty(t,a):typeof a!="number"||a===0||wi.has(t)?t==="float"?e.cssFloat=a:e[t]=(""+a).trim():e[t]=a+"px"}function vl(e,t,a){if(t!=null&&typeof t!="object")throw Error(u(62));if(e=e.style,a!=null){for(var s in a)!a.hasOwnProperty(s)||t!=null&&t.hasOwnProperty(s)||(s.indexOf("--")===0?e.setProperty(s,""):s==="float"?e.cssFloat="":e[s]="");for(var c in t)s=t[c],t.hasOwnProperty(c)&&a[c]!==s&&js(e,c,s)}else for(var h in t)t.hasOwnProperty(h)&&js(e,h,t[h])}function hr(e){if(e.indexOf("-")===-1)return!1;switch(e){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var Ns=new Map([["acceptCharset","accept-charset"],["htmlFor","for"],["httpEquiv","http-equiv"],["crossOrigin","crossorigin"],["accentHeight","accent-height"],["alignmentBaseline","alignment-baseline"],["arabicForm","arabic-form"],["baselineShift","baseline-shift"],["capHeight","cap-height"],["clipPath","clip-path"],["clipRule","clip-rule"],["colorInterpolation","color-interpolation"],["colorInterpolationFilters","color-interpolation-filters"],["colorProfile","color-profile"],["colorRendering","color-rendering"],["dominantBaseline","dominant-baseline"],["enableBackground","enable-background"],["fillOpacity","fill-opacity"],["fillRule","fill-rule"],["floodColor","flood-color"],["floodOpacity","flood-opacity"],["fontFamily","font-family"],["fontSize","font-size"],["fontSizeAdjust","font-size-adjust"],["fontStretch","font-stretch"],["fontStyle","font-style"],["fontVariant","font-variant"],["fontWeight","font-weight"],["glyphName","glyph-name"],["glyphOrientationHorizontal","glyph-orientation-horizontal"],["glyphOrientationVertical","glyph-orientation-vertical"],["horizAdvX","horiz-adv-x"],["horizOriginX","horiz-origin-x"],["imageRendering","image-rendering"],["letterSpacing","letter-spacing"],["lightingColor","lighting-color"],["markerEnd","marker-end"],["markerMid","marker-mid"],["markerStart","marker-start"],["overlinePosition","overline-position"],["overlineThickness","overline-thickness"],["paintOrder","paint-order"],["panose-1","panose-1"],["pointerEvents","pointer-events"],["renderingIntent","rendering-intent"],["shapeRendering","shape-rendering"],["stopColor","stop-color"],["stopOpacity","stop-opacity"],["strikethroughPosition","strikethrough-position"],["strikethroughThickness","strikethrough-thickness"],["strokeDasharray","stroke-dasharray"],["strokeDashoffset","stroke-dashoffset"],["strokeLinecap","stroke-linecap"],["strokeLinejoin","stroke-linejoin"],["strokeMiterlimit","stroke-miterlimit"],["strokeOpacity","stroke-opacity"],["strokeWidth","stroke-width"],["textAnchor","text-anchor"],["textDecoration","text-decoration"],["textRendering","text-rendering"],["transformOrigin","transform-origin"],["underlinePosition","underline-position"],["underlineThickness","underline-thickness"],["unicodeBidi","unicode-bidi"],["unicodeRange","unicode-range"],["unitsPerEm","units-per-em"],["vAlphabetic","v-alphabetic"],["vHanging","v-hanging"],["vIdeographic","v-ideographic"],["vMathematical","v-mathematical"],["vectorEffect","vector-effect"],["vertAdvY","vert-adv-y"],["vertOriginX","vert-origin-x"],["vertOriginY","vert-origin-y"],["wordSpacing","word-spacing"],["writingMode","writing-mode"],["xmlnsXlink","xmlns:xlink"],["xHeight","x-height"]]),La=/^[\u0000-\u001F ]*j[\r\n\t]*a[\r\n\t]*v[\r\n\t]*a[\r\n\t]*s[\r\n\t]*c[\r\n\t]*r[\r\n\t]*i[\r\n\t]*p[\r\n\t]*t[\r\n\t]*:/i;function mr(e){return La.test(""+e)?"javascript:throw new Error('React has blocked a javascript: URL as a security precaution.')":e}function an(){}var Ea=null;function pr(e){return e=e.target||e.srcElement||window,e.correspondingUseElement&&(e=e.correspondingUseElement),e.nodeType===3?e.parentNode:e}var Ba=null,gr=null;function We(e){var t=Ra(e);if(t&&(e=t.stateNode)){var a=e[Nt]||null;e:switch(e=t.stateNode,t.type){case"input":if(ur(e,a.value,a.defaultValue,a.defaultValue,a.checked,a.defaultChecked,a.type,a.name),t=a.name,a.type==="radio"&&t!=null){for(a=e;a.parentNode;)a=a.parentNode;for(a=a.querySelectorAll('input[name="'+cn(""+t)+'"][type="radio"]'),t=0;t<a.length;t++){var s=a[t];if(s!==e&&s.form===e.form){var c=s[Nt]||null;if(!c)throw Error(u(90));ur(s,c.value,c.defaultValue,c.defaultValue,c.checked,c.defaultChecked,c.type,c.name)}}for(t=0;t<a.length;t++)s=a[t],s.form===e.form&&ws(s)}break e;case"textarea":vi(e,a.value,a.defaultValue);break e;case"select":t=a.value,t!=null&&fr(e,!!a.multiple,t,!1)}}}var _s=!1;function Vr(e,t,a){if(_s)return e(t,a);_s=!0;try{var s=e(t);return s}finally{if(_s=!1,(Ba!==null||gr!==null)&&(co(),Ba&&(t=Ba,e=gr,gr=Ba=null,We(t),e)))for(t=0;t<e.length;t++)We(e[t])}}function ja(e,t){var a=e.stateNode;if(a===null)return null;var s=a[Nt]||null;if(s===null)return null;a=s[t];e:switch(t){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(s=!s.disabled)||(e=e.type,s=!(e==="button"||e==="input"||e==="select"||e==="textarea")),e=!s;break e;default:e=!1}if(e)return null;if(a&&typeof a!="function")throw Error(u(231,t,typeof a));return a}var Jn=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),Fa=!1;if(Jn)try{var oa={};Object.defineProperty(oa,"passive",{get:function(){Fa=!0}}),window.addEventListener("test",oa,oa),window.removeEventListener("test",oa,oa)}catch{Fa=!1}var un=null,xr=null,Kr=null;function p(){if(Kr)return Kr;var e,t=xr,a=t.length,s,c="value"in un?un.value:un.textContent,h=c.length;for(e=0;e<a&&t[e]===c[e];e++);var T=a-e;for(s=1;s<=T&&t[a-s]===c[h-s];s++);return Kr=c.slice(e,1<s?1-s:void 0)}function v(e){var t=e.keyCode;return"charCode"in e?(e=e.charCode,e===0&&t===13&&(e=13)):e=t,e===10&&(e=13),32<=e||e===13?e:0}function I(){return!0}function G(){return!1}function ne(e){function t(a,s,c,h,T){this._reactName=a,this._targetInst=c,this.type=s,this.nativeEvent=h,this.target=T,this.currentTarget=null;for(var F in e)e.hasOwnProperty(F)&&(a=e[F],this[F]=a?a(h):h[F]);return this.isDefaultPrevented=(h.defaultPrevented!=null?h.defaultPrevented:h.returnValue===!1)?I:G,this.isPropagationStopped=G,this}return y(t.prototype,{preventDefault:function(){this.defaultPrevented=!0;var a=this.nativeEvent;a&&(a.preventDefault?a.preventDefault():typeof a.returnValue!="unknown"&&(a.returnValue=!1),this.isDefaultPrevented=I)},stopPropagation:function(){var a=this.nativeEvent;a&&(a.stopPropagation?a.stopPropagation():typeof a.cancelBubble!="unknown"&&(a.cancelBubble=!0),this.isPropagationStopped=I)},persist:function(){},isPersistent:I}),t}var Ee={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(e){return e.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},De=ne(Ee),nt=y({},Ee,{view:0,detail:0}),yt=ne(nt),lt,Ft,qt,Zr=y({},nt,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:Ei,button:0,buttons:0,relatedTarget:function(e){return e.relatedTarget===void 0?e.fromElement===e.srcElement?e.toElement:e.fromElement:e.relatedTarget},movementX:function(e){return"movementX"in e?e.movementX:(e!==qt&&(qt&&e.type==="mousemove"?(lt=e.screenX-qt.screenX,Ft=e.screenY-qt.screenY):Ft=lt=0,qt=e),lt)},movementY:function(e){return"movementY"in e?e.movementY:Ft}}),wl=ne(Zr),Sl=y({},Zr,{dataTransfer:0}),$o=ne(Sl),El=y({},nt,{relatedTarget:0}),Si=ne(El),Po=y({},Ee,{animationName:0,elapsedTime:0,pseudoElement:0}),Jo=ne(Po),Vo=y({},Ee,{clipboardData:function(e){return"clipboardData"in e?e.clipboardData:window.clipboardData}}),Ko=ne(Vo),Zo=y({},Ee,{data:0}),jl=ne(Zo),Xo={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},Nl={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},Wo={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function ec(e){var t=this.nativeEvent;return t.getModifierState?t.getModifierState(e):(e=Wo[e])?!!t[e]:!1}function Ei(){return ec}var tc=y({},nt,{key:function(e){if(e.key){var t=Xo[e.key]||e.key;if(t!=="Unidentified")return t}return e.type==="keypress"?(e=v(e),e===13?"Enter":String.fromCharCode(e)):e.type==="keydown"||e.type==="keyup"?Nl[e.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:Ei,charCode:function(e){return e.type==="keypress"?v(e):0},keyCode:function(e){return e.type==="keydown"||e.type==="keyup"?e.keyCode:0},which:function(e){return e.type==="keypress"?v(e):e.type==="keydown"||e.type==="keyup"?e.keyCode:0}}),nc=ne(tc),ac=y({},Zr,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),_l=ne(ac),kl=y({},nt,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:Ei}),rc=ne(kl),sc=y({},Ee,{propertyName:0,elapsedTime:0,pseudoElement:0}),ic=ne(sc),lc=y({},Zr,{deltaX:function(e){return"deltaX"in e?e.deltaX:"wheelDeltaX"in e?-e.wheelDeltaX:0},deltaY:function(e){return"deltaY"in e?e.deltaY:"wheelDeltaY"in e?-e.wheelDeltaY:"wheelDelta"in e?-e.wheelDelta:0},deltaZ:0,deltaMode:0}),oc=ne(lc),cc=y({},Ee,{newState:0,oldState:0}),Al=ne(cc),uc=[9,13,27,32],ji=Jn&&"CompositionEvent"in window,Xr=null;Jn&&"documentMode"in document&&(Xr=document.documentMode);var ks=Jn&&"TextEvent"in window&&!Xr,Ni=Jn&&(!ji||Xr&&8<Xr&&11>=Xr),_i=" ",ge=!1;function ze(e,t){switch(e){case"keyup":return uc.indexOf(t.keyCode)!==-1;case"keydown":return t.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function Ve(e){return e=e.detail,typeof e=="object"&&"data"in e?e.data:null}var rt=!1;function dt(e,t){switch(e){case"compositionend":return Ve(t);case"keypress":return t.which!==32?null:(ge=!0,_i);case"textInput":return e=t.data,e===_i&&ge?null:e;default:return null}}function At(e,t){if(rt)return e==="compositionend"||!ji&&ze(e,t)?(e=p(),Kr=xr=un=null,rt=!1,e):null;switch(e){case"paste":return null;case"keypress":if(!(t.ctrlKey||t.altKey||t.metaKey)||t.ctrlKey&&t.altKey){if(t.char&&1<t.char.length)return t.char;if(t.which)return String.fromCharCode(t.which)}return null;case"compositionend":return Ni&&t.locale!=="ko"?null:t.data;default:return null}}var Ln={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function Nn(e){var t=e&&e.nodeName&&e.nodeName.toLowerCase();return t==="input"?!!Ln[e.type]:t==="textarea"}function bn(e,t,a,s){Ba?gr?gr.push(s):gr=[s]:Ba=s,t=xo(t,"onChange"),0<t.length&&(a=new De("onChange","change",null,a,s),e.push({event:a,listeners:t}))}var dn=null,qa=null;function Ha(e){vm(e,0)}function As(e){var t=cr(e);if(ws(t))return e}function Ld(e,t){if(e==="change")return t}var Bd=!1;if(Jn){var dc;if(Jn){var fc="oninput"in document;if(!fc){var Fd=document.createElement("div");Fd.setAttribute("oninput","return;"),fc=typeof Fd.oninput=="function"}dc=fc}else dc=!1;Bd=dc&&(!document.documentMode||9<document.documentMode)}function qd(){dn&&(dn.detachEvent("onpropertychange",Hd),qa=dn=null)}function Hd(e){if(e.propertyName==="value"&&As(qa)){var t=[];bn(t,qa,e,pr(e)),Vr(Ha,t)}}function wx(e,t,a){e==="focusin"?(qd(),dn=t,qa=a,dn.attachEvent("onpropertychange",Hd)):e==="focusout"&&qd()}function Sx(e){if(e==="selectionchange"||e==="keyup"||e==="keydown")return As(qa)}function Ex(e,t){if(e==="click")return As(t)}function jx(e,t){if(e==="input"||e==="change")return As(t)}function Nx(e,t){return e===t&&(e!==0||1/e===1/t)||e!==e&&t!==t}var Bn=typeof Object.is=="function"?Object.is:Nx;function ki(e,t){if(Bn(e,t))return!0;if(typeof e!="object"||e===null||typeof t!="object"||t===null)return!1;var a=Object.keys(e),s=Object.keys(t);if(a.length!==s.length)return!1;for(s=0;s<a.length;s++){var c=a[s];if(!ae.call(t,c)||!Bn(e[c],t[c]))return!1}return!0}function Gd(e){for(;e&&e.firstChild;)e=e.firstChild;return e}function Yd(e,t){var a=Gd(e);e=0;for(var s;a;){if(a.nodeType===3){if(s=e+a.textContent.length,e<=t&&s>=t)return{node:a,offset:t-e};e=s}e:{for(;a;){if(a.nextSibling){a=a.nextSibling;break e}a=a.parentNode}a=void 0}a=Gd(a)}}function Qd(e,t){return e&&t?e===t?!0:e&&e.nodeType===3?!1:t&&t.nodeType===3?Qd(e,t.parentNode):"contains"in e?e.contains(t):e.compareDocumentPosition?!!(e.compareDocumentPosition(t)&16):!1:!1}function $d(e){e=e!=null&&e.ownerDocument!=null&&e.ownerDocument.defaultView!=null?e.ownerDocument.defaultView:window;for(var t=Pn(e.document);t instanceof e.HTMLIFrameElement;){try{var a=typeof t.contentWindow.location.href=="string"}catch{a=!1}if(a)e=t.contentWindow;else break;t=Pn(e.document)}return t}function hc(e){var t=e&&e.nodeName&&e.nodeName.toLowerCase();return t&&(t==="input"&&(e.type==="text"||e.type==="search"||e.type==="tel"||e.type==="url"||e.type==="password")||t==="textarea"||e.contentEditable==="true")}var _x=Jn&&"documentMode"in document&&11>=document.documentMode,Ts=null,mc=null,Ai=null,pc=!1;function Pd(e,t,a){var s=a.window===a?a.document:a.nodeType===9?a:a.ownerDocument;pc||Ts==null||Ts!==Pn(s)||(s=Ts,"selectionStart"in s&&hc(s)?s={start:s.selectionStart,end:s.selectionEnd}:(s=(s.ownerDocument&&s.ownerDocument.defaultView||window).getSelection(),s={anchorNode:s.anchorNode,anchorOffset:s.anchorOffset,focusNode:s.focusNode,focusOffset:s.focusOffset}),Ai&&ki(Ai,s)||(Ai=s,s=xo(mc,"onSelect"),0<s.length&&(t=new De("onSelect","select",null,t,a),e.push({event:t,listeners:s}),t.target=Ts)))}function Wr(e,t){var a={};return a[e.toLowerCase()]=t.toLowerCase(),a["Webkit"+e]="webkit"+t,a["Moz"+e]="moz"+t,a}var Cs={animationend:Wr("Animation","AnimationEnd"),animationiteration:Wr("Animation","AnimationIteration"),animationstart:Wr("Animation","AnimationStart"),transitionrun:Wr("Transition","TransitionRun"),transitionstart:Wr("Transition","TransitionStart"),transitioncancel:Wr("Transition","TransitionCancel"),transitionend:Wr("Transition","TransitionEnd")},gc={},Jd={};Jn&&(Jd=document.createElement("div").style,"AnimationEvent"in window||(delete Cs.animationend.animation,delete Cs.animationiteration.animation,delete Cs.animationstart.animation),"TransitionEvent"in window||delete Cs.transitionend.transition);function es(e){if(gc[e])return gc[e];if(!Cs[e])return e;var t=Cs[e],a;for(a in t)if(t.hasOwnProperty(a)&&a in Jd)return gc[e]=t[a];return e}var Vd=es("animationend"),Kd=es("animationiteration"),Zd=es("animationstart"),kx=es("transitionrun"),Ax=es("transitionstart"),Tx=es("transitioncancel"),Xd=es("transitionend"),Wd=new Map,xc="abort auxClick beforeToggle cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");xc.push("scrollEnd");function ca(e,t){Wd.set(e,t),Sa(t,[e])}var Tl=typeof reportError=="function"?reportError:function(e){if(typeof window=="object"&&typeof window.ErrorEvent=="function"){var t=new window.ErrorEvent("error",{bubbles:!0,cancelable:!0,message:typeof e=="object"&&e!==null&&typeof e.message=="string"?String(e.message):String(e),error:e});if(!window.dispatchEvent(t))return}else if(typeof process=="object"&&typeof process.emit=="function"){process.emit("uncaughtException",e);return}console.error(e)},Vn=[],Ds=0,yc=0;function Cl(){for(var e=Ds,t=yc=Ds=0;t<e;){var a=Vn[t];Vn[t++]=null;var s=Vn[t];Vn[t++]=null;var c=Vn[t];Vn[t++]=null;var h=Vn[t];if(Vn[t++]=null,s!==null&&c!==null){var T=s.pending;T===null?c.next=c:(c.next=T.next,T.next=c),s.pending=c}h!==0&&ef(a,c,h)}}function Dl(e,t,a,s){Vn[Ds++]=e,Vn[Ds++]=t,Vn[Ds++]=a,Vn[Ds++]=s,yc|=s,e.lanes|=s,e=e.alternate,e!==null&&(e.lanes|=s)}function bc(e,t,a,s){return Dl(e,t,a,s),Ol(e)}function ts(e,t){return Dl(e,null,null,t),Ol(e)}function ef(e,t,a){e.lanes|=a;var s=e.alternate;s!==null&&(s.lanes|=a);for(var c=!1,h=e.return;h!==null;)h.childLanes|=a,s=h.alternate,s!==null&&(s.childLanes|=a),h.tag===22&&(e=h.stateNode,e===null||e._visibility&1||(c=!0)),e=h,h=h.return;return e.tag===3?(h=e.stateNode,c&&t!==null&&(c=31-vt(a),e=h.hiddenUpdates,s=e[c],s===null?e[c]=[t]:s.push(t),t.lane=a|536870912),h):null}function Ol(e){if(50<Ki)throw Ki=0,Au=null,Error(u(185));for(var t=e.return;t!==null;)e=t,t=e.return;return e.tag===3?e.stateNode:null}var Os={};function Cx(e,t,a,s){this.tag=e,this.key=a,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.refCleanup=this.ref=null,this.pendingProps=t,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=s,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function Fn(e,t,a,s){return new Cx(e,t,a,s)}function vc(e){return e=e.prototype,!(!e||!e.isReactComponent)}function Ga(e,t){var a=e.alternate;return a===null?(a=Fn(e.tag,t,e.key,e.mode),a.elementType=e.elementType,a.type=e.type,a.stateNode=e.stateNode,a.alternate=e,e.alternate=a):(a.pendingProps=t,a.type=e.type,a.flags=0,a.subtreeFlags=0,a.deletions=null),a.flags=e.flags&65011712,a.childLanes=e.childLanes,a.lanes=e.lanes,a.child=e.child,a.memoizedProps=e.memoizedProps,a.memoizedState=e.memoizedState,a.updateQueue=e.updateQueue,t=e.dependencies,a.dependencies=t===null?null:{lanes:t.lanes,firstContext:t.firstContext},a.sibling=e.sibling,a.index=e.index,a.ref=e.ref,a.refCleanup=e.refCleanup,a}function tf(e,t){e.flags&=65011714;var a=e.alternate;return a===null?(e.childLanes=0,e.lanes=t,e.child=null,e.subtreeFlags=0,e.memoizedProps=null,e.memoizedState=null,e.updateQueue=null,e.dependencies=null,e.stateNode=null):(e.childLanes=a.childLanes,e.lanes=a.lanes,e.child=a.child,e.subtreeFlags=0,e.deletions=null,e.memoizedProps=a.memoizedProps,e.memoizedState=a.memoizedState,e.updateQueue=a.updateQueue,e.type=a.type,t=a.dependencies,e.dependencies=t===null?null:{lanes:t.lanes,firstContext:t.firstContext}),e}function Il(e,t,a,s,c,h){var T=0;if(s=e,typeof e=="function")vc(e)&&(T=1);else if(typeof e=="string")T=My(e,a,ie.current)?26:e==="html"||e==="head"||e==="body"?27:5;else e:switch(e){case Y:return e=Fn(31,a,t,c),e.elementType=Y,e.lanes=h,e;case w:return ns(a.children,c,h,t);case N:T=8,c|=24;break;case S:return e=Fn(12,a,t,c|2),e.elementType=S,e.lanes=h,e;case R:return e=Fn(13,a,t,c),e.elementType=R,e.lanes=h,e;case $:return e=Fn(19,a,t,c),e.elementType=$,e.lanes=h,e;default:if(typeof e=="object"&&e!==null)switch(e.$$typeof){case C:T=10;break e;case O:T=9;break e;case M:T=11;break e;case X:T=14;break e;case J:T=16,s=null;break e}T=29,a=Error(u(130,e===null?"null":typeof e,"")),s=null}return t=Fn(T,a,t,c),t.elementType=e,t.type=s,t.lanes=h,t}function ns(e,t,a,s){return e=Fn(7,e,s,t),e.lanes=a,e}function wc(e,t,a){return e=Fn(6,e,null,t),e.lanes=a,e}function nf(e){var t=Fn(18,null,null,0);return t.stateNode=e,t}function Sc(e,t,a){return t=Fn(4,e.children!==null?e.children:[],e.key,t),t.lanes=a,t.stateNode={containerInfo:e.containerInfo,pendingChildren:null,implementation:e.implementation},t}var af=new WeakMap;function Kn(e,t){if(typeof e=="object"&&e!==null){var a=af.get(e);return a!==void 0?a:(t={value:e,source:t,stack:P(t)},af.set(e,t),t)}return{value:e,source:t,stack:P(t)}}var Is=[],Rs=0,Rl=null,Ti=0,Zn=[],Xn=0,yr=null,Na=1,_a="";function Ya(e,t){Is[Rs++]=Ti,Is[Rs++]=Rl,Rl=e,Ti=t}function rf(e,t,a){Zn[Xn++]=Na,Zn[Xn++]=_a,Zn[Xn++]=yr,yr=e;var s=Na;e=_a;var c=32-vt(s)-1;s&=~(1<<c),a+=1;var h=32-vt(t)+c;if(30<h){var T=c-c%5;h=(s&(1<<T)-1).toString(32),s>>=T,c-=T,Na=1<<32-vt(t)+c|a<<c|s,_a=h+e}else Na=1<<h|a<<c|s,_a=e}function Ec(e){e.return!==null&&(Ya(e,1),rf(e,1,0))}function jc(e){for(;e===Rl;)Rl=Is[--Rs],Is[Rs]=null,Ti=Is[--Rs],Is[Rs]=null;for(;e===yr;)yr=Zn[--Xn],Zn[Xn]=null,_a=Zn[--Xn],Zn[Xn]=null,Na=Zn[--Xn],Zn[Xn]=null}function sf(e,t){Zn[Xn++]=Na,Zn[Xn++]=_a,Zn[Xn++]=yr,Na=t.id,_a=t.overflow,yr=e}var fn=null,Ut=null,bt=!1,br=null,Wn=!1,Nc=Error(u(519));function vr(e){var t=Error(u(418,1<arguments.length&&arguments[1]!==void 0&&arguments[1]?"text":"HTML",""));throw Ci(Kn(t,e)),Nc}function lf(e){var t=e.stateNode,a=e.type,s=e.memoizedProps;switch(t[nn]=e,t[Nt]=s,a){case"dialog":ht("cancel",t),ht("close",t);break;case"iframe":case"object":case"embed":ht("load",t);break;case"video":case"audio":for(a=0;a<Xi.length;a++)ht(Xi[a],t);break;case"source":ht("error",t);break;case"img":case"image":case"link":ht("error",t),ht("load",t);break;case"details":ht("toggle",t);break;case"input":ht("invalid",t),dr(t,s.value,s.defaultValue,s.checked,s.defaultChecked,s.type,s.name,!0);break;case"select":ht("invalid",t);break;case"textarea":ht("invalid",t),Es(t,s.value,s.defaultValue,s.children)}a=s.children,typeof a!="string"&&typeof a!="number"&&typeof a!="bigint"||t.textContent===""+a||s.suppressHydrationWarning===!0||jm(t.textContent,a)?(s.popover!=null&&(ht("beforetoggle",t),ht("toggle",t)),s.onScroll!=null&&ht("scroll",t),s.onScrollEnd!=null&&ht("scrollend",t),s.onClick!=null&&(t.onclick=an),t=!0):t=!1,t||vr(e,!0)}function of(e){for(fn=e.return;fn;)switch(fn.tag){case 5:case 31:case 13:Wn=!1;return;case 27:case 3:Wn=!0;return;default:fn=fn.return}}function Ms(e){if(e!==fn)return!1;if(!bt)return of(e),bt=!0,!1;var t=e.tag,a;if((a=t!==3&&t!==27)&&((a=t===5)&&(a=e.type,a=!(a!=="form"&&a!=="button")||Gu(e.type,e.memoizedProps)),a=!a),a&&Ut&&vr(e),of(e),t===13){if(e=e.memoizedState,e=e!==null?e.dehydrated:null,!e)throw Error(u(317));Ut=Im(e)}else if(t===31){if(e=e.memoizedState,e=e!==null?e.dehydrated:null,!e)throw Error(u(317));Ut=Im(e)}else t===27?(t=Ut,Rr(e.type)?(e=Ju,Ju=null,Ut=e):Ut=t):Ut=fn?ta(e.stateNode.nextSibling):null;return!0}function as(){Ut=fn=null,bt=!1}function _c(){var e=br;return e!==null&&(On===null?On=e:On.push.apply(On,e),br=null),e}function Ci(e){br===null?br=[e]:br.push(e)}var kc=E(null),rs=null,Qa=null;function wr(e,t,a){se(kc,t._currentValue),t._currentValue=a}function $a(e){e._currentValue=kc.current,L(kc)}function Ac(e,t,a){for(;e!==null;){var s=e.alternate;if((e.childLanes&t)!==t?(e.childLanes|=t,s!==null&&(s.childLanes|=t)):s!==null&&(s.childLanes&t)!==t&&(s.childLanes|=t),e===a)break;e=e.return}}function Tc(e,t,a,s){var c=e.child;for(c!==null&&(c.return=e);c!==null;){var h=c.dependencies;if(h!==null){var T=c.child;h=h.firstContext;e:for(;h!==null;){var F=h;h=c;for(var re=0;re<t.length;re++)if(F.context===t[re]){h.lanes|=a,F=h.alternate,F!==null&&(F.lanes|=a),Ac(h.return,a,e),s||(T=null);break e}h=F.next}}else if(c.tag===18){if(T=c.return,T===null)throw Error(u(341));T.lanes|=a,h=T.alternate,h!==null&&(h.lanes|=a),Ac(T,a,e),T=null}else T=c.child;if(T!==null)T.return=c;else for(T=c;T!==null;){if(T===e){T=null;break}if(c=T.sibling,c!==null){c.return=T.return,T=c;break}T=T.return}c=T}}function Us(e,t,a,s){e=null;for(var c=t,h=!1;c!==null;){if(!h){if((c.flags&524288)!==0)h=!0;else if((c.flags&262144)!==0)break}if(c.tag===10){var T=c.alternate;if(T===null)throw Error(u(387));if(T=T.memoizedProps,T!==null){var F=c.type;Bn(c.pendingProps.value,T.value)||(e!==null?e.push(F):e=[F])}}else if(c===we.current){if(T=c.alternate,T===null)throw Error(u(387));T.memoizedState.memoizedState!==c.memoizedState.memoizedState&&(e!==null?e.push(al):e=[al])}c=c.return}e!==null&&Tc(t,e,a,s),t.flags|=262144}function Ml(e){for(e=e.firstContext;e!==null;){if(!Bn(e.context._currentValue,e.memoizedValue))return!0;e=e.next}return!1}function ss(e){rs=e,Qa=null,e=e.dependencies,e!==null&&(e.firstContext=null)}function hn(e){return cf(rs,e)}function Ul(e,t){return rs===null&&ss(e),cf(e,t)}function cf(e,t){var a=t._currentValue;if(t={context:t,memoizedValue:a,next:null},Qa===null){if(e===null)throw Error(u(308));Qa=t,e.dependencies={lanes:0,firstContext:t},e.flags|=524288}else Qa=Qa.next=t;return a}var Dx=typeof AbortController<"u"?AbortController:function(){var e=[],t=this.signal={aborted:!1,addEventListener:function(a,s){e.push(s)}};this.abort=function(){t.aborted=!0,e.forEach(function(a){return a()})}},Ox=r.unstable_scheduleCallback,Ix=r.unstable_NormalPriority,Zt={$$typeof:C,Consumer:null,Provider:null,_currentValue:null,_currentValue2:null,_threadCount:0};function Cc(){return{controller:new Dx,data:new Map,refCount:0}}function Di(e){e.refCount--,e.refCount===0&&Ox(Ix,function(){e.controller.abort()})}var Oi=null,Dc=0,zs=0,Ls=null;function Rx(e,t){if(Oi===null){var a=Oi=[];Dc=0,zs=Ru(),Ls={status:"pending",value:void 0,then:function(s){a.push(s)}}}return Dc++,t.then(uf,uf),t}function uf(){if(--Dc===0&&Oi!==null){Ls!==null&&(Ls.status="fulfilled");var e=Oi;Oi=null,zs=0,Ls=null;for(var t=0;t<e.length;t++)(0,e[t])()}}function Mx(e,t){var a=[],s={status:"pending",value:null,reason:null,then:function(c){a.push(c)}};return e.then(function(){s.status="fulfilled",s.value=t;for(var c=0;c<a.length;c++)(0,a[c])(t)},function(c){for(s.status="rejected",s.reason=c,c=0;c<a.length;c++)(0,a[c])(void 0)}),s}var df=z.S;z.S=function(e,t){Jh=Le(),typeof t=="object"&&t!==null&&typeof t.then=="function"&&Rx(e,t),df!==null&&df(e,t)};var is=E(null);function Oc(){var e=is.current;return e!==null?e:It.pooledCache}function zl(e,t){t===null?se(is,is.current):se(is,t.pool)}function ff(){var e=Oc();return e===null?null:{parent:Zt._currentValue,pool:e}}var Bs=Error(u(460)),Ic=Error(u(474)),Ll=Error(u(542)),Bl={then:function(){}};function hf(e){return e=e.status,e==="fulfilled"||e==="rejected"}function mf(e,t,a){switch(a=e[a],a===void 0?e.push(t):a!==t&&(t.then(an,an),t=a),t.status){case"fulfilled":return t.value;case"rejected":throw e=t.reason,gf(e),e;default:if(typeof t.status=="string")t.then(an,an);else{if(e=It,e!==null&&100<e.shellSuspendCounter)throw Error(u(482));e=t,e.status="pending",e.then(function(s){if(t.status==="pending"){var c=t;c.status="fulfilled",c.value=s}},function(s){if(t.status==="pending"){var c=t;c.status="rejected",c.reason=s}})}switch(t.status){case"fulfilled":return t.value;case"rejected":throw e=t.reason,gf(e),e}throw os=t,Bs}}function ls(e){try{var t=e._init;return t(e._payload)}catch(a){throw a!==null&&typeof a=="object"&&typeof a.then=="function"?(os=a,Bs):a}}var os=null;function pf(){if(os===null)throw Error(u(459));var e=os;return os=null,e}function gf(e){if(e===Bs||e===Ll)throw Error(u(483))}var Fs=null,Ii=0;function Fl(e){var t=Ii;return Ii+=1,Fs===null&&(Fs=[]),mf(Fs,e,t)}function Ri(e,t){t=t.props.ref,e.ref=t!==void 0?t:null}function ql(e,t){throw t.$$typeof===_?Error(u(525)):(e=Object.prototype.toString.call(t),Error(u(31,e==="[object Object]"?"object with keys {"+Object.keys(t).join(", ")+"}":e)))}function xf(e){function t(me,le){if(e){var ye=me.deletions;ye===null?(me.deletions=[le],me.flags|=16):ye.push(le)}}function a(me,le){if(!e)return null;for(;le!==null;)t(me,le),le=le.sibling;return null}function s(me){for(var le=new Map;me!==null;)me.key!==null?le.set(me.key,me):le.set(me.index,me),me=me.sibling;return le}function c(me,le){return me=Ga(me,le),me.index=0,me.sibling=null,me}function h(me,le,ye){return me.index=ye,e?(ye=me.alternate,ye!==null?(ye=ye.index,ye<le?(me.flags|=67108866,le):ye):(me.flags|=67108866,le)):(me.flags|=1048576,le)}function T(me){return e&&me.alternate===null&&(me.flags|=67108866),me}function F(me,le,ye,Oe){return le===null||le.tag!==6?(le=wc(ye,me.mode,Oe),le.return=me,le):(le=c(le,ye),le.return=me,le)}function re(me,le,ye,Oe){var tt=ye.type;return tt===w?Te(me,le,ye.props.children,Oe,ye.key):le!==null&&(le.elementType===tt||typeof tt=="object"&&tt!==null&&tt.$$typeof===J&&ls(tt)===le.type)?(le=c(le,ye.props),Ri(le,ye),le.return=me,le):(le=Il(ye.type,ye.key,ye.props,null,me.mode,Oe),Ri(le,ye),le.return=me,le)}function be(me,le,ye,Oe){return le===null||le.tag!==4||le.stateNode.containerInfo!==ye.containerInfo||le.stateNode.implementation!==ye.implementation?(le=Sc(ye,me.mode,Oe),le.return=me,le):(le=c(le,ye.children||[]),le.return=me,le)}function Te(me,le,ye,Oe,tt){return le===null||le.tag!==7?(le=ns(ye,me.mode,Oe,tt),le.return=me,le):(le=c(le,ye),le.return=me,le)}function Ie(me,le,ye){if(typeof le=="string"&&le!==""||typeof le=="number"||typeof le=="bigint")return le=wc(""+le,me.mode,ye),le.return=me,le;if(typeof le=="object"&&le!==null){switch(le.$$typeof){case b:return ye=Il(le.type,le.key,le.props,null,me.mode,ye),Ri(ye,le),ye.return=me,ye;case D:return le=Sc(le,me.mode,ye),le.return=me,le;case J:return le=ls(le),Ie(me,le,ye)}if(B(le)||q(le))return le=ns(le,me.mode,ye,null),le.return=me,le;if(typeof le.then=="function")return Ie(me,Fl(le),ye);if(le.$$typeof===C)return Ie(me,Ul(me,le),ye);ql(me,le)}return null}function Se(me,le,ye,Oe){var tt=le!==null?le.key:null;if(typeof ye=="string"&&ye!==""||typeof ye=="number"||typeof ye=="bigint")return tt!==null?null:F(me,le,""+ye,Oe);if(typeof ye=="object"&&ye!==null){switch(ye.$$typeof){case b:return ye.key===tt?re(me,le,ye,Oe):null;case D:return ye.key===tt?be(me,le,ye,Oe):null;case J:return ye=ls(ye),Se(me,le,ye,Oe)}if(B(ye)||q(ye))return tt!==null?null:Te(me,le,ye,Oe,null);if(typeof ye.then=="function")return Se(me,le,Fl(ye),Oe);if(ye.$$typeof===C)return Se(me,le,Ul(me,ye),Oe);ql(me,ye)}return null}function ke(me,le,ye,Oe,tt){if(typeof Oe=="string"&&Oe!==""||typeof Oe=="number"||typeof Oe=="bigint")return me=me.get(ye)||null,F(le,me,""+Oe,tt);if(typeof Oe=="object"&&Oe!==null){switch(Oe.$$typeof){case b:return me=me.get(Oe.key===null?ye:Oe.key)||null,re(le,me,Oe,tt);case D:return me=me.get(Oe.key===null?ye:Oe.key)||null,be(le,me,Oe,tt);case J:return Oe=ls(Oe),ke(me,le,ye,Oe,tt)}if(B(Oe)||q(Oe))return me=me.get(ye)||null,Te(le,me,Oe,tt,null);if(typeof Oe.then=="function")return ke(me,le,ye,Fl(Oe),tt);if(Oe.$$typeof===C)return ke(me,le,ye,Ul(le,Oe),tt);ql(le,Oe)}return null}function $e(me,le,ye,Oe){for(var tt=null,St=null,Ke=le,ut=le=0,gt=null;Ke!==null&&ut<ye.length;ut++){Ke.index>ut?(gt=Ke,Ke=null):gt=Ke.sibling;var Et=Se(me,Ke,ye[ut],Oe);if(Et===null){Ke===null&&(Ke=gt);break}e&&Ke&&Et.alternate===null&&t(me,Ke),le=h(Et,le,ut),St===null?tt=Et:St.sibling=Et,St=Et,Ke=gt}if(ut===ye.length)return a(me,Ke),bt&&Ya(me,ut),tt;if(Ke===null){for(;ut<ye.length;ut++)Ke=Ie(me,ye[ut],Oe),Ke!==null&&(le=h(Ke,le,ut),St===null?tt=Ke:St.sibling=Ke,St=Ke);return bt&&Ya(me,ut),tt}for(Ke=s(Ke);ut<ye.length;ut++)gt=ke(Ke,me,ut,ye[ut],Oe),gt!==null&&(e&&gt.alternate!==null&&Ke.delete(gt.key===null?ut:gt.key),le=h(gt,le,ut),St===null?tt=gt:St.sibling=gt,St=gt);return e&&Ke.forEach(function(Br){return t(me,Br)}),bt&&Ya(me,ut),tt}function st(me,le,ye,Oe){if(ye==null)throw Error(u(151));for(var tt=null,St=null,Ke=le,ut=le=0,gt=null,Et=ye.next();Ke!==null&&!Et.done;ut++,Et=ye.next()){Ke.index>ut?(gt=Ke,Ke=null):gt=Ke.sibling;var Br=Se(me,Ke,Et.value,Oe);if(Br===null){Ke===null&&(Ke=gt);break}e&&Ke&&Br.alternate===null&&t(me,Ke),le=h(Br,le,ut),St===null?tt=Br:St.sibling=Br,St=Br,Ke=gt}if(Et.done)return a(me,Ke),bt&&Ya(me,ut),tt;if(Ke===null){for(;!Et.done;ut++,Et=ye.next())Et=Ie(me,Et.value,Oe),Et!==null&&(le=h(Et,le,ut),St===null?tt=Et:St.sibling=Et,St=Et);return bt&&Ya(me,ut),tt}for(Ke=s(Ke);!Et.done;ut++,Et=ye.next())Et=ke(Ke,me,ut,Et.value,Oe),Et!==null&&(e&&Et.alternate!==null&&Ke.delete(Et.key===null?ut:Et.key),le=h(Et,le,ut),St===null?tt=Et:St.sibling=Et,St=Et);return e&&Ke.forEach(function($y){return t(me,$y)}),bt&&Ya(me,ut),tt}function Dt(me,le,ye,Oe){if(typeof ye=="object"&&ye!==null&&ye.type===w&&ye.key===null&&(ye=ye.props.children),typeof ye=="object"&&ye!==null){switch(ye.$$typeof){case b:e:{for(var tt=ye.key;le!==null;){if(le.key===tt){if(tt=ye.type,tt===w){if(le.tag===7){a(me,le.sibling),Oe=c(le,ye.props.children),Oe.return=me,me=Oe;break e}}else if(le.elementType===tt||typeof tt=="object"&&tt!==null&&tt.$$typeof===J&&ls(tt)===le.type){a(me,le.sibling),Oe=c(le,ye.props),Ri(Oe,ye),Oe.return=me,me=Oe;break e}a(me,le);break}else t(me,le);le=le.sibling}ye.type===w?(Oe=ns(ye.props.children,me.mode,Oe,ye.key),Oe.return=me,me=Oe):(Oe=Il(ye.type,ye.key,ye.props,null,me.mode,Oe),Ri(Oe,ye),Oe.return=me,me=Oe)}return T(me);case D:e:{for(tt=ye.key;le!==null;){if(le.key===tt)if(le.tag===4&&le.stateNode.containerInfo===ye.containerInfo&&le.stateNode.implementation===ye.implementation){a(me,le.sibling),Oe=c(le,ye.children||[]),Oe.return=me,me=Oe;break e}else{a(me,le);break}else t(me,le);le=le.sibling}Oe=Sc(ye,me.mode,Oe),Oe.return=me,me=Oe}return T(me);case J:return ye=ls(ye),Dt(me,le,ye,Oe)}if(B(ye))return $e(me,le,ye,Oe);if(q(ye)){if(tt=q(ye),typeof tt!="function")throw Error(u(150));return ye=tt.call(ye),st(me,le,ye,Oe)}if(typeof ye.then=="function")return Dt(me,le,Fl(ye),Oe);if(ye.$$typeof===C)return Dt(me,le,Ul(me,ye),Oe);ql(me,ye)}return typeof ye=="string"&&ye!==""||typeof ye=="number"||typeof ye=="bigint"?(ye=""+ye,le!==null&&le.tag===6?(a(me,le.sibling),Oe=c(le,ye),Oe.return=me,me=Oe):(a(me,le),Oe=wc(ye,me.mode,Oe),Oe.return=me,me=Oe),T(me)):a(me,le)}return function(me,le,ye,Oe){try{Ii=0;var tt=Dt(me,le,ye,Oe);return Fs=null,tt}catch(Ke){if(Ke===Bs||Ke===Ll)throw Ke;var St=Fn(29,Ke,null,me.mode);return St.lanes=Oe,St.return=me,St}finally{}}}var cs=xf(!0),yf=xf(!1),Sr=!1;function Rc(e){e.updateQueue={baseState:e.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,lanes:0,hiddenCallbacks:null},callbacks:null}}function Mc(e,t){e=e.updateQueue,t.updateQueue===e&&(t.updateQueue={baseState:e.baseState,firstBaseUpdate:e.firstBaseUpdate,lastBaseUpdate:e.lastBaseUpdate,shared:e.shared,callbacks:null})}function Er(e){return{lane:e,tag:0,payload:null,callback:null,next:null}}function jr(e,t,a){var s=e.updateQueue;if(s===null)return null;if(s=s.shared,(jt&2)!==0){var c=s.pending;return c===null?t.next=t:(t.next=c.next,c.next=t),s.pending=t,t=Ol(e),ef(e,null,a),t}return Dl(e,s,t,a),Ol(e)}function Mi(e,t,a){if(t=t.updateQueue,t!==null&&(t=t.shared,(a&4194048)!==0)){var s=t.lanes;s&=e.pendingLanes,a|=s,t.lanes=a,va(e,a)}}function Uc(e,t){var a=e.updateQueue,s=e.alternate;if(s!==null&&(s=s.updateQueue,a===s)){var c=null,h=null;if(a=a.firstBaseUpdate,a!==null){do{var T={lane:a.lane,tag:a.tag,payload:a.payload,callback:null,next:null};h===null?c=h=T:h=h.next=T,a=a.next}while(a!==null);h===null?c=h=t:h=h.next=t}else c=h=t;a={baseState:s.baseState,firstBaseUpdate:c,lastBaseUpdate:h,shared:s.shared,callbacks:s.callbacks},e.updateQueue=a;return}e=a.lastBaseUpdate,e===null?a.firstBaseUpdate=t:e.next=t,a.lastBaseUpdate=t}var zc=!1;function Ui(){if(zc){var e=Ls;if(e!==null)throw e}}function zi(e,t,a,s){zc=!1;var c=e.updateQueue;Sr=!1;var h=c.firstBaseUpdate,T=c.lastBaseUpdate,F=c.shared.pending;if(F!==null){c.shared.pending=null;var re=F,be=re.next;re.next=null,T===null?h=be:T.next=be,T=re;var Te=e.alternate;Te!==null&&(Te=Te.updateQueue,F=Te.lastBaseUpdate,F!==T&&(F===null?Te.firstBaseUpdate=be:F.next=be,Te.lastBaseUpdate=re))}if(h!==null){var Ie=c.baseState;T=0,Te=be=re=null,F=h;do{var Se=F.lane&-536870913,ke=Se!==F.lane;if(ke?(pt&Se)===Se:(s&Se)===Se){Se!==0&&Se===zs&&(zc=!0),Te!==null&&(Te=Te.next={lane:0,tag:F.tag,payload:F.payload,callback:null,next:null});e:{var $e=e,st=F;Se=t;var Dt=a;switch(st.tag){case 1:if($e=st.payload,typeof $e=="function"){Ie=$e.call(Dt,Ie,Se);break e}Ie=$e;break e;case 3:$e.flags=$e.flags&-65537|128;case 0:if($e=st.payload,Se=typeof $e=="function"?$e.call(Dt,Ie,Se):$e,Se==null)break e;Ie=y({},Ie,Se);break e;case 2:Sr=!0}}Se=F.callback,Se!==null&&(e.flags|=64,ke&&(e.flags|=8192),ke=c.callbacks,ke===null?c.callbacks=[Se]:ke.push(Se))}else ke={lane:Se,tag:F.tag,payload:F.payload,callback:F.callback,next:null},Te===null?(be=Te=ke,re=Ie):Te=Te.next=ke,T|=Se;if(F=F.next,F===null){if(F=c.shared.pending,F===null)break;ke=F,F=ke.next,ke.next=null,c.lastBaseUpdate=ke,c.shared.pending=null}}while(!0);Te===null&&(re=Ie),c.baseState=re,c.firstBaseUpdate=be,c.lastBaseUpdate=Te,h===null&&(c.shared.lanes=0),Tr|=T,e.lanes=T,e.memoizedState=Ie}}function bf(e,t){if(typeof e!="function")throw Error(u(191,e));e.call(t)}function vf(e,t){var a=e.callbacks;if(a!==null)for(e.callbacks=null,e=0;e<a.length;e++)bf(a[e],t)}var qs=E(null),Hl=E(0);function wf(e,t){e=tr,se(Hl,e),se(qs,t),tr=e|t.baseLanes}function Lc(){se(Hl,tr),se(qs,qs.current)}function Bc(){tr=Hl.current,L(qs),L(Hl)}var qn=E(null),ea=null;function Nr(e){var t=e.alternate;se(Jt,Jt.current&1),se(qn,e),ea===null&&(t===null||qs.current!==null||t.memoizedState!==null)&&(ea=e)}function Fc(e){se(Jt,Jt.current),se(qn,e),ea===null&&(ea=e)}function Sf(e){e.tag===22?(se(Jt,Jt.current),se(qn,e),ea===null&&(ea=e)):_r()}function _r(){se(Jt,Jt.current),se(qn,qn.current)}function Hn(e){L(qn),ea===e&&(ea=null),L(Jt)}var Jt=E(0);function Gl(e){for(var t=e;t!==null;){if(t.tag===13){var a=t.memoizedState;if(a!==null&&(a=a.dehydrated,a===null||$u(a)||Pu(a)))return t}else if(t.tag===19&&(t.memoizedProps.revealOrder==="forwards"||t.memoizedProps.revealOrder==="backwards"||t.memoizedProps.revealOrder==="unstable_legacy-backwards"||t.memoizedProps.revealOrder==="together")){if((t.flags&128)!==0)return t}else if(t.child!==null){t.child.return=t,t=t.child;continue}if(t===e)break;for(;t.sibling===null;){if(t.return===null||t.return===e)return null;t=t.return}t.sibling.return=t.return,t=t.sibling}return null}var Pa=0,ct=null,Tt=null,Xt=null,Yl=!1,Hs=!1,us=!1,Ql=0,Li=0,Gs=null,Ux=0;function Qt(){throw Error(u(321))}function qc(e,t){if(t===null)return!1;for(var a=0;a<t.length&&a<e.length;a++)if(!Bn(e[a],t[a]))return!1;return!0}function Hc(e,t,a,s,c,h){return Pa=h,ct=t,t.memoizedState=null,t.updateQueue=null,t.lanes=0,z.H=e===null||e.memoizedState===null?sh:au,us=!1,h=a(s,c),us=!1,Hs&&(h=jf(t,a,s,c)),Ef(e),h}function Ef(e){z.H=qi;var t=Tt!==null&&Tt.next!==null;if(Pa=0,Xt=Tt=ct=null,Yl=!1,Li=0,Gs=null,t)throw Error(u(300));e===null||Wt||(e=e.dependencies,e!==null&&Ml(e)&&(Wt=!0))}function jf(e,t,a,s){ct=e;var c=0;do{if(Hs&&(Gs=null),Li=0,Hs=!1,25<=c)throw Error(u(301));if(c+=1,Xt=Tt=null,e.updateQueue!=null){var h=e.updateQueue;h.lastEffect=null,h.events=null,h.stores=null,h.memoCache!=null&&(h.memoCache.index=0)}z.H=ih,h=t(a,s)}while(Hs);return h}function zx(){var e=z.H,t=e.useState()[0];return t=typeof t.then=="function"?Bi(t):t,e=e.useState()[0],(Tt!==null?Tt.memoizedState:null)!==e&&(ct.flags|=1024),t}function Gc(){var e=Ql!==0;return Ql=0,e}function Yc(e,t,a){t.updateQueue=e.updateQueue,t.flags&=-2053,e.lanes&=~a}function Qc(e){if(Yl){for(e=e.memoizedState;e!==null;){var t=e.queue;t!==null&&(t.pending=null),e=e.next}Yl=!1}Pa=0,Xt=Tt=ct=null,Hs=!1,Li=Ql=0,Gs=null}function _n(){var e={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return Xt===null?ct.memoizedState=Xt=e:Xt=Xt.next=e,Xt}function Vt(){if(Tt===null){var e=ct.alternate;e=e!==null?e.memoizedState:null}else e=Tt.next;var t=Xt===null?ct.memoizedState:Xt.next;if(t!==null)Xt=t,Tt=e;else{if(e===null)throw ct.alternate===null?Error(u(467)):Error(u(310));Tt=e,e={memoizedState:Tt.memoizedState,baseState:Tt.baseState,baseQueue:Tt.baseQueue,queue:Tt.queue,next:null},Xt===null?ct.memoizedState=Xt=e:Xt=Xt.next=e}return Xt}function $l(){return{lastEffect:null,events:null,stores:null,memoCache:null}}function Bi(e){var t=Li;return Li+=1,Gs===null&&(Gs=[]),e=mf(Gs,e,t),t=ct,(Xt===null?t.memoizedState:Xt.next)===null&&(t=t.alternate,z.H=t===null||t.memoizedState===null?sh:au),e}function Pl(e){if(e!==null&&typeof e=="object"){if(typeof e.then=="function")return Bi(e);if(e.$$typeof===C)return hn(e)}throw Error(u(438,String(e)))}function $c(e){var t=null,a=ct.updateQueue;if(a!==null&&(t=a.memoCache),t==null){var s=ct.alternate;s!==null&&(s=s.updateQueue,s!==null&&(s=s.memoCache,s!=null&&(t={data:s.data.map(function(c){return c.slice()}),index:0})))}if(t==null&&(t={data:[],index:0}),a===null&&(a=$l(),ct.updateQueue=a),a.memoCache=t,a=t.data[t.index],a===void 0)for(a=t.data[t.index]=Array(e),s=0;s<e;s++)a[s]=H;return t.index++,a}function Ja(e,t){return typeof t=="function"?t(e):t}function Jl(e){var t=Vt();return Pc(t,Tt,e)}function Pc(e,t,a){var s=e.queue;if(s===null)throw Error(u(311));s.lastRenderedReducer=a;var c=e.baseQueue,h=s.pending;if(h!==null){if(c!==null){var T=c.next;c.next=h.next,h.next=T}t.baseQueue=c=h,s.pending=null}if(h=e.baseState,c===null)e.memoizedState=h;else{t=c.next;var F=T=null,re=null,be=t,Te=!1;do{var Ie=be.lane&-536870913;if(Ie!==be.lane?(pt&Ie)===Ie:(Pa&Ie)===Ie){var Se=be.revertLane;if(Se===0)re!==null&&(re=re.next={lane:0,revertLane:0,gesture:null,action:be.action,hasEagerState:be.hasEagerState,eagerState:be.eagerState,next:null}),Ie===zs&&(Te=!0);else if((Pa&Se)===Se){be=be.next,Se===zs&&(Te=!0);continue}else Ie={lane:0,revertLane:be.revertLane,gesture:null,action:be.action,hasEagerState:be.hasEagerState,eagerState:be.eagerState,next:null},re===null?(F=re=Ie,T=h):re=re.next=Ie,ct.lanes|=Se,Tr|=Se;Ie=be.action,us&&a(h,Ie),h=be.hasEagerState?be.eagerState:a(h,Ie)}else Se={lane:Ie,revertLane:be.revertLane,gesture:be.gesture,action:be.action,hasEagerState:be.hasEagerState,eagerState:be.eagerState,next:null},re===null?(F=re=Se,T=h):re=re.next=Se,ct.lanes|=Ie,Tr|=Ie;be=be.next}while(be!==null&&be!==t);if(re===null?T=h:re.next=F,!Bn(h,e.memoizedState)&&(Wt=!0,Te&&(a=Ls,a!==null)))throw a;e.memoizedState=h,e.baseState=T,e.baseQueue=re,s.lastRenderedState=h}return c===null&&(s.lanes=0),[e.memoizedState,s.dispatch]}function Jc(e){var t=Vt(),a=t.queue;if(a===null)throw Error(u(311));a.lastRenderedReducer=e;var s=a.dispatch,c=a.pending,h=t.memoizedState;if(c!==null){a.pending=null;var T=c=c.next;do h=e(h,T.action),T=T.next;while(T!==c);Bn(h,t.memoizedState)||(Wt=!0),t.memoizedState=h,t.baseQueue===null&&(t.baseState=h),a.lastRenderedState=h}return[h,s]}function Nf(e,t,a){var s=ct,c=Vt(),h=bt;if(h){if(a===void 0)throw Error(u(407));a=a()}else a=t();var T=!Bn((Tt||c).memoizedState,a);if(T&&(c.memoizedState=a,Wt=!0),c=c.queue,Zc(Af.bind(null,s,c,e),[e]),c.getSnapshot!==t||T||Xt!==null&&Xt.memoizedState.tag&1){if(s.flags|=2048,Ys(9,{destroy:void 0},kf.bind(null,s,c,a,t),null),It===null)throw Error(u(349));h||(Pa&127)!==0||_f(s,t,a)}return a}function _f(e,t,a){e.flags|=16384,e={getSnapshot:t,value:a},t=ct.updateQueue,t===null?(t=$l(),ct.updateQueue=t,t.stores=[e]):(a=t.stores,a===null?t.stores=[e]:a.push(e))}function kf(e,t,a,s){t.value=a,t.getSnapshot=s,Tf(t)&&Cf(e)}function Af(e,t,a){return a(function(){Tf(t)&&Cf(e)})}function Tf(e){var t=e.getSnapshot;e=e.value;try{var a=t();return!Bn(e,a)}catch{return!0}}function Cf(e){var t=ts(e,2);t!==null&&In(t,e,2)}function Vc(e){var t=_n();if(typeof e=="function"){var a=e;if(e=a(),us){Rt(!0);try{a()}finally{Rt(!1)}}}return t.memoizedState=t.baseState=e,t.queue={pending:null,lanes:0,dispatch:null,lastRenderedReducer:Ja,lastRenderedState:e},t}function Df(e,t,a,s){return e.baseState=a,Pc(e,Tt,typeof s=="function"?s:Ja)}function Lx(e,t,a,s,c){if(Zl(e))throw Error(u(485));if(e=t.action,e!==null){var h={payload:c,action:e,next:null,isTransition:!0,status:"pending",value:null,reason:null,listeners:[],then:function(T){h.listeners.push(T)}};z.T!==null?a(!0):h.isTransition=!1,s(h),a=t.pending,a===null?(h.next=t.pending=h,Of(t,h)):(h.next=a.next,t.pending=a.next=h)}}function Of(e,t){var a=t.action,s=t.payload,c=e.state;if(t.isTransition){var h=z.T,T={};z.T=T;try{var F=a(c,s),re=z.S;re!==null&&re(T,F),If(e,t,F)}catch(be){Kc(e,t,be)}finally{h!==null&&T.types!==null&&(h.types=T.types),z.T=h}}else try{h=a(c,s),If(e,t,h)}catch(be){Kc(e,t,be)}}function If(e,t,a){a!==null&&typeof a=="object"&&typeof a.then=="function"?a.then(function(s){Rf(e,t,s)},function(s){return Kc(e,t,s)}):Rf(e,t,a)}function Rf(e,t,a){t.status="fulfilled",t.value=a,Mf(t),e.state=a,t=e.pending,t!==null&&(a=t.next,a===t?e.pending=null:(a=a.next,t.next=a,Of(e,a)))}function Kc(e,t,a){var s=e.pending;if(e.pending=null,s!==null){s=s.next;do t.status="rejected",t.reason=a,Mf(t),t=t.next;while(t!==s)}e.action=null}function Mf(e){e=e.listeners;for(var t=0;t<e.length;t++)(0,e[t])()}function Uf(e,t){return t}function zf(e,t){if(bt){var a=It.formState;if(a!==null){e:{var s=ct;if(bt){if(Ut){t:{for(var c=Ut,h=Wn;c.nodeType!==8;){if(!h){c=null;break t}if(c=ta(c.nextSibling),c===null){c=null;break t}}h=c.data,c=h==="F!"||h==="F"?c:null}if(c){Ut=ta(c.nextSibling),s=c.data==="F!";break e}}vr(s)}s=!1}s&&(t=a[0])}}return a=_n(),a.memoizedState=a.baseState=t,s={pending:null,lanes:0,dispatch:null,lastRenderedReducer:Uf,lastRenderedState:t},a.queue=s,a=nh.bind(null,ct,s),s.dispatch=a,s=Vc(!1),h=nu.bind(null,ct,!1,s.queue),s=_n(),c={state:t,dispatch:null,action:e,pending:null},s.queue=c,a=Lx.bind(null,ct,c,h,a),c.dispatch=a,s.memoizedState=e,[t,a,!1]}function Lf(e){var t=Vt();return Bf(t,Tt,e)}function Bf(e,t,a){if(t=Pc(e,t,Uf)[0],e=Jl(Ja)[0],typeof t=="object"&&t!==null&&typeof t.then=="function")try{var s=Bi(t)}catch(T){throw T===Bs?Ll:T}else s=t;t=Vt();var c=t.queue,h=c.dispatch;return a!==t.memoizedState&&(ct.flags|=2048,Ys(9,{destroy:void 0},Bx.bind(null,c,a),null)),[s,h,e]}function Bx(e,t){e.action=t}function Ff(e){var t=Vt(),a=Tt;if(a!==null)return Bf(t,a,e);Vt(),t=t.memoizedState,a=Vt();var s=a.queue.dispatch;return a.memoizedState=e,[t,s,!1]}function Ys(e,t,a,s){return e={tag:e,create:a,deps:s,inst:t,next:null},t=ct.updateQueue,t===null&&(t=$l(),ct.updateQueue=t),a=t.lastEffect,a===null?t.lastEffect=e.next=e:(s=a.next,a.next=e,e.next=s,t.lastEffect=e),e}function qf(){return Vt().memoizedState}function Vl(e,t,a,s){var c=_n();ct.flags|=e,c.memoizedState=Ys(1|t,{destroy:void 0},a,s===void 0?null:s)}function Kl(e,t,a,s){var c=Vt();s=s===void 0?null:s;var h=c.memoizedState.inst;Tt!==null&&s!==null&&qc(s,Tt.memoizedState.deps)?c.memoizedState=Ys(t,h,a,s):(ct.flags|=e,c.memoizedState=Ys(1|t,h,a,s))}function Hf(e,t){Vl(8390656,8,e,t)}function Zc(e,t){Kl(2048,8,e,t)}function Fx(e){ct.flags|=4;var t=ct.updateQueue;if(t===null)t=$l(),ct.updateQueue=t,t.events=[e];else{var a=t.events;a===null?t.events=[e]:a.push(e)}}function Gf(e){var t=Vt().memoizedState;return Fx({ref:t,nextImpl:e}),function(){if((jt&2)!==0)throw Error(u(440));return t.impl.apply(void 0,arguments)}}function Yf(e,t){return Kl(4,2,e,t)}function Qf(e,t){return Kl(4,4,e,t)}function $f(e,t){if(typeof t=="function"){e=e();var a=t(e);return function(){typeof a=="function"?a():t(null)}}if(t!=null)return e=e(),t.current=e,function(){t.current=null}}function Pf(e,t,a){a=a!=null?a.concat([e]):null,Kl(4,4,$f.bind(null,t,e),a)}function Xc(){}function Jf(e,t){var a=Vt();t=t===void 0?null:t;var s=a.memoizedState;return t!==null&&qc(t,s[1])?s[0]:(a.memoizedState=[e,t],e)}function Vf(e,t){var a=Vt();t=t===void 0?null:t;var s=a.memoizedState;if(t!==null&&qc(t,s[1]))return s[0];if(s=e(),us){Rt(!0);try{e()}finally{Rt(!1)}}return a.memoizedState=[s,t],s}function Wc(e,t,a){return a===void 0||(Pa&1073741824)!==0&&(pt&261930)===0?e.memoizedState=t:(e.memoizedState=a,e=Kh(),ct.lanes|=e,Tr|=e,a)}function Kf(e,t,a,s){return Bn(a,t)?a:qs.current!==null?(e=Wc(e,a,s),Bn(e,t)||(Wt=!0),e):(Pa&42)===0||(Pa&1073741824)!==0&&(pt&261930)===0?(Wt=!0,e.memoizedState=a):(e=Kh(),ct.lanes|=e,Tr|=e,t)}function Zf(e,t,a,s,c){var h=Q.p;Q.p=h!==0&&8>h?h:8;var T=z.T,F={};z.T=F,nu(e,!1,t,a);try{var re=c(),be=z.S;if(be!==null&&be(F,re),re!==null&&typeof re=="object"&&typeof re.then=="function"){var Te=Mx(re,s);Fi(e,t,Te,Qn(e))}else Fi(e,t,s,Qn(e))}catch(Ie){Fi(e,t,{then:function(){},status:"rejected",reason:Ie},Qn())}finally{Q.p=h,T!==null&&F.types!==null&&(T.types=F.types),z.T=T}}function qx(){}function eu(e,t,a,s){if(e.tag!==5)throw Error(u(476));var c=Xf(e).queue;Zf(e,c,t,ue,a===null?qx:function(){return Wf(e),a(s)})}function Xf(e){var t=e.memoizedState;if(t!==null)return t;t={memoizedState:ue,baseState:ue,baseQueue:null,queue:{pending:null,lanes:0,dispatch:null,lastRenderedReducer:Ja,lastRenderedState:ue},next:null};var a={};return t.next={memoizedState:a,baseState:a,baseQueue:null,queue:{pending:null,lanes:0,dispatch:null,lastRenderedReducer:Ja,lastRenderedState:a},next:null},e.memoizedState=t,e=e.alternate,e!==null&&(e.memoizedState=t),t}function Wf(e){var t=Xf(e);t.next===null&&(t=e.alternate.memoizedState),Fi(e,t.next.queue,{},Qn())}function tu(){return hn(al)}function eh(){return Vt().memoizedState}function th(){return Vt().memoizedState}function Hx(e){for(var t=e.return;t!==null;){switch(t.tag){case 24:case 3:var a=Qn();e=Er(a);var s=jr(t,e,a);s!==null&&(In(s,t,a),Mi(s,t,a)),t={cache:Cc()},e.payload=t;return}t=t.return}}function Gx(e,t,a){var s=Qn();a={lane:s,revertLane:0,gesture:null,action:a,hasEagerState:!1,eagerState:null,next:null},Zl(e)?ah(t,a):(a=bc(e,t,a,s),a!==null&&(In(a,e,s),rh(a,t,s)))}function nh(e,t,a){var s=Qn();Fi(e,t,a,s)}function Fi(e,t,a,s){var c={lane:s,revertLane:0,gesture:null,action:a,hasEagerState:!1,eagerState:null,next:null};if(Zl(e))ah(t,c);else{var h=e.alternate;if(e.lanes===0&&(h===null||h.lanes===0)&&(h=t.lastRenderedReducer,h!==null))try{var T=t.lastRenderedState,F=h(T,a);if(c.hasEagerState=!0,c.eagerState=F,Bn(F,T))return Dl(e,t,c,0),It===null&&Cl(),!1}catch{}finally{}if(a=bc(e,t,c,s),a!==null)return In(a,e,s),rh(a,t,s),!0}return!1}function nu(e,t,a,s){if(s={lane:2,revertLane:Ru(),gesture:null,action:s,hasEagerState:!1,eagerState:null,next:null},Zl(e)){if(t)throw Error(u(479))}else t=bc(e,a,s,2),t!==null&&In(t,e,2)}function Zl(e){var t=e.alternate;return e===ct||t!==null&&t===ct}function ah(e,t){Hs=Yl=!0;var a=e.pending;a===null?t.next=t:(t.next=a.next,a.next=t),e.pending=t}function rh(e,t,a){if((a&4194048)!==0){var s=t.lanes;s&=e.pendingLanes,a|=s,t.lanes=a,va(e,a)}}var qi={readContext:hn,use:Pl,useCallback:Qt,useContext:Qt,useEffect:Qt,useImperativeHandle:Qt,useLayoutEffect:Qt,useInsertionEffect:Qt,useMemo:Qt,useReducer:Qt,useRef:Qt,useState:Qt,useDebugValue:Qt,useDeferredValue:Qt,useTransition:Qt,useSyncExternalStore:Qt,useId:Qt,useHostTransitionStatus:Qt,useFormState:Qt,useActionState:Qt,useOptimistic:Qt,useMemoCache:Qt,useCacheRefresh:Qt};qi.useEffectEvent=Qt;var sh={readContext:hn,use:Pl,useCallback:function(e,t){return _n().memoizedState=[e,t===void 0?null:t],e},useContext:hn,useEffect:Hf,useImperativeHandle:function(e,t,a){a=a!=null?a.concat([e]):null,Vl(4194308,4,$f.bind(null,t,e),a)},useLayoutEffect:function(e,t){return Vl(4194308,4,e,t)},useInsertionEffect:function(e,t){Vl(4,2,e,t)},useMemo:function(e,t){var a=_n();t=t===void 0?null:t;var s=e();if(us){Rt(!0);try{e()}finally{Rt(!1)}}return a.memoizedState=[s,t],s},useReducer:function(e,t,a){var s=_n();if(a!==void 0){var c=a(t);if(us){Rt(!0);try{a(t)}finally{Rt(!1)}}}else c=t;return s.memoizedState=s.baseState=c,e={pending:null,lanes:0,dispatch:null,lastRenderedReducer:e,lastRenderedState:c},s.queue=e,e=e.dispatch=Gx.bind(null,ct,e),[s.memoizedState,e]},useRef:function(e){var t=_n();return e={current:e},t.memoizedState=e},useState:function(e){e=Vc(e);var t=e.queue,a=nh.bind(null,ct,t);return t.dispatch=a,[e.memoizedState,a]},useDebugValue:Xc,useDeferredValue:function(e,t){var a=_n();return Wc(a,e,t)},useTransition:function(){var e=Vc(!1);return e=Zf.bind(null,ct,e.queue,!0,!1),_n().memoizedState=e,[!1,e]},useSyncExternalStore:function(e,t,a){var s=ct,c=_n();if(bt){if(a===void 0)throw Error(u(407));a=a()}else{if(a=t(),It===null)throw Error(u(349));(pt&127)!==0||_f(s,t,a)}c.memoizedState=a;var h={value:a,getSnapshot:t};return c.queue=h,Hf(Af.bind(null,s,h,e),[e]),s.flags|=2048,Ys(9,{destroy:void 0},kf.bind(null,s,h,a,t),null),a},useId:function(){var e=_n(),t=It.identifierPrefix;if(bt){var a=_a,s=Na;a=(s&~(1<<32-vt(s)-1)).toString(32)+a,t="_"+t+"R_"+a,a=Ql++,0<a&&(t+="H"+a.toString(32)),t+="_"}else a=Ux++,t="_"+t+"r_"+a.toString(32)+"_";return e.memoizedState=t},useHostTransitionStatus:tu,useFormState:zf,useActionState:zf,useOptimistic:function(e){var t=_n();t.memoizedState=t.baseState=e;var a={pending:null,lanes:0,dispatch:null,lastRenderedReducer:null,lastRenderedState:null};return t.queue=a,t=nu.bind(null,ct,!0,a),a.dispatch=t,[e,t]},useMemoCache:$c,useCacheRefresh:function(){return _n().memoizedState=Hx.bind(null,ct)},useEffectEvent:function(e){var t=_n(),a={impl:e};return t.memoizedState=a,function(){if((jt&2)!==0)throw Error(u(440));return a.impl.apply(void 0,arguments)}}},au={readContext:hn,use:Pl,useCallback:Jf,useContext:hn,useEffect:Zc,useImperativeHandle:Pf,useInsertionEffect:Yf,useLayoutEffect:Qf,useMemo:Vf,useReducer:Jl,useRef:qf,useState:function(){return Jl(Ja)},useDebugValue:Xc,useDeferredValue:function(e,t){var a=Vt();return Kf(a,Tt.memoizedState,e,t)},useTransition:function(){var e=Jl(Ja)[0],t=Vt().memoizedState;return[typeof e=="boolean"?e:Bi(e),t]},useSyncExternalStore:Nf,useId:eh,useHostTransitionStatus:tu,useFormState:Lf,useActionState:Lf,useOptimistic:function(e,t){var a=Vt();return Df(a,Tt,e,t)},useMemoCache:$c,useCacheRefresh:th};au.useEffectEvent=Gf;var ih={readContext:hn,use:Pl,useCallback:Jf,useContext:hn,useEffect:Zc,useImperativeHandle:Pf,useInsertionEffect:Yf,useLayoutEffect:Qf,useMemo:Vf,useReducer:Jc,useRef:qf,useState:function(){return Jc(Ja)},useDebugValue:Xc,useDeferredValue:function(e,t){var a=Vt();return Tt===null?Wc(a,e,t):Kf(a,Tt.memoizedState,e,t)},useTransition:function(){var e=Jc(Ja)[0],t=Vt().memoizedState;return[typeof e=="boolean"?e:Bi(e),t]},useSyncExternalStore:Nf,useId:eh,useHostTransitionStatus:tu,useFormState:Ff,useActionState:Ff,useOptimistic:function(e,t){var a=Vt();return Tt!==null?Df(a,Tt,e,t):(a.baseState=e,[e,a.queue.dispatch])},useMemoCache:$c,useCacheRefresh:th};ih.useEffectEvent=Gf;function ru(e,t,a,s){t=e.memoizedState,a=a(s,t),a=a==null?t:y({},t,a),e.memoizedState=a,e.lanes===0&&(e.updateQueue.baseState=a)}var su={enqueueSetState:function(e,t,a){e=e._reactInternals;var s=Qn(),c=Er(s);c.payload=t,a!=null&&(c.callback=a),t=jr(e,c,s),t!==null&&(In(t,e,s),Mi(t,e,s))},enqueueReplaceState:function(e,t,a){e=e._reactInternals;var s=Qn(),c=Er(s);c.tag=1,c.payload=t,a!=null&&(c.callback=a),t=jr(e,c,s),t!==null&&(In(t,e,s),Mi(t,e,s))},enqueueForceUpdate:function(e,t){e=e._reactInternals;var a=Qn(),s=Er(a);s.tag=2,t!=null&&(s.callback=t),t=jr(e,s,a),t!==null&&(In(t,e,a),Mi(t,e,a))}};function lh(e,t,a,s,c,h,T){return e=e.stateNode,typeof e.shouldComponentUpdate=="function"?e.shouldComponentUpdate(s,h,T):t.prototype&&t.prototype.isPureReactComponent?!ki(a,s)||!ki(c,h):!0}function oh(e,t,a,s){e=t.state,typeof t.componentWillReceiveProps=="function"&&t.componentWillReceiveProps(a,s),typeof t.UNSAFE_componentWillReceiveProps=="function"&&t.UNSAFE_componentWillReceiveProps(a,s),t.state!==e&&su.enqueueReplaceState(t,t.state,null)}function ds(e,t){var a=t;if("ref"in t){a={};for(var s in t)s!=="ref"&&(a[s]=t[s])}if(e=e.defaultProps){a===t&&(a=y({},a));for(var c in e)a[c]===void 0&&(a[c]=e[c])}return a}function ch(e){Tl(e)}function uh(e){console.error(e)}function dh(e){Tl(e)}function Xl(e,t){try{var a=e.onUncaughtError;a(t.value,{componentStack:t.stack})}catch(s){setTimeout(function(){throw s})}}function fh(e,t,a){try{var s=e.onCaughtError;s(a.value,{componentStack:a.stack,errorBoundary:t.tag===1?t.stateNode:null})}catch(c){setTimeout(function(){throw c})}}function iu(e,t,a){return a=Er(a),a.tag=3,a.payload={element:null},a.callback=function(){Xl(e,t)},a}function hh(e){return e=Er(e),e.tag=3,e}function mh(e,t,a,s){var c=a.type.getDerivedStateFromError;if(typeof c=="function"){var h=s.value;e.payload=function(){return c(h)},e.callback=function(){fh(t,a,s)}}var T=a.stateNode;T!==null&&typeof T.componentDidCatch=="function"&&(e.callback=function(){fh(t,a,s),typeof c!="function"&&(Cr===null?Cr=new Set([this]):Cr.add(this));var F=s.stack;this.componentDidCatch(s.value,{componentStack:F!==null?F:""})})}function Yx(e,t,a,s,c){if(a.flags|=32768,s!==null&&typeof s=="object"&&typeof s.then=="function"){if(t=a.alternate,t!==null&&Us(t,a,c,!0),a=qn.current,a!==null){switch(a.tag){case 31:case 13:return ea===null?uo():a.alternate===null&&$t===0&&($t=3),a.flags&=-257,a.flags|=65536,a.lanes=c,s===Bl?a.flags|=16384:(t=a.updateQueue,t===null?a.updateQueue=new Set([s]):t.add(s),Du(e,s,c)),!1;case 22:return a.flags|=65536,s===Bl?a.flags|=16384:(t=a.updateQueue,t===null?(t={transitions:null,markerInstances:null,retryQueue:new Set([s])},a.updateQueue=t):(a=t.retryQueue,a===null?t.retryQueue=new Set([s]):a.add(s)),Du(e,s,c)),!1}throw Error(u(435,a.tag))}return Du(e,s,c),uo(),!1}if(bt)return t=qn.current,t!==null?((t.flags&65536)===0&&(t.flags|=256),t.flags|=65536,t.lanes=c,s!==Nc&&(e=Error(u(422),{cause:s}),Ci(Kn(e,a)))):(s!==Nc&&(t=Error(u(423),{cause:s}),Ci(Kn(t,a))),e=e.current.alternate,e.flags|=65536,c&=-c,e.lanes|=c,s=Kn(s,a),c=iu(e.stateNode,s,c),Uc(e,c),$t!==4&&($t=2)),!1;var h=Error(u(520),{cause:s});if(h=Kn(h,a),Vi===null?Vi=[h]:Vi.push(h),$t!==4&&($t=2),t===null)return!0;s=Kn(s,a),a=t;do{switch(a.tag){case 3:return a.flags|=65536,e=c&-c,a.lanes|=e,e=iu(a.stateNode,s,e),Uc(a,e),!1;case 1:if(t=a.type,h=a.stateNode,(a.flags&128)===0&&(typeof t.getDerivedStateFromError=="function"||h!==null&&typeof h.componentDidCatch=="function"&&(Cr===null||!Cr.has(h))))return a.flags|=65536,c&=-c,a.lanes|=c,c=hh(c),mh(c,e,a,s),Uc(a,c),!1}a=a.return}while(a!==null);return!1}var lu=Error(u(461)),Wt=!1;function mn(e,t,a,s){t.child=e===null?yf(t,null,a,s):cs(t,e.child,a,s)}function ph(e,t,a,s,c){a=a.render;var h=t.ref;if("ref"in s){var T={};for(var F in s)F!=="ref"&&(T[F]=s[F])}else T=s;return ss(t),s=Hc(e,t,a,T,h,c),F=Gc(),e!==null&&!Wt?(Yc(e,t,c),Va(e,t,c)):(bt&&F&&Ec(t),t.flags|=1,mn(e,t,s,c),t.child)}function gh(e,t,a,s,c){if(e===null){var h=a.type;return typeof h=="function"&&!vc(h)&&h.defaultProps===void 0&&a.compare===null?(t.tag=15,t.type=h,xh(e,t,h,s,c)):(e=Il(a.type,null,s,t,t.mode,c),e.ref=t.ref,e.return=t,t.child=e)}if(h=e.child,!pu(e,c)){var T=h.memoizedProps;if(a=a.compare,a=a!==null?a:ki,a(T,s)&&e.ref===t.ref)return Va(e,t,c)}return t.flags|=1,e=Ga(h,s),e.ref=t.ref,e.return=t,t.child=e}function xh(e,t,a,s,c){if(e!==null){var h=e.memoizedProps;if(ki(h,s)&&e.ref===t.ref)if(Wt=!1,t.pendingProps=s=h,pu(e,c))(e.flags&131072)!==0&&(Wt=!0);else return t.lanes=e.lanes,Va(e,t,c)}return ou(e,t,a,s,c)}function yh(e,t,a,s){var c=s.children,h=e!==null?e.memoizedState:null;if(e===null&&t.stateNode===null&&(t.stateNode={_visibility:1,_pendingMarkers:null,_retryCache:null,_transitions:null}),s.mode==="hidden"){if((t.flags&128)!==0){if(h=h!==null?h.baseLanes|a:a,e!==null){for(s=t.child=e.child,c=0;s!==null;)c=c|s.lanes|s.childLanes,s=s.sibling;s=c&~h}else s=0,t.child=null;return bh(e,t,h,a,s)}if((a&536870912)!==0)t.memoizedState={baseLanes:0,cachePool:null},e!==null&&zl(t,h!==null?h.cachePool:null),h!==null?wf(t,h):Lc(),Sf(t);else return s=t.lanes=536870912,bh(e,t,h!==null?h.baseLanes|a:a,a,s)}else h!==null?(zl(t,h.cachePool),wf(t,h),_r(),t.memoizedState=null):(e!==null&&zl(t,null),Lc(),_r());return mn(e,t,c,a),t.child}function Hi(e,t){return e!==null&&e.tag===22||t.stateNode!==null||(t.stateNode={_visibility:1,_pendingMarkers:null,_retryCache:null,_transitions:null}),t.sibling}function bh(e,t,a,s,c){var h=Oc();return h=h===null?null:{parent:Zt._currentValue,pool:h},t.memoizedState={baseLanes:a,cachePool:h},e!==null&&zl(t,null),Lc(),Sf(t),e!==null&&Us(e,t,s,!0),t.childLanes=c,null}function Wl(e,t){return t=to({mode:t.mode,children:t.children},e.mode),t.ref=e.ref,e.child=t,t.return=e,t}function vh(e,t,a){return cs(t,e.child,null,a),e=Wl(t,t.pendingProps),e.flags|=2,Hn(t),t.memoizedState=null,e}function Qx(e,t,a){var s=t.pendingProps,c=(t.flags&128)!==0;if(t.flags&=-129,e===null){if(bt){if(s.mode==="hidden")return e=Wl(t,s),t.lanes=536870912,Hi(null,e);if(Fc(t),(e=Ut)?(e=Om(e,Wn),e=e!==null&&e.data==="&"?e:null,e!==null&&(t.memoizedState={dehydrated:e,treeContext:yr!==null?{id:Na,overflow:_a}:null,retryLane:536870912,hydrationErrors:null},a=nf(e),a.return=t,t.child=a,fn=t,Ut=null)):e=null,e===null)throw vr(t);return t.lanes=536870912,null}return Wl(t,s)}var h=e.memoizedState;if(h!==null){var T=h.dehydrated;if(Fc(t),c)if(t.flags&256)t.flags&=-257,t=vh(e,t,a);else if(t.memoizedState!==null)t.child=e.child,t.flags|=128,t=null;else throw Error(u(558));else if(Wt||Us(e,t,a,!1),c=(a&e.childLanes)!==0,Wt||c){if(s=It,s!==null&&(T=ui(s,a),T!==0&&T!==h.retryLane))throw h.retryLane=T,ts(e,T),In(s,e,T),lu;uo(),t=vh(e,t,a)}else e=h.treeContext,Ut=ta(T.nextSibling),fn=t,bt=!0,br=null,Wn=!1,e!==null&&sf(t,e),t=Wl(t,s),t.flags|=4096;return t}return e=Ga(e.child,{mode:s.mode,children:s.children}),e.ref=t.ref,t.child=e,e.return=t,e}function eo(e,t){var a=t.ref;if(a===null)e!==null&&e.ref!==null&&(t.flags|=4194816);else{if(typeof a!="function"&&typeof a!="object")throw Error(u(284));(e===null||e.ref!==a)&&(t.flags|=4194816)}}function ou(e,t,a,s,c){return ss(t),a=Hc(e,t,a,s,void 0,c),s=Gc(),e!==null&&!Wt?(Yc(e,t,c),Va(e,t,c)):(bt&&s&&Ec(t),t.flags|=1,mn(e,t,a,c),t.child)}function wh(e,t,a,s,c,h){return ss(t),t.updateQueue=null,a=jf(t,s,a,c),Ef(e),s=Gc(),e!==null&&!Wt?(Yc(e,t,h),Va(e,t,h)):(bt&&s&&Ec(t),t.flags|=1,mn(e,t,a,h),t.child)}function Sh(e,t,a,s,c){if(ss(t),t.stateNode===null){var h=Os,T=a.contextType;typeof T=="object"&&T!==null&&(h=hn(T)),h=new a(s,h),t.memoizedState=h.state!==null&&h.state!==void 0?h.state:null,h.updater=su,t.stateNode=h,h._reactInternals=t,h=t.stateNode,h.props=s,h.state=t.memoizedState,h.refs={},Rc(t),T=a.contextType,h.context=typeof T=="object"&&T!==null?hn(T):Os,h.state=t.memoizedState,T=a.getDerivedStateFromProps,typeof T=="function"&&(ru(t,a,T,s),h.state=t.memoizedState),typeof a.getDerivedStateFromProps=="function"||typeof h.getSnapshotBeforeUpdate=="function"||typeof h.UNSAFE_componentWillMount!="function"&&typeof h.componentWillMount!="function"||(T=h.state,typeof h.componentWillMount=="function"&&h.componentWillMount(),typeof h.UNSAFE_componentWillMount=="function"&&h.UNSAFE_componentWillMount(),T!==h.state&&su.enqueueReplaceState(h,h.state,null),zi(t,s,h,c),Ui(),h.state=t.memoizedState),typeof h.componentDidMount=="function"&&(t.flags|=4194308),s=!0}else if(e===null){h=t.stateNode;var F=t.memoizedProps,re=ds(a,F);h.props=re;var be=h.context,Te=a.contextType;T=Os,typeof Te=="object"&&Te!==null&&(T=hn(Te));var Ie=a.getDerivedStateFromProps;Te=typeof Ie=="function"||typeof h.getSnapshotBeforeUpdate=="function",F=t.pendingProps!==F,Te||typeof h.UNSAFE_componentWillReceiveProps!="function"&&typeof h.componentWillReceiveProps!="function"||(F||be!==T)&&oh(t,h,s,T),Sr=!1;var Se=t.memoizedState;h.state=Se,zi(t,s,h,c),Ui(),be=t.memoizedState,F||Se!==be||Sr?(typeof Ie=="function"&&(ru(t,a,Ie,s),be=t.memoizedState),(re=Sr||lh(t,a,re,s,Se,be,T))?(Te||typeof h.UNSAFE_componentWillMount!="function"&&typeof h.componentWillMount!="function"||(typeof h.componentWillMount=="function"&&h.componentWillMount(),typeof h.UNSAFE_componentWillMount=="function"&&h.UNSAFE_componentWillMount()),typeof h.componentDidMount=="function"&&(t.flags|=4194308)):(typeof h.componentDidMount=="function"&&(t.flags|=4194308),t.memoizedProps=s,t.memoizedState=be),h.props=s,h.state=be,h.context=T,s=re):(typeof h.componentDidMount=="function"&&(t.flags|=4194308),s=!1)}else{h=t.stateNode,Mc(e,t),T=t.memoizedProps,Te=ds(a,T),h.props=Te,Ie=t.pendingProps,Se=h.context,be=a.contextType,re=Os,typeof be=="object"&&be!==null&&(re=hn(be)),F=a.getDerivedStateFromProps,(be=typeof F=="function"||typeof h.getSnapshotBeforeUpdate=="function")||typeof h.UNSAFE_componentWillReceiveProps!="function"&&typeof h.componentWillReceiveProps!="function"||(T!==Ie||Se!==re)&&oh(t,h,s,re),Sr=!1,Se=t.memoizedState,h.state=Se,zi(t,s,h,c),Ui();var ke=t.memoizedState;T!==Ie||Se!==ke||Sr||e!==null&&e.dependencies!==null&&Ml(e.dependencies)?(typeof F=="function"&&(ru(t,a,F,s),ke=t.memoizedState),(Te=Sr||lh(t,a,Te,s,Se,ke,re)||e!==null&&e.dependencies!==null&&Ml(e.dependencies))?(be||typeof h.UNSAFE_componentWillUpdate!="function"&&typeof h.componentWillUpdate!="function"||(typeof h.componentWillUpdate=="function"&&h.componentWillUpdate(s,ke,re),typeof h.UNSAFE_componentWillUpdate=="function"&&h.UNSAFE_componentWillUpdate(s,ke,re)),typeof h.componentDidUpdate=="function"&&(t.flags|=4),typeof h.getSnapshotBeforeUpdate=="function"&&(t.flags|=1024)):(typeof h.componentDidUpdate!="function"||T===e.memoizedProps&&Se===e.memoizedState||(t.flags|=4),typeof h.getSnapshotBeforeUpdate!="function"||T===e.memoizedProps&&Se===e.memoizedState||(t.flags|=1024),t.memoizedProps=s,t.memoizedState=ke),h.props=s,h.state=ke,h.context=re,s=Te):(typeof h.componentDidUpdate!="function"||T===e.memoizedProps&&Se===e.memoizedState||(t.flags|=4),typeof h.getSnapshotBeforeUpdate!="function"||T===e.memoizedProps&&Se===e.memoizedState||(t.flags|=1024),s=!1)}return h=s,eo(e,t),s=(t.flags&128)!==0,h||s?(h=t.stateNode,a=s&&typeof a.getDerivedStateFromError!="function"?null:h.render(),t.flags|=1,e!==null&&s?(t.child=cs(t,e.child,null,c),t.child=cs(t,null,a,c)):mn(e,t,a,c),t.memoizedState=h.state,e=t.child):e=Va(e,t,c),e}function Eh(e,t,a,s){return as(),t.flags|=256,mn(e,t,a,s),t.child}var cu={dehydrated:null,treeContext:null,retryLane:0,hydrationErrors:null};function uu(e){return{baseLanes:e,cachePool:ff()}}function du(e,t,a){return e=e!==null?e.childLanes&~a:0,t&&(e|=Yn),e}function jh(e,t,a){var s=t.pendingProps,c=!1,h=(t.flags&128)!==0,T;if((T=h)||(T=e!==null&&e.memoizedState===null?!1:(Jt.current&2)!==0),T&&(c=!0,t.flags&=-129),T=(t.flags&32)!==0,t.flags&=-33,e===null){if(bt){if(c?Nr(t):_r(),(e=Ut)?(e=Om(e,Wn),e=e!==null&&e.data!=="&"?e:null,e!==null&&(t.memoizedState={dehydrated:e,treeContext:yr!==null?{id:Na,overflow:_a}:null,retryLane:536870912,hydrationErrors:null},a=nf(e),a.return=t,t.child=a,fn=t,Ut=null)):e=null,e===null)throw vr(t);return Pu(e)?t.lanes=32:t.lanes=536870912,null}var F=s.children;return s=s.fallback,c?(_r(),c=t.mode,F=to({mode:"hidden",children:F},c),s=ns(s,c,a,null),F.return=t,s.return=t,F.sibling=s,t.child=F,s=t.child,s.memoizedState=uu(a),s.childLanes=du(e,T,a),t.memoizedState=cu,Hi(null,s)):(Nr(t),fu(t,F))}var re=e.memoizedState;if(re!==null&&(F=re.dehydrated,F!==null)){if(h)t.flags&256?(Nr(t),t.flags&=-257,t=hu(e,t,a)):t.memoizedState!==null?(_r(),t.child=e.child,t.flags|=128,t=null):(_r(),F=s.fallback,c=t.mode,s=to({mode:"visible",children:s.children},c),F=ns(F,c,a,null),F.flags|=2,s.return=t,F.return=t,s.sibling=F,t.child=s,cs(t,e.child,null,a),s=t.child,s.memoizedState=uu(a),s.childLanes=du(e,T,a),t.memoizedState=cu,t=Hi(null,s));else if(Nr(t),Pu(F)){if(T=F.nextSibling&&F.nextSibling.dataset,T)var be=T.dgst;T=be,s=Error(u(419)),s.stack="",s.digest=T,Ci({value:s,source:null,stack:null}),t=hu(e,t,a)}else if(Wt||Us(e,t,a,!1),T=(a&e.childLanes)!==0,Wt||T){if(T=It,T!==null&&(s=ui(T,a),s!==0&&s!==re.retryLane))throw re.retryLane=s,ts(e,s),In(T,e,s),lu;$u(F)||uo(),t=hu(e,t,a)}else $u(F)?(t.flags|=192,t.child=e.child,t=null):(e=re.treeContext,Ut=ta(F.nextSibling),fn=t,bt=!0,br=null,Wn=!1,e!==null&&sf(t,e),t=fu(t,s.children),t.flags|=4096);return t}return c?(_r(),F=s.fallback,c=t.mode,re=e.child,be=re.sibling,s=Ga(re,{mode:"hidden",children:s.children}),s.subtreeFlags=re.subtreeFlags&65011712,be!==null?F=Ga(be,F):(F=ns(F,c,a,null),F.flags|=2),F.return=t,s.return=t,s.sibling=F,t.child=s,Hi(null,s),s=t.child,F=e.child.memoizedState,F===null?F=uu(a):(c=F.cachePool,c!==null?(re=Zt._currentValue,c=c.parent!==re?{parent:re,pool:re}:c):c=ff(),F={baseLanes:F.baseLanes|a,cachePool:c}),s.memoizedState=F,s.childLanes=du(e,T,a),t.memoizedState=cu,Hi(e.child,s)):(Nr(t),a=e.child,e=a.sibling,a=Ga(a,{mode:"visible",children:s.children}),a.return=t,a.sibling=null,e!==null&&(T=t.deletions,T===null?(t.deletions=[e],t.flags|=16):T.push(e)),t.child=a,t.memoizedState=null,a)}function fu(e,t){return t=to({mode:"visible",children:t},e.mode),t.return=e,e.child=t}function to(e,t){return e=Fn(22,e,null,t),e.lanes=0,e}function hu(e,t,a){return cs(t,e.child,null,a),e=fu(t,t.pendingProps.children),e.flags|=2,t.memoizedState=null,e}function Nh(e,t,a){e.lanes|=t;var s=e.alternate;s!==null&&(s.lanes|=t),Ac(e.return,t,a)}function mu(e,t,a,s,c,h){var T=e.memoizedState;T===null?e.memoizedState={isBackwards:t,rendering:null,renderingStartTime:0,last:s,tail:a,tailMode:c,treeForkCount:h}:(T.isBackwards=t,T.rendering=null,T.renderingStartTime=0,T.last=s,T.tail=a,T.tailMode=c,T.treeForkCount=h)}function _h(e,t,a){var s=t.pendingProps,c=s.revealOrder,h=s.tail;s=s.children;var T=Jt.current,F=(T&2)!==0;if(F?(T=T&1|2,t.flags|=128):T&=1,se(Jt,T),mn(e,t,s,a),s=bt?Ti:0,!F&&e!==null&&(e.flags&128)!==0)e:for(e=t.child;e!==null;){if(e.tag===13)e.memoizedState!==null&&Nh(e,a,t);else if(e.tag===19)Nh(e,a,t);else if(e.child!==null){e.child.return=e,e=e.child;continue}if(e===t)break e;for(;e.sibling===null;){if(e.return===null||e.return===t)break e;e=e.return}e.sibling.return=e.return,e=e.sibling}switch(c){case"forwards":for(a=t.child,c=null;a!==null;)e=a.alternate,e!==null&&Gl(e)===null&&(c=a),a=a.sibling;a=c,a===null?(c=t.child,t.child=null):(c=a.sibling,a.sibling=null),mu(t,!1,c,a,h,s);break;case"backwards":case"unstable_legacy-backwards":for(a=null,c=t.child,t.child=null;c!==null;){if(e=c.alternate,e!==null&&Gl(e)===null){t.child=c;break}e=c.sibling,c.sibling=a,a=c,c=e}mu(t,!0,a,null,h,s);break;case"together":mu(t,!1,null,null,void 0,s);break;default:t.memoizedState=null}return t.child}function Va(e,t,a){if(e!==null&&(t.dependencies=e.dependencies),Tr|=t.lanes,(a&t.childLanes)===0)if(e!==null){if(Us(e,t,a,!1),(a&t.childLanes)===0)return null}else return null;if(e!==null&&t.child!==e.child)throw Error(u(153));if(t.child!==null){for(e=t.child,a=Ga(e,e.pendingProps),t.child=a,a.return=t;e.sibling!==null;)e=e.sibling,a=a.sibling=Ga(e,e.pendingProps),a.return=t;a.sibling=null}return t.child}function pu(e,t){return(e.lanes&t)!==0?!0:(e=e.dependencies,!!(e!==null&&Ml(e)))}function $x(e,t,a){switch(t.tag){case 3:je(t,t.stateNode.containerInfo),wr(t,Zt,e.memoizedState.cache),as();break;case 27:case 5:Me(t);break;case 4:je(t,t.stateNode.containerInfo);break;case 10:wr(t,t.type,t.memoizedProps.value);break;case 31:if(t.memoizedState!==null)return t.flags|=128,Fc(t),null;break;case 13:var s=t.memoizedState;if(s!==null)return s.dehydrated!==null?(Nr(t),t.flags|=128,null):(a&t.child.childLanes)!==0?jh(e,t,a):(Nr(t),e=Va(e,t,a),e!==null?e.sibling:null);Nr(t);break;case 19:var c=(e.flags&128)!==0;if(s=(a&t.childLanes)!==0,s||(Us(e,t,a,!1),s=(a&t.childLanes)!==0),c){if(s)return _h(e,t,a);t.flags|=128}if(c=t.memoizedState,c!==null&&(c.rendering=null,c.tail=null,c.lastEffect=null),se(Jt,Jt.current),s)break;return null;case 22:return t.lanes=0,yh(e,t,a,t.pendingProps);case 24:wr(t,Zt,e.memoizedState.cache)}return Va(e,t,a)}function kh(e,t,a){if(e!==null)if(e.memoizedProps!==t.pendingProps)Wt=!0;else{if(!pu(e,a)&&(t.flags&128)===0)return Wt=!1,$x(e,t,a);Wt=(e.flags&131072)!==0}else Wt=!1,bt&&(t.flags&1048576)!==0&&rf(t,Ti,t.index);switch(t.lanes=0,t.tag){case 16:e:{var s=t.pendingProps;if(e=ls(t.elementType),t.type=e,typeof e=="function")vc(e)?(s=ds(e,s),t.tag=1,t=Sh(null,t,e,s,a)):(t.tag=0,t=ou(null,t,e,s,a));else{if(e!=null){var c=e.$$typeof;if(c===M){t.tag=11,t=ph(null,t,e,s,a);break e}else if(c===X){t.tag=14,t=gh(null,t,e,s,a);break e}}throw t=A(e)||e,Error(u(306,t,""))}}return t;case 0:return ou(e,t,t.type,t.pendingProps,a);case 1:return s=t.type,c=ds(s,t.pendingProps),Sh(e,t,s,c,a);case 3:e:{if(je(t,t.stateNode.containerInfo),e===null)throw Error(u(387));s=t.pendingProps;var h=t.memoizedState;c=h.element,Mc(e,t),zi(t,s,null,a);var T=t.memoizedState;if(s=T.cache,wr(t,Zt,s),s!==h.cache&&Tc(t,[Zt],a,!0),Ui(),s=T.element,h.isDehydrated)if(h={element:s,isDehydrated:!1,cache:T.cache},t.updateQueue.baseState=h,t.memoizedState=h,t.flags&256){t=Eh(e,t,s,a);break e}else if(s!==c){c=Kn(Error(u(424)),t),Ci(c),t=Eh(e,t,s,a);break e}else{switch(e=t.stateNode.containerInfo,e.nodeType){case 9:e=e.body;break;default:e=e.nodeName==="HTML"?e.ownerDocument.body:e}for(Ut=ta(e.firstChild),fn=t,bt=!0,br=null,Wn=!0,a=yf(t,null,s,a),t.child=a;a;)a.flags=a.flags&-3|4096,a=a.sibling}else{if(as(),s===c){t=Va(e,t,a);break e}mn(e,t,s,a)}t=t.child}return t;case 26:return eo(e,t),e===null?(a=Lm(t.type,null,t.pendingProps,null))?t.memoizedState=a:bt||(a=t.type,e=t.pendingProps,s=yo(Ne.current).createElement(a),s[nn]=t,s[Nt]=e,pn(s,a,e),Bt(s),t.stateNode=s):t.memoizedState=Lm(t.type,e.memoizedProps,t.pendingProps,e.memoizedState),null;case 27:return Me(t),e===null&&bt&&(s=t.stateNode=Mm(t.type,t.pendingProps,Ne.current),fn=t,Wn=!0,c=Ut,Rr(t.type)?(Ju=c,Ut=ta(s.firstChild)):Ut=c),mn(e,t,t.pendingProps.children,a),eo(e,t),e===null&&(t.flags|=4194304),t.child;case 5:return e===null&&bt&&((c=s=Ut)&&(s=Sy(s,t.type,t.pendingProps,Wn),s!==null?(t.stateNode=s,fn=t,Ut=ta(s.firstChild),Wn=!1,c=!0):c=!1),c||vr(t)),Me(t),c=t.type,h=t.pendingProps,T=e!==null?e.memoizedProps:null,s=h.children,Gu(c,h)?s=null:T!==null&&Gu(c,T)&&(t.flags|=32),t.memoizedState!==null&&(c=Hc(e,t,zx,null,null,a),al._currentValue=c),eo(e,t),mn(e,t,s,a),t.child;case 6:return e===null&&bt&&((e=a=Ut)&&(a=Ey(a,t.pendingProps,Wn),a!==null?(t.stateNode=a,fn=t,Ut=null,e=!0):e=!1),e||vr(t)),null;case 13:return jh(e,t,a);case 4:return je(t,t.stateNode.containerInfo),s=t.pendingProps,e===null?t.child=cs(t,null,s,a):mn(e,t,s,a),t.child;case 11:return ph(e,t,t.type,t.pendingProps,a);case 7:return mn(e,t,t.pendingProps,a),t.child;case 8:return mn(e,t,t.pendingProps.children,a),t.child;case 12:return mn(e,t,t.pendingProps.children,a),t.child;case 10:return s=t.pendingProps,wr(t,t.type,s.value),mn(e,t,s.children,a),t.child;case 9:return c=t.type._context,s=t.pendingProps.children,ss(t),c=hn(c),s=s(c),t.flags|=1,mn(e,t,s,a),t.child;case 14:return gh(e,t,t.type,t.pendingProps,a);case 15:return xh(e,t,t.type,t.pendingProps,a);case 19:return _h(e,t,a);case 31:return Qx(e,t,a);case 22:return yh(e,t,a,t.pendingProps);case 24:return ss(t),s=hn(Zt),e===null?(c=Oc(),c===null&&(c=It,h=Cc(),c.pooledCache=h,h.refCount++,h!==null&&(c.pooledCacheLanes|=a),c=h),t.memoizedState={parent:s,cache:c},Rc(t),wr(t,Zt,c)):((e.lanes&a)!==0&&(Mc(e,t),zi(t,null,null,a),Ui()),c=e.memoizedState,h=t.memoizedState,c.parent!==s?(c={parent:s,cache:s},t.memoizedState=c,t.lanes===0&&(t.memoizedState=t.updateQueue.baseState=c),wr(t,Zt,s)):(s=h.cache,wr(t,Zt,s),s!==c.cache&&Tc(t,[Zt],a,!0))),mn(e,t,t.pendingProps.children,a),t.child;case 29:throw t.pendingProps}throw Error(u(156,t.tag))}function Ka(e){e.flags|=4}function gu(e,t,a,s,c){if((t=(e.mode&32)!==0)&&(t=!1),t){if(e.flags|=16777216,(c&335544128)===c)if(e.stateNode.complete)e.flags|=8192;else if(em())e.flags|=8192;else throw os=Bl,Ic}else e.flags&=-16777217}function Ah(e,t){if(t.type!=="stylesheet"||(t.state.loading&4)!==0)e.flags&=-16777217;else if(e.flags|=16777216,!Gm(t))if(em())e.flags|=8192;else throw os=Bl,Ic}function no(e,t){t!==null&&(e.flags|=4),e.flags&16384&&(t=e.tag!==22?ys():536870912,e.lanes|=t,Js|=t)}function Gi(e,t){if(!bt)switch(e.tailMode){case"hidden":t=e.tail;for(var a=null;t!==null;)t.alternate!==null&&(a=t),t=t.sibling;a===null?e.tail=null:a.sibling=null;break;case"collapsed":a=e.tail;for(var s=null;a!==null;)a.alternate!==null&&(s=a),a=a.sibling;s===null?t||e.tail===null?e.tail=null:e.tail.sibling=null:s.sibling=null}}function zt(e){var t=e.alternate!==null&&e.alternate.child===e.child,a=0,s=0;if(t)for(var c=e.child;c!==null;)a|=c.lanes|c.childLanes,s|=c.subtreeFlags&65011712,s|=c.flags&65011712,c.return=e,c=c.sibling;else for(c=e.child;c!==null;)a|=c.lanes|c.childLanes,s|=c.subtreeFlags,s|=c.flags,c.return=e,c=c.sibling;return e.subtreeFlags|=s,e.childLanes=a,t}function Px(e,t,a){var s=t.pendingProps;switch(jc(t),t.tag){case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return zt(t),null;case 1:return zt(t),null;case 3:return a=t.stateNode,s=null,e!==null&&(s=e.memoizedState.cache),t.memoizedState.cache!==s&&(t.flags|=2048),$a(Zt),ve(),a.pendingContext&&(a.context=a.pendingContext,a.pendingContext=null),(e===null||e.child===null)&&(Ms(t)?Ka(t):e===null||e.memoizedState.isDehydrated&&(t.flags&256)===0||(t.flags|=1024,_c())),zt(t),null;case 26:var c=t.type,h=t.memoizedState;return e===null?(Ka(t),h!==null?(zt(t),Ah(t,h)):(zt(t),gu(t,c,null,s,a))):h?h!==e.memoizedState?(Ka(t),zt(t),Ah(t,h)):(zt(t),t.flags&=-16777217):(e=e.memoizedProps,e!==s&&Ka(t),zt(t),gu(t,c,e,s,a)),null;case 27:if(Fe(t),a=Ne.current,c=t.type,e!==null&&t.stateNode!=null)e.memoizedProps!==s&&Ka(t);else{if(!s){if(t.stateNode===null)throw Error(u(166));return zt(t),null}e=ie.current,Ms(t)?lf(t):(e=Mm(c,s,a),t.stateNode=e,Ka(t))}return zt(t),null;case 5:if(Fe(t),c=t.type,e!==null&&t.stateNode!=null)e.memoizedProps!==s&&Ka(t);else{if(!s){if(t.stateNode===null)throw Error(u(166));return zt(t),null}if(h=ie.current,Ms(t))lf(t);else{var T=yo(Ne.current);switch(h){case 1:h=T.createElementNS("http://www.w3.org/2000/svg",c);break;case 2:h=T.createElementNS("http://www.w3.org/1998/Math/MathML",c);break;default:switch(c){case"svg":h=T.createElementNS("http://www.w3.org/2000/svg",c);break;case"math":h=T.createElementNS("http://www.w3.org/1998/Math/MathML",c);break;case"script":h=T.createElement("div"),h.innerHTML="<script><\/script>",h=h.removeChild(h.firstChild);break;case"select":h=typeof s.is=="string"?T.createElement("select",{is:s.is}):T.createElement("select"),s.multiple?h.multiple=!0:s.size&&(h.size=s.size);break;default:h=typeof s.is=="string"?T.createElement(c,{is:s.is}):T.createElement(c)}}h[nn]=t,h[Nt]=s;e:for(T=t.child;T!==null;){if(T.tag===5||T.tag===6)h.appendChild(T.stateNode);else if(T.tag!==4&&T.tag!==27&&T.child!==null){T.child.return=T,T=T.child;continue}if(T===t)break e;for(;T.sibling===null;){if(T.return===null||T.return===t)break e;T=T.return}T.sibling.return=T.return,T=T.sibling}t.stateNode=h;e:switch(pn(h,c,s),c){case"button":case"input":case"select":case"textarea":s=!!s.autoFocus;break e;case"img":s=!0;break e;default:s=!1}s&&Ka(t)}}return zt(t),gu(t,t.type,e===null?null:e.memoizedProps,t.pendingProps,a),null;case 6:if(e&&t.stateNode!=null)e.memoizedProps!==s&&Ka(t);else{if(typeof s!="string"&&t.stateNode===null)throw Error(u(166));if(e=Ne.current,Ms(t)){if(e=t.stateNode,a=t.memoizedProps,s=null,c=fn,c!==null)switch(c.tag){case 27:case 5:s=c.memoizedProps}e[nn]=t,e=!!(e.nodeValue===a||s!==null&&s.suppressHydrationWarning===!0||jm(e.nodeValue,a)),e||vr(t,!0)}else e=yo(e).createTextNode(s),e[nn]=t,t.stateNode=e}return zt(t),null;case 31:if(a=t.memoizedState,e===null||e.memoizedState!==null){if(s=Ms(t),a!==null){if(e===null){if(!s)throw Error(u(318));if(e=t.memoizedState,e=e!==null?e.dehydrated:null,!e)throw Error(u(557));e[nn]=t}else as(),(t.flags&128)===0&&(t.memoizedState=null),t.flags|=4;zt(t),e=!1}else a=_c(),e!==null&&e.memoizedState!==null&&(e.memoizedState.hydrationErrors=a),e=!0;if(!e)return t.flags&256?(Hn(t),t):(Hn(t),null);if((t.flags&128)!==0)throw Error(u(558))}return zt(t),null;case 13:if(s=t.memoizedState,e===null||e.memoizedState!==null&&e.memoizedState.dehydrated!==null){if(c=Ms(t),s!==null&&s.dehydrated!==null){if(e===null){if(!c)throw Error(u(318));if(c=t.memoizedState,c=c!==null?c.dehydrated:null,!c)throw Error(u(317));c[nn]=t}else as(),(t.flags&128)===0&&(t.memoizedState=null),t.flags|=4;zt(t),c=!1}else c=_c(),e!==null&&e.memoizedState!==null&&(e.memoizedState.hydrationErrors=c),c=!0;if(!c)return t.flags&256?(Hn(t),t):(Hn(t),null)}return Hn(t),(t.flags&128)!==0?(t.lanes=a,t):(a=s!==null,e=e!==null&&e.memoizedState!==null,a&&(s=t.child,c=null,s.alternate!==null&&s.alternate.memoizedState!==null&&s.alternate.memoizedState.cachePool!==null&&(c=s.alternate.memoizedState.cachePool.pool),h=null,s.memoizedState!==null&&s.memoizedState.cachePool!==null&&(h=s.memoizedState.cachePool.pool),h!==c&&(s.flags|=2048)),a!==e&&a&&(t.child.flags|=8192),no(t,t.updateQueue),zt(t),null);case 4:return ve(),e===null&&Lu(t.stateNode.containerInfo),zt(t),null;case 10:return $a(t.type),zt(t),null;case 19:if(L(Jt),s=t.memoizedState,s===null)return zt(t),null;if(c=(t.flags&128)!==0,h=s.rendering,h===null)if(c)Gi(s,!1);else{if($t!==0||e!==null&&(e.flags&128)!==0)for(e=t.child;e!==null;){if(h=Gl(e),h!==null){for(t.flags|=128,Gi(s,!1),e=h.updateQueue,t.updateQueue=e,no(t,e),t.subtreeFlags=0,e=a,a=t.child;a!==null;)tf(a,e),a=a.sibling;return se(Jt,Jt.current&1|2),bt&&Ya(t,s.treeForkCount),t.child}e=e.sibling}s.tail!==null&&Le()>lo&&(t.flags|=128,c=!0,Gi(s,!1),t.lanes=4194304)}else{if(!c)if(e=Gl(h),e!==null){if(t.flags|=128,c=!0,e=e.updateQueue,t.updateQueue=e,no(t,e),Gi(s,!0),s.tail===null&&s.tailMode==="hidden"&&!h.alternate&&!bt)return zt(t),null}else 2*Le()-s.renderingStartTime>lo&&a!==536870912&&(t.flags|=128,c=!0,Gi(s,!1),t.lanes=4194304);s.isBackwards?(h.sibling=t.child,t.child=h):(e=s.last,e!==null?e.sibling=h:t.child=h,s.last=h)}return s.tail!==null?(e=s.tail,s.rendering=e,s.tail=e.sibling,s.renderingStartTime=Le(),e.sibling=null,a=Jt.current,se(Jt,c?a&1|2:a&1),bt&&Ya(t,s.treeForkCount),e):(zt(t),null);case 22:case 23:return Hn(t),Bc(),s=t.memoizedState!==null,e!==null?e.memoizedState!==null!==s&&(t.flags|=8192):s&&(t.flags|=8192),s?(a&536870912)!==0&&(t.flags&128)===0&&(zt(t),t.subtreeFlags&6&&(t.flags|=8192)):zt(t),a=t.updateQueue,a!==null&&no(t,a.retryQueue),a=null,e!==null&&e.memoizedState!==null&&e.memoizedState.cachePool!==null&&(a=e.memoizedState.cachePool.pool),s=null,t.memoizedState!==null&&t.memoizedState.cachePool!==null&&(s=t.memoizedState.cachePool.pool),s!==a&&(t.flags|=2048),e!==null&&L(is),null;case 24:return a=null,e!==null&&(a=e.memoizedState.cache),t.memoizedState.cache!==a&&(t.flags|=2048),$a(Zt),zt(t),null;case 25:return null;case 30:return null}throw Error(u(156,t.tag))}function Jx(e,t){switch(jc(t),t.tag){case 1:return e=t.flags,e&65536?(t.flags=e&-65537|128,t):null;case 3:return $a(Zt),ve(),e=t.flags,(e&65536)!==0&&(e&128)===0?(t.flags=e&-65537|128,t):null;case 26:case 27:case 5:return Fe(t),null;case 31:if(t.memoizedState!==null){if(Hn(t),t.alternate===null)throw Error(u(340));as()}return e=t.flags,e&65536?(t.flags=e&-65537|128,t):null;case 13:if(Hn(t),e=t.memoizedState,e!==null&&e.dehydrated!==null){if(t.alternate===null)throw Error(u(340));as()}return e=t.flags,e&65536?(t.flags=e&-65537|128,t):null;case 19:return L(Jt),null;case 4:return ve(),null;case 10:return $a(t.type),null;case 22:case 23:return Hn(t),Bc(),e!==null&&L(is),e=t.flags,e&65536?(t.flags=e&-65537|128,t):null;case 24:return $a(Zt),null;case 25:return null;default:return null}}function Th(e,t){switch(jc(t),t.tag){case 3:$a(Zt),ve();break;case 26:case 27:case 5:Fe(t);break;case 4:ve();break;case 31:t.memoizedState!==null&&Hn(t);break;case 13:Hn(t);break;case 19:L(Jt);break;case 10:$a(t.type);break;case 22:case 23:Hn(t),Bc(),e!==null&&L(is);break;case 24:$a(Zt)}}function Yi(e,t){try{var a=t.updateQueue,s=a!==null?a.lastEffect:null;if(s!==null){var c=s.next;a=c;do{if((a.tag&e)===e){s=void 0;var h=a.create,T=a.inst;s=h(),T.destroy=s}a=a.next}while(a!==c)}}catch(F){kt(t,t.return,F)}}function kr(e,t,a){try{var s=t.updateQueue,c=s!==null?s.lastEffect:null;if(c!==null){var h=c.next;s=h;do{if((s.tag&e)===e){var T=s.inst,F=T.destroy;if(F!==void 0){T.destroy=void 0,c=t;var re=a,be=F;try{be()}catch(Te){kt(c,re,Te)}}}s=s.next}while(s!==h)}}catch(Te){kt(t,t.return,Te)}}function Ch(e){var t=e.updateQueue;if(t!==null){var a=e.stateNode;try{vf(t,a)}catch(s){kt(e,e.return,s)}}}function Dh(e,t,a){a.props=ds(e.type,e.memoizedProps),a.state=e.memoizedState;try{a.componentWillUnmount()}catch(s){kt(e,t,s)}}function Qi(e,t){try{var a=e.ref;if(a!==null){switch(e.tag){case 26:case 27:case 5:var s=e.stateNode;break;case 30:s=e.stateNode;break;default:s=e.stateNode}typeof a=="function"?e.refCleanup=a(s):a.current=s}}catch(c){kt(e,t,c)}}function ka(e,t){var a=e.ref,s=e.refCleanup;if(a!==null)if(typeof s=="function")try{s()}catch(c){kt(e,t,c)}finally{e.refCleanup=null,e=e.alternate,e!=null&&(e.refCleanup=null)}else if(typeof a=="function")try{a(null)}catch(c){kt(e,t,c)}else a.current=null}function Oh(e){var t=e.type,a=e.memoizedProps,s=e.stateNode;try{e:switch(t){case"button":case"input":case"select":case"textarea":a.autoFocus&&s.focus();break e;case"img":a.src?s.src=a.src:a.srcSet&&(s.srcset=a.srcSet)}}catch(c){kt(e,e.return,c)}}function xu(e,t,a){try{var s=e.stateNode;gy(s,e.type,a,t),s[Nt]=t}catch(c){kt(e,e.return,c)}}function Ih(e){return e.tag===5||e.tag===3||e.tag===26||e.tag===27&&Rr(e.type)||e.tag===4}function yu(e){e:for(;;){for(;e.sibling===null;){if(e.return===null||Ih(e.return))return null;e=e.return}for(e.sibling.return=e.return,e=e.sibling;e.tag!==5&&e.tag!==6&&e.tag!==18;){if(e.tag===27&&Rr(e.type)||e.flags&2||e.child===null||e.tag===4)continue e;e.child.return=e,e=e.child}if(!(e.flags&2))return e.stateNode}}function bu(e,t,a){var s=e.tag;if(s===5||s===6)e=e.stateNode,t?(a.nodeType===9?a.body:a.nodeName==="HTML"?a.ownerDocument.body:a).insertBefore(e,t):(t=a.nodeType===9?a.body:a.nodeName==="HTML"?a.ownerDocument.body:a,t.appendChild(e),a=a._reactRootContainer,a!=null||t.onclick!==null||(t.onclick=an));else if(s!==4&&(s===27&&Rr(e.type)&&(a=e.stateNode,t=null),e=e.child,e!==null))for(bu(e,t,a),e=e.sibling;e!==null;)bu(e,t,a),e=e.sibling}function ao(e,t,a){var s=e.tag;if(s===5||s===6)e=e.stateNode,t?a.insertBefore(e,t):a.appendChild(e);else if(s!==4&&(s===27&&Rr(e.type)&&(a=e.stateNode),e=e.child,e!==null))for(ao(e,t,a),e=e.sibling;e!==null;)ao(e,t,a),e=e.sibling}function Rh(e){var t=e.stateNode,a=e.memoizedProps;try{for(var s=e.type,c=t.attributes;c.length;)t.removeAttributeNode(c[0]);pn(t,s,a),t[nn]=e,t[Nt]=a}catch(h){kt(e,e.return,h)}}var Za=!1,en=!1,vu=!1,Mh=typeof WeakSet=="function"?WeakSet:Set,on=null;function Vx(e,t){if(e=e.containerInfo,qu=No,e=$d(e),hc(e)){if("selectionStart"in e)var a={start:e.selectionStart,end:e.selectionEnd};else e:{a=(a=e.ownerDocument)&&a.defaultView||window;var s=a.getSelection&&a.getSelection();if(s&&s.rangeCount!==0){a=s.anchorNode;var c=s.anchorOffset,h=s.focusNode;s=s.focusOffset;try{a.nodeType,h.nodeType}catch{a=null;break e}var T=0,F=-1,re=-1,be=0,Te=0,Ie=e,Se=null;t:for(;;){for(var ke;Ie!==a||c!==0&&Ie.nodeType!==3||(F=T+c),Ie!==h||s!==0&&Ie.nodeType!==3||(re=T+s),Ie.nodeType===3&&(T+=Ie.nodeValue.length),(ke=Ie.firstChild)!==null;)Se=Ie,Ie=ke;for(;;){if(Ie===e)break t;if(Se===a&&++be===c&&(F=T),Se===h&&++Te===s&&(re=T),(ke=Ie.nextSibling)!==null)break;Ie=Se,Se=Ie.parentNode}Ie=ke}a=F===-1||re===-1?null:{start:F,end:re}}else a=null}a=a||{start:0,end:0}}else a=null;for(Hu={focusedElem:e,selectionRange:a},No=!1,on=t;on!==null;)if(t=on,e=t.child,(t.subtreeFlags&1028)!==0&&e!==null)e.return=t,on=e;else for(;on!==null;){switch(t=on,h=t.alternate,e=t.flags,t.tag){case 0:if((e&4)!==0&&(e=t.updateQueue,e=e!==null?e.events:null,e!==null))for(a=0;a<e.length;a++)c=e[a],c.ref.impl=c.nextImpl;break;case 11:case 15:break;case 1:if((e&1024)!==0&&h!==null){e=void 0,a=t,c=h.memoizedProps,h=h.memoizedState,s=a.stateNode;try{var $e=ds(a.type,c);e=s.getSnapshotBeforeUpdate($e,h),s.__reactInternalSnapshotBeforeUpdate=e}catch(st){kt(a,a.return,st)}}break;case 3:if((e&1024)!==0){if(e=t.stateNode.containerInfo,a=e.nodeType,a===9)Qu(e);else if(a===1)switch(e.nodeName){case"HEAD":case"HTML":case"BODY":Qu(e);break;default:e.textContent=""}}break;case 5:case 26:case 27:case 6:case 4:case 17:break;default:if((e&1024)!==0)throw Error(u(163))}if(e=t.sibling,e!==null){e.return=t.return,on=e;break}on=t.return}}function Uh(e,t,a){var s=a.flags;switch(a.tag){case 0:case 11:case 15:Wa(e,a),s&4&&Yi(5,a);break;case 1:if(Wa(e,a),s&4)if(e=a.stateNode,t===null)try{e.componentDidMount()}catch(T){kt(a,a.return,T)}else{var c=ds(a.type,t.memoizedProps);t=t.memoizedState;try{e.componentDidUpdate(c,t,e.__reactInternalSnapshotBeforeUpdate)}catch(T){kt(a,a.return,T)}}s&64&&Ch(a),s&512&&Qi(a,a.return);break;case 3:if(Wa(e,a),s&64&&(e=a.updateQueue,e!==null)){if(t=null,a.child!==null)switch(a.child.tag){case 27:case 5:t=a.child.stateNode;break;case 1:t=a.child.stateNode}try{vf(e,t)}catch(T){kt(a,a.return,T)}}break;case 27:t===null&&s&4&&Rh(a);case 26:case 5:Wa(e,a),t===null&&s&4&&Oh(a),s&512&&Qi(a,a.return);break;case 12:Wa(e,a);break;case 31:Wa(e,a),s&4&&Bh(e,a);break;case 13:Wa(e,a),s&4&&Fh(e,a),s&64&&(e=a.memoizedState,e!==null&&(e=e.dehydrated,e!==null&&(a=ry.bind(null,a),jy(e,a))));break;case 22:if(s=a.memoizedState!==null||Za,!s){t=t!==null&&t.memoizedState!==null||en,c=Za;var h=en;Za=s,(en=t)&&!h?er(e,a,(a.subtreeFlags&8772)!==0):Wa(e,a),Za=c,en=h}break;case 30:break;default:Wa(e,a)}}function zh(e){var t=e.alternate;t!==null&&(e.alternate=null,zh(t)),e.child=null,e.deletions=null,e.sibling=null,e.tag===5&&(t=e.stateNode,t!==null&&or(t)),e.stateNode=null,e.return=null,e.dependencies=null,e.memoizedProps=null,e.memoizedState=null,e.pendingProps=null,e.stateNode=null,e.updateQueue=null}var Ht=null,Tn=!1;function Xa(e,t,a){for(a=a.child;a!==null;)Lh(e,t,a),a=a.sibling}function Lh(e,t,a){if(xt&&typeof xt.onCommitFiberUnmount=="function")try{xt.onCommitFiberUnmount(Je,a)}catch{}switch(a.tag){case 26:en||ka(a,t),Xa(e,t,a),a.memoizedState?a.memoizedState.count--:a.stateNode&&(a=a.stateNode,a.parentNode.removeChild(a));break;case 27:en||ka(a,t);var s=Ht,c=Tn;Rr(a.type)&&(Ht=a.stateNode,Tn=!1),Xa(e,t,a),el(a.stateNode),Ht=s,Tn=c;break;case 5:en||ka(a,t);case 6:if(s=Ht,c=Tn,Ht=null,Xa(e,t,a),Ht=s,Tn=c,Ht!==null)if(Tn)try{(Ht.nodeType===9?Ht.body:Ht.nodeName==="HTML"?Ht.ownerDocument.body:Ht).removeChild(a.stateNode)}catch(h){kt(a,t,h)}else try{Ht.removeChild(a.stateNode)}catch(h){kt(a,t,h)}break;case 18:Ht!==null&&(Tn?(e=Ht,Cm(e.nodeType===9?e.body:e.nodeName==="HTML"?e.ownerDocument.body:e,a.stateNode),ni(e)):Cm(Ht,a.stateNode));break;case 4:s=Ht,c=Tn,Ht=a.stateNode.containerInfo,Tn=!0,Xa(e,t,a),Ht=s,Tn=c;break;case 0:case 11:case 14:case 15:kr(2,a,t),en||kr(4,a,t),Xa(e,t,a);break;case 1:en||(ka(a,t),s=a.stateNode,typeof s.componentWillUnmount=="function"&&Dh(a,t,s)),Xa(e,t,a);break;case 21:Xa(e,t,a);break;case 22:en=(s=en)||a.memoizedState!==null,Xa(e,t,a),en=s;break;default:Xa(e,t,a)}}function Bh(e,t){if(t.memoizedState===null&&(e=t.alternate,e!==null&&(e=e.memoizedState,e!==null))){e=e.dehydrated;try{ni(e)}catch(a){kt(t,t.return,a)}}}function Fh(e,t){if(t.memoizedState===null&&(e=t.alternate,e!==null&&(e=e.memoizedState,e!==null&&(e=e.dehydrated,e!==null))))try{ni(e)}catch(a){kt(t,t.return,a)}}function Kx(e){switch(e.tag){case 31:case 13:case 19:var t=e.stateNode;return t===null&&(t=e.stateNode=new Mh),t;case 22:return e=e.stateNode,t=e._retryCache,t===null&&(t=e._retryCache=new Mh),t;default:throw Error(u(435,e.tag))}}function ro(e,t){var a=Kx(e);t.forEach(function(s){if(!a.has(s)){a.add(s);var c=sy.bind(null,e,s);s.then(c,c)}})}function Cn(e,t){var a=t.deletions;if(a!==null)for(var s=0;s<a.length;s++){var c=a[s],h=e,T=t,F=T;e:for(;F!==null;){switch(F.tag){case 27:if(Rr(F.type)){Ht=F.stateNode,Tn=!1;break e}break;case 5:Ht=F.stateNode,Tn=!1;break e;case 3:case 4:Ht=F.stateNode.containerInfo,Tn=!0;break e}F=F.return}if(Ht===null)throw Error(u(160));Lh(h,T,c),Ht=null,Tn=!1,h=c.alternate,h!==null&&(h.return=null),c.return=null}if(t.subtreeFlags&13886)for(t=t.child;t!==null;)qh(t,e),t=t.sibling}var ua=null;function qh(e,t){var a=e.alternate,s=e.flags;switch(e.tag){case 0:case 11:case 14:case 15:Cn(t,e),Dn(e),s&4&&(kr(3,e,e.return),Yi(3,e),kr(5,e,e.return));break;case 1:Cn(t,e),Dn(e),s&512&&(en||a===null||ka(a,a.return)),s&64&&Za&&(e=e.updateQueue,e!==null&&(s=e.callbacks,s!==null&&(a=e.shared.hiddenCallbacks,e.shared.hiddenCallbacks=a===null?s:a.concat(s))));break;case 26:var c=ua;if(Cn(t,e),Dn(e),s&512&&(en||a===null||ka(a,a.return)),s&4){var h=a!==null?a.memoizedState:null;if(s=e.memoizedState,a===null)if(s===null)if(e.stateNode===null){e:{s=e.type,a=e.memoizedProps,c=c.ownerDocument||c;t:switch(s){case"title":h=c.getElementsByTagName("title")[0],(!h||h[yn]||h[nn]||h.namespaceURI==="http://www.w3.org/2000/svg"||h.hasAttribute("itemprop"))&&(h=c.createElement(s),c.head.insertBefore(h,c.querySelector("head > title"))),pn(h,s,a),h[nn]=e,Bt(h),s=h;break e;case"link":var T=qm("link","href",c).get(s+(a.href||""));if(T){for(var F=0;F<T.length;F++)if(h=T[F],h.getAttribute("href")===(a.href==null||a.href===""?null:a.href)&&h.getAttribute("rel")===(a.rel==null?null:a.rel)&&h.getAttribute("title")===(a.title==null?null:a.title)&&h.getAttribute("crossorigin")===(a.crossOrigin==null?null:a.crossOrigin)){T.splice(F,1);break t}}h=c.createElement(s),pn(h,s,a),c.head.appendChild(h);break;case"meta":if(T=qm("meta","content",c).get(s+(a.content||""))){for(F=0;F<T.length;F++)if(h=T[F],h.getAttribute("content")===(a.content==null?null:""+a.content)&&h.getAttribute("name")===(a.name==null?null:a.name)&&h.getAttribute("property")===(a.property==null?null:a.property)&&h.getAttribute("http-equiv")===(a.httpEquiv==null?null:a.httpEquiv)&&h.getAttribute("charset")===(a.charSet==null?null:a.charSet)){T.splice(F,1);break t}}h=c.createElement(s),pn(h,s,a),c.head.appendChild(h);break;default:throw Error(u(468,s))}h[nn]=e,Bt(h),s=h}e.stateNode=s}else Hm(c,e.type,e.stateNode);else e.stateNode=Fm(c,s,e.memoizedProps);else h!==s?(h===null?a.stateNode!==null&&(a=a.stateNode,a.parentNode.removeChild(a)):h.count--,s===null?Hm(c,e.type,e.stateNode):Fm(c,s,e.memoizedProps)):s===null&&e.stateNode!==null&&xu(e,e.memoizedProps,a.memoizedProps)}break;case 27:Cn(t,e),Dn(e),s&512&&(en||a===null||ka(a,a.return)),a!==null&&s&4&&xu(e,e.memoizedProps,a.memoizedProps);break;case 5:if(Cn(t,e),Dn(e),s&512&&(en||a===null||ka(a,a.return)),e.flags&32){c=e.stateNode;try{za(c,"")}catch($e){kt(e,e.return,$e)}}s&4&&e.stateNode!=null&&(c=e.memoizedProps,xu(e,c,a!==null?a.memoizedProps:c)),s&1024&&(vu=!0);break;case 6:if(Cn(t,e),Dn(e),s&4){if(e.stateNode===null)throw Error(u(162));s=e.memoizedProps,a=e.stateNode;try{a.nodeValue=s}catch($e){kt(e,e.return,$e)}}break;case 3:if(wo=null,c=ua,ua=bo(t.containerInfo),Cn(t,e),ua=c,Dn(e),s&4&&a!==null&&a.memoizedState.isDehydrated)try{ni(t.containerInfo)}catch($e){kt(e,e.return,$e)}vu&&(vu=!1,Hh(e));break;case 4:s=ua,ua=bo(e.stateNode.containerInfo),Cn(t,e),Dn(e),ua=s;break;case 12:Cn(t,e),Dn(e);break;case 31:Cn(t,e),Dn(e),s&4&&(s=e.updateQueue,s!==null&&(e.updateQueue=null,ro(e,s)));break;case 13:Cn(t,e),Dn(e),e.child.flags&8192&&e.memoizedState!==null!=(a!==null&&a.memoizedState!==null)&&(io=Le()),s&4&&(s=e.updateQueue,s!==null&&(e.updateQueue=null,ro(e,s)));break;case 22:c=e.memoizedState!==null;var re=a!==null&&a.memoizedState!==null,be=Za,Te=en;if(Za=be||c,en=Te||re,Cn(t,e),en=Te,Za=be,Dn(e),s&8192)e:for(t=e.stateNode,t._visibility=c?t._visibility&-2:t._visibility|1,c&&(a===null||re||Za||en||fs(e)),a=null,t=e;;){if(t.tag===5||t.tag===26){if(a===null){re=a=t;try{if(h=re.stateNode,c)T=h.style,typeof T.setProperty=="function"?T.setProperty("display","none","important"):T.display="none";else{F=re.stateNode;var Ie=re.memoizedProps.style,Se=Ie!=null&&Ie.hasOwnProperty("display")?Ie.display:null;F.style.display=Se==null||typeof Se=="boolean"?"":(""+Se).trim()}}catch($e){kt(re,re.return,$e)}}}else if(t.tag===6){if(a===null){re=t;try{re.stateNode.nodeValue=c?"":re.memoizedProps}catch($e){kt(re,re.return,$e)}}}else if(t.tag===18){if(a===null){re=t;try{var ke=re.stateNode;c?Dm(ke,!0):Dm(re.stateNode,!1)}catch($e){kt(re,re.return,$e)}}}else if((t.tag!==22&&t.tag!==23||t.memoizedState===null||t===e)&&t.child!==null){t.child.return=t,t=t.child;continue}if(t===e)break e;for(;t.sibling===null;){if(t.return===null||t.return===e)break e;a===t&&(a=null),t=t.return}a===t&&(a=null),t.sibling.return=t.return,t=t.sibling}s&4&&(s=e.updateQueue,s!==null&&(a=s.retryQueue,a!==null&&(s.retryQueue=null,ro(e,a))));break;case 19:Cn(t,e),Dn(e),s&4&&(s=e.updateQueue,s!==null&&(e.updateQueue=null,ro(e,s)));break;case 30:break;case 21:break;default:Cn(t,e),Dn(e)}}function Dn(e){var t=e.flags;if(t&2){try{for(var a,s=e.return;s!==null;){if(Ih(s)){a=s;break}s=s.return}if(a==null)throw Error(u(160));switch(a.tag){case 27:var c=a.stateNode,h=yu(e);ao(e,h,c);break;case 5:var T=a.stateNode;a.flags&32&&(za(T,""),a.flags&=-33);var F=yu(e);ao(e,F,T);break;case 3:case 4:var re=a.stateNode.containerInfo,be=yu(e);bu(e,be,re);break;default:throw Error(u(161))}}catch(Te){kt(e,e.return,Te)}e.flags&=-3}t&4096&&(e.flags&=-4097)}function Hh(e){if(e.subtreeFlags&1024)for(e=e.child;e!==null;){var t=e;Hh(t),t.tag===5&&t.flags&1024&&t.stateNode.reset(),e=e.sibling}}function Wa(e,t){if(t.subtreeFlags&8772)for(t=t.child;t!==null;)Uh(e,t.alternate,t),t=t.sibling}function fs(e){for(e=e.child;e!==null;){var t=e;switch(t.tag){case 0:case 11:case 14:case 15:kr(4,t,t.return),fs(t);break;case 1:ka(t,t.return);var a=t.stateNode;typeof a.componentWillUnmount=="function"&&Dh(t,t.return,a),fs(t);break;case 27:el(t.stateNode);case 26:case 5:ka(t,t.return),fs(t);break;case 22:t.memoizedState===null&&fs(t);break;case 30:fs(t);break;default:fs(t)}e=e.sibling}}function er(e,t,a){for(a=a&&(t.subtreeFlags&8772)!==0,t=t.child;t!==null;){var s=t.alternate,c=e,h=t,T=h.flags;switch(h.tag){case 0:case 11:case 15:er(c,h,a),Yi(4,h);break;case 1:if(er(c,h,a),s=h,c=s.stateNode,typeof c.componentDidMount=="function")try{c.componentDidMount()}catch(be){kt(s,s.return,be)}if(s=h,c=s.updateQueue,c!==null){var F=s.stateNode;try{var re=c.shared.hiddenCallbacks;if(re!==null)for(c.shared.hiddenCallbacks=null,c=0;c<re.length;c++)bf(re[c],F)}catch(be){kt(s,s.return,be)}}a&&T&64&&Ch(h),Qi(h,h.return);break;case 27:Rh(h);case 26:case 5:er(c,h,a),a&&s===null&&T&4&&Oh(h),Qi(h,h.return);break;case 12:er(c,h,a);break;case 31:er(c,h,a),a&&T&4&&Bh(c,h);break;case 13:er(c,h,a),a&&T&4&&Fh(c,h);break;case 22:h.memoizedState===null&&er(c,h,a),Qi(h,h.return);break;case 30:break;default:er(c,h,a)}t=t.sibling}}function wu(e,t){var a=null;e!==null&&e.memoizedState!==null&&e.memoizedState.cachePool!==null&&(a=e.memoizedState.cachePool.pool),e=null,t.memoizedState!==null&&t.memoizedState.cachePool!==null&&(e=t.memoizedState.cachePool.pool),e!==a&&(e!=null&&e.refCount++,a!=null&&Di(a))}function Su(e,t){e=null,t.alternate!==null&&(e=t.alternate.memoizedState.cache),t=t.memoizedState.cache,t!==e&&(t.refCount++,e!=null&&Di(e))}function da(e,t,a,s){if(t.subtreeFlags&10256)for(t=t.child;t!==null;)Gh(e,t,a,s),t=t.sibling}function Gh(e,t,a,s){var c=t.flags;switch(t.tag){case 0:case 11:case 15:da(e,t,a,s),c&2048&&Yi(9,t);break;case 1:da(e,t,a,s);break;case 3:da(e,t,a,s),c&2048&&(e=null,t.alternate!==null&&(e=t.alternate.memoizedState.cache),t=t.memoizedState.cache,t!==e&&(t.refCount++,e!=null&&Di(e)));break;case 12:if(c&2048){da(e,t,a,s),e=t.stateNode;try{var h=t.memoizedProps,T=h.id,F=h.onPostCommit;typeof F=="function"&&F(T,t.alternate===null?"mount":"update",e.passiveEffectDuration,-0)}catch(re){kt(t,t.return,re)}}else da(e,t,a,s);break;case 31:da(e,t,a,s);break;case 13:da(e,t,a,s);break;case 23:break;case 22:h=t.stateNode,T=t.alternate,t.memoizedState!==null?h._visibility&2?da(e,t,a,s):$i(e,t):h._visibility&2?da(e,t,a,s):(h._visibility|=2,Qs(e,t,a,s,(t.subtreeFlags&10256)!==0||!1)),c&2048&&wu(T,t);break;case 24:da(e,t,a,s),c&2048&&Su(t.alternate,t);break;default:da(e,t,a,s)}}function Qs(e,t,a,s,c){for(c=c&&((t.subtreeFlags&10256)!==0||!1),t=t.child;t!==null;){var h=e,T=t,F=a,re=s,be=T.flags;switch(T.tag){case 0:case 11:case 15:Qs(h,T,F,re,c),Yi(8,T);break;case 23:break;case 22:var Te=T.stateNode;T.memoizedState!==null?Te._visibility&2?Qs(h,T,F,re,c):$i(h,T):(Te._visibility|=2,Qs(h,T,F,re,c)),c&&be&2048&&wu(T.alternate,T);break;case 24:Qs(h,T,F,re,c),c&&be&2048&&Su(T.alternate,T);break;default:Qs(h,T,F,re,c)}t=t.sibling}}function $i(e,t){if(t.subtreeFlags&10256)for(t=t.child;t!==null;){var a=e,s=t,c=s.flags;switch(s.tag){case 22:$i(a,s),c&2048&&wu(s.alternate,s);break;case 24:$i(a,s),c&2048&&Su(s.alternate,s);break;default:$i(a,s)}t=t.sibling}}var Pi=8192;function $s(e,t,a){if(e.subtreeFlags&Pi)for(e=e.child;e!==null;)Yh(e,t,a),e=e.sibling}function Yh(e,t,a){switch(e.tag){case 26:$s(e,t,a),e.flags&Pi&&e.memoizedState!==null&&Uy(a,ua,e.memoizedState,e.memoizedProps);break;case 5:$s(e,t,a);break;case 3:case 4:var s=ua;ua=bo(e.stateNode.containerInfo),$s(e,t,a),ua=s;break;case 22:e.memoizedState===null&&(s=e.alternate,s!==null&&s.memoizedState!==null?(s=Pi,Pi=16777216,$s(e,t,a),Pi=s):$s(e,t,a));break;default:$s(e,t,a)}}function Qh(e){var t=e.alternate;if(t!==null&&(e=t.child,e!==null)){t.child=null;do t=e.sibling,e.sibling=null,e=t;while(e!==null)}}function Ji(e){var t=e.deletions;if((e.flags&16)!==0){if(t!==null)for(var a=0;a<t.length;a++){var s=t[a];on=s,Ph(s,e)}Qh(e)}if(e.subtreeFlags&10256)for(e=e.child;e!==null;)$h(e),e=e.sibling}function $h(e){switch(e.tag){case 0:case 11:case 15:Ji(e),e.flags&2048&&kr(9,e,e.return);break;case 3:Ji(e);break;case 12:Ji(e);break;case 22:var t=e.stateNode;e.memoizedState!==null&&t._visibility&2&&(e.return===null||e.return.tag!==13)?(t._visibility&=-3,so(e)):Ji(e);break;default:Ji(e)}}function so(e){var t=e.deletions;if((e.flags&16)!==0){if(t!==null)for(var a=0;a<t.length;a++){var s=t[a];on=s,Ph(s,e)}Qh(e)}for(e=e.child;e!==null;){switch(t=e,t.tag){case 0:case 11:case 15:kr(8,t,t.return),so(t);break;case 22:a=t.stateNode,a._visibility&2&&(a._visibility&=-3,so(t));break;default:so(t)}e=e.sibling}}function Ph(e,t){for(;on!==null;){var a=on;switch(a.tag){case 0:case 11:case 15:kr(8,a,t);break;case 23:case 22:if(a.memoizedState!==null&&a.memoizedState.cachePool!==null){var s=a.memoizedState.cachePool.pool;s!=null&&s.refCount++}break;case 24:Di(a.memoizedState.cache)}if(s=a.child,s!==null)s.return=a,on=s;else e:for(a=e;on!==null;){s=on;var c=s.sibling,h=s.return;if(zh(s),s===a){on=null;break e}if(c!==null){c.return=h,on=c;break e}on=h}}}var Zx={getCacheForType:function(e){var t=hn(Zt),a=t.data.get(e);return a===void 0&&(a=e(),t.data.set(e,a)),a},cacheSignal:function(){return hn(Zt).controller.signal}},Xx=typeof WeakMap=="function"?WeakMap:Map,jt=0,It=null,ft=null,pt=0,_t=0,Gn=null,Ar=!1,Ps=!1,Eu=!1,tr=0,$t=0,Tr=0,hs=0,ju=0,Yn=0,Js=0,Vi=null,On=null,Nu=!1,io=0,Jh=0,lo=1/0,oo=null,Cr=null,rn=0,Dr=null,Vs=null,nr=0,_u=0,ku=null,Vh=null,Ki=0,Au=null;function Qn(){return(jt&2)!==0&&pt!==0?pt&-pt:z.T!==null?Ru():Oa()}function Kh(){if(Yn===0)if((pt&536870912)===0||bt){var e=ba;ba<<=1,(ba&3932160)===0&&(ba=262144),Yn=e}else Yn=536870912;return e=qn.current,e!==null&&(e.flags|=32),Yn}function In(e,t,a){(e===It&&(_t===2||_t===9)||e.cancelPendingCommit!==null)&&(Ks(e,0),Or(e,pt,Yn,!1)),ia(e,a),((jt&2)===0||e!==It)&&(e===It&&((jt&2)===0&&(hs|=a),$t===4&&Or(e,pt,Yn,!1)),Aa(e))}function Zh(e,t,a){if((jt&6)!==0)throw Error(u(327));var s=!a&&(t&127)===0&&(t&e.expiredLanes)===0||lr(e,t),c=s?ty(e,t):Cu(e,t,!0),h=s;do{if(c===0){Ps&&!s&&Or(e,t,0,!1);break}else{if(a=e.current.alternate,h&&!Wx(a)){c=Cu(e,t,!1),h=!1;continue}if(c===2){if(h=t,e.errorRecoveryDisabledLanes&h)var T=0;else T=e.pendingLanes&-536870913,T=T!==0?T:T&536870912?536870912:0;if(T!==0){t=T;e:{var F=e;c=Vi;var re=F.current.memoizedState.isDehydrated;if(re&&(Ks(F,T).flags|=256),T=Cu(F,T,!1),T!==2){if(Eu&&!re){F.errorRecoveryDisabledLanes|=h,hs|=h,c=4;break e}h=On,On=c,h!==null&&(On===null?On=h:On.push.apply(On,h))}c=T}if(h=!1,c!==2)continue}}if(c===1){Ks(e,0),Or(e,t,0,!0);break}e:{switch(s=e,h=c,h){case 0:case 1:throw Error(u(345));case 4:if((t&4194048)!==t)break;case 6:Or(s,t,Yn,!Ar);break e;case 2:On=null;break;case 3:case 5:break;default:throw Error(u(329))}if((t&62914560)===t&&(c=io+300-Le(),10<c)){if(Or(s,t,Yn,!Ar),Un(s,0,!0)!==0)break e;nr=t,s.timeoutHandle=Am(Xh.bind(null,s,a,On,oo,Nu,t,Yn,hs,Js,Ar,h,"Throttled",-0,0),c);break e}Xh(s,a,On,oo,Nu,t,Yn,hs,Js,Ar,h,null,-0,0)}}break}while(!0);Aa(e)}function Xh(e,t,a,s,c,h,T,F,re,be,Te,Ie,Se,ke){if(e.timeoutHandle=-1,Ie=t.subtreeFlags,Ie&8192||(Ie&16785408)===16785408){Ie={stylesheets:null,count:0,imgCount:0,imgBytes:0,suspenseyImages:[],waitingForImages:!0,waitingForViewTransition:!1,unsuspend:an},Yh(t,h,Ie);var $e=(h&62914560)===h?io-Le():(h&4194048)===h?Jh-Le():0;if($e=zy(Ie,$e),$e!==null){nr=h,e.cancelPendingCommit=$e(im.bind(null,e,t,h,a,s,c,T,F,re,Te,Ie,null,Se,ke)),Or(e,h,T,!be);return}}im(e,t,h,a,s,c,T,F,re)}function Wx(e){for(var t=e;;){var a=t.tag;if((a===0||a===11||a===15)&&t.flags&16384&&(a=t.updateQueue,a!==null&&(a=a.stores,a!==null)))for(var s=0;s<a.length;s++){var c=a[s],h=c.getSnapshot;c=c.value;try{if(!Bn(h(),c))return!1}catch{return!1}}if(a=t.child,t.subtreeFlags&16384&&a!==null)a.return=t,t=a;else{if(t===e)break;for(;t.sibling===null;){if(t.return===null||t.return===e)return!0;t=t.return}t.sibling.return=t.return,t=t.sibling}}return!0}function Or(e,t,a,s){t&=~ju,t&=~hs,e.suspendedLanes|=t,e.pingedLanes&=~t,s&&(e.warmLanes|=t),s=e.expirationTimes;for(var c=t;0<c;){var h=31-vt(c),T=1<<h;s[h]=-1,c&=~T}a!==0&&ci(e,a,t)}function co(){return(jt&6)===0?(Zi(0),!1):!0}function Tu(){if(ft!==null){if(_t===0)var e=ft.return;else e=ft,Qa=rs=null,Qc(e),Fs=null,Ii=0,e=ft;for(;e!==null;)Th(e.alternate,e),e=e.return;ft=null}}function Ks(e,t){var a=e.timeoutHandle;a!==-1&&(e.timeoutHandle=-1,by(a)),a=e.cancelPendingCommit,a!==null&&(e.cancelPendingCommit=null,a()),nr=0,Tu(),It=e,ft=a=Ga(e.current,null),pt=t,_t=0,Gn=null,Ar=!1,Ps=lr(e,t),Eu=!1,Js=Yn=ju=hs=Tr=$t=0,On=Vi=null,Nu=!1,(t&8)!==0&&(t|=t&32);var s=e.entangledLanes;if(s!==0)for(e=e.entanglements,s&=t;0<s;){var c=31-vt(s),h=1<<c;t|=e[c],s&=~h}return tr=t,Cl(),a}function Wh(e,t){ct=null,z.H=qi,t===Bs||t===Ll?(t=pf(),_t=3):t===Ic?(t=pf(),_t=4):_t=t===lu?8:t!==null&&typeof t=="object"&&typeof t.then=="function"?6:1,Gn=t,ft===null&&($t=1,Xl(e,Kn(t,e.current)))}function em(){var e=qn.current;return e===null?!0:(pt&4194048)===pt?ea===null:(pt&62914560)===pt||(pt&536870912)!==0?e===ea:!1}function tm(){var e=z.H;return z.H=qi,e===null?qi:e}function nm(){var e=z.A;return z.A=Zx,e}function uo(){$t=4,Ar||(pt&4194048)!==pt&&qn.current!==null||(Ps=!0),(Tr&134217727)===0&&(hs&134217727)===0||It===null||Or(It,pt,Yn,!1)}function Cu(e,t,a){var s=jt;jt|=2;var c=tm(),h=nm();(It!==e||pt!==t)&&(oo=null,Ks(e,t)),t=!1;var T=$t;e:do try{if(_t!==0&&ft!==null){var F=ft,re=Gn;switch(_t){case 8:Tu(),T=6;break e;case 3:case 2:case 9:case 6:qn.current===null&&(t=!0);var be=_t;if(_t=0,Gn=null,Zs(e,F,re,be),a&&Ps){T=0;break e}break;default:be=_t,_t=0,Gn=null,Zs(e,F,re,be)}}ey(),T=$t;break}catch(Te){Wh(e,Te)}while(!0);return t&&e.shellSuspendCounter++,Qa=rs=null,jt=s,z.H=c,z.A=h,ft===null&&(It=null,pt=0,Cl()),T}function ey(){for(;ft!==null;)am(ft)}function ty(e,t){var a=jt;jt|=2;var s=tm(),c=nm();It!==e||pt!==t?(oo=null,lo=Le()+500,Ks(e,t)):Ps=lr(e,t);e:do try{if(_t!==0&&ft!==null){t=ft;var h=Gn;t:switch(_t){case 1:_t=0,Gn=null,Zs(e,t,h,1);break;case 2:case 9:if(hf(h)){_t=0,Gn=null,rm(t);break}t=function(){_t!==2&&_t!==9||It!==e||(_t=7),Aa(e)},h.then(t,t);break e;case 3:_t=7;break e;case 4:_t=5;break e;case 7:hf(h)?(_t=0,Gn=null,rm(t)):(_t=0,Gn=null,Zs(e,t,h,7));break;case 5:var T=null;switch(ft.tag){case 26:T=ft.memoizedState;case 5:case 27:var F=ft;if(T?Gm(T):F.stateNode.complete){_t=0,Gn=null;var re=F.sibling;if(re!==null)ft=re;else{var be=F.return;be!==null?(ft=be,fo(be)):ft=null}break t}}_t=0,Gn=null,Zs(e,t,h,5);break;case 6:_t=0,Gn=null,Zs(e,t,h,6);break;case 8:Tu(),$t=6;break e;default:throw Error(u(462))}}ny();break}catch(Te){Wh(e,Te)}while(!0);return Qa=rs=null,z.H=s,z.A=c,jt=a,ft!==null?0:(It=null,pt=0,Cl(),$t)}function ny(){for(;ft!==null&&!de();)am(ft)}function am(e){var t=kh(e.alternate,e,tr);e.memoizedProps=e.pendingProps,t===null?fo(e):ft=t}function rm(e){var t=e,a=t.alternate;switch(t.tag){case 15:case 0:t=wh(a,t,t.pendingProps,t.type,void 0,pt);break;case 11:t=wh(a,t,t.pendingProps,t.type.render,t.ref,pt);break;case 5:Qc(t);default:Th(a,t),t=ft=tf(t,tr),t=kh(a,t,tr)}e.memoizedProps=e.pendingProps,t===null?fo(e):ft=t}function Zs(e,t,a,s){Qa=rs=null,Qc(t),Fs=null,Ii=0;var c=t.return;try{if(Yx(e,c,t,a,pt)){$t=1,Xl(e,Kn(a,e.current)),ft=null;return}}catch(h){if(c!==null)throw ft=c,h;$t=1,Xl(e,Kn(a,e.current)),ft=null;return}t.flags&32768?(bt||s===1?e=!0:Ps||(pt&536870912)!==0?e=!1:(Ar=e=!0,(s===2||s===9||s===3||s===6)&&(s=qn.current,s!==null&&s.tag===13&&(s.flags|=16384))),sm(t,e)):fo(t)}function fo(e){var t=e;do{if((t.flags&32768)!==0){sm(t,Ar);return}e=t.return;var a=Px(t.alternate,t,tr);if(a!==null){ft=a;return}if(t=t.sibling,t!==null){ft=t;return}ft=t=e}while(t!==null);$t===0&&($t=5)}function sm(e,t){do{var a=Jx(e.alternate,e);if(a!==null){a.flags&=32767,ft=a;return}if(a=e.return,a!==null&&(a.flags|=32768,a.subtreeFlags=0,a.deletions=null),!t&&(e=e.sibling,e!==null)){ft=e;return}ft=e=a}while(e!==null);$t=6,ft=null}function im(e,t,a,s,c,h,T,F,re){e.cancelPendingCommit=null;do ho();while(rn!==0);if((jt&6)!==0)throw Error(u(327));if(t!==null){if(t===e.current)throw Error(u(177));if(h=t.lanes|t.childLanes,h|=yc,oi(e,a,h,T,F,re),e===It&&(ft=It=null,pt=0),Vs=t,Dr=e,nr=a,_u=h,ku=c,Vh=s,(t.subtreeFlags&10256)!==0||(t.flags&10256)!==0?(e.callbackNode=null,e.callbackPriority=0,iy(He,function(){return dm(),null})):(e.callbackNode=null,e.callbackPriority=0),s=(t.flags&13878)!==0,(t.subtreeFlags&13878)!==0||s){s=z.T,z.T=null,c=Q.p,Q.p=2,T=jt,jt|=4;try{Vx(e,t,a)}finally{jt=T,Q.p=c,z.T=s}}rn=1,lm(),om(),cm()}}function lm(){if(rn===1){rn=0;var e=Dr,t=Vs,a=(t.flags&13878)!==0;if((t.subtreeFlags&13878)!==0||a){a=z.T,z.T=null;var s=Q.p;Q.p=2;var c=jt;jt|=4;try{qh(t,e);var h=Hu,T=$d(e.containerInfo),F=h.focusedElem,re=h.selectionRange;if(T!==F&&F&&F.ownerDocument&&Qd(F.ownerDocument.documentElement,F)){if(re!==null&&hc(F)){var be=re.start,Te=re.end;if(Te===void 0&&(Te=be),"selectionStart"in F)F.selectionStart=be,F.selectionEnd=Math.min(Te,F.value.length);else{var Ie=F.ownerDocument||document,Se=Ie&&Ie.defaultView||window;if(Se.getSelection){var ke=Se.getSelection(),$e=F.textContent.length,st=Math.min(re.start,$e),Dt=re.end===void 0?st:Math.min(re.end,$e);!ke.extend&&st>Dt&&(T=Dt,Dt=st,st=T);var me=Yd(F,st),le=Yd(F,Dt);if(me&&le&&(ke.rangeCount!==1||ke.anchorNode!==me.node||ke.anchorOffset!==me.offset||ke.focusNode!==le.node||ke.focusOffset!==le.offset)){var ye=Ie.createRange();ye.setStart(me.node,me.offset),ke.removeAllRanges(),st>Dt?(ke.addRange(ye),ke.extend(le.node,le.offset)):(ye.setEnd(le.node,le.offset),ke.addRange(ye))}}}}for(Ie=[],ke=F;ke=ke.parentNode;)ke.nodeType===1&&Ie.push({element:ke,left:ke.scrollLeft,top:ke.scrollTop});for(typeof F.focus=="function"&&F.focus(),F=0;F<Ie.length;F++){var Oe=Ie[F];Oe.element.scrollLeft=Oe.left,Oe.element.scrollTop=Oe.top}}No=!!qu,Hu=qu=null}finally{jt=c,Q.p=s,z.T=a}}e.current=t,rn=2}}function om(){if(rn===2){rn=0;var e=Dr,t=Vs,a=(t.flags&8772)!==0;if((t.subtreeFlags&8772)!==0||a){a=z.T,z.T=null;var s=Q.p;Q.p=2;var c=jt;jt|=4;try{Uh(e,t.alternate,t)}finally{jt=c,Q.p=s,z.T=a}}rn=3}}function cm(){if(rn===4||rn===3){rn=0,Ue();var e=Dr,t=Vs,a=nr,s=Vh;(t.subtreeFlags&10256)!==0||(t.flags&10256)!==0?rn=5:(rn=0,Vs=Dr=null,um(e,e.pendingLanes));var c=e.pendingLanes;if(c===0&&(Cr=null),bs(a),t=t.stateNode,xt&&typeof xt.onCommitFiberRoot=="function")try{xt.onCommitFiberRoot(Je,t,void 0,(t.current.flags&128)===128)}catch{}if(s!==null){t=z.T,c=Q.p,Q.p=2,z.T=null;try{for(var h=e.onRecoverableError,T=0;T<s.length;T++){var F=s[T];h(F.value,{componentStack:F.stack})}}finally{z.T=t,Q.p=c}}(nr&3)!==0&&ho(),Aa(e),c=e.pendingLanes,(a&261930)!==0&&(c&42)!==0?e===Au?Ki++:(Ki=0,Au=e):Ki=0,Zi(0)}}function um(e,t){(e.pooledCacheLanes&=t)===0&&(t=e.pooledCache,t!=null&&(e.pooledCache=null,Di(t)))}function ho(){return lm(),om(),cm(),dm()}function dm(){if(rn!==5)return!1;var e=Dr,t=_u;_u=0;var a=bs(nr),s=z.T,c=Q.p;try{Q.p=32>a?32:a,z.T=null,a=ku,ku=null;var h=Dr,T=nr;if(rn=0,Vs=Dr=null,nr=0,(jt&6)!==0)throw Error(u(331));var F=jt;if(jt|=4,$h(h.current),Gh(h,h.current,T,a),jt=F,Zi(0,!1),xt&&typeof xt.onPostCommitFiberRoot=="function")try{xt.onPostCommitFiberRoot(Je,h)}catch{}return!0}finally{Q.p=c,z.T=s,um(e,t)}}function fm(e,t,a){t=Kn(a,t),t=iu(e.stateNode,t,2),e=jr(e,t,2),e!==null&&(ia(e,2),Aa(e))}function kt(e,t,a){if(e.tag===3)fm(e,e,a);else for(;t!==null;){if(t.tag===3){fm(t,e,a);break}else if(t.tag===1){var s=t.stateNode;if(typeof t.type.getDerivedStateFromError=="function"||typeof s.componentDidCatch=="function"&&(Cr===null||!Cr.has(s))){e=Kn(a,e),a=hh(2),s=jr(t,a,2),s!==null&&(mh(a,s,t,e),ia(s,2),Aa(s));break}}t=t.return}}function Du(e,t,a){var s=e.pingCache;if(s===null){s=e.pingCache=new Xx;var c=new Set;s.set(t,c)}else c=s.get(t),c===void 0&&(c=new Set,s.set(t,c));c.has(a)||(Eu=!0,c.add(a),e=ay.bind(null,e,t,a),t.then(e,e))}function ay(e,t,a){var s=e.pingCache;s!==null&&s.delete(t),e.pingedLanes|=e.suspendedLanes&a,e.warmLanes&=~a,It===e&&(pt&a)===a&&($t===4||$t===3&&(pt&62914560)===pt&&300>Le()-io?(jt&2)===0&&Ks(e,0):ju|=a,Js===pt&&(Js=0)),Aa(e)}function hm(e,t){t===0&&(t=ys()),e=ts(e,t),e!==null&&(ia(e,t),Aa(e))}function ry(e){var t=e.memoizedState,a=0;t!==null&&(a=t.retryLane),hm(e,a)}function sy(e,t){var a=0;switch(e.tag){case 31:case 13:var s=e.stateNode,c=e.memoizedState;c!==null&&(a=c.retryLane);break;case 19:s=e.stateNode;break;case 22:s=e.stateNode._retryCache;break;default:throw Error(u(314))}s!==null&&s.delete(t),hm(e,a)}function iy(e,t){return fe(e,t)}var mo=null,Xs=null,Ou=!1,po=!1,Iu=!1,Ir=0;function Aa(e){e!==Xs&&e.next===null&&(Xs===null?mo=Xs=e:Xs=Xs.next=e),po=!0,Ou||(Ou=!0,oy())}function Zi(e,t){if(!Iu&&po){Iu=!0;do for(var a=!1,s=mo;s!==null;){if(e!==0){var c=s.pendingLanes;if(c===0)var h=0;else{var T=s.suspendedLanes,F=s.pingedLanes;h=(1<<31-vt(42|e)+1)-1,h&=c&~(T&~F),h=h&201326741?h&201326741|1:h?h|2:0}h!==0&&(a=!0,xm(s,h))}else h=pt,h=Un(s,s===It?h:0,s.cancelPendingCommit!==null||s.timeoutHandle!==-1),(h&3)===0||lr(s,h)||(a=!0,xm(s,h));s=s.next}while(a);Iu=!1}}function ly(){mm()}function mm(){po=Ou=!1;var e=0;Ir!==0&&yy()&&(e=Ir);for(var t=Le(),a=null,s=mo;s!==null;){var c=s.next,h=pm(s,t);h===0?(s.next=null,a===null?mo=c:a.next=c,c===null&&(Xs=a)):(a=s,(e!==0||(h&3)!==0)&&(po=!0)),s=c}rn!==0&&rn!==5||Zi(e),Ir!==0&&(Ir=0)}function pm(e,t){for(var a=e.suspendedLanes,s=e.pingedLanes,c=e.expirationTimes,h=e.pendingLanes&-62914561;0<h;){var T=31-vt(h),F=1<<T,re=c[T];re===-1?((F&a)===0||(F&s)!==0)&&(c[T]=Ye(F,t)):re<=t&&(e.expiredLanes|=F),h&=~F}if(t=It,a=pt,a=Un(e,e===t?a:0,e.cancelPendingCommit!==null||e.timeoutHandle!==-1),s=e.callbackNode,a===0||e===t&&(_t===2||_t===9)||e.cancelPendingCommit!==null)return s!==null&&s!==null&&Ae(s),e.callbackNode=null,e.callbackPriority=0;if((a&3)===0||lr(e,a)){if(t=a&-a,t===e.callbackPriority)return t;switch(s!==null&&Ae(s),bs(a)){case 2:case 8:a=Be;break;case 32:a=He;break;case 268435456:a=qe;break;default:a=He}return s=gm.bind(null,e),a=fe(a,s),e.callbackPriority=t,e.callbackNode=a,t}return s!==null&&s!==null&&Ae(s),e.callbackPriority=2,e.callbackNode=null,2}function gm(e,t){if(rn!==0&&rn!==5)return e.callbackNode=null,e.callbackPriority=0,null;var a=e.callbackNode;if(ho()&&e.callbackNode!==a)return null;var s=pt;return s=Un(e,e===It?s:0,e.cancelPendingCommit!==null||e.timeoutHandle!==-1),s===0?null:(Zh(e,s,t),pm(e,Le()),e.callbackNode!=null&&e.callbackNode===a?gm.bind(null,e):null)}function xm(e,t){if(ho())return null;Zh(e,t,!0)}function oy(){vy(function(){(jt&6)!==0?fe(pe,ly):mm()})}function Ru(){if(Ir===0){var e=zs;e===0&&(e=ya,ya<<=1,(ya&261888)===0&&(ya=256)),Ir=e}return Ir}function ym(e){return e==null||typeof e=="symbol"||typeof e=="boolean"?null:typeof e=="function"?e:mr(""+e)}function bm(e,t){var a=t.ownerDocument.createElement("input");return a.name=t.name,a.value=t.value,e.id&&a.setAttribute("form",e.id),t.parentNode.insertBefore(a,t),e=new FormData(e),a.parentNode.removeChild(a),e}function cy(e,t,a,s,c){if(t==="submit"&&a&&a.stateNode===c){var h=ym((c[Nt]||null).action),T=s.submitter;T&&(t=(t=T[Nt]||null)?ym(t.formAction):T.getAttribute("formAction"),t!==null&&(h=t,T=null));var F=new De("action","action",null,s,c);e.push({event:F,listeners:[{instance:null,listener:function(){if(s.defaultPrevented){if(Ir!==0){var re=T?bm(c,T):new FormData(c);eu(a,{pending:!0,data:re,method:c.method,action:h},null,re)}}else typeof h=="function"&&(F.preventDefault(),re=T?bm(c,T):new FormData(c),eu(a,{pending:!0,data:re,method:c.method,action:h},h,re))},currentTarget:c}]})}}for(var Mu=0;Mu<xc.length;Mu++){var Uu=xc[Mu],uy=Uu.toLowerCase(),dy=Uu[0].toUpperCase()+Uu.slice(1);ca(uy,"on"+dy)}ca(Vd,"onAnimationEnd"),ca(Kd,"onAnimationIteration"),ca(Zd,"onAnimationStart"),ca("dblclick","onDoubleClick"),ca("focusin","onFocus"),ca("focusout","onBlur"),ca(kx,"onTransitionRun"),ca(Ax,"onTransitionStart"),ca(Tx,"onTransitionCancel"),ca(Xd,"onTransitionEnd"),zn("onMouseEnter",["mouseout","mouseover"]),zn("onMouseLeave",["mouseout","mouseover"]),zn("onPointerEnter",["pointerout","pointerover"]),zn("onPointerLeave",["pointerout","pointerover"]),Sa("onChange","change click focusin focusout input keydown keyup selectionchange".split(" ")),Sa("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" ")),Sa("onBeforeInput",["compositionend","keypress","textInput","paste"]),Sa("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" ")),Sa("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" ")),Sa("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var Xi="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),fy=new Set("beforetoggle cancel close invalid load scroll scrollend toggle".split(" ").concat(Xi));function vm(e,t){t=(t&4)!==0;for(var a=0;a<e.length;a++){var s=e[a],c=s.event;s=s.listeners;e:{var h=void 0;if(t)for(var T=s.length-1;0<=T;T--){var F=s[T],re=F.instance,be=F.currentTarget;if(F=F.listener,re!==h&&c.isPropagationStopped())break e;h=F,c.currentTarget=be;try{h(c)}catch(Te){Tl(Te)}c.currentTarget=null,h=re}else for(T=0;T<s.length;T++){if(F=s[T],re=F.instance,be=F.currentTarget,F=F.listener,re!==h&&c.isPropagationStopped())break e;h=F,c.currentTarget=be;try{h(c)}catch(Te){Tl(Te)}c.currentTarget=null,h=re}}}}function ht(e,t){var a=t[fi];a===void 0&&(a=t[fi]=new Set);var s=e+"__bubble";a.has(s)||(wm(t,e,2,!1),a.add(s))}function zu(e,t,a){var s=0;t&&(s|=4),wm(a,e,s,t)}var go="_reactListening"+Math.random().toString(36).slice(2);function Lu(e){if(!e[go]){e[go]=!0,mi.forEach(function(a){a!=="selectionchange"&&(fy.has(a)||zu(a,!1,e),zu(a,!0,e))});var t=e.nodeType===9?e:e.ownerDocument;t===null||t[go]||(t[go]=!0,zu("selectionchange",!1,t))}}function wm(e,t,a,s){switch(Km(t)){case 2:var c=Fy;break;case 8:c=qy;break;default:c=Wu}a=c.bind(null,t,a,e),c=void 0,!Fa||t!=="touchstart"&&t!=="touchmove"&&t!=="wheel"||(c=!0),s?c!==void 0?e.addEventListener(t,a,{capture:!0,passive:c}):e.addEventListener(t,a,!0):c!==void 0?e.addEventListener(t,a,{passive:c}):e.addEventListener(t,a,!1)}function Bu(e,t,a,s,c){var h=s;if((t&1)===0&&(t&2)===0&&s!==null)e:for(;;){if(s===null)return;var T=s.tag;if(T===3||T===4){var F=s.stateNode.containerInfo;if(F===c)break;if(T===4)for(T=s.return;T!==null;){var re=T.tag;if((re===3||re===4)&&T.stateNode.containerInfo===c)return;T=T.return}for(;F!==null;){if(T=wa(F),T===null)return;if(re=T.tag,re===5||re===6||re===26||re===27){s=h=T;continue e}F=F.parentNode}}s=s.return}Vr(function(){var be=h,Te=pr(a),Ie=[];e:{var Se=Wd.get(e);if(Se!==void 0){var ke=De,$e=e;switch(e){case"keypress":if(v(a)===0)break e;case"keydown":case"keyup":ke=nc;break;case"focusin":$e="focus",ke=Si;break;case"focusout":$e="blur",ke=Si;break;case"beforeblur":case"afterblur":ke=Si;break;case"click":if(a.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":ke=wl;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":ke=$o;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":ke=rc;break;case Vd:case Kd:case Zd:ke=Jo;break;case Xd:ke=ic;break;case"scroll":case"scrollend":ke=yt;break;case"wheel":ke=oc;break;case"copy":case"cut":case"paste":ke=Ko;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":ke=_l;break;case"toggle":case"beforetoggle":ke=Al}var st=(t&4)!==0,Dt=!st&&(e==="scroll"||e==="scrollend"),me=st?Se!==null?Se+"Capture":null:Se;st=[];for(var le=be,ye;le!==null;){var Oe=le;if(ye=Oe.stateNode,Oe=Oe.tag,Oe!==5&&Oe!==26&&Oe!==27||ye===null||me===null||(Oe=ja(le,me),Oe!=null&&st.push(Wi(le,Oe,ye))),Dt)break;le=le.return}0<st.length&&(Se=new ke(Se,$e,null,a,Te),Ie.push({event:Se,listeners:st}))}}if((t&7)===0){e:{if(Se=e==="mouseover"||e==="pointerover",ke=e==="mouseout"||e==="pointerout",Se&&a!==Ea&&($e=a.relatedTarget||a.fromElement)&&(wa($e)||$e[Ia]))break e;if((ke||Se)&&(Se=Te.window===Te?Te:(Se=Te.ownerDocument)?Se.defaultView||Se.parentWindow:window,ke?($e=a.relatedTarget||a.toElement,ke=be,$e=$e?wa($e):null,$e!==null&&(Dt=i($e),st=$e.tag,$e!==Dt||st!==5&&st!==27&&st!==6)&&($e=null)):(ke=null,$e=be),ke!==$e)){if(st=wl,Oe="onMouseLeave",me="onMouseEnter",le="mouse",(e==="pointerout"||e==="pointerover")&&(st=_l,Oe="onPointerLeave",me="onPointerEnter",le="pointer"),Dt=ke==null?Se:cr(ke),ye=$e==null?Se:cr($e),Se=new st(Oe,le+"leave",ke,a,Te),Se.target=Dt,Se.relatedTarget=ye,Oe=null,wa(Te)===be&&(st=new st(me,le+"enter",$e,a,Te),st.target=ye,st.relatedTarget=Dt,Oe=st),Dt=Oe,ke&&$e)t:{for(st=hy,me=ke,le=$e,ye=0,Oe=me;Oe;Oe=st(Oe))ye++;Oe=0;for(var tt=le;tt;tt=st(tt))Oe++;for(;0<ye-Oe;)me=st(me),ye--;for(;0<Oe-ye;)le=st(le),Oe--;for(;ye--;){if(me===le||le!==null&&me===le.alternate){st=me;break t}me=st(me),le=st(le)}st=null}else st=null;ke!==null&&Sm(Ie,Se,ke,st,!1),$e!==null&&Dt!==null&&Sm(Ie,Dt,$e,st,!0)}}e:{if(Se=be?cr(be):window,ke=Se.nodeName&&Se.nodeName.toLowerCase(),ke==="select"||ke==="input"&&Se.type==="file")var St=Ld;else if(Nn(Se))if(Bd)St=jx;else{St=Sx;var Ke=wx}else ke=Se.nodeName,!ke||ke.toLowerCase()!=="input"||Se.type!=="checkbox"&&Se.type!=="radio"?be&&hr(be.elementType)&&(St=Ld):St=Ex;if(St&&(St=St(e,be))){bn(Ie,St,a,Te);break e}Ke&&Ke(e,Se,be),e==="focusout"&&be&&Se.type==="number"&&be.memoizedProps.value!=null&&bi(Se,"number",Se.value)}switch(Ke=be?cr(be):window,e){case"focusin":(Nn(Ke)||Ke.contentEditable==="true")&&(Ts=Ke,mc=be,Ai=null);break;case"focusout":Ai=mc=Ts=null;break;case"mousedown":pc=!0;break;case"contextmenu":case"mouseup":case"dragend":pc=!1,Pd(Ie,a,Te);break;case"selectionchange":if(_x)break;case"keydown":case"keyup":Pd(Ie,a,Te)}var ut;if(ji)e:{switch(e){case"compositionstart":var gt="onCompositionStart";break e;case"compositionend":gt="onCompositionEnd";break e;case"compositionupdate":gt="onCompositionUpdate";break e}gt=void 0}else rt?ze(e,a)&&(gt="onCompositionEnd"):e==="keydown"&&a.keyCode===229&&(gt="onCompositionStart");gt&&(Ni&&a.locale!=="ko"&&(rt||gt!=="onCompositionStart"?gt==="onCompositionEnd"&&rt&&(ut=p()):(un=Te,xr="value"in un?un.value:un.textContent,rt=!0)),Ke=xo(be,gt),0<Ke.length&&(gt=new jl(gt,e,null,a,Te),Ie.push({event:gt,listeners:Ke}),ut?gt.data=ut:(ut=Ve(a),ut!==null&&(gt.data=ut)))),(ut=ks?dt(e,a):At(e,a))&&(gt=xo(be,"onBeforeInput"),0<gt.length&&(Ke=new jl("onBeforeInput","beforeinput",null,a,Te),Ie.push({event:Ke,listeners:gt}),Ke.data=ut)),cy(Ie,e,be,a,Te)}vm(Ie,t)})}function Wi(e,t,a){return{instance:e,listener:t,currentTarget:a}}function xo(e,t){for(var a=t+"Capture",s=[];e!==null;){var c=e,h=c.stateNode;if(c=c.tag,c!==5&&c!==26&&c!==27||h===null||(c=ja(e,a),c!=null&&s.unshift(Wi(e,c,h)),c=ja(e,t),c!=null&&s.push(Wi(e,c,h))),e.tag===3)return s;e=e.return}return[]}function hy(e){if(e===null)return null;do e=e.return;while(e&&e.tag!==5&&e.tag!==27);return e||null}function Sm(e,t,a,s,c){for(var h=t._reactName,T=[];a!==null&&a!==s;){var F=a,re=F.alternate,be=F.stateNode;if(F=F.tag,re!==null&&re===s)break;F!==5&&F!==26&&F!==27||be===null||(re=be,c?(be=ja(a,h),be!=null&&T.unshift(Wi(a,be,re))):c||(be=ja(a,h),be!=null&&T.push(Wi(a,be,re)))),a=a.return}T.length!==0&&e.push({event:t,listeners:T})}var my=/\r\n?/g,py=/\u0000|\uFFFD/g;function Em(e){return(typeof e=="string"?e:""+e).replace(my,`
`).replace(py,"")}function jm(e,t){return t=Em(t),Em(e)===t}function Ct(e,t,a,s,c,h){switch(a){case"children":typeof s=="string"?t==="body"||t==="textarea"&&s===""||za(e,s):(typeof s=="number"||typeof s=="bigint")&&t!=="body"&&za(e,""+s);break;case"className":Jr(e,"class",s);break;case"tabIndex":Jr(e,"tabindex",s);break;case"dir":case"role":case"viewBox":case"width":case"height":Jr(e,a,s);break;case"style":vl(e,s,h);break;case"data":if(t!=="object"){Jr(e,"data",s);break}case"src":case"href":if(s===""&&(t!=="a"||a!=="href")){e.removeAttribute(a);break}if(s==null||typeof s=="function"||typeof s=="symbol"||typeof s=="boolean"){e.removeAttribute(a);break}s=mr(""+s),e.setAttribute(a,s);break;case"action":case"formAction":if(typeof s=="function"){e.setAttribute(a,"javascript:throw new Error('A React form was unexpectedly submitted. If you called form.submit() manually, consider using form.requestSubmit() instead. If you\\'re trying to use event.stopPropagation() in a submit event handler, consider also calling event.preventDefault().')");break}else typeof h=="function"&&(a==="formAction"?(t!=="input"&&Ct(e,t,"name",c.name,c,null),Ct(e,t,"formEncType",c.formEncType,c,null),Ct(e,t,"formMethod",c.formMethod,c,null),Ct(e,t,"formTarget",c.formTarget,c,null)):(Ct(e,t,"encType",c.encType,c,null),Ct(e,t,"method",c.method,c,null),Ct(e,t,"target",c.target,c,null)));if(s==null||typeof s=="symbol"||typeof s=="boolean"){e.removeAttribute(a);break}s=mr(""+s),e.setAttribute(a,s);break;case"onClick":s!=null&&(e.onclick=an);break;case"onScroll":s!=null&&ht("scroll",e);break;case"onScrollEnd":s!=null&&ht("scrollend",e);break;case"dangerouslySetInnerHTML":if(s!=null){if(typeof s!="object"||!("__html"in s))throw Error(u(61));if(a=s.__html,a!=null){if(c.children!=null)throw Error(u(60));e.innerHTML=a}}break;case"multiple":e.multiple=s&&typeof s!="function"&&typeof s!="symbol";break;case"muted":e.muted=s&&typeof s!="function"&&typeof s!="symbol";break;case"suppressContentEditableWarning":case"suppressHydrationWarning":case"defaultValue":case"defaultChecked":case"innerHTML":case"ref":break;case"autoFocus":break;case"xlinkHref":if(s==null||typeof s=="function"||typeof s=="boolean"||typeof s=="symbol"){e.removeAttribute("xlink:href");break}a=mr(""+s),e.setAttributeNS("http://www.w3.org/1999/xlink","xlink:href",a);break;case"contentEditable":case"spellCheck":case"draggable":case"value":case"autoReverse":case"externalResourcesRequired":case"focusable":case"preserveAlpha":s!=null&&typeof s!="function"&&typeof s!="symbol"?e.setAttribute(a,""+s):e.removeAttribute(a);break;case"inert":case"allowFullScreen":case"async":case"autoPlay":case"controls":case"default":case"defer":case"disabled":case"disablePictureInPicture":case"disableRemotePlayback":case"formNoValidate":case"hidden":case"loop":case"noModule":case"noValidate":case"open":case"playsInline":case"readOnly":case"required":case"reversed":case"scoped":case"seamless":case"itemScope":s&&typeof s!="function"&&typeof s!="symbol"?e.setAttribute(a,""):e.removeAttribute(a);break;case"capture":case"download":s===!0?e.setAttribute(a,""):s!==!1&&s!=null&&typeof s!="function"&&typeof s!="symbol"?e.setAttribute(a,s):e.removeAttribute(a);break;case"cols":case"rows":case"size":case"span":s!=null&&typeof s!="function"&&typeof s!="symbol"&&!isNaN(s)&&1<=s?e.setAttribute(a,s):e.removeAttribute(a);break;case"rowSpan":case"start":s==null||typeof s=="function"||typeof s=="symbol"||isNaN(s)?e.removeAttribute(a):e.setAttribute(a,s);break;case"popover":ht("beforetoggle",e),ht("toggle",e),vs(e,"popover",s);break;case"xlinkActuate":$n(e,"http://www.w3.org/1999/xlink","xlink:actuate",s);break;case"xlinkArcrole":$n(e,"http://www.w3.org/1999/xlink","xlink:arcrole",s);break;case"xlinkRole":$n(e,"http://www.w3.org/1999/xlink","xlink:role",s);break;case"xlinkShow":$n(e,"http://www.w3.org/1999/xlink","xlink:show",s);break;case"xlinkTitle":$n(e,"http://www.w3.org/1999/xlink","xlink:title",s);break;case"xlinkType":$n(e,"http://www.w3.org/1999/xlink","xlink:type",s);break;case"xmlBase":$n(e,"http://www.w3.org/XML/1998/namespace","xml:base",s);break;case"xmlLang":$n(e,"http://www.w3.org/XML/1998/namespace","xml:lang",s);break;case"xmlSpace":$n(e,"http://www.w3.org/XML/1998/namespace","xml:space",s);break;case"is":vs(e,"is",s);break;case"innerText":case"textContent":break;default:(!(2<a.length)||a[0]!=="o"&&a[0]!=="O"||a[1]!=="n"&&a[1]!=="N")&&(a=Ns.get(a)||a,vs(e,a,s))}}function Fu(e,t,a,s,c,h){switch(a){case"style":vl(e,s,h);break;case"dangerouslySetInnerHTML":if(s!=null){if(typeof s!="object"||!("__html"in s))throw Error(u(61));if(a=s.__html,a!=null){if(c.children!=null)throw Error(u(60));e.innerHTML=a}}break;case"children":typeof s=="string"?za(e,s):(typeof s=="number"||typeof s=="bigint")&&za(e,""+s);break;case"onScroll":s!=null&&ht("scroll",e);break;case"onScrollEnd":s!=null&&ht("scrollend",e);break;case"onClick":s!=null&&(e.onclick=an);break;case"suppressContentEditableWarning":case"suppressHydrationWarning":case"innerHTML":case"ref":break;case"innerText":case"textContent":break;default:if(!Pr.hasOwnProperty(a))e:{if(a[0]==="o"&&a[1]==="n"&&(c=a.endsWith("Capture"),t=a.slice(2,c?a.length-7:void 0),h=e[Nt]||null,h=h!=null?h[a]:null,typeof h=="function"&&e.removeEventListener(t,h,c),typeof s=="function")){typeof h!="function"&&h!==null&&(a in e?e[a]=null:e.hasAttribute(a)&&e.removeAttribute(a)),e.addEventListener(t,s,c);break e}a in e?e[a]=s:s===!0?e.setAttribute(a,""):vs(e,a,s)}}}function pn(e,t,a){switch(t){case"div":case"span":case"svg":case"path":case"a":case"g":case"p":case"li":break;case"img":ht("error",e),ht("load",e);var s=!1,c=!1,h;for(h in a)if(a.hasOwnProperty(h)){var T=a[h];if(T!=null)switch(h){case"src":s=!0;break;case"srcSet":c=!0;break;case"children":case"dangerouslySetInnerHTML":throw Error(u(137,t));default:Ct(e,t,h,T,a,null)}}c&&Ct(e,t,"srcSet",a.srcSet,a,null),s&&Ct(e,t,"src",a.src,a,null);return;case"input":ht("invalid",e);var F=h=T=c=null,re=null,be=null;for(s in a)if(a.hasOwnProperty(s)){var Te=a[s];if(Te!=null)switch(s){case"name":c=Te;break;case"type":T=Te;break;case"checked":re=Te;break;case"defaultChecked":be=Te;break;case"value":h=Te;break;case"defaultValue":F=Te;break;case"children":case"dangerouslySetInnerHTML":if(Te!=null)throw Error(u(137,t));break;default:Ct(e,t,s,Te,a,null)}}dr(e,h,F,re,be,T,c,!1);return;case"select":ht("invalid",e),s=T=h=null;for(c in a)if(a.hasOwnProperty(c)&&(F=a[c],F!=null))switch(c){case"value":h=F;break;case"defaultValue":T=F;break;case"multiple":s=F;default:Ct(e,t,c,F,a,null)}t=h,a=T,e.multiple=!!s,t!=null?fr(e,!!s,t,!1):a!=null&&fr(e,!!s,a,!0);return;case"textarea":ht("invalid",e),h=c=s=null;for(T in a)if(a.hasOwnProperty(T)&&(F=a[T],F!=null))switch(T){case"value":s=F;break;case"defaultValue":c=F;break;case"children":h=F;break;case"dangerouslySetInnerHTML":if(F!=null)throw Error(u(91));break;default:Ct(e,t,T,F,a,null)}Es(e,s,c,h);return;case"option":for(re in a)if(a.hasOwnProperty(re)&&(s=a[re],s!=null))switch(re){case"selected":e.selected=s&&typeof s!="function"&&typeof s!="symbol";break;default:Ct(e,t,re,s,a,null)}return;case"dialog":ht("beforetoggle",e),ht("toggle",e),ht("cancel",e),ht("close",e);break;case"iframe":case"object":ht("load",e);break;case"video":case"audio":for(s=0;s<Xi.length;s++)ht(Xi[s],e);break;case"image":ht("error",e),ht("load",e);break;case"details":ht("toggle",e);break;case"embed":case"source":case"link":ht("error",e),ht("load",e);case"area":case"base":case"br":case"col":case"hr":case"keygen":case"meta":case"param":case"track":case"wbr":case"menuitem":for(be in a)if(a.hasOwnProperty(be)&&(s=a[be],s!=null))switch(be){case"children":case"dangerouslySetInnerHTML":throw Error(u(137,t));default:Ct(e,t,be,s,a,null)}return;default:if(hr(t)){for(Te in a)a.hasOwnProperty(Te)&&(s=a[Te],s!==void 0&&Fu(e,t,Te,s,a,void 0));return}}for(F in a)a.hasOwnProperty(F)&&(s=a[F],s!=null&&Ct(e,t,F,s,a,null))}function gy(e,t,a,s){switch(t){case"div":case"span":case"svg":case"path":case"a":case"g":case"p":case"li":break;case"input":var c=null,h=null,T=null,F=null,re=null,be=null,Te=null;for(ke in a){var Ie=a[ke];if(a.hasOwnProperty(ke)&&Ie!=null)switch(ke){case"checked":break;case"value":break;case"defaultValue":re=Ie;default:s.hasOwnProperty(ke)||Ct(e,t,ke,null,s,Ie)}}for(var Se in s){var ke=s[Se];if(Ie=a[Se],s.hasOwnProperty(Se)&&(ke!=null||Ie!=null))switch(Se){case"type":h=ke;break;case"name":c=ke;break;case"checked":be=ke;break;case"defaultChecked":Te=ke;break;case"value":T=ke;break;case"defaultValue":F=ke;break;case"children":case"dangerouslySetInnerHTML":if(ke!=null)throw Error(u(137,t));break;default:ke!==Ie&&Ct(e,t,Se,ke,s,Ie)}}ur(e,T,F,re,be,Te,h,c);return;case"select":ke=T=F=Se=null;for(h in a)if(re=a[h],a.hasOwnProperty(h)&&re!=null)switch(h){case"value":break;case"multiple":ke=re;default:s.hasOwnProperty(h)||Ct(e,t,h,null,s,re)}for(c in s)if(h=s[c],re=a[c],s.hasOwnProperty(c)&&(h!=null||re!=null))switch(c){case"value":Se=h;break;case"defaultValue":F=h;break;case"multiple":T=h;default:h!==re&&Ct(e,t,c,h,s,re)}t=F,a=T,s=ke,Se!=null?fr(e,!!a,Se,!1):!!s!=!!a&&(t!=null?fr(e,!!a,t,!0):fr(e,!!a,a?[]:"",!1));return;case"textarea":ke=Se=null;for(F in a)if(c=a[F],a.hasOwnProperty(F)&&c!=null&&!s.hasOwnProperty(F))switch(F){case"value":break;case"children":break;default:Ct(e,t,F,null,s,c)}for(T in s)if(c=s[T],h=a[T],s.hasOwnProperty(T)&&(c!=null||h!=null))switch(T){case"value":Se=c;break;case"defaultValue":ke=c;break;case"children":break;case"dangerouslySetInnerHTML":if(c!=null)throw Error(u(91));break;default:c!==h&&Ct(e,t,T,c,s,h)}vi(e,Se,ke);return;case"option":for(var $e in a)if(Se=a[$e],a.hasOwnProperty($e)&&Se!=null&&!s.hasOwnProperty($e))switch($e){case"selected":e.selected=!1;break;default:Ct(e,t,$e,null,s,Se)}for(re in s)if(Se=s[re],ke=a[re],s.hasOwnProperty(re)&&Se!==ke&&(Se!=null||ke!=null))switch(re){case"selected":e.selected=Se&&typeof Se!="function"&&typeof Se!="symbol";break;default:Ct(e,t,re,Se,s,ke)}return;case"img":case"link":case"area":case"base":case"br":case"col":case"embed":case"hr":case"keygen":case"meta":case"param":case"source":case"track":case"wbr":case"menuitem":for(var st in a)Se=a[st],a.hasOwnProperty(st)&&Se!=null&&!s.hasOwnProperty(st)&&Ct(e,t,st,null,s,Se);for(be in s)if(Se=s[be],ke=a[be],s.hasOwnProperty(be)&&Se!==ke&&(Se!=null||ke!=null))switch(be){case"children":case"dangerouslySetInnerHTML":if(Se!=null)throw Error(u(137,t));break;default:Ct(e,t,be,Se,s,ke)}return;default:if(hr(t)){for(var Dt in a)Se=a[Dt],a.hasOwnProperty(Dt)&&Se!==void 0&&!s.hasOwnProperty(Dt)&&Fu(e,t,Dt,void 0,s,Se);for(Te in s)Se=s[Te],ke=a[Te],!s.hasOwnProperty(Te)||Se===ke||Se===void 0&&ke===void 0||Fu(e,t,Te,Se,s,ke);return}}for(var me in a)Se=a[me],a.hasOwnProperty(me)&&Se!=null&&!s.hasOwnProperty(me)&&Ct(e,t,me,null,s,Se);for(Ie in s)Se=s[Ie],ke=a[Ie],!s.hasOwnProperty(Ie)||Se===ke||Se==null&&ke==null||Ct(e,t,Ie,Se,s,ke)}function Nm(e){switch(e){case"css":case"script":case"font":case"img":case"image":case"input":case"link":return!0;default:return!1}}function xy(){if(typeof performance.getEntriesByType=="function"){for(var e=0,t=0,a=performance.getEntriesByType("resource"),s=0;s<a.length;s++){var c=a[s],h=c.transferSize,T=c.initiatorType,F=c.duration;if(h&&F&&Nm(T)){for(T=0,F=c.responseEnd,s+=1;s<a.length;s++){var re=a[s],be=re.startTime;if(be>F)break;var Te=re.transferSize,Ie=re.initiatorType;Te&&Nm(Ie)&&(re=re.responseEnd,T+=Te*(re<F?1:(F-be)/(re-be)))}if(--s,t+=8*(h+T)/(c.duration/1e3),e++,10<e)break}}if(0<e)return t/e/1e6}return navigator.connection&&(e=navigator.connection.downlink,typeof e=="number")?e:5}var qu=null,Hu=null;function yo(e){return e.nodeType===9?e:e.ownerDocument}function _m(e){switch(e){case"http://www.w3.org/2000/svg":return 1;case"http://www.w3.org/1998/Math/MathML":return 2;default:return 0}}function km(e,t){if(e===0)switch(t){case"svg":return 1;case"math":return 2;default:return 0}return e===1&&t==="foreignObject"?0:e}function Gu(e,t){return e==="textarea"||e==="noscript"||typeof t.children=="string"||typeof t.children=="number"||typeof t.children=="bigint"||typeof t.dangerouslySetInnerHTML=="object"&&t.dangerouslySetInnerHTML!==null&&t.dangerouslySetInnerHTML.__html!=null}var Yu=null;function yy(){var e=window.event;return e&&e.type==="popstate"?e===Yu?!1:(Yu=e,!0):(Yu=null,!1)}var Am=typeof setTimeout=="function"?setTimeout:void 0,by=typeof clearTimeout=="function"?clearTimeout:void 0,Tm=typeof Promise=="function"?Promise:void 0,vy=typeof queueMicrotask=="function"?queueMicrotask:typeof Tm<"u"?function(e){return Tm.resolve(null).then(e).catch(wy)}:Am;function wy(e){setTimeout(function(){throw e})}function Rr(e){return e==="head"}function Cm(e,t){var a=t,s=0;do{var c=a.nextSibling;if(e.removeChild(a),c&&c.nodeType===8)if(a=c.data,a==="/$"||a==="/&"){if(s===0){e.removeChild(c),ni(t);return}s--}else if(a==="$"||a==="$?"||a==="$~"||a==="$!"||a==="&")s++;else if(a==="html")el(e.ownerDocument.documentElement);else if(a==="head"){a=e.ownerDocument.head,el(a);for(var h=a.firstChild;h;){var T=h.nextSibling,F=h.nodeName;h[yn]||F==="SCRIPT"||F==="STYLE"||F==="LINK"&&h.rel.toLowerCase()==="stylesheet"||a.removeChild(h),h=T}}else a==="body"&&el(e.ownerDocument.body);a=c}while(a);ni(t)}function Dm(e,t){var a=e;e=0;do{var s=a.nextSibling;if(a.nodeType===1?t?(a._stashedDisplay=a.style.display,a.style.display="none"):(a.style.display=a._stashedDisplay||"",a.getAttribute("style")===""&&a.removeAttribute("style")):a.nodeType===3&&(t?(a._stashedText=a.nodeValue,a.nodeValue=""):a.nodeValue=a._stashedText||""),s&&s.nodeType===8)if(a=s.data,a==="/$"){if(e===0)break;e--}else a!=="$"&&a!=="$?"&&a!=="$~"&&a!=="$!"||e++;a=s}while(a)}function Qu(e){var t=e.firstChild;for(t&&t.nodeType===10&&(t=t.nextSibling);t;){var a=t;switch(t=t.nextSibling,a.nodeName){case"HTML":case"HEAD":case"BODY":Qu(a),or(a);continue;case"SCRIPT":case"STYLE":continue;case"LINK":if(a.rel.toLowerCase()==="stylesheet")continue}e.removeChild(a)}}function Sy(e,t,a,s){for(;e.nodeType===1;){var c=a;if(e.nodeName.toLowerCase()!==t.toLowerCase()){if(!s&&(e.nodeName!=="INPUT"||e.type!=="hidden"))break}else if(s){if(!e[yn])switch(t){case"meta":if(!e.hasAttribute("itemprop"))break;return e;case"link":if(h=e.getAttribute("rel"),h==="stylesheet"&&e.hasAttribute("data-precedence"))break;if(h!==c.rel||e.getAttribute("href")!==(c.href==null||c.href===""?null:c.href)||e.getAttribute("crossorigin")!==(c.crossOrigin==null?null:c.crossOrigin)||e.getAttribute("title")!==(c.title==null?null:c.title))break;return e;case"style":if(e.hasAttribute("data-precedence"))break;return e;case"script":if(h=e.getAttribute("src"),(h!==(c.src==null?null:c.src)||e.getAttribute("type")!==(c.type==null?null:c.type)||e.getAttribute("crossorigin")!==(c.crossOrigin==null?null:c.crossOrigin))&&h&&e.hasAttribute("async")&&!e.hasAttribute("itemprop"))break;return e;default:return e}}else if(t==="input"&&e.type==="hidden"){var h=c.name==null?null:""+c.name;if(c.type==="hidden"&&e.getAttribute("name")===h)return e}else return e;if(e=ta(e.nextSibling),e===null)break}return null}function Ey(e,t,a){if(t==="")return null;for(;e.nodeType!==3;)if((e.nodeType!==1||e.nodeName!=="INPUT"||e.type!=="hidden")&&!a||(e=ta(e.nextSibling),e===null))return null;return e}function Om(e,t){for(;e.nodeType!==8;)if((e.nodeType!==1||e.nodeName!=="INPUT"||e.type!=="hidden")&&!t||(e=ta(e.nextSibling),e===null))return null;return e}function $u(e){return e.data==="$?"||e.data==="$~"}function Pu(e){return e.data==="$!"||e.data==="$?"&&e.ownerDocument.readyState!=="loading"}function jy(e,t){var a=e.ownerDocument;if(e.data==="$~")e._reactRetry=t;else if(e.data!=="$?"||a.readyState!=="loading")t();else{var s=function(){t(),a.removeEventListener("DOMContentLoaded",s)};a.addEventListener("DOMContentLoaded",s),e._reactRetry=s}}function ta(e){for(;e!=null;e=e.nextSibling){var t=e.nodeType;if(t===1||t===3)break;if(t===8){if(t=e.data,t==="$"||t==="$!"||t==="$?"||t==="$~"||t==="&"||t==="F!"||t==="F")break;if(t==="/$"||t==="/&")return null}}return e}var Ju=null;function Im(e){e=e.nextSibling;for(var t=0;e;){if(e.nodeType===8){var a=e.data;if(a==="/$"||a==="/&"){if(t===0)return ta(e.nextSibling);t--}else a!=="$"&&a!=="$!"&&a!=="$?"&&a!=="$~"&&a!=="&"||t++}e=e.nextSibling}return null}function Rm(e){e=e.previousSibling;for(var t=0;e;){if(e.nodeType===8){var a=e.data;if(a==="$"||a==="$!"||a==="$?"||a==="$~"||a==="&"){if(t===0)return e;t--}else a!=="/$"&&a!=="/&"||t++}e=e.previousSibling}return null}function Mm(e,t,a){switch(t=yo(a),e){case"html":if(e=t.documentElement,!e)throw Error(u(452));return e;case"head":if(e=t.head,!e)throw Error(u(453));return e;case"body":if(e=t.body,!e)throw Error(u(454));return e;default:throw Error(u(451))}}function el(e){for(var t=e.attributes;t.length;)e.removeAttributeNode(t[0]);or(e)}var na=new Map,Um=new Set;function bo(e){return typeof e.getRootNode=="function"?e.getRootNode():e.nodeType===9?e:e.ownerDocument}var ar=Q.d;Q.d={f:Ny,r:_y,D:ky,C:Ay,L:Ty,m:Cy,X:Oy,S:Dy,M:Iy};function Ny(){var e=ar.f(),t=co();return e||t}function _y(e){var t=Ra(e);t!==null&&t.tag===5&&t.type==="form"?Wf(t):ar.r(e)}var Ws=typeof document>"u"?null:document;function zm(e,t,a){var s=Ws;if(s&&typeof t=="string"&&t){var c=cn(t);c='link[rel="'+e+'"][href="'+c+'"]',typeof a=="string"&&(c+='[crossorigin="'+a+'"]'),Um.has(c)||(Um.add(c),e={rel:e,crossOrigin:a,href:t},s.querySelector(c)===null&&(t=s.createElement("link"),pn(t,"link",e),Bt(t),s.head.appendChild(t)))}}function ky(e){ar.D(e),zm("dns-prefetch",e,null)}function Ay(e,t){ar.C(e,t),zm("preconnect",e,t)}function Ty(e,t,a){ar.L(e,t,a);var s=Ws;if(s&&e&&t){var c='link[rel="preload"][as="'+cn(t)+'"]';t==="image"&&a&&a.imageSrcSet?(c+='[imagesrcset="'+cn(a.imageSrcSet)+'"]',typeof a.imageSizes=="string"&&(c+='[imagesizes="'+cn(a.imageSizes)+'"]')):c+='[href="'+cn(e)+'"]';var h=c;switch(t){case"style":h=ei(e);break;case"script":h=ti(e)}na.has(h)||(e=y({rel:"preload",href:t==="image"&&a&&a.imageSrcSet?void 0:e,as:t},a),na.set(h,e),s.querySelector(c)!==null||t==="style"&&s.querySelector(tl(h))||t==="script"&&s.querySelector(nl(h))||(t=s.createElement("link"),pn(t,"link",e),Bt(t),s.head.appendChild(t)))}}function Cy(e,t){ar.m(e,t);var a=Ws;if(a&&e){var s=t&&typeof t.as=="string"?t.as:"script",c='link[rel="modulepreload"][as="'+cn(s)+'"][href="'+cn(e)+'"]',h=c;switch(s){case"audioworklet":case"paintworklet":case"serviceworker":case"sharedworker":case"worker":case"script":h=ti(e)}if(!na.has(h)&&(e=y({rel:"modulepreload",href:e},t),na.set(h,e),a.querySelector(c)===null)){switch(s){case"audioworklet":case"paintworklet":case"serviceworker":case"sharedworker":case"worker":case"script":if(a.querySelector(nl(h)))return}s=a.createElement("link"),pn(s,"link",e),Bt(s),a.head.appendChild(s)}}}function Dy(e,t,a){ar.S(e,t,a);var s=Ws;if(s&&e){var c=Ma(s).hoistableStyles,h=ei(e);t=t||"default";var T=c.get(h);if(!T){var F={loading:0,preload:null};if(T=s.querySelector(tl(h)))F.loading=5;else{e=y({rel:"stylesheet",href:e,"data-precedence":t},a),(a=na.get(h))&&Vu(e,a);var re=T=s.createElement("link");Bt(re),pn(re,"link",e),re._p=new Promise(function(be,Te){re.onload=be,re.onerror=Te}),re.addEventListener("load",function(){F.loading|=1}),re.addEventListener("error",function(){F.loading|=2}),F.loading|=4,vo(T,t,s)}T={type:"stylesheet",instance:T,count:1,state:F},c.set(h,T)}}}function Oy(e,t){ar.X(e,t);var a=Ws;if(a&&e){var s=Ma(a).hoistableScripts,c=ti(e),h=s.get(c);h||(h=a.querySelector(nl(c)),h||(e=y({src:e,async:!0},t),(t=na.get(c))&&Ku(e,t),h=a.createElement("script"),Bt(h),pn(h,"link",e),a.head.appendChild(h)),h={type:"script",instance:h,count:1,state:null},s.set(c,h))}}function Iy(e,t){ar.M(e,t);var a=Ws;if(a&&e){var s=Ma(a).hoistableScripts,c=ti(e),h=s.get(c);h||(h=a.querySelector(nl(c)),h||(e=y({src:e,async:!0,type:"module"},t),(t=na.get(c))&&Ku(e,t),h=a.createElement("script"),Bt(h),pn(h,"link",e),a.head.appendChild(h)),h={type:"script",instance:h,count:1,state:null},s.set(c,h))}}function Lm(e,t,a,s){var c=(c=Ne.current)?bo(c):null;if(!c)throw Error(u(446));switch(e){case"meta":case"title":return null;case"style":return typeof a.precedence=="string"&&typeof a.href=="string"?(t=ei(a.href),a=Ma(c).hoistableStyles,s=a.get(t),s||(s={type:"style",instance:null,count:0,state:null},a.set(t,s)),s):{type:"void",instance:null,count:0,state:null};case"link":if(a.rel==="stylesheet"&&typeof a.href=="string"&&typeof a.precedence=="string"){e=ei(a.href);var h=Ma(c).hoistableStyles,T=h.get(e);if(T||(c=c.ownerDocument||c,T={type:"stylesheet",instance:null,count:0,state:{loading:0,preload:null}},h.set(e,T),(h=c.querySelector(tl(e)))&&!h._p&&(T.instance=h,T.state.loading=5),na.has(e)||(a={rel:"preload",as:"style",href:a.href,crossOrigin:a.crossOrigin,integrity:a.integrity,media:a.media,hrefLang:a.hrefLang,referrerPolicy:a.referrerPolicy},na.set(e,a),h||Ry(c,e,a,T.state))),t&&s===null)throw Error(u(528,""));return T}if(t&&s!==null)throw Error(u(529,""));return null;case"script":return t=a.async,a=a.src,typeof a=="string"&&t&&typeof t!="function"&&typeof t!="symbol"?(t=ti(a),a=Ma(c).hoistableScripts,s=a.get(t),s||(s={type:"script",instance:null,count:0,state:null},a.set(t,s)),s):{type:"void",instance:null,count:0,state:null};default:throw Error(u(444,e))}}function ei(e){return'href="'+cn(e)+'"'}function tl(e){return'link[rel="stylesheet"]['+e+"]"}function Bm(e){return y({},e,{"data-precedence":e.precedence,precedence:null})}function Ry(e,t,a,s){e.querySelector('link[rel="preload"][as="style"]['+t+"]")?s.loading=1:(t=e.createElement("link"),s.preload=t,t.addEventListener("load",function(){return s.loading|=1}),t.addEventListener("error",function(){return s.loading|=2}),pn(t,"link",a),Bt(t),e.head.appendChild(t))}function ti(e){return'[src="'+cn(e)+'"]'}function nl(e){return"script[async]"+e}function Fm(e,t,a){if(t.count++,t.instance===null)switch(t.type){case"style":var s=e.querySelector('style[data-href~="'+cn(a.href)+'"]');if(s)return t.instance=s,Bt(s),s;var c=y({},a,{"data-href":a.href,"data-precedence":a.precedence,href:null,precedence:null});return s=(e.ownerDocument||e).createElement("style"),Bt(s),pn(s,"style",c),vo(s,a.precedence,e),t.instance=s;case"stylesheet":c=ei(a.href);var h=e.querySelector(tl(c));if(h)return t.state.loading|=4,t.instance=h,Bt(h),h;s=Bm(a),(c=na.get(c))&&Vu(s,c),h=(e.ownerDocument||e).createElement("link"),Bt(h);var T=h;return T._p=new Promise(function(F,re){T.onload=F,T.onerror=re}),pn(h,"link",s),t.state.loading|=4,vo(h,a.precedence,e),t.instance=h;case"script":return h=ti(a.src),(c=e.querySelector(nl(h)))?(t.instance=c,Bt(c),c):(s=a,(c=na.get(h))&&(s=y({},a),Ku(s,c)),e=e.ownerDocument||e,c=e.createElement("script"),Bt(c),pn(c,"link",s),e.head.appendChild(c),t.instance=c);case"void":return null;default:throw Error(u(443,t.type))}else t.type==="stylesheet"&&(t.state.loading&4)===0&&(s=t.instance,t.state.loading|=4,vo(s,a.precedence,e));return t.instance}function vo(e,t,a){for(var s=a.querySelectorAll('link[rel="stylesheet"][data-precedence],style[data-precedence]'),c=s.length?s[s.length-1]:null,h=c,T=0;T<s.length;T++){var F=s[T];if(F.dataset.precedence===t)h=F;else if(h!==c)break}h?h.parentNode.insertBefore(e,h.nextSibling):(t=a.nodeType===9?a.head:a,t.insertBefore(e,t.firstChild))}function Vu(e,t){e.crossOrigin==null&&(e.crossOrigin=t.crossOrigin),e.referrerPolicy==null&&(e.referrerPolicy=t.referrerPolicy),e.title==null&&(e.title=t.title)}function Ku(e,t){e.crossOrigin==null&&(e.crossOrigin=t.crossOrigin),e.referrerPolicy==null&&(e.referrerPolicy=t.referrerPolicy),e.integrity==null&&(e.integrity=t.integrity)}var wo=null;function qm(e,t,a){if(wo===null){var s=new Map,c=wo=new Map;c.set(a,s)}else c=wo,s=c.get(a),s||(s=new Map,c.set(a,s));if(s.has(e))return s;for(s.set(e,null),a=a.getElementsByTagName(e),c=0;c<a.length;c++){var h=a[c];if(!(h[yn]||h[nn]||e==="link"&&h.getAttribute("rel")==="stylesheet")&&h.namespaceURI!=="http://www.w3.org/2000/svg"){var T=h.getAttribute(t)||"";T=e+T;var F=s.get(T);F?F.push(h):s.set(T,[h])}}return s}function Hm(e,t,a){e=e.ownerDocument||e,e.head.insertBefore(a,t==="title"?e.querySelector("head > title"):null)}function My(e,t,a){if(a===1||t.itemProp!=null)return!1;switch(e){case"meta":case"title":return!0;case"style":if(typeof t.precedence!="string"||typeof t.href!="string"||t.href==="")break;return!0;case"link":if(typeof t.rel!="string"||typeof t.href!="string"||t.href===""||t.onLoad||t.onError)break;switch(t.rel){case"stylesheet":return e=t.disabled,typeof t.precedence=="string"&&e==null;default:return!0}case"script":if(t.async&&typeof t.async!="function"&&typeof t.async!="symbol"&&!t.onLoad&&!t.onError&&t.src&&typeof t.src=="string")return!0}return!1}function Gm(e){return!(e.type==="stylesheet"&&(e.state.loading&3)===0)}function Uy(e,t,a,s){if(a.type==="stylesheet"&&(typeof s.media!="string"||matchMedia(s.media).matches!==!1)&&(a.state.loading&4)===0){if(a.instance===null){var c=ei(s.href),h=t.querySelector(tl(c));if(h){t=h._p,t!==null&&typeof t=="object"&&typeof t.then=="function"&&(e.count++,e=So.bind(e),t.then(e,e)),a.state.loading|=4,a.instance=h,Bt(h);return}h=t.ownerDocument||t,s=Bm(s),(c=na.get(c))&&Vu(s,c),h=h.createElement("link"),Bt(h);var T=h;T._p=new Promise(function(F,re){T.onload=F,T.onerror=re}),pn(h,"link",s),a.instance=h}e.stylesheets===null&&(e.stylesheets=new Map),e.stylesheets.set(a,t),(t=a.state.preload)&&(a.state.loading&3)===0&&(e.count++,a=So.bind(e),t.addEventListener("load",a),t.addEventListener("error",a))}}var Zu=0;function zy(e,t){return e.stylesheets&&e.count===0&&jo(e,e.stylesheets),0<e.count||0<e.imgCount?function(a){var s=setTimeout(function(){if(e.stylesheets&&jo(e,e.stylesheets),e.unsuspend){var h=e.unsuspend;e.unsuspend=null,h()}},6e4+t);0<e.imgBytes&&Zu===0&&(Zu=62500*xy());var c=setTimeout(function(){if(e.waitingForImages=!1,e.count===0&&(e.stylesheets&&jo(e,e.stylesheets),e.unsuspend)){var h=e.unsuspend;e.unsuspend=null,h()}},(e.imgBytes>Zu?50:800)+t);return e.unsuspend=a,function(){e.unsuspend=null,clearTimeout(s),clearTimeout(c)}}:null}function So(){if(this.count--,this.count===0&&(this.imgCount===0||!this.waitingForImages)){if(this.stylesheets)jo(this,this.stylesheets);else if(this.unsuspend){var e=this.unsuspend;this.unsuspend=null,e()}}}var Eo=null;function jo(e,t){e.stylesheets=null,e.unsuspend!==null&&(e.count++,Eo=new Map,t.forEach(Ly,e),Eo=null,So.call(e))}function Ly(e,t){if(!(t.state.loading&4)){var a=Eo.get(e);if(a)var s=a.get(null);else{a=new Map,Eo.set(e,a);for(var c=e.querySelectorAll("link[data-precedence],style[data-precedence]"),h=0;h<c.length;h++){var T=c[h];(T.nodeName==="LINK"||T.getAttribute("media")!=="not all")&&(a.set(T.dataset.precedence,T),s=T)}s&&a.set(null,s)}c=t.instance,T=c.getAttribute("data-precedence"),h=a.get(T)||s,h===s&&a.set(null,c),a.set(T,c),this.count++,s=So.bind(this),c.addEventListener("load",s),c.addEventListener("error",s),h?h.parentNode.insertBefore(c,h.nextSibling):(e=e.nodeType===9?e.head:e,e.insertBefore(c,e.firstChild)),t.state.loading|=4}}var al={$$typeof:C,Provider:null,Consumer:null,_currentValue:ue,_currentValue2:ue,_threadCount:0};function By(e,t,a,s,c,h,T,F,re){this.tag=1,this.containerInfo=e,this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.next=this.pendingContext=this.context=this.cancelPendingCommit=null,this.callbackPriority=0,this.expirationTimes=sn(-1),this.entangledLanes=this.shellSuspendCounter=this.errorRecoveryDisabledLanes=this.expiredLanes=this.warmLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=sn(0),this.hiddenUpdates=sn(null),this.identifierPrefix=s,this.onUncaughtError=c,this.onCaughtError=h,this.onRecoverableError=T,this.pooledCache=null,this.pooledCacheLanes=0,this.formState=re,this.incompleteTransitions=new Map}function Ym(e,t,a,s,c,h,T,F,re,be,Te,Ie){return e=new By(e,t,a,T,re,be,Te,Ie,F),t=1,h===!0&&(t|=24),h=Fn(3,null,null,t),e.current=h,h.stateNode=e,t=Cc(),t.refCount++,e.pooledCache=t,t.refCount++,h.memoizedState={element:s,isDehydrated:a,cache:t},Rc(h),e}function Qm(e){return e?(e=Os,e):Os}function $m(e,t,a,s,c,h){c=Qm(c),s.context===null?s.context=c:s.pendingContext=c,s=Er(t),s.payload={element:a},h=h===void 0?null:h,h!==null&&(s.callback=h),a=jr(e,s,t),a!==null&&(In(a,e,t),Mi(a,e,t))}function Pm(e,t){if(e=e.memoizedState,e!==null&&e.dehydrated!==null){var a=e.retryLane;e.retryLane=a!==0&&a<t?a:t}}function Xu(e,t){Pm(e,t),(e=e.alternate)&&Pm(e,t)}function Jm(e){if(e.tag===13||e.tag===31){var t=ts(e,67108864);t!==null&&In(t,e,67108864),Xu(e,67108864)}}function Vm(e){if(e.tag===13||e.tag===31){var t=Qn();t=xn(t);var a=ts(e,t);a!==null&&In(a,e,t),Xu(e,t)}}var No=!0;function Fy(e,t,a,s){var c=z.T;z.T=null;var h=Q.p;try{Q.p=2,Wu(e,t,a,s)}finally{Q.p=h,z.T=c}}function qy(e,t,a,s){var c=z.T;z.T=null;var h=Q.p;try{Q.p=8,Wu(e,t,a,s)}finally{Q.p=h,z.T=c}}function Wu(e,t,a,s){if(No){var c=ed(s);if(c===null)Bu(e,t,s,_o,a),Zm(e,s);else if(Gy(c,e,t,a,s))s.stopPropagation();else if(Zm(e,s),t&4&&-1<Hy.indexOf(e)){for(;c!==null;){var h=Ra(c);if(h!==null)switch(h.tag){case 3:if(h=h.stateNode,h.current.memoizedState.isDehydrated){var T=An(h.pendingLanes);if(T!==0){var F=h;for(F.pendingLanes|=2,F.entangledLanes|=2;T;){var re=1<<31-vt(T);F.entanglements[1]|=re,T&=~re}Aa(h),(jt&6)===0&&(lo=Le()+500,Zi(0))}}break;case 31:case 13:F=ts(h,2),F!==null&&In(F,h,2),co(),Xu(h,2)}if(h=ed(s),h===null&&Bu(e,t,s,_o,a),h===c)break;c=h}c!==null&&s.stopPropagation()}else Bu(e,t,s,null,a)}}function ed(e){return e=pr(e),td(e)}var _o=null;function td(e){if(_o=null,e=wa(e),e!==null){var t=i(e);if(t===null)e=null;else{var a=t.tag;if(a===13){if(e=o(t),e!==null)return e;e=null}else if(a===31){if(e=m(t),e!==null)return e;e=null}else if(a===3){if(t.stateNode.current.memoizedState.isDehydrated)return t.tag===3?t.stateNode.containerInfo:null;e=null}else t!==e&&(e=null)}}return _o=e,null}function Km(e){switch(e){case"beforetoggle":case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"toggle":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 2;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 8;case"message":switch(_e()){case pe:return 2;case Be:return 8;case He:case Xe:return 32;case qe:return 268435456;default:return 32}default:return 32}}var nd=!1,Mr=null,Ur=null,zr=null,rl=new Map,sl=new Map,Lr=[],Hy="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset".split(" ");function Zm(e,t){switch(e){case"focusin":case"focusout":Mr=null;break;case"dragenter":case"dragleave":Ur=null;break;case"mouseover":case"mouseout":zr=null;break;case"pointerover":case"pointerout":rl.delete(t.pointerId);break;case"gotpointercapture":case"lostpointercapture":sl.delete(t.pointerId)}}function il(e,t,a,s,c,h){return e===null||e.nativeEvent!==h?(e={blockedOn:t,domEventName:a,eventSystemFlags:s,nativeEvent:h,targetContainers:[c]},t!==null&&(t=Ra(t),t!==null&&Jm(t)),e):(e.eventSystemFlags|=s,t=e.targetContainers,c!==null&&t.indexOf(c)===-1&&t.push(c),e)}function Gy(e,t,a,s,c){switch(t){case"focusin":return Mr=il(Mr,e,t,a,s,c),!0;case"dragenter":return Ur=il(Ur,e,t,a,s,c),!0;case"mouseover":return zr=il(zr,e,t,a,s,c),!0;case"pointerover":var h=c.pointerId;return rl.set(h,il(rl.get(h)||null,e,t,a,s,c)),!0;case"gotpointercapture":return h=c.pointerId,sl.set(h,il(sl.get(h)||null,e,t,a,s,c)),!0}return!1}function Xm(e){var t=wa(e.target);if(t!==null){var a=i(t);if(a!==null){if(t=a.tag,t===13){if(t=o(a),t!==null){e.blockedOn=t,di(e.priority,function(){Vm(a)});return}}else if(t===31){if(t=m(a),t!==null){e.blockedOn=t,di(e.priority,function(){Vm(a)});return}}else if(t===3&&a.stateNode.current.memoizedState.isDehydrated){e.blockedOn=a.tag===3?a.stateNode.containerInfo:null;return}}}e.blockedOn=null}function ko(e){if(e.blockedOn!==null)return!1;for(var t=e.targetContainers;0<t.length;){var a=ed(e.nativeEvent);if(a===null){a=e.nativeEvent;var s=new a.constructor(a.type,a);Ea=s,a.target.dispatchEvent(s),Ea=null}else return t=Ra(a),t!==null&&Jm(t),e.blockedOn=a,!1;t.shift()}return!0}function Wm(e,t,a){ko(e)&&a.delete(t)}function Yy(){nd=!1,Mr!==null&&ko(Mr)&&(Mr=null),Ur!==null&&ko(Ur)&&(Ur=null),zr!==null&&ko(zr)&&(zr=null),rl.forEach(Wm),sl.forEach(Wm)}function Ao(e,t){e.blockedOn===t&&(e.blockedOn=null,nd||(nd=!0,r.unstable_scheduleCallback(r.unstable_NormalPriority,Yy)))}var To=null;function ep(e){To!==e&&(To=e,r.unstable_scheduleCallback(r.unstable_NormalPriority,function(){To===e&&(To=null);for(var t=0;t<e.length;t+=3){var a=e[t],s=e[t+1],c=e[t+2];if(typeof s!="function"){if(td(s||a)===null)continue;break}var h=Ra(a);h!==null&&(e.splice(t,3),t-=3,eu(h,{pending:!0,data:c,method:a.method,action:s},s,c))}}))}function ni(e){function t(re){return Ao(re,e)}Mr!==null&&Ao(Mr,e),Ur!==null&&Ao(Ur,e),zr!==null&&Ao(zr,e),rl.forEach(t),sl.forEach(t);for(var a=0;a<Lr.length;a++){var s=Lr[a];s.blockedOn===e&&(s.blockedOn=null)}for(;0<Lr.length&&(a=Lr[0],a.blockedOn===null);)Xm(a),a.blockedOn===null&&Lr.shift();if(a=(e.ownerDocument||e).$$reactFormReplay,a!=null)for(s=0;s<a.length;s+=3){var c=a[s],h=a[s+1],T=c[Nt]||null;if(typeof h=="function")T||ep(a);else if(T){var F=null;if(h&&h.hasAttribute("formAction")){if(c=h,T=h[Nt]||null)F=T.formAction;else if(td(c)!==null)continue}else F=T.action;typeof F=="function"?a[s+1]=F:(a.splice(s,3),s-=3),ep(a)}}}function tp(){function e(h){h.canIntercept&&h.info==="react-transition"&&h.intercept({handler:function(){return new Promise(function(T){return c=T})},focusReset:"manual",scroll:"manual"})}function t(){c!==null&&(c(),c=null),s||setTimeout(a,20)}function a(){if(!s&&!navigation.transition){var h=navigation.currentEntry;h&&h.url!=null&&navigation.navigate(h.url,{state:h.getState(),info:"react-transition",history:"replace"})}}if(typeof navigation=="object"){var s=!1,c=null;return navigation.addEventListener("navigate",e),navigation.addEventListener("navigatesuccess",t),navigation.addEventListener("navigateerror",t),setTimeout(a,100),function(){s=!0,navigation.removeEventListener("navigate",e),navigation.removeEventListener("navigatesuccess",t),navigation.removeEventListener("navigateerror",t),c!==null&&(c(),c=null)}}}function ad(e){this._internalRoot=e}Co.prototype.render=ad.prototype.render=function(e){var t=this._internalRoot;if(t===null)throw Error(u(409));var a=t.current,s=Qn();$m(a,s,e,t,null,null)},Co.prototype.unmount=ad.prototype.unmount=function(){var e=this._internalRoot;if(e!==null){this._internalRoot=null;var t=e.containerInfo;$m(e.current,2,null,e,null,null),co(),t[Ia]=null}};function Co(e){this._internalRoot=e}Co.prototype.unstable_scheduleHydration=function(e){if(e){var t=Oa();e={blockedOn:null,target:e,priority:t};for(var a=0;a<Lr.length&&t!==0&&t<Lr[a].priority;a++);Lr.splice(a,0,e),a===0&&Xm(e)}};var np=g.version;if(np!=="19.2.0")throw Error(u(527,np,"19.2.0"));Q.findDOMNode=function(e){var t=e._reactInternals;if(t===void 0)throw typeof e.render=="function"?Error(u(188)):(e=Object.keys(e).join(","),Error(u(268,e)));return e=d(t),e=e!==null?j(e):null,e=e===null?null:e.stateNode,e};var Qy={bundleType:0,version:"19.2.0",rendererPackageName:"react-dom",currentDispatcherRef:z,reconcilerVersion:"19.2.0"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var Do=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!Do.isDisabled&&Do.supportsFiber)try{Je=Do.inject(Qy),xt=Do}catch{}}return ol.createRoot=function(e,t){if(!f(e))throw Error(u(299));var a=!1,s="",c=ch,h=uh,T=dh;return t!=null&&(t.unstable_strictMode===!0&&(a=!0),t.identifierPrefix!==void 0&&(s=t.identifierPrefix),t.onUncaughtError!==void 0&&(c=t.onUncaughtError),t.onCaughtError!==void 0&&(h=t.onCaughtError),t.onRecoverableError!==void 0&&(T=t.onRecoverableError)),t=Ym(e,1,!1,null,null,a,s,null,c,h,T,tp),e[Ia]=t.current,Lu(e),new ad(t)},ol.hydrateRoot=function(e,t,a){if(!f(e))throw Error(u(299));var s=!1,c="",h=ch,T=uh,F=dh,re=null;return a!=null&&(a.unstable_strictMode===!0&&(s=!0),a.identifierPrefix!==void 0&&(c=a.identifierPrefix),a.onUncaughtError!==void 0&&(h=a.onUncaughtError),a.onCaughtError!==void 0&&(T=a.onCaughtError),a.onRecoverableError!==void 0&&(F=a.onRecoverableError),a.formState!==void 0&&(re=a.formState)),t=Ym(e,1,!0,t,a??null,s,c,re,h,T,F,tp),t.context=Qm(null),a=t.current,s=Qn(),s=xn(s),c=Er(s),c.callback=null,jr(a,c,s),a=s,t.current.lanes=a,ia(t,a),Aa(t),e[Ia]=t.current,Lu(e),new Co(t)},ol.version="19.2.0",ol}var fp;function n0(){if(fp)return id.exports;fp=1;function r(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(r)}catch(g){console.error(g)}}return r(),id.exports=t0(),id.exports}var a0=n0();const r0=gl(a0),s0="cogniflow-sync";let ud=null;const jg=()=>(ud||(ud=new BroadcastChannel(s0)),ud),xa=()=>{jg().postMessage({type:"data-changed"})},i0=r=>{const g=jg(),l=()=>{r()};return g.addEventListener("message",l),()=>{g.removeEventListener("message",l)}},Ng="Europe/Stockholm",l0=()=>new Date().toLocaleDateString("sv-SE",{timeZone:Ng}),kd=()=>new Date().toLocaleString("sv-SE",{timeZone:Ng,year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit",second:"2-digit",hour12:!1}).replace(/ /g,"_").replace(/:/g,"-"),Lo="CogniFlowDB",dd=8,Mn="decks",jn="folders",En="deckSeries",Kt="sessions",Pt="reviews",ga="ai_chat",kn="seriesProgress",o0=(r,g=20,l=5e3)=>{let u=0,f=Date.now(),i=!1;const o=(m,...x)=>{const d=Date.now();if(d-f>l&&(u=0,f=d,i&&console.warn(`[${r}] Logger is now unmuted after timeout.`),i=!1),!i){if(u++,u>g){console.error(`[${r}] Logger muted: Too many logs in a short time window (${g} logs in <${l}ms). This may indicate a serious issue like a data corruption loop or a repeated failed operation. Further logs from this source will be suppressed for a short time to prevent app overload.`),i=!0;return}console[m](`[${r}]`,...x)}};return{log:(...m)=>o("log",...m),warn:(...m)=>o("warn",...m),error:(...m)=>o("error",...m)}},Qe=o0("DB");let sr=null;function mt(){return sr||(sr=new Promise((r,g)=>{if(Qe.log(`Initializing IndexedDB: ${Lo} v${dd}...`),!window.indexedDB){const u="IndexedDB is not supported by this browser.";return Qe.error(`${u}`),g(new Error(u))}const l=indexedDB.open(Lo,dd);l.onblocked=u=>{const f="Database upgrade is required, but it is blocked by another open tab of this application. Please close all other tabs and reload.";Qe.error("IndexedDB open request blocked. Please close other tabs with this app open.",u),g(new Error(f))},l.onerror=()=>{Qe.error("IndexedDB error during open:",l.error),sr=null;const u=new Error("Could not open or delete the database. This can be caused by browser settings (like blocking all data), private mode, or corruption. Please clear website data for this app in your browser settings and reload.");g(u)},l.onsuccess=()=>{const u=l.result;Qe.log("IndexedDB connection successful."),u.onclose=()=>{sr=null,Qe.warn("Database connection closed.")},r(u)},l.onupgradeneeded=u=>{var o;const f=u.target.result,i=u.target.transaction;if(Qe.log(`Upgrading database from version ${u.oldVersion} to ${dd}`),!i){Qe.error("Upgrade transaction is not available, aborting upgrade."),u.target&&((o=u.target.transaction)==null||o.abort());return}switch(u.oldVersion){case 0:Qe.log("v1: Creating initial object stores (decks, folders)."),f.createObjectStore(Mn,{keyPath:"id"}),f.createObjectStore(jn,{keyPath:"id"});case 1:case 2:Qe.log(`v3: Creating object store: ${En}`),f.objectStoreNames.contains(En)||f.createObjectStore(En,{keyPath:"id"});case 3:Qe.log(`v4: Creating object store: ${Kt}`),f.objectStoreNames.contains(Kt)||f.createObjectStore(Kt,{keyPath:"id"});case 4:Qe.log(`v5: Creating object store: ${Pt}`),f.objectStoreNames.contains(Pt)||f.createObjectStore(Pt,{autoIncrement:!0}).createIndex("timestamp","timestamp",{unique:!1});case 5:Qe.log("v6: Adding deckId index to reviews store.");const m=i.objectStore(Pt);m.indexNames.contains("deckId")||m.createIndex("deckId","deckId",{unique:!1});case 6:Qe.log(`v7: Creating object store: ${ga}`),f.objectStoreNames.contains(ga)||f.createObjectStore(ga,{keyPath:"id"});case 7:Qe.log(`v8: Creating object store: ${kn}`),f.objectStoreNames.contains(kn)||f.createObjectStore(kn,{keyPath:"id"});default:Qe.log("Database upgrade sequence complete.")}}}),sr)}async function _g(){const r=await mt();return new Promise((g,l)=>{const i=r.transaction(Mn,"readonly").objectStore(Mn).getAll();i.onerror=()=>{Qe.error("DB Error fetching all decks:",i.error),l(new Error("Error fetching decks from the database."))},i.onsuccess=()=>{const o=i.result,m=Array.isArray(o)?o:[],x=m.length;x>0?Qe.log(`Successfully loaded ${x} decks from the database.`):Qe.warn("No decks found in the database."),g(m)}})}async function si(r){if(r.length===0)return;const g=await mt();return new Promise((l,u)=>{const f=g.transaction(Mn,"readwrite"),i=f.objectStore(Mn);f.oncomplete=()=>{xa(),l()},f.onerror=()=>{Qe.error("Transaction error adding/updating decks",f.error),u(new Error("Transaction error adding/updating decks."))},r.forEach(o=>{const m=i.put(o);m.onerror=()=>{Qe.error(`Error putting deck ${o.name}`,m.error)}})})}async function Ed(r){await si(r)}async function Ad(r){const g=await mt();return new Promise((l,u)=>{const f=g.transaction(Mn,"readwrite");f.oncomplete=()=>{xa(),l()},f.onerror=()=>{Qe.error("Transaction error deleting deck",f.error),u(new Error("Transaction error deleting deck."))},f.objectStore(Mn).delete(r)})}async function kg(r){const g=await mt();return new Promise((l,u)=>{const f=g.transaction(Mn,"readwrite");f.oncomplete=()=>{xa(),l()},f.onerror=()=>{Qe.error("Transaction error updating deck",f.error),u(new Error("Transaction error updating deck."))},f.objectStore(Mn).put(r)})}async function Ag(){const r=await mt();return new Promise((g,l)=>{const i=r.transaction(jn,"readonly").objectStore(jn).getAll();i.onerror=()=>{Qe.error("DB Error fetching all folders:",i.error),l(new Error("Error fetching folders from the database."))},i.onsuccess=()=>{const o=i.result,m=Array.isArray(o)?o:[],x=m.length;x>0?Qe.log(`Successfully loaded ${x} folders from the database.`):Qe.warn("No folders found in the database."),g(m)}})}async function Tg(r){const g=await mt();return new Promise((l,u)=>{const f=g.transaction(jn,"readwrite");f.oncomplete=()=>{xa(),l()},f.onerror=()=>{Qe.error("Transaction error adding folder",f.error),u(new Error("Transaction error adding folder."))},f.objectStore(jn).add(r)})}async function c0(r){if(r.length===0)return;const g=await mt();return new Promise((l,u)=>{const f=g.transaction(jn,"readwrite");f.oncomplete=()=>{xa(),l()},f.onerror=()=>{Qe.error("Transaction error adding/updating folders",f.error),u(new Error("Transaction error adding/updating folders."))};const i=f.objectStore(jn);r.forEach(o=>{const m=i.put(o);m.onerror=()=>{Qe.error(`Error putting folder ${o.name}`,m.error)}})})}async function Cg(r){const g=await mt();return new Promise((l,u)=>{const f=g.transaction(jn,"readwrite");f.oncomplete=()=>{xa(),l()},f.onerror=()=>{Qe.error("Transaction error updating folder",f.error),u(new Error("Transaction error updating folder."))},f.objectStore(jn).put(r)})}async function Dg(r){const g=await mt();return new Promise((l,u)=>{const f=g.transaction(jn,"readwrite");f.oncomplete=()=>{xa(),l()},f.onerror=()=>{Qe.error("Transaction error deleting folder",f.error),u(new Error("Transaction error deleting folder."))},f.objectStore(jn).delete(r)})}async function Og(){const r=await mt();return new Promise((g,l)=>{const i=r.transaction(En,"readonly").objectStore(En).getAll();i.onerror=()=>{Qe.error("DB Error fetching all series:",i.error),l(new Error("Error fetching deck series from the database."))},i.onsuccess=()=>{const o=i.result,m=Array.isArray(o)?o:[],x=m.length;x>0?Qe.log(`Successfully loaded ${x} series from the database.`):Qe.warn("No series found in the database."),g(m)}})}async function Bo(r){if(r.length===0)return;const g=await mt();return new Promise((l,u)=>{const f=g.transaction(En,"readwrite");f.oncomplete=()=>{xa(),l()},f.onerror=()=>{Qe.error("Transaction error adding deck series",f.error),u(new Error("Transaction error adding deck series."))};const i=f.objectStore(En);r.forEach(o=>i.put(o))})}async function Ig(r){const g=await mt();return new Promise((l,u)=>{const f=g.transaction(En,"readwrite");f.oncomplete=()=>{xa(),l()},f.onerror=()=>{Qe.error("Transaction error updating deck series",f.error),u(new Error("Error updating deck series."))},f.objectStore(En).put(r)})}async function Rg(r){const g=await mt();return new Promise((l,u)=>{const f=g.transaction(En,"readwrite");f.oncomplete=()=>{xa(),l()},f.onerror=()=>{Qe.error("Transaction error deleting deck series",f.error),u(new Error("Error deleting deck series."))},f.objectStore(En).delete(r)})}async function Mg(r,g){const l=await mt();return new Promise((u,f)=>{const i=l.transaction(Kt,"readwrite");i.oncomplete=()=>u(),i.onerror=()=>{Qe.error("Transaction error saving session state",i.error),f(new Error("Transaction error saving session state."))},i.objectStore(Kt).put({id:r,...g})})}async function Ug(r){const g=await mt();return new Promise((l,u)=>{const o=g.transaction(Kt,"readonly").objectStore(Kt).get(r);o.onerror=()=>{Qe.error("DB Error fetching session state",o.error),u(new Error("Error fetching session state."))},o.onsuccess=()=>l(o.result||null)})}async function u0(){const r=await mt();return new Promise((g,l)=>{const i=r.transaction(Kt,"readonly").objectStore(Kt).getAll();i.onsuccess=()=>{const o=i.result,m=Array.isArray(o)?o:[],x=m.length;x>0?Qe.log(`Successfully loaded ${x} sessions from the database.`):Qe.warn("No sessions found in the database."),g(m)},i.onerror=()=>{Qe.error("Failed to get all sessions.",i.error),l(new Error("Failed to get all sessions."))}})}async function d0(){const r=await mt();return new Promise((g,l)=>{const i=r.transaction(Kt,"readwrite").objectStore(Kt).clear();i.onsuccess=()=>g(),i.onerror=()=>{Qe.error("Failed to clear sessions.",i.error),l(new Error("Failed to clear sessions."))}})}async function f0(r){if(r.length===0)return;const g=await mt();return new Promise((l,u)=>{const f=g.transaction(Kt,"readwrite"),i=f.objectStore(Kt);f.oncomplete=()=>l(),f.onerror=()=>{Qe.error("Transaction error adding sessions.",f.error),u(new Error("Transaction error adding sessions."))},r.forEach(o=>i.put(o))})}async function ml(r){const g=await mt();return new Promise((l,u)=>{const f=g.transaction(Kt,"readwrite");f.oncomplete=()=>l(),f.onerror=()=>{Qe.error("Transaction error deleting session state",f.error),u(new Error("Transaction error deleting session state."))},f.objectStore(Kt).delete(r)})}async function zg(){const r=await mt();return new Promise((g,l)=>{const i=r.transaction(Kt,"readonly").objectStore(Kt).getAllKeys();i.onerror=()=>{Qe.error("DB Error fetching session keys",i.error),l(new Error("Error fetching session keys."))},i.onsuccess=()=>g(i.result)})}async function Td(r){const g=await mt();return new Promise((l,u)=>{const o=g.transaction(r,"readwrite").objectStore(r).clear();o.onsuccess=()=>l(),o.onerror=()=>{Qe.error(`Failed to clear object store: ${r}`,o.error),u(new Error(`Failed to clear object store: ${r}.`))}})}const h0=()=>Td(Mn),m0=()=>Td(jn),p0=()=>Td(En);async function Ho(){const r=await mt();return new Promise((g,l)=>{const u=[Mn,jn,En,Pt,Kt,kn],f=r.transaction(u,"readonly"),i={decks:f.objectStore(Mn).getAll(),folders:f.objectStore(jn).getAll(),deckSeries:f.objectStore(En).getAll(),reviews:f.objectStore(Pt).getAll(),sessions:f.objectStore(Kt).getAll(),seriesProgress:f.objectStore(kn).getAll()};f.oncomplete=()=>{const o={};(Array.isArray(i.seriesProgress.result)?i.seriesProgress.result:[]).forEach(x=>{o[x.id]=x.completedDeckIds}),g({decks:Array.isArray(i.decks.result)?i.decks.result:[],folders:Array.isArray(i.folders.result)?i.folders.result:[],deckSeries:Array.isArray(i.deckSeries.result)?i.deckSeries.result:[],reviews:Array.isArray(i.reviews.result)?i.reviews.result:[],sessions:Array.isArray(i.sessions.result)?i.sessions.result:[],seriesProgress:o})},f.onerror=()=>{Qe.error("Transaction error in getAllDataForBackup",f.error),l(new Error("Database transaction failed while gathering backup data."))}})}async function Lg(r){const g=await mt();return new Promise((l,u)=>{const f=g.transaction(Pt,"readwrite");f.oncomplete=()=>l(),f.onerror=()=>{Qe.error("Transaction error adding review log",f.error),u(new Error("Transaction error adding review log."))},f.objectStore(Pt).add(r)})}async function Bg(r){const g=await mt();return new Promise((l,u)=>{const o=g.transaction(Pt,"readonly").objectStore(Pt).index("timestamp"),m=IDBKeyRange.lowerBound(r.toISOString()),x=o.getAll(m);x.onerror=()=>{Qe.error("DB Error fetching review logs",x.error),u(new Error("Error fetching review logs."))},x.onsuccess=()=>l(x.result)})}async function g0(){const r=await mt();return new Promise((g,l)=>{const i=r.transaction(Pt,"readonly").objectStore(Pt).getAll();i.onerror=()=>{Qe.error("DB Error fetching all reviews:",i.error),l(new Error("Error fetching all reviews from the database."))},i.onsuccess=()=>{const o=i.result,m=Array.isArray(o)?o:[],x=m.length;x>0&&Qe.log(`Successfully loaded ${x} review logs from the database.`),g(m)}})}async function x0(){const r=await mt();return new Promise((g,l)=>{const i=r.transaction(Pt,"readwrite").objectStore(Pt).clear();i.onsuccess=()=>g(),i.onerror=o=>{Qe.error("Failed to clear review logs",i.error),l(new Error("Failed to clear review logs."))}})}async function y0(r){if(r.length===0)return;const g=await mt();return new Promise((l,u)=>{const f=g.transaction(Pt,"readwrite"),o=f.objectStore(Pt).index("deckId"),m=new Set(r),x=o.openCursor();x.onsuccess=()=>{const d=x.result;d&&(m.has(d.value.deckId)&&d.delete(),d.continue())},f.oncomplete=()=>{Qe.log(`Deleted reviews for ${r.length} deck(s).`),l()},f.onerror=()=>{Qe.error("Transaction error deleting reviews for decks",f.error),u(new Error("Failed to delete review logs for specified decks."))}})}async function b0(r){if(r.length===0)return;const g=await mt();return new Promise((l,u)=>{const f=g.transaction(Pt,"readwrite"),i=f.objectStore(Pt);f.oncomplete=()=>l(),f.onerror=()=>{Qe.error("Transaction error adding review logs",f.error),u(new Error("Transaction error adding review logs."))},r.forEach(o=>{const{id:m,...x}=o;i.add(x)})})}async function Fg(r){const g=await mt();return new Promise((l,u)=>{const m=g.transaction(Pt,"readonly").objectStore(Pt).index("deckId").getAll(r);m.onerror=()=>{Qe.error(`DB Error fetching reviews for deck ${r}`,m.error),u(new Error(`Error fetching reviews for deck ${r}.`))},m.onsuccess=()=>l(m.result)})}async function qg(r){const g=await mt();return new Promise((l,u)=>{const o=g.transaction(ga,"readwrite").objectStore(ga).put({id:"global_history",history:r});o.onsuccess=()=>l(),o.onerror=()=>{Qe.error("Failed to save AI chat history.",o.error),u(new Error("Failed to save AI chat history."))}})}async function Cd(){const r=await mt();return new Promise((g,l)=>{const i=r.transaction(ga,"readonly").objectStore(ga).get("global_history");i.onsuccess=()=>{var m,x,d;const o=((x=(m=i.result)==null?void 0:m.history)==null?void 0:x.length)??0;o>0&&Qe.log(`Successfully loaded ${o} AI chat history messages.`),g(((d=i.result)==null?void 0:d.history)||[])},i.onerror=()=>{Qe.error("Failed to get AI chat history.",i.error),l(new Error("Failed to get AI chat history."))}})}async function v0(){const r=await mt();return new Promise((g,l)=>{const i=r.transaction(ga,"readwrite").objectStore(ga).clear();i.onsuccess=()=>g(),i.onerror=()=>{Qe.error("Failed to clear AI chat history.",i.error),l(new Error("Failed to clear AI chat history."))}})}async function Hg(r,g){const l=await mt();return new Promise((u,f)=>{const m=l.transaction(kn,"readwrite").objectStore(kn).put({id:r,completedDeckIds:Array.from(g)});m.onsuccess=()=>u(),m.onerror=()=>{Qe.error("Failed to save series progress.",m.error),f(new Error("Failed to save series progress."))}})}async function Gg(){const r=await mt();return new Promise((g,l)=>{const i=r.transaction(kn,"readonly").objectStore(kn).getAll();i.onsuccess=()=>{const o={};(Array.isArray(i.result)?i.result:[]).forEach(d=>{o[d.id]=d.completedDeckIds});const x=Object.keys(o).length;x>0&&Qe.log(`Successfully loaded progress for ${x} series.`),g(o)},i.onerror=()=>{Qe.error("Failed to get all series progress.",i.error),l(new Error("Failed to get all series progress."))}})}async function w0(){const r=await mt();return new Promise((g,l)=>{const i=r.transaction(kn,"readwrite").objectStore(kn).clear();i.onsuccess=()=>g(),i.onerror=()=>{Qe.error("Failed to clear series progress.",i.error),l(new Error("Failed to clear series progress."))}})}async function S0(r){if(Object.keys(r).length===0)return;const g=await mt();return new Promise((l,u)=>{const f=g.transaction(kn,"readwrite"),i=f.objectStore(kn);f.oncomplete=()=>l(),f.onerror=()=>{Qe.error("Transaction error adding series progress.",f.error),u(new Error("Transaction error adding series progress."))},Object.entries(r).forEach(([o,m])=>{i.put({id:o,completedDeckIds:m})})})}async function Yg(){const{decks:r,folders:g,deckSeries:l,reviews:u,sessions:f,seriesProgress:i}=await Ho();if(r.length===0&&g.length===0&&l.length===0)throw new Error("There is no data to export.");const o=localStorage.getItem("cogniflow-ai-options"),m=o?JSON.parse(o):void 0,x=await Cd(),d={},j=["themeId","disableAnimations","hapticsEnabled","aiFeaturesEnabled","backupEnabled","backupApiKey","syncOnCellular"],y={themeId:"cogniflow-themeId",disableAnimations:"cogniflow-disableAnimations",hapticsEnabled:"cogniflow-hapticsEnabled",aiFeaturesEnabled:"cogniflow-aiFeaturesEnabled",backupEnabled:"cogniflow-backupEnabled",backupApiKey:"cogniflow-backupApiKey",syncOnCellular:"cogniflow-syncOnCellular"};j.forEach(O=>{const C=y[O],M=localStorage.getItem(C);if(M!==null)try{["disableAnimations","hapticsEnabled","aiFeaturesEnabled","backupEnabled","syncOnCellular"].includes(O)?d[O]=JSON.parse(M):d[O]=M}catch{d[O]=M}});const _={version:7,decks:r,folders:g,deckSeries:l,reviews:u,sessions:f,aiChatHistory:x,seriesProgress:i,settings:d};m&&(_.aiOptions=m);const b=JSON.stringify(_,null,2),D=new Blob([b],{type:"application/json"}),w=URL.createObjectURL(D),N=document.createElement("a");N.style.display="none",N.href=w;const S=kd();return N.download=`cogniflow-backup-${S}.json`,document.body.appendChild(N),N.click(),window.URL.revokeObjectURL(w),document.body.removeChild(N),N.download}async function Qg(r){const g=await mt();return new Promise((l,u)=>{var o,m,x,d,j,y;Qe.log(`Starting atomic restore from backup version ${r.version}.`),Qe.log(`Backup contains: ${((o=r.decks)==null?void 0:o.length)||0} decks, ${((m=r.folders)==null?void 0:m.length)||0} folders, ${((x=r.deckSeries)==null?void 0:x.length)||0} series, ${((d=r.reviews)==null?void 0:d.length)||0} reviews, ${((j=r.sessions)==null?void 0:j.length)||0} sessions, ${Object.keys(r.seriesProgress||{}).length} series progresses, and ${((y=r.aiChatHistory)==null?void 0:y.length)||0} chat messages.`);const f=[Mn,jn,En,Pt,Kt,ga,kn],i=g.transaction(f,"readwrite");i.oncomplete=()=>{Qe.log("Atomic restore transaction completed successfully. All data has been replaced."),xa(),l()},i.onerror=_=>{Qe.error("Atomic restore transaction failed:",i.error),u(new Error("Database transaction failed during data restore."))};try{Qe.log(`Clearing ${f.length} stores...`);const _=i.objectStore(Mn);_.clear();const b=i.objectStore(jn);b.clear();const D=i.objectStore(En);D.clear();const w=i.objectStore(Pt);w.clear();const N=i.objectStore(Kt);N.clear();const S=i.objectStore(ga);S.clear();const O=i.objectStore(kn);O.clear(),Qe.log("All stores cleared."),Qe.log("Adding new data from backup..."),(r.decks||[]).forEach(C=>_.put(C)),(r.folders||[]).forEach(C=>b.put(C)),(r.deckSeries||[]).forEach(C=>D.put(C)),(r.reviews||[]).forEach(C=>{const{id:M,...R}=C;w.add(R)}),(r.sessions||[]).forEach(C=>N.put(C)),r.aiChatHistory&&r.aiChatHistory.length>0&&S.put({id:"global_history",history:r.aiChatHistory}),Object.entries(r.seriesProgress||{}).forEach(([C,M])=>{O.put({id:C,completedDeckIds:M})}),Qe.log("Finished queueing restore operations.")}catch(_){Qe.error("Error queueing operations for atomic restore:",_),i.abort(),u(_)}})}async function $g(){return sr&&((await sr).close(),sr=null),new Promise((r,g)=>{Qe.log(`Attempting to delete database: ${Lo}`);const l=indexedDB.deleteDatabase(Lo);l.onerror=u=>{Qe.error("Error deleting database.",u.target.error),g(new Error("Error deleting database."))},l.onsuccess=()=>{Qe.log("Database deleted successfully."),r()},l.onblocked=()=>{Qe.error("Database deletion blocked. Please close other tabs of this app and try again."),g(new Error("Deletion blocked. Please close other tabs of this app."))}})}const E0=Object.freeze(Object.defineProperty({__proto__:null,addDeckSeries:Bo,addDecks:si,addFolder:Tg,addFolders:c0,addReviewLog:Lg,bulkAddReviews:b0,bulkAddSeriesProgress:S0,bulkAddSessions:f0,bulkUpdateDecks:Ed,clearAIChatHistory:v0,clearDecks:h0,clearFolders:m0,clearReviews:x0,clearSeries:p0,clearSeriesProgress:w0,clearSessions:d0,deleteDeck:Ad,deleteDeckSeries:Rg,deleteFolder:Dg,deleteReviewsForDecks:y0,deleteSessionState:ml,exportAllData:Yg,factoryReset:$g,getAIChatHistory:Cd,getAllDataForBackup:Ho,getAllDeckSeries:Og,getAllDecks:_g,getAllFolders:Ag,getAllReviews:g0,getAllSeriesProgress:Gg,getAllSessionKeys:zg,getAllSessions:u0,getReviewsForDeck:Fg,getReviewsSince:Bg,getSessionState:Ug,performAtomicRestore:Qg,saveAIChatHistory:qg,saveSeriesProgress:Hg,saveSessionState:Mg,updateDeck:kg,updateDeckSeries:Ig,updateFolder:Cg},Symbol.toStringTag,{value:"Module"}));var wt=(r=>(r[r.Again=1]="Again",r[r.Hard=2]="Hard",r[r.Good=3]="Good",r[r.Easy=4]="Easy",r))(wt||{}),Ce=(r=>(r.Flashcard="flashcard",r.Quiz="quiz",r.Learning="learning",r))(Ce||{}),Ta=(r=>(r.NO_ACTION="NO_ACTION",r.CREATE_DECK="CREATE_DECK",r.RENAME_DECK="RENAME_DECK",r.DELETE_DECK="DELETE_DECK",r.CREATE_FOLDER="CREATE_FOLDER",r.RENAME_FOLDER="RENAME_FOLDER",r.DELETE_FOLDER="DELETE_FOLDER",r.MOVE_DECK_TO_FOLDER="MOVE_DECK_TO_FOLDER",r.EXPAND_SERIES_ADD_LEVELS="EXPAND_SERIES_ADD_LEVELS",r.EXPAND_SERIES_ADD_DECKS="EXPAND_SERIES_ADD_DECKS",r.GENERATE_QUESTIONS_FOR_DECK="GENERATE_QUESTIONS_FOR_DECK",r))(Ta||{});const Gr=2.5,jd=1.3,j0=1,N0=1.2,_0=1.3,k0={1:-.2,2:-.15,3:0,4:.15};function Dd(r,g=null){const l={isValid:!1,parsed:null,errors:[],detailedErrors:[],suggestions:[],fixedJSON:null,schemaIssues:[]};if(!r||typeof r!="string"||r.trim()==="")return l.errors.push("Input must be a non-empty string"),l;let u=null;if(g)try{u=JSON.parse(g)}catch{l.schemaIssues.push({type:"error",path:"Template",message:"The provided Schema/Template JSON is itself invalid and cannot be used for comparison."})}let f=r;try{l.parsed=JSON.parse(f),l.isValid=!0,l.fixedJSON=JSON.stringify(l.parsed,null,2)}catch(i){const o=A0(i,f);l.errors.push(i.message),l.detailedErrors.push(o);const m=D0(f);if(m.success){l.fixedJSON=m.fixed,f=m.fixed,l.suggestions=m.suggestions;try{l.parsed=JSON.parse(f),l.isValid=!0}catch{}}else l.suggestions=m.suggestions}return u&&l.parsed&&l.schemaIssues.push(...Nd(l.parsed,u)),l}function Nd(r,g,l="$"){const u=[];if(Array.isArray(g))return Array.isArray(r)?(g.length>0&&r.length>0&&u.push(...Nd(r[0],g[0],`${l}[0]`)),u):(u.push({type:"error",path:l,message:`Type Mismatch: Expected an array but got ${typeof r}.`}),u);if(typeof g=="object"&&g!==null){if(typeof r!="object"||r===null||Array.isArray(r))return u.push({type:"error",path:l,message:`Type Mismatch: Expected an object but got ${Array.isArray(r)?"array":typeof r}.`}),u;const f=Object.keys(g),i=new Set(Object.keys(r));for(const o of f){const m=`${l}.${o}`;if(!i.has(o))u.push({type:"warning",path:m,message:`Missing Key: The key '${o}' is missing.`});else{const x=Array.isArray(g[o])?"array":typeof g[o],d=Array.isArray(r[o])?"array":typeof r[o];x!==d?u.push({type:"error",path:m,message:`Type Mismatch: Expected type '${x}' but got '${d}'.`}):typeof g[o]=="object"&&g[o]!==null&&u.push(...Nd(r[o],g[o],m))}}for(const o of Array.from(i))f.includes(o)||u.push({type:"info",path:`${l}.${o}`,message:`Extra Key: The key '${o}' is present but not in the schema.`});return u}return u}function A0(r,g){var b;const l=r.message,u=g.split(`
`);let f=null,i=null,o="Syntax Error",m="",x="",d="",j;const y=l.match(/at position (\d+)/),_=l.match(/at line (\d+) column (\d+)/i);if(y){const D=parseInt(y[1],10),{line:w,column:N}=T0(g,D);f=w,i=N,m=Io(u,f-1,i-1);const S=g.substring(0,D).trim();l.includes("Expected property name or '}'")?(o="Invalid Object Key or Trailing Comma",S.endsWith(",")?j='A trailing comma was found. JSON does not allow a comma after the last item in an object. For example, `{"key": "value",}` is invalid. Remove the comma.':j='An object key might be missing or invalid. All keys in JSON must be strings enclosed in double quotes (e.g., `"key": "value"`). Check for unquoted keys or a missing comma.'):l.includes("Unexpected token")&&(d=((b=l.match(/Unexpected token (.+?) in JSON/))==null?void 0:b[1])||"",o="Unexpected Token",(d==="}"||d==="]")&&S.endsWith(",")?(o="Trailing Comma",j='A trailing comma was found. JSON format does not allow a comma after the last item in an array or object. For example, `[1, 2,]` and `{"key":"value",}` are invalid. Remove the final comma.'):d==="'"?(o="Invalid String Quote",j="JSON strings must use double quotes (`\"`). Single quotes (`'`) are not permitted. For example, change `'value'` to `\"value\"`."):d==="="?(o="Invalid Assignment",j="JSON uses a colon (`:`) to separate keys from values, not an equals sign (`=`). This may be a typo (e.g., `:=` instead of just `:`) that needs to be corrected."):d.toLowerCase()==="u"&&g.substring(D).startsWith("undefined")?(o="Invalid Value",j="The value `undefined` is not valid in JSON. This is common when converting JavaScript objects. Use `null` instead or remove the key-value pair."):d.match(/^[a-zA-Z]/)?(o="Unquoted String",j='This looks like an unquoted string, key, or value. All strings and object keys in JSON must be enclosed in double quotes. For example, `{ key: "value" }` should be `{ "key": "value" }`.'):j=`An unexpected character '${d}' was found. This is often caused by a missing comma, a missing colon, or a typo. Please check the syntax around this character.`)}else if(_)f=parseInt(_[1],10),i=parseInt(_[2],10),m=Io(u,f-1,i-1),l.includes("trailing comma")?(o="Trailing Comma",j="A trailing comma was found. JSON format does not allow a comma after the last item in an object or array. For example, `[1, 2,]` is invalid. Remove the final comma."):l.includes("expected property name")?(o="Invalid Object Key",j='An object key is expected here. All keys in JSON must be strings enclosed in double quotes (e.g., `"key": "value"`). Check for missing quotes or a missing comma before this line.'):l.includes("expected a string")?(o="Invalid String",j="This value was expected to be a string, but it isn't. Remember to wrap all strings in double quotes (`\"`). Single quotes are not allowed. For example, use `\"text\"` instead of `'text'` or `text`."):(o="Syntax Error",j="There is a syntax error at this location. Please check for issues like missing commas (,), colons (:), or mismatched brackets/braces ([]/{}).");else if(l.match(/Unterminated string|Unexpected end of JSON input/i)){const D=C0(g);D.line!==null&&D.column!==null?(o="Unterminated String",f=D.line,i=D.column,m=Io(u,f-1,i-1),j='An unclosed string was detected. All strings in JSON must be enclosed in double quotes. Check for a missing closing quote (`"`) on this line or a previous one.'):(o="Unexpected End of Input",m=Io(u,u.length-1),j="The JSON ends unexpectedly. This usually means you are missing a closing brace `}` for an object or a closing bracket `]` for an array.")}return j||(j="The JSON structure is invalid. Please check for common syntax errors like missing commas, incorrect quotes, or mismatched brackets and braces."),{type:o,line:f,column:i,expected:x,actual:d,context:m,message:l,friendlyMessage:j}}function T0(r,g){const l=r.substring(0,g).split(`
`);return{line:l.length,column:l[l.length-1].length+1}}function Io(r,g,l,u=2){const f=Math.max(0,g-u),i=Math.min(r.length,g+u+1),o=r.slice(f,i);if(l!==void 0&&l>=1&&g>=f&&g<i){const m=g-f,x=" ".repeat(l-1)+"^";o.splice(m+1,0,x)}return o.join(`
`)}function C0(r){const g=r.split(`
`);let l=!1,u="",f=!1,i={line:null,column:null};for(let o=0;o<g.length;o++){const m=g[o];for(let x=0;x<m.length;x++){const d=m[x];if(f){f=!1;continue}if(d==="\\"&&l){f=!0;continue}(d==='"'||d==="'")&&!l?(l=!0,u=d,i={line:o+1,column:x+1}):d===u&&l&&(l=!1)}}return l&&i.line!==null?{...i,context:""}:{line:null,column:null,context:""}}function D0(r){let g=r;const l=new Set,u=I0(g);u.fixes.length>0&&(g=u.fixed,u.fixes.forEach(f=>l.add(f)));try{const f=JSON.parse(g);return{success:!0,fixed:JSON.stringify(f,null,2),suggestions:Array.from(l)}}catch(f){let i=Array.from(l);return f.message.includes("Unterminated string")&&i.push("Attempted to fix an unterminated string. Please review the result."),i.length===0&&i.push("Could not automatically fix JSON errors."),{success:!1,fixed:null,suggestions:i}}}function O0(r){return r.replace(/[\u2018\u2019\u201C\u201D]/g,'"')}function I0(r){const g=[];let l=r.trim();const u=l;l=O0(l),u!==l&&g.push("Replaced smart/typographic quotes with standard double quotes");const f=[{regex:/(:\s*)=/g,replacement:"$1",description:"Replaced invalid assignment operator (e.g. `:=`) with a colon"},{regex:/,\s*([}\]])/g,replacement:"$1",description:"Removed trailing commas"},{regex:/([{,]\s*)([a-zA-Z_$][a-zA-Z0-9_$]*)\s*:/g,replacement:'$1"$2":',description:"Added quotes to unquoted keys"},{regex:/:\s*([^",\s\[\{][^,}\]]*?)(?=\s*[,}])/g,replacement:': "$1"',description:"Added quotes to an unquoted string value"},{regex:/:\s*(undefined|NaN|Infinity|-Infinity)/g,replacement:": null",description:"Replaced `undefined`, `NaN`, or `Infinity` with `null`"},{regex:/"(\s*)"(?!\s*[:],}])/g,replacement:'","',description:"Added missing comma between string values"},{regex:/}(\s*)"/g,replacement:'},"$1"',description:"Added missing comma between an object and a following key"},{regex:/\](\s*)"/g,replacement:'],"$1"',description:"Added missing comma between an array and a following key"},{regex:/\](\s*)\{/g,replacement:"], $1{",description:"Added missing comma between an array and an object"}];for(let i=0;i<3;i++)f.forEach(o=>{const m=l;l=l.replace(o.regex,o.replacement),m!==l&&!g.includes(o.description)&&g.push(o.description)});return{fixed:l,fixes:g}}const Go=r=>{const g=Dd(r);if(!g.isValid&&!g.fixedJSON){const u=g.detailedErrors[0];throw u&&u.friendlyMessage?new Error(`Failed to parse backup file: ${u.friendlyMessage} (Line: ${u.line})`):new Error(`Failed to parse backup file: ${g.errors.join(", ")}`)}let l=g.parsed;if(!l&&g.fixedJSON)try{l=JSON.parse(g.fixedJSON)}catch{throw new Error("The backup file had errors that could not be automatically fixed. Please review the file for syntax errors.")}if(l===null||typeof l>"u")throw new Error("The backup file appears to be empty or invalid after attempting to fix it.");try{if(typeof l=="string"&&(l=JSON.parse(l)),typeof l=="object"&&l!==null&&!("version"in l)&&!Array.isArray(l)&&("data"in l&&typeof l.data=="object"?l=l.data:"content"in l&&typeof l.content=="object"&&(l=l.content)),typeof l=="object"&&l!==null&&"version"in l){if(l.version>7)throw new Error(`Unsupported backup version: ${l.version}`);const u=(Array.isArray(l.decks)?l.decks:[]).filter(o=>o&&typeof o=="object"&&o.id&&o.name&&o.type).map(o=>(o.type===Ce.Flashcard?o.cards=(o.cards||[]).filter(Boolean):(o.type===Ce.Quiz||o.type===Ce.Learning)&&(o.questions=(o.questions||[]).filter(Boolean).map(m=>(m&&(m.options=(m.options||[]).filter(Boolean)),m)).filter(Boolean)),o.type===Ce.Learning&&(o.infoCards=(o.infoCards||[]).filter(Boolean)),o)),f=(Array.isArray(l.folders)?l.folders:[]).filter(o=>o&&typeof o=="object"&&o.id&&o.name),i=(Array.isArray(l.deckSeries)?l.deckSeries:[]).filter(o=>o&&typeof o=="object"&&o.id&&o.name).map(o=>(Array.isArray(o.levels)&&(o.levels=(o.levels||[]).filter(Boolean).map(m=>(m&&(m.deckIds=(m.deckIds||[]).filter(Boolean)),m)).filter(Boolean)),o));return{version:l.version,decks:u,folders:f,deckSeries:i,reviews:(Array.isArray(l.reviews)?l.reviews:[]).filter(Boolean),sessions:(Array.isArray(l.sessions)?l.sessions:[]).filter(Boolean),seriesProgress:l.seriesProgress&&typeof l.seriesProgress=="object"?l.seriesProgress:{},aiChatHistory:(Array.isArray(l.aiChatHistory)?l.aiChatHistory:[]).filter(Boolean),aiOptions:l.aiOptions||void 0,settings:l.settings||void 0}}if(Array.isArray(l)&&(l.length===0||l.length>0&&typeof l[0]=="object"&&l[0]!==null&&"id"in l[0]&&"type"in l[0])){const u=l.filter(Boolean).map(f=>(f.type||(f.type=Array.isArray(f.cards)?Ce.Flashcard:Ce.Quiz),f.type===Ce.Flashcard?f.cards=(f.cards||[]).filter(Boolean):f.type===Ce.Quiz&&(f.questions=(f.questions||[]).filter(Boolean)),f)).filter(f=>f&&f.id&&f.name&&f.type);if(u.length>0||l.length===0)return{version:1,decks:u,folders:[],deckSeries:[],reviews:[],sessions:[],seriesProgress:{},aiChatHistory:[]}}throw new Error("The file is not a valid CogniFlow backup file.")}catch(u){throw console.error("Failed to validate backup data structure:",u),new Error(u instanceof Error?u.message:"Invalid backup file structure.")}},Fo=r=>{if(!r.trim())throw new Error("Pasted content is empty.");const g=Dd(r);if(!g.isValid){const u=g.detailedErrors[0];throw u&&u.friendlyMessage?new Error(`Invalid JSON: ${u.friendlyMessage}`):new Error(`Invalid JSON: ${g.errors.join(", ")}`)}const l=g.parsed;if(typeof l=="object"&&l!==null&&"seriesName"in l&&"levels"in l){if(typeof l.seriesName!="string"||typeof l.seriesDescription!="string"||!Array.isArray(l.levels))throw new Error("Invalid series format. Must have 'seriesName' (string), 'seriesDescription' (string), and a 'levels' (array).");for(const u of l.levels){if(typeof u.title!="string"||!Array.isArray(u.decks))throw new Error("Each level in the series must have a 'title' (string) and a 'decks' (array).");for(const f of u.decks){if(typeof f.name!="string"||typeof f.description!="string"||!f.type)throw new Error(`Each deck in a series must have a 'name', 'description', and 'type' ('quiz' or 'flashcard'). Deck name: ${f.name||"unknown"}`);if(f.type==="quiz"){if(!Array.isArray(f.questions))throw new Error(`Quiz deck "${f.name}" must have a 'questions' array.`)}else if(f.type==="flashcard"){if(!Array.isArray(f.cards))throw new Error(`Flashcard deck "${f.name}" must have a 'cards' array.`)}else throw new Error(`Deck "${f.name}" has an unsupported type: '${f.type}'. Must be 'quiz' or 'flashcard'.`)}}return{type:"series",data:l}}if(Array.isArray(l)){const u=[];for(const f of l){if(typeof f.front!="string"||typeof f.back!="string")throw new Error("Each item in the array must be an object with 'front' and 'back' string properties.");u.push({front:f.front,back:f.back})}return{type:Ce.Flashcard,data:u}}if(typeof l=="object"&&l!==null&&"questions"in l){if(typeof l.name!="string"||typeof l.description!="string"||!Array.isArray(l.questions))throw new Error("Quiz JSON must be an object with 'name' (string), 'description' (string), and 'questions' (array) properties.");for(const u of l.questions)if(typeof u.questionText!="string"||!Array.isArray(u.options)||typeof u.correctAnswerId!="string")throw new Error("Each question in a quiz must have 'questionText', an 'options' array, and a 'correctAnswerId'.");return{type:Ce.Quiz,data:l}}throw new Error("Unsupported JSON structure. Expected an array of flashcards, a single quiz object, or a series object.")},R0=(r,g)=>{if(!r.trim())throw new Error("Pasted content is empty.");const l=Dd(r);if(!l.isValid){const f=l.detailedErrors[0];throw f&&f.friendlyMessage?new Error(`Invalid JSON: ${f.friendlyMessage}`):new Error(`Invalid JSON: ${l.errors.join(", ")}`)}const u=l.parsed;if(!Array.isArray(u))throw new Error("JSON must be an array of items.");if(u.length===0)return[];if(g===Ce.Flashcard){const f=[];for(const i of u){if(typeof i.front!="string"||typeof i.back!="string")throw new Error("Each item in the array must be an object with 'front' and 'back' string properties.");f.push({front:i.front,back:i.back})}return f}else{const f=[];for(const i of u){if(typeof i.questionText!="string"||!Array.isArray(i.options)||typeof i.correctAnswerId!="string")throw new Error("Each question must have 'questionText', an 'options' array, and a 'correctAnswerId'.");f.push(i)}return f}},pl=r=>{const g=new Date;return g.setHours(0,0,0,0),r.map(l=>({id:crypto.randomUUID(),front:l.front,back:l.back,dueDate:g.toISOString(),interval:0,easeFactor:Gr,masteryLevel:0,lapses:0}))},pa=r=>{const g=new Date;return g.setHours(0,0,0,0),r.map(l=>({...l,id:crypto.randomUUID(),questionType:"multipleChoice",dueDate:g.toISOString(),interval:0,easeFactor:Gr,masteryLevel:0,lapses:0}))},M0=r=>{try{const g=Fo(r);return{type:g.type,data:g.data}}catch{}try{return{type:"backup",data:Go(r)}}catch{}return null},Ca={...E0},wn={fetch:window.fetch.bind(window)},U0="https://www.greenyogafestival.org/backup-api/api/v1",Yr="cogniflow-data",qo="cogniflow-data.json",z0="cogniflow-ai-chat.json",L0="test-api-key",B0=()=>localStorage.getItem("cogniflow-backupApiKey")||"qRt+gU/57GHKhxTZeRnRi+dfT274iSkKKq2UnTr9Bxs=",Pg=r=>localStorage.setItem("cogniflow-lastSyncEtag",r),fl=()=>localStorage.getItem("cogniflow-lastSyncEtag"),F0=r=>localStorage.setItem("cogniflow-aiChat-lastSyncEtag",r);async function Qr(r,g={}){const l=`${U0}/${r}`,u=B0(),f=new Headers(g.headers||{});f.set("X-API-Key",u),g.body instanceof FormData&&f.delete("Content-Type");const i={...g,headers:f};console.log(`[BackupService] Requesting: ${g.method||"GET"} ${l}`,{headers:Object.fromEntries(f.entries())});const o=3,m=1e3;for(let x=1;x<=o;x++)try{const d=await wn.fetch(l,i);if(console.log(`[BackupService] Response from ${g.method||"GET"} ${l}: ${d.status}`),!d.ok&&![304,404].includes(d.status)){let j;try{j=await d.json()}catch{j={error:`HTTP error! status: ${d.status}`}}console.error("[BackupService] API request failed:",j);const y=(j==null?void 0:j.error)||(j==null?void 0:j.message)||`Request failed with status ${d.status}`,_=new Error(y);throw _.status=d.status,_}return d}catch(d){if(d instanceof TypeError&&d.message.toLowerCase().includes("failed to fetch"))if(x<o){const j=m*Math.pow(2,x-1);console.warn(`[BackupService] Attempt ${x} failed. Retrying in ${j}ms...`,d),await new Promise(y=>setTimeout(y,j));continue}else{console.error("[BackupService] All network attempts failed. This may be a network or CORS issue.",d);const j=new Error("Network error: Could not connect to the backup server. Please check your internet connection and any browser extensions (like ad-blockers) that may be interfering.");throw j.isNetworkError=!0,j}throw d}throw new Error("An unexpected error occurred in the request function.")}async function hl(r,g=!1){console.log("[BackupService] Starting syncDataToServer...");let l;{const{decks:d,folders:j,deckSeries:y,reviews:_,sessions:b,seriesProgress:D}=await Ca.getAllDataForBackup(),w=await Ca.getAIChatHistory(),N=localStorage.getItem("cogniflow-ai-options"),S=N?JSON.parse(N):void 0;l={version:6,decks:d,folders:j,deckSeries:y,reviews:_,sessions:b,seriesProgress:D,aiOptions:S,aiChatHistory:w}}const u=JSON.stringify(l),f={"Content-Type":"application/json"},i=fl();i&&!g&&(f["If-Match"]=i),console.log(`[BackupService] PUT ${qo}`,{headers:f,body:`(JSON body of size ${u.length})`});const o=await Qr(`apps/${Yr}/backups/${qo}`,{method:"PUT",headers:f,body:u});if(!o.ok){let d;try{d=await o.json()}catch{d={error:`HTTP error! status: ${o.status}`}}const j=(d==null?void 0:d.error)||(d==null?void 0:d.message)||`Request failed with status ${o.status}`,y=new Error(j);throw y.status=o.status,y}const m=o.headers.get("ETag");m&&Pg(m);const x=await o.json();return console.log("[BackupService] syncDataToServer successful:",x),{timestamp:x.modified,etag:m||""}}async function dl(){console.log("[BackupService] Starting syncDataFromServer...");const r=await Qr(`apps/${Yr}/backups/${qo}`);if(r.status===404)throw new Error("No sync file found on the server.");const g=r.headers.get("ETag");g&&Pg(g);const l=await r.text(),u=Go(l);return console.log("[BackupService] syncDataFromServer successful."),u}async function ii(){console.log("[BackupService] Starting getSyncDataMetadata...");const r={},g=fl();g&&(r["If-None-Match"]=g);const l=await Qr(`apps/${Yr}/backups/${qo}/meta`,{headers:r});if(l.status===304||l.status===404)return console.log(`[BackupService] getSyncDataMetadata finished with status: ${l.status}`),{metadata:null,isNotModified:l.status===304};const u=await l.json();return console.log("[BackupService] getSyncDataMetadata successful:",u),{metadata:u,isNotModified:!1}}async function q0(){console.log("[BackupService] Starting syncAIChatHistoryFromServer...");const r=await Qr(`apps/${Yr}/backups/${z0}`);if(r.status===404)throw r;const g=r.headers.get("ETag");g&&F0(g);const l=await r.json();return console.log("[BackupService] syncAIChatHistoryFromServer successful."),l.history||[]}async function H0(){var l;console.log("[BackupService] Starting listServerBackups...");const g=await(await Qr(`apps/${Yr}/backups/list`)).json();return console.log(`[BackupService] Found ${((l=g.backups)==null?void 0:l.length)||0} backups.`),g.backups||[]}async function Jg(){console.log("[BackupService] Starting createServerBackup...");const{decks:r,folders:g,deckSeries:l,reviews:u,sessions:f,seriesProgress:i}=await Ca.getAllDataForBackup(),o=localStorage.getItem("cogniflow-ai-options"),m=o?JSON.parse(o):void 0,x=await Ca.getAIChatHistory(),j=JSON.stringify({version:6,decks:r,folders:g,deckSeries:l,reviews:u,sessions:f,seriesProgress:i,aiOptions:m,aiChatHistory:x}),y=new Blob([j],{type:"application/json"}),_=`backup-${kd()}.json`,b=new FormData;b.append("file",y,_);const w=await(await Qr(`apps/${Yr}/backups`,{method:"POST",body:b})).json();return console.log("[BackupService] createServerBackup successful:",w),w}async function Vg(r){console.log(`[BackupService] Restoring live sync from manual backup: ${r}...`);const l=await(await Qr(`apps/${Yr}/backups/${r}/restore`,{method:"POST"})).json();return console.log(`[BackupService] Restore from ${r} successful:`,l),l}async function Kg(r){console.log(`[BackupService] Deleting manual backup: ${r}...`),await Qr(`apps/${Yr}/backups/${r}`,{method:"DELETE"}),console.log(`[BackupService] Deleted ${r} successfully.`)}async function G0(){console.log("%c--- Running Backup Service Unit Tests ---","color: blue; font-weight: bold;");const r=wn.fetch,g=localStorage.getItem,l=localStorage.setItem,u=Ca.getAllDataForBackup,f=Ca.getAIChatHistory;let i=0,o=0,m="initial-etag";const x={"cogniflow-backupApiKey":L0},d=async(w,N)=>{i++,console.log(`
Running test: ${w}`);try{m="initial-etag",x["cogniflow-lastSyncEtag"]=m,x["cogniflow-aiChat-lastSyncEtag"]=m,await N(),console.log(`%c✔ PASS: ${w}`,"color: green;"),o++}catch(S){console.error(`%c❌ FAIL: ${w}`,"color: red;"),console.error(S)}},j=(w,N,S)=>{const O=JSON.stringify(w),C=JSON.stringify(N);if(O!==C)throw new Error(`${S}
Expected: ${C}
Actual:   ${O}`)},y=(w,N)=>{if(!w)throw new Error(N)},_=async(w,N,S)=>{try{throw await w(),new Error(`Expected function to throw, but it did not. ${S}`)}catch(O){if(!O.message.includes(N))throw new Error(`${S}
Expected error message to include: "${N}"
Actual error message: "${O.message}"`)}},b={decks:[{id:"d1",name:"Deck 1",type:"flashcard",cards:[]}],folders:[],deckSeries:[],reviews:[],sessions:[],seriesProgress:{}},D=[{id:"m1",role:"user",text:"hello"}];localStorage.getItem=w=>x[w]||null,localStorage.setItem=(w,N)=>{x[w]=N},Ca.getAllDataForBackup=async()=>Promise.resolve(b),Ca.getAIChatHistory=async()=>Promise.resolve(D),await d("syncDataToServer should succeed and update ETag",async()=>{wn.fetch=async(N,S)=>{const O=new Headers(S==null?void 0:S.headers);return y(O.get("If-Match")==="initial-etag","If-Match header should be sent"),new Response(JSON.stringify({modified:"2023-01-01T12:00:00Z"}),{status:200,headers:{ETag:"new-etag"}})};const w=await hl();j(w.etag,"new-etag","Should return the new ETag"),j(fl(),"new-etag","Should store the new ETag in localStorage")}),await d("syncDataToServer should use force option to ignore ETag",async()=>{wn.fetch=async(w,N)=>{const S=new Headers(N==null?void 0:N.headers);return y(!S.has("If-Match"),"If-Match header should NOT be sent when force=true"),new Response(JSON.stringify({modified:"2023-01-01T12:00:00Z"}),{status:201,headers:{ETag:"forced-etag"}})},await hl(void 0,!0),j(fl(),"forced-etag","ETag should be updated even on force sync")}),await d("syncDataToServer should handle 412 Precondition Failed",async()=>{wn.fetch=async()=>new Response(JSON.stringify({error:"ETag mismatch"}),{status:412}),await _(()=>hl(),"ETag mismatch","Should throw on 412 error")}),await d("syncDataFromServer should succeed and parse data",async()=>{const w={...b,version:6};wn.fetch=async()=>new Response(JSON.stringify(w),{status:200,headers:{ETag:"server-etag"}});const N=await dl();j(N.decks,b.decks,"Parsed decks should match mock data"),j(fl(),"server-etag","Should update ETag on successful fetch")}),await d("syncDataFromServer should handle malformed JSON",async()=>{wn.fetch=async()=>new Response('{"decks": [',{status:200}),await _(()=>dl(),"The JSON ends unexpectedly","Should throw a descriptive error for malformed JSON")}),await d("syncDataFromServer should handle backups with null items in arrays",async()=>{const w={version:6,decks:[{id:"d1",name:"Deck 1",type:"flashcard",cards:[{id:"c1",front:"f",back:"b",dueDate:"2025-01-01",interval:1,easeFactor:2.5},null,{id:"c2",front:"f2",back:"b2",dueDate:"2025-01-01",interval:1,easeFactor:2.5}]},null],folders:[{id:"f1",name:"Folder 1"},null],deckSeries:[]};wn.fetch=async()=>new Response(JSON.stringify(w),{status:200});const N=await dl();j(N.decks.length,1,"Should filter out null decks");const S=N.decks[0];if(S&&S.type==="flashcard")j(S.cards.length,2,"Should filter out null cards");else throw new Error("Assertion failed: Expected a FlashcardDeck or no deck at all.");j(N.folders.length,1,"Should filter out null folders")}),await d("syncDataFromServer should handle 404 Not Found",async()=>{wn.fetch=async()=>new Response(null,{status:404}),await _(()=>dl(),"No sync file found on the server","Should throw a specific message on 404")}),await d("getSyncDataMetadata should send If-None-Match header",async()=>{wn.fetch=async(w,N)=>{const S=new Headers(N==null?void 0:N.headers);return y(S.get("If-None-Match")==="initial-etag","If-None-Match header should be sent"),new Response(JSON.stringify({filename:"test.json"}),{status:200})},await ii()}),await d("getSyncDataMetadata should handle 304 Not Modified",async()=>{wn.fetch=async()=>new Response(null,{status:304});const{metadata:w,isNotModified:N}=await ii();y(N,"isNotModified should be true on 304"),j(w,null,"Metadata should be null on 304")}),await d("syncAIChatHistoryFromServer should throw on 404",async()=>{const w=new Response(null,{status:404});wn.fetch=async()=>w;try{throw await q0(),new Error("Function did not throw")}catch(N){j(N,w,"Should throw the raw response object on 404")}}),await d("createServerBackup should send multipart/form-data",async()=>{wn.fetch=async(N,S)=>{y((S==null?void 0:S.body)instanceof FormData,"Body should be FormData");const C=S.body.get("file");return y(C.name.startsWith("backup-"),"File should have correct name format"),new Response(JSON.stringify({message:"Backup successful",filename:C.name}),{status:201})};const w=await Jg();y(w.message==="Backup successful","Success message should be returned")}),await d("restoreFromServerBackup should send POST request",async()=>{const w="backup-test.json";let N="";wn.fetch=async(S,O)=>(y(S.toString().endsWith("/restore"),"URL should end with /restore"),N=O==null?void 0:O.method,new Response(JSON.stringify({message:"Restore initiated"}),{status:200})),await Vg(w),j(N,"POST","Should use POST method")}),await d("deleteServerBackup should send DELETE request",async()=>{const w="backup-to-delete.json";let N="";wn.fetch=async(S,O)=>(y(S.toString().includes(w),"URL should contain the filename"),N=O==null?void 0:O.method,new Response(null,{status:204})),await Kg(w),j(N,"DELETE","Should use DELETE method")}),console.log(`
%c--- Test Summary ---`,"color: blue; font-weight: bold;"),console.log(`Total tests: ${i}`),console.log(`%cPassed: ${o}`,"color: green;"),i>o&&console.log(`%cFailed: ${i-o}`,"color: red;"),wn.fetch=r,localStorage.getItem=g,localStorage.setItem=l,Ca.getAllDataForBackup=u,Ca.getAIChatHistory=f}window.runBackupServiceTests=G0;const Y0=()=>{const[r,g]=U.useState(null);return U.useEffect(()=>{const u=f=>{f.preventDefault(),g(f)};return window.addEventListener("beforeinstallprompt",u),()=>{window.removeEventListener("beforeinstallprompt",u)}},[]),[r,()=>{r&&(r.prompt(),r.userChoice.then(u=>{u.outcome==="accepted"?console.log("User accepted the install prompt"):console.log("User dismissed the install prompt"),g(null)}))}]},Od=()=>{const r=()=>{const u=navigator,f=u.connection;return{isOnline:u.onLine,isMetered:f?f.type==="cellular"||f.saveData===!0:!1}},[g,l]=U.useState(r);return U.useEffect(()=>{const u=()=>l(r()),i=navigator.connection;return window.addEventListener("online",u),window.addEventListener("offline",u),i==null||i.addEventListener("change",u),()=>{window.removeEventListener("online",u),window.removeEventListener("offline",u),i==null||i.removeEventListener("change",u)}},[]),g},Q0={plus:n.jsxs(n.Fragment,{children:[n.jsx("line",{x1:"12",y1:"5",x2:"12",y2:"19"}),n.jsx("line",{x1:"5",y1:"12",x2:"19",y2:"12"})]}),"upload-cloud":n.jsxs(n.Fragment,{children:[n.jsx("path",{d:"M20 16.58A5 5 0 0 0 18 7h-1.26A8 8 0 1 0 4 15.25"}),n.jsx("polyline",{points:"16 16 12 12 8 16"}),n.jsx("line",{x1:"12",y1:"12",x2:"12",y2:"21"})]}),x:n.jsxs(n.Fragment,{children:[n.jsx("line",{x1:"18",y1:"6",x2:"6",y2:"18"}),n.jsx("line",{x1:"6",y1:"6",x2:"18",y2:"18"})]}),"chevron-left":n.jsx(n.Fragment,{children:n.jsx("polyline",{points:"15 18 9 12 15 6"})}),"trash-2":n.jsxs(n.Fragment,{children:[n.jsx("polyline",{points:"3 6 5 6 21 6"}),n.jsx("path",{d:"M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"}),n.jsx("line",{x1:"10",y1:"11",x2:"10",y2:"17"}),n.jsx("line",{x1:"14",y1:"11",x2:"14",y2:"17"})]}),"check-circle":n.jsxs(n.Fragment,{children:[n.jsx("path",{d:"M22 11.08V12a10 10 0 1 1-5.93-9.14"}),n.jsx("polyline",{points:"22 4 12 14.01 9 11.01"})]}),"x-circle":n.jsxs(n.Fragment,{children:[n.jsx("circle",{cx:"12",cy:"12",r:"10"}),n.jsx("line",{x1:"15",y1:"9",x2:"9",y2:"15"}),n.jsx("line",{x1:"9",y1:"9",x2:"15",y2:"15"})]}),download:n.jsxs(n.Fragment,{children:[n.jsx("path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"}),n.jsx("polyline",{points:"7 10 12 15 17 10"}),n.jsx("line",{x1:"12",y1:"15",x2:"12",y2:"3"})]}),laptop:n.jsxs(n.Fragment,{children:[n.jsx("path",{d:"M20 16V7a2 2 0 0 0-2-2H6a2 2 0 0 0-2 2v9h16z"}),n.jsx("rect",{x:"2",y:"17",width:"20",height:"4",rx:"1"})]}),menu:n.jsxs(n.Fragment,{children:[n.jsx("line",{x1:"3",y1:"12",x2:"21",y2:"12"}),n.jsx("line",{x1:"3",y1:"6",x2:"21",y2:"6"}),n.jsx("line",{x1:"3",y1:"18",x2:"21",y2:"18"})]}),edit:n.jsxs(n.Fragment,{children:[n.jsx("path",{d:"M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"}),n.jsx("path",{d:"M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"})]}),save:n.jsxs(n.Fragment,{children:[n.jsx("path",{d:"M19 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11l5 5v11a2 2 0 0 1-2 2z"}),n.jsx("polyline",{points:"17 21 17 13 7 13 7 21"}),n.jsx("polyline",{points:"7 3 7 8 15 8"})]}),sun:n.jsxs(n.Fragment,{children:[n.jsx("circle",{cx:"12",cy:"12",r:"5"}),n.jsx("line",{x1:"12",y1:"1",x2:"12",y2:"3"}),n.jsx("line",{x1:"12",y1:"21",x2:"12",y2:"23"}),n.jsx("line",{x1:"4.22",y1:"4.22",x2:"5.64",y2:"5.64"}),n.jsx("line",{x1:"18.36",y1:"18.36",x2:"19.78",y2:"19.78"}),n.jsx("line",{x1:"1",y1:"12",x2:"3",y2:"12"}),n.jsx("line",{x1:"21",y1:"12",x2:"23",y2:"12"}),n.jsx("line",{x1:"4.22",y1:"19.78",x2:"5.64",y2:"18.36"}),n.jsx("line",{x1:"18.36",y1:"5.64",x2:"19.78",y2:"4.22"})]}),moon:n.jsx(n.Fragment,{children:n.jsx("path",{d:"M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"})}),code:n.jsxs(n.Fragment,{children:[n.jsx("polyline",{points:"16 18 22 12 16 6"}),n.jsx("polyline",{points:"8 6 2 12 8 18"})]}),"refresh-ccw":n.jsxs(n.Fragment,{children:[n.jsx("polyline",{points:"1 4 1 10 7 10"}),n.jsx("polyline",{points:"23 20 23 14 17 14"}),n.jsx("path",{d:"M20.49 9A9 9 0 0 0 7.2 6.51"}),n.jsx("path",{d:"M3.51 15A9 9 0 0 0 16.8 17.49"})]}),broom:n.jsx(n.Fragment,{children:n.jsx("path",{d:"M9.59 4.59A2 2 0 1 1 11 8H2m10.59 11.41A2 2 0 1 0 14 16H2m15.73-8.27A2.5 2.5 0 1 1 19.5 12H2"})}),settings:n.jsxs(n.Fragment,{children:[n.jsx("circle",{cx:"12",cy:"12",r:"3"}),n.jsx("path",{d:"M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 0 1 0 2.83 2 2 0 0 1-2.83 0l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-2 2 2 2 0 0 1-2-2v-.09A1.65 1.65 0 0 0 9 19.4a1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 0 1-2.83 0 2 2 0 0 1 0-2.83l.06-.06a1.65 1.65 0 0 0 .33-1.82 1.65 1.65 0 0 0-1.51-1H3a2 2 0 0 1-2-2 2 2 0 0 1 2-2h.09A1.65 1.65 0 0 0 4.6 9a1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 0 1 0-2.83 2 2 0 0 1 2.83 0l.06.06a1.65 1.65 0 0 0 1.82.33H9a1.65 1.65 0 0 0 1-1.51V3a2 2 0 0 1 2-2 2 2 0 0 1 2 2v.09a1.65 1.65 0 0 0 1 1.51 1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 0 1 2.83 0 2 2 0 0 1 0 2.83l-.06.06a1.65 1.65 0 0 0-.33 1.82V9a1.65 1.65 0 0 0 1.51 1H21a2 2 0 0 1 2 2 2 2 0 0 1-2 2h-.09a1.65 1.65 0 0 0-1.51 1z"})]}),info:n.jsxs(n.Fragment,{children:[n.jsx("circle",{cx:"12",cy:"12",r:"10"}),n.jsx("line",{x1:"12",y1:"16",x2:"12",y2:"12"}),n.jsx("line",{x1:"12",y1:"8",x2:"12.01",y2:"8"})]}),"chevron-down":n.jsx(n.Fragment,{children:n.jsx("polyline",{points:"6 9 12 15 18 9"})}),eye:n.jsxs(n.Fragment,{children:[n.jsx("path",{d:"M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"}),n.jsx("circle",{cx:"12",cy:"12",r:"3"})]}),"eye-off":n.jsxs(n.Fragment,{children:[n.jsx("path",{d:"M17.94 17.94A10.07 10.07 0 0 1 12 20c-7 0-11-8-11-8a18.45 18.45 0 0 1 5.06-5.94M9.9 4.24A9.12 9.12 0 0 1 12 4c7 0 11 8 11 8a18.5 18.5 0 0 1-2.16 3.19m-6.72-1.07a3 3 0 1 1-4.24-4.24"}),n.jsx("line",{x1:"1",y1:"1",x2:"23",y2:"23"})]}),zap:n.jsx(n.Fragment,{children:n.jsx("polygon",{points:"13 2 3 14 12 14 11 22 21 10 12 10 13 2"})}),"help-circle":n.jsxs(n.Fragment,{children:[n.jsx("circle",{cx:"12",cy:"12",r:"10"}),n.jsx("path",{d:"M9.09 9a3 3 0 0 1 5.83 1c0 2-3 3-3 3"}),n.jsx("line",{x1:"12",y1:"17",x2:"12.01",y2:"17"})]}),google:n.jsxs(n.Fragment,{children:[n.jsx("path",{d:"M17.64 9.2c0-.63-.06-1.25-.16-1.84H9v3.48h4.84c-.2 1.12-.84 2.08-1.74 2.71v2.26h2.92c1.7-1.56 2.68-3.88 2.68-6.61z"}),n.jsx("path",{d:"M9 18c2.43 0 4.47-.8 5.96-2.18l-2.92-2.26c-.8.54-1.82.86-3.04.86-2.34 0-4.32-1.58-5.04-3.7H1v2.34C2.64 16.32 5.57 18 9 18z"}),n.jsx("path",{d:"M3.96 10.71c-.18-.54-.28-1.12-.28-1.71s.1-1.17.28-1.71V4.96H1c-.64 1.28-1 2.74-1 4.34s.36 3.06 1 4.34l2.96-2.34z"}),n.jsx("path",{d:"M9 3.6c1.32 0 2.52.45 3.44 1.34l2.6-2.6C13.46.8 11.43 0 9 0 5.57 0 2.64 1.68 1 4.34l2.96 2.34C4.68 4.54 6.66 3.6 9 3.6z"})]}),folder:n.jsx(n.Fragment,{children:n.jsx("path",{d:"M22 19a2 2 0 0 1-2 2H4a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h5l2 3h9a2 2 0 0 1 2 2z"})}),"folder-plus":n.jsxs(n.Fragment,{children:[n.jsx("path",{d:"M22 19a2 2 0 0 1-2 2H4a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h5l2 3h9a2 2 0 0 1 2 2z"}),n.jsx("line",{x1:"12",y1:"11",x2:"12",y2:"17"}),n.jsx("line",{x1:"9",y1:"14",x2:"15",y2:"14"})]}),"folder-edit":n.jsxs(n.Fragment,{children:[n.jsx("path",{d:"M22 19a2 2 0 0 1-2 2H4a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h5l2 3h9a2 2 0 0 1 2 2z"}),n.jsx("path",{d:"M14 13.5l2 2-4 4-2-2 4-4zm-1.5 2.5l2-2"})]}),list:n.jsxs(n.Fragment,{children:[n.jsx("line",{x1:"8",y1:"6",x2:"21",y2:"6"}),n.jsx("line",{x1:"8",y1:"12",x2:"21",y2:"12"}),n.jsx("line",{x1:"8",y1:"18",x2:"21",y2:"18"}),n.jsx("line",{x1:"3",y1:"6",x2:"3.01",y2:"6"}),n.jsx("line",{x1:"3",y1:"12",x2:"3.01",y2:"12"}),n.jsx("line",{x1:"3",y1:"18",x2:"3.01",y2:"18"})]}),lock:n.jsxs(n.Fragment,{children:[n.jsx("rect",{x:"3",y:"11",width:"18",height:"11",rx:"2",ry:"2"}),n.jsx("path",{d:"M7 11V7a5 5 0 0 1 10 0v4"})]}),unlock:n.jsxs(n.Fragment,{children:[n.jsx("rect",{x:"3",y:"11",width:"18",height:"11",rx:"2",ry:"2"}),n.jsx("path",{d:"M7 11V7a5 5 0 0 1 9.9-1"})]}),archive:n.jsxs(n.Fragment,{children:[n.jsx("polyline",{points:"21 8 21 21 3 21 3 8"}),n.jsx("rect",{x:"1",y:"3",width:"22",height:"5"}),n.jsx("line",{x1:"10",y1:"12",x2:"14",y2:"12"})]}),unarchive:n.jsxs(n.Fragment,{children:[n.jsx("polyline",{points:"21 8 21 21 3 21 3 8"}),n.jsx("rect",{x:"1",y:"3",width:"22",height:"5"}),n.jsx("polyline",{points:"10 13 12 11 14 13"}),n.jsx("line",{x1:"12",y1:"11",x2:"12",y2:"17"})]}),"arrow-down":n.jsxs(n.Fragment,{children:[n.jsx("line",{x1:"12",y1:"5",x2:"12",y2:"19"}),n.jsx("polyline",{points:"19 12 12 19 5 12"})]}),monitor:n.jsxs(n.Fragment,{children:[n.jsx("rect",{x:"2",y:"3",width:"20",height:"14",rx:"2",ry:"2"}),n.jsx("line",{x1:"8",y1:"21",x2:"16",y2:"21"}),n.jsx("line",{x1:"12",y1:"17",x2:"12",y2:"21"})]}),"more-vertical":n.jsxs(n.Fragment,{children:[n.jsx("circle",{cx:"12",cy:"12",r:"1"}),n.jsx("circle",{cx:"12",cy:"5",r:"1"}),n.jsx("circle",{cx:"12",cy:"19",r:"1"})]}),search:n.jsxs(n.Fragment,{children:[n.jsx("circle",{cx:"11",cy:"11",r:"8"}),n.jsx("line",{x1:"21",y1:"21",x2:"16.65",y2:"16.65"})]}),filter:n.jsx(n.Fragment,{children:n.jsx("polygon",{points:"22 3 2 3 10 12.46 10 19 14 21 14 12.46 22 3"})}),layers:n.jsxs(n.Fragment,{children:[n.jsx("polygon",{points:"12 2 2 7 12 12 22 7 12 2"}),n.jsx("polyline",{points:"2 17 12 22 22 17"}),n.jsx("polyline",{points:"2 12 12 17 22 12"})]}),terminal:n.jsxs(n.Fragment,{children:[n.jsx("polyline",{points:"4 17 10 11 4 5"}),n.jsx("line",{x1:"12",y1:"19",x2:"20",y2:"19"})]}),"trending-up":n.jsxs(n.Fragment,{children:[n.jsx("polyline",{points:"23 6 13.5 15.5 8.5 10.5 1 18"}),n.jsx("polyline",{points:"17 6 23 6 23 12"})]}),"grip-vertical":n.jsxs(n.Fragment,{children:[n.jsx("circle",{cx:"9",cy:"12",r:"1"}),n.jsx("circle",{cx:"9",cy:"5",r:"1"}),n.jsx("circle",{cx:"9",cy:"19",r:"1"}),n.jsx("circle",{cx:"15",cy:"12",r:"1"}),n.jsx("circle",{cx:"15",cy:"5",r:"1"}),n.jsx("circle",{cx:"15",cy:"19",r:"1"})]}),repeat:n.jsxs(n.Fragment,{children:[n.jsx("polyline",{points:"17 1 21 5 17 9"}),n.jsx("path",{d:"M3 11V9a4 4 0 0 1 4-4h14"}),n.jsx("polyline",{points:"7 23 3 19 7 15"}),n.jsx("path",{d:"M21 13v2a4 4 0 0 1-4 4H3"})]}),bot:n.jsxs(n.Fragment,{children:[n.jsx("rect",{x:"5",y:"10",width:"14",height:"10",rx:"2"}),n.jsx("circle",{cx:"8.5",cy:"15",r:"1"}),n.jsx("circle",{cx:"15.5",cy:"15",r:"1"}),n.jsx("path",{d:"M9 10V4m6 6V4"}),n.jsx("line",{x1:"9",y1:"4",x2:"15",y2:"4"})]}),"book-open":n.jsxs(n.Fragment,{children:[n.jsx("path",{d:"M2 3h6a4 4 0 0 1 4 4v14a3 3 0 0 0-3-3H2z"}),n.jsx("path",{d:"M22 3h-6a4 4 0 0 0-4 4v14a3 3 0 0 1 3-3h7z"})]}),"wifi-off":n.jsxs(n.Fragment,{children:[n.jsx("line",{x1:"1",y1:"1",x2:"23",y2:"23"}),n.jsx("path",{d:"M16.72 11.06A10.94 10.94 0 0 1 19 12.55"}),n.jsx("path",{d:"M5 12.55a10.94 10.94 0 0 1 5.17-2.39"}),n.jsx("path",{d:"M10.71 5.05A16 16 0 0 1 22.58 9"}),n.jsx("path",{d:"M1.42 9a15.91 15.91 0 0 1 4.7-2.88"}),n.jsx("path",{d:"M8.53 16.11a6 6 0 0 1 6.95 0"}),n.jsx("line",{x1:"12",y1:"20",x2:"12.01",y2:"20"})]}),link:n.jsxs(n.Fragment,{children:[n.jsx("path",{d:"M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.72"}),n.jsx("path",{d:"M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.72-1.72"})]}),"file-text":n.jsxs(n.Fragment,{children:[n.jsx("path",{d:"M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"}),n.jsx("polyline",{points:"14 2 14 8 20 8"}),n.jsx("line",{x1:"16",y1:"13",x2:"8",y2:"13"}),n.jsx("line",{x1:"16",y1:"17",x2:"8",y2:"17"}),n.jsx("polyline",{points:"10 9 9 9 8 9"})]})},te=({name:r,className:g="w-6 h-6",...l})=>n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",className:`${g} pointer-events-none`,...l,children:Q0[r]}),$0=()=>{const{isOnline:r}=Od();return r?null:n.jsx("div",{role:"status","aria-live":"assertive",title:"You are currently offline",className:"fixed bottom-6 right-6 z-50 bg-surface rounded-full w-12 h-12 shadow-lg flex items-center justify-center border-2 border-border animate-fade-in",children:n.jsx(te,{name:"wifi-off",className:"w-6 h-6 text-text-muted"})})},ce=({children:r,variant:g="primary",size:l="md",className:u="",...f})=>{const i="inline-flex items-center justify-center rounded-md font-medium transition-colors focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-offset-background disabled:opacity-50 disabled:pointer-events-none",o={primary:"bg-primary text-on-primary hover:bg-primary-hover focus:ring-primary",secondary:"bg-surface text-text border border-border hover:bg-border/20 focus:ring-primary",danger:"bg-red-600 text-white hover:bg-red-700 focus:ring-red-500",ghost:"text-text-muted hover:bg-border/50 hover:text-text focus:ring-primary"},m={sm:"px-2 py-1 text-xs",md:"px-4 py-2 text-sm",lg:"px-6 py-3 text-base"};return n.jsx("button",{className:`${i} ${o[g]} ${m[l]} ${u}`,...f,children:r})},P0='a[href], button:not([disabled]), textarea, input, select, [tabindex]:not([tabindex="-1"])',Yt=(r,g)=>{const l=U.useRef([]);U.useEffect(()=>{if(g&&r.current){l.current=Array.from(r.current.querySelectorAll(P0));const u=l.current[0];u&&setTimeout(()=>u.focus(),100);const f=i=>{var x;if(i.key!=="Tab"||!((x=r.current)!=null&&x.contains(document.activeElement)))return;const o=l.current[0],m=l.current[l.current.length-1];i.shiftKey?document.activeElement===o&&(i.preventDefault(),m==null||m.focus()):document.activeElement===m&&(i.preventDefault(),o==null||o.focus())};return document.addEventListener("keydown",f),()=>{document.removeEventListener("keydown",f)}}},[g,r])},Zg=U.createContext(void 0),hp=()=>window.location.hash.startsWith("#/")?window.location.hash.substring(1):"/",J0=({children:r})=>{const[g,l]=U.useState(hp()),u=U.useCallback(()=>{l(hp())},[]);U.useEffect(()=>(window.addEventListener("hashchange",u),()=>{window.removeEventListener("hashchange",u)}),[u]);const f=U.useCallback((o,m)=>{const x=`#${o}`;if(m!=null&&m.replace){const d=new URL(window.location.href);d.hash=x,window.location.replace(d.toString())}else window.location.hash=x},[]),i={path:g,navigate:f};return n.jsx(Zg.Provider,{value:i,children:r})},ra=()=>{const r=U.useContext(Zg);if(r===void 0)throw new Error("useRouter must be used within a RouterProvider");return r},Gt=({href:r,children:g,passAs:l,...u})=>{const{navigate:f}=ra(),i=m=>{m.currentTarget.tagName==="A"&&(m.metaKey||m.ctrlKey)||(m.preventDefault(),u.onClick&&u.onClick(m),f(r))},o=`#${r}`;return l?n.jsx(l,{...u,onClick:i,children:g}):n.jsx("a",{...u,href:o,onClick:i,children:g})},Xg=U.createContext(void 0),Ro=(r,g)=>{if(typeof window>"u")return g;try{const l=window.localStorage.getItem(r);return l?JSON.parse(l)===!0:g}catch(l){return console.error(`Error reading ${r} from localStorage`,l),g}},V0=()=>{if(typeof window>"u")return!1;try{const r=window.localStorage.getItem("cogniflow-aiFeaturesEnabled");return r!==null?JSON.parse(r)===!0:!!(window.location.origin.endsWith("aistudio.google.com")||window.location.origin.endsWith("scf.usercontent.goog"))}catch(r){return console.error("Error reading cogniflow-aiFeaturesEnabled from localStorage",r),!1}},K0=({children:r})=>{const[g,l]=U.useState(()=>Ro("cogniflow-disableAnimations",!1)),[u,f]=U.useState(()=>Ro("cogniflow-hapticsEnabled",!0)),[i,o]=U.useState(V0),[m,x]=U.useState(()=>Ro("cogniflow-backupEnabled",!0)),[d,j]=U.useState(()=>{try{return window.localStorage.getItem("cogniflow-backupApiKey")||"qRt+gU/57GHKhxTZeRnRi+dfT274iSkKKq2UnTr9Bxs="}catch{return"qRt+gU/57GHKhxTZeRnRi+dfT274iSkKKq2UnTr9Bxs="}}),[y,_]=U.useState(()=>Ro("cogniflow-syncOnCellular",!0)),b=U.useCallback(M=>{l(M);try{window.localStorage.setItem("cogniflow-disableAnimations",JSON.stringify(M))}catch(R){console.error("Error writing animation setting to localStorage",R)}},[]),D=U.useCallback(M=>{f(M);try{window.localStorage.setItem("cogniflow-hapticsEnabled",JSON.stringify(M))}catch(R){console.error("Error writing haptics setting to localStorage",R)}},[]),w=U.useCallback(M=>{o(M);try{window.localStorage.setItem("cogniflow-aiFeaturesEnabled",JSON.stringify(M))}catch(R){console.error("Error writing AI features setting to localStorage",R)}},[]),N=U.useCallback(M=>{x(M);try{window.localStorage.setItem("cogniflow-backupEnabled",JSON.stringify(M))}catch(R){console.error("Error writing backup enabled setting to localStorage",R)}},[]),S=U.useCallback(M=>{j(M);try{window.localStorage.setItem("cogniflow-backupApiKey",M)}catch(R){console.error("Error writing backup API key to localStorage",R)}},[]),O=U.useCallback(M=>{_(M);try{window.localStorage.setItem("cogniflow-syncOnCellular",JSON.stringify(M))}catch(R){console.error("Error writing syncOnCellular setting to localStorage",R)}},[]),C={disableAnimations:g,setDisableAnimations:b,hapticsEnabled:u,setHapticsEnabled:D,aiFeaturesEnabled:i,setAiFeaturesEnabled:w,backupEnabled:m,setBackupEnabled:N,backupApiKey:d,setBackupApiKey:S,syncOnCellular:y,setSyncOnCellular:O};return n.jsx(Xg.Provider,{value:C,children:r})},sa=()=>{const r=U.useContext(Xg);if(r===void 0)throw new Error("useSettings must be used within a SettingsProvider");return r},Z0=({isOpen:r,onClose:g,onImport:l,onCreateSeries:u,onGenerateAI:f,onInstall:i})=>{const o=U.useRef(null),{aiFeaturesEnabled:m}=sa();return Yt(o,r),U.useEffect(()=>{const x=d=>{d.key==="Escape"&&g()};return r&&document.addEventListener("keydown",x),()=>{document.removeEventListener("keydown",x)}},[r,g]),n.jsxs(n.Fragment,{children:[n.jsx("div",{className:`fixed inset-0 bg-black bg-opacity-60 z-50 transition-opacity duration-300 ${r?"opacity-100":"opacity-0 pointer-events-none"}`,onClick:g,"aria-hidden":"true"}),n.jsx("div",{ref:o,className:`fixed top-0 right-0 h-full w-full max-w-xs z-[51] transform transition-transform duration-300 ease-in-out ${r?"translate-x-0":"translate-x-full"}`,role:"dialog","aria-modal":"true","aria-labelledby":"sidebar-title",children:n.jsxs("div",{className:"bg-surface shadow-xl h-full flex flex-col",children:[n.jsxs("div",{className:"flex items-center justify-between p-4 border-b border-border",children:[n.jsx("h2",{id:"sidebar-title",className:"text-xl font-bold text-transparent bg-clip-text bg-gradient-to-r from-blue-400 to-teal-300",children:"Menu"}),n.jsx(ce,{variant:"ghost",onClick:g,className:"p-1 h-auto","aria-label":"Close menu",children:n.jsx(te,{name:"x"})})]}),n.jsxs("nav",{className:"flex-grow p-4 space-y-2",children:[n.jsxs(Gt,{href:"/",onClick:g,className:"flex items-center px-3 py-2 text-text rounded-md hover:bg-border/30 text-lg",children:[n.jsx(te,{name:"laptop",className:"w-6 h-6 mr-3"})," Home"]}),n.jsxs(Gt,{href:"/series",onClick:g,className:"flex items-center px-3 py-2 text-text rounded-md hover:bg-border/30 text-lg",children:[n.jsx(te,{name:"layers",className:"w-6 h-6 mr-3"})," Series"]}),n.jsxs(Gt,{href:"/decks",onClick:g,className:"flex items-center px-3 py-2 text-text rounded-md hover:bg-border/30 text-lg",children:[n.jsx(te,{name:"folder",className:"w-6 h-6 mr-3"})," Decks"]}),n.jsxs(Gt,{href:"/progress",onClick:g,className:"flex items-center px-3 py-2 text-text rounded-md hover:bg-border/30 text-lg",children:[n.jsx(te,{name:"trending-up",className:"w-6 h-6 mr-3"}),"Progress"]}),n.jsxs(Gt,{href:"/archive",onClick:g,className:"flex items-center px-3 py-2 text-text rounded-md hover:bg-border/30 text-lg",children:[n.jsx(te,{name:"archive",className:"w-6 h-6 mr-3"}),"Archive"]}),n.jsxs(Gt,{href:"/trash",onClick:g,className:"flex items-center px-3 py-2 text-text rounded-md hover:bg-border/30 text-lg",children:[n.jsx(te,{name:"trash-2",className:"w-6 h-6 mr-3"}),"Trash"]}),n.jsxs(Gt,{href:"/settings",onClick:g,className:"flex items-center px-3 py-2 text-text rounded-md hover:bg-border/30 text-lg",children:[n.jsx(te,{name:"settings",className:"w-6 h-6 mr-3"}),"Settings"]}),n.jsxs(Gt,{href:"/instructions/json",onClick:g,className:"flex items-center px-3 py-2 text-text rounded-md hover:bg-border/30 text-lg",children:[n.jsx(te,{name:"help-circle",className:"w-6 h-6 mr-3"}),"JSON Guide"]})]}),n.jsxs("div",{className:"p-4 border-t border-border space-y-2",children:[m&&n.jsxs(ce,{variant:"primary",onClick:f,className:"w-full",children:[n.jsx(te,{name:"zap",className:"w-5 h-5 mr-2"}),"Generate with AI"]}),n.jsxs(ce,{variant:"secondary",onClick:u,className:"w-full",children:[n.jsx(te,{name:"layers",className:"w-5 h-5 mr-2"}),"Create New Series"]}),n.jsxs(ce,{variant:"secondary",onClick:l,className:"w-full",children:[n.jsx(te,{name:"plus",className:"w-5 h-5 mr-2"}),"Create / Import Deck"]}),i&&n.jsxs(ce,{variant:"secondary",onClick:i,className:"w-full",children:[n.jsx(te,{name:"download",className:"w-5 h-5 mr-2"}),"Install App"]})]})]})})]})},X0={success:n.jsx(te,{name:"check-circle",className:"w-6 h-6 text-green-500"}),error:n.jsx(te,{name:"x-circle",className:"w-6 h-6 text-red-500"}),info:n.jsx(te,{name:"info",className:"w-6 h-6 text-blue-500"})},W0=({message:r,onDismiss:g})=>(U.useEffect(()=>{const l=setTimeout(()=>{g(r.id)},5e3);return()=>{clearTimeout(l)}},[r.id,g]),n.jsx("div",{className:"bg-surface shadow-lg rounded-lg pointer-events-auto ring-1 ring-black ring-opacity-5 overflow-hidden animate-fade-in-right",children:n.jsx("div",{className:"p-4",children:n.jsxs("div",{className:"flex items-start",children:[n.jsx("div",{className:"flex-shrink-0",children:X0[r.type]}),n.jsx("div",{className:"ml-3 w-0 flex-1 pt-0.5",children:n.jsx("p",{className:"text-sm font-medium text-text break-words",children:r.message})}),n.jsx("div",{className:"ml-4 flex-shrink-0 flex",children:n.jsxs("button",{onClick:()=>g(r.id),className:"bg-surface rounded-md inline-flex text-text-muted hover:text-text focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-offset-surface focus:ring-primary",children:[n.jsx("span",{className:"sr-only",children:"Close"}),n.jsx(te,{name:"x",className:"h-5 w-5"})]})})]})})})),Wg=U.createContext(void 0),eb=({children:r})=>{const[g,l]=U.useState([]),u=U.useCallback((i,o)=>{const m=crypto.randomUUID();l(x=>[...x,{id:m,message:i,type:o}])},[]),f=U.useCallback(i=>{l(o=>o.filter(m=>m.id!==i))},[]);return n.jsxs(Wg.Provider,{value:{addToast:u},children:[r,n.jsx("div",{className:"fixed top-5 right-5 z-[100] w-full max-w-xs space-y-3",children:g.map(i=>n.jsx(W0,{message:i,onDismiss:f},i.id))})]})},Mt=()=>{const r=U.useContext(Wg);if(r===void 0)throw new Error("useToast must be used within a ToastProvider");return r},tn=({size:r="md"})=>{const g={sm:"h-6 w-6",md:"h-10 w-10",lg:"h-16 w-16"};return n.jsx("div",{className:"flex justify-center items-center",role:"status","aria-label":"Loading",children:n.jsxs("svg",{className:`animate-spin text-blue-500 dark:text-blue-400 ${g[r]}`,xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",children:[n.jsx("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),n.jsx("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]})})},ex=U.createContext(void 0),li=()=>{const r=U.useContext(ex);if(!r)throw new Error("useModal must be used within a ModalProvider");return r},tb=({children:r})=>{const[g,l]=U.useState({type:null,payload:null}),u=U.useRef(null),f=U.useCallback((o,m={})=>{u.current=document.activeElement,l({type:o,payload:m})},[]),i=U.useCallback(()=>{l({type:null,payload:null}),setTimeout(()=>{var o;return(o=u.current)==null?void 0:o.focus()},100)},[]);return n.jsx(ex.Provider,{value:{modalType:g.type,modalPayload:g.payload,openModal:f,closeModal:i},children:r})},nb=({pullDistance:r,isRefreshing:g,threshold:l})=>{if(g)return n.jsx("div",{className:"fixed top-0 left-0 right-0 h-20 flex items-center justify-center z-50 transition-all duration-300",children:n.jsx(tn,{size:"md"})});if(r<=0)return null;const u=Math.min(r/l,1),f=u>=1,i=20,o=2*Math.PI*i,m=o-u*o;return n.jsx("div",{className:"fixed top-0 left-0 right-0 h-20 flex items-center justify-center z-10 pointer-events-none",style:{transform:`translateY(${Math.min(r,l*1.5)-80}px)`,opacity:Math.min(r/(l/2),1)},children:n.jsxs("div",{className:"relative w-12 h-12 flex items-center justify-center bg-white dark:bg-gray-800 rounded-full shadow-lg",children:[n.jsxs("svg",{className:"absolute w-full h-full transform -rotate-90",viewBox:"0 0 44 44",children:[n.jsx("circle",{className:"text-gray-300/50 dark:text-gray-600/50",stroke:"currentColor",strokeWidth:"4",fill:"transparent",r:i,cx:"22",cy:"22"}),n.jsx("circle",{className:"text-blue-500",stroke:"currentColor",strokeWidth:"4",strokeLinecap:"round",fill:"transparent",r:i,cx:"22",cy:"22",style:{strokeDasharray:o,strokeDashoffset:m,transition:f?"stroke-dashoffset 0.1s linear":"none"}})]}),n.jsx(te,{name:f?"refresh-ccw":"arrow-down",className:`w-6 h-6 transition-colors duration-200 ${f?"text-blue-500":"text-gray-500 dark:text-gray-400"}`})]})})};function Mo(r){throw new Error('Could not dynamically require "'+r+'". Please configure the dynamicRequireTargets or/and ignoreDynamicRequires option of @rollup/plugin-commonjs appropriately for this require call to work.')}var fd={exports:{}};/*!

JSZip v3.10.1 - A JavaScript class for generating and reading zip files
<http://stuartk.com/jszip>

(c) 2009-2016 Stuart Knightley <stuart [at] stuartk.com>
Dual licenced under the MIT license or GPLv3. See https://raw.github.com/Stuk/jszip/main/LICENSE.markdown.

JSZip uses the library pako released under the MIT license :
https://github.com/nodeca/pako/blob/main/LICENSE
*/var mp;function ab(){return mp||(mp=1,function(r,g){(function(l){r.exports=l()})(function(){return function l(u,f,i){function o(d,j){if(!f[d]){if(!u[d]){var y=typeof Mo=="function"&&Mo;if(!j&&y)return y(d,!0);if(m)return m(d,!0);var _=new Error("Cannot find module '"+d+"'");throw _.code="MODULE_NOT_FOUND",_}var b=f[d]={exports:{}};u[d][0].call(b.exports,function(D){var w=u[d][1][D];return o(w||D)},b,b.exports,l,u,f,i)}return f[d].exports}for(var m=typeof Mo=="function"&&Mo,x=0;x<i.length;x++)o(i[x]);return o}({1:[function(l,u,f){var i=l("./utils"),o=l("./support"),m="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";f.encode=function(x){for(var d,j,y,_,b,D,w,N=[],S=0,O=x.length,C=O,M=i.getTypeOf(x)!=="string";S<x.length;)C=O-S,y=M?(d=x[S++],j=S<O?x[S++]:0,S<O?x[S++]:0):(d=x.charCodeAt(S++),j=S<O?x.charCodeAt(S++):0,S<O?x.charCodeAt(S++):0),_=d>>2,b=(3&d)<<4|j>>4,D=1<C?(15&j)<<2|y>>6:64,w=2<C?63&y:64,N.push(m.charAt(_)+m.charAt(b)+m.charAt(D)+m.charAt(w));return N.join("")},f.decode=function(x){var d,j,y,_,b,D,w=0,N=0,S="data:";if(x.substr(0,S.length)===S)throw new Error("Invalid base64 input, it looks like a data url.");var O,C=3*(x=x.replace(/[^A-Za-z0-9+/=]/g,"")).length/4;if(x.charAt(x.length-1)===m.charAt(64)&&C--,x.charAt(x.length-2)===m.charAt(64)&&C--,C%1!=0)throw new Error("Invalid base64 input, bad content length.");for(O=o.uint8array?new Uint8Array(0|C):new Array(0|C);w<x.length;)d=m.indexOf(x.charAt(w++))<<2|(_=m.indexOf(x.charAt(w++)))>>4,j=(15&_)<<4|(b=m.indexOf(x.charAt(w++)))>>2,y=(3&b)<<6|(D=m.indexOf(x.charAt(w++))),O[N++]=d,b!==64&&(O[N++]=j),D!==64&&(O[N++]=y);return O}},{"./support":30,"./utils":32}],2:[function(l,u,f){var i=l("./external"),o=l("./stream/DataWorker"),m=l("./stream/Crc32Probe"),x=l("./stream/DataLengthProbe");function d(j,y,_,b,D){this.compressedSize=j,this.uncompressedSize=y,this.crc32=_,this.compression=b,this.compressedContent=D}d.prototype={getContentWorker:function(){var j=new o(i.Promise.resolve(this.compressedContent)).pipe(this.compression.uncompressWorker()).pipe(new x("data_length")),y=this;return j.on("end",function(){if(this.streamInfo.data_length!==y.uncompressedSize)throw new Error("Bug : uncompressed data size mismatch")}),j},getCompressedWorker:function(){return new o(i.Promise.resolve(this.compressedContent)).withStreamInfo("compressedSize",this.compressedSize).withStreamInfo("uncompressedSize",this.uncompressedSize).withStreamInfo("crc32",this.crc32).withStreamInfo("compression",this.compression)}},d.createWorkerFrom=function(j,y,_){return j.pipe(new m).pipe(new x("uncompressedSize")).pipe(y.compressWorker(_)).pipe(new x("compressedSize")).withStreamInfo("compression",y)},u.exports=d},{"./external":6,"./stream/Crc32Probe":25,"./stream/DataLengthProbe":26,"./stream/DataWorker":27}],3:[function(l,u,f){var i=l("./stream/GenericWorker");f.STORE={magic:"\0\0",compressWorker:function(){return new i("STORE compression")},uncompressWorker:function(){return new i("STORE decompression")}},f.DEFLATE=l("./flate")},{"./flate":7,"./stream/GenericWorker":28}],4:[function(l,u,f){var i=l("./utils"),o=function(){for(var m,x=[],d=0;d<256;d++){m=d;for(var j=0;j<8;j++)m=1&m?3988292384^m>>>1:m>>>1;x[d]=m}return x}();u.exports=function(m,x){return m!==void 0&&m.length?i.getTypeOf(m)!=="string"?function(d,j,y,_){var b=o,D=_+y;d^=-1;for(var w=_;w<D;w++)d=d>>>8^b[255&(d^j[w])];return-1^d}(0|x,m,m.length,0):function(d,j,y,_){var b=o,D=_+y;d^=-1;for(var w=_;w<D;w++)d=d>>>8^b[255&(d^j.charCodeAt(w))];return-1^d}(0|x,m,m.length,0):0}},{"./utils":32}],5:[function(l,u,f){f.base64=!1,f.binary=!1,f.dir=!1,f.createFolders=!0,f.date=null,f.compression=null,f.compressionOptions=null,f.comment=null,f.unixPermissions=null,f.dosPermissions=null},{}],6:[function(l,u,f){var i=null;i=typeof Promise<"u"?Promise:l("lie"),u.exports={Promise:i}},{lie:37}],7:[function(l,u,f){var i=typeof Uint8Array<"u"&&typeof Uint16Array<"u"&&typeof Uint32Array<"u",o=l("pako"),m=l("./utils"),x=l("./stream/GenericWorker"),d=i?"uint8array":"array";function j(y,_){x.call(this,"FlateWorker/"+y),this._pako=null,this._pakoAction=y,this._pakoOptions=_,this.meta={}}f.magic="\b\0",m.inherits(j,x),j.prototype.processChunk=function(y){this.meta=y.meta,this._pako===null&&this._createPako(),this._pako.push(m.transformTo(d,y.data),!1)},j.prototype.flush=function(){x.prototype.flush.call(this),this._pako===null&&this._createPako(),this._pako.push([],!0)},j.prototype.cleanUp=function(){x.prototype.cleanUp.call(this),this._pako=null},j.prototype._createPako=function(){this._pako=new o[this._pakoAction]({raw:!0,level:this._pakoOptions.level||-1});var y=this;this._pako.onData=function(_){y.push({data:_,meta:y.meta})}},f.compressWorker=function(y){return new j("Deflate",y)},f.uncompressWorker=function(){return new j("Inflate",{})}},{"./stream/GenericWorker":28,"./utils":32,pako:38}],8:[function(l,u,f){function i(b,D){var w,N="";for(w=0;w<D;w++)N+=String.fromCharCode(255&b),b>>>=8;return N}function o(b,D,w,N,S,O){var C,M,R=b.file,$=b.compression,X=O!==d.utf8encode,J=m.transformTo("string",O(R.name)),Y=m.transformTo("string",d.utf8encode(R.name)),H=R.comment,K=m.transformTo("string",O(H)),q=m.transformTo("string",d.utf8encode(H)),W=Y.length!==R.name.length,A=q.length!==H.length,B="",z="",Q="",ue=R.dir,ee=R.date,V={crc32:0,compressedSize:0,uncompressedSize:0};D&&!w||(V.crc32=b.crc32,V.compressedSize=b.compressedSize,V.uncompressedSize=b.uncompressedSize);var E=0;D&&(E|=8),X||!W&&!A||(E|=2048);var L=0,se=0;ue&&(L|=16),S==="UNIX"?(se=798,L|=function(oe,Ne){var we=oe;return oe||(we=Ne?16893:33204),(65535&we)<<16}(R.unixPermissions,ue)):(se=20,L|=function(oe){return 63&(oe||0)}(R.dosPermissions)),C=ee.getUTCHours(),C<<=6,C|=ee.getUTCMinutes(),C<<=5,C|=ee.getUTCSeconds()/2,M=ee.getUTCFullYear()-1980,M<<=4,M|=ee.getUTCMonth()+1,M<<=5,M|=ee.getUTCDate(),W&&(z=i(1,1)+i(j(J),4)+Y,B+="up"+i(z.length,2)+z),A&&(Q=i(1,1)+i(j(K),4)+q,B+="uc"+i(Q.length,2)+Q);var ie="";return ie+=`
\0`,ie+=i(E,2),ie+=$.magic,ie+=i(C,2),ie+=i(M,2),ie+=i(V.crc32,4),ie+=i(V.compressedSize,4),ie+=i(V.uncompressedSize,4),ie+=i(J.length,2),ie+=i(B.length,2),{fileRecord:y.LOCAL_FILE_HEADER+ie+J+B,dirRecord:y.CENTRAL_FILE_HEADER+i(se,2)+ie+i(K.length,2)+"\0\0\0\0"+i(L,4)+i(N,4)+J+B+K}}var m=l("../utils"),x=l("../stream/GenericWorker"),d=l("../utf8"),j=l("../crc32"),y=l("../signature");function _(b,D,w,N){x.call(this,"ZipFileWorker"),this.bytesWritten=0,this.zipComment=D,this.zipPlatform=w,this.encodeFileName=N,this.streamFiles=b,this.accumulate=!1,this.contentBuffer=[],this.dirRecords=[],this.currentSourceOffset=0,this.entriesCount=0,this.currentFile=null,this._sources=[]}m.inherits(_,x),_.prototype.push=function(b){var D=b.meta.percent||0,w=this.entriesCount,N=this._sources.length;this.accumulate?this.contentBuffer.push(b):(this.bytesWritten+=b.data.length,x.prototype.push.call(this,{data:b.data,meta:{currentFile:this.currentFile,percent:w?(D+100*(w-N-1))/w:100}}))},_.prototype.openedSource=function(b){this.currentSourceOffset=this.bytesWritten,this.currentFile=b.file.name;var D=this.streamFiles&&!b.file.dir;if(D){var w=o(b,D,!1,this.currentSourceOffset,this.zipPlatform,this.encodeFileName);this.push({data:w.fileRecord,meta:{percent:0}})}else this.accumulate=!0},_.prototype.closedSource=function(b){this.accumulate=!1;var D=this.streamFiles&&!b.file.dir,w=o(b,D,!0,this.currentSourceOffset,this.zipPlatform,this.encodeFileName);if(this.dirRecords.push(w.dirRecord),D)this.push({data:function(N){return y.DATA_DESCRIPTOR+i(N.crc32,4)+i(N.compressedSize,4)+i(N.uncompressedSize,4)}(b),meta:{percent:100}});else for(this.push({data:w.fileRecord,meta:{percent:0}});this.contentBuffer.length;)this.push(this.contentBuffer.shift());this.currentFile=null},_.prototype.flush=function(){for(var b=this.bytesWritten,D=0;D<this.dirRecords.length;D++)this.push({data:this.dirRecords[D],meta:{percent:100}});var w=this.bytesWritten-b,N=function(S,O,C,M,R){var $=m.transformTo("string",R(M));return y.CENTRAL_DIRECTORY_END+"\0\0\0\0"+i(S,2)+i(S,2)+i(O,4)+i(C,4)+i($.length,2)+$}(this.dirRecords.length,w,b,this.zipComment,this.encodeFileName);this.push({data:N,meta:{percent:100}})},_.prototype.prepareNextSource=function(){this.previous=this._sources.shift(),this.openedSource(this.previous.streamInfo),this.isPaused?this.previous.pause():this.previous.resume()},_.prototype.registerPrevious=function(b){this._sources.push(b);var D=this;return b.on("data",function(w){D.processChunk(w)}),b.on("end",function(){D.closedSource(D.previous.streamInfo),D._sources.length?D.prepareNextSource():D.end()}),b.on("error",function(w){D.error(w)}),this},_.prototype.resume=function(){return!!x.prototype.resume.call(this)&&(!this.previous&&this._sources.length?(this.prepareNextSource(),!0):this.previous||this._sources.length||this.generatedError?void 0:(this.end(),!0))},_.prototype.error=function(b){var D=this._sources;if(!x.prototype.error.call(this,b))return!1;for(var w=0;w<D.length;w++)try{D[w].error(b)}catch{}return!0},_.prototype.lock=function(){x.prototype.lock.call(this);for(var b=this._sources,D=0;D<b.length;D++)b[D].lock()},u.exports=_},{"../crc32":4,"../signature":23,"../stream/GenericWorker":28,"../utf8":31,"../utils":32}],9:[function(l,u,f){var i=l("../compressions"),o=l("./ZipFileWorker");f.generateWorker=function(m,x,d){var j=new o(x.streamFiles,d,x.platform,x.encodeFileName),y=0;try{m.forEach(function(_,b){y++;var D=function(O,C){var M=O||C,R=i[M];if(!R)throw new Error(M+" is not a valid compression method !");return R}(b.options.compression,x.compression),w=b.options.compressionOptions||x.compressionOptions||{},N=b.dir,S=b.date;b._compressWorker(D,w).withStreamInfo("file",{name:_,dir:N,date:S,comment:b.comment||"",unixPermissions:b.unixPermissions,dosPermissions:b.dosPermissions}).pipe(j)}),j.entriesCount=y}catch(_){j.error(_)}return j}},{"../compressions":3,"./ZipFileWorker":8}],10:[function(l,u,f){function i(){if(!(this instanceof i))return new i;if(arguments.length)throw new Error("The constructor with parameters has been removed in JSZip 3.0, please check the upgrade guide.");this.files=Object.create(null),this.comment=null,this.root="",this.clone=function(){var o=new i;for(var m in this)typeof this[m]!="function"&&(o[m]=this[m]);return o}}(i.prototype=l("./object")).loadAsync=l("./load"),i.support=l("./support"),i.defaults=l("./defaults"),i.version="3.10.1",i.loadAsync=function(o,m){return new i().loadAsync(o,m)},i.external=l("./external"),u.exports=i},{"./defaults":5,"./external":6,"./load":11,"./object":15,"./support":30}],11:[function(l,u,f){var i=l("./utils"),o=l("./external"),m=l("./utf8"),x=l("./zipEntries"),d=l("./stream/Crc32Probe"),j=l("./nodejsUtils");function y(_){return new o.Promise(function(b,D){var w=_.decompressed.getContentWorker().pipe(new d);w.on("error",function(N){D(N)}).on("end",function(){w.streamInfo.crc32!==_.decompressed.crc32?D(new Error("Corrupted zip : CRC32 mismatch")):b()}).resume()})}u.exports=function(_,b){var D=this;return b=i.extend(b||{},{base64:!1,checkCRC32:!1,optimizedBinaryString:!1,createFolders:!1,decodeFileName:m.utf8decode}),j.isNode&&j.isStream(_)?o.Promise.reject(new Error("JSZip can't accept a stream when loading a zip file.")):i.prepareContent("the loaded zip file",_,!0,b.optimizedBinaryString,b.base64).then(function(w){var N=new x(b);return N.load(w),N}).then(function(w){var N=[o.Promise.resolve(w)],S=w.files;if(b.checkCRC32)for(var O=0;O<S.length;O++)N.push(y(S[O]));return o.Promise.all(N)}).then(function(w){for(var N=w.shift(),S=N.files,O=0;O<S.length;O++){var C=S[O],M=C.fileNameStr,R=i.resolve(C.fileNameStr);D.file(R,C.decompressed,{binary:!0,optimizedBinaryString:!0,date:C.date,dir:C.dir,comment:C.fileCommentStr.length?C.fileCommentStr:null,unixPermissions:C.unixPermissions,dosPermissions:C.dosPermissions,createFolders:b.createFolders}),C.dir||(D.file(R).unsafeOriginalName=M)}return N.zipComment.length&&(D.comment=N.zipComment),D})}},{"./external":6,"./nodejsUtils":14,"./stream/Crc32Probe":25,"./utf8":31,"./utils":32,"./zipEntries":33}],12:[function(l,u,f){var i=l("../utils"),o=l("../stream/GenericWorker");function m(x,d){o.call(this,"Nodejs stream input adapter for "+x),this._upstreamEnded=!1,this._bindStream(d)}i.inherits(m,o),m.prototype._bindStream=function(x){var d=this;(this._stream=x).pause(),x.on("data",function(j){d.push({data:j,meta:{percent:0}})}).on("error",function(j){d.isPaused?this.generatedError=j:d.error(j)}).on("end",function(){d.isPaused?d._upstreamEnded=!0:d.end()})},m.prototype.pause=function(){return!!o.prototype.pause.call(this)&&(this._stream.pause(),!0)},m.prototype.resume=function(){return!!o.prototype.resume.call(this)&&(this._upstreamEnded?this.end():this._stream.resume(),!0)},u.exports=m},{"../stream/GenericWorker":28,"../utils":32}],13:[function(l,u,f){var i=l("readable-stream").Readable;function o(m,x,d){i.call(this,x),this._helper=m;var j=this;m.on("data",function(y,_){j.push(y)||j._helper.pause(),d&&d(_)}).on("error",function(y){j.emit("error",y)}).on("end",function(){j.push(null)})}l("../utils").inherits(o,i),o.prototype._read=function(){this._helper.resume()},u.exports=o},{"../utils":32,"readable-stream":16}],14:[function(l,u,f){u.exports={isNode:typeof Buffer<"u",newBufferFrom:function(i,o){if(Buffer.from&&Buffer.from!==Uint8Array.from)return Buffer.from(i,o);if(typeof i=="number")throw new Error('The "data" argument must not be a number');return new Buffer(i,o)},allocBuffer:function(i){if(Buffer.alloc)return Buffer.alloc(i);var o=new Buffer(i);return o.fill(0),o},isBuffer:function(i){return Buffer.isBuffer(i)},isStream:function(i){return i&&typeof i.on=="function"&&typeof i.pause=="function"&&typeof i.resume=="function"}}},{}],15:[function(l,u,f){function i(R,$,X){var J,Y=m.getTypeOf($),H=m.extend(X||{},j);H.date=H.date||new Date,H.compression!==null&&(H.compression=H.compression.toUpperCase()),typeof H.unixPermissions=="string"&&(H.unixPermissions=parseInt(H.unixPermissions,8)),H.unixPermissions&&16384&H.unixPermissions&&(H.dir=!0),H.dosPermissions&&16&H.dosPermissions&&(H.dir=!0),H.dir&&(R=S(R)),H.createFolders&&(J=N(R))&&O.call(this,J,!0);var K=Y==="string"&&H.binary===!1&&H.base64===!1;X&&X.binary!==void 0||(H.binary=!K),($ instanceof y&&$.uncompressedSize===0||H.dir||!$||$.length===0)&&(H.base64=!1,H.binary=!0,$="",H.compression="STORE",Y="string");var q=null;q=$ instanceof y||$ instanceof x?$:D.isNode&&D.isStream($)?new w(R,$):m.prepareContent(R,$,H.binary,H.optimizedBinaryString,H.base64);var W=new _(R,q,H);this.files[R]=W}var o=l("./utf8"),m=l("./utils"),x=l("./stream/GenericWorker"),d=l("./stream/StreamHelper"),j=l("./defaults"),y=l("./compressedObject"),_=l("./zipObject"),b=l("./generate"),D=l("./nodejsUtils"),w=l("./nodejs/NodejsStreamInputAdapter"),N=function(R){R.slice(-1)==="/"&&(R=R.substring(0,R.length-1));var $=R.lastIndexOf("/");return 0<$?R.substring(0,$):""},S=function(R){return R.slice(-1)!=="/"&&(R+="/"),R},O=function(R,$){return $=$!==void 0?$:j.createFolders,R=S(R),this.files[R]||i.call(this,R,null,{dir:!0,createFolders:$}),this.files[R]};function C(R){return Object.prototype.toString.call(R)==="[object RegExp]"}var M={load:function(){throw new Error("This method has been removed in JSZip 3.0, please check the upgrade guide.")},forEach:function(R){var $,X,J;for($ in this.files)J=this.files[$],(X=$.slice(this.root.length,$.length))&&$.slice(0,this.root.length)===this.root&&R(X,J)},filter:function(R){var $=[];return this.forEach(function(X,J){R(X,J)&&$.push(J)}),$},file:function(R,$,X){if(arguments.length!==1)return R=this.root+R,i.call(this,R,$,X),this;if(C(R)){var J=R;return this.filter(function(H,K){return!K.dir&&J.test(H)})}var Y=this.files[this.root+R];return Y&&!Y.dir?Y:null},folder:function(R){if(!R)return this;if(C(R))return this.filter(function(Y,H){return H.dir&&R.test(Y)});var $=this.root+R,X=O.call(this,$),J=this.clone();return J.root=X.name,J},remove:function(R){R=this.root+R;var $=this.files[R];if($||(R.slice(-1)!=="/"&&(R+="/"),$=this.files[R]),$&&!$.dir)delete this.files[R];else for(var X=this.filter(function(Y,H){return H.name.slice(0,R.length)===R}),J=0;J<X.length;J++)delete this.files[X[J].name];return this},generate:function(){throw new Error("This method has been removed in JSZip 3.0, please check the upgrade guide.")},generateInternalStream:function(R){var $,X={};try{if((X=m.extend(R||{},{streamFiles:!1,compression:"STORE",compressionOptions:null,type:"",platform:"DOS",comment:null,mimeType:"application/zip",encodeFileName:o.utf8encode})).type=X.type.toLowerCase(),X.compression=X.compression.toUpperCase(),X.type==="binarystring"&&(X.type="string"),!X.type)throw new Error("No output type specified.");m.checkSupport(X.type),X.platform!=="darwin"&&X.platform!=="freebsd"&&X.platform!=="linux"&&X.platform!=="sunos"||(X.platform="UNIX"),X.platform==="win32"&&(X.platform="DOS");var J=X.comment||this.comment||"";$=b.generateWorker(this,X,J)}catch(Y){($=new x("error")).error(Y)}return new d($,X.type||"string",X.mimeType)},generateAsync:function(R,$){return this.generateInternalStream(R).accumulate($)},generateNodeStream:function(R,$){return(R=R||{}).type||(R.type="nodebuffer"),this.generateInternalStream(R).toNodejsStream($)}};u.exports=M},{"./compressedObject":2,"./defaults":5,"./generate":9,"./nodejs/NodejsStreamInputAdapter":12,"./nodejsUtils":14,"./stream/GenericWorker":28,"./stream/StreamHelper":29,"./utf8":31,"./utils":32,"./zipObject":35}],16:[function(l,u,f){u.exports=l("stream")},{stream:void 0}],17:[function(l,u,f){var i=l("./DataReader");function o(m){i.call(this,m);for(var x=0;x<this.data.length;x++)m[x]=255&m[x]}l("../utils").inherits(o,i),o.prototype.byteAt=function(m){return this.data[this.zero+m]},o.prototype.lastIndexOfSignature=function(m){for(var x=m.charCodeAt(0),d=m.charCodeAt(1),j=m.charCodeAt(2),y=m.charCodeAt(3),_=this.length-4;0<=_;--_)if(this.data[_]===x&&this.data[_+1]===d&&this.data[_+2]===j&&this.data[_+3]===y)return _-this.zero;return-1},o.prototype.readAndCheckSignature=function(m){var x=m.charCodeAt(0),d=m.charCodeAt(1),j=m.charCodeAt(2),y=m.charCodeAt(3),_=this.readData(4);return x===_[0]&&d===_[1]&&j===_[2]&&y===_[3]},o.prototype.readData=function(m){if(this.checkOffset(m),m===0)return[];var x=this.data.slice(this.zero+this.index,this.zero+this.index+m);return this.index+=m,x},u.exports=o},{"../utils":32,"./DataReader":18}],18:[function(l,u,f){var i=l("../utils");function o(m){this.data=m,this.length=m.length,this.index=0,this.zero=0}o.prototype={checkOffset:function(m){this.checkIndex(this.index+m)},checkIndex:function(m){if(this.length<this.zero+m||m<0)throw new Error("End of data reached (data length = "+this.length+", asked index = "+m+"). Corrupted zip ?")},setIndex:function(m){this.checkIndex(m),this.index=m},skip:function(m){this.setIndex(this.index+m)},byteAt:function(){},readInt:function(m){var x,d=0;for(this.checkOffset(m),x=this.index+m-1;x>=this.index;x--)d=(d<<8)+this.byteAt(x);return this.index+=m,d},readString:function(m){return i.transformTo("string",this.readData(m))},readData:function(){},lastIndexOfSignature:function(){},readAndCheckSignature:function(){},readDate:function(){var m=this.readInt(4);return new Date(Date.UTC(1980+(m>>25&127),(m>>21&15)-1,m>>16&31,m>>11&31,m>>5&63,(31&m)<<1))}},u.exports=o},{"../utils":32}],19:[function(l,u,f){var i=l("./Uint8ArrayReader");function o(m){i.call(this,m)}l("../utils").inherits(o,i),o.prototype.readData=function(m){this.checkOffset(m);var x=this.data.slice(this.zero+this.index,this.zero+this.index+m);return this.index+=m,x},u.exports=o},{"../utils":32,"./Uint8ArrayReader":21}],20:[function(l,u,f){var i=l("./DataReader");function o(m){i.call(this,m)}l("../utils").inherits(o,i),o.prototype.byteAt=function(m){return this.data.charCodeAt(this.zero+m)},o.prototype.lastIndexOfSignature=function(m){return this.data.lastIndexOf(m)-this.zero},o.prototype.readAndCheckSignature=function(m){return m===this.readData(4)},o.prototype.readData=function(m){this.checkOffset(m);var x=this.data.slice(this.zero+this.index,this.zero+this.index+m);return this.index+=m,x},u.exports=o},{"../utils":32,"./DataReader":18}],21:[function(l,u,f){var i=l("./ArrayReader");function o(m){i.call(this,m)}l("../utils").inherits(o,i),o.prototype.readData=function(m){if(this.checkOffset(m),m===0)return new Uint8Array(0);var x=this.data.subarray(this.zero+this.index,this.zero+this.index+m);return this.index+=m,x},u.exports=o},{"../utils":32,"./ArrayReader":17}],22:[function(l,u,f){var i=l("../utils"),o=l("../support"),m=l("./ArrayReader"),x=l("./StringReader"),d=l("./NodeBufferReader"),j=l("./Uint8ArrayReader");u.exports=function(y){var _=i.getTypeOf(y);return i.checkSupport(_),_!=="string"||o.uint8array?_==="nodebuffer"?new d(y):o.uint8array?new j(i.transformTo("uint8array",y)):new m(i.transformTo("array",y)):new x(y)}},{"../support":30,"../utils":32,"./ArrayReader":17,"./NodeBufferReader":19,"./StringReader":20,"./Uint8ArrayReader":21}],23:[function(l,u,f){f.LOCAL_FILE_HEADER="PK",f.CENTRAL_FILE_HEADER="PK",f.CENTRAL_DIRECTORY_END="PK",f.ZIP64_CENTRAL_DIRECTORY_LOCATOR="PK\x07",f.ZIP64_CENTRAL_DIRECTORY_END="PK",f.DATA_DESCRIPTOR="PK\x07\b"},{}],24:[function(l,u,f){var i=l("./GenericWorker"),o=l("../utils");function m(x){i.call(this,"ConvertWorker to "+x),this.destType=x}o.inherits(m,i),m.prototype.processChunk=function(x){this.push({data:o.transformTo(this.destType,x.data),meta:x.meta})},u.exports=m},{"../utils":32,"./GenericWorker":28}],25:[function(l,u,f){var i=l("./GenericWorker"),o=l("../crc32");function m(){i.call(this,"Crc32Probe"),this.withStreamInfo("crc32",0)}l("../utils").inherits(m,i),m.prototype.processChunk=function(x){this.streamInfo.crc32=o(x.data,this.streamInfo.crc32||0),this.push(x)},u.exports=m},{"../crc32":4,"../utils":32,"./GenericWorker":28}],26:[function(l,u,f){var i=l("../utils"),o=l("./GenericWorker");function m(x){o.call(this,"DataLengthProbe for "+x),this.propName=x,this.withStreamInfo(x,0)}i.inherits(m,o),m.prototype.processChunk=function(x){if(x){var d=this.streamInfo[this.propName]||0;this.streamInfo[this.propName]=d+x.data.length}o.prototype.processChunk.call(this,x)},u.exports=m},{"../utils":32,"./GenericWorker":28}],27:[function(l,u,f){var i=l("../utils"),o=l("./GenericWorker");function m(x){o.call(this,"DataWorker");var d=this;this.dataIsReady=!1,this.index=0,this.max=0,this.data=null,this.type="",this._tickScheduled=!1,x.then(function(j){d.dataIsReady=!0,d.data=j,d.max=j&&j.length||0,d.type=i.getTypeOf(j),d.isPaused||d._tickAndRepeat()},function(j){d.error(j)})}i.inherits(m,o),m.prototype.cleanUp=function(){o.prototype.cleanUp.call(this),this.data=null},m.prototype.resume=function(){return!!o.prototype.resume.call(this)&&(!this._tickScheduled&&this.dataIsReady&&(this._tickScheduled=!0,i.delay(this._tickAndRepeat,[],this)),!0)},m.prototype._tickAndRepeat=function(){this._tickScheduled=!1,this.isPaused||this.isFinished||(this._tick(),this.isFinished||(i.delay(this._tickAndRepeat,[],this),this._tickScheduled=!0))},m.prototype._tick=function(){if(this.isPaused||this.isFinished)return!1;var x=null,d=Math.min(this.max,this.index+16384);if(this.index>=this.max)return this.end();switch(this.type){case"string":x=this.data.substring(this.index,d);break;case"uint8array":x=this.data.subarray(this.index,d);break;case"array":case"nodebuffer":x=this.data.slice(this.index,d)}return this.index=d,this.push({data:x,meta:{percent:this.max?this.index/this.max*100:0}})},u.exports=m},{"../utils":32,"./GenericWorker":28}],28:[function(l,u,f){function i(o){this.name=o||"default",this.streamInfo={},this.generatedError=null,this.extraStreamInfo={},this.isPaused=!0,this.isFinished=!1,this.isLocked=!1,this._listeners={data:[],end:[],error:[]},this.previous=null}i.prototype={push:function(o){this.emit("data",o)},end:function(){if(this.isFinished)return!1;this.flush();try{this.emit("end"),this.cleanUp(),this.isFinished=!0}catch(o){this.emit("error",o)}return!0},error:function(o){return!this.isFinished&&(this.isPaused?this.generatedError=o:(this.isFinished=!0,this.emit("error",o),this.previous&&this.previous.error(o),this.cleanUp()),!0)},on:function(o,m){return this._listeners[o].push(m),this},cleanUp:function(){this.streamInfo=this.generatedError=this.extraStreamInfo=null,this._listeners=[]},emit:function(o,m){if(this._listeners[o])for(var x=0;x<this._listeners[o].length;x++)this._listeners[o][x].call(this,m)},pipe:function(o){return o.registerPrevious(this)},registerPrevious:function(o){if(this.isLocked)throw new Error("The stream '"+this+"' has already been used.");this.streamInfo=o.streamInfo,this.mergeStreamInfo(),this.previous=o;var m=this;return o.on("data",function(x){m.processChunk(x)}),o.on("end",function(){m.end()}),o.on("error",function(x){m.error(x)}),this},pause:function(){return!this.isPaused&&!this.isFinished&&(this.isPaused=!0,this.previous&&this.previous.pause(),!0)},resume:function(){if(!this.isPaused||this.isFinished)return!1;var o=this.isPaused=!1;return this.generatedError&&(this.error(this.generatedError),o=!0),this.previous&&this.previous.resume(),!o},flush:function(){},processChunk:function(o){this.push(o)},withStreamInfo:function(o,m){return this.extraStreamInfo[o]=m,this.mergeStreamInfo(),this},mergeStreamInfo:function(){for(var o in this.extraStreamInfo)Object.prototype.hasOwnProperty.call(this.extraStreamInfo,o)&&(this.streamInfo[o]=this.extraStreamInfo[o])},lock:function(){if(this.isLocked)throw new Error("The stream '"+this+"' has already been used.");this.isLocked=!0,this.previous&&this.previous.lock()},toString:function(){var o="Worker "+this.name;return this.previous?this.previous+" -> "+o:o}},u.exports=i},{}],29:[function(l,u,f){var i=l("../utils"),o=l("./ConvertWorker"),m=l("./GenericWorker"),x=l("../base64"),d=l("../support"),j=l("../external"),y=null;if(d.nodestream)try{y=l("../nodejs/NodejsStreamOutputAdapter")}catch{}function _(D,w){return new j.Promise(function(N,S){var O=[],C=D._internalType,M=D._outputType,R=D._mimeType;D.on("data",function($,X){O.push($),w&&w(X)}).on("error",function($){O=[],S($)}).on("end",function(){try{var $=function(X,J,Y){switch(X){case"blob":return i.newBlob(i.transformTo("arraybuffer",J),Y);case"base64":return x.encode(J);default:return i.transformTo(X,J)}}(M,function(X,J){var Y,H=0,K=null,q=0;for(Y=0;Y<J.length;Y++)q+=J[Y].length;switch(X){case"string":return J.join("");case"array":return Array.prototype.concat.apply([],J);case"uint8array":for(K=new Uint8Array(q),Y=0;Y<J.length;Y++)K.set(J[Y],H),H+=J[Y].length;return K;case"nodebuffer":return Buffer.concat(J);default:throw new Error("concat : unsupported type '"+X+"'")}}(C,O),R);N($)}catch(X){S(X)}O=[]}).resume()})}function b(D,w,N){var S=w;switch(w){case"blob":case"arraybuffer":S="uint8array";break;case"base64":S="string"}try{this._internalType=S,this._outputType=w,this._mimeType=N,i.checkSupport(S),this._worker=D.pipe(new o(S)),D.lock()}catch(O){this._worker=new m("error"),this._worker.error(O)}}b.prototype={accumulate:function(D){return _(this,D)},on:function(D,w){var N=this;return D==="data"?this._worker.on(D,function(S){w.call(N,S.data,S.meta)}):this._worker.on(D,function(){i.delay(w,arguments,N)}),this},resume:function(){return i.delay(this._worker.resume,[],this._worker),this},pause:function(){return this._worker.pause(),this},toNodejsStream:function(D){if(i.checkSupport("nodestream"),this._outputType!=="nodebuffer")throw new Error(this._outputType+" is not supported by this method");return new y(this,{objectMode:this._outputType!=="nodebuffer"},D)}},u.exports=b},{"../base64":1,"../external":6,"../nodejs/NodejsStreamOutputAdapter":13,"../support":30,"../utils":32,"./ConvertWorker":24,"./GenericWorker":28}],30:[function(l,u,f){if(f.base64=!0,f.array=!0,f.string=!0,f.arraybuffer=typeof ArrayBuffer<"u"&&typeof Uint8Array<"u",f.nodebuffer=typeof Buffer<"u",f.uint8array=typeof Uint8Array<"u",typeof ArrayBuffer>"u")f.blob=!1;else{var i=new ArrayBuffer(0);try{f.blob=new Blob([i],{type:"application/zip"}).size===0}catch{try{var o=new(self.BlobBuilder||self.WebKitBlobBuilder||self.MozBlobBuilder||self.MSBlobBuilder);o.append(i),f.blob=o.getBlob("application/zip").size===0}catch{f.blob=!1}}}try{f.nodestream=!!l("readable-stream").Readable}catch{f.nodestream=!1}},{"readable-stream":16}],31:[function(l,u,f){for(var i=l("./utils"),o=l("./support"),m=l("./nodejsUtils"),x=l("./stream/GenericWorker"),d=new Array(256),j=0;j<256;j++)d[j]=252<=j?6:248<=j?5:240<=j?4:224<=j?3:192<=j?2:1;d[254]=d[254]=1;function y(){x.call(this,"utf-8 decode"),this.leftOver=null}function _(){x.call(this,"utf-8 encode")}f.utf8encode=function(b){return o.nodebuffer?m.newBufferFrom(b,"utf-8"):function(D){var w,N,S,O,C,M=D.length,R=0;for(O=0;O<M;O++)(64512&(N=D.charCodeAt(O)))==55296&&O+1<M&&(64512&(S=D.charCodeAt(O+1)))==56320&&(N=65536+(N-55296<<10)+(S-56320),O++),R+=N<128?1:N<2048?2:N<65536?3:4;for(w=o.uint8array?new Uint8Array(R):new Array(R),O=C=0;C<R;O++)(64512&(N=D.charCodeAt(O)))==55296&&O+1<M&&(64512&(S=D.charCodeAt(O+1)))==56320&&(N=65536+(N-55296<<10)+(S-56320),O++),N<128?w[C++]=N:(N<2048?w[C++]=192|N>>>6:(N<65536?w[C++]=224|N>>>12:(w[C++]=240|N>>>18,w[C++]=128|N>>>12&63),w[C++]=128|N>>>6&63),w[C++]=128|63&N);return w}(b)},f.utf8decode=function(b){return o.nodebuffer?i.transformTo("nodebuffer",b).toString("utf-8"):function(D){var w,N,S,O,C=D.length,M=new Array(2*C);for(w=N=0;w<C;)if((S=D[w++])<128)M[N++]=S;else if(4<(O=d[S]))M[N++]=65533,w+=O-1;else{for(S&=O===2?31:O===3?15:7;1<O&&w<C;)S=S<<6|63&D[w++],O--;1<O?M[N++]=65533:S<65536?M[N++]=S:(S-=65536,M[N++]=55296|S>>10&1023,M[N++]=56320|1023&S)}return M.length!==N&&(M.subarray?M=M.subarray(0,N):M.length=N),i.applyFromCharCode(M)}(b=i.transformTo(o.uint8array?"uint8array":"array",b))},i.inherits(y,x),y.prototype.processChunk=function(b){var D=i.transformTo(o.uint8array?"uint8array":"array",b.data);if(this.leftOver&&this.leftOver.length){if(o.uint8array){var w=D;(D=new Uint8Array(w.length+this.leftOver.length)).set(this.leftOver,0),D.set(w,this.leftOver.length)}else D=this.leftOver.concat(D);this.leftOver=null}var N=function(O,C){var M;for((C=C||O.length)>O.length&&(C=O.length),M=C-1;0<=M&&(192&O[M])==128;)M--;return M<0||M===0?C:M+d[O[M]]>C?M:C}(D),S=D;N!==D.length&&(o.uint8array?(S=D.subarray(0,N),this.leftOver=D.subarray(N,D.length)):(S=D.slice(0,N),this.leftOver=D.slice(N,D.length))),this.push({data:f.utf8decode(S),meta:b.meta})},y.prototype.flush=function(){this.leftOver&&this.leftOver.length&&(this.push({data:f.utf8decode(this.leftOver),meta:{}}),this.leftOver=null)},f.Utf8DecodeWorker=y,i.inherits(_,x),_.prototype.processChunk=function(b){this.push({data:f.utf8encode(b.data),meta:b.meta})},f.Utf8EncodeWorker=_},{"./nodejsUtils":14,"./stream/GenericWorker":28,"./support":30,"./utils":32}],32:[function(l,u,f){var i=l("./support"),o=l("./base64"),m=l("./nodejsUtils"),x=l("./external");function d(w){return w}function j(w,N){for(var S=0;S<w.length;++S)N[S]=255&w.charCodeAt(S);return N}l("setimmediate"),f.newBlob=function(w,N){f.checkSupport("blob");try{return new Blob([w],{type:N})}catch{try{var S=new(self.BlobBuilder||self.WebKitBlobBuilder||self.MozBlobBuilder||self.MSBlobBuilder);return S.append(w),S.getBlob(N)}catch{throw new Error("Bug : can't construct the Blob.")}}};var y={stringifyByChunk:function(w,N,S){var O=[],C=0,M=w.length;if(M<=S)return String.fromCharCode.apply(null,w);for(;C<M;)N==="array"||N==="nodebuffer"?O.push(String.fromCharCode.apply(null,w.slice(C,Math.min(C+S,M)))):O.push(String.fromCharCode.apply(null,w.subarray(C,Math.min(C+S,M)))),C+=S;return O.join("")},stringifyByChar:function(w){for(var N="",S=0;S<w.length;S++)N+=String.fromCharCode(w[S]);return N},applyCanBeUsed:{uint8array:function(){try{return i.uint8array&&String.fromCharCode.apply(null,new Uint8Array(1)).length===1}catch{return!1}}(),nodebuffer:function(){try{return i.nodebuffer&&String.fromCharCode.apply(null,m.allocBuffer(1)).length===1}catch{return!1}}()}};function _(w){var N=65536,S=f.getTypeOf(w),O=!0;if(S==="uint8array"?O=y.applyCanBeUsed.uint8array:S==="nodebuffer"&&(O=y.applyCanBeUsed.nodebuffer),O)for(;1<N;)try{return y.stringifyByChunk(w,S,N)}catch{N=Math.floor(N/2)}return y.stringifyByChar(w)}function b(w,N){for(var S=0;S<w.length;S++)N[S]=w[S];return N}f.applyFromCharCode=_;var D={};D.string={string:d,array:function(w){return j(w,new Array(w.length))},arraybuffer:function(w){return D.string.uint8array(w).buffer},uint8array:function(w){return j(w,new Uint8Array(w.length))},nodebuffer:function(w){return j(w,m.allocBuffer(w.length))}},D.array={string:_,array:d,arraybuffer:function(w){return new Uint8Array(w).buffer},uint8array:function(w){return new Uint8Array(w)},nodebuffer:function(w){return m.newBufferFrom(w)}},D.arraybuffer={string:function(w){return _(new Uint8Array(w))},array:function(w){return b(new Uint8Array(w),new Array(w.byteLength))},arraybuffer:d,uint8array:function(w){return new Uint8Array(w)},nodebuffer:function(w){return m.newBufferFrom(new Uint8Array(w))}},D.uint8array={string:_,array:function(w){return b(w,new Array(w.length))},arraybuffer:function(w){return w.buffer},uint8array:d,nodebuffer:function(w){return m.newBufferFrom(w)}},D.nodebuffer={string:_,array:function(w){return b(w,new Array(w.length))},arraybuffer:function(w){return D.nodebuffer.uint8array(w).buffer},uint8array:function(w){return b(w,new Uint8Array(w.length))},nodebuffer:d},f.transformTo=function(w,N){if(N=N||"",!w)return N;f.checkSupport(w);var S=f.getTypeOf(N);return D[S][w](N)},f.resolve=function(w){for(var N=w.split("/"),S=[],O=0;O<N.length;O++){var C=N[O];C==="."||C===""&&O!==0&&O!==N.length-1||(C===".."?S.pop():S.push(C))}return S.join("/")},f.getTypeOf=function(w){return typeof w=="string"?"string":Object.prototype.toString.call(w)==="[object Array]"?"array":i.nodebuffer&&m.isBuffer(w)?"nodebuffer":i.uint8array&&w instanceof Uint8Array?"uint8array":i.arraybuffer&&w instanceof ArrayBuffer?"arraybuffer":void 0},f.checkSupport=function(w){if(!i[w.toLowerCase()])throw new Error(w+" is not supported by this platform")},f.MAX_VALUE_16BITS=65535,f.MAX_VALUE_32BITS=-1,f.pretty=function(w){var N,S,O="";for(S=0;S<(w||"").length;S++)O+="\\x"+((N=w.charCodeAt(S))<16?"0":"")+N.toString(16).toUpperCase();return O},f.delay=function(w,N,S){setImmediate(function(){w.apply(S||null,N||[])})},f.inherits=function(w,N){function S(){}S.prototype=N.prototype,w.prototype=new S},f.extend=function(){var w,N,S={};for(w=0;w<arguments.length;w++)for(N in arguments[w])Object.prototype.hasOwnProperty.call(arguments[w],N)&&S[N]===void 0&&(S[N]=arguments[w][N]);return S},f.prepareContent=function(w,N,S,O,C){return x.Promise.resolve(N).then(function(M){return i.blob&&(M instanceof Blob||["[object File]","[object Blob]"].indexOf(Object.prototype.toString.call(M))!==-1)&&typeof FileReader<"u"?new x.Promise(function(R,$){var X=new FileReader;X.onload=function(J){R(J.target.result)},X.onerror=function(J){$(J.target.error)},X.readAsArrayBuffer(M)}):M}).then(function(M){var R=f.getTypeOf(M);return R?(R==="arraybuffer"?M=f.transformTo("uint8array",M):R==="string"&&(C?M=o.decode(M):S&&O!==!0&&(M=function($){return j($,i.uint8array?new Uint8Array($.length):new Array($.length))}(M))),M):x.Promise.reject(new Error("Can't read the data of '"+w+"'. Is it in a supported JavaScript type (String, Blob, ArrayBuffer, etc) ?"))})}},{"./base64":1,"./external":6,"./nodejsUtils":14,"./support":30,setimmediate:54}],33:[function(l,u,f){var i=l("./reader/readerFor"),o=l("./utils"),m=l("./signature"),x=l("./zipEntry"),d=l("./support");function j(y){this.files=[],this.loadOptions=y}j.prototype={checkSignature:function(y){if(!this.reader.readAndCheckSignature(y)){this.reader.index-=4;var _=this.reader.readString(4);throw new Error("Corrupted zip or bug: unexpected signature ("+o.pretty(_)+", expected "+o.pretty(y)+")")}},isSignature:function(y,_){var b=this.reader.index;this.reader.setIndex(y);var D=this.reader.readString(4)===_;return this.reader.setIndex(b),D},readBlockEndOfCentral:function(){this.diskNumber=this.reader.readInt(2),this.diskWithCentralDirStart=this.reader.readInt(2),this.centralDirRecordsOnThisDisk=this.reader.readInt(2),this.centralDirRecords=this.reader.readInt(2),this.centralDirSize=this.reader.readInt(4),this.centralDirOffset=this.reader.readInt(4),this.zipCommentLength=this.reader.readInt(2);var y=this.reader.readData(this.zipCommentLength),_=d.uint8array?"uint8array":"array",b=o.transformTo(_,y);this.zipComment=this.loadOptions.decodeFileName(b)},readBlockZip64EndOfCentral:function(){this.zip64EndOfCentralSize=this.reader.readInt(8),this.reader.skip(4),this.diskNumber=this.reader.readInt(4),this.diskWithCentralDirStart=this.reader.readInt(4),this.centralDirRecordsOnThisDisk=this.reader.readInt(8),this.centralDirRecords=this.reader.readInt(8),this.centralDirSize=this.reader.readInt(8),this.centralDirOffset=this.reader.readInt(8),this.zip64ExtensibleData={};for(var y,_,b,D=this.zip64EndOfCentralSize-44;0<D;)y=this.reader.readInt(2),_=this.reader.readInt(4),b=this.reader.readData(_),this.zip64ExtensibleData[y]={id:y,length:_,value:b}},readBlockZip64EndOfCentralLocator:function(){if(this.diskWithZip64CentralDirStart=this.reader.readInt(4),this.relativeOffsetEndOfZip64CentralDir=this.reader.readInt(8),this.disksCount=this.reader.readInt(4),1<this.disksCount)throw new Error("Multi-volumes zip are not supported")},readLocalFiles:function(){var y,_;for(y=0;y<this.files.length;y++)_=this.files[y],this.reader.setIndex(_.localHeaderOffset),this.checkSignature(m.LOCAL_FILE_HEADER),_.readLocalPart(this.reader),_.handleUTF8(),_.processAttributes()},readCentralDir:function(){var y;for(this.reader.setIndex(this.centralDirOffset);this.reader.readAndCheckSignature(m.CENTRAL_FILE_HEADER);)(y=new x({zip64:this.zip64},this.loadOptions)).readCentralPart(this.reader),this.files.push(y);if(this.centralDirRecords!==this.files.length&&this.centralDirRecords!==0&&this.files.length===0)throw new Error("Corrupted zip or bug: expected "+this.centralDirRecords+" records in central dir, got "+this.files.length)},readEndOfCentral:function(){var y=this.reader.lastIndexOfSignature(m.CENTRAL_DIRECTORY_END);if(y<0)throw this.isSignature(0,m.LOCAL_FILE_HEADER)?new Error("Corrupted zip: can't find end of central directory"):new Error("Can't find end of central directory : is this a zip file ? If it is, see https://stuk.github.io/jszip/documentation/howto/read_zip.html");this.reader.setIndex(y);var _=y;if(this.checkSignature(m.CENTRAL_DIRECTORY_END),this.readBlockEndOfCentral(),this.diskNumber===o.MAX_VALUE_16BITS||this.diskWithCentralDirStart===o.MAX_VALUE_16BITS||this.centralDirRecordsOnThisDisk===o.MAX_VALUE_16BITS||this.centralDirRecords===o.MAX_VALUE_16BITS||this.centralDirSize===o.MAX_VALUE_32BITS||this.centralDirOffset===o.MAX_VALUE_32BITS){if(this.zip64=!0,(y=this.reader.lastIndexOfSignature(m.ZIP64_CENTRAL_DIRECTORY_LOCATOR))<0)throw new Error("Corrupted zip: can't find the ZIP64 end of central directory locator");if(this.reader.setIndex(y),this.checkSignature(m.ZIP64_CENTRAL_DIRECTORY_LOCATOR),this.readBlockZip64EndOfCentralLocator(),!this.isSignature(this.relativeOffsetEndOfZip64CentralDir,m.ZIP64_CENTRAL_DIRECTORY_END)&&(this.relativeOffsetEndOfZip64CentralDir=this.reader.lastIndexOfSignature(m.ZIP64_CENTRAL_DIRECTORY_END),this.relativeOffsetEndOfZip64CentralDir<0))throw new Error("Corrupted zip: can't find the ZIP64 end of central directory");this.reader.setIndex(this.relativeOffsetEndOfZip64CentralDir),this.checkSignature(m.ZIP64_CENTRAL_DIRECTORY_END),this.readBlockZip64EndOfCentral()}var b=this.centralDirOffset+this.centralDirSize;this.zip64&&(b+=20,b+=12+this.zip64EndOfCentralSize);var D=_-b;if(0<D)this.isSignature(_,m.CENTRAL_FILE_HEADER)||(this.reader.zero=D);else if(D<0)throw new Error("Corrupted zip: missing "+Math.abs(D)+" bytes.")},prepareReader:function(y){this.reader=i(y)},load:function(y){this.prepareReader(y),this.readEndOfCentral(),this.readCentralDir(),this.readLocalFiles()}},u.exports=j},{"./reader/readerFor":22,"./signature":23,"./support":30,"./utils":32,"./zipEntry":34}],34:[function(l,u,f){var i=l("./reader/readerFor"),o=l("./utils"),m=l("./compressedObject"),x=l("./crc32"),d=l("./utf8"),j=l("./compressions"),y=l("./support");function _(b,D){this.options=b,this.loadOptions=D}_.prototype={isEncrypted:function(){return(1&this.bitFlag)==1},useUTF8:function(){return(2048&this.bitFlag)==2048},readLocalPart:function(b){var D,w;if(b.skip(22),this.fileNameLength=b.readInt(2),w=b.readInt(2),this.fileName=b.readData(this.fileNameLength),b.skip(w),this.compressedSize===-1||this.uncompressedSize===-1)throw new Error("Bug or corrupted zip : didn't get enough information from the central directory (compressedSize === -1 || uncompressedSize === -1)");if((D=function(N){for(var S in j)if(Object.prototype.hasOwnProperty.call(j,S)&&j[S].magic===N)return j[S];return null}(this.compressionMethod))===null)throw new Error("Corrupted zip : compression "+o.pretty(this.compressionMethod)+" unknown (inner file : "+o.transformTo("string",this.fileName)+")");this.decompressed=new m(this.compressedSize,this.uncompressedSize,this.crc32,D,b.readData(this.compressedSize))},readCentralPart:function(b){this.versionMadeBy=b.readInt(2),b.skip(2),this.bitFlag=b.readInt(2),this.compressionMethod=b.readString(2),this.date=b.readDate(),this.crc32=b.readInt(4),this.compressedSize=b.readInt(4),this.uncompressedSize=b.readInt(4);var D=b.readInt(2);if(this.extraFieldsLength=b.readInt(2),this.fileCommentLength=b.readInt(2),this.diskNumberStart=b.readInt(2),this.internalFileAttributes=b.readInt(2),this.externalFileAttributes=b.readInt(4),this.localHeaderOffset=b.readInt(4),this.isEncrypted())throw new Error("Encrypted zip are not supported");b.skip(D),this.readExtraFields(b),this.parseZIP64ExtraField(b),this.fileComment=b.readData(this.fileCommentLength)},processAttributes:function(){this.unixPermissions=null,this.dosPermissions=null;var b=this.versionMadeBy>>8;this.dir=!!(16&this.externalFileAttributes),b==0&&(this.dosPermissions=63&this.externalFileAttributes),b==3&&(this.unixPermissions=this.externalFileAttributes>>16&65535),this.dir||this.fileNameStr.slice(-1)!=="/"||(this.dir=!0)},parseZIP64ExtraField:function(){if(this.extraFields[1]){var b=i(this.extraFields[1].value);this.uncompressedSize===o.MAX_VALUE_32BITS&&(this.uncompressedSize=b.readInt(8)),this.compressedSize===o.MAX_VALUE_32BITS&&(this.compressedSize=b.readInt(8)),this.localHeaderOffset===o.MAX_VALUE_32BITS&&(this.localHeaderOffset=b.readInt(8)),this.diskNumberStart===o.MAX_VALUE_32BITS&&(this.diskNumberStart=b.readInt(4))}},readExtraFields:function(b){var D,w,N,S=b.index+this.extraFieldsLength;for(this.extraFields||(this.extraFields={});b.index+4<S;)D=b.readInt(2),w=b.readInt(2),N=b.readData(w),this.extraFields[D]={id:D,length:w,value:N};b.setIndex(S)},handleUTF8:function(){var b=y.uint8array?"uint8array":"array";if(this.useUTF8())this.fileNameStr=d.utf8decode(this.fileName),this.fileCommentStr=d.utf8decode(this.fileComment);else{var D=this.findExtraFieldUnicodePath();if(D!==null)this.fileNameStr=D;else{var w=o.transformTo(b,this.fileName);this.fileNameStr=this.loadOptions.decodeFileName(w)}var N=this.findExtraFieldUnicodeComment();if(N!==null)this.fileCommentStr=N;else{var S=o.transformTo(b,this.fileComment);this.fileCommentStr=this.loadOptions.decodeFileName(S)}}},findExtraFieldUnicodePath:function(){var b=this.extraFields[28789];if(b){var D=i(b.value);return D.readInt(1)!==1||x(this.fileName)!==D.readInt(4)?null:d.utf8decode(D.readData(b.length-5))}return null},findExtraFieldUnicodeComment:function(){var b=this.extraFields[25461];if(b){var D=i(b.value);return D.readInt(1)!==1||x(this.fileComment)!==D.readInt(4)?null:d.utf8decode(D.readData(b.length-5))}return null}},u.exports=_},{"./compressedObject":2,"./compressions":3,"./crc32":4,"./reader/readerFor":22,"./support":30,"./utf8":31,"./utils":32}],35:[function(l,u,f){function i(D,w,N){this.name=D,this.dir=N.dir,this.date=N.date,this.comment=N.comment,this.unixPermissions=N.unixPermissions,this.dosPermissions=N.dosPermissions,this._data=w,this._dataBinary=N.binary,this.options={compression:N.compression,compressionOptions:N.compressionOptions}}var o=l("./stream/StreamHelper"),m=l("./stream/DataWorker"),x=l("./utf8"),d=l("./compressedObject"),j=l("./stream/GenericWorker");i.prototype={internalStream:function(D){var w=null,N="string";try{if(!D)throw new Error("No output type specified.");var S=(N=D.toLowerCase())==="string"||N==="text";N!=="binarystring"&&N!=="text"||(N="string"),w=this._decompressWorker();var O=!this._dataBinary;O&&!S&&(w=w.pipe(new x.Utf8EncodeWorker)),!O&&S&&(w=w.pipe(new x.Utf8DecodeWorker))}catch(C){(w=new j("error")).error(C)}return new o(w,N,"")},async:function(D,w){return this.internalStream(D).accumulate(w)},nodeStream:function(D,w){return this.internalStream(D||"nodebuffer").toNodejsStream(w)},_compressWorker:function(D,w){if(this._data instanceof d&&this._data.compression.magic===D.magic)return this._data.getCompressedWorker();var N=this._decompressWorker();return this._dataBinary||(N=N.pipe(new x.Utf8EncodeWorker)),d.createWorkerFrom(N,D,w)},_decompressWorker:function(){return this._data instanceof d?this._data.getContentWorker():this._data instanceof j?this._data:new m(this._data)}};for(var y=["asText","asBinary","asNodeBuffer","asUint8Array","asArrayBuffer"],_=function(){throw new Error("This method has been removed in JSZip 3.0, please check the upgrade guide.")},b=0;b<y.length;b++)i.prototype[y[b]]=_;u.exports=i},{"./compressedObject":2,"./stream/DataWorker":27,"./stream/GenericWorker":28,"./stream/StreamHelper":29,"./utf8":31}],36:[function(l,u,f){(function(i){var o,m,x=i.MutationObserver||i.WebKitMutationObserver;if(x){var d=0,j=new x(D),y=i.document.createTextNode("");j.observe(y,{characterData:!0}),o=function(){y.data=d=++d%2}}else if(i.setImmediate||i.MessageChannel===void 0)o="document"in i&&"onreadystatechange"in i.document.createElement("script")?function(){var w=i.document.createElement("script");w.onreadystatechange=function(){D(),w.onreadystatechange=null,w.parentNode.removeChild(w),w=null},i.document.documentElement.appendChild(w)}:function(){setTimeout(D,0)};else{var _=new i.MessageChannel;_.port1.onmessage=D,o=function(){_.port2.postMessage(0)}}var b=[];function D(){var w,N;m=!0;for(var S=b.length;S;){for(N=b,b=[],w=-1;++w<S;)N[w]();S=b.length}m=!1}u.exports=function(w){b.push(w)!==1||m||o()}}).call(this,typeof Oo<"u"?Oo:typeof self<"u"?self:typeof window<"u"?window:{})},{}],37:[function(l,u,f){var i=l("immediate");function o(){}var m={},x=["REJECTED"],d=["FULFILLED"],j=["PENDING"];function y(S){if(typeof S!="function")throw new TypeError("resolver must be a function");this.state=j,this.queue=[],this.outcome=void 0,S!==o&&w(this,S)}function _(S,O,C){this.promise=S,typeof O=="function"&&(this.onFulfilled=O,this.callFulfilled=this.otherCallFulfilled),typeof C=="function"&&(this.onRejected=C,this.callRejected=this.otherCallRejected)}function b(S,O,C){i(function(){var M;try{M=O(C)}catch(R){return m.reject(S,R)}M===S?m.reject(S,new TypeError("Cannot resolve promise with itself")):m.resolve(S,M)})}function D(S){var O=S&&S.then;if(S&&(typeof S=="object"||typeof S=="function")&&typeof O=="function")return function(){O.apply(S,arguments)}}function w(S,O){var C=!1;function M(X){C||(C=!0,m.reject(S,X))}function R(X){C||(C=!0,m.resolve(S,X))}var $=N(function(){O(R,M)});$.status==="error"&&M($.value)}function N(S,O){var C={};try{C.value=S(O),C.status="success"}catch(M){C.status="error",C.value=M}return C}(u.exports=y).prototype.finally=function(S){if(typeof S!="function")return this;var O=this.constructor;return this.then(function(C){return O.resolve(S()).then(function(){return C})},function(C){return O.resolve(S()).then(function(){throw C})})},y.prototype.catch=function(S){return this.then(null,S)},y.prototype.then=function(S,O){if(typeof S!="function"&&this.state===d||typeof O!="function"&&this.state===x)return this;var C=new this.constructor(o);return this.state!==j?b(C,this.state===d?S:O,this.outcome):this.queue.push(new _(C,S,O)),C},_.prototype.callFulfilled=function(S){m.resolve(this.promise,S)},_.prototype.otherCallFulfilled=function(S){b(this.promise,this.onFulfilled,S)},_.prototype.callRejected=function(S){m.reject(this.promise,S)},_.prototype.otherCallRejected=function(S){b(this.promise,this.onRejected,S)},m.resolve=function(S,O){var C=N(D,O);if(C.status==="error")return m.reject(S,C.value);var M=C.value;if(M)w(S,M);else{S.state=d,S.outcome=O;for(var R=-1,$=S.queue.length;++R<$;)S.queue[R].callFulfilled(O)}return S},m.reject=function(S,O){S.state=x,S.outcome=O;for(var C=-1,M=S.queue.length;++C<M;)S.queue[C].callRejected(O);return S},y.resolve=function(S){return S instanceof this?S:m.resolve(new this(o),S)},y.reject=function(S){var O=new this(o);return m.reject(O,S)},y.all=function(S){var O=this;if(Object.prototype.toString.call(S)!=="[object Array]")return this.reject(new TypeError("must be an array"));var C=S.length,M=!1;if(!C)return this.resolve([]);for(var R=new Array(C),$=0,X=-1,J=new this(o);++X<C;)Y(S[X],X);return J;function Y(H,K){O.resolve(H).then(function(q){R[K]=q,++$!==C||M||(M=!0,m.resolve(J,R))},function(q){M||(M=!0,m.reject(J,q))})}},y.race=function(S){var O=this;if(Object.prototype.toString.call(S)!=="[object Array]")return this.reject(new TypeError("must be an array"));var C=S.length,M=!1;if(!C)return this.resolve([]);for(var R=-1,$=new this(o);++R<C;)X=S[R],O.resolve(X).then(function(J){M||(M=!0,m.resolve($,J))},function(J){M||(M=!0,m.reject($,J))});var X;return $}},{immediate:36}],38:[function(l,u,f){var i={};(0,l("./lib/utils/common").assign)(i,l("./lib/deflate"),l("./lib/inflate"),l("./lib/zlib/constants")),u.exports=i},{"./lib/deflate":39,"./lib/inflate":40,"./lib/utils/common":41,"./lib/zlib/constants":44}],39:[function(l,u,f){var i=l("./zlib/deflate"),o=l("./utils/common"),m=l("./utils/strings"),x=l("./zlib/messages"),d=l("./zlib/zstream"),j=Object.prototype.toString,y=0,_=-1,b=0,D=8;function w(S){if(!(this instanceof w))return new w(S);this.options=o.assign({level:_,method:D,chunkSize:16384,windowBits:15,memLevel:8,strategy:b,to:""},S||{});var O=this.options;O.raw&&0<O.windowBits?O.windowBits=-O.windowBits:O.gzip&&0<O.windowBits&&O.windowBits<16&&(O.windowBits+=16),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new d,this.strm.avail_out=0;var C=i.deflateInit2(this.strm,O.level,O.method,O.windowBits,O.memLevel,O.strategy);if(C!==y)throw new Error(x[C]);if(O.header&&i.deflateSetHeader(this.strm,O.header),O.dictionary){var M;if(M=typeof O.dictionary=="string"?m.string2buf(O.dictionary):j.call(O.dictionary)==="[object ArrayBuffer]"?new Uint8Array(O.dictionary):O.dictionary,(C=i.deflateSetDictionary(this.strm,M))!==y)throw new Error(x[C]);this._dict_set=!0}}function N(S,O){var C=new w(O);if(C.push(S,!0),C.err)throw C.msg||x[C.err];return C.result}w.prototype.push=function(S,O){var C,M,R=this.strm,$=this.options.chunkSize;if(this.ended)return!1;M=O===~~O?O:O===!0?4:0,typeof S=="string"?R.input=m.string2buf(S):j.call(S)==="[object ArrayBuffer]"?R.input=new Uint8Array(S):R.input=S,R.next_in=0,R.avail_in=R.input.length;do{if(R.avail_out===0&&(R.output=new o.Buf8($),R.next_out=0,R.avail_out=$),(C=i.deflate(R,M))!==1&&C!==y)return this.onEnd(C),!(this.ended=!0);R.avail_out!==0&&(R.avail_in!==0||M!==4&&M!==2)||(this.options.to==="string"?this.onData(m.buf2binstring(o.shrinkBuf(R.output,R.next_out))):this.onData(o.shrinkBuf(R.output,R.next_out)))}while((0<R.avail_in||R.avail_out===0)&&C!==1);return M===4?(C=i.deflateEnd(this.strm),this.onEnd(C),this.ended=!0,C===y):M!==2||(this.onEnd(y),!(R.avail_out=0))},w.prototype.onData=function(S){this.chunks.push(S)},w.prototype.onEnd=function(S){S===y&&(this.options.to==="string"?this.result=this.chunks.join(""):this.result=o.flattenChunks(this.chunks)),this.chunks=[],this.err=S,this.msg=this.strm.msg},f.Deflate=w,f.deflate=N,f.deflateRaw=function(S,O){return(O=O||{}).raw=!0,N(S,O)},f.gzip=function(S,O){return(O=O||{}).gzip=!0,N(S,O)}},{"./utils/common":41,"./utils/strings":42,"./zlib/deflate":46,"./zlib/messages":51,"./zlib/zstream":53}],40:[function(l,u,f){var i=l("./zlib/inflate"),o=l("./utils/common"),m=l("./utils/strings"),x=l("./zlib/constants"),d=l("./zlib/messages"),j=l("./zlib/zstream"),y=l("./zlib/gzheader"),_=Object.prototype.toString;function b(w){if(!(this instanceof b))return new b(w);this.options=o.assign({chunkSize:16384,windowBits:0,to:""},w||{});var N=this.options;N.raw&&0<=N.windowBits&&N.windowBits<16&&(N.windowBits=-N.windowBits,N.windowBits===0&&(N.windowBits=-15)),!(0<=N.windowBits&&N.windowBits<16)||w&&w.windowBits||(N.windowBits+=32),15<N.windowBits&&N.windowBits<48&&(15&N.windowBits)==0&&(N.windowBits|=15),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new j,this.strm.avail_out=0;var S=i.inflateInit2(this.strm,N.windowBits);if(S!==x.Z_OK)throw new Error(d[S]);this.header=new y,i.inflateGetHeader(this.strm,this.header)}function D(w,N){var S=new b(N);if(S.push(w,!0),S.err)throw S.msg||d[S.err];return S.result}b.prototype.push=function(w,N){var S,O,C,M,R,$,X=this.strm,J=this.options.chunkSize,Y=this.options.dictionary,H=!1;if(this.ended)return!1;O=N===~~N?N:N===!0?x.Z_FINISH:x.Z_NO_FLUSH,typeof w=="string"?X.input=m.binstring2buf(w):_.call(w)==="[object ArrayBuffer]"?X.input=new Uint8Array(w):X.input=w,X.next_in=0,X.avail_in=X.input.length;do{if(X.avail_out===0&&(X.output=new o.Buf8(J),X.next_out=0,X.avail_out=J),(S=i.inflate(X,x.Z_NO_FLUSH))===x.Z_NEED_DICT&&Y&&($=typeof Y=="string"?m.string2buf(Y):_.call(Y)==="[object ArrayBuffer]"?new Uint8Array(Y):Y,S=i.inflateSetDictionary(this.strm,$)),S===x.Z_BUF_ERROR&&H===!0&&(S=x.Z_OK,H=!1),S!==x.Z_STREAM_END&&S!==x.Z_OK)return this.onEnd(S),!(this.ended=!0);X.next_out&&(X.avail_out!==0&&S!==x.Z_STREAM_END&&(X.avail_in!==0||O!==x.Z_FINISH&&O!==x.Z_SYNC_FLUSH)||(this.options.to==="string"?(C=m.utf8border(X.output,X.next_out),M=X.next_out-C,R=m.buf2string(X.output,C),X.next_out=M,X.avail_out=J-M,M&&o.arraySet(X.output,X.output,C,M,0),this.onData(R)):this.onData(o.shrinkBuf(X.output,X.next_out)))),X.avail_in===0&&X.avail_out===0&&(H=!0)}while((0<X.avail_in||X.avail_out===0)&&S!==x.Z_STREAM_END);return S===x.Z_STREAM_END&&(O=x.Z_FINISH),O===x.Z_FINISH?(S=i.inflateEnd(this.strm),this.onEnd(S),this.ended=!0,S===x.Z_OK):O!==x.Z_SYNC_FLUSH||(this.onEnd(x.Z_OK),!(X.avail_out=0))},b.prototype.onData=function(w){this.chunks.push(w)},b.prototype.onEnd=function(w){w===x.Z_OK&&(this.options.to==="string"?this.result=this.chunks.join(""):this.result=o.flattenChunks(this.chunks)),this.chunks=[],this.err=w,this.msg=this.strm.msg},f.Inflate=b,f.inflate=D,f.inflateRaw=function(w,N){return(N=N||{}).raw=!0,D(w,N)},f.ungzip=D},{"./utils/common":41,"./utils/strings":42,"./zlib/constants":44,"./zlib/gzheader":47,"./zlib/inflate":49,"./zlib/messages":51,"./zlib/zstream":53}],41:[function(l,u,f){var i=typeof Uint8Array<"u"&&typeof Uint16Array<"u"&&typeof Int32Array<"u";f.assign=function(x){for(var d=Array.prototype.slice.call(arguments,1);d.length;){var j=d.shift();if(j){if(typeof j!="object")throw new TypeError(j+"must be non-object");for(var y in j)j.hasOwnProperty(y)&&(x[y]=j[y])}}return x},f.shrinkBuf=function(x,d){return x.length===d?x:x.subarray?x.subarray(0,d):(x.length=d,x)};var o={arraySet:function(x,d,j,y,_){if(d.subarray&&x.subarray)x.set(d.subarray(j,j+y),_);else for(var b=0;b<y;b++)x[_+b]=d[j+b]},flattenChunks:function(x){var d,j,y,_,b,D;for(d=y=0,j=x.length;d<j;d++)y+=x[d].length;for(D=new Uint8Array(y),d=_=0,j=x.length;d<j;d++)b=x[d],D.set(b,_),_+=b.length;return D}},m={arraySet:function(x,d,j,y,_){for(var b=0;b<y;b++)x[_+b]=d[j+b]},flattenChunks:function(x){return[].concat.apply([],x)}};f.setTyped=function(x){x?(f.Buf8=Uint8Array,f.Buf16=Uint16Array,f.Buf32=Int32Array,f.assign(f,o)):(f.Buf8=Array,f.Buf16=Array,f.Buf32=Array,f.assign(f,m))},f.setTyped(i)},{}],42:[function(l,u,f){var i=l("./common"),o=!0,m=!0;try{String.fromCharCode.apply(null,[0])}catch{o=!1}try{String.fromCharCode.apply(null,new Uint8Array(1))}catch{m=!1}for(var x=new i.Buf8(256),d=0;d<256;d++)x[d]=252<=d?6:248<=d?5:240<=d?4:224<=d?3:192<=d?2:1;function j(y,_){if(_<65537&&(y.subarray&&m||!y.subarray&&o))return String.fromCharCode.apply(null,i.shrinkBuf(y,_));for(var b="",D=0;D<_;D++)b+=String.fromCharCode(y[D]);return b}x[254]=x[254]=1,f.string2buf=function(y){var _,b,D,w,N,S=y.length,O=0;for(w=0;w<S;w++)(64512&(b=y.charCodeAt(w)))==55296&&w+1<S&&(64512&(D=y.charCodeAt(w+1)))==56320&&(b=65536+(b-55296<<10)+(D-56320),w++),O+=b<128?1:b<2048?2:b<65536?3:4;for(_=new i.Buf8(O),w=N=0;N<O;w++)(64512&(b=y.charCodeAt(w)))==55296&&w+1<S&&(64512&(D=y.charCodeAt(w+1)))==56320&&(b=65536+(b-55296<<10)+(D-56320),w++),b<128?_[N++]=b:(b<2048?_[N++]=192|b>>>6:(b<65536?_[N++]=224|b>>>12:(_[N++]=240|b>>>18,_[N++]=128|b>>>12&63),_[N++]=128|b>>>6&63),_[N++]=128|63&b);return _},f.buf2binstring=function(y){return j(y,y.length)},f.binstring2buf=function(y){for(var _=new i.Buf8(y.length),b=0,D=_.length;b<D;b++)_[b]=y.charCodeAt(b);return _},f.buf2string=function(y,_){var b,D,w,N,S=_||y.length,O=new Array(2*S);for(b=D=0;b<S;)if((w=y[b++])<128)O[D++]=w;else if(4<(N=x[w]))O[D++]=65533,b+=N-1;else{for(w&=N===2?31:N===3?15:7;1<N&&b<S;)w=w<<6|63&y[b++],N--;1<N?O[D++]=65533:w<65536?O[D++]=w:(w-=65536,O[D++]=55296|w>>10&1023,O[D++]=56320|1023&w)}return j(O,D)},f.utf8border=function(y,_){var b;for((_=_||y.length)>y.length&&(_=y.length),b=_-1;0<=b&&(192&y[b])==128;)b--;return b<0||b===0?_:b+x[y[b]]>_?b:_}},{"./common":41}],43:[function(l,u,f){u.exports=function(i,o,m,x){for(var d=65535&i|0,j=i>>>16&65535|0,y=0;m!==0;){for(m-=y=2e3<m?2e3:m;j=j+(d=d+o[x++]|0)|0,--y;);d%=65521,j%=65521}return d|j<<16|0}},{}],44:[function(l,u,f){u.exports={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_ERRNO:-1,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_BUF_ERROR:-5,Z_NO_COMPRESSION:0,Z_BEST_SPEED:1,Z_BEST_COMPRESSION:9,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_BINARY:0,Z_TEXT:1,Z_UNKNOWN:2,Z_DEFLATED:8}},{}],45:[function(l,u,f){var i=function(){for(var o,m=[],x=0;x<256;x++){o=x;for(var d=0;d<8;d++)o=1&o?3988292384^o>>>1:o>>>1;m[x]=o}return m}();u.exports=function(o,m,x,d){var j=i,y=d+x;o^=-1;for(var _=d;_<y;_++)o=o>>>8^j[255&(o^m[_])];return-1^o}},{}],46:[function(l,u,f){var i,o=l("../utils/common"),m=l("./trees"),x=l("./adler32"),d=l("./crc32"),j=l("./messages"),y=0,_=4,b=0,D=-2,w=-1,N=4,S=2,O=8,C=9,M=286,R=30,$=19,X=2*M+1,J=15,Y=3,H=258,K=H+Y+1,q=42,W=113,A=1,B=2,z=3,Q=4;function ue(k,xe){return k.msg=j[xe],xe}function ee(k){return(k<<1)-(4<k?9:0)}function V(k){for(var xe=k.length;0<=--xe;)k[xe]=0}function E(k){var xe=k.state,he=xe.pending;he>k.avail_out&&(he=k.avail_out),he!==0&&(o.arraySet(k.output,xe.pending_buf,xe.pending_out,he,k.next_out),k.next_out+=he,xe.pending_out+=he,k.total_out+=he,k.avail_out-=he,xe.pending-=he,xe.pending===0&&(xe.pending_out=0))}function L(k,xe){m._tr_flush_block(k,0<=k.block_start?k.block_start:-1,k.strstart-k.block_start,xe),k.block_start=k.strstart,E(k.strm)}function se(k,xe){k.pending_buf[k.pending++]=xe}function ie(k,xe){k.pending_buf[k.pending++]=xe>>>8&255,k.pending_buf[k.pending++]=255&xe}function oe(k,xe){var he,Z,P=k.max_chain_length,ae=k.strstart,fe=k.prev_length,Ae=k.nice_match,de=k.strstart>k.w_size-K?k.strstart-(k.w_size-K):0,Ue=k.window,Le=k.w_mask,_e=k.prev,pe=k.strstart+H,Be=Ue[ae+fe-1],He=Ue[ae+fe];k.prev_length>=k.good_match&&(P>>=2),Ae>k.lookahead&&(Ae=k.lookahead);do if(Ue[(he=xe)+fe]===He&&Ue[he+fe-1]===Be&&Ue[he]===Ue[ae]&&Ue[++he]===Ue[ae+1]){ae+=2,he++;do;while(Ue[++ae]===Ue[++he]&&Ue[++ae]===Ue[++he]&&Ue[++ae]===Ue[++he]&&Ue[++ae]===Ue[++he]&&Ue[++ae]===Ue[++he]&&Ue[++ae]===Ue[++he]&&Ue[++ae]===Ue[++he]&&Ue[++ae]===Ue[++he]&&ae<pe);if(Z=H-(pe-ae),ae=pe-H,fe<Z){if(k.match_start=xe,Ae<=(fe=Z))break;Be=Ue[ae+fe-1],He=Ue[ae+fe]}}while((xe=_e[xe&Le])>de&&--P!=0);return fe<=k.lookahead?fe:k.lookahead}function Ne(k){var xe,he,Z,P,ae,fe,Ae,de,Ue,Le,_e=k.w_size;do{if(P=k.window_size-k.lookahead-k.strstart,k.strstart>=_e+(_e-K)){for(o.arraySet(k.window,k.window,_e,_e,0),k.match_start-=_e,k.strstart-=_e,k.block_start-=_e,xe=he=k.hash_size;Z=k.head[--xe],k.head[xe]=_e<=Z?Z-_e:0,--he;);for(xe=he=_e;Z=k.prev[--xe],k.prev[xe]=_e<=Z?Z-_e:0,--he;);P+=_e}if(k.strm.avail_in===0)break;if(fe=k.strm,Ae=k.window,de=k.strstart+k.lookahead,Ue=P,Le=void 0,Le=fe.avail_in,Ue<Le&&(Le=Ue),he=Le===0?0:(fe.avail_in-=Le,o.arraySet(Ae,fe.input,fe.next_in,Le,de),fe.state.wrap===1?fe.adler=x(fe.adler,Ae,Le,de):fe.state.wrap===2&&(fe.adler=d(fe.adler,Ae,Le,de)),fe.next_in+=Le,fe.total_in+=Le,Le),k.lookahead+=he,k.lookahead+k.insert>=Y)for(ae=k.strstart-k.insert,k.ins_h=k.window[ae],k.ins_h=(k.ins_h<<k.hash_shift^k.window[ae+1])&k.hash_mask;k.insert&&(k.ins_h=(k.ins_h<<k.hash_shift^k.window[ae+Y-1])&k.hash_mask,k.prev[ae&k.w_mask]=k.head[k.ins_h],k.head[k.ins_h]=ae,ae++,k.insert--,!(k.lookahead+k.insert<Y)););}while(k.lookahead<K&&k.strm.avail_in!==0)}function we(k,xe){for(var he,Z;;){if(k.lookahead<K){if(Ne(k),k.lookahead<K&&xe===y)return A;if(k.lookahead===0)break}if(he=0,k.lookahead>=Y&&(k.ins_h=(k.ins_h<<k.hash_shift^k.window[k.strstart+Y-1])&k.hash_mask,he=k.prev[k.strstart&k.w_mask]=k.head[k.ins_h],k.head[k.ins_h]=k.strstart),he!==0&&k.strstart-he<=k.w_size-K&&(k.match_length=oe(k,he)),k.match_length>=Y)if(Z=m._tr_tally(k,k.strstart-k.match_start,k.match_length-Y),k.lookahead-=k.match_length,k.match_length<=k.max_lazy_match&&k.lookahead>=Y){for(k.match_length--;k.strstart++,k.ins_h=(k.ins_h<<k.hash_shift^k.window[k.strstart+Y-1])&k.hash_mask,he=k.prev[k.strstart&k.w_mask]=k.head[k.ins_h],k.head[k.ins_h]=k.strstart,--k.match_length!=0;);k.strstart++}else k.strstart+=k.match_length,k.match_length=0,k.ins_h=k.window[k.strstart],k.ins_h=(k.ins_h<<k.hash_shift^k.window[k.strstart+1])&k.hash_mask;else Z=m._tr_tally(k,0,k.window[k.strstart]),k.lookahead--,k.strstart++;if(Z&&(L(k,!1),k.strm.avail_out===0))return A}return k.insert=k.strstart<Y-1?k.strstart:Y-1,xe===_?(L(k,!0),k.strm.avail_out===0?z:Q):k.last_lit&&(L(k,!1),k.strm.avail_out===0)?A:B}function je(k,xe){for(var he,Z,P;;){if(k.lookahead<K){if(Ne(k),k.lookahead<K&&xe===y)return A;if(k.lookahead===0)break}if(he=0,k.lookahead>=Y&&(k.ins_h=(k.ins_h<<k.hash_shift^k.window[k.strstart+Y-1])&k.hash_mask,he=k.prev[k.strstart&k.w_mask]=k.head[k.ins_h],k.head[k.ins_h]=k.strstart),k.prev_length=k.match_length,k.prev_match=k.match_start,k.match_length=Y-1,he!==0&&k.prev_length<k.max_lazy_match&&k.strstart-he<=k.w_size-K&&(k.match_length=oe(k,he),k.match_length<=5&&(k.strategy===1||k.match_length===Y&&4096<k.strstart-k.match_start)&&(k.match_length=Y-1)),k.prev_length>=Y&&k.match_length<=k.prev_length){for(P=k.strstart+k.lookahead-Y,Z=m._tr_tally(k,k.strstart-1-k.prev_match,k.prev_length-Y),k.lookahead-=k.prev_length-1,k.prev_length-=2;++k.strstart<=P&&(k.ins_h=(k.ins_h<<k.hash_shift^k.window[k.strstart+Y-1])&k.hash_mask,he=k.prev[k.strstart&k.w_mask]=k.head[k.ins_h],k.head[k.ins_h]=k.strstart),--k.prev_length!=0;);if(k.match_available=0,k.match_length=Y-1,k.strstart++,Z&&(L(k,!1),k.strm.avail_out===0))return A}else if(k.match_available){if((Z=m._tr_tally(k,0,k.window[k.strstart-1]))&&L(k,!1),k.strstart++,k.lookahead--,k.strm.avail_out===0)return A}else k.match_available=1,k.strstart++,k.lookahead--}return k.match_available&&(Z=m._tr_tally(k,0,k.window[k.strstart-1]),k.match_available=0),k.insert=k.strstart<Y-1?k.strstart:Y-1,xe===_?(L(k,!0),k.strm.avail_out===0?z:Q):k.last_lit&&(L(k,!1),k.strm.avail_out===0)?A:B}function ve(k,xe,he,Z,P){this.good_length=k,this.max_lazy=xe,this.nice_length=he,this.max_chain=Z,this.func=P}function Me(){this.strm=null,this.status=0,this.pending_buf=null,this.pending_buf_size=0,this.pending_out=0,this.pending=0,this.wrap=0,this.gzhead=null,this.gzindex=0,this.method=O,this.last_flush=-1,this.w_size=0,this.w_bits=0,this.w_mask=0,this.window=null,this.window_size=0,this.prev=null,this.head=null,this.ins_h=0,this.hash_size=0,this.hash_bits=0,this.hash_mask=0,this.hash_shift=0,this.block_start=0,this.match_length=0,this.prev_match=0,this.match_available=0,this.strstart=0,this.match_start=0,this.lookahead=0,this.prev_length=0,this.max_chain_length=0,this.max_lazy_match=0,this.level=0,this.strategy=0,this.good_match=0,this.nice_match=0,this.dyn_ltree=new o.Buf16(2*X),this.dyn_dtree=new o.Buf16(2*(2*R+1)),this.bl_tree=new o.Buf16(2*(2*$+1)),V(this.dyn_ltree),V(this.dyn_dtree),V(this.bl_tree),this.l_desc=null,this.d_desc=null,this.bl_desc=null,this.bl_count=new o.Buf16(J+1),this.heap=new o.Buf16(2*M+1),V(this.heap),this.heap_len=0,this.heap_max=0,this.depth=new o.Buf16(2*M+1),V(this.depth),this.l_buf=0,this.lit_bufsize=0,this.last_lit=0,this.d_buf=0,this.opt_len=0,this.static_len=0,this.matches=0,this.insert=0,this.bi_buf=0,this.bi_valid=0}function Fe(k){var xe;return k&&k.state?(k.total_in=k.total_out=0,k.data_type=S,(xe=k.state).pending=0,xe.pending_out=0,xe.wrap<0&&(xe.wrap=-xe.wrap),xe.status=xe.wrap?q:W,k.adler=xe.wrap===2?0:1,xe.last_flush=y,m._tr_init(xe),b):ue(k,D)}function Pe(k){var xe=Fe(k);return xe===b&&function(he){he.window_size=2*he.w_size,V(he.head),he.max_lazy_match=i[he.level].max_lazy,he.good_match=i[he.level].good_length,he.nice_match=i[he.level].nice_length,he.max_chain_length=i[he.level].max_chain,he.strstart=0,he.block_start=0,he.lookahead=0,he.insert=0,he.match_length=he.prev_length=Y-1,he.match_available=0,he.ins_h=0}(k.state),xe}function Re(k,xe,he,Z,P,ae){if(!k)return D;var fe=1;if(xe===w&&(xe=6),Z<0?(fe=0,Z=-Z):15<Z&&(fe=2,Z-=16),P<1||C<P||he!==O||Z<8||15<Z||xe<0||9<xe||ae<0||N<ae)return ue(k,D);Z===8&&(Z=9);var Ae=new Me;return(k.state=Ae).strm=k,Ae.wrap=fe,Ae.gzhead=null,Ae.w_bits=Z,Ae.w_size=1<<Ae.w_bits,Ae.w_mask=Ae.w_size-1,Ae.hash_bits=P+7,Ae.hash_size=1<<Ae.hash_bits,Ae.hash_mask=Ae.hash_size-1,Ae.hash_shift=~~((Ae.hash_bits+Y-1)/Y),Ae.window=new o.Buf8(2*Ae.w_size),Ae.head=new o.Buf16(Ae.hash_size),Ae.prev=new o.Buf16(Ae.w_size),Ae.lit_bufsize=1<<P+6,Ae.pending_buf_size=4*Ae.lit_bufsize,Ae.pending_buf=new o.Buf8(Ae.pending_buf_size),Ae.d_buf=1*Ae.lit_bufsize,Ae.l_buf=3*Ae.lit_bufsize,Ae.level=xe,Ae.strategy=ae,Ae.method=he,Pe(k)}i=[new ve(0,0,0,0,function(k,xe){var he=65535;for(he>k.pending_buf_size-5&&(he=k.pending_buf_size-5);;){if(k.lookahead<=1){if(Ne(k),k.lookahead===0&&xe===y)return A;if(k.lookahead===0)break}k.strstart+=k.lookahead,k.lookahead=0;var Z=k.block_start+he;if((k.strstart===0||k.strstart>=Z)&&(k.lookahead=k.strstart-Z,k.strstart=Z,L(k,!1),k.strm.avail_out===0)||k.strstart-k.block_start>=k.w_size-K&&(L(k,!1),k.strm.avail_out===0))return A}return k.insert=0,xe===_?(L(k,!0),k.strm.avail_out===0?z:Q):(k.strstart>k.block_start&&(L(k,!1),k.strm.avail_out),A)}),new ve(4,4,8,4,we),new ve(4,5,16,8,we),new ve(4,6,32,32,we),new ve(4,4,16,16,je),new ve(8,16,32,32,je),new ve(8,16,128,128,je),new ve(8,32,128,256,je),new ve(32,128,258,1024,je),new ve(32,258,258,4096,je)],f.deflateInit=function(k,xe){return Re(k,xe,O,15,8,0)},f.deflateInit2=Re,f.deflateReset=Pe,f.deflateResetKeep=Fe,f.deflateSetHeader=function(k,xe){return k&&k.state?k.state.wrap!==2?D:(k.state.gzhead=xe,b):D},f.deflate=function(k,xe){var he,Z,P,ae;if(!k||!k.state||5<xe||xe<0)return k?ue(k,D):D;if(Z=k.state,!k.output||!k.input&&k.avail_in!==0||Z.status===666&&xe!==_)return ue(k,k.avail_out===0?-5:D);if(Z.strm=k,he=Z.last_flush,Z.last_flush=xe,Z.status===q)if(Z.wrap===2)k.adler=0,se(Z,31),se(Z,139),se(Z,8),Z.gzhead?(se(Z,(Z.gzhead.text?1:0)+(Z.gzhead.hcrc?2:0)+(Z.gzhead.extra?4:0)+(Z.gzhead.name?8:0)+(Z.gzhead.comment?16:0)),se(Z,255&Z.gzhead.time),se(Z,Z.gzhead.time>>8&255),se(Z,Z.gzhead.time>>16&255),se(Z,Z.gzhead.time>>24&255),se(Z,Z.level===9?2:2<=Z.strategy||Z.level<2?4:0),se(Z,255&Z.gzhead.os),Z.gzhead.extra&&Z.gzhead.extra.length&&(se(Z,255&Z.gzhead.extra.length),se(Z,Z.gzhead.extra.length>>8&255)),Z.gzhead.hcrc&&(k.adler=d(k.adler,Z.pending_buf,Z.pending,0)),Z.gzindex=0,Z.status=69):(se(Z,0),se(Z,0),se(Z,0),se(Z,0),se(Z,0),se(Z,Z.level===9?2:2<=Z.strategy||Z.level<2?4:0),se(Z,3),Z.status=W);else{var fe=O+(Z.w_bits-8<<4)<<8;fe|=(2<=Z.strategy||Z.level<2?0:Z.level<6?1:Z.level===6?2:3)<<6,Z.strstart!==0&&(fe|=32),fe+=31-fe%31,Z.status=W,ie(Z,fe),Z.strstart!==0&&(ie(Z,k.adler>>>16),ie(Z,65535&k.adler)),k.adler=1}if(Z.status===69)if(Z.gzhead.extra){for(P=Z.pending;Z.gzindex<(65535&Z.gzhead.extra.length)&&(Z.pending!==Z.pending_buf_size||(Z.gzhead.hcrc&&Z.pending>P&&(k.adler=d(k.adler,Z.pending_buf,Z.pending-P,P)),E(k),P=Z.pending,Z.pending!==Z.pending_buf_size));)se(Z,255&Z.gzhead.extra[Z.gzindex]),Z.gzindex++;Z.gzhead.hcrc&&Z.pending>P&&(k.adler=d(k.adler,Z.pending_buf,Z.pending-P,P)),Z.gzindex===Z.gzhead.extra.length&&(Z.gzindex=0,Z.status=73)}else Z.status=73;if(Z.status===73)if(Z.gzhead.name){P=Z.pending;do{if(Z.pending===Z.pending_buf_size&&(Z.gzhead.hcrc&&Z.pending>P&&(k.adler=d(k.adler,Z.pending_buf,Z.pending-P,P)),E(k),P=Z.pending,Z.pending===Z.pending_buf_size)){ae=1;break}ae=Z.gzindex<Z.gzhead.name.length?255&Z.gzhead.name.charCodeAt(Z.gzindex++):0,se(Z,ae)}while(ae!==0);Z.gzhead.hcrc&&Z.pending>P&&(k.adler=d(k.adler,Z.pending_buf,Z.pending-P,P)),ae===0&&(Z.gzindex=0,Z.status=91)}else Z.status=91;if(Z.status===91)if(Z.gzhead.comment){P=Z.pending;do{if(Z.pending===Z.pending_buf_size&&(Z.gzhead.hcrc&&Z.pending>P&&(k.adler=d(k.adler,Z.pending_buf,Z.pending-P,P)),E(k),P=Z.pending,Z.pending===Z.pending_buf_size)){ae=1;break}ae=Z.gzindex<Z.gzhead.comment.length?255&Z.gzhead.comment.charCodeAt(Z.gzindex++):0,se(Z,ae)}while(ae!==0);Z.gzhead.hcrc&&Z.pending>P&&(k.adler=d(k.adler,Z.pending_buf,Z.pending-P,P)),ae===0&&(Z.status=103)}else Z.status=103;if(Z.status===103&&(Z.gzhead.hcrc?(Z.pending+2>Z.pending_buf_size&&E(k),Z.pending+2<=Z.pending_buf_size&&(se(Z,255&k.adler),se(Z,k.adler>>8&255),k.adler=0,Z.status=W)):Z.status=W),Z.pending!==0){if(E(k),k.avail_out===0)return Z.last_flush=-1,b}else if(k.avail_in===0&&ee(xe)<=ee(he)&&xe!==_)return ue(k,-5);if(Z.status===666&&k.avail_in!==0)return ue(k,-5);if(k.avail_in!==0||Z.lookahead!==0||xe!==y&&Z.status!==666){var Ae=Z.strategy===2?function(de,Ue){for(var Le;;){if(de.lookahead===0&&(Ne(de),de.lookahead===0)){if(Ue===y)return A;break}if(de.match_length=0,Le=m._tr_tally(de,0,de.window[de.strstart]),de.lookahead--,de.strstart++,Le&&(L(de,!1),de.strm.avail_out===0))return A}return de.insert=0,Ue===_?(L(de,!0),de.strm.avail_out===0?z:Q):de.last_lit&&(L(de,!1),de.strm.avail_out===0)?A:B}(Z,xe):Z.strategy===3?function(de,Ue){for(var Le,_e,pe,Be,He=de.window;;){if(de.lookahead<=H){if(Ne(de),de.lookahead<=H&&Ue===y)return A;if(de.lookahead===0)break}if(de.match_length=0,de.lookahead>=Y&&0<de.strstart&&(_e=He[pe=de.strstart-1])===He[++pe]&&_e===He[++pe]&&_e===He[++pe]){Be=de.strstart+H;do;while(_e===He[++pe]&&_e===He[++pe]&&_e===He[++pe]&&_e===He[++pe]&&_e===He[++pe]&&_e===He[++pe]&&_e===He[++pe]&&_e===He[++pe]&&pe<Be);de.match_length=H-(Be-pe),de.match_length>de.lookahead&&(de.match_length=de.lookahead)}if(de.match_length>=Y?(Le=m._tr_tally(de,1,de.match_length-Y),de.lookahead-=de.match_length,de.strstart+=de.match_length,de.match_length=0):(Le=m._tr_tally(de,0,de.window[de.strstart]),de.lookahead--,de.strstart++),Le&&(L(de,!1),de.strm.avail_out===0))return A}return de.insert=0,Ue===_?(L(de,!0),de.strm.avail_out===0?z:Q):de.last_lit&&(L(de,!1),de.strm.avail_out===0)?A:B}(Z,xe):i[Z.level].func(Z,xe);if(Ae!==z&&Ae!==Q||(Z.status=666),Ae===A||Ae===z)return k.avail_out===0&&(Z.last_flush=-1),b;if(Ae===B&&(xe===1?m._tr_align(Z):xe!==5&&(m._tr_stored_block(Z,0,0,!1),xe===3&&(V(Z.head),Z.lookahead===0&&(Z.strstart=0,Z.block_start=0,Z.insert=0))),E(k),k.avail_out===0))return Z.last_flush=-1,b}return xe!==_?b:Z.wrap<=0?1:(Z.wrap===2?(se(Z,255&k.adler),se(Z,k.adler>>8&255),se(Z,k.adler>>16&255),se(Z,k.adler>>24&255),se(Z,255&k.total_in),se(Z,k.total_in>>8&255),se(Z,k.total_in>>16&255),se(Z,k.total_in>>24&255)):(ie(Z,k.adler>>>16),ie(Z,65535&k.adler)),E(k),0<Z.wrap&&(Z.wrap=-Z.wrap),Z.pending!==0?b:1)},f.deflateEnd=function(k){var xe;return k&&k.state?(xe=k.state.status)!==q&&xe!==69&&xe!==73&&xe!==91&&xe!==103&&xe!==W&&xe!==666?ue(k,D):(k.state=null,xe===W?ue(k,-3):b):D},f.deflateSetDictionary=function(k,xe){var he,Z,P,ae,fe,Ae,de,Ue,Le=xe.length;if(!k||!k.state||(ae=(he=k.state).wrap)===2||ae===1&&he.status!==q||he.lookahead)return D;for(ae===1&&(k.adler=x(k.adler,xe,Le,0)),he.wrap=0,Le>=he.w_size&&(ae===0&&(V(he.head),he.strstart=0,he.block_start=0,he.insert=0),Ue=new o.Buf8(he.w_size),o.arraySet(Ue,xe,Le-he.w_size,he.w_size,0),xe=Ue,Le=he.w_size),fe=k.avail_in,Ae=k.next_in,de=k.input,k.avail_in=Le,k.next_in=0,k.input=xe,Ne(he);he.lookahead>=Y;){for(Z=he.strstart,P=he.lookahead-(Y-1);he.ins_h=(he.ins_h<<he.hash_shift^he.window[Z+Y-1])&he.hash_mask,he.prev[Z&he.w_mask]=he.head[he.ins_h],he.head[he.ins_h]=Z,Z++,--P;);he.strstart=Z,he.lookahead=Y-1,Ne(he)}return he.strstart+=he.lookahead,he.block_start=he.strstart,he.insert=he.lookahead,he.lookahead=0,he.match_length=he.prev_length=Y-1,he.match_available=0,k.next_in=Ae,k.input=de,k.avail_in=fe,he.wrap=ae,b},f.deflateInfo="pako deflate (from Nodeca project)"},{"../utils/common":41,"./adler32":43,"./crc32":45,"./messages":51,"./trees":52}],47:[function(l,u,f){u.exports=function(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name="",this.comment="",this.hcrc=0,this.done=!1}},{}],48:[function(l,u,f){u.exports=function(i,o){var m,x,d,j,y,_,b,D,w,N,S,O,C,M,R,$,X,J,Y,H,K,q,W,A,B;m=i.state,x=i.next_in,A=i.input,d=x+(i.avail_in-5),j=i.next_out,B=i.output,y=j-(o-i.avail_out),_=j+(i.avail_out-257),b=m.dmax,D=m.wsize,w=m.whave,N=m.wnext,S=m.window,O=m.hold,C=m.bits,M=m.lencode,R=m.distcode,$=(1<<m.lenbits)-1,X=(1<<m.distbits)-1;e:do{C<15&&(O+=A[x++]<<C,C+=8,O+=A[x++]<<C,C+=8),J=M[O&$];t:for(;;){if(O>>>=Y=J>>>24,C-=Y,(Y=J>>>16&255)===0)B[j++]=65535&J;else{if(!(16&Y)){if((64&Y)==0){J=M[(65535&J)+(O&(1<<Y)-1)];continue t}if(32&Y){m.mode=12;break e}i.msg="invalid literal/length code",m.mode=30;break e}H=65535&J,(Y&=15)&&(C<Y&&(O+=A[x++]<<C,C+=8),H+=O&(1<<Y)-1,O>>>=Y,C-=Y),C<15&&(O+=A[x++]<<C,C+=8,O+=A[x++]<<C,C+=8),J=R[O&X];n:for(;;){if(O>>>=Y=J>>>24,C-=Y,!(16&(Y=J>>>16&255))){if((64&Y)==0){J=R[(65535&J)+(O&(1<<Y)-1)];continue n}i.msg="invalid distance code",m.mode=30;break e}if(K=65535&J,C<(Y&=15)&&(O+=A[x++]<<C,(C+=8)<Y&&(O+=A[x++]<<C,C+=8)),b<(K+=O&(1<<Y)-1)){i.msg="invalid distance too far back",m.mode=30;break e}if(O>>>=Y,C-=Y,(Y=j-y)<K){if(w<(Y=K-Y)&&m.sane){i.msg="invalid distance too far back",m.mode=30;break e}if(W=S,(q=0)===N){if(q+=D-Y,Y<H){for(H-=Y;B[j++]=S[q++],--Y;);q=j-K,W=B}}else if(N<Y){if(q+=D+N-Y,(Y-=N)<H){for(H-=Y;B[j++]=S[q++],--Y;);if(q=0,N<H){for(H-=Y=N;B[j++]=S[q++],--Y;);q=j-K,W=B}}}else if(q+=N-Y,Y<H){for(H-=Y;B[j++]=S[q++],--Y;);q=j-K,W=B}for(;2<H;)B[j++]=W[q++],B[j++]=W[q++],B[j++]=W[q++],H-=3;H&&(B[j++]=W[q++],1<H&&(B[j++]=W[q++]))}else{for(q=j-K;B[j++]=B[q++],B[j++]=B[q++],B[j++]=B[q++],2<(H-=3););H&&(B[j++]=B[q++],1<H&&(B[j++]=B[q++]))}break}}break}}while(x<d&&j<_);x-=H=C>>3,O&=(1<<(C-=H<<3))-1,i.next_in=x,i.next_out=j,i.avail_in=x<d?d-x+5:5-(x-d),i.avail_out=j<_?_-j+257:257-(j-_),m.hold=O,m.bits=C}},{}],49:[function(l,u,f){var i=l("../utils/common"),o=l("./adler32"),m=l("./crc32"),x=l("./inffast"),d=l("./inftrees"),j=1,y=2,_=0,b=-2,D=1,w=852,N=592;function S(q){return(q>>>24&255)+(q>>>8&65280)+((65280&q)<<8)+((255&q)<<24)}function O(){this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new i.Buf16(320),this.work=new i.Buf16(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}function C(q){var W;return q&&q.state?(W=q.state,q.total_in=q.total_out=W.total=0,q.msg="",W.wrap&&(q.adler=1&W.wrap),W.mode=D,W.last=0,W.havedict=0,W.dmax=32768,W.head=null,W.hold=0,W.bits=0,W.lencode=W.lendyn=new i.Buf32(w),W.distcode=W.distdyn=new i.Buf32(N),W.sane=1,W.back=-1,_):b}function M(q){var W;return q&&q.state?((W=q.state).wsize=0,W.whave=0,W.wnext=0,C(q)):b}function R(q,W){var A,B;return q&&q.state?(B=q.state,W<0?(A=0,W=-W):(A=1+(W>>4),W<48&&(W&=15)),W&&(W<8||15<W)?b:(B.window!==null&&B.wbits!==W&&(B.window=null),B.wrap=A,B.wbits=W,M(q))):b}function $(q,W){var A,B;return q?(B=new O,(q.state=B).window=null,(A=R(q,W))!==_&&(q.state=null),A):b}var X,J,Y=!0;function H(q){if(Y){var W;for(X=new i.Buf32(512),J=new i.Buf32(32),W=0;W<144;)q.lens[W++]=8;for(;W<256;)q.lens[W++]=9;for(;W<280;)q.lens[W++]=7;for(;W<288;)q.lens[W++]=8;for(d(j,q.lens,0,288,X,0,q.work,{bits:9}),W=0;W<32;)q.lens[W++]=5;d(y,q.lens,0,32,J,0,q.work,{bits:5}),Y=!1}q.lencode=X,q.lenbits=9,q.distcode=J,q.distbits=5}function K(q,W,A,B){var z,Q=q.state;return Q.window===null&&(Q.wsize=1<<Q.wbits,Q.wnext=0,Q.whave=0,Q.window=new i.Buf8(Q.wsize)),B>=Q.wsize?(i.arraySet(Q.window,W,A-Q.wsize,Q.wsize,0),Q.wnext=0,Q.whave=Q.wsize):(B<(z=Q.wsize-Q.wnext)&&(z=B),i.arraySet(Q.window,W,A-B,z,Q.wnext),(B-=z)?(i.arraySet(Q.window,W,A-B,B,0),Q.wnext=B,Q.whave=Q.wsize):(Q.wnext+=z,Q.wnext===Q.wsize&&(Q.wnext=0),Q.whave<Q.wsize&&(Q.whave+=z))),0}f.inflateReset=M,f.inflateReset2=R,f.inflateResetKeep=C,f.inflateInit=function(q){return $(q,15)},f.inflateInit2=$,f.inflate=function(q,W){var A,B,z,Q,ue,ee,V,E,L,se,ie,oe,Ne,we,je,ve,Me,Fe,Pe,Re,k,xe,he,Z,P=0,ae=new i.Buf8(4),fe=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15];if(!q||!q.state||!q.output||!q.input&&q.avail_in!==0)return b;(A=q.state).mode===12&&(A.mode=13),ue=q.next_out,z=q.output,V=q.avail_out,Q=q.next_in,B=q.input,ee=q.avail_in,E=A.hold,L=A.bits,se=ee,ie=V,xe=_;e:for(;;)switch(A.mode){case D:if(A.wrap===0){A.mode=13;break}for(;L<16;){if(ee===0)break e;ee--,E+=B[Q++]<<L,L+=8}if(2&A.wrap&&E===35615){ae[A.check=0]=255&E,ae[1]=E>>>8&255,A.check=m(A.check,ae,2,0),L=E=0,A.mode=2;break}if(A.flags=0,A.head&&(A.head.done=!1),!(1&A.wrap)||(((255&E)<<8)+(E>>8))%31){q.msg="incorrect header check",A.mode=30;break}if((15&E)!=8){q.msg="unknown compression method",A.mode=30;break}if(L-=4,k=8+(15&(E>>>=4)),A.wbits===0)A.wbits=k;else if(k>A.wbits){q.msg="invalid window size",A.mode=30;break}A.dmax=1<<k,q.adler=A.check=1,A.mode=512&E?10:12,L=E=0;break;case 2:for(;L<16;){if(ee===0)break e;ee--,E+=B[Q++]<<L,L+=8}if(A.flags=E,(255&A.flags)!=8){q.msg="unknown compression method",A.mode=30;break}if(57344&A.flags){q.msg="unknown header flags set",A.mode=30;break}A.head&&(A.head.text=E>>8&1),512&A.flags&&(ae[0]=255&E,ae[1]=E>>>8&255,A.check=m(A.check,ae,2,0)),L=E=0,A.mode=3;case 3:for(;L<32;){if(ee===0)break e;ee--,E+=B[Q++]<<L,L+=8}A.head&&(A.head.time=E),512&A.flags&&(ae[0]=255&E,ae[1]=E>>>8&255,ae[2]=E>>>16&255,ae[3]=E>>>24&255,A.check=m(A.check,ae,4,0)),L=E=0,A.mode=4;case 4:for(;L<16;){if(ee===0)break e;ee--,E+=B[Q++]<<L,L+=8}A.head&&(A.head.xflags=255&E,A.head.os=E>>8),512&A.flags&&(ae[0]=255&E,ae[1]=E>>>8&255,A.check=m(A.check,ae,2,0)),L=E=0,A.mode=5;case 5:if(1024&A.flags){for(;L<16;){if(ee===0)break e;ee--,E+=B[Q++]<<L,L+=8}A.length=E,A.head&&(A.head.extra_len=E),512&A.flags&&(ae[0]=255&E,ae[1]=E>>>8&255,A.check=m(A.check,ae,2,0)),L=E=0}else A.head&&(A.head.extra=null);A.mode=6;case 6:if(1024&A.flags&&(ee<(oe=A.length)&&(oe=ee),oe&&(A.head&&(k=A.head.extra_len-A.length,A.head.extra||(A.head.extra=new Array(A.head.extra_len)),i.arraySet(A.head.extra,B,Q,oe,k)),512&A.flags&&(A.check=m(A.check,B,oe,Q)),ee-=oe,Q+=oe,A.length-=oe),A.length))break e;A.length=0,A.mode=7;case 7:if(2048&A.flags){if(ee===0)break e;for(oe=0;k=B[Q+oe++],A.head&&k&&A.length<65536&&(A.head.name+=String.fromCharCode(k)),k&&oe<ee;);if(512&A.flags&&(A.check=m(A.check,B,oe,Q)),ee-=oe,Q+=oe,k)break e}else A.head&&(A.head.name=null);A.length=0,A.mode=8;case 8:if(4096&A.flags){if(ee===0)break e;for(oe=0;k=B[Q+oe++],A.head&&k&&A.length<65536&&(A.head.comment+=String.fromCharCode(k)),k&&oe<ee;);if(512&A.flags&&(A.check=m(A.check,B,oe,Q)),ee-=oe,Q+=oe,k)break e}else A.head&&(A.head.comment=null);A.mode=9;case 9:if(512&A.flags){for(;L<16;){if(ee===0)break e;ee--,E+=B[Q++]<<L,L+=8}if(E!==(65535&A.check)){q.msg="header crc mismatch",A.mode=30;break}L=E=0}A.head&&(A.head.hcrc=A.flags>>9&1,A.head.done=!0),q.adler=A.check=0,A.mode=12;break;case 10:for(;L<32;){if(ee===0)break e;ee--,E+=B[Q++]<<L,L+=8}q.adler=A.check=S(E),L=E=0,A.mode=11;case 11:if(A.havedict===0)return q.next_out=ue,q.avail_out=V,q.next_in=Q,q.avail_in=ee,A.hold=E,A.bits=L,2;q.adler=A.check=1,A.mode=12;case 12:if(W===5||W===6)break e;case 13:if(A.last){E>>>=7&L,L-=7&L,A.mode=27;break}for(;L<3;){if(ee===0)break e;ee--,E+=B[Q++]<<L,L+=8}switch(A.last=1&E,L-=1,3&(E>>>=1)){case 0:A.mode=14;break;case 1:if(H(A),A.mode=20,W!==6)break;E>>>=2,L-=2;break e;case 2:A.mode=17;break;case 3:q.msg="invalid block type",A.mode=30}E>>>=2,L-=2;break;case 14:for(E>>>=7&L,L-=7&L;L<32;){if(ee===0)break e;ee--,E+=B[Q++]<<L,L+=8}if((65535&E)!=(E>>>16^65535)){q.msg="invalid stored block lengths",A.mode=30;break}if(A.length=65535&E,L=E=0,A.mode=15,W===6)break e;case 15:A.mode=16;case 16:if(oe=A.length){if(ee<oe&&(oe=ee),V<oe&&(oe=V),oe===0)break e;i.arraySet(z,B,Q,oe,ue),ee-=oe,Q+=oe,V-=oe,ue+=oe,A.length-=oe;break}A.mode=12;break;case 17:for(;L<14;){if(ee===0)break e;ee--,E+=B[Q++]<<L,L+=8}if(A.nlen=257+(31&E),E>>>=5,L-=5,A.ndist=1+(31&E),E>>>=5,L-=5,A.ncode=4+(15&E),E>>>=4,L-=4,286<A.nlen||30<A.ndist){q.msg="too many length or distance symbols",A.mode=30;break}A.have=0,A.mode=18;case 18:for(;A.have<A.ncode;){for(;L<3;){if(ee===0)break e;ee--,E+=B[Q++]<<L,L+=8}A.lens[fe[A.have++]]=7&E,E>>>=3,L-=3}for(;A.have<19;)A.lens[fe[A.have++]]=0;if(A.lencode=A.lendyn,A.lenbits=7,he={bits:A.lenbits},xe=d(0,A.lens,0,19,A.lencode,0,A.work,he),A.lenbits=he.bits,xe){q.msg="invalid code lengths set",A.mode=30;break}A.have=0,A.mode=19;case 19:for(;A.have<A.nlen+A.ndist;){for(;ve=(P=A.lencode[E&(1<<A.lenbits)-1])>>>16&255,Me=65535&P,!((je=P>>>24)<=L);){if(ee===0)break e;ee--,E+=B[Q++]<<L,L+=8}if(Me<16)E>>>=je,L-=je,A.lens[A.have++]=Me;else{if(Me===16){for(Z=je+2;L<Z;){if(ee===0)break e;ee--,E+=B[Q++]<<L,L+=8}if(E>>>=je,L-=je,A.have===0){q.msg="invalid bit length repeat",A.mode=30;break}k=A.lens[A.have-1],oe=3+(3&E),E>>>=2,L-=2}else if(Me===17){for(Z=je+3;L<Z;){if(ee===0)break e;ee--,E+=B[Q++]<<L,L+=8}L-=je,k=0,oe=3+(7&(E>>>=je)),E>>>=3,L-=3}else{for(Z=je+7;L<Z;){if(ee===0)break e;ee--,E+=B[Q++]<<L,L+=8}L-=je,k=0,oe=11+(127&(E>>>=je)),E>>>=7,L-=7}if(A.have+oe>A.nlen+A.ndist){q.msg="invalid bit length repeat",A.mode=30;break}for(;oe--;)A.lens[A.have++]=k}}if(A.mode===30)break;if(A.lens[256]===0){q.msg="invalid code -- missing end-of-block",A.mode=30;break}if(A.lenbits=9,he={bits:A.lenbits},xe=d(j,A.lens,0,A.nlen,A.lencode,0,A.work,he),A.lenbits=he.bits,xe){q.msg="invalid literal/lengths set",A.mode=30;break}if(A.distbits=6,A.distcode=A.distdyn,he={bits:A.distbits},xe=d(y,A.lens,A.nlen,A.ndist,A.distcode,0,A.work,he),A.distbits=he.bits,xe){q.msg="invalid distances set",A.mode=30;break}if(A.mode=20,W===6)break e;case 20:A.mode=21;case 21:if(6<=ee&&258<=V){q.next_out=ue,q.avail_out=V,q.next_in=Q,q.avail_in=ee,A.hold=E,A.bits=L,x(q,ie),ue=q.next_out,z=q.output,V=q.avail_out,Q=q.next_in,B=q.input,ee=q.avail_in,E=A.hold,L=A.bits,A.mode===12&&(A.back=-1);break}for(A.back=0;ve=(P=A.lencode[E&(1<<A.lenbits)-1])>>>16&255,Me=65535&P,!((je=P>>>24)<=L);){if(ee===0)break e;ee--,E+=B[Q++]<<L,L+=8}if(ve&&(240&ve)==0){for(Fe=je,Pe=ve,Re=Me;ve=(P=A.lencode[Re+((E&(1<<Fe+Pe)-1)>>Fe)])>>>16&255,Me=65535&P,!(Fe+(je=P>>>24)<=L);){if(ee===0)break e;ee--,E+=B[Q++]<<L,L+=8}E>>>=Fe,L-=Fe,A.back+=Fe}if(E>>>=je,L-=je,A.back+=je,A.length=Me,ve===0){A.mode=26;break}if(32&ve){A.back=-1,A.mode=12;break}if(64&ve){q.msg="invalid literal/length code",A.mode=30;break}A.extra=15&ve,A.mode=22;case 22:if(A.extra){for(Z=A.extra;L<Z;){if(ee===0)break e;ee--,E+=B[Q++]<<L,L+=8}A.length+=E&(1<<A.extra)-1,E>>>=A.extra,L-=A.extra,A.back+=A.extra}A.was=A.length,A.mode=23;case 23:for(;ve=(P=A.distcode[E&(1<<A.distbits)-1])>>>16&255,Me=65535&P,!((je=P>>>24)<=L);){if(ee===0)break e;ee--,E+=B[Q++]<<L,L+=8}if((240&ve)==0){for(Fe=je,Pe=ve,Re=Me;ve=(P=A.distcode[Re+((E&(1<<Fe+Pe)-1)>>Fe)])>>>16&255,Me=65535&P,!(Fe+(je=P>>>24)<=L);){if(ee===0)break e;ee--,E+=B[Q++]<<L,L+=8}E>>>=Fe,L-=Fe,A.back+=Fe}if(E>>>=je,L-=je,A.back+=je,64&ve){q.msg="invalid distance code",A.mode=30;break}A.offset=Me,A.extra=15&ve,A.mode=24;case 24:if(A.extra){for(Z=A.extra;L<Z;){if(ee===0)break e;ee--,E+=B[Q++]<<L,L+=8}A.offset+=E&(1<<A.extra)-1,E>>>=A.extra,L-=A.extra,A.back+=A.extra}if(A.offset>A.dmax){q.msg="invalid distance too far back",A.mode=30;break}A.mode=25;case 25:if(V===0)break e;if(oe=ie-V,A.offset>oe){if((oe=A.offset-oe)>A.whave&&A.sane){q.msg="invalid distance too far back",A.mode=30;break}Ne=oe>A.wnext?(oe-=A.wnext,A.wsize-oe):A.wnext-oe,oe>A.length&&(oe=A.length),we=A.window}else we=z,Ne=ue-A.offset,oe=A.length;for(V<oe&&(oe=V),V-=oe,A.length-=oe;z[ue++]=we[Ne++],--oe;);A.length===0&&(A.mode=21);break;case 26:if(V===0)break e;z[ue++]=A.length,V--,A.mode=21;break;case 27:if(A.wrap){for(;L<32;){if(ee===0)break e;ee--,E|=B[Q++]<<L,L+=8}if(ie-=V,q.total_out+=ie,A.total+=ie,ie&&(q.adler=A.check=A.flags?m(A.check,z,ie,ue-ie):o(A.check,z,ie,ue-ie)),ie=V,(A.flags?E:S(E))!==A.check){q.msg="incorrect data check",A.mode=30;break}L=E=0}A.mode=28;case 28:if(A.wrap&&A.flags){for(;L<32;){if(ee===0)break e;ee--,E+=B[Q++]<<L,L+=8}if(E!==(4294967295&A.total)){q.msg="incorrect length check",A.mode=30;break}L=E=0}A.mode=29;case 29:xe=1;break e;case 30:xe=-3;break e;case 31:return-4;case 32:default:return b}return q.next_out=ue,q.avail_out=V,q.next_in=Q,q.avail_in=ee,A.hold=E,A.bits=L,(A.wsize||ie!==q.avail_out&&A.mode<30&&(A.mode<27||W!==4))&&K(q,q.output,q.next_out,ie-q.avail_out)?(A.mode=31,-4):(se-=q.avail_in,ie-=q.avail_out,q.total_in+=se,q.total_out+=ie,A.total+=ie,A.wrap&&ie&&(q.adler=A.check=A.flags?m(A.check,z,ie,q.next_out-ie):o(A.check,z,ie,q.next_out-ie)),q.data_type=A.bits+(A.last?64:0)+(A.mode===12?128:0)+(A.mode===20||A.mode===15?256:0),(se==0&&ie===0||W===4)&&xe===_&&(xe=-5),xe)},f.inflateEnd=function(q){if(!q||!q.state)return b;var W=q.state;return W.window&&(W.window=null),q.state=null,_},f.inflateGetHeader=function(q,W){var A;return q&&q.state?(2&(A=q.state).wrap)==0?b:((A.head=W).done=!1,_):b},f.inflateSetDictionary=function(q,W){var A,B=W.length;return q&&q.state?(A=q.state).wrap!==0&&A.mode!==11?b:A.mode===11&&o(1,W,B,0)!==A.check?-3:K(q,W,B,B)?(A.mode=31,-4):(A.havedict=1,_):b},f.inflateInfo="pako inflate (from Nodeca project)"},{"../utils/common":41,"./adler32":43,"./crc32":45,"./inffast":48,"./inftrees":50}],50:[function(l,u,f){var i=l("../utils/common"),o=[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0],m=[16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78],x=[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0],d=[16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64];u.exports=function(j,y,_,b,D,w,N,S){var O,C,M,R,$,X,J,Y,H,K=S.bits,q=0,W=0,A=0,B=0,z=0,Q=0,ue=0,ee=0,V=0,E=0,L=null,se=0,ie=new i.Buf16(16),oe=new i.Buf16(16),Ne=null,we=0;for(q=0;q<=15;q++)ie[q]=0;for(W=0;W<b;W++)ie[y[_+W]]++;for(z=K,B=15;1<=B&&ie[B]===0;B--);if(B<z&&(z=B),B===0)return D[w++]=20971520,D[w++]=20971520,S.bits=1,0;for(A=1;A<B&&ie[A]===0;A++);for(z<A&&(z=A),q=ee=1;q<=15;q++)if(ee<<=1,(ee-=ie[q])<0)return-1;if(0<ee&&(j===0||B!==1))return-1;for(oe[1]=0,q=1;q<15;q++)oe[q+1]=oe[q]+ie[q];for(W=0;W<b;W++)y[_+W]!==0&&(N[oe[y[_+W]]++]=W);if(X=j===0?(L=Ne=N,19):j===1?(L=o,se-=257,Ne=m,we-=257,256):(L=x,Ne=d,-1),q=A,$=w,ue=W=E=0,M=-1,R=(V=1<<(Q=z))-1,j===1&&852<V||j===2&&592<V)return 1;for(;;){for(J=q-ue,H=N[W]<X?(Y=0,N[W]):N[W]>X?(Y=Ne[we+N[W]],L[se+N[W]]):(Y=96,0),O=1<<q-ue,A=C=1<<Q;D[$+(E>>ue)+(C-=O)]=J<<24|Y<<16|H|0,C!==0;);for(O=1<<q-1;E&O;)O>>=1;if(O!==0?(E&=O-1,E+=O):E=0,W++,--ie[q]==0){if(q===B)break;q=y[_+N[W]]}if(z<q&&(E&R)!==M){for(ue===0&&(ue=z),$+=A,ee=1<<(Q=q-ue);Q+ue<B&&!((ee-=ie[Q+ue])<=0);)Q++,ee<<=1;if(V+=1<<Q,j===1&&852<V||j===2&&592<V)return 1;D[M=E&R]=z<<24|Q<<16|$-w|0}}return E!==0&&(D[$+E]=q-ue<<24|64<<16|0),S.bits=z,0}},{"../utils/common":41}],51:[function(l,u,f){u.exports={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"}},{}],52:[function(l,u,f){var i=l("../utils/common"),o=0,m=1;function x(P){for(var ae=P.length;0<=--ae;)P[ae]=0}var d=0,j=29,y=256,_=y+1+j,b=30,D=19,w=2*_+1,N=15,S=16,O=7,C=256,M=16,R=17,$=18,X=[0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0],J=[0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13],Y=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7],H=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15],K=new Array(2*(_+2));x(K);var q=new Array(2*b);x(q);var W=new Array(512);x(W);var A=new Array(256);x(A);var B=new Array(j);x(B);var z,Q,ue,ee=new Array(b);function V(P,ae,fe,Ae,de){this.static_tree=P,this.extra_bits=ae,this.extra_base=fe,this.elems=Ae,this.max_length=de,this.has_stree=P&&P.length}function E(P,ae){this.dyn_tree=P,this.max_code=0,this.stat_desc=ae}function L(P){return P<256?W[P]:W[256+(P>>>7)]}function se(P,ae){P.pending_buf[P.pending++]=255&ae,P.pending_buf[P.pending++]=ae>>>8&255}function ie(P,ae,fe){P.bi_valid>S-fe?(P.bi_buf|=ae<<P.bi_valid&65535,se(P,P.bi_buf),P.bi_buf=ae>>S-P.bi_valid,P.bi_valid+=fe-S):(P.bi_buf|=ae<<P.bi_valid&65535,P.bi_valid+=fe)}function oe(P,ae,fe){ie(P,fe[2*ae],fe[2*ae+1])}function Ne(P,ae){for(var fe=0;fe|=1&P,P>>>=1,fe<<=1,0<--ae;);return fe>>>1}function we(P,ae,fe){var Ae,de,Ue=new Array(N+1),Le=0;for(Ae=1;Ae<=N;Ae++)Ue[Ae]=Le=Le+fe[Ae-1]<<1;for(de=0;de<=ae;de++){var _e=P[2*de+1];_e!==0&&(P[2*de]=Ne(Ue[_e]++,_e))}}function je(P){var ae;for(ae=0;ae<_;ae++)P.dyn_ltree[2*ae]=0;for(ae=0;ae<b;ae++)P.dyn_dtree[2*ae]=0;for(ae=0;ae<D;ae++)P.bl_tree[2*ae]=0;P.dyn_ltree[2*C]=1,P.opt_len=P.static_len=0,P.last_lit=P.matches=0}function ve(P){8<P.bi_valid?se(P,P.bi_buf):0<P.bi_valid&&(P.pending_buf[P.pending++]=P.bi_buf),P.bi_buf=0,P.bi_valid=0}function Me(P,ae,fe,Ae){var de=2*ae,Ue=2*fe;return P[de]<P[Ue]||P[de]===P[Ue]&&Ae[ae]<=Ae[fe]}function Fe(P,ae,fe){for(var Ae=P.heap[fe],de=fe<<1;de<=P.heap_len&&(de<P.heap_len&&Me(ae,P.heap[de+1],P.heap[de],P.depth)&&de++,!Me(ae,Ae,P.heap[de],P.depth));)P.heap[fe]=P.heap[de],fe=de,de<<=1;P.heap[fe]=Ae}function Pe(P,ae,fe){var Ae,de,Ue,Le,_e=0;if(P.last_lit!==0)for(;Ae=P.pending_buf[P.d_buf+2*_e]<<8|P.pending_buf[P.d_buf+2*_e+1],de=P.pending_buf[P.l_buf+_e],_e++,Ae===0?oe(P,de,ae):(oe(P,(Ue=A[de])+y+1,ae),(Le=X[Ue])!==0&&ie(P,de-=B[Ue],Le),oe(P,Ue=L(--Ae),fe),(Le=J[Ue])!==0&&ie(P,Ae-=ee[Ue],Le)),_e<P.last_lit;);oe(P,C,ae)}function Re(P,ae){var fe,Ae,de,Ue=ae.dyn_tree,Le=ae.stat_desc.static_tree,_e=ae.stat_desc.has_stree,pe=ae.stat_desc.elems,Be=-1;for(P.heap_len=0,P.heap_max=w,fe=0;fe<pe;fe++)Ue[2*fe]!==0?(P.heap[++P.heap_len]=Be=fe,P.depth[fe]=0):Ue[2*fe+1]=0;for(;P.heap_len<2;)Ue[2*(de=P.heap[++P.heap_len]=Be<2?++Be:0)]=1,P.depth[de]=0,P.opt_len--,_e&&(P.static_len-=Le[2*de+1]);for(ae.max_code=Be,fe=P.heap_len>>1;1<=fe;fe--)Fe(P,Ue,fe);for(de=pe;fe=P.heap[1],P.heap[1]=P.heap[P.heap_len--],Fe(P,Ue,1),Ae=P.heap[1],P.heap[--P.heap_max]=fe,P.heap[--P.heap_max]=Ae,Ue[2*de]=Ue[2*fe]+Ue[2*Ae],P.depth[de]=(P.depth[fe]>=P.depth[Ae]?P.depth[fe]:P.depth[Ae])+1,Ue[2*fe+1]=Ue[2*Ae+1]=de,P.heap[1]=de++,Fe(P,Ue,1),2<=P.heap_len;);P.heap[--P.heap_max]=P.heap[1],function(He,Xe){var qe,Ge,at,Je,xt,Rt,vt=Xe.dyn_tree,Lt=Xe.max_code,it=Xe.stat_desc.static_tree,xs=Xe.stat_desc.has_stree,ya=Xe.stat_desc.extra_bits,ba=Xe.stat_desc.extra_base,gn=Xe.stat_desc.max_length,An=0;for(Je=0;Je<=N;Je++)He.bl_count[Je]=0;for(vt[2*He.heap[He.heap_max]+1]=0,qe=He.heap_max+1;qe<w;qe++)gn<(Je=vt[2*vt[2*(Ge=He.heap[qe])+1]+1]+1)&&(Je=gn,An++),vt[2*Ge+1]=Je,Lt<Ge||(He.bl_count[Je]++,xt=0,ba<=Ge&&(xt=ya[Ge-ba]),Rt=vt[2*Ge],He.opt_len+=Rt*(Je+xt),xs&&(He.static_len+=Rt*(it[2*Ge+1]+xt)));if(An!==0){do{for(Je=gn-1;He.bl_count[Je]===0;)Je--;He.bl_count[Je]--,He.bl_count[Je+1]+=2,He.bl_count[gn]--,An-=2}while(0<An);for(Je=gn;Je!==0;Je--)for(Ge=He.bl_count[Je];Ge!==0;)Lt<(at=He.heap[--qe])||(vt[2*at+1]!==Je&&(He.opt_len+=(Je-vt[2*at+1])*vt[2*at],vt[2*at+1]=Je),Ge--)}}(P,ae),we(Ue,Be,P.bl_count)}function k(P,ae,fe){var Ae,de,Ue=-1,Le=ae[1],_e=0,pe=7,Be=4;for(Le===0&&(pe=138,Be=3),ae[2*(fe+1)+1]=65535,Ae=0;Ae<=fe;Ae++)de=Le,Le=ae[2*(Ae+1)+1],++_e<pe&&de===Le||(_e<Be?P.bl_tree[2*de]+=_e:de!==0?(de!==Ue&&P.bl_tree[2*de]++,P.bl_tree[2*M]++):_e<=10?P.bl_tree[2*R]++:P.bl_tree[2*$]++,Ue=de,Be=(_e=0)===Le?(pe=138,3):de===Le?(pe=6,3):(pe=7,4))}function xe(P,ae,fe){var Ae,de,Ue=-1,Le=ae[1],_e=0,pe=7,Be=4;for(Le===0&&(pe=138,Be=3),Ae=0;Ae<=fe;Ae++)if(de=Le,Le=ae[2*(Ae+1)+1],!(++_e<pe&&de===Le)){if(_e<Be)for(;oe(P,de,P.bl_tree),--_e!=0;);else de!==0?(de!==Ue&&(oe(P,de,P.bl_tree),_e--),oe(P,M,P.bl_tree),ie(P,_e-3,2)):_e<=10?(oe(P,R,P.bl_tree),ie(P,_e-3,3)):(oe(P,$,P.bl_tree),ie(P,_e-11,7));Ue=de,Be=(_e=0)===Le?(pe=138,3):de===Le?(pe=6,3):(pe=7,4)}}x(ee);var he=!1;function Z(P,ae,fe,Ae){ie(P,(d<<1)+(Ae?1:0),3),function(de,Ue,Le,_e){ve(de),se(de,Le),se(de,~Le),i.arraySet(de.pending_buf,de.window,Ue,Le,de.pending),de.pending+=Le}(P,ae,fe)}f._tr_init=function(P){he||(function(){var ae,fe,Ae,de,Ue,Le=new Array(N+1);for(de=Ae=0;de<j-1;de++)for(B[de]=Ae,ae=0;ae<1<<X[de];ae++)A[Ae++]=de;for(A[Ae-1]=de,de=Ue=0;de<16;de++)for(ee[de]=Ue,ae=0;ae<1<<J[de];ae++)W[Ue++]=de;for(Ue>>=7;de<b;de++)for(ee[de]=Ue<<7,ae=0;ae<1<<J[de]-7;ae++)W[256+Ue++]=de;for(fe=0;fe<=N;fe++)Le[fe]=0;for(ae=0;ae<=143;)K[2*ae+1]=8,ae++,Le[8]++;for(;ae<=255;)K[2*ae+1]=9,ae++,Le[9]++;for(;ae<=279;)K[2*ae+1]=7,ae++,Le[7]++;for(;ae<=287;)K[2*ae+1]=8,ae++,Le[8]++;for(we(K,_+1,Le),ae=0;ae<b;ae++)q[2*ae+1]=5,q[2*ae]=Ne(ae,5);z=new V(K,X,y+1,_,N),Q=new V(q,J,0,b,N),ue=new V(new Array(0),Y,0,D,O)}(),he=!0),P.l_desc=new E(P.dyn_ltree,z),P.d_desc=new E(P.dyn_dtree,Q),P.bl_desc=new E(P.bl_tree,ue),P.bi_buf=0,P.bi_valid=0,je(P)},f._tr_stored_block=Z,f._tr_flush_block=function(P,ae,fe,Ae){var de,Ue,Le=0;0<P.level?(P.strm.data_type===2&&(P.strm.data_type=function(_e){var pe,Be=4093624447;for(pe=0;pe<=31;pe++,Be>>>=1)if(1&Be&&_e.dyn_ltree[2*pe]!==0)return o;if(_e.dyn_ltree[18]!==0||_e.dyn_ltree[20]!==0||_e.dyn_ltree[26]!==0)return m;for(pe=32;pe<y;pe++)if(_e.dyn_ltree[2*pe]!==0)return m;return o}(P)),Re(P,P.l_desc),Re(P,P.d_desc),Le=function(_e){var pe;for(k(_e,_e.dyn_ltree,_e.l_desc.max_code),k(_e,_e.dyn_dtree,_e.d_desc.max_code),Re(_e,_e.bl_desc),pe=D-1;3<=pe&&_e.bl_tree[2*H[pe]+1]===0;pe--);return _e.opt_len+=3*(pe+1)+5+5+4,pe}(P),de=P.opt_len+3+7>>>3,(Ue=P.static_len+3+7>>>3)<=de&&(de=Ue)):de=Ue=fe+5,fe+4<=de&&ae!==-1?Z(P,ae,fe,Ae):P.strategy===4||Ue===de?(ie(P,2+(Ae?1:0),3),Pe(P,K,q)):(ie(P,4+(Ae?1:0),3),function(_e,pe,Be,He){var Xe;for(ie(_e,pe-257,5),ie(_e,Be-1,5),ie(_e,He-4,4),Xe=0;Xe<He;Xe++)ie(_e,_e.bl_tree[2*H[Xe]+1],3);xe(_e,_e.dyn_ltree,pe-1),xe(_e,_e.dyn_dtree,Be-1)}(P,P.l_desc.max_code+1,P.d_desc.max_code+1,Le+1),Pe(P,P.dyn_ltree,P.dyn_dtree)),je(P),Ae&&ve(P)},f._tr_tally=function(P,ae,fe){return P.pending_buf[P.d_buf+2*P.last_lit]=ae>>>8&255,P.pending_buf[P.d_buf+2*P.last_lit+1]=255&ae,P.pending_buf[P.l_buf+P.last_lit]=255&fe,P.last_lit++,ae===0?P.dyn_ltree[2*fe]++:(P.matches++,ae--,P.dyn_ltree[2*(A[fe]+y+1)]++,P.dyn_dtree[2*L(ae)]++),P.last_lit===P.lit_bufsize-1},f._tr_align=function(P){ie(P,2,3),oe(P,C,K),function(ae){ae.bi_valid===16?(se(ae,ae.bi_buf),ae.bi_buf=0,ae.bi_valid=0):8<=ae.bi_valid&&(ae.pending_buf[ae.pending++]=255&ae.bi_buf,ae.bi_buf>>=8,ae.bi_valid-=8)}(P)}},{"../utils/common":41}],53:[function(l,u,f){u.exports=function(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.msg="",this.state=null,this.data_type=2,this.adler=0}},{}],54:[function(l,u,f){(function(i){(function(o,m){if(!o.setImmediate){var x,d,j,y,_=1,b={},D=!1,w=o.document,N=Object.getPrototypeOf&&Object.getPrototypeOf(o);N=N&&N.setTimeout?N:o,x={}.toString.call(o.process)==="[object process]"?function(M){process.nextTick(function(){O(M)})}:function(){if(o.postMessage&&!o.importScripts){var M=!0,R=o.onmessage;return o.onmessage=function(){M=!1},o.postMessage("","*"),o.onmessage=R,M}}()?(y="setImmediate$"+Math.random()+"$",o.addEventListener?o.addEventListener("message",C,!1):o.attachEvent("onmessage",C),function(M){o.postMessage(y+M,"*")}):o.MessageChannel?((j=new MessageChannel).port1.onmessage=function(M){O(M.data)},function(M){j.port2.postMessage(M)}):w&&"onreadystatechange"in w.createElement("script")?(d=w.documentElement,function(M){var R=w.createElement("script");R.onreadystatechange=function(){O(M),R.onreadystatechange=null,d.removeChild(R),R=null},d.appendChild(R)}):function(M){setTimeout(O,0,M)},N.setImmediate=function(M){typeof M!="function"&&(M=new Function(""+M));for(var R=new Array(arguments.length-1),$=0;$<R.length;$++)R[$]=arguments[$+1];var X={callback:M,args:R};return b[_]=X,x(_),_++},N.clearImmediate=S}function S(M){delete b[M]}function O(M){if(D)setTimeout(O,0,M);else{var R=b[M];if(R){D=!0;try{(function($){var X=$.callback,J=$.args;switch(J.length){case 0:X();break;case 1:X(J[0]);break;case 2:X(J[0],J[1]);break;case 3:X(J[0],J[1],J[2]);break;default:X.apply(m,J)}})(R)}finally{S(M),D=!1}}}}function C(M){M.source===o&&typeof M.data=="string"&&M.data.indexOf(y)===0&&O(+M.data.slice(y.length))}})(typeof self>"u"?i===void 0?this:i:self)}).call(this,typeof Oo<"u"?Oo:typeof self<"u"?self:typeof window<"u"?window:{})},{}]},{},[10])(10)})}(fd)),fd.exports}var rb=ab();const sb=gl(rb);var hd={exports:{}};const ib={},lb=Object.freeze(Object.defineProperty({__proto__:null,default:ib},Symbol.toStringTag,{value:"Module"})),md=Py(lb);var pp;function ob(){return pp||(pp=1,function(r,g){var l=void 0,u=function(f){return l||(l=new Promise(function(i,o){var m=typeof f<"u"?f:{},x=m.onAbort;m.onAbort=function(p){o(new Error(p)),x&&x(p)},m.postRun=m.postRun||[],m.postRun.push(function(){i(m)}),r=void 0;var d;d||(d=typeof m<"u"?m:{}),d.onRuntimeInitialized=function(){function p(ge,ze){switch(typeof ze){case"boolean":Xr(ge,ze?1:0);break;case"number":cc(ge,ze);break;case"string":uc(ge,ze,-1,-1);break;case"object":if(ze===null)Al(ge);else if(ze.length!=null){var Ve=Ns(ze,hr);ji(ge,Ve,ze.length,-1),ja(Ve)}else ks(ge,"Wrong API use : tried to return a value of an unknown type ("+ze+").",-1);break;default:Al(ge)}}function v(ge,ze){for(var Ve=[],rt=0;rt<ge;rt+=1){var dt=he(ze+4*rt,"i32"),At=rc(dt);if(At===1||At===2)dt=oc(dt);else if(At===3)dt=ic(dt);else if(At===4){At=dt,dt=sc(At),At=lc(At);for(var Ln=new Uint8Array(dt),Nn=0;Nn<dt;Nn+=1)Ln[Nn]=H[At+Nn];dt=Ln}else dt=null;Ve.push(dt)}return Ve}function I(ge,ze){this.La=ge,this.db=ze,this.Ja=1,this.fb=[]}function G(ge,ze){if(this.db=ze,ze=Xe(ge)+1,this.Ya=Vr(ze),this.Ya===null)throw Error("Unable to allocate memory for the SQL string");qe(ge,K,this.Ya,ze),this.eb=this.Ya,this.Ua=this.ib=null}function ne(ge){if(this.filename="dbfile_"+(4294967295*Math.random()>>>0),ge!=null){var ze=this.filename,Ve="/",rt=ze;if(Ve&&(Ve=typeof Ve=="string"?Ve:ia(Ve),rt=ze?de(Ve+"/"+ze):Ve),ze=xs(!0,!0),rt=$r(rt,(ze!==void 0?ze:438)&4095|32768,0),ge){if(typeof ge=="string"){Ve=Array(ge.length);for(var dt=0,At=ge.length;dt<At;++dt)Ve[dt]=ge.charCodeAt(dt);ge=Ve}Pr(rt,ze|146),Ve=zn(rt,577),bl(Ve,ge,0,ge.length,0),pi(Ve),Pr(rt,ze)}}this.handleError(nt(this.filename,Ee)),this.db=he(Ee,"i32"),_i(this.db),this.Za={},this.Na={}}var Ee=un(4),De=d.cwrap,nt=De("sqlite3_open","number",["string","number"]),yt=De("sqlite3_close_v2","number",["number"]),lt=De("sqlite3_exec","number",["number","string","number","number","number"]),Ft=De("sqlite3_changes","number",["number"]),qt=De("sqlite3_prepare_v2","number",["number","string","number","number","number"]),Zr=De("sqlite3_sql","string",["number"]),wl=De("sqlite3_normalized_sql","string",["number"]),Sl=De("sqlite3_prepare_v2","number",["number","number","number","number","number"]),$o=De("sqlite3_bind_text","number",["number","number","number","number","number"]),El=De("sqlite3_bind_blob","number",["number","number","number","number","number"]),Si=De("sqlite3_bind_double","number",["number","number","number"]),Po=De("sqlite3_bind_int","number",["number","number","number"]),Jo=De("sqlite3_bind_parameter_index","number",["number","string"]),Vo=De("sqlite3_step","number",["number"]),Ko=De("sqlite3_errmsg","string",["number"]),Zo=De("sqlite3_column_count","number",["number"]),jl=De("sqlite3_data_count","number",["number"]),Xo=De("sqlite3_column_double","number",["number","number"]),Nl=De("sqlite3_column_text","string",["number","number"]),Wo=De("sqlite3_column_blob","number",["number","number"]),ec=De("sqlite3_column_bytes","number",["number","number"]),Ei=De("sqlite3_column_type","number",["number","number"]),tc=De("sqlite3_column_name","string",["number","number"]),nc=De("sqlite3_reset","number",["number"]),ac=De("sqlite3_clear_bindings","number",["number"]),_l=De("sqlite3_finalize","number",["number"]),kl=De("sqlite3_create_function_v2","number","number string number number number number number number number".split(" ")),rc=De("sqlite3_value_type","number",["number"]),sc=De("sqlite3_value_bytes","number",["number"]),ic=De("sqlite3_value_text","string",["number"]),lc=De("sqlite3_value_blob","number",["number"]),oc=De("sqlite3_value_double","number",["number"]),cc=De("sqlite3_result_double","",["number","number"]),Al=De("sqlite3_result_null","",["number"]),uc=De("sqlite3_result_text","",["number","string","number","number"]),ji=De("sqlite3_result_blob","",["number","number","number","number"]),Xr=De("sqlite3_result_int","",["number","number"]),ks=De("sqlite3_result_error","",["number","string","number"]),Ni=De("sqlite3_aggregate_context","number",["number","number"]),_i=De("RegisterExtensionFunctions","number",["number"]);I.prototype.bind=function(ge){if(!this.La)throw"Statement closed";return this.reset(),Array.isArray(ge)?this.wb(ge):ge!=null&&typeof ge=="object"?this.xb(ge):!0},I.prototype.step=function(){if(!this.La)throw"Statement closed";this.Ja=1;var ge=Vo(this.La);switch(ge){case 100:return!0;case 101:return!1;default:throw this.db.handleError(ge)}},I.prototype.rb=function(ge){return ge==null&&(ge=this.Ja,this.Ja+=1),Xo(this.La,ge)},I.prototype.Ab=function(ge){if(ge==null&&(ge=this.Ja,this.Ja+=1),ge=Nl(this.La,ge),typeof BigInt!="function")throw Error("BigInt is not supported");return BigInt(ge)},I.prototype.Bb=function(ge){return ge==null&&(ge=this.Ja,this.Ja+=1),Nl(this.La,ge)},I.prototype.getBlob=function(ge){ge==null&&(ge=this.Ja,this.Ja+=1);var ze=ec(this.La,ge);ge=Wo(this.La,ge);for(var Ve=new Uint8Array(ze),rt=0;rt<ze;rt+=1)Ve[rt]=H[ge+rt];return Ve},I.prototype.get=function(ge,ze){ze=ze||{},ge!=null&&this.bind(ge)&&this.step(),ge=[];for(var Ve=jl(this.La),rt=0;rt<Ve;rt+=1)switch(Ei(this.La,rt)){case 1:var dt=ze.useBigInt?this.Ab(rt):this.rb(rt);ge.push(dt);break;case 2:ge.push(this.rb(rt));break;case 3:ge.push(this.Bb(rt));break;case 4:ge.push(this.getBlob(rt));break;default:ge.push(null)}return ge},I.prototype.getColumnNames=function(){for(var ge=[],ze=Zo(this.La),Ve=0;Ve<ze;Ve+=1)ge.push(tc(this.La,Ve));return ge},I.prototype.getAsObject=function(ge,ze){ge=this.get(ge,ze),ze=this.getColumnNames();for(var Ve={},rt=0;rt<ze.length;rt+=1)Ve[ze[rt]]=ge[rt];return Ve},I.prototype.getSQL=function(){return Zr(this.La)},I.prototype.getNormalizedSQL=function(){return wl(this.La)},I.prototype.run=function(ge){return ge!=null&&this.bind(ge),this.step(),this.reset()},I.prototype.nb=function(ge,ze){ze==null&&(ze=this.Ja,this.Ja+=1),ge=Ge(ge);var Ve=Ns(ge,hr);this.fb.push(Ve),this.db.handleError($o(this.La,ze,Ve,ge.length-1,0))},I.prototype.vb=function(ge,ze){ze==null&&(ze=this.Ja,this.Ja+=1);var Ve=Ns(ge,hr);this.fb.push(Ve),this.db.handleError(El(this.La,ze,Ve,ge.length,0))},I.prototype.mb=function(ge,ze){ze==null&&(ze=this.Ja,this.Ja+=1),this.db.handleError((ge===(ge|0)?Po:Si)(this.La,ze,ge))},I.prototype.yb=function(ge){ge==null&&(ge=this.Ja,this.Ja+=1),El(this.La,ge,0,0,0)},I.prototype.ob=function(ge,ze){switch(ze==null&&(ze=this.Ja,this.Ja+=1),typeof ge){case"string":this.nb(ge,ze);return;case"number":this.mb(ge,ze);return;case"bigint":this.nb(ge.toString(),ze);return;case"boolean":this.mb(ge+0,ze);return;case"object":if(ge===null){this.yb(ze);return}if(ge.length!=null){this.vb(ge,ze);return}}throw"Wrong API use : tried to bind a value of an unknown type ("+ge+")."},I.prototype.xb=function(ge){var ze=this;return Object.keys(ge).forEach(function(Ve){var rt=Jo(ze.La,Ve);rt!==0&&ze.ob(ge[Ve],rt)}),!0},I.prototype.wb=function(ge){for(var ze=0;ze<ge.length;ze+=1)this.ob(ge[ze],ze+1);return!0},I.prototype.reset=function(){return this.freemem(),ac(this.La)===0&&nc(this.La)===0},I.prototype.freemem=function(){for(var ge;(ge=this.fb.pop())!==void 0;)ja(ge)},I.prototype.free=function(){this.freemem();var ge=_l(this.La)===0;return delete this.db.Za[this.La],this.La=0,ge},G.prototype.next=function(){if(this.Ya===null)return{done:!0};if(this.Ua!==null&&(this.Ua.free(),this.Ua=null),!this.db.db)throw this.gb(),Error("Database closed");var ge=Fa(),ze=un(4);Z(Ee),Z(ze);try{this.db.handleError(Sl(this.db.db,this.eb,-1,Ee,ze)),this.eb=he(ze,"i32");var Ve=he(Ee,"i32");return Ve===0?(this.gb(),{done:!0}):(this.Ua=new I(Ve,this.db),this.db.Za[Ve]=this.Ua,{value:this.Ua,done:!1})}catch(rt){throw this.ib=fe(this.eb),this.gb(),rt}finally{oa(ge)}},G.prototype.gb=function(){ja(this.Ya),this.Ya=null},G.prototype.getRemainingSQL=function(){return this.ib!==null?this.ib:fe(this.eb)},typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"&&(G.prototype[Symbol.iterator]=function(){return this}),ne.prototype.run=function(ge,ze){if(!this.db)throw"Database closed";if(ze){ge=this.prepare(ge,ze);try{ge.step()}finally{ge.free()}}else this.handleError(lt(this.db,ge,0,0,Ee));return this},ne.prototype.exec=function(ge,ze,Ve){if(!this.db)throw"Database closed";var rt=Fa(),dt=null;try{var At=js(ge),Ln=un(4);for(ge=[];he(At,"i8")!==0;){Z(Ee),Z(Ln),this.handleError(Sl(this.db,At,-1,Ee,Ln));var Nn=he(Ee,"i32");if(At=he(Ln,"i32"),Nn!==0){var bn=null;for(dt=new I(Nn,this),ze!=null&&dt.bind(ze);dt.step();)bn===null&&(bn={columns:dt.getColumnNames(),values:[]},ge.push(bn)),bn.values.push(dt.get(null,Ve));dt.free()}}return ge}catch(dn){throw dt&&dt.free(),dn}finally{oa(rt)}},ne.prototype.each=function(ge,ze,Ve,rt,dt){typeof ze=="function"&&(rt=Ve,Ve=ze,ze=void 0),ge=this.prepare(ge,ze);try{for(;ge.step();)Ve(ge.getAsObject(null,dt))}finally{ge.free()}if(typeof rt=="function")return rt()},ne.prototype.prepare=function(ge,ze){if(Z(Ee),this.handleError(qt(this.db,ge,-1,Ee,0)),ge=he(Ee,"i32"),ge===0)throw"Nothing to prepare";var Ve=new I(ge,this);return ze!=null&&Ve.bind(ze),this.Za[ge]=Ve},ne.prototype.iterateStatements=function(ge){return new G(ge,this)},ne.prototype.export=function(){Object.values(this.Za).forEach(function(ze){ze.free()}),Object.values(this.Na).forEach(Ea),this.Na={},this.handleError(yt(this.db));var ge=vs(this.filename);return this.handleError(nt(this.filename,Ee)),this.db=he(Ee,"i32"),_i(this.db),ge},ne.prototype.close=function(){this.db!==null&&(Object.values(this.Za).forEach(function(ge){ge.free()}),Object.values(this.Na).forEach(Ea),this.Na={},this.handleError(yt(this.db)),cr("/"+this.filename),this.db=null)},ne.prototype.handleError=function(ge){if(ge===0)return null;throw ge=Ko(this.db),Error(ge)},ne.prototype.getRowsModified=function(){return Ft(this.db)},ne.prototype.create_function=function(ge,ze){Object.prototype.hasOwnProperty.call(this.Na,ge)&&(Ea(this.Na[ge]),delete this.Na[ge]);var Ve=pr(function(rt,dt,At){dt=v(dt,At);try{var Ln=ze.apply(null,dt)}catch(Nn){ks(rt,Nn,-1);return}p(rt,Ln)},"viii");return this.Na[ge]=Ve,this.handleError(kl(this.db,ge,ze.length,1,0,Ve,0,0,0)),this},ne.prototype.create_aggregate=function(ge,ze){var Ve=ze.init||function(){return null},rt=ze.finalize||function(bn){return bn},dt=ze.step;if(!dt)throw"An aggregate function must have a step function in "+ge;var At={};Object.hasOwnProperty.call(this.Na,ge)&&(Ea(this.Na[ge]),delete this.Na[ge]),ze=ge+"__finalize",Object.hasOwnProperty.call(this.Na,ze)&&(Ea(this.Na[ze]),delete this.Na[ze]);var Ln=pr(function(bn,dn,qa){var Ha=Ni(bn,1);Object.hasOwnProperty.call(At,Ha)||(At[Ha]=Ve()),dn=v(dn,qa),dn=[At[Ha]].concat(dn);try{At[Ha]=dt.apply(null,dn)}catch(As){delete At[Ha],ks(bn,As,-1)}},"viii"),Nn=pr(function(bn){var dn=Ni(bn,1);try{var qa=rt(At[dn])}catch(Ha){delete At[dn],ks(bn,Ha,-1);return}p(bn,qa),delete At[dn]},"vi");return this.Na[ge]=Ln,this.Na[ze]=Nn,this.handleError(kl(this.db,ge,dt.length-1,1,0,0,Ln,Nn,0)),this},d.Database=ne};var j=Object.assign({},d),y="./this.program",_=typeof window=="object",b=typeof importScripts=="function",D=typeof process=="object"&&typeof process.versions=="object"&&typeof process.versions.node=="string",w="",N,S,O;if(D){var C=md,M=md;w=b?M.dirname(w)+"/":__dirname+"/",N=(p,v)=>(p=Ne(p)?new URL(p):M.normalize(p),C.readFileSync(p,v?void 0:"utf8")),O=p=>(p=N(p,!0),p.buffer||(p=new Uint8Array(p)),p),S=(p,v,I,G=!0)=>{p=Ne(p)?new URL(p):M.normalize(p),C.readFile(p,G?void 0:"utf8",(ne,Ee)=>{ne?I(ne):v(G?Ee.buffer:Ee)})},!d.thisProgram&&1<process.argv.length&&(y=process.argv[1].replace(/\\/g,"/")),process.argv.slice(2),r.exports=d,d.inspect=()=>"[Emscripten Module object]"}else(_||b)&&(b?w=self.location.href:typeof document<"u"&&document.currentScript&&(w=document.currentScript.src),w=w.indexOf("blob:")!==0?w.substr(0,w.replace(/[?#].*/,"").lastIndexOf("/")+1):"",N=p=>{var v=new XMLHttpRequest;return v.open("GET",p,!1),v.send(null),v.responseText},b&&(O=p=>{var v=new XMLHttpRequest;return v.open("GET",p,!1),v.responseType="arraybuffer",v.send(null),new Uint8Array(v.response)}),S=(p,v,I)=>{var G=new XMLHttpRequest;G.open("GET",p,!0),G.responseType="arraybuffer",G.onload=()=>{G.status==200||G.status==0&&G.response?v(G.response):I()},G.onerror=I,G.send(null)});var R=d.print||console.log.bind(console),$=d.printErr||console.error.bind(console);Object.assign(d,j),j=null,d.thisProgram&&(y=d.thisProgram);var X;d.wasmBinary&&(X=d.wasmBinary),typeof WebAssembly!="object"&&ie("no native wasm support detected");var J,Y=!1,H,K,q,W,A,B,z;function Q(){var p=J.buffer;d.HEAP8=H=new Int8Array(p),d.HEAP16=q=new Int16Array(p),d.HEAPU8=K=new Uint8Array(p),d.HEAPU16=new Uint16Array(p),d.HEAP32=W=new Int32Array(p),d.HEAPU32=A=new Uint32Array(p),d.HEAPF32=B=new Float32Array(p),d.HEAPF64=z=new Float64Array(p)}var ue=[],ee=[],V=[];function E(){var p=d.preRun.shift();ue.unshift(p)}var L=0,se=null;function ie(p){var v;throw(v=d.onAbort)==null||v.call(d,p),p="Aborted("+p+")",$(p),Y=!0,new WebAssembly.RuntimeError(p+". Build with -sASSERTIONS for more info.")}var oe=p=>p.startsWith("data:application/octet-stream;base64,"),Ne=p=>p.startsWith("file://"),we;if(we="sql-wasm.wasm",!oe(we)){var je=we;we=d.locateFile?d.locateFile(je,w):w+je}function ve(p){if(p==we&&X)return new Uint8Array(X);if(O)return O(p);throw"both async and sync fetching of the wasm failed"}function Me(p){if(!X&&(_||b)){if(typeof fetch=="function"&&!Ne(p))return fetch(p,{credentials:"same-origin"}).then(v=>{if(!v.ok)throw"failed to load wasm binary file at '"+p+"'";return v.arrayBuffer()}).catch(()=>ve(p));if(S)return new Promise((v,I)=>{S(p,G=>v(new Uint8Array(G)),I)})}return Promise.resolve().then(()=>ve(p))}function Fe(p,v,I){return Me(p).then(G=>WebAssembly.instantiate(G,v)).then(G=>G).then(I,G=>{$(`failed to asynchronously prepare wasm: ${G}`),ie(G)})}function Pe(p,v){var I=we;X||typeof WebAssembly.instantiateStreaming!="function"||oe(I)||Ne(I)||D||typeof fetch!="function"?Fe(I,p,v):fetch(I,{credentials:"same-origin"}).then(G=>WebAssembly.instantiateStreaming(G,p).then(v,function(ne){return $(`wasm streaming compile failed: ${ne}`),$("falling back to ArrayBuffer instantiation"),Fe(I,p,v)}))}var Re,k,xe=p=>{for(;0<p.length;)p.shift()(d)};function he(p,v="i8"){switch(v.endsWith("*")&&(v="*"),v){case"i1":return H[p>>0];case"i8":return H[p>>0];case"i16":return q[p>>1];case"i32":return W[p>>2];case"i64":ie("to do getValue(i64) use WASM_BIGINT");case"float":return B[p>>2];case"double":return z[p>>3];case"*":return A[p>>2];default:ie(`invalid type for getValue: ${v}`)}}function Z(p){var v="i32";switch(v.endsWith("*")&&(v="*"),v){case"i1":H[p>>0]=0;break;case"i8":H[p>>0]=0;break;case"i16":q[p>>1]=0;break;case"i32":W[p>>2]=0;break;case"i64":ie("to do setValue(i64) use WASM_BIGINT");case"float":B[p>>2]=0;break;case"double":z[p>>3]=0;break;case"*":A[p>>2]=0;break;default:ie(`invalid type for setValue: ${v}`)}}var P=typeof TextDecoder<"u"?new TextDecoder("utf8"):void 0,ae=(p,v,I)=>{var G=v+I;for(I=v;p[I]&&!(I>=G);)++I;if(16<I-v&&p.buffer&&P)return P.decode(p.subarray(v,I));for(G="";v<I;){var ne=p[v++];if(ne&128){var Ee=p[v++]&63;if((ne&224)==192)G+=String.fromCharCode((ne&31)<<6|Ee);else{var De=p[v++]&63;ne=(ne&240)==224?(ne&15)<<12|Ee<<6|De:(ne&7)<<18|Ee<<12|De<<6|p[v++]&63,65536>ne?G+=String.fromCharCode(ne):(ne-=65536,G+=String.fromCharCode(55296|ne>>10,56320|ne&1023))}}else G+=String.fromCharCode(ne)}return G},fe=(p,v)=>p?ae(K,p,v):"",Ae=(p,v)=>{for(var I=0,G=p.length-1;0<=G;G--){var ne=p[G];ne==="."?p.splice(G,1):ne===".."?(p.splice(G,1),I++):I&&(p.splice(G,1),I--)}if(v)for(;I;I--)p.unshift("..");return p},de=p=>{var v=p.charAt(0)==="/",I=p.substr(-1)==="/";return(p=Ae(p.split("/").filter(G=>!!G),!v).join("/"))||v||(p="."),p&&I&&(p+="/"),(v?"/":"")+p},Ue=p=>{var v=/^(\/?|)([\s\S]*?)((?:\.{1,2}|[^\/]+?|)(\.[^.\/]*|))(?:[\/]*)$/.exec(p).slice(1);return p=v[0],v=v[1],!p&&!v?".":(v&&(v=v.substr(0,v.length-1)),p+v)},Le=p=>{if(p==="/")return"/";p=de(p),p=p.replace(/\/$/,"");var v=p.lastIndexOf("/");return v===-1?p:p.substr(v+1)},_e=()=>{if(typeof crypto=="object"&&typeof crypto.getRandomValues=="function")return I=>crypto.getRandomValues(I);if(D)try{var p=md;if(p.randomFillSync)return I=>p.randomFillSync(I);var v=p.randomBytes;return I=>(I.set(v(I.byteLength)),I)}catch{}ie("initRandomDevice")},pe=p=>(pe=_e())(p);function Be(){for(var p="",v=!1,I=arguments.length-1;-1<=I&&!v;I--){if(v=0<=I?arguments[I]:"/",typeof v!="string")throw new TypeError("Arguments to path.resolve must be strings");if(!v)return"";p=v+"/"+p,v=v.charAt(0)==="/"}return p=Ae(p.split("/").filter(G=>!!G),!v).join("/"),(v?"/":"")+p||"."}var He=[],Xe=p=>{for(var v=0,I=0;I<p.length;++I){var G=p.charCodeAt(I);127>=G?v++:2047>=G?v+=2:55296<=G&&57343>=G?(v+=4,++I):v+=3}return v},qe=(p,v,I,G)=>{if(!(0<G))return 0;var ne=I;G=I+G-1;for(var Ee=0;Ee<p.length;++Ee){var De=p.charCodeAt(Ee);if(55296<=De&&57343>=De){var nt=p.charCodeAt(++Ee);De=65536+((De&1023)<<10)|nt&1023}if(127>=De){if(I>=G)break;v[I++]=De}else{if(2047>=De){if(I+1>=G)break;v[I++]=192|De>>6}else{if(65535>=De){if(I+2>=G)break;v[I++]=224|De>>12}else{if(I+3>=G)break;v[I++]=240|De>>18,v[I++]=128|De>>12&63}v[I++]=128|De>>6&63}v[I++]=128|De&63}}return v[I]=0,I-ne};function Ge(p,v){var I=Array(Xe(p)+1);return p=qe(p,I,0,I.length),v&&(I.length=p),I}var at=[];function Je(p,v){at[p]={input:[],output:[],Xa:v},hi(p,xt)}var xt={open(p){var v=at[p.node.rdev];if(!v)throw new Ye(43);p.tty=v,p.seekable=!1},close(p){p.tty.Xa.fsync(p.tty)},fsync(p){p.tty.Xa.fsync(p.tty)},read(p,v,I,G){if(!p.tty||!p.tty.Xa.sb)throw new Ye(60);for(var ne=0,Ee=0;Ee<G;Ee++){try{var De=p.tty.Xa.sb(p.tty)}catch{throw new Ye(29)}if(De===void 0&&ne===0)throw new Ye(6);if(De==null)break;ne++,v[I+Ee]=De}return ne&&(p.node.timestamp=Date.now()),ne},write(p,v,I,G){if(!p.tty||!p.tty.Xa.jb)throw new Ye(60);try{for(var ne=0;ne<G;ne++)p.tty.Xa.jb(p.tty,v[I+ne])}catch{throw new Ye(29)}return G&&(p.node.timestamp=Date.now()),ne}},Rt={sb(){e:{if(!He.length){var p=null;if(D){var v=Buffer.alloc(256),I=0,G=process.stdin.fd;try{I=C.readSync(G,v)}catch(ne){if(ne.toString().includes("EOF"))I=0;else throw ne}0<I?p=v.slice(0,I).toString("utf-8"):p=null}else typeof window<"u"&&typeof window.prompt=="function"?(p=window.prompt("Input: "),p!==null&&(p+=`
`)):typeof readline=="function"&&(p=readline(),p!==null&&(p+=`
`));if(!p){p=null;break e}He=Ge(p,!0)}p=He.shift()}return p},jb(p,v){v===null||v===10?(R(ae(p.output,0)),p.output=[]):v!=0&&p.output.push(v)},fsync(p){p.output&&0<p.output.length&&(R(ae(p.output,0)),p.output=[])},Mb(){return{Ib:25856,Kb:5,Hb:191,Jb:35387,Gb:[3,28,127,21,4,0,1,0,17,19,26,0,18,15,23,22,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]}},Nb(){return 0},Ob(){return[24,80]}},vt={jb(p,v){v===null||v===10?($(ae(p.output,0)),p.output=[]):v!=0&&p.output.push(v)},fsync(p){p.output&&0<p.output.length&&($(ae(p.output,0)),p.output=[])}};function Lt(p,v){var I=p.Ia?p.Ia.length:0;I>=v||(v=Math.max(v,I*(1048576>I?2:1.125)>>>0),I!=0&&(v=Math.max(v,256)),I=p.Ia,p.Ia=new Uint8Array(v),0<p.Ma&&p.Ia.set(I.subarray(0,p.Ma),0))}var it={Qa:null,Ra(){return it.createNode(null,"/",16895,0)},createNode(p,v,I,G){if((I&61440)===24576||(I&61440)===4096)throw new Ye(63);return it.Qa||(it.Qa={dir:{node:{Pa:it.Ga.Pa,Oa:it.Ga.Oa,lookup:it.Ga.lookup,ab:it.Ga.ab,rename:it.Ga.rename,unlink:it.Ga.unlink,rmdir:it.Ga.rmdir,readdir:it.Ga.readdir,symlink:it.Ga.symlink},stream:{Ta:it.Ha.Ta}},file:{node:{Pa:it.Ga.Pa,Oa:it.Ga.Oa},stream:{Ta:it.Ha.Ta,read:it.Ha.read,write:it.Ha.write,lb:it.Ha.lb,bb:it.Ha.bb,cb:it.Ha.cb}},link:{node:{Pa:it.Ga.Pa,Oa:it.Ga.Oa,readlink:it.Ga.readlink},stream:{}},pb:{node:{Pa:it.Ga.Pa,Oa:it.Ga.Oa},stream:fi}}),I=ui(p,v,I,G),xn(I.mode)?(I.Ga=it.Qa.dir.node,I.Ha=it.Qa.dir.stream,I.Ia={}):(I.mode&61440)===32768?(I.Ga=it.Qa.file.node,I.Ha=it.Qa.file.stream,I.Ma=0,I.Ia=null):(I.mode&61440)===40960?(I.Ga=it.Qa.link.node,I.Ha=it.Qa.link.stream):(I.mode&61440)===8192&&(I.Ga=it.Qa.pb.node,I.Ha=it.Qa.pb.stream),I.timestamp=Date.now(),p&&(p.Ia[v]=I,p.timestamp=I.timestamp),I},Lb(p){return p.Ia?p.Ia.subarray?p.Ia.subarray(0,p.Ma):new Uint8Array(p.Ia):new Uint8Array(0)},Ga:{Pa(p){var v={};return v.dev=(p.mode&61440)===8192?p.id:1,v.ino=p.id,v.mode=p.mode,v.nlink=1,v.uid=0,v.gid=0,v.rdev=p.rdev,xn(p.mode)?v.size=4096:(p.mode&61440)===32768?v.size=p.Ma:(p.mode&61440)===40960?v.size=p.link.length:v.size=0,v.atime=new Date(p.timestamp),v.mtime=new Date(p.timestamp),v.ctime=new Date(p.timestamp),v.zb=4096,v.blocks=Math.ceil(v.size/v.zb),v},Oa(p,v){if(v.mode!==void 0&&(p.mode=v.mode),v.timestamp!==void 0&&(p.timestamp=v.timestamp),v.size!==void 0&&(v=v.size,p.Ma!=v))if(v==0)p.Ia=null,p.Ma=0;else{var I=p.Ia;p.Ia=new Uint8Array(v),I&&p.Ia.set(I.subarray(0,Math.min(v,p.Ma))),p.Ma=v}},lookup(){throw ys[44]},ab(p,v,I,G){return it.createNode(p,v,I,G)},rename(p,v,I){if(xn(p.mode)){try{var G=va(v,I)}catch{}if(G)for(var ne in G.Ia)throw new Ye(55)}delete p.parent.Ia[p.name],p.parent.timestamp=Date.now(),p.name=I,v.Ia[I]=p,v.timestamp=p.parent.timestamp,p.parent=v},unlink(p,v){delete p.Ia[v],p.timestamp=Date.now()},rmdir(p,v){var I=va(p,v),G;for(G in I.Ia)throw new Ye(55);delete p.Ia[v],p.timestamp=Date.now()},readdir(p){var v=[".",".."],I;for(I of Object.keys(p.Ia))v.push(I);return v},symlink(p,v,I){return p=it.createNode(p,v,41471,0),p.link=I,p},readlink(p){if((p.mode&61440)!==40960)throw new Ye(28);return p.link}},Ha:{read(p,v,I,G,ne){var Ee=p.node.Ia;if(ne>=p.node.Ma)return 0;if(p=Math.min(p.node.Ma-ne,G),8<p&&Ee.subarray)v.set(Ee.subarray(ne,ne+p),I);else for(G=0;G<p;G++)v[I+G]=Ee[ne+G];return p},write(p,v,I,G,ne,Ee){if(v.buffer===H.buffer&&(Ee=!1),!G)return 0;if(p=p.node,p.timestamp=Date.now(),v.subarray&&(!p.Ia||p.Ia.subarray)){if(Ee)return p.Ia=v.subarray(I,I+G),p.Ma=G;if(p.Ma===0&&ne===0)return p.Ia=v.slice(I,I+G),p.Ma=G;if(ne+G<=p.Ma)return p.Ia.set(v.subarray(I,I+G),ne),G}if(Lt(p,ne+G),p.Ia.subarray&&v.subarray)p.Ia.set(v.subarray(I,I+G),ne);else for(Ee=0;Ee<G;Ee++)p.Ia[ne+Ee]=v[I+Ee];return p.Ma=Math.max(p.Ma,ne+G),G},Ta(p,v,I){if(I===1?v+=p.position:I===2&&(p.node.mode&61440)===32768&&(v+=p.node.Ma),0>v)throw new Ye(28);return v},lb(p,v,I){Lt(p.node,v+I),p.node.Ma=Math.max(p.node.Ma,v+I)},bb(p,v,I,G,ne){if((p.node.mode&61440)!==32768)throw new Ye(43);if(p=p.node.Ia,ne&2||p.buffer!==H.buffer){if((0<I||I+v<p.length)&&(p.subarray?p=p.subarray(I,I+v):p=Array.prototype.slice.call(p,I,I+v)),I=!0,v=65536*Math.ceil(v/65536),(ne=Jn(65536,v))?(K.fill(0,ne,ne+v),v=ne):v=0,!v)throw new Ye(48);H.set(p,v)}else I=!1,v=p.byteOffset;return{Db:v,ub:I}},cb(p,v,I,G){return it.Ha.write(p,v,0,G,I,!1),0}}},xs=(p,v)=>{var I=0;return p&&(I|=365),v&&(I|=146),I},ya=null,ba={},gn=[],An=1,Un=null,lr=!0,Ye=null,ys={};function sn(p,v={}){if(p=Be(p),!p)return{path:"",node:null};if(v=Object.assign({qb:!0,kb:0},v),8<v.kb)throw new Ye(32);p=p.split("/").filter(De=>!!De);for(var I=ya,G="/",ne=0;ne<p.length;ne++){var Ee=ne===p.length-1;if(Ee&&v.parent)break;if(I=va(I,p[ne]),G=de(G+"/"+p[ne]),I.Va&&(!Ee||Ee&&v.qb)&&(I=I.Va.root),!Ee||v.Sa){for(Ee=0;(I.mode&61440)===40960;)if(I=Ma(G),G=Be(Ue(G),I),I=sn(G,{kb:v.kb+1}).node,40<Ee++)throw new Ye(32)}}return{path:G,node:I}}function ia(p){for(var v;;){if(p===p.parent)return p=p.Ra.tb,v?p[p.length-1]!=="/"?`${p}/${v}`:p+v:p;v=v?`${p.name}/${v}`:p.name,p=p.parent}}function oi(p,v){for(var I=0,G=0;G<v.length;G++)I=(I<<5)-I+v.charCodeAt(G)|0;return(p+I>>>0)%Un.length}function ci(p){var v=oi(p.parent.id,p.name);if(Un[v]===p)Un[v]=p.Wa;else for(v=Un[v];v;){if(v.Wa===p){v.Wa=p.Wa;break}v=v.Wa}}function va(p,v){var I;if(I=(I=Oa(p,"x"))?I:p.Ga.lookup?0:2)throw new Ye(I,p);for(I=Un[oi(p.id,v)];I;I=I.Wa){var G=I.name;if(I.parent.id===p.id&&G===v)return I}return p.Ga.lookup(p,v)}function ui(p,v,I,G){return p=new Ba(p,v,I,G),v=oi(p.parent.id,p.name),p.Wa=Un[v],Un[v]=p}function xn(p){return(p&61440)===16384}function bs(p){var v=["r","w","rw"][p&3];return p&512&&(v+="w"),v}function Oa(p,v){if(lr)return 0;if(!v.includes("r")||p.mode&292){if(v.includes("w")&&!(p.mode&146)||v.includes("x")&&!(p.mode&73))return 2}else return 2;return 0}function di(p,v){try{return va(p,v),20}catch{}return Oa(p,"wx")}function la(p,v,I){try{var G=va(p,v)}catch(ne){return ne.Ka}if(p=Oa(p,"wx"))return p;if(I){if(!xn(G.mode))return 54;if(G===G.parent||ia(G)==="/")return 10}else if(xn(G.mode))return 31;return 0}function nn(){for(var p=0;4096>=p;p++)if(!gn[p])return p;throw new Ye(33)}function Nt(p){if(p=gn[p],!p)throw new Ye(8);return p}function Ia(p,v=-1){return Ua||(Ua=function(){this.$a={}},Ua.prototype={},Object.defineProperties(Ua.prototype,{object:{get(){return this.node},set(I){this.node=I}},flags:{get(){return this.$a.flags},set(I){this.$a.flags=I}},position:{get(){return this.$a.position},set(I){this.$a.position=I}}})),p=Object.assign(new Ua,p),v==-1&&(v=nn()),p.fd=v,gn[v]=p}var fi={open(p){var v,I;p.Ha=ba[p.node.rdev].Ha,(I=(v=p.Ha).open)==null||I.call(v,p)},Ta(){throw new Ye(70)}};function hi(p,v){ba[p]={Ha:v}}function yl(p,v){var I=v==="/",G=!v;if(I&&ya)throw new Ye(10);if(!I&&!G){var ne=sn(v,{qb:!1});if(v=ne.path,ne=ne.node,ne.Va)throw new Ye(10);if(!xn(ne.mode))throw new Ye(54)}v={type:p,Pb:{},tb:v,Cb:[]},p=p.Ra(v),p.Ra=v,v.root=p,I?ya=p:ne&&(ne.Va=v,ne.Ra&&ne.Ra.Cb.push(v))}function $r(p,v,I){var G=sn(p,{parent:!0}).node;if(p=Le(p),!p||p==="."||p==="..")throw new Ye(28);var ne=di(G,p);if(ne)throw new Ye(ne);if(!G.Ga.ab)throw new Ye(63);return G.Ga.ab(G,p,v,I)}function yn(p,v){return $r(p,(v!==void 0?v:511)&1023|16384,0)}function or(p,v,I){typeof I>"u"&&(I=v,v=438),$r(p,v|8192,I)}function wa(p,v){if(!Be(p))throw new Ye(44);var I=sn(v,{parent:!0}).node;if(!I)throw new Ye(44);v=Le(v);var G=di(I,v);if(G)throw new Ye(G);if(!I.Ga.symlink)throw new Ye(63);I.Ga.symlink(I,v,p)}function Ra(p){var v=sn(p,{parent:!0}).node;p=Le(p);var I=va(v,p),G=la(v,p,!0);if(G)throw new Ye(G);if(!v.Ga.rmdir)throw new Ye(63);if(I.Va)throw new Ye(10);v.Ga.rmdir(v,p),ci(I)}function cr(p){var v=sn(p,{parent:!0}).node;if(!v)throw new Ye(44);p=Le(p);var I=va(v,p),G=la(v,p,!1);if(G)throw new Ye(G);if(!v.Ga.unlink)throw new Ye(63);if(I.Va)throw new Ye(10);v.Ga.unlink(v,p),ci(I)}function Ma(p){if(p=sn(p).node,!p)throw new Ye(44);if(!p.Ga.readlink)throw new Ye(28);return Be(ia(p.parent),p.Ga.readlink(p))}function Bt(p,v){if(p=sn(p,{Sa:!v}).node,!p)throw new Ye(44);if(!p.Ga.Pa)throw new Ye(63);return p.Ga.Pa(p)}function mi(p){return Bt(p,!0)}function Pr(p,v){if(p=typeof p=="string"?sn(p,{Sa:!0}).node:p,!p.Ga.Oa)throw new Ye(63);p.Ga.Oa(p,{mode:v&4095|p.mode&-4096,timestamp:Date.now()})}function Sa(p,v){if(0>v)throw new Ye(28);if(p=typeof p=="string"?sn(p,{Sa:!0}).node:p,!p.Ga.Oa)throw new Ye(63);if(xn(p.mode))throw new Ye(31);if((p.mode&61440)!==32768)throw new Ye(28);var I=Oa(p,"w");if(I)throw new Ye(I);p.Ga.Oa(p,{size:v,timestamp:Date.now()})}function zn(p,v,I){if(p==="")throw new Ye(44);if(typeof v=="string"){var G={r:0,"r+":2,w:577,"w+":578,a:1089,"a+":1090}[v];if(typeof G>"u")throw Error(`Unknown file open mode: ${v}`);v=G}if(I=v&64?(typeof I>"u"?438:I)&4095|32768:0,typeof p=="object")var ne=p;else{p=de(p);try{ne=sn(p,{Sa:!(v&131072)}).node}catch{}}if(G=!1,v&64)if(ne){if(v&128)throw new Ye(20)}else ne=$r(p,I,0),G=!0;if(!ne)throw new Ye(44);if((ne.mode&61440)===8192&&(v&=-513),v&65536&&!xn(ne.mode))throw new Ye(54);if(!G&&(I=ne?(ne.mode&61440)===40960?32:xn(ne.mode)&&(bs(v)!=="r"||v&512)?31:Oa(ne,bs(v)):44))throw new Ye(I);return v&512&&!G&&Sa(ne,0),v&=-131713,ne=Ia({node:ne,path:ia(ne),flags:v,seekable:!0,position:0,Ha:ne.Ha,Fb:[],error:!1}),ne.Ha.open&&ne.Ha.open(ne),!d.logReadFiles||v&1||(ws||(ws={}),p in ws||(ws[p]=1)),ne}function pi(p){if(p.fd===null)throw new Ye(8);p.hb&&(p.hb=null);try{p.Ha.close&&p.Ha.close(p)}catch(v){throw v}finally{gn[p.fd]=null}p.fd=null}function gi(p,v,I){if(p.fd===null)throw new Ye(8);if(!p.seekable||!p.Ha.Ta)throw new Ye(70);if(I!=0&&I!=1&&I!=2)throw new Ye(28);p.position=p.Ha.Ta(p,v,I),p.Fb=[]}function xi(p,v,I,G,ne){if(0>G||0>ne)throw new Ye(28);if(p.fd===null)throw new Ye(8);if((p.flags&2097155)===1)throw new Ye(8);if(xn(p.node.mode))throw new Ye(31);if(!p.Ha.read)throw new Ye(28);var Ee=typeof ne<"u";if(!Ee)ne=p.position;else if(!p.seekable)throw new Ye(70);return v=p.Ha.read(p,v,I,G,ne),Ee||(p.position+=v),v}function bl(p,v,I,G,ne){if(0>G||0>ne)throw new Ye(28);if(p.fd===null)throw new Ye(8);if((p.flags&2097155)===0)throw new Ye(8);if(xn(p.node.mode))throw new Ye(31);if(!p.Ha.write)throw new Ye(28);p.seekable&&p.flags&1024&&gi(p,0,2);var Ee=typeof ne<"u";if(!Ee)ne=p.position;else if(!p.seekable)throw new Ye(70);return v=p.Ha.write(p,v,I,G,ne,void 0),Ee||(p.position+=v),v}function vs(p){var v,I=zn(p,I||0);p=Bt(p).size;var G=new Uint8Array(p);return xi(I,G,0,p,0),v=G,pi(I),v}function Jr(){Ye||(Ye=function(p,v){this.name="ErrnoError",this.node=v,this.Eb=function(I){this.Ka=I},this.Eb(p),this.message="FS error"},Ye.prototype=Error(),Ye.prototype.constructor=Ye,[44].forEach(p=>{ys[p]=new Ye(p),ys[p].stack="<generic error, no stack>"}))}var $n;function ln(p,v,I){p=de("/dev/"+p);var G=xs(!!v,!!I);yi||(yi=64);var ne=yi++<<8|0;hi(ne,{open(Ee){Ee.seekable=!1},close(){var Ee;(Ee=I==null?void 0:I.buffer)!=null&&Ee.length&&I(10)},read(Ee,De,nt,yt){for(var lt=0,Ft=0;Ft<yt;Ft++){try{var qt=v()}catch{throw new Ye(29)}if(qt===void 0&&lt===0)throw new Ye(6);if(qt==null)break;lt++,De[nt+Ft]=qt}return lt&&(Ee.node.timestamp=Date.now()),lt},write(Ee,De,nt,yt){for(var lt=0;lt<yt;lt++)try{I(De[nt+lt])}catch{throw new Ye(29)}return yt&&(Ee.node.timestamp=Date.now()),lt}}),or(p,G,ne)}var yi,Ot={},Ua,ws;function Pn(p,v,I){if(v.charAt(0)==="/")return v;if(p=p===-100?"/":Nt(p).path,v.length==0){if(!I)throw new Ye(44);return p}return de(p+"/"+v)}function Ss(p,v,I){try{var G=p(v)}catch(Ee){if(Ee&&Ee.node&&de(v)!==de(ia(Ee.node)))return-54;throw Ee}W[I>>2]=G.dev,W[I+4>>2]=G.mode,A[I+8>>2]=G.nlink,W[I+12>>2]=G.uid,W[I+16>>2]=G.gid,W[I+20>>2]=G.rdev,k=[G.size>>>0,(Re=G.size,1<=+Math.abs(Re)?0<Re?+Math.floor(Re/4294967296)>>>0:~~+Math.ceil((Re-+(~~Re>>>0))/4294967296)>>>0:0)],W[I+24>>2]=k[0],W[I+28>>2]=k[1],W[I+32>>2]=4096,W[I+36>>2]=G.blocks,p=G.atime.getTime(),v=G.mtime.getTime();var ne=G.ctime.getTime();return k=[Math.floor(p/1e3)>>>0,(Re=Math.floor(p/1e3),1<=+Math.abs(Re)?0<Re?+Math.floor(Re/4294967296)>>>0:~~+Math.ceil((Re-+(~~Re>>>0))/4294967296)>>>0:0)],W[I+40>>2]=k[0],W[I+44>>2]=k[1],A[I+48>>2]=p%1e3*1e3,k=[Math.floor(v/1e3)>>>0,(Re=Math.floor(v/1e3),1<=+Math.abs(Re)?0<Re?+Math.floor(Re/4294967296)>>>0:~~+Math.ceil((Re-+(~~Re>>>0))/4294967296)>>>0:0)],W[I+56>>2]=k[0],W[I+60>>2]=k[1],A[I+64>>2]=v%1e3*1e3,k=[Math.floor(ne/1e3)>>>0,(Re=Math.floor(ne/1e3),1<=+Math.abs(Re)?0<Re?+Math.floor(Re/4294967296)>>>0:~~+Math.ceil((Re-+(~~Re>>>0))/4294967296)>>>0:0)],W[I+72>>2]=k[0],W[I+76>>2]=k[1],A[I+80>>2]=ne%1e3*1e3,k=[G.ino>>>0,(Re=G.ino,1<=+Math.abs(Re)?0<Re?+Math.floor(Re/4294967296)>>>0:~~+Math.ceil((Re-+(~~Re>>>0))/4294967296)>>>0:0)],W[I+88>>2]=k[0],W[I+92>>2]=k[1],0}var cn=void 0;function ur(){var p=W[+cn>>2];return cn+=4,p}var dr=(p,v)=>v+2097152>>>0<4194305-!!p?(p>>>0)+4294967296*v:NaN,bi=[0,31,60,91,121,152,182,213,244,274,305,335],fr=[0,31,59,90,120,151,181,212,243,273,304,334],vi=p=>{var v=Xe(p)+1,I=Vr(v);return I&&qe(p,K,I,v),I},Es={},za=()=>{if(!wi){var p={USER:"web_user",LOGNAME:"web_user",PATH:"/",PWD:"/",HOME:"/home/web_user",LANG:(typeof navigator=="object"&&navigator.languages&&navigator.languages[0]||"C").replace("-","_")+".UTF-8",_:y||"./this.program"},v;for(v in Es)Es[v]===void 0?delete p[v]:p[v]=Es[v];var I=[];for(v in p)I.push(`${v}=${p[v]}`);wi=I}return wi},wi,js=p=>{var v=Xe(p)+1,I=un(v);return qe(p,K,I,v),I},vl=(p,v,I,G)=>{var ne={string:lt=>{var Ft=0;return lt!=null&&lt!==0&&(Ft=js(lt)),Ft},array:lt=>{var Ft=un(lt.length);return H.set(lt,Ft),Ft}};p=d["_"+p];var Ee=[],De=0;if(G)for(var nt=0;nt<G.length;nt++){var yt=ne[I[nt]];yt?(De===0&&(De=Fa()),Ee[nt]=yt(G[nt])):Ee[nt]=G[nt]}return I=p.apply(null,Ee),I=function(lt){return De!==0&&oa(De),v==="string"?lt?ae(K,lt):"":v==="boolean"?!!lt:lt}(I)},hr=0,Ns=(p,v)=>(v=v==1?un(p.length):Vr(p.length),p.subarray||p.slice||(p=new Uint8Array(p)),K.set(p,v),v),La,mr=[],an,Ea=p=>{La.delete(an.get(p)),an.set(p,null),mr.push(p)},pr=(p,v)=>{if(!La){La=new WeakMap;var I=an.length;if(La)for(var G=0;G<0+I;G++){var ne=an.get(G);ne&&La.set(ne,G)}}if(I=La.get(p)||0)return I;if(mr.length)I=mr.pop();else{try{an.grow(1)}catch(nt){throw nt instanceof RangeError?"Unable to grow wasm table. Set ALLOW_TABLE_GROWTH.":nt}I=an.length-1}try{an.set(I,p)}catch(nt){if(!(nt instanceof TypeError))throw nt;if(typeof WebAssembly.Function=="function"){G=WebAssembly.Function,ne={i:"i32",j:"i64",f:"f32",d:"f64",e:"externref",p:"i32"};for(var Ee={parameters:[],results:v[0]=="v"?[]:[ne[v[0]]]},De=1;De<v.length;++De)Ee.parameters.push(ne[v[De]]);v=new G(Ee,p)}else{for(G=[1],ne=v.slice(0,1),v=v.slice(1),Ee={i:127,p:127,j:126,f:125,d:124,e:111},G.push(96),De=v.length,128>De?G.push(De):G.push(De%128|128,De>>7),De=0;De<v.length;++De)G.push(Ee[v[De]]);ne=="v"?G.push(0):G.push(1,Ee[ne]),v=[0,97,115,109,1,0,0,0,1],ne=G.length,128>ne?v.push(ne):v.push(ne%128|128,ne>>7),v.push.apply(v,G),v.push(2,7,1,1,101,1,102,0,0,7,5,1,1,102,0,0),v=new WebAssembly.Module(new Uint8Array(v)),v=new WebAssembly.Instance(v,{e:{f:p}}).exports.f}an.set(I,v)}return La.set(p,I),I};function Ba(p,v,I,G){p||(p=this),this.parent=p,this.Ra=p.Ra,this.Va=null,this.id=An++,this.name=v,this.mode=I,this.Ga={},this.Ha={},this.rdev=G}Object.defineProperties(Ba.prototype,{read:{get:function(){return(this.mode&365)===365},set:function(p){p?this.mode|=365:this.mode&=-366}},write:{get:function(){return(this.mode&146)===146},set:function(p){p?this.mode|=146:this.mode&=-147}}}),Jr(),Un=Array(4096),yl(it,"/"),yn("/tmp"),yn("/home"),yn("/home/web_user"),function(){yn("/dev"),hi(259,{read:()=>0,write:(G,ne,Ee,De)=>De}),or("/dev/null",259),Je(1280,Rt),Je(1536,vt),or("/dev/tty",1280),or("/dev/tty1",1536);var p=new Uint8Array(1024),v=0,I=()=>(v===0&&(v=pe(p).byteLength),p[--v]);ln("random",I),ln("urandom",I),yn("/dev/shm"),yn("/dev/shm/tmp")}(),function(){yn("/proc");var p=yn("/proc/self");yn("/proc/self/fd"),yl({Ra(){var v=ui(p,"fd",16895,73);return v.Ga={lookup(I,G){var ne=Nt(+G);return I={parent:null,Ra:{tb:"fake"},Ga:{readlink:()=>ne.path}},I.parent=I}},v}},"/proc/self/fd")}();var gr={a:(p,v,I,G)=>{ie(`Assertion failed: ${p?ae(K,p):""}, at: `+[v?v?ae(K,v):"":"unknown filename",I,G?G?ae(K,G):"":"unknown function"])},h:function(p,v){try{return p=p?ae(K,p):"",Pr(p,v),0}catch(I){if(typeof Ot>"u"||I.name!=="ErrnoError")throw I;return-I.Ka}},H:function(p,v,I){try{if(v=v?ae(K,v):"",v=Pn(p,v),I&-8)return-28;var G=sn(v,{Sa:!0}).node;return G?(p="",I&4&&(p+="r"),I&2&&(p+="w"),I&1&&(p+="x"),p&&Oa(G,p)?-2:0):-44}catch(ne){if(typeof Ot>"u"||ne.name!=="ErrnoError")throw ne;return-ne.Ka}},i:function(p,v){try{var I=Nt(p);return Pr(I.node,v),0}catch(G){if(typeof Ot>"u"||G.name!=="ErrnoError")throw G;return-G.Ka}},g:function(p){try{var v=Nt(p).node,I=typeof v=="string"?sn(v,{Sa:!0}).node:v;if(!I.Ga.Oa)throw new Ye(63);return I.Ga.Oa(I,{timestamp:Date.now()}),0}catch(G){if(typeof Ot>"u"||G.name!=="ErrnoError")throw G;return-G.Ka}},b:function(p,v,I){cn=I;try{var G=Nt(p);switch(v){case 0:var ne=ur();if(0>ne)return-28;for(;gn[ne];)ne++;return Ia(G,ne).fd;case 1:case 2:return 0;case 3:return G.flags;case 4:return ne=ur(),G.flags|=ne,0;case 5:return ne=ur(),q[ne+0>>1]=2,0;case 6:case 7:return 0;case 16:case 8:return-28;case 9:return W[_s()>>2]=28,-1;default:return-28}}catch(Ee){if(typeof Ot>"u"||Ee.name!=="ErrnoError")throw Ee;return-Ee.Ka}},f:function(p,v){try{var I=Nt(p);return Ss(Bt,I.path,v)}catch(G){if(typeof Ot>"u"||G.name!=="ErrnoError")throw G;return-G.Ka}},n:function(p,v,I){v=dr(v,I);try{if(isNaN(v))return 61;var G=Nt(p);if((G.flags&2097155)===0)throw new Ye(28);return Sa(G.node,v),0}catch(ne){if(typeof Ot>"u"||ne.name!=="ErrnoError")throw ne;return-ne.Ka}},C:function(p,v){try{if(v===0)return-28;var I=Xe("/")+1;return v<I?-68:(qe("/",K,p,v),I)}catch(G){if(typeof Ot>"u"||G.name!=="ErrnoError")throw G;return-G.Ka}},F:function(p,v){try{return p=p?ae(K,p):"",Ss(mi,p,v)}catch(I){if(typeof Ot>"u"||I.name!=="ErrnoError")throw I;return-I.Ka}},z:function(p,v,I){try{return v=v?ae(K,v):"",v=Pn(p,v),v=de(v),v[v.length-1]==="/"&&(v=v.substr(0,v.length-1)),yn(v,I),0}catch(G){if(typeof Ot>"u"||G.name!=="ErrnoError")throw G;return-G.Ka}},E:function(p,v,I,G){try{v=v?ae(K,v):"";var ne=G&256;return v=Pn(p,v,G&4096),Ss(ne?mi:Bt,v,I)}catch(Ee){if(typeof Ot>"u"||Ee.name!=="ErrnoError")throw Ee;return-Ee.Ka}},y:function(p,v,I,G){cn=G;try{v=v?ae(K,v):"",v=Pn(p,v);var ne=G?ur():0;return zn(v,I,ne).fd}catch(Ee){if(typeof Ot>"u"||Ee.name!=="ErrnoError")throw Ee;return-Ee.Ka}},w:function(p,v,I,G){try{if(v=v?ae(K,v):"",v=Pn(p,v),0>=G)return-28;var ne=Ma(v),Ee=Math.min(G,Xe(ne)),De=H[I+Ee];return qe(ne,K,I,G+1),H[I+Ee]=De,Ee}catch(nt){if(typeof Ot>"u"||nt.name!=="ErrnoError")throw nt;return-nt.Ka}},v:function(p){try{return p=p?ae(K,p):"",Ra(p),0}catch(v){if(typeof Ot>"u"||v.name!=="ErrnoError")throw v;return-v.Ka}},G:function(p,v){try{return p=p?ae(K,p):"",Ss(Bt,p,v)}catch(I){if(typeof Ot>"u"||I.name!=="ErrnoError")throw I;return-I.Ka}},r:function(p,v,I){try{return v=v?ae(K,v):"",v=Pn(p,v),I===0?cr(v):I===512?Ra(v):ie("Invalid flags passed to unlinkat"),0}catch(G){if(typeof Ot>"u"||G.name!=="ErrnoError")throw G;return-G.Ka}},q:function(p,v,I){try{if(v=v?ae(K,v):"",v=Pn(p,v,!0),I){var G=A[I>>2]+4294967296*W[I+4>>2],ne=W[I+8>>2];Ee=1e3*G+ne/1e6,I+=16,G=A[I>>2]+4294967296*W[I+4>>2],ne=W[I+8>>2],De=1e3*G+ne/1e6}else var Ee=Date.now(),De=Ee;p=Ee;var nt=sn(v,{Sa:!0}).node;return nt.Ga.Oa(nt,{timestamp:Math.max(p,De)}),0}catch(yt){if(typeof Ot>"u"||yt.name!=="ErrnoError")throw yt;return-yt.Ka}},l:function(p,v,I){p=new Date(1e3*dr(p,v)),W[I>>2]=p.getSeconds(),W[I+4>>2]=p.getMinutes(),W[I+8>>2]=p.getHours(),W[I+12>>2]=p.getDate(),W[I+16>>2]=p.getMonth(),W[I+20>>2]=p.getFullYear()-1900,W[I+24>>2]=p.getDay(),v=p.getFullYear(),W[I+28>>2]=(v%4!==0||v%100===0&&v%400!==0?fr:bi)[p.getMonth()]+p.getDate()-1|0,W[I+36>>2]=-(60*p.getTimezoneOffset()),v=new Date(p.getFullYear(),6,1).getTimezoneOffset();var G=new Date(p.getFullYear(),0,1).getTimezoneOffset();W[I+32>>2]=(v!=G&&p.getTimezoneOffset()==Math.min(G,v))|0},j:function(p,v,I,G,ne,Ee,De,nt){ne=dr(ne,Ee);try{if(isNaN(ne))return 61;var yt=Nt(G);if((v&2)!==0&&(I&2)===0&&(yt.flags&2097155)!==2)throw new Ye(2);if((yt.flags&2097155)===1)throw new Ye(2);if(!yt.Ha.bb)throw new Ye(43);var lt=yt.Ha.bb(yt,p,ne,v,I),Ft=lt.Db;return W[De>>2]=lt.ub,A[nt>>2]=Ft,0}catch(qt){if(typeof Ot>"u"||qt.name!=="ErrnoError")throw qt;return-qt.Ka}},k:function(p,v,I,G,ne,Ee,De){Ee=dr(Ee,De);try{if(isNaN(Ee))return 61;var nt=Nt(ne);if(I&2){if((nt.node.mode&61440)!==32768)throw new Ye(43);if(!(G&2)){var yt=K.slice(p,p+v);nt.Ha.cb&&nt.Ha.cb(nt,yt,Ee,v,G)}}}catch(lt){if(typeof Ot>"u"||lt.name!=="ErrnoError")throw lt;return-lt.Ka}},s:(p,v,I)=>{function G(yt){return(yt=yt.toTimeString().match(/\(([A-Za-z ]+)\)$/))?yt[1]:"GMT"}var ne=new Date().getFullYear(),Ee=new Date(ne,0,1),De=new Date(ne,6,1);ne=Ee.getTimezoneOffset();var nt=De.getTimezoneOffset();A[p>>2]=60*Math.max(ne,nt),W[v>>2]=+(ne!=nt),p=G(Ee),v=G(De),p=vi(p),v=vi(v),nt<ne?(A[I>>2]=p,A[I+4>>2]=v):(A[I>>2]=v,A[I+4>>2]=p)},d:()=>Date.now(),t:()=>2147483648,c:()=>performance.now(),o:p=>{var v=K.length;if(p>>>=0,2147483648<p)return!1;for(var I=1;4>=I;I*=2){var G=v*(1+.2/I);G=Math.min(G,p+100663296);var ne=Math;G=Math.max(p,G);e:{ne=(ne.min.call(ne,2147483648,G+(65536-G%65536)%65536)-J.buffer.byteLength+65535)/65536;try{J.grow(ne),Q();var Ee=1;break e}catch{}Ee=void 0}if(Ee)return!0}return!1},A:(p,v)=>{var I=0;return za().forEach((G,ne)=>{var Ee=v+I;for(ne=A[p+4*ne>>2]=Ee,Ee=0;Ee<G.length;++Ee)H[ne++>>0]=G.charCodeAt(Ee);H[ne>>0]=0,I+=G.length+1}),0},B:(p,v)=>{var I=za();A[p>>2]=I.length;var G=0;return I.forEach(ne=>G+=ne.length+1),A[v>>2]=G,0},e:function(p){try{var v=Nt(p);return pi(v),0}catch(I){if(typeof Ot>"u"||I.name!=="ErrnoError")throw I;return I.Ka}},p:function(p,v){try{var I=Nt(p);return H[v>>0]=I.tty?2:xn(I.mode)?3:(I.mode&61440)===40960?7:4,q[v+2>>1]=0,k=[0,(Re=0,1<=+Math.abs(Re)?0<Re?+Math.floor(Re/4294967296)>>>0:~~+Math.ceil((Re-+(~~Re>>>0))/4294967296)>>>0:0)],W[v+8>>2]=k[0],W[v+12>>2]=k[1],k=[0,(Re=0,1<=+Math.abs(Re)?0<Re?+Math.floor(Re/4294967296)>>>0:~~+Math.ceil((Re-+(~~Re>>>0))/4294967296)>>>0:0)],W[v+16>>2]=k[0],W[v+20>>2]=k[1],0}catch(G){if(typeof Ot>"u"||G.name!=="ErrnoError")throw G;return G.Ka}},x:function(p,v,I,G){try{e:{var ne=Nt(p);p=v;for(var Ee,De=v=0;De<I;De++){var nt=A[p>>2],yt=A[p+4>>2];p+=8;var lt=xi(ne,H,nt,yt,Ee);if(0>lt){var Ft=-1;break e}if(v+=lt,lt<yt)break;typeof Ee<"u"&&(Ee+=lt)}Ft=v}return A[G>>2]=Ft,0}catch(qt){if(typeof Ot>"u"||qt.name!=="ErrnoError")throw qt;return qt.Ka}},m:function(p,v,I,G,ne){v=dr(v,I);try{if(isNaN(v))return 61;var Ee=Nt(p);return gi(Ee,v,G),k=[Ee.position>>>0,(Re=Ee.position,1<=+Math.abs(Re)?0<Re?+Math.floor(Re/4294967296)>>>0:~~+Math.ceil((Re-+(~~Re>>>0))/4294967296)>>>0:0)],W[ne>>2]=k[0],W[ne+4>>2]=k[1],Ee.hb&&v===0&&G===0&&(Ee.hb=null),0}catch(De){if(typeof Ot>"u"||De.name!=="ErrnoError")throw De;return De.Ka}},D:function(p){var I;try{var v=Nt(p);return(I=v.Ha)!=null&&I.fsync?v.Ha.fsync(v):0}catch(G){if(typeof Ot>"u"||G.name!=="ErrnoError")throw G;return G.Ka}},u:function(p,v,I,G){try{e:{var ne=Nt(p);p=v;for(var Ee,De=v=0;De<I;De++){var nt=A[p>>2],yt=A[p+4>>2];p+=8;var lt=bl(ne,H,nt,yt,Ee);if(0>lt){var Ft=-1;break e}v+=lt,typeof Ee<"u"&&(Ee+=lt)}Ft=v}return A[G>>2]=Ft,0}catch(qt){if(typeof Ot>"u"||qt.name!=="ErrnoError")throw qt;return qt.Ka}}},We=function(){var I;function p(G){var ne;return We=G.exports,J=We.I,Q(),an=We.Aa,ee.unshift(We.J),L--,(ne=d.monitorRunDependencies)==null||ne.call(d,L),L==0&&se&&(G=se,se=null,G()),We}var v={a:gr};if(L++,(I=d.monitorRunDependencies)==null||I.call(d,L),d.instantiateWasm)try{return d.instantiateWasm(v,p)}catch(G){return $(`Module.instantiateWasm callback failed with error: ${G}`),!1}return Pe(v,function(G){p(G.instance)}),{}}();d._sqlite3_free=p=>(d._sqlite3_free=We.K)(p),d._sqlite3_value_text=p=>(d._sqlite3_value_text=We.L)(p);var _s=()=>(_s=We.M)();d._sqlite3_prepare_v2=(p,v,I,G,ne)=>(d._sqlite3_prepare_v2=We.N)(p,v,I,G,ne),d._sqlite3_step=p=>(d._sqlite3_step=We.O)(p),d._sqlite3_reset=p=>(d._sqlite3_reset=We.P)(p),d._sqlite3_exec=(p,v,I,G,ne)=>(d._sqlite3_exec=We.Q)(p,v,I,G,ne),d._sqlite3_finalize=p=>(d._sqlite3_finalize=We.R)(p),d._sqlite3_column_name=(p,v)=>(d._sqlite3_column_name=We.S)(p,v),d._sqlite3_column_text=(p,v)=>(d._sqlite3_column_text=We.T)(p,v),d._sqlite3_column_type=(p,v)=>(d._sqlite3_column_type=We.U)(p,v),d._sqlite3_errmsg=p=>(d._sqlite3_errmsg=We.V)(p),d._sqlite3_clear_bindings=p=>(d._sqlite3_clear_bindings=We.W)(p),d._sqlite3_value_blob=p=>(d._sqlite3_value_blob=We.X)(p),d._sqlite3_value_bytes=p=>(d._sqlite3_value_bytes=We.Y)(p),d._sqlite3_value_double=p=>(d._sqlite3_value_double=We.Z)(p),d._sqlite3_value_int=p=>(d._sqlite3_value_int=We._)(p),d._sqlite3_value_type=p=>(d._sqlite3_value_type=We.$)(p),d._sqlite3_result_blob=(p,v,I,G)=>(d._sqlite3_result_blob=We.aa)(p,v,I,G),d._sqlite3_result_double=(p,v)=>(d._sqlite3_result_double=We.ba)(p,v),d._sqlite3_result_error=(p,v,I)=>(d._sqlite3_result_error=We.ca)(p,v,I),d._sqlite3_result_int=(p,v)=>(d._sqlite3_result_int=We.da)(p,v),d._sqlite3_result_int64=(p,v,I)=>(d._sqlite3_result_int64=We.ea)(p,v,I),d._sqlite3_result_null=p=>(d._sqlite3_result_null=We.fa)(p),d._sqlite3_result_text=(p,v,I,G)=>(d._sqlite3_result_text=We.ga)(p,v,I,G),d._sqlite3_aggregate_context=(p,v)=>(d._sqlite3_aggregate_context=We.ha)(p,v),d._sqlite3_column_count=p=>(d._sqlite3_column_count=We.ia)(p),d._sqlite3_data_count=p=>(d._sqlite3_data_count=We.ja)(p),d._sqlite3_column_blob=(p,v)=>(d._sqlite3_column_blob=We.ka)(p,v),d._sqlite3_column_bytes=(p,v)=>(d._sqlite3_column_bytes=We.la)(p,v),d._sqlite3_column_double=(p,v)=>(d._sqlite3_column_double=We.ma)(p,v),d._sqlite3_bind_blob=(p,v,I,G,ne)=>(d._sqlite3_bind_blob=We.na)(p,v,I,G,ne),d._sqlite3_bind_double=(p,v,I)=>(d._sqlite3_bind_double=We.oa)(p,v,I),d._sqlite3_bind_int=(p,v,I)=>(d._sqlite3_bind_int=We.pa)(p,v,I),d._sqlite3_bind_text=(p,v,I,G,ne)=>(d._sqlite3_bind_text=We.qa)(p,v,I,G,ne),d._sqlite3_bind_parameter_index=(p,v)=>(d._sqlite3_bind_parameter_index=We.ra)(p,v),d._sqlite3_sql=p=>(d._sqlite3_sql=We.sa)(p),d._sqlite3_normalized_sql=p=>(d._sqlite3_normalized_sql=We.ta)(p),d._sqlite3_changes=p=>(d._sqlite3_changes=We.ua)(p),d._sqlite3_close_v2=p=>(d._sqlite3_close_v2=We.va)(p),d._sqlite3_create_function_v2=(p,v,I,G,ne,Ee,De,nt,yt)=>(d._sqlite3_create_function_v2=We.wa)(p,v,I,G,ne,Ee,De,nt,yt),d._sqlite3_open=(p,v)=>(d._sqlite3_open=We.xa)(p,v);var Vr=d._malloc=p=>(Vr=d._malloc=We.ya)(p),ja=d._free=p=>(ja=d._free=We.za)(p);d._RegisterExtensionFunctions=p=>(d._RegisterExtensionFunctions=We.Ba)(p);var Jn=(p,v)=>(Jn=We.Ca)(p,v),Fa=()=>(Fa=We.Da)(),oa=p=>(oa=We.Ea)(p),un=p=>(un=We.Fa)(p);d.stackAlloc=un,d.stackSave=Fa,d.stackRestore=oa,d.cwrap=(p,v,I,G)=>{var ne=!I||I.every(Ee=>Ee==="number"||Ee==="boolean");return v!=="string"&&ne&&!G?d["_"+p]:function(){return vl(p,v,I,arguments)}},d.addFunction=pr,d.removeFunction=Ea,d.UTF8ToString=fe,d.ALLOC_NORMAL=hr,d.allocate=Ns,d.allocateUTF8OnStack=js;var xr;se=function p(){xr||Kr(),xr||(se=p)};function Kr(){function p(){if(!xr&&(xr=!0,d.calledRun=!0,!Y)){if(d.noFSInit||$n||($n=!0,Jr(),d.stdin=d.stdin,d.stdout=d.stdout,d.stderr=d.stderr,d.stdin?ln("stdin",d.stdin):wa("/dev/tty","/dev/stdin"),d.stdout?ln("stdout",null,d.stdout):wa("/dev/tty","/dev/stdout"),d.stderr?ln("stderr",null,d.stderr):wa("/dev/tty1","/dev/stderr"),zn("/dev/stdin",0),zn("/dev/stdout",1),zn("/dev/stderr",1)),lr=!1,xe(ee),d.onRuntimeInitialized&&d.onRuntimeInitialized(),d.postRun)for(typeof d.postRun=="function"&&(d.postRun=[d.postRun]);d.postRun.length;){var v=d.postRun.shift();V.unshift(v)}xe(V)}}if(!(0<L)){if(d.preRun)for(typeof d.preRun=="function"&&(d.preRun=[d.preRun]);d.preRun.length;)E();xe(ue),0<L||(d.setStatus?(d.setStatus("Running..."),setTimeout(function(){setTimeout(function(){d.setStatus("")},1),p()},1)):p())}}if(d.preInit)for(typeof d.preInit=="function"&&(d.preInit=[d.preInit]);0<d.preInit.length;)d.preInit.pop()();return Kr(),m}),l)};r.exports=u,r.exports.default=u}(hd)),hd.exports}var cb=ob();const ub=gl(cb);function tx(r){return new Promise((g,l)=>{const u=new Worker(new URL("/CogniFlow/assets/ankiImport.worker-iea3fFsE.js",import.meta.url),{type:"module"});u.onmessage=f=>{const{status:i,decks:o,error:m}=f.data;i==="success"?g(o):l(new Error(m)),u.terminate()},u.onerror=f=>{console.error("Worker error:",f);const i=f.message||"The worker script could not be loaded or an unexpected error occurred.";l(new Error(`Anki import worker failed: ${i}`)),u.terminate()},u.postMessage(r,[r])})}let pd=null;async function db(){return pd||(pd=await ub({locateFile:r=>`https://esm.sh/sql.js@1.10.3/dist/${r}`})),pd}function gp(r,g){let l=r;return l=l.replace(/<img\s[^>]*?src=(["'])(.*?)\1[^>]*?>/gi,(u,f,i)=>{const o=decodeURIComponent(i),m=g.get(o);if(m){const x=btoa(new Uint8Array(m.data).reduce((j,y)=>j+String.fromCharCode(y),"")),d=`src="data:${m.type};base64,${x}"`;return u.replace(/src=(["']).*?\1/i,d)}return u}),l=l.replace(/\[sound:(.*?)\]/g,(u,f)=>{const i=decodeURIComponent(f.trim()),o=g.get(i);if(o){const m=btoa(new Uint8Array(o.data).reduce((x,d)=>x+String.fromCharCode(d),""));return o.type.startsWith("video/")?`<video controls playsinline src="data:${o.type};base64,${m}"></video>`:`<audio controls src="data:${o.type};base64,${m}"></audio>`}return""}),l}function xp(r,g,l,u,f){let i=r;const o=/{{c(\d+)::(.*?)(?:::(.*?))?}}/gs;i=i.replace(o,(j,y,_,b)=>{const D=parseInt(y,10);return u?D===l+1?`<span class="cloze">[${b||"..."}]</span>`:`<span class="cloze-inactive">${_}</span>`:D===l+1?`<span class="cloze"><b>${_}</b></span>`:`<span class="cloze-inactive">${_}</span>`}),f&&(i=i.replace(/<hr id=answer>/g,"").replace(/{{FrontSide}}/g,f));const m=/{{#([^}]+?)}}(.*?){{\/\1}}/gs;let x;do x=i,i=i.replace(m,(j,y,_)=>{const b=g.get(y.trim());return b&&b.trim()!==""?_:""});while(i!==x);const d=/{{\^([^}]+?)}}(.*?){{\/\1}}/gs;do x=i,i=i.replace(d,(j,y,_)=>{const b=g.get(y.trim());return!b||b.trim()===""?_:""});while(i!==x);return g.forEach((j,y)=>{const _=new RegExp(`{{${y}}}`,"g");i=i.replace(_,j)}),i=i.replace(/{{(.*?)}}/g,""),i}async function nx(r){var M;const g=await db(),l=await sb.loadAsync(r),u=l.file(/collection.anki2[1]?/);if(!u||u.length===0)throw new Error("collection.anki2 or .anki21 file not found.");const f=await u[0].async("uint8array"),i=new g.Database(f),o=l.file("media");let m={};if(o)try{m=JSON.parse(await o.async("string"))}catch(R){console.warn("Could not parse media file.",R)}const x=new Map;for(const R in m){const $=m[R],X=l.file(R);if(X){const J=await X.async("uint8array"),Y=((M=$.split(".").pop())==null?void 0:M.toLowerCase())||"";let H="application/octet-stream";["jpg","jpeg"].includes(Y)?H="image/jpeg":Y==="png"?H="image/png":Y==="gif"?H="image/gif":Y==="svg"?H="image/svg+xml":Y==="mp3"?H="audio/mpeg":Y==="ogg"?H="audio/ogg":Y==="wav"?H="audio/wav":Y==="m4a"?H="audio/mp4":Y==="opus"?H="audio/opus":Y==="mp4"?H="video/mp4":Y==="webm"?H="video/webm":Y==="ogv"&&(H="video/ogg"),x.set($,{data:J,type:H})}}const d=i.exec("SELECT models, decks, crt FROM col");if(!d[0])throw new Error("Could not read collection data.");const[j,y,_]=d[0].values[0],b=JSON.parse(j),D=JSON.parse(y),w=i.exec("SELECT id, mid, flds FROM notes"),N=new Map(w[0].values.map(R=>[R[0],{mid:R[1],flds:R[2].split("")}])),O=i.exec("SELECT id, nid, did, ord, due, ivl, factor, type, lapses FROM cards")[0].values,C=new Map;for(const R in D){const $=D[R];C.set(R,{id:crypto.randomUUID(),name:$.name,description:$.desc||"Imported Anki deck.",type:Ce.Flashcard,cards:[]})}for(const R of O){const[$,X,J,Y,H,K,q,W,A]=R,B=N.get(X);if(!B)continue;const z=b[B.mid];if(!(z!=null&&z.tmpls))continue;const Q=C.get(J.toString());if(!Q)continue;const ue=z.tmpls[Y];if(!ue)continue;const ee=new Map((z.flds||[]).map((oe,Ne)=>[oe.name,B.flds[Ne]||""]));let V=xp(ue.qfmt,ee,Y,!0),E=xp(ue.afmt,ee,Y,!1,V);V=gp(V,x),E=gp(E,x);let L,se;W===2&&K>0?(L=new Date(_*1e3),L.setDate(L.getDate()+H),se=new Date(L.getTime()),se.setDate(se.getDate()-K)):(L=new Date,L.setHours(0,0,0,0));const ie=Math.min(1,Math.log1p(K)/Math.log1p(90));Q.cards.push({id:$.toString(),front:V,back:E,css:z.css?`<style>${z.css}</style>`:"",dueDate:L.toISOString(),interval:K,easeFactor:q?Math.max(q/1e3,jd):Gr,masteryLevel:ie,lastReviewed:se==null?void 0:se.toISOString(),lapses:A||0})}return i.close(),Array.from(C.values()).filter(R=>R.cards.length>0)}const fb={},yp=r=>{let g;const l=new Set,u=(j,y)=>{const _=typeof j=="function"?j(g):j;if(!Object.is(_,g)){const b=g;g=y??(typeof _!="object"||_===null)?_:Object.assign({},g,_),l.forEach(D=>D(g,b))}},f=()=>g,x={setState:u,getState:f,getInitialState:()=>d,subscribe:j=>(l.add(j),()=>l.delete(j)),destroy:()=>{(fb?"production":void 0)!=="production"&&console.warn("[DEPRECATED] The `destroy` method will be unsupported in a future version. Instead use unsubscribe function returned by subscribe. Everything will be garbage-collected if store is garbage-collected."),l.clear()}},d=g=r(u,f,x);return x},hb=r=>r?yp(r):yp;var gd={exports:{}},xd={},yd={exports:{}},bd={};/**
 * @license React
 * use-sync-external-store-shim.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var bp;function mb(){if(bp)return bd;bp=1;var r=xl();function g(y,_){return y===_&&(y!==0||1/y===1/_)||y!==y&&_!==_}var l=typeof Object.is=="function"?Object.is:g,u=r.useState,f=r.useEffect,i=r.useLayoutEffect,o=r.useDebugValue;function m(y,_){var b=_(),D=u({inst:{value:b,getSnapshot:_}}),w=D[0].inst,N=D[1];return i(function(){w.value=b,w.getSnapshot=_,x(w)&&N({inst:w})},[y,b,_]),f(function(){return x(w)&&N({inst:w}),y(function(){x(w)&&N({inst:w})})},[y]),o(b),b}function x(y){var _=y.getSnapshot;y=y.value;try{var b=_();return!l(y,b)}catch{return!0}}function d(y,_){return _()}var j=typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"?d:m;return bd.useSyncExternalStore=r.useSyncExternalStore!==void 0?r.useSyncExternalStore:j,bd}var vp;function pb(){return vp||(vp=1,yd.exports=mb()),yd.exports}/**
 * @license React
 * use-sync-external-store-shim/with-selector.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var wp;function gb(){if(wp)return xd;wp=1;var r=xl(),g=pb();function l(d,j){return d===j&&(d!==0||1/d===1/j)||d!==d&&j!==j}var u=typeof Object.is=="function"?Object.is:l,f=g.useSyncExternalStore,i=r.useRef,o=r.useEffect,m=r.useMemo,x=r.useDebugValue;return xd.useSyncExternalStoreWithSelector=function(d,j,y,_,b){var D=i(null);if(D.current===null){var w={hasValue:!1,value:null};D.current=w}else w=D.current;D=m(function(){function S($){if(!O){if(O=!0,C=$,$=_($),b!==void 0&&w.hasValue){var X=w.value;if(b(X,$))return M=X}return M=$}if(X=M,u(C,$))return X;var J=_($);return b!==void 0&&b(X,J)?X:(C=$,M=J)}var O=!1,C,M,R=y===void 0?null:y;return[function(){return S(j())},R===null?void 0:function(){return S(R())}]},[j,y,_,b]);var N=f(d,D[0],D[1]);return o(function(){w.hasValue=!0,w.value=N},[N]),x(N),N},xd}var Sp;function xb(){return Sp||(Sp=1,gd.exports=gb()),gd.exports}var yb=xb();const bb=gl(yb),ax={},{useDebugValue:vb}=Hr,{useSyncExternalStoreWithSelector:wb}=bb;let Ep=!1;const Sb=r=>r;function Eb(r,g=Sb,l){(ax?"production":void 0)!=="production"&&l&&!Ep&&(console.warn("[DEPRECATED] Use `createWithEqualityFn` instead of `create` or use `useStoreWithEqualityFn` instead of `useStore`. They can be imported from 'zustand/traditional'. https://github.com/pmndrs/zustand/discussions/1937"),Ep=!0);const u=wb(r.subscribe,r.getState,r.getServerState||r.getInitialState,g,l);return vb(u),u}const jb=r=>{(ax?"production":void 0)!=="production"&&typeof r!="function"&&console.warn("[DEPRECATED] Passing a vanilla store will be unsupported in a future version. Instead use `import { useStore } from 'zustand'`.");const g=typeof r=="function"?hb(r):r,l=(u,f)=>Eb(g,u,f);return Object.assign(l,g),l},Nb=r=>jb;function _b(r,g){var u,f;const l={...r,lastModified:Date.now()};switch(g.type){case"SET_LOADING":return{...r,isLoading:g.payload};case"SET_SERIES_PROGRESS":return{...r,seriesProgress:g.payload};case"LOAD_DATA":return{...r,...g.payload,isLoading:!1,lastModified:null};case"SET_AI_GENERATION_STATUS":return{...r,aiGenerationStatus:{...r.aiGenerationStatus,...g.payload}};case"ADD_AI_TASK_TO_QUEUE":{const i=Array.isArray(r.aiGenerationStatus.queue)?r.aiGenerationStatus.queue:[];return{...r,aiGenerationStatus:{...r.aiGenerationStatus,queue:[...i,g.payload]}}}case"START_NEXT_AI_TASK":{const o=(Array.isArray(r.aiGenerationStatus.queue)?r.aiGenerationStatus.queue:[]).slice(1),{task:m,abortController:x}=g.payload;return{...r,aiGenerationStatus:{...r.aiGenerationStatus,queue:o,currentTask:{...m,abortController:x}}}}case"UPDATE_CURRENT_AI_TASK_STATUS":{if(!r.aiGenerationStatus.currentTask)return r;const{statusText:i,deckId:o,seriesId:m}=g.payload,x={...r.aiGenerationStatus.currentTask,statusText:i,deckId:o,seriesId:m};return{...r,aiGenerationStatus:{...r.aiGenerationStatus,currentTask:x}}}case"FINISH_CURRENT_AI_TASK":return{...r,aiGenerationStatus:{...r.aiGenerationStatus,currentTask:null}};case"CANCEL_AI_TASK":if((u=g.payload)!=null&&u.taskId){const i=Array.isArray(r.aiGenerationStatus.queue)?r.aiGenerationStatus.queue:[];return{...r,aiGenerationStatus:{...r.aiGenerationStatus,queue:i.filter(o=>o.id!==g.payload.taskId)}}}else return(f=r.aiGenerationStatus.currentTask)==null||f.abortController.abort(),{...r,aiGenerationStatus:{...r.aiGenerationStatus,currentTask:null}};case"SET_AI_CHAT_HISTORY":return{...r,aiChatHistory:g.payload};case"ADD_DECKS":{const i=new Map(r.decks.map(o=>[o.id,o]));return g.payload.forEach(o=>i.set(o.id,o)),{...l,decks:Array.from(i.values())}}case"RESTORE_DATA":{const{decks:i,folders:o,deckSeries:m}=g.payload,x=new Map(r.decks.map(y=>[y.id,y]));i.forEach(y=>x.set(y.id,y));const d=new Map(r.folders.map(y=>[y.id,y]));o.forEach(y=>d.set(y.id,y));const j=new Map(r.deckSeries.map(y=>[y.id,y]));return m.forEach(y=>j.set(y.id,y)),{...l,decks:Array.from(x.values()),folders:Array.from(d.values()),deckSeries:Array.from(j.values())}}case"DELETE_DECK":return{...l,decks:r.decks.filter(i=>i.id!==g.payload),deckSeries:r.deckSeries.map(i=>i.levels?{...i,levels:(i.levels||[]).filter(o=>!!o).map(o=>({...o,deckIds:(o.deckIds||[]).filter(m=>m!==g.payload)}))}:i)};case"UPDATE_DECK":return{...l,decks:r.decks.map(i=>i.id===g.payload.id?g.payload:i)};case"BULK_UPDATE_DECKS":{const i=new Map(r.decks.map(o=>[o.id,o]));return g.payload.forEach(o=>i.set(o.id,o)),{...l,decks:Array.from(i.values())}}case"ADD_FOLDER":return{...l,folders:[...r.folders,g.payload]};case"ADD_FOLDERS":{const i=new Map(r.folders.map(o=>[o.id,o]));return g.payload.forEach(o=>i.set(o.id,o)),{...l,folders:Array.from(i.values())}}case"UPDATE_FOLDER":return{...l,folders:r.folders.map(i=>i.id===g.payload.id?g.payload:i)};case"DELETE_FOLDER":return{...l,folders:r.folders.filter(i=>i.id!==g.payload),decks:r.decks.map(i=>i.folderId===g.payload?{...i,folderId:null}:i)};case"ADD_SERIES":{const i=new Map(r.deckSeries.map(o=>[o.id,o]));return i.set(g.payload.id,g.payload),{...l,deckSeries:Array.from(i.values())}}case"ADD_SERIES_WITH_DECKS":{const{series:i,decks:o}=g.payload,m=new Map(r.decks.map(d=>[d.id,d]));o.forEach(d=>m.set(d.id,d));const x=new Map(r.deckSeries.map(d=>[d.id,d]));return x.set(i.id,i),{...l,decks:Array.from(m.values()),deckSeries:Array.from(x.values())}}case"UPDATE_SERIES":return{...l,deckSeries:r.deckSeries.map(i=>i.id===g.payload.id?g.payload:i)};case"DELETE_SERIES":return{...l,deckSeries:r.deckSeries.filter(i=>i.id!==g.payload)};default:return r}}const kb={decks:[],folders:[],deckSeries:[],seriesProgress:new Map,isLoading:!0,lastModified:null,aiGenerationStatus:{isGenerating:!1,statusText:null,generatingDeckId:null,generatingSeriesId:null,queue:[],currentTask:null},aiChatHistory:[]},et=Nb()(r=>({...kb,dispatch:g=>r(l=>_b(l,g))})),Ab=r=>{const g=new Date;g.setHours(23,59,59,999);const l=(r.type===Ce.Quiz||r.type==="learning"?r.questions:r.cards)||[];return Array.isArray(l)?l.filter(u=>!u.suspended&&new Date(u.dueDate).getTime()<=g.getTime()).length:0},Tb=()=>et(r=>r.deckSeries.filter(g=>!g.archived&&!g.deletedAt)),rx=()=>et(r=>{const g=new Set;return r.deckSeries.forEach(l=>{(l.levels||[]).forEach(u=>((u==null?void 0:u.deckIds)||[]).forEach(f=>g.add(f)))}),r.decks.filter(l=>!l.archived&&!l.deletedAt&&!g.has(l.id))}),Cb=()=>et(r=>{const g=new Set;return r.deckSeries.forEach(l=>{var u;if(!l.archived&&!l.deletedAt){const f=((u=r.seriesProgress.get(l.id))==null?void 0:u.size)||0;let i=0;(l.levels||[]).filter(Boolean).forEach(o=>{(o.deckIds||[]).forEach(m=>{i<=f&&g.add(m),i++})})}}),r.decks.reduce((l,u)=>u.archived||u.deletedAt||(u.type===Ce.Quiz||u.type===Ce.Learning)&&r.deckSeries.some(i=>(i.levels||[]).some(o=>{var m;return(m=o.deckIds)==null?void 0:m.includes(u.id)}))&&!g.has(u.id)?l:l+Ab(u),0)}),aa=(r,g,l)=>{const u=new Date;u.setHours(0,0,0,0);const f=g.map(o=>({id:crypto.randomUUID(),text:o.text,explanation:o.explanation})),i=f[g.findIndex(o=>o.correct)];if(!i)throw new Error(`No correct option specified for question: "${r}"`);return{id:crypto.randomUUID(),questionType:"multipleChoice",questionText:r,tags:["nature","sample"],detailedExplanation:l,options:f,correctAnswerId:i.id,dueDate:u.toISOString(),interval:0,easeFactor:Gr,suspended:!1,masteryLevel:0,lastReviewed:void 0}},Db=()=>{const r={id:crypto.randomUUID(),name:"Level 1.1: Simple Addition",description:"Practice basic addition problems.",type:Ce.Quiz,questions:[aa("What is 1 + 1?",[{text:"2",correct:!0},{text:"1"},{text:"3"}],"1 plus 1 equals 2."),aa("What is 2 + 3?",[{text:"5",correct:!0},{text:"4"},{text:"6"}],"2 plus 3 equals 5."),aa("What is 5 + 4?",[{text:"9",correct:!0},{text:"8"},{text:"10"}],"5 plus 4 equals 9.")]},g={id:crypto.randomUUID(),name:"Level 1.2: Simple Subtraction",description:"Practice basic subtraction problems.",type:Ce.Quiz,questions:[aa("What is 5 - 2?",[{text:"3",correct:!0},{text:"2"},{text:"4"}],"5 minus 2 equals 3."),aa("What is 10 - 4?",[{text:"6",correct:!0},{text:"5"},{text:"7"}],"10 minus 4 equals 6.")]},l={id:crypto.randomUUID(),name:"Level 2.1: Simple Multiplication",description:"Practice basic multiplication problems.",type:Ce.Quiz,questions:[aa("What is 2 * 3?",[{text:"6",correct:!0},{text:"5"},{text:"8"}],"2 times 3 is 6."),aa("What is 4 * 5?",[{text:"20",correct:!0},{text:"15"},{text:"25"}],"4 times 5 is 20.")]},u=[r,g,l];return{series:{id:crypto.randomUUID(),type:"series",name:"Sample: Basic Math Series",description:"A sample series to demonstrate the progressive learning path feature. Complete each deck to unlock the next!",levels:[{title:"Level 1: Fundamentals",deckIds:[r.id,g.id]},{title:"Level 2: Next Steps",deckIds:[l.id]}],createdAt:new Date().toISOString()},decks:u}},Ob=()=>{const r=[aa("Which process allows plants to convert light energy into chemical energy?",[{text:"Respiration"},{text:"Photosynthesis",correct:!0},{text:"Transpiration"},{text:"Germination"}],"Photosynthesis is the vital process used by plants, algae, and certain bacteria to harness energy from sunlight and turn it into chemical energy in the form of glucose."),aa("What is the largest rainforest in the world?",[{text:"The Congo Rainforest"},{text:"The Valdivian Temperate Rainforest"},{text:"The Daintree Rainforest"},{text:"The Amazon Rainforest",correct:!0}],"The Amazon Rainforest is the world's largest tropical rainforest, famed for its biodiversity. It spans across nine countries in South America."),aa("What type of rock is formed from the cooling and solidification of magma or lava?",[{text:"Igneous Rock",correct:!0},{text:"Sedimentary Rock"},{text:"Metamorphic Rock"},{text:"Sandstone"}],"Igneous rock is formed through the cooling and solidification of magma (molten rock below the surface) or lava (molten rock on the surface). Examples include granite and basalt."),aa("Which layer of the Earth's atmosphere is closest to the surface?",[{text:"Stratosphere"},{text:"Mesosphere"},{text:"Troposphere",correct:!0},{text:"Thermosphere"}],"The Troposphere is the lowest layer of Earth's atmosphere, and is also where nearly all weather conditions take place. It contains about 75% of the atmosphere's mass."),aa("What is the name for the process of water movement through a plant and its evaporation from aerial parts, such as leaves, stems and flowers?",[{text:"Condensation"},{text:"Precipitation"},{text:"Transpiration",correct:!0},{text:"Photosynthesis"}],"Transpiration is essentially evaporation of water from plant leaves. It is a key part of the water cycle, and an important process in plant life.")];return{id:crypto.randomUUID(),name:"Sample: Wonders of Nature",description:"A sample quiz deck to introduce you to CogniFlow. Test your knowledge about the natural world!",type:Ce.Quiz,questions:r,lastOpened:new Date().toISOString()}};function sx(r,g){const l=new Blob([r],{type:"application/json"}),u=URL.createObjectURL(l),f=document.createElement("a");f.style.display="none",f.href=u,f.download=g,document.body.appendChild(f),f.click(),window.URL.revokeObjectURL(u),document.body.removeChild(f)}function ix(r){return r.replace(/[^a-z0-9 -]/gi,"_").replace(/\s+/g,"-").toLowerCase().substring(0,30)}const Ib=r=>{let g;const l=`cogniflow-deck-${ix(r.name)}.json`;if(r.type===Ce.Flashcard)g=(r.cards||[]).map(o=>({front:o.front,back:o.back}));else if(r.type===Ce.Quiz||r.type===Ce.Learning){const f=r;g={name:f.name,description:f.description,questions:(f.questions||[]).map(o=>({questionType:o.questionType,questionText:o.questionText,options:(o.options||[]).map(m=>({id:m.id,text:m.text,explanation:m.explanation})),correctAnswerId:o.correctAnswerId,detailedExplanation:o.detailedExplanation,tags:o.tags}))}}else throw new Error(`Unsupported deck type for export: ${r.type}`);const u=JSON.stringify(g,null,2);sx(u,l)},Rb=(r,g)=>{const l=new Map,u=new Set((r.levels||[]).flatMap(x=>(x==null?void 0:x.deckIds)||[]));g.forEach(x=>{u.has(x.id)&&l.set(x.id,x)});const f=(r.levels||[]).map(x=>{const d=(x.deckIds||[]).map(j=>l.get(j)).filter(j=>!!j).map(j=>{if(j.type===Ce.Flashcard){const y=j;return{type:Ce.Flashcard,name:y.name,description:y.description,cards:(y.cards||[]).map(_=>({front:_.front,back:_.back}))}}else if(j.type===Ce.Quiz||j.type===Ce.Learning){const y=j;return{type:Ce.Quiz,name:y.name,description:y.description,questions:(y.questions||[]).map(_=>({questionType:_.questionType,questionText:_.questionText,options:(_.options||[]).map(b=>({id:b.id,text:b.text,explanation:b.explanation})),correctAnswerId:_.correctAnswerId,detailedExplanation:_.detailedExplanation,tags:_.tags}))}}return null}).filter(Boolean);return{title:x.title,decks:d}}),i={seriesName:r.name,seriesDescription:r.description,levels:f},o=`cogniflow-series-${ix(r.name)}.json`,m=JSON.stringify(i,null,2);sx(m,o)},Mb=({triggerSync:r,openConfirmModal:g})=>{const{dispatch:l}=et(),{addToast:u}=Mt(),f=U.useCallback(async O=>{l({type:"ADD_DECKS",payload:O});try{await si(O),r({isManual:!1})}catch(C){u("Error saving new deck(s).","error"),console.error(C)}},[l,u,r]),i=U.useCallback(async(O,C)=>{const M={...O,lastModified:Date.now()};l({type:"UPDATE_DECK",payload:M});try{await kg(M),C!=null&&C.silent||(C!=null&&C.toastMessage&&u(C.toastMessage,"success"),r({isManual:!1}))}catch(R){u(`Error updating deck "${O.name}".`,"error"),console.error(R)}},[l,u,r]),o=U.useCallback(async(O,C)=>{const M=O.map(R=>({...R,lastModified:Date.now()}));l({type:"BULK_UPDATE_DECKS",payload:M});try{await Ed(M),C!=null&&C.silent||r({isManual:!1})}catch{u("Error updating decks.","error")}},[l,r,u]),m=U.useCallback(async(O,C)=>{const M=et.getState().decks.find(R=>R.id===O);M&&(await i({...M,folderId:C}),u("Deck moved.","success"))},[i,u]),x=U.useCallback(async O=>{const C=et.getState().decks.find(M=>M.id===O);if(C){const M={...C,deletedAt:new Date().toISOString(),archived:!1};await i(M,{toastMessage:`Deck "${C.name}" moved to trash.`})}},[i]),d=U.useCallback(async O=>{const C=et.getState().decks.find(M=>M.id===O);C&&await i({...C,deletedAt:null},{toastMessage:`Deck "${C.name}" restored.`})},[i]),j=U.useCallback(async O=>{l({type:"DELETE_DECK",payload:O});try{await Ad(O),u("Deck permanently deleted.","success"),r({isManual:!1})}catch{u("Error deleting deck permanently.","error")}},[l,u,r]),y=U.useCallback(async O=>{if(O.id){const C={id:O.id,name:O.name};l({type:"UPDATE_FOLDER",payload:C});try{await Cg(C),u(`Folder renamed to "${C.name}".`,"success"),r({isManual:!1})}catch{u("Error renaming folder.","error")}}else{const C={id:crypto.randomUUID(),name:O.name};l({type:"ADD_FOLDER",payload:C});try{await Tg(C),u(`Folder "${C.name}" created.`,"success"),r({isManual:!1})}catch{u("Error creating folder.","error")}}},[l,u,r]),_=U.useCallback(async O=>{const C=et.getState().folders.find(M=>M.id===O);C&&g({title:"Delete Folder",message:`Are you sure you want to delete the folder "${C.name}"? Decks inside will be moved to the main list.`,onConfirm:async()=>{l({type:"DELETE_FOLDER",payload:O});try{await Dg(O);const M=et.getState().decks.filter(R=>R.folderId===O);M.length>0&&await Ed(M.map(R=>({...R,folderId:null}))),u(`Folder "${C.name}" deleted.`,"success"),r({isManual:!1})}catch{u("Error deleting folder.","error")}}})},[l,u,r,g]),b=U.useCallback(O=>{const C=et.getState().decks.find(M=>M.id===O);if(C&&C.id!=="general-study-deck"){const M=new Date,R=C.lastOpened?new Date(C.lastOpened):new Date(0);M.getTime()-R.getTime()>5e3&&i({...C,lastOpened:M.toISOString()},{silent:!0})}},[i]),D=U.useCallback(()=>{const O=Ob();f([O]),u(`Sample deck "${O.name}" created.`,"success")},[f,u]),w=U.useCallback(async(O,C)=>{const M=et.getState().decks.find(K=>K.id===O);if(!M)return;const R=M.infoCards||[],X=R.some(K=>K.id===C.infoCard.id)?R.map(K=>K.id===C.infoCard.id?C.infoCard:K):[...R,C.infoCard],J=M.questions||[],Y=new Map(J.map(K=>[K.id,K]));C.questions.forEach(K=>Y.set(K.id,K));const H={...M,infoCards:X,questions:Array.from(Y.values())};await i(H,{toastMessage:"Learning block saved."})},[i]),N=U.useCallback(async(O,C)=>{var H;const M=et.getState().decks.find(K=>K.id===O);if(!M)return;const R=M.infoCards||[],$=R.filter(K=>K.id!==C),X=new Set(((H=R.find(K=>K.id===C))==null?void 0:H.unlocksQuestionIds)||[]),J=(M.questions||[]).filter(K=>!X.has(K.id)),Y={...M,infoCards:$,questions:J};await i(Y,{toastMessage:"Learning block deleted."})},[i]),S=U.useCallback(O=>{try{Ib(O),u(`Deck "${O.name}" exported.`,"success")}catch(C){u(`Failed to export deck: ${C.message}`,"error")}},[u]);return U.useMemo(()=>({handleAddDecks:f,handleUpdateDeck:i,handleBulkUpdateDecks:o,handleMoveDeck:m,handleDeleteDeck:x,handleRestoreDeck:d,handleDeleteDeckPermanently:j,handleSaveFolder:y,handleDeleteFolder:_,updateLastOpened:b,handleCreateSampleDeck:D,handleSaveLearningBlock:w,handleDeleteLearningBlock:N,handleExportDeck:S}),[f,i,o,m,x,d,j,y,_,b,D,w,N,S])},Ub=({triggerSync:r,handleAddDecks:g,handleUpdateDeck:l})=>{const{dispatch:u,decks:f}=et(),{addToast:i}=Mt(),{navigate:o}=ra(),m=U.useCallback(async(S,O)=>{u({type:"ADD_SERIES_WITH_DECKS",payload:{series:S,decks:O}});try{await Bo([S]),await si(O),i(`Series "${S.name}" created with ${O.length} deck(s).`,"success"),o(`/series/${S.id}`),r({isManual:!1})}catch{i("Error creating new series.","error")}},[u,i,o,r]),x=U.useCallback(async(S,O)=>{const C={...S,lastModified:Date.now()};u({type:"UPDATE_SERIES",payload:C});try{await Ig(C),O!=null&&O.silent||(O!=null&&O.toastMessage&&i(O.toastMessage,"success"),r({isManual:!1}))}catch{i(`Error updating series "${S.name}".`,"error")}},[u,i,r]),d=U.useCallback(async S=>{const O=et.getState().deckSeries.find(C=>C.id===S);if(O){const C={...O,deletedAt:new Date().toISOString(),archived:!1};x(C,{toastMessage:`Series "${O.name}" moved to trash.`});const M=new Set((O.levels||[]).flatMap($=>($==null?void 0:$.deckIds)||[])),R=et.getState().decks.filter($=>M.has($.id));for(const $ of R)l({...$,deletedAt:new Date().toISOString(),archived:!1},{silent:!0})}},[x,l]),j=U.useCallback(async S=>{const O=et.getState().deckSeries.find(C=>C.id===S);if(O){x({...O,deletedAt:null},{toastMessage:`Series "${O.name}" restored.`});const C=new Set((O.levels||[]).flatMap(R=>(R==null?void 0:R.deckIds)||[])),M=et.getState().decks.filter(R=>C.has(R.id));for(const R of M)R.deletedAt&&l({...R,deletedAt:null},{silent:!0})}},[x,l]),y=U.useCallback(async S=>{const O=et.getState().deckSeries.find(R=>R.id===S);if(!O)return;const C=new Set((O.levels||[]).flatMap(R=>(R==null?void 0:R.deckIds)||[])),M=et.getState().decks.filter(R=>C.has(R.id));u({type:"DELETE_SERIES",payload:S});for(const R of M)u({type:"DELETE_DECK",payload:R.id});try{await Rg(S);for(const R of M)await Ad(R.id);i("Series and its decks permanently deleted.","success"),r({isManual:!1})}catch{i("Error deleting series permanently.","error")}},[u,i,r]),_=U.useCallback(async S=>{if(S.id){const O=et.getState().deckSeries.find(C=>C.id===S.id);O&&x({...O,name:S.name,description:S.description})}else if(S.scaffold){const{seriesName:O,seriesDescription:C,levels:M}=S.scaffold,R=[],$=(M||[]).map(J=>{const Y=(J.decks||[]).map(H=>{const K={id:crypto.randomUUID(),name:H.name,description:H.description};return H.type===Ce.Quiz?{...K,type:Ce.Quiz,questions:H.questions||[]}:H.type===Ce.Learning?{...K,type:Ce.Learning,questions:H.questions||[],infoCards:H.infoCards||[]}:H.type===Ce.Flashcard?{...K,type:Ce.Flashcard,cards:H.cards||[]}:null}).filter(H=>H!==null);return R.push(...Y),{title:J.title,deckIds:Y.map(H=>H.id)}}),X={id:crypto.randomUUID(),type:"series",name:O,description:C,levels:$,archived:!1,createdAt:new Date().toISOString()};await m(X,R)}else{const O={id:crypto.randomUUID(),type:"series",name:S.name,description:S.description,levels:[],createdAt:new Date().toISOString(),archived:!1};u({type:"ADD_SERIES",payload:O});try{await Bo([O]),i(`Series "${O.name}" created.`,"success"),o(`/series/${O.id}`)}catch{i("Error saving new series.","error")}}},[u,i,o,x,m]),b=U.useCallback(()=>{const{series:S,decks:O}=Db();m(S,O)},[m]),D=U.useCallback(S=>{const O=et.getState().deckSeries.find(C=>C.id===S);if(O){const C=new Date,M=new Date(O.lastOpened||0);C.getTime()-M.getTime()>5e3&&x({...O,lastOpened:C.toISOString()},{silent:!0})}},[x]),w=U.useCallback(async(S,O)=>{const C=et.getState().deckSeries.find(R=>R.id===S);if(!C){i("Could not find the series to add the deck to.","error");return}await g([O]);const M=C.levels[C.levels.length-1];if(M){const R={...C,levels:[...C.levels.slice(0,-1),{...M,deckIds:[...M.deckIds,O.id]}]};x(R)}},[g,x,i]),N=U.useCallback(S=>{try{Rb(S,f),i(`Series "${S.name}" exported.`,"success")}catch(O){i(`Failed to export series: ${O.message}`,"error")}},[f,i]);return U.useMemo(()=>({handleAddSeriesWithDecks:m,handleUpdateSeries:x,handleDeleteSeries:d,handleRestoreSeries:j,handleDeleteSeriesPermanently:y,handleSaveSeries:_,handleCreateSampleSeries:b,updateLastOpenedSeries:D,handleAddDeckToSeries:w,handleExportSeries:N}),[m,x,d,j,y,_,b,D,w,N])};function zb(r,g){const l=new Date(r);return l.setDate(l.getDate()+g),l}const Lb=(r,g)=>{const l=new Date;l.setHours(0,0,0,0);let u=r.lapses||0;g===wt.Again?u++:u>0&&(u=0);let f=k0[g];g===wt.Again&&u>2&&(f-=(u-2)*.05);let i=r.easeFactor+f;i<jd&&(i=jd);let o;if(g===wt.Again)o=j0;else if(r.interval===0)switch(g){case wt.Hard:o=1;break;case wt.Good:o=3;break;case wt.Easy:o=5;break;default:o=1}else{let d=1;g===wt.Hard&&(d=N0),g===wt.Easy&&(d=_0),o=Math.ceil(r.interval*i*d)}const m=zb(l,o),x=Math.min(1,Math.log1p(o)/Math.log1p(90));return{...r,interval:o,easeFactor:i,dueDate:m.toISOString(),lastReviewed:l.toISOString(),masteryLevel:x,lapses:u}},jp=r=>{const g=new Date;return g.setHours(0,0,0,0),{...r,dueDate:g.toISOString(),interval:0,easeFactor:Gr,suspended:!1,masteryLevel:0,lastReviewed:void 0,lapses:0}},Rn=r=>{const g=r.masteryLevel||0;if(g===0||!r.lastReviewed||r.suspended)return 0;const l=(r.interval||1)*2,u=new Date(r.lastReviewed),i=Math.max(0,(new Date().getTime()-u.getTime())/(1e3*60*60*24));if(i<=0)return g;const o=Math.pow(.5,i/l);return g*o},Da=r=>{const g=new Date;g.setHours(23,59,59,999);const l=(r.type===Ce.Quiz||r.type===Ce.Learning?r.questions:r.cards)||[];return Array.isArray(l)?l.filter(u=>!u.suspended&&new Date(u.dueDate)<=g).length:0},Bb=({sessionsToResume:r,setSessionsToResume:g,setGeneralStudyDeck:l,handleUpdateDeck:u})=>{const{navigate:f}=ra(),{dispatch:i}=et(),{addToast:o}=Mt(),m=U.useCallback(async(b,D)=>{const w=`session_deck_${b}`;if(r.has(b)){const N=new Set(r);N.delete(b),g(N)}try{await ml(w)}catch(N){console.error(`Failed to clean up session state for ${w} from DB`,N)}b==="general-study-deck"&&l(null),f(D?`/series/${D}`:"/")},[f,r,g,l]),x=U.useCallback(async(b,D,w)=>{const N=`session_deck_${b}`;if(r.has(b)){const S=new Set(r);S.delete(b),g(S)}try{await ml(N)}catch(S){console.error(`Failed to clean up session state for ${N} from DB`,S)}b==="general-study-deck"&&l(null),f(`/decks/${w}/study?seriesId=${D}`)},[f,r,g,l]),d=U.useCallback(async(b,D,w,N)=>{const{decks:S,deckSeries:O,seriesProgress:C}=et.getState(),M=S.find(B=>B.id===b);if(!M)return;let R;const{id:$,dueDate:X,interval:J,easeFactor:Y,suspended:H,masteryLevel:K,lastReviewed:q,lapses:W}=D,A={dueDate:X,interval:J,easeFactor:Y,suspended:H,masteryLevel:K,lastReviewed:q,lapses:W};M.type===Ce.Flashcard?R={...M,cards:(M.cards||[]).map(B=>B.id===$?{...B,...A}:B)}:M.type===Ce.Learning?R={...M,questions:(M.questions||[]).map(B=>B.id===$?{...B,...A}:B)}:R={...M,questions:(M.questions||[]).map(B=>B.id===$?{...B,...A}:B)},await u(R,{silent:!0});try{const B={itemId:D.id,deckId:b,seriesId:N,timestamp:new Date().toISOString(),rating:w,newInterval:D.interval,easeFactor:D.easeFactor,masteryLevel:D.masteryLevel||0};await Lg(B)}catch(B){console.error("Failed to log review:",B)}if(N){const B=R,z="cards"in B?B.cards:B.questions,Q=Array.isArray(z)&&z.some(ee=>!ee.suspended&&ee.interval===0),ue=(C.get(N)||new Set).has(b);if(!Q&&!ue&&(z==null?void 0:z.length)>0){const ee=new Map(C),V=ee.get(N),E=new Set(V instanceof Set?V:[]);E.add(b),ee.set(N,E);try{await Hg(N,E);const L=O.find(oe=>oe.id===N),se=((L==null?void 0:L.levels)||[]).flatMap(oe=>(oe==null?void 0:oe.deckIds)||[]);se.indexOf(b)===se.length-1&&se.length>0?o(`Congratulations! You've completed the series: "${L==null?void 0:L.name}"!`,"success"):o(`Deck "${B.name}" completed! Next chapter unlocked.`,"success"),i({type:"SET_SERIES_PROGRESS",payload:ee})}catch(L){console.error("Could not save series progress",L)}}}},[u,o,i]),j=U.useCallback(async b=>{const D=et.getState().decks.find(N=>N.id===b);if(!D)return;let w;D.type===Ce.Flashcard?w={...D,cards:(D.cards||[]).map(N=>jp(N))}:w={...D,questions:(D.questions||[]).map(N=>jp(N))},await u(w,{toastMessage:`Progress for deck "${w.name}" has been reset.`})},[u]),y=U.useCallback(()=>{const{decks:b,deckSeries:D,seriesProgress:w}=et.getState(),N=new Set;D.forEach(R=>(R.levels||[]).filter(Boolean).forEach($=>($.deckIds||[]).forEach(X=>N.add(X))));const S=new Set;D.forEach(R=>{var $;if(!R.archived&&!R.deletedAt){const X=(($=w.get(R.id))==null?void 0:$.size)||0;let J=0;(R.levels||[]).filter(Boolean).forEach(Y=>{(Y.deckIds||[]).forEach(H=>{J<=X&&S.add(H),J++})})}});const O=new Date;O.setHours(23,59,59,999);const C=b.filter(R=>!(R.type!==Ce.Quiz||R.archived||R.deletedAt||N.has(R.id)&&!S.has(R.id))).flatMap(R=>(R.questions||[]).filter($=>!$.suspended&&new Date($.dueDate)<=O).map($=>({...$,originalDeckId:R.id,originalDeckName:R.name}))).sort(()=>Math.random()-.5),M={id:"general-study-deck",name:"General Study Session",description:"A mix of all due questions.",type:Ce.Quiz,questions:C};l(M),f("/study/general")},[f,l]),_=U.useCallback(async b=>{var Y;const{decks:D,deckSeries:w,seriesProgress:N}=et.getState(),S=w.find(H=>H.id===b);if(!S)return;const O=new Set,C=((Y=N.get(S.id))==null?void 0:Y.size)||0;let M=0;(S.levels||[]).filter(Boolean).forEach(H=>{(H.deckIds||[]).forEach(K=>{M<=C&&O.add(K),M++})});const R=new Date;R.setHours(23,59,59,999);const X=(S.levels||[]).filter(Boolean).flatMap(H=>H.deckIds||[]).map(H=>D.find(K=>K.id===H)).filter(H=>!!(H&&(H.type===Ce.Quiz||H.type===Ce.Learning))).filter(H=>O.has(H.id)).flatMap(H=>(H.questions||[]).filter(K=>!K.suspended&&new Date(K.dueDate)<=R).map(K=>({...K,originalDeckId:H.id,originalDeckName:H.name}))).sort(()=>Math.random()-.5),J={id:"general-study-deck",name:`${S.name} - Study Session`,description:`A study session for due items in the series: ${S.name}`,type:Ce.Quiz,questions:X};l(J),f(`/study/general?seriesId=${b}`)},[f,l]);return U.useMemo(()=>({handleSessionEnd:m,handleStudyNextDeckInSeries:x,handleItemReviewed:d,handleResetDeckProgress:j,handleStartGeneralStudy:y,handleStartSeriesStudy:_}),[m,x,d,j,y,_])},Fb=({addToast:r,openModal:g,closeModal:l,dispatch:u,isSyncing:f,setIsSyncing:i,setLastSyncStatus:o,backupEnabled:m,backupApiKey:x,syncOnCellular:d})=>{const{isOnline:j,isMetered:y}=Od(),[_,b]=U.useState(null),D=U.useCallback(async()=>{try{const z=await Yg();z&&r(`Successfully exported all data to ${z}`,"success")}catch(z){r(z.message,"error")}},[r]),w=U.useCallback(async z=>{try{await Qg(z),z.settings&&Object.entries(z.settings).forEach(([Q,ue])=>{ue!=null&&localStorage.setItem(`cogniflow-${Q}`,typeof ue=="string"?ue:JSON.stringify(ue))}),r("Restore complete! The app will now reload.","success"),setTimeout(()=>window.location.reload(),1500)}catch(Q){r(`Restore failed: ${Q.message}`,"error")}},[r]),N=U.useCallback(async(z=!1,Q=!0)=>{if(i(!0),Q)try{const ue=await Ho();localStorage.setItem("cogniflow-pre-fetch-backup",JSON.stringify(ue)),r("Created a temporary local backup before fetching.","info")}catch{r("Could not create pre-fetch backup. Aborting.","error"),i(!1);return}try{const ue=await dl();await w(ue),localStorage.setItem("cogniflow-lastSyncTimestamp",new Date().toISOString()),o(`Last sync: ${new Date().toLocaleString()}`),r("Data restored from server.","success")}catch(ue){const ee=ue.message;o(`Sync failed: ${ee}`),r(`Sync failed: ${ee}`,"error")}finally{i(!1)}},[i,o,r,w]),S=U.useCallback(async({isManual:z})=>{if(!j){z&&r("Sync failed: You are offline.","error");return}if(!m||!x){z&&r("Sync is disabled or API key is not set.","info");return}if(y&&!d){z&&r('Sync paused on metered connection. Enable "Sync on Cellular" in settings.',"info");return}if(!f){i(!0),o("Syncing...");try{const{metadata:Q,isNotModified:ue}=await ii(),{lastModified:ee}=et.getState(),V=localStorage.getItem("cogniflow-lastSyncTimestamp"),E=ee!==null&&(!V||ee>new Date(V).getTime()),L=Q&&(!V||new Date(Q.modified).getTime()>new Date(V).getTime());if(ue&&!E)o(`Up to date. (${new Date().toLocaleTimeString()})`),z&&r("Already up to date.","success");else if(L)E?g("mergeConflict",{localData:{lastModified:ee},remoteData:Q}):z?g("confirm",{title:"Download from Server?",message:`Newer data was found on the server from ${new Date(Q.modified).toLocaleString()}. Your local data has no changes. Would you like to download it?`,onConfirm:()=>N(),confirmText:"Download"}):b({modified:Q.modified,size:Q.size});else if(E){const{timestamp:se,etag:ie}=await hl();localStorage.setItem("cogniflow-lastSyncTimestamp",se),o(`Last sync: ${new Date().toLocaleString()}`),z&&r("Local changes synced to server.","success")}else o(`Up to date. (${new Date().toLocaleTimeString()})`),z&&r("Already up to date.","success")}catch(Q){const ue=Q.isNetworkError?Q.message:Q.status===401?"Unauthorized. Check API Key.":Q.message||"An unknown error occurred.";o(`Sync failed: ${ue}`),z&&r(`Sync failed: ${ue}`,"error")}finally{i(!1)}}},[j,m,x,d,y,f,r,i,o,g,l,N]),O=U.useCallback(async({isManual:z,force:Q=!1})=>{if(f){r("Sync already in progress.","info");return}const{lastModified:ue}=et.getState(),ee=localStorage.getItem("cogniflow-lastSyncTimestamp");ue!==null&&(!ee||ue>new Date(ee).getTime())&&!Q?await S({isManual:!1}):await S({isManual:z})},[j,m,x,d,y,f,S,r,i,o,g]),C=U.useCallback(()=>{O({isManual:!0})},[O]),M=U.useCallback(()=>{g("confirm",{title:"Force Fetch from Server?",message:"This will overwrite your local data with the version from the server. Any local changes made since the last sync will be lost. This action cannot be undone.",onConfirm:()=>N(!0),confirmText:"Overwrite Local Data"})},[g,N]),R=U.useCallback(()=>{g("confirm",{title:"Force Upload to Server?",message:"This will overwrite the server data with your current local version. Any changes on the server since the last sync will be lost. This action cannot be undone.",onConfirm:async()=>{i(!0);try{const{timestamp:z}=await hl(void 0,!0);localStorage.setItem("cogniflow-lastSyncTimestamp",z),r("Successfully uploaded local data to server.","success")}catch(z){r(`Upload failed: ${z.message}`,"error")}finally{i(!1)}},confirmText:"Overwrite Server Data"})},[g,r,i]),$=U.useCallback(()=>{g("confirm",{title:"Factory Reset",message:"This will permanently delete all your local data, settings, and database. This action cannot be undone and the app will reload. Are you sure?",onConfirm:async()=>{try{await $g(),localStorage.clear(),r("Factory reset complete. App will now reload.","success"),setTimeout(()=>window.location.reload(),1500)}catch(z){r(`Factory reset failed: ${z.message}`,"error")}}})},[g,r]),X=U.useCallback(async z=>{z==="local"?(localStorage.setItem("cogniflow-post-merge-sync","true"),r("Keeping local data. It will be force-uploaded after reloading.","info"),setTimeout(()=>window.location.reload(),1500)):await N(!0,!1),l()},[r,l,N]),J=U.useCallback(async()=>{try{const{filename:z}=await Jg();r(`Manual backup "${z}" created on server.`,"success")}catch(z){r(`Failed to create backup: ${z.message}`,"error")}},[r]),Y=U.useCallback(async z=>{g("confirm",{title:"Restore Live Sync?",message:`This will replace the current live sync file on the server with the contents of "${z}". Are you sure?`,onConfirm:async()=>{try{await Vg(z),r("Live sync file restored. It will be downloaded on next sync or app reload.","success")}catch(Q){r(`Restore failed: ${Q.message}`,"error")}},confirmText:"Restore Sync File"})},[r,g]),H=U.useCallback(async z=>{g("confirm",{title:"Delete Server Backup?",message:`Are you sure you want to permanently delete "${z}" from the server? This action cannot be undone.`,onConfirm:async()=>{try{return await Kg(z),Promise.resolve()}catch(Q){return r(`Failed to delete backup: ${Q.message}`,"error"),Promise.reject()}},confirmText:"Delete Permanently"})},[r,g]),K=U.useCallback(()=>{g("confirm",{title:"Revert Last Fetch?",message:"This will restore your local data to the state it was in right before the last fetch/sync from the server. Are you sure?",onConfirm:async()=>{const z=localStorage.getItem("cogniflow-pre-fetch-backup");if(z)try{const Q=JSON.parse(z);await w(Q),localStorage.removeItem("cogniflow-pre-fetch-backup")}catch{r("Failed to parse or restore pre-fetch backup.","error")}else r("No pre-fetch backup found to revert to.","error")}})},[w,g,r]),q=U.useCallback(async({selectedIds:z,backupData:Q})=>{const ue=Q.decks.filter(L=>z.has(L.id)),ee=Q.deckSeries.filter(L=>z.has(L.id)),V=new Set(ee.flatMap(L=>L.levels.flatMap(se=>se.deckIds))),E=ue.filter(L=>!V.has(L.id));try{E.length>0&&(u({type:"ADD_DECKS",payload:E}),await si(E)),ee.length>0&&(ee.forEach(L=>{const se=Q.decks.filter(ie=>(L.levels||[]).some(oe=>oe.deckIds.includes(ie.id)));u({type:"ADD_SERIES_WITH_DECKS",payload:{series:L,decks:se}})}),await Bo(ee),await si(ue.filter(L=>V.has(L.id)))),r("Successfully restored selected items.","success"),S({isManual:!1})}catch(L){r(`Error restoring items: ${L.message}`,"error")}},[u,r,S]),W=U.useCallback(z=>{const{decks:Q,deckSeries:ue}=et.getState(),ee=new Map(z.decks.map(ve=>[ve.id,ve])),V=new Map(z.deckSeries.map(ve=>[ve.id,ve])),E=[],L=[];Q.forEach(ve=>{const Me=ee.get(ve.id);if(Me){const Fe={content:!1,dueCount:!1,mastery:!1},Pe=ve.type===Ce.Flashcard?ve.cards:ve.questions,Re=Me.type===Ce.Flashcard?Me.cards:Me.questions;JSON.stringify(Pe||[])!==JSON.stringify(Re||[])&&(Fe.content=!0),ve.lastModified&&Me.lastModified&&Me.lastModified>ve.lastModified&&(Fe.dueCount=!0,Fe.mastery=!0),(Fe.content||Fe.dueCount||Fe.mastery)&&L.push({local:ve,backup:Me,diff:Fe})}});for(const ve of z.decks)Q.some(Me=>Me.id===ve.id)||E.push(ve);const se=[],ie=[];ue.forEach(ve=>{const Me=V.get(ve.id);if(Me){const Fe={structure:!1,completion:!1,mastery:!1};JSON.stringify(ve.levels)!==JSON.stringify(Me.levels)&&(Fe.structure=!0),ve.lastModified&&Me.lastModified&&Me.lastModified>ve.lastModified&&(Fe.completion=!0,Fe.mastery=!0),(Fe.structure||Fe.completion||Fe.mastery)&&ie.push({local:ve,backup:Me,diff:Fe})}});for(const ve of z.deckSeries)ue.some(Me=>Me.id===ve.id)||se.push(ve);const oe=[...Q,...E,...L.map(ve=>ve.backup)],Ne=new Map;oe.forEach(ve=>{Ne.set(ve.id,Da(ve));const Me=Q.find(Fe=>Fe.id===ve.id);Me&&Ne.set(`local-${ve.id}`,Da(Me))});const we=new Map,je=ve=>(ve.type==="flashcard"?ve.cards:ve.questions)||[];oe.forEach(ve=>{const Me=je(ve).filter(Re=>!Re.suspended),Fe=Me.length>0?Me.reduce((Re,k)=>Re+Rn(k),0)/Me.length:0;we.set(ve.id,Fe);const Pe=Q.find(Re=>Re.id===ve.id);if(Pe){const Re=je(Pe).filter(xe=>!xe.suspended),k=Re.length>0?Re.reduce((xe,he)=>xe+Rn(he),0)/Re.length:0;we.set(`local-${ve.id}`,k)}});for(const ve of[...ue,...se,...ie.map(Me=>Me.backup)]){const Fe=(ve.levels||[]).flatMap(k=>k.deckIds).map(k=>oe.find(xe=>xe.id===k)).filter(Boolean).flatMap(k=>je(k)).filter(k=>!k.suspended),Pe=Fe.length>0?Fe.reduce((k,xe)=>k+Rn(xe),0)/Fe.length:0;we.set(ve.id,Pe);const Re=ue.find(k=>k.id===ve.id);if(Re){const xe=(Re.levels||[]).flatMap(Z=>Z.deckIds).map(Z=>Q.find(P=>P.id===Z)).filter(Boolean).flatMap(Z=>je(Z)).filter(Z=>!Z.suspended),he=xe.length>0?xe.reduce((Z,P)=>Z+Rn(P),0)/xe.length:0;we.set(`local-${ve.id}`,he)}}return{newDecks:E,newSeries:se,changedDecks:L,changedSeries:ie,dueCounts:Ne,masteryLevels:we}},[]),A=U.useCallback(()=>{var z;(z=navigator.serviceWorker)!=null&&z.controller?(navigator.serviceWorker.controller.postMessage({type:"CLEAR_APP_CACHE"}),r("Clearing app cache... It may take a moment to take effect.","info")):r("Service worker not available to clear cache.","error")},[r]),B=U.useCallback(()=>{var z;(z=navigator.serviceWorker)!=null&&z.controller?(navigator.serviceWorker.controller.postMessage({type:"CLEAR_CDN_CACHE"}),r("Clearing CDN cache... It may take a moment to take effect.","info")):r("Service worker not available to clear cache.","error")},[r]);return U.useMemo(()=>({handleExportData:D,onRestoreData:w,handleCompareBackup:W,handleRestoreSelectedItems:q,triggerSync:S,handleManualSync:C,handleSync:O,fetchAndRestoreFromServer:N,handleForceFetchFromServer:M,handleForceUploadToServer:R,handleFactoryReset:$,handleMergeResolution:X,handleCreateServerBackup:J,handleRestoreFromServerBackup:Y,handleDeleteServerBackup:H,handleRevertLastFetch:K,handleClearAppCache:A,handleClearCdnCache:B}),[D,w,W,q,S,C,O,N,M,R,$,X,J,Y,H,K,A,B])};let qb=[];const Hb=(r,g)=>{qb.forEach(l=>l(r,g))},Gb=()=>{{console.error("Google services not ready for sign-in.");return}},Yb=()=>{const r=gapi.client.getToken();gapi.client.setToken(null),localStorage.removeItem("gdrive-previously-signed-in"),Hb(!1),r!==null&&google.accounts.oauth2.revoke(r.access_token,()=>{console.log("Google token revoked.")})},Qb=async()=>{const r=await Ho();if(r.decks.length===0&&r.folders.length===0&&r.deckSeries.length===0)throw new Error("There is no data to back up.");const g={version:6,...r},l=JSON.stringify(g),i={name:`cogniflow-backup-${kd()}.json`,parents:["appDataFolder"]},o="-------314159265358979323846",m=`\r
--${o}\r
`,x=`\r
--${o}--`,d=m+`Content-Type: application/json; charset=UTF-8\r
\r
`+JSON.stringify(i)+m+`Content-Type: application/json; charset=UTF-8\r
\r
`+l+x,j=await gapi.client.request({path:"https://www.googleapis.com/upload/drive/v3/files",method:"POST",params:{uploadType:"multipart",fields:"id, name, modifiedTime"},headers:{"Content-Type":`multipart/related; boundary=${o}`},body:d});if(j.status!==200)throw new Error("Failed to upload backup file.");return j.result},$b=async()=>(await gapi.client.drive.files.list({spaces:"appDataFolder",fields:"files(id, name, modifiedTime)",orderBy:"modifiedTime desc"})).result.files,Pb=async r=>{const g=await gapi.client.drive.files.get({fileId:r,alt:"media"});if(g.status!==200)throw new Error("Failed to download backup file.");const l=typeof g.body=="string"?g.body:JSON.stringify(g.result);return Go(l)},Jb=({openConfirmModal:r,openRestoreFromDriveModal:g,setDriveFiles:l,onRestoreData:u})=>{const{addToast:f}=Mt(),i=U.useCallback(()=>{Gb()},[]),o=U.useCallback(()=>{Yb(),f("Signed out of Google Drive.","info")},[f]),m=U.useCallback(()=>{r({title:"Backup to Google Drive",message:"This will create a new backup file in a private application folder in your Google Drive. Are you sure?",onConfirm:async()=>{try{const j=await Qb();f(`Successfully created backup: ${j.name}`,"success")}catch(j){const y=j instanceof Error?j.message:"Failed to create backup.";f(y,"error")}}})},[f,r]),x=U.useCallback(async()=>{try{const j=await $b();l(j),g()}catch(j){const y=j instanceof Error?j.message:"Failed to list files from Google Drive.";f(y,"error")}},[f,l,g]),d=U.useCallback(async j=>{r({title:"Restore from Google Drive",message:"Restoring will merge and overwrite data. Are you sure?",onConfirm:async()=>{try{const y=await Pb(j);await u(y)}catch(y){const _=y instanceof Error?y.message:"Failed to restore from backup.";f(_,"error")}}})},[f,r,u]);return U.useMemo(()=>({handleGoogleSignIn:i,handleGoogleSignOut:o,handleBackupToDrive:m,handleListDriveFiles:x,handleRestoreFromDrive:d,openRestoreFromDriveModal:x}),[i,o,m,x,d])};/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 *//**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */var Np;(function(r){r.OUTCOME_UNSPECIFIED="OUTCOME_UNSPECIFIED",r.OUTCOME_OK="OUTCOME_OK",r.OUTCOME_FAILED="OUTCOME_FAILED",r.OUTCOME_DEADLINE_EXCEEDED="OUTCOME_DEADLINE_EXCEEDED"})(Np||(Np={}));var _p;(function(r){r.LANGUAGE_UNSPECIFIED="LANGUAGE_UNSPECIFIED",r.PYTHON="PYTHON"})(_p||(_p={}));var Ze;(function(r){r.TYPE_UNSPECIFIED="TYPE_UNSPECIFIED",r.STRING="STRING",r.NUMBER="NUMBER",r.INTEGER="INTEGER",r.BOOLEAN="BOOLEAN",r.ARRAY="ARRAY",r.OBJECT="OBJECT",r.NULL="NULL"})(Ze||(Ze={}));var kp;(function(r){r.HARM_CATEGORY_UNSPECIFIED="HARM_CATEGORY_UNSPECIFIED",r.HARM_CATEGORY_HATE_SPEECH="HARM_CATEGORY_HATE_SPEECH",r.HARM_CATEGORY_DANGEROUS_CONTENT="HARM_CATEGORY_DANGEROUS_CONTENT",r.HARM_CATEGORY_HARASSMENT="HARM_CATEGORY_HARASSMENT",r.HARM_CATEGORY_SEXUALLY_EXPLICIT="HARM_CATEGORY_SEXUALLY_EXPLICIT",r.HARM_CATEGORY_CIVIC_INTEGRITY="HARM_CATEGORY_CIVIC_INTEGRITY",r.HARM_CATEGORY_IMAGE_HATE="HARM_CATEGORY_IMAGE_HATE",r.HARM_CATEGORY_IMAGE_DANGEROUS_CONTENT="HARM_CATEGORY_IMAGE_DANGEROUS_CONTENT",r.HARM_CATEGORY_IMAGE_HARASSMENT="HARM_CATEGORY_IMAGE_HARASSMENT",r.HARM_CATEGORY_IMAGE_SEXUALLY_EXPLICIT="HARM_CATEGORY_IMAGE_SEXUALLY_EXPLICIT"})(kp||(kp={}));var Ap;(function(r){r.HARM_BLOCK_METHOD_UNSPECIFIED="HARM_BLOCK_METHOD_UNSPECIFIED",r.SEVERITY="SEVERITY",r.PROBABILITY="PROBABILITY"})(Ap||(Ap={}));var Tp;(function(r){r.HARM_BLOCK_THRESHOLD_UNSPECIFIED="HARM_BLOCK_THRESHOLD_UNSPECIFIED",r.BLOCK_LOW_AND_ABOVE="BLOCK_LOW_AND_ABOVE",r.BLOCK_MEDIUM_AND_ABOVE="BLOCK_MEDIUM_AND_ABOVE",r.BLOCK_ONLY_HIGH="BLOCK_ONLY_HIGH",r.BLOCK_NONE="BLOCK_NONE",r.OFF="OFF"})(Tp||(Tp={}));var Cp;(function(r){r.MODE_UNSPECIFIED="MODE_UNSPECIFIED",r.MODE_DYNAMIC="MODE_DYNAMIC"})(Cp||(Cp={}));var Dp;(function(r){r.AUTH_TYPE_UNSPECIFIED="AUTH_TYPE_UNSPECIFIED",r.NO_AUTH="NO_AUTH",r.API_KEY_AUTH="API_KEY_AUTH",r.HTTP_BASIC_AUTH="HTTP_BASIC_AUTH",r.GOOGLE_SERVICE_ACCOUNT_AUTH="GOOGLE_SERVICE_ACCOUNT_AUTH",r.OAUTH="OAUTH",r.OIDC_AUTH="OIDC_AUTH"})(Dp||(Dp={}));var Op;(function(r){r.API_SPEC_UNSPECIFIED="API_SPEC_UNSPECIFIED",r.SIMPLE_SEARCH="SIMPLE_SEARCH",r.ELASTIC_SEARCH="ELASTIC_SEARCH"})(Op||(Op={}));var Ip;(function(r){r.URL_RETRIEVAL_STATUS_UNSPECIFIED="URL_RETRIEVAL_STATUS_UNSPECIFIED",r.URL_RETRIEVAL_STATUS_SUCCESS="URL_RETRIEVAL_STATUS_SUCCESS",r.URL_RETRIEVAL_STATUS_ERROR="URL_RETRIEVAL_STATUS_ERROR",r.URL_RETRIEVAL_STATUS_PAYWALL="URL_RETRIEVAL_STATUS_PAYWALL",r.URL_RETRIEVAL_STATUS_UNSAFE="URL_RETRIEVAL_STATUS_UNSAFE"})(Ip||(Ip={}));var Rp;(function(r){r.FINISH_REASON_UNSPECIFIED="FINISH_REASON_UNSPECIFIED",r.STOP="STOP",r.MAX_TOKENS="MAX_TOKENS",r.SAFETY="SAFETY",r.RECITATION="RECITATION",r.LANGUAGE="LANGUAGE",r.OTHER="OTHER",r.BLOCKLIST="BLOCKLIST",r.PROHIBITED_CONTENT="PROHIBITED_CONTENT",r.SPII="SPII",r.MALFORMED_FUNCTION_CALL="MALFORMED_FUNCTION_CALL",r.IMAGE_SAFETY="IMAGE_SAFETY",r.UNEXPECTED_TOOL_CALL="UNEXPECTED_TOOL_CALL"})(Rp||(Rp={}));var Mp;(function(r){r.HARM_PROBABILITY_UNSPECIFIED="HARM_PROBABILITY_UNSPECIFIED",r.NEGLIGIBLE="NEGLIGIBLE",r.LOW="LOW",r.MEDIUM="MEDIUM",r.HIGH="HIGH"})(Mp||(Mp={}));var Up;(function(r){r.HARM_SEVERITY_UNSPECIFIED="HARM_SEVERITY_UNSPECIFIED",r.HARM_SEVERITY_NEGLIGIBLE="HARM_SEVERITY_NEGLIGIBLE",r.HARM_SEVERITY_LOW="HARM_SEVERITY_LOW",r.HARM_SEVERITY_MEDIUM="HARM_SEVERITY_MEDIUM",r.HARM_SEVERITY_HIGH="HARM_SEVERITY_HIGH"})(Up||(Up={}));var zp;(function(r){r.BLOCKED_REASON_UNSPECIFIED="BLOCKED_REASON_UNSPECIFIED",r.SAFETY="SAFETY",r.OTHER="OTHER",r.BLOCKLIST="BLOCKLIST",r.PROHIBITED_CONTENT="PROHIBITED_CONTENT",r.IMAGE_SAFETY="IMAGE_SAFETY"})(zp||(zp={}));var Lp;(function(r){r.TRAFFIC_TYPE_UNSPECIFIED="TRAFFIC_TYPE_UNSPECIFIED",r.ON_DEMAND="ON_DEMAND",r.PROVISIONED_THROUGHPUT="PROVISIONED_THROUGHPUT"})(Lp||(Lp={}));var Bp;(function(r){r.MODALITY_UNSPECIFIED="MODALITY_UNSPECIFIED",r.TEXT="TEXT",r.IMAGE="IMAGE",r.AUDIO="AUDIO"})(Bp||(Bp={}));var Fp;(function(r){r.MEDIA_RESOLUTION_UNSPECIFIED="MEDIA_RESOLUTION_UNSPECIFIED",r.MEDIA_RESOLUTION_LOW="MEDIA_RESOLUTION_LOW",r.MEDIA_RESOLUTION_MEDIUM="MEDIA_RESOLUTION_MEDIUM",r.MEDIA_RESOLUTION_HIGH="MEDIA_RESOLUTION_HIGH"})(Fp||(Fp={}));var qp;(function(r){r.JOB_STATE_UNSPECIFIED="JOB_STATE_UNSPECIFIED",r.JOB_STATE_QUEUED="JOB_STATE_QUEUED",r.JOB_STATE_PENDING="JOB_STATE_PENDING",r.JOB_STATE_RUNNING="JOB_STATE_RUNNING",r.JOB_STATE_SUCCEEDED="JOB_STATE_SUCCEEDED",r.JOB_STATE_FAILED="JOB_STATE_FAILED",r.JOB_STATE_CANCELLING="JOB_STATE_CANCELLING",r.JOB_STATE_CANCELLED="JOB_STATE_CANCELLED",r.JOB_STATE_PAUSED="JOB_STATE_PAUSED",r.JOB_STATE_EXPIRED="JOB_STATE_EXPIRED",r.JOB_STATE_UPDATING="JOB_STATE_UPDATING",r.JOB_STATE_PARTIALLY_SUCCEEDED="JOB_STATE_PARTIALLY_SUCCEEDED"})(qp||(qp={}));var Hp;(function(r){r.TUNING_MODE_UNSPECIFIED="TUNING_MODE_UNSPECIFIED",r.TUNING_MODE_FULL="TUNING_MODE_FULL",r.TUNING_MODE_PEFT_ADAPTER="TUNING_MODE_PEFT_ADAPTER"})(Hp||(Hp={}));var Gp;(function(r){r.ADAPTER_SIZE_UNSPECIFIED="ADAPTER_SIZE_UNSPECIFIED",r.ADAPTER_SIZE_ONE="ADAPTER_SIZE_ONE",r.ADAPTER_SIZE_TWO="ADAPTER_SIZE_TWO",r.ADAPTER_SIZE_FOUR="ADAPTER_SIZE_FOUR",r.ADAPTER_SIZE_EIGHT="ADAPTER_SIZE_EIGHT",r.ADAPTER_SIZE_SIXTEEN="ADAPTER_SIZE_SIXTEEN",r.ADAPTER_SIZE_THIRTY_TWO="ADAPTER_SIZE_THIRTY_TWO"})(Gp||(Gp={}));var Yp;(function(r){r.FEATURE_SELECTION_PREFERENCE_UNSPECIFIED="FEATURE_SELECTION_PREFERENCE_UNSPECIFIED",r.PRIORITIZE_QUALITY="PRIORITIZE_QUALITY",r.BALANCED="BALANCED",r.PRIORITIZE_COST="PRIORITIZE_COST"})(Yp||(Yp={}));var Qp;(function(r){r.UNSPECIFIED="UNSPECIFIED",r.BLOCKING="BLOCKING",r.NON_BLOCKING="NON_BLOCKING"})(Qp||(Qp={}));var $p;(function(r){r.MODE_UNSPECIFIED="MODE_UNSPECIFIED",r.MODE_DYNAMIC="MODE_DYNAMIC"})($p||($p={}));var Pp;(function(r){r.ENVIRONMENT_UNSPECIFIED="ENVIRONMENT_UNSPECIFIED",r.ENVIRONMENT_BROWSER="ENVIRONMENT_BROWSER"})(Pp||(Pp={}));var Jp;(function(r){r.MODE_UNSPECIFIED="MODE_UNSPECIFIED",r.AUTO="AUTO",r.ANY="ANY",r.NONE="NONE"})(Jp||(Jp={}));var Vp;(function(r){r.BLOCK_LOW_AND_ABOVE="BLOCK_LOW_AND_ABOVE",r.BLOCK_MEDIUM_AND_ABOVE="BLOCK_MEDIUM_AND_ABOVE",r.BLOCK_ONLY_HIGH="BLOCK_ONLY_HIGH",r.BLOCK_NONE="BLOCK_NONE"})(Vp||(Vp={}));var Kp;(function(r){r.DONT_ALLOW="DONT_ALLOW",r.ALLOW_ADULT="ALLOW_ADULT",r.ALLOW_ALL="ALLOW_ALL"})(Kp||(Kp={}));var Zp;(function(r){r.auto="auto",r.en="en",r.ja="ja",r.ko="ko",r.hi="hi",r.zh="zh",r.pt="pt",r.es="es"})(Zp||(Zp={}));var Xp;(function(r){r.MASK_MODE_DEFAULT="MASK_MODE_DEFAULT",r.MASK_MODE_USER_PROVIDED="MASK_MODE_USER_PROVIDED",r.MASK_MODE_BACKGROUND="MASK_MODE_BACKGROUND",r.MASK_MODE_FOREGROUND="MASK_MODE_FOREGROUND",r.MASK_MODE_SEMANTIC="MASK_MODE_SEMANTIC"})(Xp||(Xp={}));var Wp;(function(r){r.CONTROL_TYPE_DEFAULT="CONTROL_TYPE_DEFAULT",r.CONTROL_TYPE_CANNY="CONTROL_TYPE_CANNY",r.CONTROL_TYPE_SCRIBBLE="CONTROL_TYPE_SCRIBBLE",r.CONTROL_TYPE_FACE_MESH="CONTROL_TYPE_FACE_MESH"})(Wp||(Wp={}));var eg;(function(r){r.SUBJECT_TYPE_DEFAULT="SUBJECT_TYPE_DEFAULT",r.SUBJECT_TYPE_PERSON="SUBJECT_TYPE_PERSON",r.SUBJECT_TYPE_ANIMAL="SUBJECT_TYPE_ANIMAL",r.SUBJECT_TYPE_PRODUCT="SUBJECT_TYPE_PRODUCT"})(eg||(eg={}));var tg;(function(r){r.EDIT_MODE_DEFAULT="EDIT_MODE_DEFAULT",r.EDIT_MODE_INPAINT_REMOVAL="EDIT_MODE_INPAINT_REMOVAL",r.EDIT_MODE_INPAINT_INSERTION="EDIT_MODE_INPAINT_INSERTION",r.EDIT_MODE_OUTPAINT="EDIT_MODE_OUTPAINT",r.EDIT_MODE_CONTROLLED_EDITING="EDIT_MODE_CONTROLLED_EDITING",r.EDIT_MODE_STYLE="EDIT_MODE_STYLE",r.EDIT_MODE_BGSWAP="EDIT_MODE_BGSWAP",r.EDIT_MODE_PRODUCT_IMAGE="EDIT_MODE_PRODUCT_IMAGE"})(tg||(tg={}));var ng;(function(r){r.FOREGROUND="FOREGROUND",r.BACKGROUND="BACKGROUND",r.PROMPT="PROMPT",r.SEMANTIC="SEMANTIC",r.INTERACTIVE="INTERACTIVE"})(ng||(ng={}));var ag;(function(r){r.OPTIMIZED="OPTIMIZED",r.LOSSLESS="LOSSLESS"})(ag||(ag={}));var rg;(function(r){r.STATE_UNSPECIFIED="STATE_UNSPECIFIED",r.PROCESSING="PROCESSING",r.ACTIVE="ACTIVE",r.FAILED="FAILED"})(rg||(rg={}));var sg;(function(r){r.SOURCE_UNSPECIFIED="SOURCE_UNSPECIFIED",r.UPLOADED="UPLOADED",r.GENERATED="GENERATED"})(sg||(sg={}));var ig;(function(r){r.MODALITY_UNSPECIFIED="MODALITY_UNSPECIFIED",r.TEXT="TEXT",r.IMAGE="IMAGE",r.VIDEO="VIDEO",r.AUDIO="AUDIO",r.DOCUMENT="DOCUMENT"})(ig||(ig={}));var lg;(function(r){r.START_SENSITIVITY_UNSPECIFIED="START_SENSITIVITY_UNSPECIFIED",r.START_SENSITIVITY_HIGH="START_SENSITIVITY_HIGH",r.START_SENSITIVITY_LOW="START_SENSITIVITY_LOW"})(lg||(lg={}));var og;(function(r){r.END_SENSITIVITY_UNSPECIFIED="END_SENSITIVITY_UNSPECIFIED",r.END_SENSITIVITY_HIGH="END_SENSITIVITY_HIGH",r.END_SENSITIVITY_LOW="END_SENSITIVITY_LOW"})(og||(og={}));var cg;(function(r){r.ACTIVITY_HANDLING_UNSPECIFIED="ACTIVITY_HANDLING_UNSPECIFIED",r.START_OF_ACTIVITY_INTERRUPTS="START_OF_ACTIVITY_INTERRUPTS",r.NO_INTERRUPTION="NO_INTERRUPTION"})(cg||(cg={}));var ug;(function(r){r.TURN_COVERAGE_UNSPECIFIED="TURN_COVERAGE_UNSPECIFIED",r.TURN_INCLUDES_ONLY_ACTIVITY="TURN_INCLUDES_ONLY_ACTIVITY",r.TURN_INCLUDES_ALL_INPUT="TURN_INCLUDES_ALL_INPUT"})(ug||(ug={}));var dg;(function(r){r.SCHEDULING_UNSPECIFIED="SCHEDULING_UNSPECIFIED",r.SILENT="SILENT",r.WHEN_IDLE="WHEN_IDLE",r.INTERRUPT="INTERRUPT"})(dg||(dg={}));var fg;(function(r){r.SCALE_UNSPECIFIED="SCALE_UNSPECIFIED",r.C_MAJOR_A_MINOR="C_MAJOR_A_MINOR",r.D_FLAT_MAJOR_B_FLAT_MINOR="D_FLAT_MAJOR_B_FLAT_MINOR",r.D_MAJOR_B_MINOR="D_MAJOR_B_MINOR",r.E_FLAT_MAJOR_C_MINOR="E_FLAT_MAJOR_C_MINOR",r.E_MAJOR_D_FLAT_MINOR="E_MAJOR_D_FLAT_MINOR",r.F_MAJOR_D_MINOR="F_MAJOR_D_MINOR",r.G_FLAT_MAJOR_E_FLAT_MINOR="G_FLAT_MAJOR_E_FLAT_MINOR",r.G_MAJOR_E_MINOR="G_MAJOR_E_MINOR",r.A_FLAT_MAJOR_F_MINOR="A_FLAT_MAJOR_F_MINOR",r.A_MAJOR_G_FLAT_MINOR="A_MAJOR_G_FLAT_MINOR",r.B_FLAT_MAJOR_G_MINOR="B_FLAT_MAJOR_G_MINOR",r.B_MAJOR_A_FLAT_MINOR="B_MAJOR_A_FLAT_MINOR"})(fg||(fg={}));var hg;(function(r){r.MUSIC_GENERATION_MODE_UNSPECIFIED="MUSIC_GENERATION_MODE_UNSPECIFIED",r.QUALITY="QUALITY",r.DIVERSITY="DIVERSITY",r.VOCALIZATION="VOCALIZATION"})(hg||(hg={}));var mg;(function(r){r.PLAYBACK_CONTROL_UNSPECIFIED="PLAYBACK_CONTROL_UNSPECIFIED",r.PLAY="PLAY",r.PAUSE="PAUSE",r.STOP="STOP",r.RESET_CONTEXT="RESET_CONTEXT"})(mg||(mg={}));/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */var pg;(function(r){r.PAGED_ITEM_BATCH_JOBS="batchJobs",r.PAGED_ITEM_MODELS="models",r.PAGED_ITEM_TUNING_JOBS="tuningJobs",r.PAGED_ITEM_FILES="files",r.PAGED_ITEM_CACHED_CONTENTS="cachedContents"})(pg||(pg={}));const Sn=r=>{if(!r)return"";try{return new DOMParser().parseFromString(r,"text/html").body.textContent||""}catch{return String(r).replace(/<[^>]+>/g,"")}},Id=()=>{throw new Error("AI features are disabled. A Google Gemini API key is required.")};class ms extends Error{constructor(g,l){super(g),this.rawResponse=l,this.name="AIJsonResponseError"}}async function ps(r,g,l,u,f){const i=Id();let o="";try{if(o=(await i.models.generateContent({model:r,contents:l,config:{systemInstruction:g,responseMimeType:"application/json",responseSchema:u,temperature:f}})).text.trim(),!o)throw new Error("AI returned an empty response.");return JSON.parse(o)}catch(m){throw console.error("Error getting AI response:",m),m instanceof SyntaxError&&o?new ms("AI returned malformed JSON. You may be able to fix it manually.",o):m.message.includes("SAFETY")?new Error("The request was blocked due to safety settings. Please try a different request."):m.message.includes("Rpc failed due to xhr error")?new Error("A network error occurred while communicating with the AI service. Please check your connection and try again. The service may be temporarily unavailable."):new Error(`AI generation failed: ${m.message}`)}}const Rd=r=>{let g=`Generate content based on the following parameters:
- Topic: ${r.topic}
- User's Understanding Level: ${r.understandingLevel}
- User's Learning Goal: ${r.learningGoal}
- Comprehensiveness: ${r.comprehensiveness}
- Language: ${r.language}
`;return r.sourceContent&&(g+=`- Provided Text Content: ${r.sourceContent.substring(0,4e3)}...
`),r.sourceUrl&&(g+=`- Provided URL: ${r.sourceUrl}
`),r.topicsToInclude&&(g+=`- Topics to Include: ${r.topicsToInclude}
`),r.topicsToExclude&&(g+=`- Topics to Exclude: ${r.topicsToExclude}
`),r.brainstormHistory&&(g+=`
Here is the brainstorming conversation we had to refine the plan:
${r.brainstormHistory}`),g},Vb=async r=>{const g="You are a topic suggestion engine. Based on a primary topic, generate a list of related sub-topics to include for a comprehensive study guide, and a list of related but distinct topics to exclude to maintain focus.",l=`Primary topic: "${r}"`,u={type:Ze.OBJECT,properties:{topicsToInclude:{type:Ze.ARRAY,items:{type:Ze.STRING}},topicsToExclude:{type:Ze.ARRAY,items:{type:Ze.STRING}}},required:["topicsToInclude","topicsToExclude"]};return ps("gemini-2.5-flash",g,l,u)},Kb=async r=>{const{topic:g,sourceContent:l,sourceUrl:u,understandingLevel:f,learningGoal:i}=r,o="You are an instructional design expert. Your task is to analyze a user's request for generating learning content and provide structured suggestions to kickstart a conversation.";let m=`Analyze the following request for generating a learning module:
- Topic: ${g}
- User's Understanding Level: ${f}
- User's Learning Goal: ${i}
`;l&&(m+=`- Provided Text Content: ${l.substring(0,2e3)}...
`),u&&(m+=`- Provided URL: ${u}
`);const x={type:Ze.OBJECT,properties:{interpretation:{type:Ze.STRING,description:"A brief interpretation of the user's request and the source material."},titleSuggestions:{type:Ze.ARRAY,items:{type:Ze.STRING},description:"3-5 creative and descriptive title suggestions."},questionCountSuggestions:{type:Ze.ARRAY,items:{type:Ze.OBJECT,properties:{label:{type:Ze.STRING},count:{type:Ze.NUMBER}},required:["label","count"]},description:"Suggestions for content scope, like 'Quick Review (10 questions)', 'Standard (25 questions)', 'Deep Dive (50 questions)'."},followUpQuestions:{type:Ze.ARRAY,items:{type:Ze.STRING},description:"A few clarifying questions to ask the user to improve the generation."}},required:["interpretation","titleSuggestions","questionCountSuggestions","followUpQuestions"]};return ps("gemini-2.5-flash",o,m,x,r.temperature)},Zb=async(r,g)=>{try{const l=Id(),u="You are an instructional design expert. Your task is to have a brief, helpful conversation with a user to refine their request for learning content. Ask clarifying questions based on the initial request and the conversation so far. Keep your responses concise and conversational.",f=g.map(m=>`${m.role==="user"?"User":"AI"}: ${m.text}`).join(`
`);let i=`This is the user's initial request:
- Topic: ${r.topic}
- User's Understanding Level: ${r.understandingLevel}
- User's Learning Goal: ${r.learningGoal}
`;return r.sourceContent&&(i+=`- Provided Text Content: (summary is sufficient)
`),r.sourceUrl&&(i+=`- Provided URL: ${r.sourceUrl}
`),i+=`
This is our conversation so far:
${f}

Your turn to respond:`,(await l.models.generateContent({model:"gemini-2.5-flash",contents:i,config:{systemInstruction:u,temperature:.5}})).text}catch(l){throw console.error("Error in brainstormWithAI:",l),l.message.includes("Rpc failed due to xhr error")?new Error("A network error occurred while communicating with the AI service. Please check your connection and try again."):l}},Xb=async r=>{const{systemInstruction:g,temperature:l}=r,u=`${g}

You are a world-class instructional designer. Your task is to generate a comprehensive, structured learning path scaffold in JSON format based on the user's request and our brainstorming conversation. The path should be broken into logical 'levels', and each level into 'decks'. Provide a name and description for the series, and for each level and deck.`,f=Rd(r),i={type:Ze.OBJECT,properties:{seriesName:{type:Ze.STRING},seriesDescription:{type:Ze.STRING},levels:{type:Ze.ARRAY,items:{type:Ze.OBJECT,properties:{title:{type:Ze.STRING},decks:{type:Ze.ARRAY,items:{type:Ze.OBJECT,properties:{name:{type:Ze.STRING},description:{type:Ze.STRING},suggestedQuestionCount:{type:Ze.NUMBER}},required:["name","description"]}}},required:["title","decks"]}}},required:["seriesName","seriesDescription","levels"]};return ps("gemini-2.5-pro",u,f,i,l)},Yo={type:Ze.OBJECT,properties:{questionText:{type:Ze.STRING},tags:{type:Ze.ARRAY,items:{type:Ze.STRING}},detailedExplanation:{type:Ze.STRING},options:{type:Ze.ARRAY,items:{type:Ze.OBJECT,properties:{id:{type:Ze.STRING},text:{type:Ze.STRING},explanation:{type:Ze.STRING}},required:["id","text","explanation"]}},correctAnswerId:{type:Ze.STRING}},required:["questionText","detailedExplanation","options","correctAnswerId"]},Wb=async r=>{const{systemInstruction:g,temperature:l}=r,u=`${g}

You generate high-quality quiz decks in JSON format based on the user's request and our brainstorming conversation. Each question must have multiple options, a correct answer, and a detailed explanation.`,f=Rd(r),i={type:Ze.OBJECT,properties:{name:{type:Ze.STRING},description:{type:Ze.STRING},questions:{type:Ze.ARRAY,items:Yo}},required:["name","description","questions"]};return ps("gemini-2.5-pro",u,f,i,l)},gg=async r=>{const{systemInstruction:g,temperature:l}=r,u=`${g}

You create learning modules in JSON format based on the user's request and our brainstorming conversation. Each module consists of an informational HTML content block followed by several multiple-choice questions that test understanding of that content.`,f=Rd(r),i={type:Ze.OBJECT,properties:{infoCardContent:{type:Ze.STRING,description:"Well-formatted HTML content explaining the topic."},questions:{type:Ze.ARRAY,items:Yo}},required:["infoCardContent","questions"]};return ps("gemini-2.5-pro",u,f,i,l)},xg=async(r,g)=>{const l="You are an expert at creating quiz questions. Given a deck's title, description, and existing questions, generate new, unique, high-quality questions in JSON format.",u=(r.questions||[]).map(o=>`- ${Sn(o.questionText)}`).join(`
`),f=`Deck Name: "${r.name}"
Deck Description: "${r.description}"

Existing questions to avoid duplicating:
${u}

Generate ${g||10} new questions based on the deck's topic.`,i={type:Ze.ARRAY,items:Yo};return ps("gemini-2.5-pro",l,f,i)},ev=async(r,g)=>{const l="You are an expert at improving quiz questions. Given a question, regenerate it to be clearer, more accurate, or more challenging, while keeping the same core topic. Output a single JSON question object.",u=`Regenerate this question:

${JSON.stringify({questionText:g.questionText,options:g.options,correctAnswerId:g.correctAnswerId},null,2)}`;return ps("gemini-2.5-flash",l,u,Yo)},tv=async(r,g,l)=>{try{const u=Id(),f="You are a helpful assistant that expands on a selected piece of text within a larger context. Provide a more detailed explanation of the selected text as a single block of HTML.",i=`Topic: ${r}

Original Content:
"""
${Sn(g)}
"""

Selected Text to Expand On:
"""
${l}
"""

Provide a detailed explanation:`;return(await u.models.generateContent({model:"gemini-2.5-flash",contents:i,config:{systemInstruction:f}})).text}catch(u){throw console.error("Error in expandOnText:",u),u.message.includes("Rpc failed due to xhr error")?new Error("A network error occurred. Please check your connection and try again."):u}},nv=({handleUpdateDeck:r,handleAddDecks:g,handleAddSeriesWithDecks:l,handleUpdateSeries:u,openConfirmModal:f})=>{const{dispatch:i}=et(),{addToast:o}=Mt(),{openModal:m}=li(),{navigate:x}=ra(),d=U.useCallback(J=>{const Y={id:crypto.randomUUID(),type:J.generationType==="series-scaffold"?"generateSeriesScaffoldWithAI":J.generationType==="deck-learning"?"generateLearningDeckWithAI":"generateDeckWithAI",payload:J,statusText:`Queued: Generate ${J.generationType.replace(/-/g," ")}...`};i({type:"ADD_AI_TASK_TO_QUEUE",payload:Y}),o("AI generation task added to queue.","info"),m("aiStatus")},[i,o,m]),j=U.useCallback(async J=>{i({type:"UPDATE_CURRENT_AI_TASK_STATUS",payload:{statusText:`Generating scaffold for "${J.finalTitle}"...`}});const Y=async H=>{const{seriesName:K,seriesDescription:q,levels:W}=H,A=[],B=(W||[]).map(ee=>{const V=(ee.decks||[]).map(E=>({id:crypto.randomUUID(),name:E.name,description:E.description,type:J.isLearningMode?Ce.Learning:Ce.Quiz,questions:[],infoCards:[],suggestedQuestionCount:E.suggestedQuestionCount}));return A.push(...V),{title:ee.title,deckIds:V.map(E=>E.id)}}),z={id:crypto.randomUUID(),type:"series",name:K,description:q,levels:B,archived:!1,createdAt:new Date().toISOString()};await l(z,A),o("AI Series scaffold created.","success");const Q=J.isLearningMode?"generateSeriesLearningContentInBatches":"generateSeriesQuestionsInBatches",ue={id:crypto.randomUUID(),type:Q,payload:{seriesId:z.id},seriesId:z.id,statusText:`Queued: Generate content for "${z.name}"...`};i({type:"ADD_AI_TASK_TO_QUEUE",payload:ue})};try{const H=await Xb(J);await Y(H)}catch(H){if(H instanceof ms)o("AI response was invalid. Please try to fix it.","error"),m("aiResponseFix",{badJson:H.rawResponse,onRetry:K=>Y(K)});else throw H}},[i,l,o,m]),y=U.useCallback(async J=>{i({type:"UPDATE_CURRENT_AI_TASK_STATUS",payload:{statusText:`Generating deck "${J.finalTitle}"...`}});const Y=async H=>{const K={id:crypto.randomUUID(),name:H.name,description:H.description,type:Ce.Quiz,questions:pa(H.questions||[])};await g([K]),o(`Deck "${K.name}" created with AI.`,"success"),x(`/decks/${K.id}`)};try{const H=await Wb(J);await Y(H)}catch(H){if(H instanceof ms)o("AI response was invalid. Please try to fix it.","error"),m("aiResponseFix",{badJson:H.rawResponse,onRetry:K=>Y(K)});else throw H}},[i,g,o,x,m]),_=U.useCallback(async J=>{i({type:"UPDATE_CURRENT_AI_TASK_STATUS",payload:{statusText:`Generating learning deck "${J.finalTitle}"...`}});const Y={id:crypto.randomUUID(),name:J.finalTitle,description:`An AI-generated learning deck about ${J.topic}.`,type:Ce.Learning,questions:[],infoCards:[]};await g([Y]);const H=async K=>{i({type:"UPDATE_CURRENT_AI_TASK_STATUS",payload:{statusText:`Formatting content for "${J.finalTitle}"...`,deckId:Y.id}});const q={id:crypto.randomUUID(),content:K.infoCardContent,unlocksQuestionIds:K.questions.map((z,Q)=>`${Y.id}-q-${Q}`)},W=(K.questions||[]).reduce((z,Q)=>(Q.questionText&&Q.options&&Q.correctAnswerId&&Q.detailedExplanation&&z.push({questionType:"multipleChoice",questionText:Q.questionText,options:Q.options,correctAnswerId:Q.correctAnswerId,detailedExplanation:Q.detailedExplanation,tags:Q.tags}),z),[]),A=pa(W).map((z,Q)=>({...z,id:`${Y.id}-q-${Q}`,infoCardIds:[q.id]})),B={...Y,infoCards:[q],questions:A};await r(B),o(`Learning Deck "${B.name}" created with AI.`,"success"),x(`/decks/${B.id}`)};try{i({type:"UPDATE_CURRENT_AI_TASK_STATUS",payload:{statusText:`Generating content for "${J.finalTitle}"...`,deckId:Y.id}});const K=await gg(J);await H(K)}catch(K){if(K instanceof ms)o("AI response was invalid. Please try to fix it.","error"),m("aiResponseFix",{badJson:K.rawResponse,onRetry:q=>H(q)});else throw K}},[i,g,r,o,x,m]),b=U.useCallback(async(J,Y)=>{i({type:"UPDATE_CURRENT_AI_TASK_STATUS",payload:{statusText:`Generating questions for "${J.name}"...`,deckId:J.id}});const H=async K=>{const q=K.flatMap(B=>{const{questionText:z,options:Q,correctAnswerId:ue,detailedExplanation:ee,tags:V}=B;return z&&Q&&ue&&ee?[{questionType:"multipleChoice",questionText:z,options:Q,correctAnswerId:ue,detailedExplanation:ee,tags:V}]:[]}),W=pa(q),A={...J,questions:[...J.questions||[],...W]};await r(A),o(`Added ${W.length} new questions to "${J.name}".`,"success")};try{const K=await xg(J,Y);await H(K)}catch(K){if(K instanceof ms)o("AI response was invalid. Please try to fix it.","error"),m("aiResponseFix",{badJson:K.rawResponse,onRetry:q=>H(q)});else throw K}},[i,r,o,m]),D=U.useCallback((J,Y)=>{const H={id:crypto.randomUUID(),type:"generateQuestionsForDeck",payload:{deck:J,count:Y},deckId:J.id,statusText:`Queued: Add questions to "${J.name}"...`};i({type:"ADD_AI_TASK_TO_QUEUE",payload:H}),o("AI generation task added to queue.","info"),m("aiStatus")},[i,o,m]),w=U.useCallback(J=>{f({title:"Generate All Questions?",message:"This will generate questions for all empty decks in this series. This may take some time and consume API credits. Do you want to proceed?",onConfirm:()=>{const Y={id:crypto.randomUUID(),type:"generateSeriesQuestionsInBatches",payload:{seriesId:J},seriesId:J,statusText:"Queued: Generate all questions for series..."};i({type:"ADD_AI_TASK_TO_QUEUE",payload:Y}),o("Task to generate all series questions has been queued.","info"),m("aiStatus")}})},[i,o,m,f]),N=U.useCallback(async J=>{const{decks:Y,deckSeries:H}=et.getState(),K=H.find(A=>A.id===J);if(!K){o("Series not found for AI generation.","error");return}const q=new Set((K.levels||[]).flatMap(A=>(A==null?void 0:A.deckIds)||[])),W=Y.filter(A=>{var B;return q.has(A.id)&&(A.type===Ce.Quiz||A.type===Ce.Learning)&&(((B=A.questions)==null?void 0:B.length)||0)===0});for(let A=0;A<W.length;A++){const B=W[A];i({type:"UPDATE_CURRENT_AI_TASK_STATUS",payload:{statusText:`Generating for "${B.name}" (${A+1}/${W.length})...`,seriesId:J,deckId:B.id}});const z=B.suggestedQuestionCount||15,Q=async ue=>{const ee=ue.reduce((L,se)=>{if(se.questionText&&se.options&&se.correctAnswerId&&se.detailedExplanation){const ie={questionType:"multipleChoice",questionText:se.questionText,options:se.options,correctAnswerId:se.correctAnswerId,detailedExplanation:se.detailedExplanation,tags:se.tags};L.push(ie)}else o(`Warning: A question for "${B.name}" was malformed by the AI and has been skipped.`,"info");return L},[]),V=pa(ee),E={...B,questions:[...B.questions||[],...V]};await r(E,{silent:!0})};try{const ue=await xg(B,z);await Q(ue)}catch(ue){if(ue instanceof ms){o(`AI response for "${B.name}" was invalid. You can fix it to continue.`,"error");const ee=await new Promise(V=>{m("aiResponseFix",{badJson:ue.rawResponse,onRetry:E=>V(E),onCancel:()=>V(null)})});ee?await Q(ee):o(`Skipped question generation for "${B.name}".`,"info")}else o(`Failed to generate questions for "${B.name}": ${ue instanceof Error?ue.message:"Unknown error"}`,"error")}}o(`Finished generating questions for series "${K.name}".`,"success")},[i,r,o,m]),S=U.useCallback(async J=>{const{decks:Y,deckSeries:H}=et.getState(),K=H.find(A=>A.id===J);if(!K){o("Series not found for AI generation.","error");return}const q=new Set((K.levels||[]).flatMap(A=>(A==null?void 0:A.deckIds)||[])),W=Y.filter(A=>{var B;return q.has(A.id)&&A.type===Ce.Learning&&(((B=A.infoCards)==null?void 0:B.length)||0)===0});for(let A=0;A<W.length;A++){const B=W[A];i({type:"UPDATE_CURRENT_AI_TASK_STATUS",payload:{statusText:`Generating for "${B.name}" (${A+1}/${W.length})...`,seriesId:J,deckId:B.id}});const z=B.suggestedQuestionCount||5,Q=async ue=>{const ee={id:crypto.randomUUID(),content:ue.infoCardContent,unlocksQuestionIds:(ue.questions||[]).map((se,ie)=>`${B.id}-q-${ie}`)},V=(ue.questions||[]).reduce((se,ie)=>{const{questionText:oe,options:Ne,correctAnswerId:we,detailedExplanation:je,tags:ve}=ie;if(oe&&Ne&&we&&je){const Me={questionType:"multipleChoice",questionText:oe,options:Ne,correctAnswerId:we,detailedExplanation:je,tags:ve};se.push(Me)}else o(`Warning: A learning deck question for "${B.name}" was malformed by the AI and skipped.`,"info");return se},[]),E=pa(V).map((se,ie)=>({...se,id:`${B.id}-q-${ie}`,infoCardIds:[ee.id]})),L={...B,infoCards:[ee],questions:E};await r(L,{silent:!0})};try{const ue=await gg({topic:B.name,questionCount:z,generationType:"deck-learning",understandingLevel:"Auto",learningGoal:"Auto",learningStyle:"Auto",language:"English",tone:"Auto",comprehensiveness:"Standard",isLearningMode:!0});await Q(ue)}catch(ue){if(ue instanceof ms){o(`AI response for "${B.name}" was invalid. You can fix it to continue.`,"error");const ee=await new Promise(V=>{m("aiResponseFix",{badJson:ue.rawResponse,onRetry:E=>V(E),onCancel:()=>V(null)})});ee?await Q(ee):o(`Skipped content generation for "${B.name}".`,"info")}else o(`Failed to generate content for "${B.name}": ${ue instanceof Error?ue.message:"Unknown error"}`,"error")}}o(`Finished generating content for series "${K.name}".`,"success")},[i,r,o,m]),O=U.useCallback(async(J,Y)=>{try{const H=await ev(J,Y),[K]=pa([{...H,questionType:"multipleChoice"}]),q={...Y,...K,id:Y.id},W=(J.questions||[]).map(B=>B.id===q.id?q:B),A={...J,questions:W};await r(A,{silent:!0}),o("Question regenerated.","success")}catch(H){o(`Failed to regenerate question: ${H instanceof Error?H.message:"Unknown error"}`,"error")}},[r,o]),C=U.useCallback(async(J,Y,H)=>{try{return await tv(J,Y,H)}catch(K){return o(`AI expansion failed: ${K instanceof Error?K.message:"Unknown error"}`,"error"),null}},[o]),M=U.useCallback(async J=>{o("AI feature not implemented yet.","info")},[o]),R=U.useCallback(async(J,Y)=>{o("AI feature not implemented yet.","info")},[o]),$=U.useCallback(J=>{const{decks:Y,folders:H,deckSeries:K}=et.getState(),q=async()=>{try{switch(J.action){case Ta.CREATE_DECK:await g([{id:crypto.randomUUID(),name:J.payload.name,type:Ce.Flashcard,cards:[],description:"Created by AI Assistant"}]);break;case Ta.RENAME_DECK:const W=Y.find(ee=>ee.id===J.payload.deckId);W&&await r({...W,name:J.payload.newName});break;case Ta.DELETE_DECK:const A=Y.find(ee=>ee.id===J.payload.deckId);A&&await r({...A,deletedAt:new Date().toISOString()});break;case Ta.CREATE_FOLDER:i({type:"ADD_FOLDER",payload:{id:crypto.randomUUID(),name:J.payload.name}});break;case Ta.RENAME_FOLDER:const B=H.find(ee=>ee.id===J.payload.folderId);B&&i({type:"UPDATE_FOLDER",payload:{...B,name:J.payload.newName}});break;case Ta.DELETE_FOLDER:const z=H.find(ee=>ee.id===J.payload.folderId);z&&i({type:"DELETE_FOLDER",payload:z.id});break;case Ta.MOVE_DECK_TO_FOLDER:const Q=Y.find(ee=>ee.id===J.payload.deckId);Q&&await r({...Q,folderId:J.payload.folderId});break;case Ta.GENERATE_QUESTIONS_FOR_DECK:const ue=Y.find(ee=>ee.id===J.payload.deckId);ue&&(ue.type===Ce.Quiz||ue.type===Ce.Learning)&&D(ue,J.payload.count);break}o("AI action completed!","success")}catch{o("AI action failed.","error")}};f({title:"Confirm AI Action",message:J.confirmationMessage,onConfirm:q,confirmText:"Confirm"})},[f,g,r,o,i,D]),X=U.useCallback(J=>{i({type:"CANCEL_AI_TASK",payload:{taskId:J}}),o("AI task cancelled.","info")},[i,o]);return U.useMemo(()=>({handleGenerateWithAI:d,onGenerateSeriesScaffold:j,onGenerateDeck:y,onGenerateLearningDeck:_,onGenerateQuestionsForDeck:b,onGenerateSeriesQuestionsInBatches:N,onGenerateSeriesLearningContentInBatches:S,handleAiAddLevelsToSeries:M,handleAiAddDecksToLevel:R,handleExecuteAIAction:$,handleCancelAIGeneration:X,handleGenerateQuestionsForDeck:D,handleGenerateContentForLearningDeck:J=>D(J),handleGenerateQuestionsForEmptyDecksInSeries:w,handleRegenerateQuestion:O,handleExpandText:C}),[d,j,y,_,b,N,S,M,R,$,X,D,w,O,C])},av=r=>{const{dispatch:g}=et(),{openModal:l,closeModal:u}=li(),{addToast:f}=Mt(),{navigate:i}=ra(),o=Fb({...r,addToast:f,openModal:l,closeModal:u,dispatch:g}),{triggerSync:m}=o,x=Mb({triggerSync:m,openConfirmModal:D=>l("confirm",D)}),d=Ub({triggerSync:m,handleAddDecks:x.handleAddDecks,handleUpdateDeck:x.handleUpdateDeck}),j=Bb({...r,handleUpdateDeck:x.handleUpdateDeck}),y=Jb({...r,openConfirmModal:D=>l("confirm",D),openRestoreFromDriveModal:()=>l("restoreFromDrive"),onRestoreData:o.onRestoreData}),_=nv({handleUpdateDeck:x.handleUpdateDeck,handleAddDecks:x.handleAddDecks,handleAddSeriesWithDecks:d.handleAddSeriesWithDecks,handleUpdateSeries:d.handleUpdateSeries,openConfirmModal:D=>l("confirm",D)}),b=U.useCallback(async(D,w)=>{if(u(),!!D)try{if(D.type==="series"){const{seriesName:N,seriesDescription:S,levels:O}=D.data,C=[],M=(O||[]).map($=>{const X=($.decks||[]).map(J=>J.type==="quiz"?{id:crypto.randomUUID(),name:J.name,description:J.description,type:Ce.Quiz,questions:pa(J.questions||[])}:J.type==="flashcard"?{id:crypto.randomUUID(),name:J.name,description:J.description,type:Ce.Flashcard,cards:pl(J.cards||[])}:null).filter(J=>J!==null);return C.push(...X),{title:$.title,deckIds:X.map(J=>J.id)}}),R={id:crypto.randomUUID(),type:"series",name:N,description:S,levels:M,archived:!1,createdAt:new Date().toISOString()};await d.handleAddSeriesWithDecks(R,C)}else if(D.type==="quiz"){const N={id:crypto.randomUUID(),name:w||D.data.name,description:D.data.description,type:Ce.Quiz,questions:pa(D.data.questions)};await x.handleAddDecks([N]),f(`Deck "${N.name}" imported successfully.`,"success")}else if(D.type==="flashcard"){if(!w){f("Deck name is required for flashcard import.","error");return}const N=pl(D.data),S={id:crypto.randomUUID(),name:w,type:Ce.Flashcard,cards:N,description:`${N.length} imported flashcard${N.length===1?"":"s"}.`};await x.handleAddDecks([S]),f(`Deck "${S.name}" imported successfully.`,"success")}}catch(N){f(N.message,"error")}},[d,x,f,u]);return U.useMemo(()=>({...x,...d,...j,...o,...y,..._,openModal:l,closeModal:u,handleDroppedFileConfirm:b,openConfirmModal:D=>l("confirm",D)}),[x,d,j,o,y,_,l,u,b])},Uo=120,rv=()=>{const[r,g]=U.useState({startY:0,pullDistance:0,isRefreshing:!1,thresholdMet:!1}),{hapticsEnabled:l}=sa(),u=U.useCallback(o=>{if(o.touches.length===0)return;const m=o.target;window.scrollY===0&&!m.closest('input, textarea, button, a[href], select, [role="button"], [role="switch"]')?g(x=>({...x,startY:o.touches[0].clientY,pullDistance:0,isRefreshing:!1,thresholdMet:!1})):g(x=>({...x,startY:0}))},[]),f=U.useCallback(o=>{if(r.startY===0||o.touches.length===0)return;const m=o.touches[0].clientY-r.startY;m>5&&(o.preventDefault(),m>Uo&&!r.thresholdMet&&l&&"vibrate"in navigator&&navigator.vibrate(50),g(d=>({...d,pullDistance:m,thresholdMet:m>Uo})))},[r.startY,r.thresholdMet,l]),i=U.useCallback(()=>{r.startY!==0&&(r.pullDistance>Uo?(g(o=>({...o,isRefreshing:!0})),setTimeout(()=>{window.location.reload()},500)):g({startY:0,pullDistance:0,isRefreshing:!1,thresholdMet:!1}))},[r.startY,r.pullDistance]);return{pullToRefreshState:r,handleTouchStart:u,handleTouchMove:f,handleTouchEnd:i,REFRESH_THRESHOLD:Uo}},sv=({onOpenMenu:r,onOpenCommandPalette:g,activeDeck:l,isVisible:u})=>{const{path:f}=ra(),[i,o]=f.split("?"),m=i==="/",d=(y=>{if(y==="/study/general")return!0;if(y.startsWith("/decks/")){const _=y.split("/"),b=_[_.length-1];return["study","cram","study-reversed","study-flip"].includes(b)}return!1})(i);let j;if(m)j=n.jsx(Gt,{href:"/",className:"no-underline",children:n.jsx("h1",{className:"text-2xl font-bold text-transparent bg-clip-text bg-gradient-to-r from-blue-400 to-teal-300",children:"CogniFlow"})});else{let y="/",_="Back";if(d){const b=(l==null?void 0:l.name)||(i==="/study/general"?"General Study":"Back");_=n.jsx("span",{className:"truncate",children:b});const D=i.split("/")[2],N=new URLSearchParams(o).get("seriesId");y=N?`/series/${N}`:`/decks/${D}`}else if(i.startsWith("/decks/")){const D=new URLSearchParams(o).get("seriesId");y=D?`/series/${D}`:"/decks"}else i.startsWith("/series/")?y="/series":["/decks","/series","/settings","/archive","/trash","/progress","/instructions/json"].includes(i)&&(y="/");j=n.jsxs(Gt,{href:y,passAs:ce,variant:"ghost",className:"flex items-center space-x-2 -ml-3 min-w-0",children:[n.jsx(te,{name:"chevron-left"}),_]})}return n.jsx("header",{className:`bg-surface/80 backdrop-blur-sm fixed top-0 left-0 right-0 z-20 border-b border-border transition-transform duration-300 ease-in-out ${u?"translate-y-0":"-translate-y-full"}`,children:n.jsxs("nav",{className:"container mx-auto px-4 sm:px-6 lg:px-8 flex items-center justify-between h-16",children:[n.jsx("div",{className:"flex items-center flex-1 min-w-0",children:j}),n.jsxs("div",{className:"flex items-center space-x-1",children:[n.jsx(ce,{variant:"ghost",onClick:g,className:"p-1 h-auto","aria-label":"Open command palette",children:n.jsx(te,{name:"search"})}),n.jsx(ce,{variant:"ghost",onClick:r,className:"p-1 h-auto","aria-label":"Open menu",children:n.jsx(te,{name:"menu"})})]})]})})},ir=({html:r,className:g,as:l="div"})=>{const u=`html-container-${Hr.useId()}`;return Hr.useEffect(()=>{const f=document.getElementById(u);if(!f)return;const i=Array.from(f.getElementsByTagName("script")),o=[];return i.forEach(m=>{const x=document.createElement("script");Array.from(m.attributes).forEach(d=>{x.setAttribute(d.name,d.value)}),m.text&&!m.src?x.text=`try { ${m.text} } catch (e) { console.error('Error in custom card script:', e); }`:x.text=m.text,document.body.appendChild(x),o.push(x)}),()=>{o.forEach(m=>{document.body.contains(m)&&document.body.removeChild(m)})}},[r,u]),n.jsx(l,{id:u,className:g,dangerouslySetInnerHTML:{__html:r}})},gs=({level:r})=>{const g=Math.round(r*100);let l="bg-red-500",u="Novice";return g>85?(l="bg-green-500",u="Mastered"):g>65?(l="bg-teal-500",u="Proficient"):g>40?(l="bg-blue-500",u="Familiar"):g>15&&(l="bg-orange-500",u="Learning"),n.jsxs("div",{className:"w-full",children:[n.jsxs("div",{className:"flex justify-between mb-1 text-xs",children:[n.jsxs("span",{className:"font-semibold text-gray-600 dark:text-gray-300",children:["Mastery: ",u]}),n.jsxs("span",{className:"font-semibold text-gray-500 dark:text-gray-400",children:[g,"%"]})]}),n.jsx("div",{className:"w-full bg-gray-200 dark:bg-gray-700 rounded-full h-2",children:n.jsx("div",{className:`${l} h-2 rounded-full transition-all duration-500`,style:{width:`${g}%`},role:"progressbar","aria-valuenow":g,"aria-valuemin":0,"aria-valuemax":100,"aria-label":`Mastery level: ${u}, ${g}%`})})]})},iv=({card:r,isFlipped:g})=>{const l="text-xl text-left text-text break-words prose dark:prose-invert max-w-none prose-img:mx-auto prose-img:max-h-64 prose-audio:mx-auto",u=Rn(r);return n.jsxs("div",{className:"w-full bg-surface rounded-lg shadow-lg border border-border",children:[r.css&&n.jsx("div",{dangerouslySetInnerHTML:{__html:r.css}}),n.jsx("div",{className:"p-6 md:p-8 min-h-[12rem] flex items-center justify-center",children:n.jsx(ir,{html:r.front,className:l})}),g&&n.jsxs("div",{className:"animate-fade-in",style:{animationDuration:"400ms"},children:[n.jsx("hr",{className:"border-border/50"}),n.jsxs("div",{className:"p-6 md:p-8 bg-background/30 dark:bg-black/10",children:[n.jsx(ir,{html:r.back,className:l}),n.jsx("div",{className:"mt-6 pt-6 border-t border-border/50",children:n.jsx(gs,{level:u})})]})]})]})},lv=({question:r,selectedAnswerId:g,onSelectAnswer:l,deckName:u,onShowInfo:f})=>{const i=g!==null,o=U.useMemo(()=>{const d=[...r.options||[]];for(let j=d.length-1;j>0;j--){const y=Math.floor(Math.random()*(j+1));[d[j],d[y]]=[d[y],d[j]]}return d},[r.id]),m=d=>{let j="flex items-start text-left w-full p-4 rounded-lg border-2 transition-all duration-200";if(!i)return`${j} bg-surface border-border hover:border-primary cursor-pointer`;const y=d.id===r.correctAnswerId,_=d.id===g;return y?`${j} border-green-500 bg-green-500/10 cursor-not-allowed`:_?`${j} border-red-500 bg-red-500/10 cursor-not-allowed`:`${j} border-border bg-background/50 cursor-not-allowed`},x=Rn(r);return n.jsxs("div",{className:"bg-surface rounded-lg shadow-lg border border-border",children:[n.jsxs("div",{className:"p-6 md:p-8",children:[n.jsxs("div",{className:"mb-2",children:[r.tags&&r.tags.length>0&&n.jsx("div",{className:"flex flex-wrap items-center gap-1 mb-1",children:r.tags.map(d=>n.jsx("span",{className:"bg-border/50 text-text-muted text-xs px-2 py-0.5 rounded-full",children:d},d))}),u&&n.jsx("p",{className:"text-xs text-text-muted uppercase tracking-wider font-semibold",children:u})]}),n.jsx(ir,{html:r.questionText,className:"text-xl font-semibold text-text",as:"h3"})]}),n.jsx("div",{className:"px-6 md:px-8 pb-6 md:pb-8",children:n.jsx("div",{className:"space-y-3",children:o.map(d=>n.jsxs("button",{onClick:()=>l(d.id),disabled:i,className:m(d),"aria-pressed":g===d.id,children:[n.jsxs("div",{className:"flex-1 min-w-0",children:[n.jsx(ir,{html:d.text,className:"prose dark:prose-invert max-w-none"}),i&&d.explanation&&n.jsx("p",{className:"text-xs mt-1 text-text-muted",children:d.explanation})]}),i&&n.jsx("div",{className:"ml-4 flex-shrink-0",children:d.id===r.correctAnswerId?n.jsx(te,{name:"check-circle",className:"w-6 h-6 text-green-500"}):d.id===g?n.jsx(te,{name:"x-circle",className:"w-6 h-6 text-red-500"}):null})]},d.id))})}),i&&n.jsxs("div",{className:"p-6 bg-background/30 dark:bg-black/10 border-t border-border/50 animate-fade-in",children:[r.detailedExplanation&&n.jsxs("div",{children:[n.jsx("h4",{className:"text-sm font-semibold uppercase tracking-wider text-text-muted mb-2",children:"Explanation"}),n.jsx(ir,{html:r.detailedExplanation,className:"prose dark:prose-invert max-w-none prose-sm"})]}),f&&n.jsx("div",{className:`flex justify-end ${r.detailedExplanation?"mt-4":""}`,children:n.jsxs(ce,{variant:"ghost",size:"sm",onClick:f,children:[n.jsx(te,{name:"info",className:"w-4 h-4 mr-1"}),"View Related Info"]})}),n.jsx("div",{className:r.detailedExplanation||f?"mt-6 pt-6 border-t border-border/50":"",children:n.jsx(gs,{level:x})})]})]})},lx=({current:r,total:g})=>{const l=g>0?r/g*100:0;return n.jsx("div",{className:"w-full bg-border/30 rounded-full h-2.5",children:n.jsx("div",{className:"bg-primary h-2.5 rounded-full transition-all duration-500",style:{width:`${l}%`}})})},ov=({infoCard:r})=>n.jsx("div",{className:"w-full bg-surface rounded-lg shadow-lg border border-border",children:n.jsx("div",{className:"p-6 md:p-8 min-h-[12rem] flex items-center justify-center",children:n.jsx(ir,{html:r.content,className:"text-lg text-left text-text break-words prose dark:prose-invert max-w-none prose-img:mx-auto prose-img:max-h-64"})})}),cv=({isOpen:r,onClose:g,infoCards:l})=>{const u=U.useRef(null);return Yt(u,r),r?n.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-75 flex items-center justify-center z-[60] p-4",children:n.jsxs("div",{ref:u,className:"bg-surface rounded-lg shadow-xl w-full max-w-2xl transform transition-all relative max-h-[90vh] flex flex-col",role:"dialog","aria-modal":"true","aria-labelledby":"info-modal-title",children:[n.jsxs("div",{className:"flex-shrink-0 flex justify-between items-center p-4 border-b border-border",children:[n.jsx("h2",{id:"info-modal-title",className:"text-xl font-bold text-text",children:"Related Information"}),n.jsx(ce,{type:"button",variant:"ghost",onClick:g,className:"p-1 h-auto","aria-label":"Close",children:n.jsx(te,{name:"x"})})]}),n.jsx("div",{className:"p-6 overflow-y-auto space-y-6",children:l.map((f,i)=>n.jsxs("div",{children:[n.jsx(ir,{html:f.content,className:"prose dark:prose-invert max-w-none"}),i<l.length-1&&n.jsx("hr",{className:"my-6 border-border"})]},f.id))}),n.jsx("div",{className:"flex-shrink-0 flex justify-end p-4 bg-background/50 border-t border-border",children:n.jsx(ce,{type:"button",variant:"primary",onClick:g,children:"Close"})})]})}):null},uv=(r,g,l)=>{const[u,f]=U.useState([]),[i,o]=U.useState(!1),[m,x]=U.useState(new Set),[d,j]=U.useState(new Set),[y,_]=U.useState(0),[b,D]=U.useState(0);return U.useEffect(()=>{(async()=>{var O;if(i)return;const N=r.type===Ce.Learning;if(l){const C=(r.type===Ce.Flashcard?r.cards:r.questions)||[];f(C),_(0),D(0),o(!0);return}let S=!1;try{const C=await Ug(g);((O=C==null?void 0:C.reviewQueue)==null?void 0:O.length)>0&&typeof C.currentIndex=="number"?(f(C.reviewQueue),_(C.currentIndex),D(C.itemsCompleted??C.currentIndex),N&&(x(new Set(C.readInfoCardIds||[])),j(new Set(C.unlockedQuestionIds||[]))),S=!0):C&&await ml(g)}catch(C){console.error("Failed to load saved session from DB",C)}if(!S){const C=new Date;if(C.setHours(23,59,59,999),N){const M=r,R=M.infoCards||[],$=new Set(R.flatMap(J=>J.unlocksQuestionIds||[])),X=(M.questions||[]).filter(J=>!J.suspended&&new Date(J.dueDate)<=C&&!$.has(J.id));f([...R,...X]),x(new Set),j(new Set)}else{const R=((r.type===Ce.Flashcard?r.cards:r.questions)||[]).filter($=>!$.suspended&&new Date($.dueDate)<=C).sort(()=>Math.random()-.5);f(R)}_(0),D(0)}o(!0)})()},[r,g,l,i]),{sessionQueue:u,setSessionQueue:f,isSessionInitialized:i,initialIndex:y,initialItemsCompleted:b,readInfoCardIds:m,setReadInfoCardIds:x,unlockedQuestionIds:d,setUnlockedQuestionIds:j}};var Md={};(function r(g,l,u,f){var i=!!(g.Worker&&g.Blob&&g.Promise&&g.OffscreenCanvas&&g.OffscreenCanvasRenderingContext2D&&g.HTMLCanvasElement&&g.HTMLCanvasElement.prototype.transferControlToOffscreen&&g.URL&&g.URL.createObjectURL),o=typeof Path2D=="function"&&typeof DOMMatrix=="function",m=function(){if(!g.OffscreenCanvas)return!1;var V=new OffscreenCanvas(1,1),E=V.getContext("2d");E.fillRect(0,0,1,1);var L=V.transferToImageBitmap();try{E.createPattern(L,"no-repeat")}catch{return!1}return!0}();function x(){}function d(V){var E=l.exports.Promise,L=E!==void 0?E:g.Promise;return typeof L=="function"?new L(V):(V(x,x),null)}var j=function(V,E){return{transform:function(L){if(V)return L;if(E.has(L))return E.get(L);var se=new OffscreenCanvas(L.width,L.height),ie=se.getContext("2d");return ie.drawImage(L,0,0),E.set(L,se),se},clear:function(){E.clear()}}}(m,new Map),y=function(){var V=Math.floor(16.666666666666668),E,L,se={},ie=0;return typeof requestAnimationFrame=="function"&&typeof cancelAnimationFrame=="function"?(E=function(oe){var Ne=Math.random();return se[Ne]=requestAnimationFrame(function we(je){ie===je||ie+V-1<je?(ie=je,delete se[Ne],oe()):se[Ne]=requestAnimationFrame(we)}),Ne},L=function(oe){se[oe]&&cancelAnimationFrame(se[oe])}):(E=function(oe){return setTimeout(oe,V)},L=function(oe){return clearTimeout(oe)}),{frame:E,cancel:L}}(),_=function(){var V,E,L={};function se(ie){function oe(Ne,we){ie.postMessage({options:Ne||{},callback:we})}ie.init=function(we){var je=we.transferControlToOffscreen();ie.postMessage({canvas:je},[je])},ie.fire=function(we,je,ve){if(E)return oe(we,null),E;var Me=Math.random().toString(36).slice(2);return E=d(function(Fe){function Pe(Re){Re.data.callback===Me&&(delete L[Me],ie.removeEventListener("message",Pe),E=null,j.clear(),ve(),Fe())}ie.addEventListener("message",Pe),oe(we,Me),L[Me]=Pe.bind(null,{data:{callback:Me}})}),E},ie.reset=function(){ie.postMessage({reset:!0});for(var we in L)L[we](),delete L[we]}}return function(){if(V)return V;if(!u&&i){var ie=["var CONFETTI, SIZE = {}, module = {};","("+r.toString()+")(this, module, true, SIZE);","onmessage = function(msg) {","  if (msg.data.options) {","    CONFETTI(msg.data.options).then(function () {","      if (msg.data.callback) {","        postMessage({ callback: msg.data.callback });","      }","    });","  } else if (msg.data.reset) {","    CONFETTI && CONFETTI.reset();","  } else if (msg.data.resize) {","    SIZE.width = msg.data.resize.width;","    SIZE.height = msg.data.resize.height;","  } else if (msg.data.canvas) {","    SIZE.width = msg.data.canvas.width;","    SIZE.height = msg.data.canvas.height;","    CONFETTI = module.exports.create(msg.data.canvas);","  }","}"].join(`
`);try{V=new Worker(URL.createObjectURL(new Blob([ie])))}catch(oe){return typeof console!==void 0&&typeof console.warn=="function"&&console.warn("🎊 Could not load worker",oe),null}se(V)}return V}}(),b={particleCount:50,angle:90,spread:45,startVelocity:45,decay:.9,gravity:1,drift:0,ticks:200,x:.5,y:.5,shapes:["square","circle"],zIndex:100,colors:["#26ccff","#a25afd","#ff5e7e","#88ff5a","#fcff42","#ffa62d","#ff36ff"],disableForReducedMotion:!1,scalar:1};function D(V,E){return E?E(V):V}function w(V){return V!=null}function N(V,E,L){return D(V&&w(V[E])?V[E]:b[E],L)}function S(V){return V<0?0:Math.floor(V)}function O(V,E){return Math.floor(Math.random()*(E-V))+V}function C(V){return parseInt(V,16)}function M(V){return V.map(R)}function R(V){var E=String(V).replace(/[^0-9a-f]/gi,"");return E.length<6&&(E=E[0]+E[0]+E[1]+E[1]+E[2]+E[2]),{r:C(E.substring(0,2)),g:C(E.substring(2,4)),b:C(E.substring(4,6))}}function $(V){var E=N(V,"origin",Object);return E.x=N(E,"x",Number),E.y=N(E,"y",Number),E}function X(V){V.width=document.documentElement.clientWidth,V.height=document.documentElement.clientHeight}function J(V){var E=V.getBoundingClientRect();V.width=E.width,V.height=E.height}function Y(V){var E=document.createElement("canvas");return E.style.position="fixed",E.style.top="0px",E.style.left="0px",E.style.pointerEvents="none",E.style.zIndex=V,E}function H(V,E,L,se,ie,oe,Ne,we,je){V.save(),V.translate(E,L),V.rotate(oe),V.scale(se,ie),V.arc(0,0,1,Ne,we,je),V.restore()}function K(V){var E=V.angle*(Math.PI/180),L=V.spread*(Math.PI/180);return{x:V.x,y:V.y,wobble:Math.random()*10,wobbleSpeed:Math.min(.11,Math.random()*.1+.05),velocity:V.startVelocity*.5+Math.random()*V.startVelocity,angle2D:-E+(.5*L-Math.random()*L),tiltAngle:(Math.random()*(.75-.25)+.25)*Math.PI,color:V.color,shape:V.shape,tick:0,totalTicks:V.ticks,decay:V.decay,drift:V.drift,random:Math.random()+2,tiltSin:0,tiltCos:0,wobbleX:0,wobbleY:0,gravity:V.gravity*3,ovalScalar:.6,scalar:V.scalar,flat:V.flat}}function q(V,E){E.x+=Math.cos(E.angle2D)*E.velocity+E.drift,E.y+=Math.sin(E.angle2D)*E.velocity+E.gravity,E.velocity*=E.decay,E.flat?(E.wobble=0,E.wobbleX=E.x+10*E.scalar,E.wobbleY=E.y+10*E.scalar,E.tiltSin=0,E.tiltCos=0,E.random=1):(E.wobble+=E.wobbleSpeed,E.wobbleX=E.x+10*E.scalar*Math.cos(E.wobble),E.wobbleY=E.y+10*E.scalar*Math.sin(E.wobble),E.tiltAngle+=.1,E.tiltSin=Math.sin(E.tiltAngle),E.tiltCos=Math.cos(E.tiltAngle),E.random=Math.random()+2);var L=E.tick++/E.totalTicks,se=E.x+E.random*E.tiltCos,ie=E.y+E.random*E.tiltSin,oe=E.wobbleX+E.random*E.tiltCos,Ne=E.wobbleY+E.random*E.tiltSin;if(V.fillStyle="rgba("+E.color.r+", "+E.color.g+", "+E.color.b+", "+(1-L)+")",V.beginPath(),o&&E.shape.type==="path"&&typeof E.shape.path=="string"&&Array.isArray(E.shape.matrix))V.fill(Q(E.shape.path,E.shape.matrix,E.x,E.y,Math.abs(oe-se)*.1,Math.abs(Ne-ie)*.1,Math.PI/10*E.wobble));else if(E.shape.type==="bitmap"){var we=Math.PI/10*E.wobble,je=Math.abs(oe-se)*.1,ve=Math.abs(Ne-ie)*.1,Me=E.shape.bitmap.width*E.scalar,Fe=E.shape.bitmap.height*E.scalar,Pe=new DOMMatrix([Math.cos(we)*je,Math.sin(we)*je,-Math.sin(we)*ve,Math.cos(we)*ve,E.x,E.y]);Pe.multiplySelf(new DOMMatrix(E.shape.matrix));var Re=V.createPattern(j.transform(E.shape.bitmap),"no-repeat");Re.setTransform(Pe),V.globalAlpha=1-L,V.fillStyle=Re,V.fillRect(E.x-Me/2,E.y-Fe/2,Me,Fe),V.globalAlpha=1}else if(E.shape==="circle")V.ellipse?V.ellipse(E.x,E.y,Math.abs(oe-se)*E.ovalScalar,Math.abs(Ne-ie)*E.ovalScalar,Math.PI/10*E.wobble,0,2*Math.PI):H(V,E.x,E.y,Math.abs(oe-se)*E.ovalScalar,Math.abs(Ne-ie)*E.ovalScalar,Math.PI/10*E.wobble,0,2*Math.PI);else if(E.shape==="star")for(var k=Math.PI/2*3,xe=4*E.scalar,he=8*E.scalar,Z=E.x,P=E.y,ae=5,fe=Math.PI/ae;ae--;)Z=E.x+Math.cos(k)*he,P=E.y+Math.sin(k)*he,V.lineTo(Z,P),k+=fe,Z=E.x+Math.cos(k)*xe,P=E.y+Math.sin(k)*xe,V.lineTo(Z,P),k+=fe;else V.moveTo(Math.floor(E.x),Math.floor(E.y)),V.lineTo(Math.floor(E.wobbleX),Math.floor(ie)),V.lineTo(Math.floor(oe),Math.floor(Ne)),V.lineTo(Math.floor(se),Math.floor(E.wobbleY));return V.closePath(),V.fill(),E.tick<E.totalTicks}function W(V,E,L,se,ie){var oe=E.slice(),Ne=V.getContext("2d"),we,je,ve=d(function(Me){function Fe(){we=je=null,Ne.clearRect(0,0,se.width,se.height),j.clear(),ie(),Me()}function Pe(){u&&!(se.width===f.width&&se.height===f.height)&&(se.width=V.width=f.width,se.height=V.height=f.height),!se.width&&!se.height&&(L(V),se.width=V.width,se.height=V.height),Ne.clearRect(0,0,se.width,se.height),oe=oe.filter(function(Re){return q(Ne,Re)}),oe.length?we=y.frame(Pe):Fe()}we=y.frame(Pe),je=Fe});return{addFettis:function(Me){return oe=oe.concat(Me),ve},canvas:V,promise:ve,reset:function(){we&&y.cancel(we),je&&je()}}}function A(V,E){var L=!V,se=!!N(E||{},"resize"),ie=!1,oe=N(E,"disableForReducedMotion",Boolean),Ne=i&&!!N(E||{},"useWorker"),we=Ne?_():null,je=L?X:J,ve=V&&we?!!V.__confetti_initialized:!1,Me=typeof matchMedia=="function"&&matchMedia("(prefers-reduced-motion)").matches,Fe;function Pe(k,xe,he){for(var Z=N(k,"particleCount",S),P=N(k,"angle",Number),ae=N(k,"spread",Number),fe=N(k,"startVelocity",Number),Ae=N(k,"decay",Number),de=N(k,"gravity",Number),Ue=N(k,"drift",Number),Le=N(k,"colors",M),_e=N(k,"ticks",Number),pe=N(k,"shapes"),Be=N(k,"scalar"),He=!!N(k,"flat"),Xe=$(k),qe=Z,Ge=[],at=V.width*Xe.x,Je=V.height*Xe.y;qe--;)Ge.push(K({x:at,y:Je,angle:P,spread:ae,startVelocity:fe,color:Le[qe%Le.length],shape:pe[O(0,pe.length)],ticks:_e,decay:Ae,gravity:de,drift:Ue,scalar:Be,flat:He}));return Fe?Fe.addFettis(Ge):(Fe=W(V,Ge,je,xe,he),Fe.promise)}function Re(k){var xe=oe||N(k,"disableForReducedMotion",Boolean),he=N(k,"zIndex",Number);if(xe&&Me)return d(function(fe){fe()});L&&Fe?V=Fe.canvas:L&&!V&&(V=Y(he),document.body.appendChild(V)),se&&!ve&&je(V);var Z={width:V.width,height:V.height};we&&!ve&&we.init(V),ve=!0,we&&(V.__confetti_initialized=!0);function P(){if(we){var fe={getBoundingClientRect:function(){if(!L)return V.getBoundingClientRect()}};je(fe),we.postMessage({resize:{width:fe.width,height:fe.height}});return}Z.width=Z.height=null}function ae(){Fe=null,se&&(ie=!1,g.removeEventListener("resize",P)),L&&V&&(document.body.contains(V)&&document.body.removeChild(V),V=null,ve=!1)}return se&&!ie&&(ie=!0,g.addEventListener("resize",P,!1)),we?we.fire(k,Z,ae):Pe(k,Z,ae)}return Re.reset=function(){we&&we.reset(),Fe&&Fe.reset()},Re}var B;function z(){return B||(B=A(null,{useWorker:!0,resize:!0})),B}function Q(V,E,L,se,ie,oe,Ne){var we=new Path2D(V),je=new Path2D;je.addPath(we,new DOMMatrix(E));var ve=new Path2D;return ve.addPath(je,new DOMMatrix([Math.cos(Ne)*ie,Math.sin(Ne)*ie,-Math.sin(Ne)*oe,Math.cos(Ne)*oe,L,se])),ve}function ue(V){if(!o)throw new Error("path confetti are not supported in this browser");var E,L;typeof V=="string"?E=V:(E=V.path,L=V.matrix);var se=new Path2D(E),ie=document.createElement("canvas"),oe=ie.getContext("2d");if(!L){for(var Ne=1e3,we=Ne,je=Ne,ve=0,Me=0,Fe,Pe,Re=0;Re<Ne;Re+=2)for(var k=0;k<Ne;k+=2)oe.isPointInPath(se,Re,k,"nonzero")&&(we=Math.min(we,Re),je=Math.min(je,k),ve=Math.max(ve,Re),Me=Math.max(Me,k));Fe=ve-we,Pe=Me-je;var xe=10,he=Math.min(xe/Fe,xe/Pe);L=[he,0,0,he,-Math.round(Fe/2+we)*he,-Math.round(Pe/2+je)*he]}return{type:"path",path:E,matrix:L}}function ee(V){var E,L=1,se="#000000",ie='"Apple Color Emoji", "Segoe UI Emoji", "Segoe UI Symbol", "Noto Color Emoji", "EmojiOne Color", "Android Emoji", "Twemoji Mozilla", "system emoji", sans-serif';typeof V=="string"?E=V:(E=V.text,L="scalar"in V?V.scalar:L,ie="fontFamily"in V?V.fontFamily:ie,se="color"in V?V.color:se);var oe=10*L,Ne=""+oe+"px "+ie,we=new OffscreenCanvas(oe,oe),je=we.getContext("2d");je.font=Ne;var ve=je.measureText(E),Me=Math.ceil(ve.actualBoundingBoxRight+ve.actualBoundingBoxLeft),Fe=Math.ceil(ve.actualBoundingBoxAscent+ve.actualBoundingBoxDescent),Pe=2,Re=ve.actualBoundingBoxLeft+Pe,k=ve.actualBoundingBoxAscent+Pe;Me+=Pe+Pe,Fe+=Pe+Pe,we=new OffscreenCanvas(Me,Fe),je=we.getContext("2d"),je.font=Ne,je.fillStyle=se,je.fillText(E,Re,k);var xe=1/L;return{type:"bitmap",bitmap:we.transferToImageBitmap(),matrix:[xe,0,0,xe,-Me*xe/2,-Fe*xe/2]}}l.exports=function(){return z().apply(this,arguments)},l.exports.reset=function(){z().reset()},l.exports.create=A,l.exports.shapeFromPath=ue,l.exports.shapeFromText=ee})(function(){return typeof window<"u"?window:typeof self<"u"?self:this||{}}(),Md,!1);const vd=Md.exports;Md.exports.create;const yg=()=>(U.useEffect(()=>{const g=Date.now()+1e3,u={startVelocity:30,spread:360,ticks:90,zIndex:99,colors:["#60a5fa","#5eead4","#a78bfa","#fde047","#f9fafb"]};function f(o,m){return Math.random()*(m-o)+o}const i=window.setInterval(()=>{const o=g-Date.now();if(o<=0)return clearInterval(i);const m=50*(o/1e3);vd({...u,particleCount:m,origin:{x:f(.1,.3),y:Math.random()-.2}}),vd({...u,particleCount:m,origin:{x:f(.7,.9),y:Math.random()-.2}})},250);return()=>{clearInterval(i),vd.reset()}},[]),null),dv=({deckId:r,seriesId:g,reviewedItems:l,nextDeckId:u,onSessionEnd:f,onStudyNextDeck:i,isCramSession:o})=>{if(o)return n.jsxs("div",{className:"text-center p-8 animate-fade-in relative",children:[n.jsx(yg,{}),n.jsx("h2",{className:"text-2xl font-bold text-green-500",children:"Cram Session Complete!"}),n.jsxs("p",{className:"text-text-muted mt-2",children:["You've reviewed all ",l.length," items in this deck."]}),n.jsx(ce,{onClick:()=>f(r,g),className:"mt-8",children:"Finish Session"})]});const m=l.reduce((j,{rating:y})=>(y&&(j[y]=(j[y]||0)+1),j),{}),x=l.map(({oldItem:j,newItem:y})=>{const _=Rn(j);return(y.masteryLevel||0)-_}),d=x.length>0?x.reduce((j,y)=>j+y,0)/x.length*100:0;return n.jsxs("div",{className:"text-center p-8 animate-fade-in relative",children:[n.jsx(yg,{}),n.jsx("h2",{className:"text-2xl font-bold text-green-500",children:"Session Complete!"}),n.jsxs("p",{className:"text-text-muted mt-2",children:["You reviewed ",l.length," item",l.length!==1?"s":"","."]}),n.jsxs("div",{className:"mt-8 max-w-sm mx-auto bg-surface p-4 rounded-lg border border-border",children:[n.jsx("h3",{className:"font-semibold text-lg mb-3",children:"Session Summary"}),n.jsxs("div",{className:"flex justify-around text-center",children:[n.jsxs("div",{children:[n.jsx("p",{className:"text-2xl font-bold text-red-500",children:m[wt.Again]||0}),n.jsx("p",{className:"text-xs text-text-muted",children:"Again"})]}),n.jsxs("div",{children:[n.jsx("p",{className:"text-2xl font-bold text-orange-500",children:m[wt.Hard]||0}),n.jsx("p",{className:"text-xs text-text-muted",children:"Hard"})]}),n.jsxs("div",{children:[n.jsx("p",{className:"text-2xl font-bold text-green-500",children:m[wt.Good]||0}),n.jsx("p",{className:"text-xs text-text-muted",children:"Good"})]}),n.jsxs("div",{children:[n.jsx("p",{className:"text-2xl font-bold text-blue-500",children:m[wt.Easy]||0}),n.jsx("p",{className:"text-xs text-text-muted",children:"Easy"})]})]}),n.jsx("div",{className:"mt-4 text-sm",children:n.jsxs("p",{children:["Average Mastery Change: ",n.jsxs("strong",{className:d>=0?"text-green-500":"text-red-500",children:[d>=0?"+":"",d.toFixed(1),"%"]})]})})]}),n.jsxs("div",{className:"flex flex-col sm:flex-row justify-center items-center gap-4 mt-8",children:[u&&i&&g&&n.jsxs(ce,{onClick:()=>i(r,g,u),variant:"primary",size:"lg",children:[n.jsx(te,{name:"zap",className:"w-5 h-5 mr-2"}),"Start Next Deck"]}),n.jsx(ce,{onClick:()=>f(r,g),variant:u?"secondary":"primary",size:"lg",children:"Finish Session"})]})]})},fv=({isCurrent:r,isHistorical:g,isFlipped:l,isAnswered:u,isReviewing:f,isQuiz:i,isInfoCard:o,isCramSession:m,showNavArrows:x,displayIndex:d,currentIndex:j,queueLength:y,onReview:_,onSuspend:b,onReadInfoCard:D,onFlip:w,onReturnToCurrent:N,onNavigatePrevious:S,onNavigateNext:O,itemsCompleted:C,totalSessionItems:M})=>{const R=(l||i&&u)&&r;return n.jsxs("div",{className:"flex-shrink-0 mt-4 flex flex-col items-center justify-center space-y-4 min-h-[10rem]",children:[n.jsx("div",{className:"w-full flex-grow flex items-center justify-center",children:g?n.jsxs("div",{className:"text-center animate-fade-in",children:[n.jsx(ce,{onClick:N,variant:"primary",className:"text-lg py-3",children:"Return to Current Item"}),n.jsx("div",{className:"text-xs mt-2 font-semibold text-yellow-600 dark:text-yellow-400",children:"(Reviewing Past Item)"})]}):R?n.jsxs("div",{className:"space-y-4 animate-fade-in w-full",children:[n.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[n.jsx(ce,{onClick:()=>_(wt.Again),className:"bg-red-600 hover:bg-red-700 focus:ring-red-500 py-3 text-base text-white",disabled:f,children:"Again"}),n.jsx(ce,{onClick:()=>_(wt.Hard),className:"bg-orange-500 hover:bg-orange-600 focus:ring-orange-400 py-3 text-base text-white",disabled:f,children:"Hard"}),n.jsx(ce,{onClick:()=>_(wt.Good),className:"bg-green-600 hover:bg-green-700 focus:ring-green-500 py-3 text-base text-white",disabled:f,children:"Good"}),n.jsx(ce,{onClick:()=>_(wt.Easy),className:"bg-blue-600 hover:bg-blue-700 focus:ring-blue-500 py-3 text-base text-white",disabled:f,children:"Easy"})]}),!m&&n.jsx("div",{className:"text-center",children:n.jsxs(ce,{variant:"ghost",onClick:b,className:"text-xs",disabled:f,children:[n.jsx(te,{name:"eye-off",className:"w-4 h-4 mr-1"})," Suspend this item"]})})]}):o&&r?n.jsx(ce,{onClick:D,variant:"primary",className:"w-full max-w-md text-lg py-3 animate-fade-in mx-auto flex items-center justify-center",children:"Continue"}):!i&&r&&n.jsx(ce,{onClick:w,variant:"primary",className:"w-full max-w-md text-lg py-3 animate-fade-in mx-auto flex items-center justify-center",children:"Show Answer"})}),x&&n.jsxs("div",{className:"flex justify-center items-center w-full max-w-xs gap-4 animate-fade-in h-12",children:[n.jsx(ce,{variant:"ghost",onClick:S,disabled:d===0,className:"p-3 rounded-full disabled:opacity-30","aria-label":"Previous item",children:n.jsx(te,{name:"chevron-left",className:"w-8 h-8"})}),n.jsx("div",{className:"text-center w-28",children:n.jsxs("span",{className:"text-sm text-text-muted",children:["Item ",Math.min(C+1,M)," of ",M]})}),n.jsx(ce,{variant:"ghost",onClick:O,disabled:d>=j,className:"p-3 rounded-full disabled:opacity-30","aria-label":"Next item",children:n.jsx(te,{name:"chevron-left",className:"w-8 h-8 rotate-180"})})]})]})},cl=({deck:r,onSessionEnd:g,onItemReviewed:l,onUpdateLastOpened:u,sessionKeySuffix:f="",seriesId:i,onStudyNextDeck:o})=>{const[m,x]=U.useState([]),[d,j]=U.useState(0),[y,_]=U.useState(0),[b,D]=U.useState(!1),[w,N]=U.useState(null),[S,O]=U.useState(!1),[C,M]=U.useState(!1),[R,$]=U.useState([]),[X,J]=U.useState(0),[Y,H]=U.useState(0),{hapticsEnabled:K}=sa(),{addToast:q}=Mt(),{deckSeries:W,seriesProgress:A}=et(),B=i?W.find(pe=>pe.id===i):null,z=U.useMemo(()=>r.id==="general-study-deck"||["_cram","_flip","_reversed"].includes(f),[r.id,f]),Q=`session_deck_${r.id}${f}`,ue=r.type==="learning",{sessionQueue:ee,setSessionQueue:V,isSessionInitialized:E,initialIndex:L,readInfoCardIds:se,setReadInfoCardIds:ie,unlockedQuestionIds:oe,setUnlockedQuestionIds:Ne,initialItemsCompleted:we}=uv(r,Q,z);U.useEffect(()=>{E&&window.scrollTo({top:0,left:0,behavior:"instant"})},[d,E]),U.useEffect(()=>{var Be,He,Xe,qe;if(!E)return;let pe=0;if(z)pe=(r.type===Ce.Flashcard?(Be=r.cards)==null?void 0:Be.length:(He=r.questions)==null?void 0:He.length)||0;else if(r.type===Ce.Learning){const Ge=r;pe=(((Xe=Ge.infoCards)==null?void 0:Xe.length)||0)+(((qe=Ge.questions)==null?void 0:qe.length)||0)}else pe=ee.length;J(pe)},[E,r,z,ee]),U.useEffect(()=>{E&&(j(L),_(L),H(we))},[E,L,we]),U.useEffect(()=>{u(r.id)},[r.id,u]),U.useEffect(()=>{if(!z&&E&&d<ee.length){const pe={id:Q,reviewQueue:ee,currentIndex:d,readInfoCardIds:Array.from(se),unlockedQuestionIds:Array.from(oe),itemsCompleted:Y};Mg(Q,pe).catch(Be=>{console.error("Could not save session state to DB",Be),q("Could not save session progress.","error")})}},[ee,d,se,oe,Q,z,E,q,Y]);const je=U.useMemo(()=>ee[y],[ee,y]),ve=y<d,Me=y===d,Fe=je&&"questionText"in je,Pe=je&&"content"in je&&!("front"in je),Re=w!==null,k=je&&"originalDeckName"in je?je.originalDeckName:void 0,xe=U.useMemo(()=>{if(!i||Y<X)return null;const pe=W.find(Xe=>Xe.id===i);if(!pe)return null;const Be=(pe.levels||[]).flatMap(Xe=>Xe.deckIds||[]),He=Be.indexOf(r.id);if(He>-1&&He<Be.length-1){const Xe=A.get(i)||new Set,qe=He+1;if(qe<=Xe.size)return Be[qe]}return null},[i,r.id,W,Y,X,A]),he=U.useCallback(()=>{D(!1),N(null),H(Be=>Be+1);const pe=d+1;j(pe),_(pe),pe>=ee.length&&!z&&ml(Q).catch(Be=>console.error("Failed to delete session state",Be))},[d,ee.length,z,Q]),Z=U.useCallback(async pe=>{if(!je||!Me||S||!("interval"in je))return;if(f==="_cram"){O(!0),he(),O(!1);return}O(!0),K&&"vibrate"in navigator&&navigator.vibrate(20);let Be=Lb(je,pe);(Be.lapses||0)>=8&&!je.suspended&&(Be={...Be,suspended:!0},q("Item suspended due to repeated failures.","info")),Rn(je)<=.85&&(Be.masteryLevel||0)>.85&&q("Item Mastered!","success"),x(He=>[...He,{oldItem:je,newItem:Be,rating:pe}]);try{const He=je.originalDeckId||r.id;await l(He,Be,pe,i)}catch(He){console.error("Failed to save review:",He),q("Failed to save review progress for this card.","error")}finally{V(He=>He.map((Xe,qe)=>qe===d?Be:Xe)),setTimeout(()=>{he(),O(!1)},800)}},[je,Me,S,f,he,K,q,r.id,l,i,d,V]),P=U.useCallback(async()=>{if(!je||!Me||S||!("interval"in je))return;const pe=je;O(!0);const Be={...pe,suspended:!0};x(He=>[...He,{oldItem:pe,newItem:Be,rating:null}]);try{const He=pe.originalDeckId||r.id;await l(He,Be,null,i),q("Item suspended.","info")}catch(He){console.error("Failed to save suspended item:",He),q("Failed to suspend item.","error")}finally{V(He=>He.map((Xe,qe)=>qe===d?Be:Xe)),setTimeout(()=>{he(),O(!1)},500)}},[je,Me,S,he,q,r.id,l,i,d,V]),ae=U.useCallback(()=>{Me&&D(!0)},[Me]),fe=U.useCallback(pe=>{Me&&!Re&&N(pe)},[Me,Re]),Ae=U.useCallback(()=>{if(Me&&Pe){const pe=je;ie(qe=>new Set(qe).add(pe.id)),Ne(qe=>new Set([...qe,...pe.unlocksQuestionIds]));const Be=r.questions.filter(qe=>pe.unlocksQuestionIds.includes(qe.id)),He=new Set(ee.map(qe=>qe.id)),Xe=Be.filter(qe=>!He.has(qe.id));Xe.length>0&&(Xe.sort(()=>Math.random()-.5),V(qe=>{const Ge=[...qe];return Ge.splice(d+1,0,...Xe),Ge})),he()}},[Me,Pe,je,ie,Ne,r,V,d,he,ee]),de=U.useCallback(()=>{y>0&&_(pe=>pe-1)},[y]),Ue=U.useCallback(()=>{y<d&&_(pe=>pe+1)},[y,d]),Le=U.useCallback(()=>_(d),[d]),_e=U.useCallback(()=>{if(Fe){const Be=je.infoCardIds||[];if(Be.length>0){const He=r.infoCards.filter(Xe=>Be.includes(Xe.id));$(He),M(!0)}}},[Fe,je,r]);return E?E&&ee.length===0&&!z?n.jsxs("div",{className:"text-center p-8 animate-fade-in",children:[n.jsx("h2",{className:"text-2xl font-bold text-green-500",children:"All Done!"}),n.jsx("p",{className:"text-text-muted mt-2",children:"There are no items due for study in this deck right now."}),n.jsx(ce,{onClick:()=>g(r.id,i),className:"mt-8",children:"Back to Deck"})]}):d>=ee.length?n.jsx(dv,{deckId:r.id,seriesId:i,reviewedItems:m,nextDeckId:xe,onSessionEnd:g,onStudyNextDeck:o,isCramSession:f==="_cram"}):n.jsxs("div",{className:"max-w-2xl mx-auto flex flex-col h-full animate-fade-in",children:[n.jsx("div",{className:"w-full",children:n.jsx(lx,{current:Y,total:X})}),n.jsxs("div",{className:"text-center mt-4 mb-2 px-4",children:[B&&n.jsxs("div",{className:"mb-1",children:[n.jsx("span",{className:"text-xs text-text-muted mr-1",children:"in"}),n.jsx(Gt,{href:`/series/${B.id}`,className:"text-xs font-semibold text-text-muted hover:underline break-words",children:B.name})]}),n.jsx(Gt,{href:`/decks/${r.id}${i?`?seriesId=${i}`:""}`,className:"text-lg font-bold text-text hover:underline break-words",children:r.name})]}),n.jsx("div",{className:"flex-grow flex items-center justify-center pb-4",children:n.jsxs("div",{className:"w-full",children:[k&&n.jsx("p",{className:"text-center text-xs mb-2 text-text-muted uppercase tracking-wider font-semibold",children:k}),Pe?n.jsx(ov,{infoCard:je}):Fe?n.jsx(lv,{question:je,selectedAnswerId:w,onSelectAnswer:fe,onShowInfo:ue?_e:void 0},je.id):n.jsx(iv,{card:je,isFlipped:b},je.id)]})}),n.jsx(fv,{isCurrent:Me,isHistorical:ve,isFlipped:b,isAnswered:Re,isReviewing:S,isQuiz:Fe,isInfoCard:Pe,isCramSession:f==="_cram",showNavArrows:X>1,displayIndex:y,currentIndex:d,queueLength:ee.length,onReview:Z,onSuspend:P,onReadInfoCard:Ae,onFlip:ae,onReturnToCurrent:Le,onNavigatePrevious:de,onNavigateNext:Ue,itemsCompleted:Y,totalSessionItems:X}),n.jsx(cv,{isOpen:C,onClose:()=>M(!1),infoCards:R})]}):n.jsx("div",{className:"text-center p-8",children:"Loading session..."})},ri=({label:r,checked:g,onChange:l,description:u,disabled:f=!1})=>{const i=Hr.useId();return n.jsxs("div",{className:`flex items-center justify-between ${f?"opacity-50":""}`,children:[n.jsxs("span",{className:"flex flex-col",children:[n.jsx("label",{htmlFor:i,className:`font-medium text-text ${f?"cursor-not-allowed":"cursor-pointer"}`,children:r}),u&&n.jsx("span",{id:`${i}-description`,className:"text-sm text-text-muted",children:u})]}),n.jsx("button",{id:i,type:"button",role:"switch","aria-checked":g,"aria-describedby":u?`${i}-description`:void 0,onClick:()=>l(!g),disabled:f,className:`${g?"bg-primary":"bg-border"} relative inline-flex h-6 w-11 flex-shrink-0 cursor-pointer rounded-full border-2 border-transparent transition-colors duration-200 ease-in-out focus:outline-none focus:ring-2 focus:ring-primary focus:ring-offset-2 dark:focus:ring-offset-surface`,children:n.jsx("span",{"aria-hidden":"true",className:`${g?"translate-x-5":"translate-x-0"} pointer-events-none inline-block h-5 w-5 transform rounded-full bg-white shadow ring-0 transition duration-200 ease-in-out`})})]})},wd="cogniflow-themeId",qr=[{id:"system",name:"System",isDark:!1,metaColor:"#f9fafb",metaColorDark:"#111827",palette:{background:"249 250 251",surface:"255 255 255",primary:"37 99 235",text:"17 24 39"},paletteDark:{background:"17 24 39",surface:"31 41 55",primary:"37 99 235",text:"243 244 246"}},{id:"light",name:"Light",isDark:!1,metaColor:"#f9fafb",palette:{background:"249 250 251",surface:"255 255 255",primary:"37 99 235",text:"17 24 39"}},{id:"rose",name:"Rose",isDark:!1,metaColor:"#fff1f2",palette:{background:"255 241 242",surface:"254 226 226",primary:"225 29 72",text:"136 25 55"}},{id:"matcha",name:"Matcha",isDark:!1,metaColor:"#f0fdf4",palette:{background:"240 253 244",surface:"220 252 231",primary:"22 163 74",text:"21 94 53"}},{id:"latte",name:"Latte",isDark:!1,metaColor:"#fffbeb",palette:{background:"255 251 235",surface:"254 243 199",primary:"217 119 6",text:"113 63 18"}},{id:"sky",name:"Sky",isDark:!1,metaColor:"#f0f9ff",palette:{background:"240 249 255",surface:"224 242 254",primary:"14 165 233",text:"7 89 133"}},{id:"sunrise",name:"Sunrise",isDark:!1,metaColor:"#fffbeb",palette:{background:"255 251 235",surface:"254 243 199",primary:"249 115 22",text:"124 45 18"}},{id:"lavender",name:"Lavender",isDark:!1,metaColor:"#f5f3ff",palette:{background:"245 243 255",surface:"237 233 254",primary:"124 58 237",text:"76 29 149"}},{id:"terracotta",name:"Terracotta",isDark:!1,metaColor:"#faf3e8",palette:{background:"250 243 232",surface:"245 233 218",primary:"226 114 91",text:"93 64 55"}},{id:"alabaster",name:"Alabaster",isDark:!1,metaColor:"#fcfcfc",palette:{background:"252 252 252",surface:"255 255 255",primary:"96 165 250",text:"50 50 50"}},{id:"dark",name:"Dark",isDark:!0,metaColor:"#111827",palette:{background:"17 24 39",surface:"31 41 55",primary:"37 99 235",text:"243 244 246"}},{id:"espresso",name:"Espresso",isDark:!0,metaColor:"#211713",palette:{background:"33 23 19",surface:"58 45 39",primary:"196 154 108",text:"224 213 208"}},{id:"midnight",name:"Midnight",isDark:!0,metaColor:"#0c0d11",palette:{background:"12 13 17",surface:"26 27 38",primary:"133 137 230",text:"200 201 215"}}],ox=U.createContext(void 0),bg=r=>{let g=qr.find(o=>o.id===r);g||(g=qr[0]);const l=window.document.documentElement,u=document.querySelector('meta[name="theme-color"]');let f,i;g.id==="system"?(f=window.matchMedia("(prefers-color-scheme: dark)").matches,i=f?g.metaColorDark:g.metaColor):(f=g.isDark,i=g.metaColor),qr.forEach(o=>{o.id!=="system"&&l.classList.remove(`theme-${o.id}`)}),l.classList.remove("theme-dark","theme-light"),g.id!=="system"&&l.classList.add(`theme-${g.id}`),l.classList.toggle("dark",f),u&&i&&u.setAttribute("content",i)},hv=({children:r})=>{const[g,l]=U.useState(()=>{try{const i=localStorage.getItem(wd);return qr.some(o=>o.id===i)?i:"system"}catch(i){return console.error("Could not access localStorage. Defaulting to 'system'.",i),"system"}});U.useEffect(()=>{try{localStorage.setItem(wd,g)}catch(i){console.error("Could not set theme in localStorage.",i)}bg(g)},[g]),U.useEffect(()=>{const i=window.matchMedia("(prefers-color-scheme: dark)"),o=()=>{let m="system";try{m=localStorage.getItem(wd)||"system"}catch{}m==="system"&&bg("system")};return i.addEventListener("change",o),()=>i.removeEventListener("change",o)},[]);const u=U.useCallback(i=>{l(i)},[]),f=qr.find(i=>i.id===g)||qr[0];return n.jsx(ox.Provider,{value:{themeId:g,setThemeById:u,currentTheme:f},children:r})},mv=()=>{const r=U.useContext(ox);if(r===void 0)throw new Error("useTheme must be used within a ThemeProvider");return r},pv=({themeId:r,isSelected:g,onClick:l})=>{const u=qr.find(d=>d.id===r);if(!u)return null;const f=u.id==="system",i=u.isDark,o=u.palette,m=f?u.paletteDark:i?u.palette:null,x=`w-full h-24 rounded-lg border-2 transition-all duration-200 cursor-pointer flex flex-col justify-between p-2 text-left relative ${g?"border-primary ring-2 ring-primary ring-offset-2 ring-offset-background":"border-border hover:border-text-muted"}`;return n.jsxs("div",{children:[n.jsxs("button",{onClick:l,className:x,"aria-pressed":g,"aria-label":`Select ${u.name} theme`,children:[n.jsx("div",{className:"w-full h-full absolute top-0 left-0 overflow-hidden rounded-[5px]",children:f?n.jsxs(n.Fragment,{children:[n.jsx("div",{className:"w-1/2 h-full absolute top-0 left-0",style:{backgroundColor:`rgb(${o.surface})`}}),n.jsx("div",{className:"w-1/2 h-full absolute top-0 right-0",style:{backgroundColor:`rgb(${m.surface})`}})]}):n.jsx("div",{className:"w-full h-full absolute top-0 left-0",style:{backgroundColor:`rgb(${o.surface})`}})}),n.jsxs("div",{className:"relative flex items-center justify-between w-full",children:[n.jsxs("div",{className:"flex items-center gap-1.5 px-2 py-1 rounded-full text-xs backdrop-blur-sm",style:{backgroundColor:`rgba(${o.background}, 0.6)`},children:[n.jsx("div",{className:"w-3 h-3 rounded-full",style:{backgroundColor:`rgb(${o.primary})`}}),n.jsx("span",{style:{color:`rgb(${o.text})`},children:"Aa"})]}),g&&n.jsx("div",{className:"w-6 h-6 rounded-full flex items-center justify-center bg-primary",children:n.jsx(te,{name:"check-circle",className:"w-4 h-4 text-on-primary"})})]}),n.jsxs("div",{className:"relative flex items-center gap-2",children:[f&&n.jsx(n.Fragment,{children:n.jsx(te,{name:"monitor",className:"w-4 h-4",style:{color:`rgb(${o.text})`}})}),!f&&i&&n.jsx(te,{name:"moon",className:"w-4 h-4",style:{color:`rgb(${o.text})`}}),!f&&!i&&n.jsx(te,{name:"sun",className:"w-4 h-4",style:{color:`rgb(${o.text})`}})]})]}),n.jsx("p",{className:`text-center text-sm font-medium mt-2 transition-colors ${g?"text-primary":"text-text"}`,children:u.name})]})},gv=({selectedTheme:r,onThemeChange:g})=>n.jsxs("div",{children:[n.jsx("label",{className:"block text-sm font-medium text-text-muted mb-2",children:"Theme"}),n.jsx("div",{className:"grid grid-cols-3 sm:grid-cols-4 md:grid-cols-5 gap-4",children:qr.map(l=>n.jsx(pv,{themeId:l.id,isSelected:r===l.id,onClick:()=>g(l.id)},l.id))})]}),cx=U.createContext(null),ux=()=>{const r=U.useContext(cx);if(!r)throw new Error("Accordion components must be used within an <Accordion> component.");return r},dx=U.createContext(null),fx=()=>{const r=U.useContext(dx);if(!r)throw new Error("AccordionTrigger/Content must be used within an <AccordionItem> component.");return r},hx=({children:r,type:g="single",defaultValue:l,className:u=""})=>{const[f,i]=U.useState(l||(g==="multiple"?[]:"")),o=m=>{i(g==="multiple"?x=>{const d=Array.isArray(x)?x:[];return d.includes(m)?d.filter(j=>j!==m):[...d,m]}:x=>x===m?"":m)};return U.useEffect(()=>{i(l===void 0?g==="multiple"?[]:"":l)},[l,g]),n.jsx(cx.Provider,{value:{value:f,onValueChange:o,type:g},children:n.jsx("div",{className:u,children:r})})},fa=({children:r,value:g,className:l=""})=>{const{value:u,type:f}=ux(),i=f==="multiple"?Array.isArray(u)&&u.includes(g):u===g;return n.jsx(dx.Provider,{value:{value:g,isOpen:i},children:n.jsx("div",{className:l,children:r})})},ha=({children:r,className:g="",...l})=>{const{onValueChange:u}=ux(),{value:f,isOpen:i}=fx(),o=`accordion-content-${f}`,m=`accordion-header-${f}`;return n.jsx("h3",{id:m,className:"m-0 font-medium",children:n.jsxs("button",{type:"button",onClick:()=>u(f),"aria-expanded":i,"aria-controls":o,className:`w-full flex justify-between items-center text-left p-4 bg-surface hover:bg-border/20 transition-colors ${g}`,...l,children:[r,n.jsx(te,{name:"chevron-down",className:`w-5 h-5 transition-transform duration-300 ${i?"rotate-180":""} text-text-muted`})]})})},ma=({children:r,className:g=""})=>{const{value:l,isOpen:u}=fx(),f=`accordion-content-${l}`,i=`accordion-header-${l}`;return u?n.jsx("div",{id:f,role:"region","aria-labelledby":i,className:`animate-fade-in ${g}`,children:r}):null},xv=({onExport:r,onRestore:g,onResetProgress:l,onFactoryReset:u,onSync:f,onForceFetch:i,onForceUpload:o,onCreateServerBackup:m,onManageServerBackups:x,isSyncing:d,lastSyncStatus:j,isGapiReady:y,isGapiSignedIn:_,gapiUser:b,onGoogleSignIn:D,onGoogleSignOut:w,onBackupToDrive:N,onRestoreFromDrive:S,onClearAppCache:O,onClearCdnCache:C,onRevertLastFetch:M})=>{const R=sa(),{themeId:$,setThemeById:X}=mv(),[J,Y]=U.useState(!1),{addToast:H}=Mt();return U.useEffect(()=>{localStorage.getItem("cogniflow-pre-fetch-backup")&&Y(!0)},[]),n.jsxs("div",{className:"max-w-3xl mx-auto animate-fade-in space-y-8",children:[n.jsx("h1",{className:"text-3xl font-bold text-text border-b border-border pb-4",children:"Settings"}),n.jsxs(hx,{type:"multiple",defaultValue:["appearance","general","cloud-sync","gdrive-backup","data-management","cache-management"],className:"w-full space-y-4",children:[n.jsxs(fa,{value:"data-management",className:"border border-border rounded-lg overflow-hidden",children:[n.jsx(ha,{children:n.jsx("h2",{className:"text-2xl font-semibold text-text",children:"Data Management"})}),n.jsxs(ma,{className:"bg-surface p-6 flex flex-wrap gap-4 justify-center",children:[n.jsxs(ce,{variant:"secondary",onClick:r,children:[n.jsx(te,{name:"download",className:"mr-2"})," Export All Data"]}),n.jsxs(ce,{variant:"secondary",onClick:g,children:[n.jsx(te,{name:"upload-cloud",className:"mr-2"})," Restore from File"]}),n.jsxs(ce,{variant:"secondary",onClick:l,children:[n.jsx(te,{name:"refresh-ccw",className:"mr-2"})," Reset Progress"]}),J&&n.jsxs(ce,{variant:"secondary",onClick:M,children:[n.jsx(te,{name:"refresh-ccw",className:"mr-2"})," Revert Last Fetch"]})]})]}),n.jsxs(fa,{value:"cloud-sync",className:"border border-border rounded-lg overflow-hidden",children:[n.jsx(ha,{children:n.jsx("h2",{className:"text-2xl font-semibold text-text",children:"Cloud Sync"})}),n.jsxs(ma,{className:"bg-surface p-6 space-y-6",children:[n.jsx(ri,{label:"Enable Cloud Sync",description:"Automatically sync your data to the server.",checked:R.backupEnabled,onChange:R.setBackupEnabled}),n.jsx(ri,{label:"Sync on Cellular Data",description:"Allow auto-sync when on a mobile network.",checked:R.syncOnCellular,onChange:R.setSyncOnCellular,disabled:!R.backupEnabled}),n.jsxs("div",{children:[n.jsx("label",{htmlFor:"backup-api-key",className:"block text-sm font-medium text-text-muted mb-1",children:"Server Backup API Key"}),n.jsx("input",{id:"backup-api-key",type:"password",value:R.backupApiKey,onChange:K=>R.setBackupApiKey(K.target.value),className:"w-full p-2 bg-background border border-border rounded-md focus:ring-2 focus:ring-primary focus:outline-none",disabled:!R.backupEnabled})]}),n.jsxs("div",{className:"pt-4 border-t border-border flex flex-col sm:flex-row gap-2 items-center justify-between",children:[n.jsx("p",{className:"text-sm text-text-muted",children:d?"Syncing...":j}),n.jsx("div",{className:"flex gap-2 flex-wrap justify-end",children:n.jsxs(ce,{variant:"primary",onClick:f,disabled:!R.backupEnabled||d,children:[n.jsx(te,{name:"refresh-ccw",className:"w-4 h-4 mr-2"})," Sync Now"]})})]}),n.jsxs("div",{className:"pt-4 border-t border-border",children:[n.jsx("h3",{className:"text-lg font-semibold text-text-muted",children:"Advanced Sync Options"}),n.jsx("p",{className:"text-sm text-text-muted mt-1 mb-4",children:"Use these options to resolve sync conflicts manually. These are destructive actions and should be used with caution."}),n.jsxs("div",{className:"flex flex-wrap gap-4 justify-start",children:[n.jsxs(ce,{variant:"secondary",onClick:o,disabled:!R.backupEnabled||d,children:[n.jsx(te,{name:"upload-cloud",className:"w-4 h-4 mr-2"})," Force Upload to Server"]}),n.jsxs(ce,{variant:"secondary",onClick:i,disabled:!R.backupEnabled||d,children:[n.jsx(te,{name:"download",className:"w-4 h-4 mr-2"})," Force Fetch from Server"]})]})]}),n.jsxs("div",{className:"pt-4 border-t border-border flex flex-wrap gap-2 justify-center",children:[n.jsxs(ce,{variant:"secondary",onClick:m,disabled:!R.backupEnabled||d,children:[n.jsx(te,{name:"plus",className:"w-4 h-4 mr-2"})," Create Manual Backup"]}),n.jsxs(ce,{variant:"secondary",onClick:x,disabled:!R.backupEnabled||d,children:[n.jsx(te,{name:"settings",className:"w-4 h-4 mr-2"})," Manage Backups"]})]})]})]}),n.jsxs(fa,{value:"appearance",className:"border border-border rounded-lg overflow-hidden",children:[n.jsx(ha,{children:n.jsx("h2",{className:"text-2xl font-semibold text-text",children:"Appearance"})}),n.jsxs(ma,{className:"bg-surface p-6 space-y-6",children:[n.jsx(gv,{selectedTheme:$,onThemeChange:X}),n.jsx(ri,{label:"Disable Animations",description:"Reduces motion for a faster experience.",checked:R.disableAnimations,onChange:R.setDisableAnimations})]})]}),n.jsxs(fa,{value:"general",className:"border border-border rounded-lg overflow-hidden",children:[n.jsx(ha,{children:n.jsx("h2",{className:"text-2xl font-semibold text-text",children:"General"})}),n.jsxs(ma,{className:"bg-surface p-6 space-y-6",children:[n.jsx(ri,{label:"Enable Haptic Feedback",description:"Provides physical feedback on supported devices.",checked:R.hapticsEnabled,onChange:R.setHapticsEnabled}),n.jsx(ri,{label:"Enable AI Features",description:"Allows content generation using the Gemini API.",checked:R.aiFeaturesEnabled,onChange:R.setAiFeaturesEnabled})]})]}),n.jsxs(fa,{value:"gdrive-backup",className:"border border-border rounded-lg overflow-hidden",children:[n.jsx(ha,{children:n.jsx("h2",{className:"text-2xl font-semibold text-text",children:"Google Drive Backup"})}),n.jsx(ma,{className:"bg-surface p-6 space-y-6",children:y?_?n.jsxs("div",{className:"space-y-4",children:[n.jsxs("div",{className:"flex items-center gap-4 p-3 bg-background rounded-md",children:[n.jsx("img",{src:b==null?void 0:b.picture,alt:"User profile",className:"w-12 h-12 rounded-full"}),n.jsxs("div",{children:[n.jsx("p",{className:"font-semibold text-text",children:b==null?void 0:b.name}),n.jsx("p",{className:"text-sm text-text-muted",children:b==null?void 0:b.email})]})]}),n.jsxs("div",{className:"flex flex-wrap gap-4 justify-center",children:[n.jsxs(ce,{variant:"secondary",onClick:N,children:[n.jsx(te,{name:"upload-cloud",className:"mr-2"})," Backup to Drive"]}),n.jsxs(ce,{variant:"secondary",onClick:S,children:[n.jsx(te,{name:"download",className:"mr-2"})," Restore from Drive"]}),n.jsx(ce,{variant:"danger",onClick:w,children:"Sign Out"})]})]}):n.jsxs("div",{className:"text-center",children:[n.jsx("p",{className:"text-text-muted mb-4",children:"Sign in with your Google account to back up and restore your data to a private folder in your Google Drive."}),n.jsxs(ce,{variant:"primary",onClick:D,className:"inline-flex items-center gap-2",children:[n.jsx(te,{name:"google",className:"w-5 h-5"}),"Sign in with Google"]})]}):n.jsx("p",{className:"text-text-muted text-center",children:"Loading Google Drive services..."})})]}),n.jsxs(fa,{value:"cache-management",className:"border border-border rounded-lg overflow-hidden",children:[n.jsx(ha,{children:n.jsx("h2",{className:"text-2xl font-semibold text-text",children:"Cache Management"})}),n.jsxs(ma,{className:"bg-surface p-6 space-y-4",children:[n.jsx("p",{className:"text-sm text-text-muted text-center w-full",children:"Clearing the cache can resolve issues by forcing the app to download the latest files. This does not affect your saved data."}),n.jsxs("div",{className:"flex flex-wrap gap-4 justify-center",children:[n.jsxs(ce,{variant:"secondary",onClick:O,children:[n.jsx(te,{name:"refresh-ccw",className:"mr-2"})," Clear App Cache"]}),n.jsxs(ce,{variant:"secondary",onClick:C,children:[n.jsx(te,{name:"download",className:"mr-2"})," Clear CDN Cache"]})]})]})]}),n.jsxs(fa,{value:"developer-tools",className:"border border-border rounded-lg overflow-hidden",children:[n.jsx(ha,{children:n.jsx("h2",{className:"text-2xl font-semibold text-text",children:"Developer Tools"})}),n.jsx(ma,{className:"bg-surface p-6 flex flex-wrap gap-4 justify-center",children:n.jsxs(ce,{variant:"secondary",onClick:()=>{typeof window.runBackupServiceTests=="function"?(H("Running backup service tests... Check the console for results.","info"),window.runBackupServiceTests()):H("Test runner function not found.","error")},children:[n.jsx(te,{name:"terminal",className:"mr-2"})," Run API Tests"]})})]})]}),n.jsxs("div",{className:"bg-red-900/20 border border-red-500/30 rounded-lg p-6",children:[n.jsx("h2",{className:"text-xl font-semibold text-red-400 dark:text-red-300",children:"Danger Zone"}),n.jsx("p",{className:"text-red-500/80 dark:text-red-300/80 mb-4",children:"This will permanently delete all your decks, folders, and progress. This action cannot be undone."}),n.jsxs(ce,{variant:"danger",onClick:u,children:[n.jsx(te,{name:"broom",className:"mr-2"})," Factory Reset"]})]})]})},yv=({card:r,onClose:g,onSave:l})=>{const[u,f]=U.useState(""),[i,o]=U.useState(""),[m,x]=U.useState(""),{addToast:d}=Mt(),j=U.useRef(null);Yt(j,!0),U.useEffect(()=>{r&&(f(r.front),o(r.back),x(r.css||""))},[r]);const y=b=>{if(b.preventDefault(),!u.trim()||!i.trim()){d("Both front and back fields are required.","error");return}l({id:(r==null?void 0:r.id)||"",front:u.trim(),back:i.trim(),css:m.trim()})},_=b=>{if(b.key==="Tab"){b.preventDefault();const D=b.target,w=D.selectionStart,N=D.selectionEnd;D.value=D.value.substring(0,w)+"	"+D.value.substring(N),D.selectionStart=D.selectionEnd=w+1}};return n.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-75 flex items-center justify-center z-[60] p-4",children:n.jsx("div",{ref:j,className:"bg-surface rounded-lg shadow-xl w-full max-w-2xl transform transition-all relative",children:n.jsxs("form",{onSubmit:y,children:[n.jsxs("div",{className:"flex justify-between items-center p-4 border-b border-border",children:[n.jsx("h2",{className:"text-xl font-bold",children:r?"Edit Card":"Add New Card"}),n.jsx(ce,{type:"button",variant:"ghost",onClick:g,className:"p-1 h-auto",children:n.jsx(te,{name:"x"})})]}),n.jsxs("div",{className:"p-6 space-y-4",children:[n.jsxs("div",{children:[n.jsx("label",{htmlFor:"card-front",className:"block text-sm font-medium text-text-muted mb-1",children:"Front"}),n.jsx("textarea",{id:"card-front",value:u,onChange:b=>f(b.target.value),onKeyDown:_,rows:5,className:"w-full p-2 bg-background border border-border rounded-md focus:ring-2 focus:ring-primary focus:outline-none",placeholder:"Enter front content (question, term, etc.)"})]}),n.jsxs("div",{children:[n.jsx("label",{htmlFor:"card-back",className:"block text-sm font-medium text-text-muted mb-1",children:"Back"}),n.jsx("textarea",{id:"card-back",value:i,onChange:b=>o(b.target.value),onKeyDown:_,rows:5,className:"w-full p-2 bg-background border border-border rounded-md focus:ring-2 focus:ring-primary focus:outline-none",placeholder:"Enter back content (answer, definition, etc.)"})]}),n.jsxs("details",{className:"space-y-2",children:[n.jsx("summary",{className:"cursor-pointer text-sm font-medium text-primary hover:underline",children:"Advanced CSS Styling"}),n.jsxs("div",{className:"pt-2",children:[n.jsx("label",{htmlFor:"card-css",className:"block text-sm font-medium text-text-muted mb-1",children:"Custom CSS"}),n.jsx("textarea",{id:"card-css",value:m,onChange:b=>x(b.target.value),onKeyDown:_,rows:5,className:"w-full p-2 bg-background border border-border rounded-md focus:ring-2 focus:ring-primary focus:outline-none font-mono text-xs",placeholder:".card { color: blue; }"}),n.jsx("p",{className:"text-xs text-text-muted mt-1",children:"CSS is applied directly to the card. Useful for Anki imports."})]})]})]}),n.jsxs("div",{className:"flex justify-end p-4 bg-background/50 border-t border-border",children:[n.jsx(ce,{type:"button",variant:"secondary",onClick:g,className:"mr-2",children:"Cancel"}),n.jsx(ce,{type:"submit",variant:"primary",children:r?"Save Changes":"Add Card"})]})]})})})},Ud=({isOpen:r,onClose:g,onConfirm:l,title:u,message:f,confirmText:i})=>{const[o,m]=U.useState(!1),x=U.useRef(null);Yt(x,r),U.useEffect(()=>{r&&m(!1)},[r]);const d=async()=>{m(!0);try{await Promise.resolve(l()),x.current&&g()}catch(j){console.error("Confirmation action failed:",j)}finally{x.current&&m(!1)}};return r?n.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-75 flex items-center justify-center z-[60] p-4",children:n.jsxs("div",{ref:x,className:"bg-surface rounded-lg shadow-xl w-full max-w-md transform transition-all relative",role:"alertdialog","aria-modal":"true","aria-labelledby":"confirm-title","aria-describedby":"confirm-message",children:[n.jsxs("div",{className:"flex justify-between items-center p-4 border-b border-border",children:[n.jsx("h2",{id:"confirm-title",className:"text-xl font-bold text-text",children:u}),n.jsx(ce,{type:"button",variant:"ghost",onClick:g,className:"p-1 h-auto","aria-label":"Close",disabled:o,children:n.jsx(te,{name:"x"})})]}),n.jsx("div",{className:"p-6 space-y-4",children:n.jsx("p",{id:"confirm-message",className:"text-text-muted",children:f})}),n.jsxs("div",{className:"flex justify-end p-4 bg-background/50 border-t border-border",children:[n.jsx(ce,{type:"button",variant:"secondary",onClick:g,className:"mr-2",disabled:o,children:"Cancel"}),n.jsx(ce,{type:"button",variant:"danger",onClick:d,disabled:o,children:o?n.jsx(tn,{size:"sm"}):i||"Confirm"})]})]})}):null},bv=r=>{const g=new Date;g.setHours(0,0,0,0);const l=new Date(r);l.setHours(0,0,0,0);const u=l.getTime()-g.getTime(),f=Math.round(u/(1e3*60*60*24)),i=f<=0;let o;return f<0?o="Due":f===0?o="Due today":f===1?o="Due tomorrow":o=`Due in ${f} days`,{text:o,isDue:i}},vv=({cards:r,onCardsChange:g,onAddCard:l,onBulkAdd:u})=>{const[f,i]=U.useState(null),[o,m]=U.useState(!1),[x,d]=U.useState(null),[j,y]=U.useState(!0),_=U.useRef(null),b=(C,M)=>{i(C),M&&(_.current=M.currentTarget),m(!0)},D=()=>{var C;m(!1),(C=_.current)==null||C.focus(),i(null)},w=(C,M)=>{d(C),M&&(_.current=M.currentTarget)},N=()=>{x&&g(r.filter(C=>C.id!==x.id)),d(null)},S=C=>{f?g(r.map(M=>M.id===C.id?{...M,...C}:M)):l(C),D()},O=C=>{g(r.map(M=>M.id===C?{...M,suspended:!1}:M))};return n.jsxs("div",{children:[n.jsx("div",{className:"border-b border-border",children:n.jsxs("button",{onClick:()=>y(!j),className:"w-full flex justify-between items-center text-left p-6","aria-expanded":j,"aria-controls":"card-list-content",children:[n.jsx("h3",{className:"text-xl font-semibold text-text",children:"Cards"}),n.jsx(te,{name:"chevron-down",className:`w-6 h-6 transition-transform duration-300 ${j?"":"-rotate-90"} text-text-muted`})]})}),j&&n.jsxs("div",{id:"card-list-content",className:"animate-fade-in",children:[n.jsx("div",{className:"p-6",children:r.length>0?n.jsx("ul",{className:"space-y-4",children:r.map(C=>{const{text:M,isDue:R}=bv(C.dueDate);return n.jsxs("li",{className:`p-4 rounded-lg flex items-start justify-between transition-all ${C.suspended?"bg-yellow-500/10 opacity-70":"bg-background"}`,children:[n.jsxs("div",{className:"flex-1 min-w-0 mr-4",children:[n.jsxs("p",{className:"text-sm font-medium text-text truncate",children:[n.jsx("strong",{children:"Front:"})," ",C.front.replace(/<[^>]+>/g,"")]}),n.jsxs("p",{className:"text-sm text-text-muted truncate",children:[n.jsx("strong",{children:"Back:"})," ",C.back.replace(/<[^>]+>/g,"")]}),n.jsxs("div",{className:"mt-3 space-y-2",children:[n.jsx(gs,{level:Rn(C)}),n.jsx("div",{className:"flex items-center gap-4 text-xs text-text-muted",children:n.jsxs("span",{className:`font-semibold ${R?"text-primary":""}`,children:[n.jsx(te,{name:"zap",className:"w-3 h-3 inline-block mr-1"}),M]})})]})]}),n.jsxs("div",{className:"flex-shrink-0 flex items-center gap-2",children:[C.suspended?n.jsx(ce,{variant:"ghost",className:"p-2 h-auto text-yellow-600 dark:text-yellow-400",onClick:()=>O(C.id),title:"Unsuspend this card",children:n.jsx(te,{name:"eye",className:"w-4 h-4"})}):n.jsx(ce,{variant:"ghost",className:"p-2 h-auto",onClick:$=>b(C,$),title:"Edit this card",children:n.jsx(te,{name:"edit",className:"w-4 h-4"})}),n.jsx(ce,{variant:"ghost",className:"p-2 h-auto text-text-muted hover:text-red-500",onClick:$=>w(C,$),title:"Delete this card",children:n.jsx(te,{name:"trash-2",className:"w-4 h-4"})})]})]},C.id)})}):n.jsxs("div",{className:"text-center text-text-muted py-8",children:[n.jsx(te,{name:"laptop",className:"w-12 h-12 mx-auto mb-2 opacity-50"}),n.jsx("p",{children:"This deck has no cards yet."})]})}),n.jsxs("div",{className:"px-6 py-4 border-t border-border flex flex-wrap gap-2",children:[n.jsxs(ce,{variant:"secondary",onClick:C=>b(null,C),className:"flex-grow sm:flex-grow-0",children:[n.jsx(te,{name:"plus",className:"w-5 h-5 mr-2"}),"Add New Card"]}),n.jsxs(ce,{variant:"ghost",onClick:u,className:"flex-grow sm:flex-grow-0",children:[n.jsx(te,{name:"code",className:"w-5 h-5 mr-2"}),"Bulk Add via JSON"]})]})]}),o&&n.jsx(yv,{card:f,onClose:D,onSave:S}),x&&n.jsx(Ud,{isOpen:!!x,onClose:()=>d(null),onConfirm:N,title:"Delete Card",message:"Are you sure you want to delete this card? This action cannot be undone."})]})},wv=({question:r,onClose:g,onSave:l})=>{const[u,f]=U.useState(""),[i,o]=U.useState(""),[m,x]=U.useState([]),[d,j]=U.useState(""),[y,_]=U.useState([]),[b,D]=U.useState(""),[w,N]=U.useState(new Set),{addToast:S}=Mt(),O=U.useRef(null);Yt(O,!0),U.useEffect(()=>{if(r)f(r.questionText),o(r.detailedExplanation),x((r.options||[]).map(K=>({...K}))),j(r.correctAnswerId),_(r.tags||[]);else{const K=[{id:crypto.randomUUID(),text:""},{id:crypto.randomUUID(),text:""}];x(K),_([])}},[r]);const C=(K,q,W)=>{x(m.map(A=>A.id===K?{...A,[q]:W}:A))},M=K=>{N(q=>{const W=new Set(q);return W.has(K)?W.delete(K):W.add(K),W})},R=()=>{x([...m,{id:crypto.randomUUID(),text:""}])},$=K=>{if(m.length<=2){S("A question must have at least two options.","error");return}x(m.filter(q=>q.id!==K)),d===K&&j("")},X=K=>{D(K.target.value)},J=K=>{if(K.key===","||K.key==="Enter"){K.preventDefault();const q=b.trim();q&&!y.includes(q)&&_([...y,q]),D("")}else K.key==="Backspace"&&!b&&y.length>0&&_(y.slice(0,-1))},Y=K=>{_(y.filter(q=>q!==K))},H=K=>{if(K.preventDefault(),!u.trim()){S("Question text is required.","error");return}if(m.some(q=>!q.text.trim())){S("All options must have text.","error");return}if(!d){S("You must select a correct answer.","error");return}l({id:r==null?void 0:r.id,questionText:u.trim(),detailedExplanation:i.trim(),options:m,correctAnswerId:d,tags:y})};return n.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-75 flex items-center justify-center z-[60] p-4",children:n.jsx("div",{ref:O,className:"bg-surface rounded-lg shadow-xl w-full max-w-3xl transform transition-all relative max-h-[90vh] flex flex-col",children:n.jsxs("form",{onSubmit:H,className:"flex flex-col h-full",children:[n.jsxs("div",{className:"flex-shrink-0 flex justify-between items-center p-4 border-b border-border",children:[n.jsx("h2",{className:"text-xl font-bold",children:r?"Edit Question":"Add New Question"}),n.jsx(ce,{type:"button",variant:"ghost",onClick:g,className:"p-1 h-auto",children:n.jsx(te,{name:"x"})})]}),n.jsxs("div",{className:"p-6 space-y-4 overflow-y-auto",children:[n.jsxs("div",{children:[n.jsx("label",{htmlFor:"question-text",className:"block text-sm font-medium text-text-muted mb-1",children:"Question Text"}),n.jsx("textarea",{id:"question-text",value:u,onChange:K=>f(K.target.value),rows:3,className:"w-full p-2 bg-background border border-border rounded-md focus:ring-2 focus:ring-primary focus:outline-none",placeholder:"What is the capital of France?"})]}),n.jsxs("div",{children:[n.jsx("label",{className:"block text-sm font-medium text-text-muted mb-1",children:"Options"}),n.jsx("div",{className:"space-y-2",children:m.map((K,q)=>n.jsxs("div",{children:[n.jsxs("div",{className:"flex items-center gap-2",children:[n.jsx("input",{type:"radio",name:"correct-answer",checked:d===K.id,onChange:()=>j(K.id),className:"h-5 w-5 text-primary bg-border/50 border-border focus:ring-primary","aria-label":`Set option ${q+1} as correct`}),n.jsx("input",{type:"text",value:K.text,onChange:W=>C(K.id,"text",W.target.value),className:"flex-grow p-2 bg-background border border-border rounded-md focus:ring-2 focus:ring-primary focus:outline-none",placeholder:`Option ${q+1}`}),n.jsx(ce,{type:"button",variant:"ghost",onClick:()=>M(K.id),className:`p-2 h-auto ${w.has(K.id)?"bg-primary/10 text-primary":"text-text-muted"}`,title:"Add/Edit option explanation",children:n.jsx(te,{name:"info",className:"w-4 h-4"})}),n.jsx(ce,{type:"button",variant:"ghost",onClick:()=>$(K.id),className:"p-2 h-auto text-text-muted hover:text-red-500",children:n.jsx(te,{name:"x",className:"w-4 h-4"})})]}),w.has(K.id)&&n.jsx("div",{className:"pl-7 mt-1 animate-fade-in",children:n.jsx("input",{type:"text",value:K.explanation||"",onChange:W=>C(K.id,"explanation",W.target.value),className:"w-full p-1 bg-background border border-border rounded-md focus:ring-2 focus:ring-primary focus:outline-none text-sm",placeholder:"Brief explanation for this option..."})})]},K.id))}),n.jsxs(ce,{type:"button",variant:"ghost",onClick:R,size:"sm",className:"mt-2",children:[n.jsx(te,{name:"plus",className:"w-4 h-4 mr-2"}),"Add Option"]})]}),n.jsxs("div",{children:[n.jsx("label",{htmlFor:"detailed-explanation",className:"block text-sm font-medium text-text-muted mb-1",children:"Detailed Explanation"}),n.jsx("textarea",{id:"detailed-explanation",value:i,onChange:K=>o(K.target.value),rows:4,className:"w-full p-2 bg-background border border-border rounded-md focus:ring-2 focus:ring-primary focus:outline-none",placeholder:"Explain why the correct answer is right and provide more context."})]}),n.jsxs("div",{children:[n.jsx("label",{htmlFor:"tags-input",className:"block text-sm font-medium text-text-muted mb-1",children:"Tags"}),n.jsxs("div",{className:"flex flex-wrap items-center gap-2 p-2 bg-background border border-border rounded-md",children:[y.map((K,q)=>n.jsxs("span",{className:"flex items-center gap-1 bg-primary/10 text-primary text-sm px-2 py-1 rounded-md",children:[K,n.jsx("button",{type:"button",onClick:()=>Y(K),className:"text-primary hover:text-primary-hover",children:n.jsx(te,{name:"x",className:"w-3 h-3"})})]},q)),n.jsx("input",{id:"tags-input",type:"text",value:b,onChange:X,onKeyDown:J,className:"flex-grow bg-transparent focus:outline-none",placeholder:y.length===0?"Add tags (comma or enter)...":""})]})]})]}),n.jsxs("div",{className:"flex-shrink-0 flex justify-end p-4 bg-background/50 border-t border-border",children:[n.jsx(ce,{type:"button",variant:"secondary",onClick:g,className:"mr-2",children:"Cancel"}),n.jsx(ce,{type:"submit",variant:"primary",children:r?"Save Changes":"Add Question"})]})]})})})},Sv=r=>{const g=new Date;g.setHours(0,0,0,0);const l=new Date(r);l.setHours(0,0,0,0);const u=l.getTime()-g.getTime(),f=Math.round(u/(1e3*60*60*24)),i=f<=0;let o;return f<0?o="Due":f===0?o="Due today":f===1?o="Due tomorrow":o=`Due in ${f} days`,{text:o,isDue:i}},Ev=({deck:r,questions:g,onQuestionsChange:l,onAddQuestion:u,onBulkAdd:f,onGenerateAI:i,isGeneratingAI:o,onRegenerateQuestion:m})=>{const[x,d]=U.useState(null),[j,y]=U.useState(!1),[_,b]=U.useState(null),[D,w]=U.useState(!0),[N,S]=U.useState(null),[O,C]=U.useState(null),M=U.useRef(null),R=U.useRef(null),{aiFeaturesEnabled:$}=sa();U.useEffect(()=>{const B=z=>{R.current&&!R.current.contains(z.target)&&S(null)};return N&&document.addEventListener("mousedown",B),()=>{document.removeEventListener("mousedown",B)}},[N]);const X=(B,z)=>{d(B),z&&(M.current=z.currentTarget),y(!0)},J=()=>{var B;y(!1),(B=M.current)==null||B.focus(),d(null)},Y=(B,z)=>{b(B),z&&(M.current=z.currentTarget)},H=()=>{_&&l(g.filter(B=>B.id!==_.id)),b(null)},K=B=>{if(x&&B.id)l(g.map(z=>z.id===B.id?{...z,...B}:z));else{const{id:z,...Q}=B,ue={...Q,questionType:"multipleChoice",suspended:!1};u(ue)}J()},q=B=>{l(g.map(z=>z.id===B?{...z,suspended:!0}:z)),S(null)},W=B=>{l(g.map(z=>z.id===B?{...z,suspended:!1}:z)),S(null)},A=async B=>{S(null),C(B.id);try{await m(r,B)}finally{C(null)}};return n.jsxs("div",{children:[n.jsx("div",{className:"border-b border-border",children:n.jsxs("button",{onClick:()=>w(!D),className:"w-full flex justify-between items-center text-left p-6","aria-expanded":D,"aria-controls":"question-list-content",children:[n.jsx("h3",{className:"text-xl font-semibold text-text",children:"Questions"}),n.jsx(te,{name:"chevron-down",className:`w-6 h-6 transition-transform duration-300 ${D?"":"-rotate-90"} text-text-muted`})]})}),D&&n.jsxs("div",{id:"question-list-content",className:"animate-fade-in",children:[n.jsx("div",{className:"p-6",children:g.length>0?n.jsx("ul",{className:"space-y-4",children:g.map(B=>{const{text:z,isDue:Q}=Sv(B.dueDate),ue=Sn(B.questionText);return n.jsxs("li",{className:`p-4 rounded-lg flex items-start justify-between transition-all ${B.suspended?"bg-yellow-500/10 opacity-70":"bg-background"}`,children:[n.jsxs("div",{className:"flex-1 min-w-0 mr-4",children:[n.jsx("p",{className:"text-base font-medium text-text break-words truncate",title:ue,children:ue}),n.jsxs("div",{className:"mt-3 space-y-2",children:[n.jsx(gs,{level:Rn(B)}),n.jsxs("div",{className:"flex items-center gap-4 text-xs text-text-muted",children:[n.jsxs("span",{className:`font-semibold ${Q?"text-primary":""}`,children:[n.jsx(te,{name:"zap",className:"w-3 h-3 inline-block mr-1"}),z]}),n.jsxs("span",{children:[n.jsx(te,{name:"list",className:"w-3 h-3 inline-block mr-1"}),(B.options||[]).length," options"]})]}),B.tags&&B.tags.length>0&&n.jsx("div",{className:"flex flex-wrap items-center gap-1 mt-2",children:B.tags.map(ee=>n.jsx("span",{className:"bg-border/50 text-text-muted text-xs px-2 py-0.5 rounded-full",children:ee},ee))})]})]}),n.jsxs("div",{className:"flex-shrink-0 relative",ref:N===B.id?R:null,children:[O===B.id?n.jsx("div",{className:"p-2",children:n.jsx(tn,{size:"sm"})}):n.jsx(ce,{variant:"ghost",className:"p-2 h-auto",onClick:ee=>{ee.stopPropagation(),S(V=>V===B.id?null:B.id)},"aria-label":"More options for question",children:n.jsx(te,{name:"more-vertical",className:"w-5 h-5"})}),N===B.id&&n.jsxs("div",{className:"absolute right-0 mt-2 w-48 bg-surface rounded-md shadow-lg py-1 z-10 ring-1 ring-black ring-opacity-5 animate-fade-in",style:{animationDuration:"150ms"},children:[n.jsxs("button",{type:"button",onClick:ee=>{X(B,ee),S(null)},className:"flex items-center w-full px-4 py-2 text-sm text-left text-text hover:bg-border/20",children:[n.jsx(te,{name:"edit",className:"w-4 h-4 mr-3"}),"Edit"]}),n.jsxs("button",{type:"button",onClick:()=>A(B),className:"flex items-center w-full px-4 py-2 text-sm text-left text-text hover:bg-border/20",children:[n.jsx(te,{name:"zap",className:"w-4 h-4 mr-3"}),"Regenerate"]}),B.suspended?n.jsxs("button",{type:"button",onClick:()=>W(B.id),className:"flex items-center w-full px-4 py-2 text-sm text-left text-text hover:bg-border/20",children:[n.jsx(te,{name:"eye",className:"w-4 h-4 mr-3"}),"Unsuspend"]}):n.jsxs("button",{type:"button",onClick:()=>q(B.id),className:"flex items-center w-full px-4 py-2 text-sm text-left text-text hover:bg-border/20",children:[n.jsx(te,{name:"eye-off",className:"w-4 h-4 mr-3"}),"Suspend"]}),n.jsx("div",{className:"border-t border-border my-1"}),n.jsxs("button",{type:"button",onClick:ee=>{Y(B,ee),S(null)},className:"flex items-center w-full px-4 py-2 text-sm text-left text-red-600 dark:text-red-400 hover:bg-red-50 dark:hover:bg-red-900/20",children:[n.jsx(te,{name:"trash-2",className:"w-4 h-4 mr-3"}),"Delete"]})]})]})]},B.id)})}):n.jsxs("div",{className:"text-center text-text-muted py-8",children:[n.jsx(te,{name:"help-circle",className:"w-12 h-12 mx-auto mb-2 opacity-50"}),n.jsx("p",{children:"This deck has no questions yet."})]})}),n.jsxs("div",{className:"px-6 py-4 border-t border-border flex flex-wrap gap-2",children:[n.jsxs(ce,{variant:"secondary",onClick:B=>X(null,B),className:"flex-grow sm:flex-grow-0",children:[n.jsx(te,{name:"plus",className:"w-5 h-5 mr-2"}),"Add New Question"]}),n.jsxs(ce,{variant:"ghost",onClick:f,className:"flex-grow sm:flex-grow-0",children:[n.jsx(te,{name:"code",className:"w-5 h-5 mr-2"}),"Bulk Add via JSON"]}),$&&i&&n.jsxs(ce,{variant:"ghost",onClick:i,className:"flex-grow sm:flex-grow-0",disabled:o,children:[o?n.jsx(tn,{size:"sm"}):n.jsx(te,{name:"zap",className:"w-5 h-5 mr-2"}),o?"Generating...":"Generate with AI"]})]})]}),j&&n.jsx(wv,{question:x,onClose:J,onSave:K}),_&&n.jsx(Ud,{isOpen:!!_,onClose:()=>b(null),onConfirm:H,title:"Delete Question",message:"Are you sure you want to delete this question? This action cannot be undone."})]})},jv=({isOpen:r,onClose:g,onAddItems:l,deckType:u})=>{const[f,i]=U.useState(""),{addToast:o}=Mt(),m=U.useRef(null);Yt(m,r);const x=U.useMemo(()=>u===Ce.Flashcard?`[
  {
    "front": "What is the capital of Japan?",
    "back": "Tokyo"
  },
  {
    "front": "What is 2 + 2?",
    "back": "4"
  }
]`:`[
  {
    "questionText": "Which planet is known as the Red Planet?",
    "options": [
      { "id": "1", "text": "Earth" },
      { "id": "2", "text": "Mars" }
    ],
    "correctAnswerId": "2",
    "detailedExplanation": "Mars is called the Red Planet because of its reddish appearance."
  }
]`,[u]),d=y=>{if(y.preventDefault(),!f.trim()){o("JSON content cannot be empty.","error");return}try{const _=R0(f,u);if(_.length===0){o("The JSON array is empty. No items were added.","info"),g();return}l(_),o(`Successfully added ${_.length} item(s).`,"success"),g()}catch(_){o(_ instanceof Error?_.message:"Invalid JSON format.","error")}},j=y=>{if(y.key==="Tab"){y.preventDefault();const _=y.target,b=_.selectionStart,D=_.selectionEnd;_.value=_.value.substring(0,b)+"  "+_.value.substring(D),_.selectionStart=_.selectionEnd=b+2}};return r?n.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-75 flex items-center justify-center z-[60] p-4",children:n.jsx("div",{ref:m,className:"bg-surface rounded-lg shadow-xl w-full max-w-2xl transform transition-all relative",children:n.jsxs("form",{onSubmit:d,children:[n.jsxs("div",{className:"flex justify-between items-center p-4 border-b border-border",children:[n.jsxs("h2",{className:"text-xl font-bold",children:["Bulk Add ",u===Ce.Flashcard?"Cards":"Questions"]}),n.jsx(ce,{type:"button",variant:"ghost",onClick:g,className:"p-1 h-auto",children:n.jsx(te,{name:"x"})})]}),n.jsxs("div",{className:"p-6",children:[n.jsx("label",{htmlFor:"json-content-bulk",className:"block text-sm font-medium text-text-muted mb-1",children:"Paste an array of items in JSON format."}),n.jsx("textarea",{id:"json-content-bulk",value:f,onChange:y=>i(y.target.value),onKeyDown:j,rows:15,className:"w-full p-2 bg-background border border-border rounded-md focus:ring-2 focus:ring-primary focus:outline-none font-mono text-sm",placeholder:x}),n.jsxs(Gt,{href:"/instructions/json",onClick:g,className:"text-sm text-primary hover:underline mt-2 inline-flex items-center gap-1",children:[n.jsx(te,{name:"help-circle",className:"w-4 h-4"}),"View JSON format guide"]})]}),n.jsxs("div",{className:"flex justify-end p-4 bg-background/50 border-t border-border",children:[n.jsx(ce,{type:"button",variant:"secondary",onClick:g,className:"mr-2",children:"Cancel"}),n.jsx(ce,{type:"submit",variant:"primary",children:"Add Items"})]})]})})}):null},Nv=({data:r,total:g})=>g===0?n.jsx("div",{className:"w-full bg-gray-200 dark:bg-gray-700 rounded-full h-4"}):n.jsx("div",{className:"flex w-full h-4 bg-gray-200 dark:bg-gray-700 rounded-full overflow-hidden",role:"progressbar","aria-valuenow":r.reduce((l,u)=>l+u.value,0),"aria-valuemin":0,"aria-valuemax":g,children:r.map((l,u)=>{if(l.value===0)return null;const f=l.value/g*100;return n.jsx("div",{className:`${l.color} transition-all duration-500`,style:{width:`${f}%`},title:`${l.label}: ${l.value} item(s)`},u)})}),_v=({data:r})=>{const g=Math.max(...r.map(d=>d.count),1),l=350,u=120,f={top:25,right:15,bottom:25,left:15},i=l-f.left-f.right,o=u-f.top-f.bottom,m=i/r.length,x=Math.max(6,m*.1);return n.jsxs("div",{className:"w-full",children:[n.jsx("h4",{className:"text-sm font-semibold text-gray-700 dark:text-gray-300 mb-2",children:"Upcoming Due Dates (Next 7 Days)"}),n.jsx("div",{className:"bg-gray-50 dark:bg-gray-900/50 p-2 rounded-lg border border-gray-200 dark:border-gray-700/50",children:n.jsxs("svg",{viewBox:`0 0 ${l} ${u}`,width:"100%",height:"auto","aria-labelledby":"due-date-graph-title",role:"img",className:"overflow-visible",children:[n.jsx("title",{id:"due-date-graph-title",children:"A bar chart showing the number of items due over the next 7 days."}),r.map((d,j)=>{const y=d.count>0?d.count/g*o:0,_=f.left+j*m+(m-x)/2,b=f.top+o-y;return n.jsxs("g",{className:"group",style:{cursor:"pointer"},children:[n.jsxs("title",{children:[d.date,": ",d.count," item",d.count!==1?"s":""," due"]}),n.jsx("rect",{x:_,y:b,width:x,height:y,rx:"2",className:"fill-blue-500 transition-colors group-hover:fill-blue-400"}),n.jsx("text",{x:_+x/2,y:b-6,textAnchor:"middle",className:"fill-gray-600 dark:fill-gray-300 font-semibold text-sm transition-opacity opacity-0 group-hover:opacity-100 pointer-events-none",children:d.count}),n.jsx("text",{x:_+x/2,y:u-f.bottom+15,textAnchor:"middle",className:"fill-gray-400 dark:fill-gray-500 text-xs pointer-events-none",children:d.dayLabel})]},j)})]})})]})},kv=({reviews:r})=>{const[g,l]=U.useState(null),u=U.useMemo(()=>{if(!r||r.length===0)return[];const w=new Map;r.forEach(S=>{const O=new Date(S.timestamp).toISOString().split("T")[0],C=w.get(O)||{totalMastery:0,count:0};C.totalMastery+=S.masteryLevel,C.count++,w.set(O,C)});const N=Array.from(w.entries()).map(([S,{totalMastery:O,count:C}])=>({date:new Date(S),avgMastery:O/C}));return N.sort((S,O)=>S.date.getTime()-O.date.getTime()),N.slice(-90)},[r]);if(u.length<2)return n.jsx("div",{className:"text-center text-sm text-text-muted py-8",children:"Not enough review history to plot a graph."});const f=350,i=150,o={top:10,right:10,bottom:20,left:30},m=f-o.left-o.right,x=i-o.top-o.bottom,d=u[0].date.getTime(),j=u[u.length-1].date.getTime(),y=w=>(w.getTime()-d)/(j-d)*m+o.left,_=w=>i-o.bottom-w*x,b=u.map(w=>`${y(w.date)},${_(w.avgMastery)}`).join(" L "),D=w=>{const N=w.currentTarget.getBoundingClientRect(),S=w.clientX-N.left;let O=u[0],C=1/0;u.forEach(M=>{const R=y(M.date),$=Math.abs(S-R);$<C&&(C=$,O=M)}),C<20?l({x:y(O.date),y:_(O.avgMastery),data:O}):l(null)};return n.jsx("div",{className:"w-full",children:n.jsxs("svg",{viewBox:`0 0 ${f} ${i}`,width:"100%",height:"auto","aria-labelledby":"mastery-graph-title",role:"img",className:"overflow-visible",onMouseMove:D,onMouseLeave:()=>l(null),children:[n.jsx("title",{id:"mastery-graph-title",children:"A line chart showing average mastery over time."}),[0,.25,.5,.75,1].map(w=>n.jsxs("g",{children:[n.jsx("line",{x1:o.left,y1:_(w),x2:f-o.right,y2:_(w),className:"stroke-current text-border/70",strokeWidth:"0.5"}),n.jsx("text",{x:o.left-8,y:_(w)+4,textAnchor:"end",className:"text-xs fill-text-muted",children:`${w*100}%`})]},w)),n.jsx("text",{x:o.left,y:i-5,textAnchor:"start",className:"text-xs fill-text-muted",children:u[0].date.toLocaleDateString("en-us",{month:"short",day:"numeric"})}),n.jsx("text",{x:f-o.right,y:i-5,textAnchor:"end",className:"text-xs fill-text-muted",children:u[u.length-1].date.toLocaleDateString("en-us",{month:"short",day:"numeric"})}),n.jsx("path",{d:`M ${b}`,className:"stroke-primary",fill:"none",strokeWidth:"2",strokeLinejoin:"round",strokeLinecap:"round"}),g&&n.jsxs("g",{children:[n.jsx("line",{x1:g.x,y1:o.top,x2:g.x,y2:i-o.bottom,className:"stroke-current text-border",strokeDasharray:"2,2"}),n.jsx("circle",{cx:g.x,cy:g.y,r:"4",className:"fill-primary"}),n.jsxs("g",{transform:`translate(${g.x>f/2?g.x-100:g.x+10}, ${o.top})`,children:[n.jsx("rect",{x:"0",y:"0",width:"90",height:"35",rx:"4",className:"fill-surface opacity-90",stroke:"rgb(var(--color-border))"}),n.jsx("text",{x:"5",y:"15",className:"text-xs fill-text font-semibold",children:g.data.date.toLocaleDateString("en-us",{month:"short",day:"numeric"})}),n.jsxs("text",{x:"5",y:"30",className:"text-xs fill-text-muted",children:["Mastery: ",Math.round(g.data.avgMastery*100),"%"]})]})]})]})})},Av=({block:r,onClose:g,onSave:l})=>{const[u,f]=U.useState(""),[i,o]=U.useState([]),{addToast:m}=Mt(),x=U.useRef(null);Yt(x,!0),U.useEffect(()=>{r?(f(r.infoCard.content),o(r.questions.map(N=>({...N})))):o([{id:crypto.randomUUID(),questionText:"",options:[{id:crypto.randomUUID(),text:""},{id:crypto.randomUUID(),text:""}],correctAnswerId:"",detailedExplanation:""}])},[r]);const d=(N,S,O)=>{const C=[...i];C[N][S]=O,o(C)},j=(N,S,O)=>{const C=[...i];C[N].options&&(C[N].options[S].text=O,o(C))},y=()=>{o([...i,{id:crypto.randomUUID(),questionText:"",options:[{id:crypto.randomUUID(),text:""},{id:crypto.randomUUID(),text:""}],correctAnswerId:"",detailedExplanation:""}])},_=N=>{if(i.length<=1){m("A learning block must have at least one question.","error");return}o(i.filter((S,O)=>O!==N))},b=N=>{var O;const S=[...i];(O=S[N].options)==null||O.push({id:crypto.randomUUID(),text:""}),o(S)},D=(N,S)=>{const O=[...i],C=O[N];if(C.options&&C.options.length>2){const M=C.options.splice(S,1)[0];C.correctAnswerId===M.id&&(C.correctAnswerId=""),o(O)}else m("A question must have at least two options.","error")},w=N=>{var M,R;if(N.preventDefault(),!u.trim()){m("Informational content cannot be empty.","error");return}for(const $ of i){if(!((M=$.questionText)!=null&&M.trim())){m("Question text is required.","error");return}if((R=$.options)!=null&&R.some(X=>!X.text.trim())){m("All options must have text.","error");return}if(!$.correctAnswerId){m("You must select a correct answer for each question.","error");return}}const S=new Date().toISOString(),O={id:(r==null?void 0:r.infoCard.id)||crypto.randomUUID(),content:u,unlocksQuestionIds:i.map($=>$.id)},C=i.map(($,X)=>{const J=r==null?void 0:r.questions[X];return{...J,...$,id:$.id,questionType:"multipleChoice",infoCardIds:[O.id],dueDate:(J==null?void 0:J.dueDate)||S,interval:(J==null?void 0:J.interval)||0,easeFactor:(J==null?void 0:J.easeFactor)||Gr,tags:$.tags||[]}});l({infoCard:O,questions:C})};return n.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-75 flex items-center justify-center z-[60] p-4",children:n.jsx("div",{ref:x,className:"bg-surface rounded-lg shadow-xl w-full max-w-4xl transform transition-all relative max-h-[90vh] flex flex-col",children:n.jsxs("form",{onSubmit:w,className:"flex flex-col h-full",children:[n.jsxs("header",{className:"flex-shrink-0 flex justify-between items-center p-4 border-b border-border",children:[n.jsx("h2",{className:"text-xl font-bold",children:r?"Edit Learning Block":"Add New Learning Block"}),n.jsx(ce,{type:"button",variant:"ghost",onClick:g,className:"p-1 h-auto",children:n.jsx(te,{name:"x"})})]}),n.jsxs("main",{className:"p-6 space-y-6 overflow-y-auto",children:[n.jsxs("div",{children:[n.jsx("label",{htmlFor:"info-content",className:"block text-sm font-bold text-text mb-1",children:"Informational Content (Supports HTML)"}),n.jsx("textarea",{id:"info-content",value:u,onChange:N=>f(N.target.value),rows:8,className:"w-full p-2 bg-background border border-border rounded-md focus:ring-2 focus:ring-primary focus:outline-none",placeholder:"Explain a concept here..."})]}),n.jsxs("div",{className:"border-t border-border pt-4",children:[n.jsx("h3",{className:"text-lg font-bold text-text mb-2",children:"Questions"}),n.jsxs("div",{className:"space-y-6",children:[i.map((N,S)=>{var O;return n.jsxs("div",{className:"p-4 bg-background rounded-lg border border-border space-y-3 relative",children:[n.jsxs("label",{className:"block text-sm font-medium text-text-muted",children:["Question ",S+1]}),n.jsx("textarea",{value:N.questionText,onChange:C=>d(S,"questionText",C.target.value),rows:2,className:"w-full p-2 bg-surface border border-border rounded-md focus:ring-2 focus:ring-primary focus:outline-none",placeholder:"Question related to the info above"}),n.jsx("div",{className:"space-y-2",children:(O=N.options)==null?void 0:O.map((C,M)=>n.jsxs("div",{className:"flex items-center gap-2",children:[n.jsx("input",{type:"radio",name:`correct-answer-${S}`,checked:N.correctAnswerId===C.id,onChange:()=>d(S,"correctAnswerId",C.id),className:"h-5 w-5 text-primary bg-border/50 border-border focus:ring-primary"}),n.jsx("input",{type:"text",value:C.text,onChange:R=>j(S,M,R.target.value),className:"flex-grow p-2 bg-surface border border-border rounded-md focus:ring-2 focus:ring-primary focus:outline-none",placeholder:`Option ${M+1}`}),n.jsx(ce,{type:"button",variant:"ghost",onClick:()=>D(S,M),className:"p-2 h-auto text-text-muted hover:text-red-500",children:n.jsx(te,{name:"x",className:"w-4 h-4"})})]},C.id||M))}),n.jsxs(ce,{type:"button",variant:"ghost",onClick:()=>b(S),size:"sm",children:[n.jsx(te,{name:"plus",className:"w-4 h-4 mr-1"}),"Add Option"]}),n.jsx("textarea",{value:N.detailedExplanation,onChange:C=>d(S,"detailedExplanation",C.target.value),rows:2,className:"w-full p-2 bg-surface border border-border rounded-md focus:ring-2 focus:ring-primary focus:outline-none",placeholder:"Detailed explanation for the answer"}),n.jsx(ce,{type:"button",variant:"ghost",onClick:()=>_(S),className:"absolute top-2 right-2 p-2 h-auto text-text-muted hover:text-red-500",children:n.jsx(te,{name:"trash-2",className:"w-4 h-4"})})]},N.id||S)}),n.jsxs(ce,{type:"button",variant:"secondary",onClick:y,children:[n.jsx(te,{name:"plus",className:"w-4 h-4 mr-2"}),"Add Question"]})]})]})]}),n.jsxs("footer",{className:"flex-shrink-0 flex justify-end p-4 bg-background/50 border-t border-border",children:[n.jsx(ce,{type:"button",variant:"secondary",onClick:g,className:"mr-2",children:"Cancel"}),n.jsx(ce,{type:"submit",variant:"primary",children:r?"Save Changes":"Add Block"})]})]})})})},Tv=({deck:r,onSaveBlock:g,onDeleteBlock:l,onBlockClick:u})=>{const[f,i]=U.useState(null),[o,m]=U.useState(!1),x=U.useRef(null),d=(b,D)=>{i(b),D&&(x.current=D.currentTarget),m(!0)},j=()=>{var b;m(!1),(b=x.current)==null||b.focus(),i(null)},y=b=>{g(b),j()},_=U.useMemo(()=>(r.infoCards||[]).map(b=>({infoCard:b,questions:(r.questions||[]).filter(D=>{var w;return(w=D.infoCardIds)==null?void 0:w.includes(b.id)})})),[r.infoCards,r.questions]);return n.jsxs("div",{children:[n.jsxs("div",{className:"border-b border-border p-6",children:[n.jsx("h3",{className:"text-xl font-semibold text-text",children:"Learning Blocks"}),n.jsx("p",{className:"text-sm text-text-muted mt-1",children:"Each block contains an info card and its related questions."})]}),n.jsx("div",{className:"p-6",children:_.length>0?n.jsx("ul",{className:"space-y-4",children:_.map(b=>n.jsx("li",{className:"p-4 rounded-lg bg-background border border-border transition-all duration-200 hover:border-primary hover:shadow-md cursor-pointer",onClick:()=>u(b),onKeyDown:D=>{(D.key==="Enter"||D.key===" ")&&u(b)},tabIndex:0,role:"button",children:n.jsxs("div",{className:"flex items-start justify-between",children:[n.jsxs("div",{className:"flex-1 min-w-0 mr-4",children:[n.jsxs("div",{className:"flex items-center gap-2 text-text font-semibold",children:[n.jsx(te,{name:"book-open",className:"w-5 h-5 text-purple-500 flex-shrink-0"}),n.jsx("p",{className:"truncate",title:Sn(b.infoCard.content),children:Sn(b.infoCard.content)})]}),b.questions.length>0&&n.jsx("ul",{className:"mt-2 pl-7 space-y-1",children:b.questions.map(D=>n.jsxs("li",{className:"flex items-center gap-2 text-sm text-text-muted",children:[n.jsx(te,{name:"help-circle",className:"w-4 h-4 flex-shrink-0"}),n.jsx("span",{className:"truncate",title:Sn(D.questionText),children:Sn(D.questionText)})]},D.id))})]}),n.jsxs("div",{className:"flex-shrink-0 flex items-center gap-1",children:[n.jsx(ce,{variant:"ghost",className:"p-2 h-auto",onClick:D=>{D.stopPropagation(),d(b,D)},title:"Edit this block",children:n.jsx(te,{name:"edit",className:"w-4 h-4"})}),n.jsx(ce,{variant:"ghost",className:"p-2 h-auto text-text-muted hover:text-red-500",onClick:D=>{D.stopPropagation(),l(b.infoCard.id)},title:"Delete this block",children:n.jsx(te,{name:"trash-2",className:"w-4 h-4"})})]})]})},b.infoCard.id))}):n.jsxs("div",{className:"text-center text-text-muted py-8",children:[n.jsx(te,{name:"layers",className:"w-12 h-12 mx-auto mb-2 opacity-50"}),n.jsx("p",{children:"This deck has no learning blocks yet."})]})}),n.jsx("div",{className:"px-6 py-4 border-t border-border flex flex-wrap gap-2",children:n.jsxs(ce,{variant:"secondary",onClick:b=>d(null,b),className:"flex-grow sm:flex-grow-0",children:[n.jsx(te,{name:"plus",className:"w-5 h-5 mr-2"}),"Add Learning Block"]})}),o&&n.jsx(Av,{block:f,onClose:j,onSave:y})]})},Cv=({isOpen:r,onClose:g,block:l,deckName:u,onExpandText:f})=>{const i=U.useRef(null),o=U.useRef(null),[m,x]=U.useState(null),[d,j]=U.useState(null);Yt(i,r);const y=()=>{x(null),j(null),g()},_=()=>{var S;if(d)return;const N=window.getSelection();if(N&&N.toString().trim().length>10){const O=N.toString().trim(),M=N.getRangeAt(0).getBoundingClientRect(),R=(S=i.current)==null?void 0:S.getBoundingClientRect();R&&x({visible:!0,top:M.top-R.top+M.height,left:M.left-R.left+M.width/2,text:O})}else x(null)},b=async()=>{if(!(m!=null&&m.text)||!l)return;const{text:N}=m;x(null),j({isLoading:!0,content:null});const S=await f(u,l.infoCard.content,N);j({isLoading:!1,content:S})},D=()=>n.jsxs(n.Fragment,{children:[n.jsxs("div",{onMouseUp:_,ref:o,children:[n.jsx("h3",{className:"text-sm font-semibold uppercase tracking-wider text-text-muted mb-2",children:"Informational Content"}),n.jsx("div",{className:"p-4 bg-background rounded-lg border border-border",children:n.jsx(ir,{html:l.infoCard.content,className:"prose dark:prose-invert max-w-none"})})]}),n.jsxs("div",{children:[n.jsxs("h3",{className:"text-sm font-semibold uppercase tracking-wider text-text-muted mb-2",children:["Associated Questions (",(l.questions||[]).length,")"]}),n.jsx("ul",{className:"space-y-3",children:(l.questions||[]).map(N=>n.jsxs("li",{className:"p-3 bg-background rounded-lg border border-border",children:[n.jsx("p",{className:"font-semibold text-text",dangerouslySetInnerHTML:{__html:N.questionText}}),n.jsx("ul",{className:"mt-2 pl-4 text-sm space-y-1",children:(N.options||[]).map(S=>n.jsxs("li",{className:`flex items-start gap-2 ${S.id===N.correctAnswerId?"text-green-600 dark:text-green-400 font-medium":"text-text-muted"}`,children:[S.id===N.correctAnswerId?n.jsx(te,{name:"check-circle",className:"w-4 h-4 flex-shrink-0 mt-0.5"}):n.jsx("div",{className:"w-4 h-4 flex-shrink-0"}),n.jsx("span",{dangerouslySetInnerHTML:{__html:S.text}})]},S.id))})]},N.id))})]})]}),w=()=>n.jsxs("div",{className:"space-y-4",children:[n.jsxs(ce,{variant:"ghost",size:"sm",onClick:()=>j(null),children:[n.jsx(te,{name:"chevron-left",className:"w-4 h-4 mr-1"}),"Back to Content"]}),d!=null&&d.isLoading?n.jsx("div",{className:"flex justify-center items-center h-48",children:n.jsx(tn,{})}):d!=null&&d.content?n.jsx("div",{className:"p-4 bg-background rounded-lg border border-border",children:n.jsx(ir,{html:d.content,className:"prose dark:prose-invert max-w-none"})}):n.jsx("p",{className:"text-center text-red-500",children:"Failed to generate explanation."})]});return!r||!l?null:n.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-75 flex items-center justify-center z-[60] p-4",children:n.jsxs("div",{ref:i,className:"bg-surface rounded-lg shadow-xl w-full max-w-3xl transform transition-all relative max-h-[90vh] flex flex-col",role:"dialog","aria-modal":"true","aria-labelledby":"block-detail-title",children:[(m==null?void 0:m.visible)&&n.jsx("div",{className:"absolute z-10 p-1",style:{top:m.top,left:m.left,transform:"translateX(-50%)"},children:n.jsxs(ce,{size:"sm",onClick:b,children:[n.jsx(te,{name:"zap",className:"w-4 h-4 mr-1"})," Expand"]})}),n.jsxs("div",{className:"flex-shrink-0 flex justify-between items-center p-4 border-b border-border",children:[n.jsx("h2",{id:"block-detail-title",className:"text-xl font-bold text-text",children:"Learning Block Details"}),n.jsx(ce,{type:"button",variant:"ghost",onClick:y,className:"p-1 h-auto","aria-label":"Close",children:n.jsx(te,{name:"x"})})]}),n.jsx("div",{className:"p-6 overflow-y-auto space-y-6",children:d?w():D()}),n.jsx("div",{className:"flex-shrink-0 flex justify-end p-4 bg-background/50 border-t border-border",children:n.jsx(ce,{type:"button",variant:"primary",onClick:y,children:"Close"})})]})})},mx=({html:r,className:g})=>{const[l,u]=U.useState(!1),[f,i]=U.useState(!1),o=U.useRef(null);return U.useLayoutEffect(()=>{const m=o.current;m&&(m.scrollHeight>m.clientHeight?i(!0):i(!1))},[r]),n.jsxs("div",{children:[n.jsx("div",{ref:o,className:`${g} ${l?"":"line-clamp-3"}`,dangerouslySetInnerHTML:{__html:r}}),f&&n.jsxs(ce,{variant:"ghost",size:"sm",onClick:()=>u(!l),className:"text-primary hover:text-primary-hover -ml-1 px-1 py-1 text-sm mt-1","aria-expanded":l,children:[l?"Show less":"Show more",n.jsx(te,{name:"chevron-down",className:`w-4 h-4 ml-1 transition-transform ${l?"rotate-180":""}`})]})]})},Dv=r=>{const g={new:0,learning:0,young:0,mature:0};return r.forEach(l=>{l.interval===0?g.new++:l.interval<7?g.learning++:l.interval<21?g.young++:g.mature++}),g},Ov=({deck:r})=>{const[g,l]=U.useState([]),[u,f]=U.useState(!0),i=(r.type===Ce.Flashcard?r.cards:(r.type===Ce.Learning,r.questions))||[];U.useEffect(()=>{(async()=>{f(!0);try{const x=await Fg(r.id);l(x)}catch(x){console.error("Failed to fetch review history for deck:",x)}finally{f(!1)}})()},[r.id]);const o=U.useMemo(()=>{if(!g.length)return[];const m=new Map;return g.forEach(x=>{x.rating===wt.Again&&m.set(x.itemId,(m.get(x.itemId)||0)+1)}),Array.from(m.entries()).sort((x,d)=>d[1]-x[1]).slice(0,5).map(([x,d])=>{const j=i.find(y=>y.id===x);return j?{...j,failureCount:d}:null}).filter(x=>!!x)},[g,i]);return u?n.jsx("div",{className:"flex justify-center items-center p-8",children:n.jsx(tn,{})}):g.length===0?n.jsxs("div",{className:"text-center py-10 bg-surface rounded-lg border border-border",children:[n.jsx(te,{name:"trending-up",className:"w-12 h-12 mx-auto text-text-muted/50"}),n.jsx("h3",{className:"mt-2 text-xl font-medium text-text",children:"No Statistics Yet"}),n.jsx("p",{className:"mt-1 text-sm text-text-muted",children:"Complete a study session for this deck to see your stats."})]}):n.jsx("div",{className:"space-y-8",children:n.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-8",children:[n.jsxs("div",{className:"bg-surface p-6 rounded-lg shadow-md border border-border",children:[n.jsx("h3",{className:"text-xl font-semibold text-text mb-4",children:"Mastery Over Time"}),n.jsx("p",{className:"text-sm text-text-muted mb-4",children:"Average mastery level of reviewed cards per day over the last 90 days of activity."}),n.jsx(kv,{reviews:g})]}),n.jsxs("div",{className:"bg-surface p-6 rounded-lg shadow-md border border-border",children:[n.jsx("h3",{className:"text-xl font-semibold text-text mb-4",children:"Most Difficult Items"}),n.jsx("p",{className:"text-sm text-text-muted mb-4",children:`Items you've marked "Again" most frequently.`}),o.length>0?n.jsx("ul",{className:"space-y-3",children:o.map(m=>{const d=("questionText"in m?m.questionText:m.front).replace(/<[^>]+>/g,"").trim();return n.jsxs("li",{className:"p-3 bg-background rounded-md border border-border",children:[n.jsx("p",{className:"font-semibold text-sm text-text break-words truncate",title:d,children:d}),n.jsxs("p",{className:"text-xs text-red-500 font-medium",children:['Marked "Again" ',m.failureCount," time",m.failureCount>1?"s":""]})]},m.id)})}):n.jsx("p",{className:"text-sm text-text-muted",children:"No items have been repeatedly marked as difficult. Great job!"})]})]})})},Iv=({deck:r,sessionsToResume:g,onUpdateDeck:l,onDeleteDeck:u,onUpdateLastOpened:f,openConfirmModal:i,handleGenerateQuestionsForDeck:o,handleGenerateContentForLearningDeck:m,onCancelAIGeneration:x,onSaveLearningBlock:d,onDeleteLearningBlock:j,onExportDeck:y,onRegenerateQuestion:_,onExpandText:b})=>{var P,ae;const[D,w]=U.useState(!1),[N,S]=U.useState(r.name),[O,C]=U.useState(r.description||""),[M,R]=U.useState(r.folderId||""),[$,X]=U.useState(!1),[J,Y]=U.useState("overview"),[H,K]=U.useState(!1),[q,W]=U.useState(null),{navigate:A}=ra(),{addToast:B}=Mt(),{aiFeaturesEnabled:z}=sa(),{folders:Q,aiGenerationStatus:ue}=et(),ee=(r.type===Ce.Flashcard?r.cards:(r.type===Ce.Learning,r.questions))||[],V=U.useMemo(()=>{const{currentTask:fe,queue:Ae}=ue;return(fe==null?void 0:fe.deckId)===r.id?fe:(Array.isArray(Ae)?Ae:[]).find(Ue=>Ue.deckId===r.id)},[ue,r.id]),E=!!V;U.useEffect(()=>{f(r.id)},[r.id,f]),U.useEffect(()=>{(r.archived||r.deletedAt)&&A("/")},[r.archived,r.deletedAt,A]);const L=()=>{l({...r,name:N,description:O,folderId:M||null}),w(!1)},se=()=>{S(r.name),C(r.description||""),R(r.folderId||""),w(!1)},ie=fe=>{if(r.type===Ce.Flashcard&&fe.every(Ae=>"front"in Ae)){const Ae=pl(fe),de=[...r.cards||[],...Ae];l({...r,cards:de})}else if((r.type===Ce.Quiz||r.type===Ce.Learning)&&fe.every(Ae=>"questionText"in Ae)){const Ae=pa(fe),Ue=[...r.questions||[],...Ae];l({...r,questions:Ue})}},oe=()=>{i({title:"Move Deck to Trash",message:`Are you sure you want to move the deck "${r.name}" to the trash? It will be permanently deleted after 10 days. This will also remove it from any series it belongs to.`,onConfirm:()=>u(r.id)})},Ne=fe=>{W(fe),K(!0)},we=ee.filter(fe=>!fe.suspended),je=ee.length-we.length,ve=Dv(we),Me=Da(r),Fe=g.has(r.id),Pe=U.useMemo(()=>we.length===0?0:we.reduce((Ae,de)=>Ae+Rn(de),0)/we.length,[we]),Re=U.useMemo(()=>{const fe=new Date;fe.setHours(0,0,0,0);const Ae=Array(7).fill(0),de=[],Ue=[];for(let Le=0;Le<7;Le++){const _e=new Date(fe);_e.setDate(fe.getDate()+Le),Le===0?de.push("Today"):Le===1?de.push("Tom"):de.push(_e.toLocaleDateString("en-US",{weekday:"short"})),Ue.push(_e.toLocaleDateString("en-US",{month:"short",day:"numeric"}));const pe=_e.getTime();ee.forEach(Be=>{if(Be.suspended)return;const He=new Date(Be.dueDate);He.setHours(0,0,0,0),He.getTime()===pe&&Ae[Le]++})}return de.map((Le,_e)=>({dayLabel:Le,count:Ae[_e],date:Ue[_e]}))},[ee]),k=U.useMemo(()=>ee.length===0?"No Items to Study":r.locked?"Deck is Locked":r.type===Ce.Quiz||r.type===Ce.Learning?Fe?"Resume Quiz":`Start Quiz (${Me} due)`:Fe?"Resume Study":`Study Cards (${Me} due)`,[r.type,Fe,Me,r.locked,ee.length]),xe=[{value:ve.new,color:"bg-blue-500",label:"New"},{value:ve.learning,color:"bg-orange-500",label:"Learning"},{value:ve.young,color:"bg-teal-500",label:"Young"},{value:ve.mature,color:"bg-green-500",label:"Mature"}],he=fe=>`px-4 py-2 text-sm font-medium transition-colors ${J===fe?"border-b-2 border-primary text-text":"text-text-muted hover:text-text"}`,Z=(r.type===Ce.Quiz||r.type===Ce.Learning)&&ee.length===0;return n.jsxs("div",{className:"max-w-4xl mx-auto animate-fade-in space-y-6",children:[n.jsx("div",{className:"bg-surface rounded-lg shadow-md p-6 border border-border",children:D?n.jsxs("div",{className:"space-y-4 animate-fade-in",children:[n.jsxs("div",{children:[n.jsx("label",{htmlFor:"deck-name-edit",className:"block text-sm font-medium text-text-muted mb-1",children:"Deck Name"}),n.jsx("input",{id:"deck-name-edit",type:"text",value:N,onChange:fe=>S(fe.target.value),className:"w-full p-2 bg-background border border-border rounded-md focus:ring-2 focus:ring-primary focus:outline-none text-2xl font-bold",autoFocus:!0})]}),n.jsxs("div",{children:[n.jsx("label",{htmlFor:"deck-folder",className:"block text-sm font-medium text-text-muted mb-1",children:"Folder"}),n.jsxs("select",{id:"deck-folder",value:M,onChange:fe=>R(fe.target.value),className:"w-full p-2 bg-background border border-border rounded-md focus:ring-2 focus:ring-primary focus:outline-none",children:[n.jsx("option",{value:"",children:"No folder"}),Q.map(fe=>n.jsx("option",{value:fe.id,children:fe.name},fe.id))]})]}),n.jsxs("div",{children:[n.jsx("label",{htmlFor:"deck-desc",className:"block text-sm font-medium text-text-muted mb-1",children:"Description"}),n.jsx("textarea",{id:"deck-desc",value:O,onChange:fe=>C(fe.target.value),rows:4,className:"w-full p-2 bg-background border border-border rounded-md focus:ring-2 focus:ring-primary focus:outline-none"})]}),n.jsxs("div",{className:"flex justify-start gap-2 pt-2",children:[n.jsxs(ce,{onClick:L,children:[n.jsx(te,{name:"save",className:"mr-2"})," Save Changes"]}),n.jsx(ce,{variant:"secondary",onClick:se,children:"Cancel"})]})]}):n.jsxs("div",{children:[n.jsxs("div",{className:"min-w-0",children:[n.jsx("h2",{className:"text-3xl font-bold mb-2 text-text break-words",children:r.name}),r.folderId&&n.jsxs("div",{className:"flex items-center text-sm text-text-muted mb-2",children:[n.jsx(te,{name:"folder",className:"w-4 h-4 mr-2"}),n.jsx("span",{children:((P=Q.find(fe=>fe.id===r.folderId))==null?void 0:P.name)||"..."})]})]}),n.jsxs("div",{className:"flex items-center gap-2 mb-4",children:[n.jsxs(ce,{variant:"ghost",onClick:()=>w(!0),children:[n.jsx(te,{name:"edit",className:"mr-2"})," Edit"]}),n.jsxs(ce,{variant:"ghost",onClick:()=>l({...r,archived:!0}),children:[n.jsx(te,{name:"archive",className:"mr-2"})," Archive"]}),n.jsxs(ce,{variant:"ghost",onClick:()=>y(r),children:[n.jsx(te,{name:"download",className:"mr-2"})," Export"]})]}),r.description&&n.jsx(mx,{html:r.description,className:"text-text-muted prose dark:prose-invert max-w-none"})]})}),n.jsxs("div",{className:"border-b border-border flex space-x-4",children:[n.jsx("button",{className:he("overview"),onClick:()=>Y("overview"),children:"Overview"}),n.jsxs("button",{className:he("items"),onClick:()=>Y("items"),children:["Items (",ee.length,")"]}),n.jsx("button",{className:he("stats"),onClick:()=>Y("stats"),children:"Statistics"})]}),n.jsxs("div",{className:"mt-6",children:[J==="overview"&&n.jsxs("div",{className:"space-y-8 animate-fade-in",children:[n.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-8",children:[n.jsxs("div",{className:"space-y-4 bg-surface p-6 rounded-lg shadow-md border border-border",children:[n.jsxs("div",{children:[n.jsx("h4",{className:"text-sm font-semibold text-text mb-2",children:"Deck Statistics"}),n.jsxs("div",{className:"space-y-1",children:[r.type===Ce.Learning&&n.jsxs("p",{className:"text-sm text-text-muted",children:["Info Cards: ",n.jsx("strong",{className:"text-text",children:((ae=r.infoCards)==null?void 0:ae.length)||0})]}),n.jsxs("p",{className:"text-sm text-text-muted",children:["Active ",r.type===Ce.Learning?"Questions":"Items",": ",n.jsx("strong",{className:"text-text",children:we.length})]}),n.jsxs("p",{className:"text-sm text-text-muted",children:["Items Due Today: ",n.jsx("strong",{className:Me>0?"text-primary":"text-text",children:Me})]}),je>0&&n.jsxs("p",{className:"text-sm text-yellow-600 dark:text-yellow-400",children:["Suspended Items: ",n.jsx("strong",{children:je})]})]})]}),n.jsxs("div",{children:[n.jsx("h4",{className:"text-sm font-semibold text-text mb-2",children:"Overall Mastery"}),n.jsx(gs,{level:Pe})]}),n.jsxs("div",{children:[n.jsx("h4",{className:"text-sm font-semibold text-text mb-2",children:"Progress by Stage"}),n.jsx(Nv,{data:xe,total:we.length}),n.jsxs("div",{className:"grid grid-cols-2 gap-x-4 gap-y-1 mt-3 text-xs",children:[n.jsxs("div",{className:"flex items-center",children:[n.jsx("span",{className:"w-2.5 h-2.5 rounded-full bg-blue-500 mr-2"}),n.jsxs("span",{className:"text-text-muted",children:["New: ",n.jsx("strong",{children:ve.new})]})]}),n.jsxs("div",{className:"flex items-center",children:[n.jsx("span",{className:"w-2.5 h-2.5 rounded-full bg-orange-500 mr-2"}),n.jsxs("span",{className:"text-text-muted",children:["Learning: ",n.jsx("strong",{children:ve.learning})]})]}),n.jsxs("div",{className:"flex items-center",children:[n.jsx("span",{className:"w-2.5 h-2.5 rounded-full bg-teal-500 mr-2"}),n.jsxs("span",{className:"text-text-muted",children:["Young: ",n.jsx("strong",{children:ve.young})]})]}),n.jsxs("div",{className:"flex items-center",children:[n.jsx("span",{className:"w-2.5 h-2.5 rounded-full bg-green-500 mr-2"}),n.jsxs("span",{className:"text-text-muted",children:["Mature: ",n.jsx("strong",{children:ve.mature})]})]})]})]})]}),n.jsx("div",{className:"bg-surface p-6 rounded-lg shadow-md border border-border",children:n.jsx(_v,{data:Re})})]}),n.jsxs("div",{className:"border-t border-border pt-6 flex flex-wrap items-center justify-center gap-4",children:[Z&&z?E?n.jsxs("div",{className:"flex items-center justify-center w-full sm:w-auto text-lg py-3 px-6 font-semibold bg-background rounded-md",children:[n.jsx(tn,{size:"sm"}),n.jsx("span",{className:"ml-3 text-text-muted",children:V.statusText||"Generating..."})]}):n.jsxs(ce,{variant:"primary",size:"lg",className:"font-semibold w-full sm:w-auto",onClick:()=>{r.type===Ce.Quiz?o(r):r.type===Ce.Learning&&m(r)},children:[n.jsx(te,{name:"zap",className:"w-5 h-5 mr-2"}),r.type===Ce.Quiz?"Generate Questions":"Generate Content"]}):n.jsxs(Gt,{href:`/decks/${r.id}/study`,passAs:ce,variant:"primary",size:"lg",onClick:()=>f(r.id),disabled:Me===0&&!Fe||!!r.locked||ee.length===0,className:"font-semibold w-full sm:w-auto",children:[n.jsx(te,{name:r.locked?"lock":Fe?"zap":"laptop",className:"w-5 h-5 mr-2"})," ",k]}),n.jsxs(Gt,{href:`/decks/${r.id}/cram`,passAs:ce,variant:"secondary",size:"lg",onClick:()=>f(r.id),disabled:ee.length===0,className:"font-semibold w-full sm:w-auto",title:"Review all cards in random order, without affecting your SRS schedule.",children:[n.jsx(te,{name:"refresh-ccw",className:"w-5 h-5 mr-2"})," Cram"]}),r.type===Ce.Flashcard&&we.length>0&&n.jsxs(Gt,{href:`/decks/${r.id}/study-reversed`,passAs:ce,variant:"secondary",size:"lg",onClick:()=>f(r.id),disabled:!!r.locked,className:"font-semibold w-full sm:w-auto",title:"Study cards from back to front.",children:[n.jsx(te,{name:"repeat",className:"w-5 h-5 mr-2"})," Study Reversed"]}),r.type===Ce.Quiz&&we.length>0&&n.jsxs(Gt,{href:`/decks/${r.id}/study-flip`,passAs:ce,variant:"secondary",size:"lg",onClick:()=>f(r.id),disabled:!!r.locked,className:"font-semibold w-full sm:w-auto",children:[n.jsx(te,{name:"refresh-ccw",className:"w-5 h-5 mr-2"})," Review as Flashcards"]})]})]}),J==="items"&&n.jsx("div",{className:"bg-surface rounded-lg shadow-md border border-border animate-fade-in",children:r.type===Ce.Flashcard?n.jsx(vv,{cards:r.cards||[],onCardsChange:fe=>l({...r,cards:fe},{silent:!0}),onAddCard:fe=>l({...r,cards:[...r.cards||[],{...fe,id:crypto.randomUUID(),dueDate:new Date().toISOString(),interval:0,easeFactor:Gr}]},{silent:!0}),onBulkAdd:()=>X(!0)}):r.type===Ce.Quiz?n.jsx(Ev,{deck:r,questions:r.questions||[],onQuestionsChange:fe=>l({...r,questions:fe},{silent:!0}),onAddQuestion:fe=>{const Ae={questionType:fe.questionType,questionText:fe.questionText,options:fe.options,correctAnswerId:fe.correctAnswerId,detailedExplanation:fe.detailedExplanation,tags:fe.tags,infoCardIds:fe.infoCardIds,suspended:fe.suspended,id:crypto.randomUUID(),dueDate:new Date().toISOString(),interval:0,easeFactor:Gr,lapses:0,masteryLevel:0};l({...r,questions:[...r.questions||[],Ae]},{silent:!0})},onBulkAdd:()=>X(!0),onGenerateAI:()=>o(r),isGeneratingAI:E,onRegenerateQuestion:_}):r.type===Ce.Learning?n.jsx(Tv,{deck:r,onSaveBlock:fe=>d(r.id,fe),onDeleteBlock:fe=>j(r.id,fe),onBlockClick:Ne}):n.jsx("div",{className:"p-6 text-center text-text-muted",children:n.jsx("p",{children:"Unsupported deck type."})})}),J==="stats"&&n.jsx("div",{className:"animate-fade-in",children:n.jsx(Ov,{deck:r})})]}),n.jsxs("div",{className:"bg-red-900/20 border border-red-500/30 rounded-lg p-6",children:[n.jsx("h3",{className:"text-xl font-semibold text-red-400 dark:text-red-300 mb-2",children:"Danger Zone"}),n.jsx("p",{className:"text-red-500/80 dark:text-red-300/80 mb-4",children:"Moving a deck to the trash will make it unavailable for study. It will be permanently deleted after 10 days."}),n.jsxs(ce,{variant:"danger",onClick:oe,children:[n.jsx(te,{name:"trash-2",className:"mr-2"})," Move to Trash"]})]}),$&&n.jsx(jv,{isOpen:$,onClose:()=>X(!1),onAddItems:ie,deckType:r.type}),H&&n.jsx(Cv,{isOpen:H,onClose:()=>K(!1),block:q,deckName:r.name,onExpandText:b})]})},Fr=({children:r})=>n.jsx("pre",{className:"bg-gray-100 dark:bg-gray-900/70 p-4 rounded-lg overflow-x-auto text-sm text-gray-800 dark:text-gray-200 border border-gray-200 dark:border-gray-700",children:n.jsx("code",{children:r})}),rr=({title:r,iconName:g,children:l,defaultOpen:u=!1})=>{const[f,i]=U.useState(u);return n.jsxs("div",{className:"border border-gray-200 dark:border-gray-700 rounded-lg overflow-hidden",children:[n.jsxs("button",{onClick:()=>i(!f),className:"w-full flex justify-between items-center text-left p-4 bg-gray-50 dark:bg-gray-800/50 hover:bg-gray-100 dark:hover:bg-gray-700/50 transition-colors","aria-expanded":f,children:[n.jsxs("div",{className:"flex items-center",children:[g&&n.jsx(te,{name:g,className:"w-6 h-6 mr-3 text-gray-500 dark:text-gray-400"}),n.jsx("h3",{className:"text-xl font-semibold text-gray-800 dark:text-gray-200",children:r})]}),n.jsx(te,{name:"chevron-down",className:`w-6 h-6 transition-transform duration-300 ${f?"":"-rotate-90"} text-gray-500`})]}),f&&n.jsx("div",{className:"p-6 bg-white dark:bg-gray-800 animate-fade-in",children:l})]})},vg=({fields:r})=>n.jsx("div",{className:"overflow-x-auto",children:n.jsxs("table",{className:"w-full text-left border-collapse mt-4 min-w-[500px]",children:[n.jsx("thead",{children:n.jsxs("tr",{children:[n.jsx("th",{className:"border-b-2 dark:border-gray-600 p-2 text-sm font-semibold text-gray-700 dark:text-gray-300",children:"Field"}),n.jsx("th",{className:"border-b-2 dark:border-gray-600 p-2 text-sm font-semibold text-gray-700 dark:text-gray-300",children:"Type"}),n.jsx("th",{className:"border-b-2 dark:border-gray-600 p-2 text-sm font-semibold text-gray-700 dark:text-gray-300",children:"Required"}),n.jsx("th",{className:"border-b-2 dark:border-gray-600 p-2 text-sm font-semibold text-gray-700 dark:text-gray-300",children:"Description"})]})}),n.jsx("tbody",{children:r.map(({field:g,type:l,description:u,required:f})=>n.jsxs("tr",{className:"border-b dark:border-gray-700/50",children:[n.jsx("td",{className:"p-2 align-top",children:n.jsx("code",{className:"bg-gray-200 dark:bg-gray-700 px-1 py-0.5 rounded-sm",children:g})}),n.jsx("td",{className:"p-2 align-top text-gray-600 dark:text-gray-400",children:l}),n.jsx("td",{className:"p-2 align-top",children:f?n.jsx(te,{name:"check-circle",className:"text-green-500"}):"No"}),n.jsx("td",{className:"p-2 align-top text-gray-600 dark:text-gray-400",dangerouslySetInnerHTML:{__html:u}})]},g))})]})}),Rv=()=>{const{addToast:r}=Mt(),[g,l]=U.useState(""),[u,f]=U.useState("Beginner"),[i,o]=U.useState(""),[m,x]=U.useState(""),[d,j]=U.useState("Beginner"),[y,_]=U.useState("Beginner"),[b,D]=U.useState(null),w=["Novice","Beginner","Intermediate","Advanced","Expert","Mastery"],N=`[
  {
    "front": "What is the capital of France?",
    "back": "Paris"
  },
  {
    "front": "What is H2O?",
    "back": "Water"
  }
]`,S=`{
  "name": "Sample Science Quiz",
  "description": "A few questions to test your <b>basic</b> science knowledge.",
  "questions": [
    {
      "questionType": "multipleChoice",
      "questionText": "Which planet is known as the Red Planet?",
      "tags": ["astronomy", "planets"],
      "detailedExplanation": "Mars is often called the Red Planet because of the iron oxide prevalent on its surface, which gives it a reddish appearance.",
      "options": [
        { "id": "opt1", "text": "Venus", "explanation": "Venus is known for its thick, toxic atmosphere, not its red color." },
        { "id": "opt2", "text": "Mars", "explanation": "Correct! Mars has a reddish appearance due to iron oxide on its surface." },
        { "id": "opt3", "text": "Jupiter", "explanation": "Jupiter is a gas giant, the largest planet in our solar system, known for its stripes and Great Red Spot." }
      ],
      "correctAnswerId": "opt2"
    }
  ]
}`,O=[{field:"name",type:"string",required:!0,description:"The title of the quiz deck."},{field:"description",type:"string",required:!0,description:"A brief summary of the deck's content. Can include basic HTML for formatting (e.g., `<b>`, `<i>`, `<br>`)."},{field:"questions",type:"Array<Question>",required:!0,description:"An array containing all question objects for the deck."},{field:"questionType",type:"string",required:!0,description:'Must be "multipleChoice" for now.'},{field:"questionText",type:"string",required:!0,description:"The question being asked."},{field:"tags",type:"Array<string>",required:!1,description:"An array of keywords for organization."},{field:"detailedExplanation",type:"string",required:!0,description:"The full explanation shown after answering."},{field:"options",type:"Array<Option>",required:!0,description:"An array of possible answers."},{field:"correctAnswerId",type:"string",required:!0,description:"The `id` of the correct option."},{field:"options[].id",type:"string",required:!0,description:"A unique identifier for this option within the question."},{field:"options[].text",type:"string",required:!0,description:"The answer text shown to the user."},{field:"options[].explanation",type:"string",required:!1,description:"A brief explanation for why this specific option is right or wrong. While technically optional, providing this for all options is **strongly recommended** for high-quality questions."}],C=`{
  "seriesName": "Intro to Web Development",
  "seriesDescription": "A progressive series covering the <b>fundamentals</b> of web development.",
  "levels": [
    {
      "title": "Level 1: The Foundation",
      "decks": [
        {
          "name": "Level 1.1: HTML Basics",
          "description": "The building blocks of the web.",
          "questions": [
            {
              "questionType": "multipleChoice",
              "questionText": "What does HTML stand for?",
              "tags": ["html", "basics"],
              "detailedExplanation": "HTML stands for HyperText Markup Language...",
              "options": [
                { "id": "1", "text": "HyperText Markup Language", "explanation": "Correct. It's the standard markup language for documents designed to be displayed in a web browser." },
                { "id": "2", "text": "High-Level Text Machine Language", "explanation": "Incorrect. This is not a standard term in web development." }
              ],
              "correctAnswerId": "1"
            }
          ]
        },
        { "name": "Level 1.2: CSS Fundamentals", "description": "...", "questions": [] }
      ]
    }
  ]
}`,M=[{field:"seriesName",type:"string",required:!0,description:"The title for the entire series."},{field:"seriesDescription",type:"string",required:!0,description:"A brief summary of what the whole series covers. Can include basic HTML for formatting."},{field:"levels",type:"Array<Level>",required:!0,description:"An array containing all the levels in the series."},{field:"levels[].title",type:"string",required:!0,description:'The heading for a group of decks (e.g., "Level 1: Core Concepts").'},{field:"levels[].decks",type:"Array<QuizDeck>",required:!0,description:"An array of quiz decks for that level. The schema for each deck is the same as the Single Quiz Deck format."}],R=`Please act as a world-class instructional designer and subject matter expert. Your task is to generate a comprehensive, detailed, and world-class TEXT outline for a learning path. The output must be plain text, not a JSON object.

**Topic:** [YOUR TOPIC HERE]
**User's Current Level:** [USER'S LEVEL HERE]

The goal is to create a structured and progressive learning path that guides the user towards deep, comprehensive mastery of the topic, similar in quality and detail to the provided example structure.

**INSTRUCTIONS & REQUIREMENTS:**

1.  **Learning Path Structure:**
    -   Organize the learning path into logical "Levels" (e.g., Level 1, Level 2, up to Level 4 or 5). Each level must have a title and represent a significant step up in knowledge.
    -   Each Level should contain one or more related "Decks".
    -   The name of each deck must reflect this structure, e.g., "Level 1.1: Foundations of X", "Level 1.2: Core Concepts of Y", "Level 2.1: Advanced Techniques in Z".

2.  **High-Quality Content (Crucial):**
    -   **Comprehensive Coverage:** The outline must cover the topic in sufficient depth for the specified user level, ensuring a thorough understanding.
    -   **Series Name & Description:** Create a compelling and descriptive name (e.g., "Topic Mastery Path: The Contextual Approach") and a comprehensive summary for the entire learning path. The description can use basic HTML for formatting (e.g., <b>, <i>, <br>).
    -   **Engaging Tone:** All names and descriptions should be written to be engaging and spark curiosity, not just be descriptive. Avoid a dry, academic tone.
    -   **Level Goal & Focus:** For each Level, provide a clear "Goal" and "Focus".
    -   **Deck Topics:** For each Deck, provide a detailed, itemized list of specific "Topics" to be covered.
    -   **Progressive Difficulty:** The path must be logically sequenced, starting with foundational definitions and historical context, moving to practical applications, then to assessment and planning, and finally to interdisciplinary challenges.
    -   **Context-Specific:** If the user's topic has a specific context (e.g., a geographical location, a particular framework), embed that context deeply into the entire outline.
    -   **Clarity with Acronyms:** When using an acronym, write it out fully in parentheses the first time it is used (e.g., "Sustainable Forest Management (SFM)").
    -   **Approximate Question Count:** Suggest an approximate number of questions for each deck.
    -   **Metric System:** All generated content should prefer the metric system (e.g., meters, kilograms, Celsius).

**EXAMPLE STRUCTURE:**
Ecological Sustainable Forestry Mastery Path: The Scanian Approach
This learning path provides a deep understanding of...
Level 1: Core Principles & Historical Context in Skåne
Goal: Define ecological sustainable forestry...
Focus: Shifting from purely extractive forestry...
Level 1.1: Foundations of Sustainable Forest Management (SFM) in Skåne
Topics: Definitional evolution of forestry...
Approx. Questions: 30-40

---

Now, based on all the above requirements, generate the complete text outline.

Finally, at the very end of your response, provide a JSON object with the series name and description you created, like this:
{
  "seriesName": "The full series name you generated above",
  "seriesDescription": "The full series description you generated above"
}
`,$=`You are an expert content creator. I have provided a text outline for a learning path. Your task is to convert this outline into a structured JSON object that will serve as a scaffold.

**PRIMARY INSTRUCTIONS:**

1.  **Source Material:** Use ONLY the text outline I've provided as your source.
2.  **Structure:** Create a single JSON object with \`seriesName\`, \`seriesDescription\`, and a \`levels\` array.
3.  **Levels and Decks:** Inside the \`levels\` array, create objects for each level, including its \`title\`. Each level object should have a \`decks\` array. Populate this with deck objects, each containing its \`name\` and \`description\` from the outline.
4.  **Empty Questions:** For every deck object, include a \`"questions": []\` key-value pair. The questions array MUST be empty.

**JSON OUTPUT FORMAT:**
- The final output MUST be ONLY a single, raw JSON object, starting with \`{\` and ending with \`}\`. Do not include any surrounding text, explanations, or markdown formatting.
- The JSON object must follow this exact schema:
{
  "seriesName": "The full series name from the outline",
  "seriesDescription": "The full series description from the outline",
  "levels": [
    {
      "title": "The title of the first level",
      "decks": [
        {
          "name": "The name of the first deck in this level",
          "description": "The description for this deck",
          "questions": []
        },
        {
          "name": "The name of the second deck in this level",
          "description": "The description for this deck",
          "questions": []
        }
      ]
    }
  ]
}

Now, based on the text outline I provided, please generate the complete JSON scaffold.`,X=`You are an expert content creator. I have provided a text outline for a learning path. Your task is to generate the JSON for the **first deck (e.g., Level 1.1)** from that outline.

**PRIMARY INSTRUCTIONS:**

1.  **Source Material:** Use ONLY the text outline I've provided as your source.
2.  **Question Quantity:** Generate the approximate number of questions specified in the outline for this first deck.
3.  **Content Generation:** Create world-class questions and answers based *only* on the "Topics" listed for this specific deck in the outline.

**CRITICAL CONTENT QUALITY REQUIREMENTS:**
- **Factual Accuracy:** This is paramount. The correct answer and all parts of the explanation must be unequivocally correct and verifiable.
- **In-Depth Coverage:** The questions must cover the deck's topics comprehensively, moving beyond surface-level facts to ensure a deep understanding.
- **Relevance & Practical Application:** Frame questions in real-world scenarios to help a user apply the information. Questions must be relevant to the deck's topics.
- **Clarity & Simplicity:** Questions must be easy to understand, unambiguous, and free of jargon (unless the jargon is the learning objective). Test only one core concept per question.
- **Clarity with Acronyms:** When using an acronym, provide the full term in parentheses upon its first use (e.g., 'Central Processing Unit (CPU)').
- **Problem-Solving Focus:** Design questions that require applying knowledge, not just recalling facts. Avoid trivial pursuit and focus on genuinely useful information. For practical topics, ask skill-based questions that test the ability to perform a task or make a decision.
- **High-Quality Explanations:** The \`detailedExplanation\` is crucial. It must explain the reasoning, principles, or facts behind the correct answer. Provide additional context, examples, or connections to related concepts to deepen understanding. If applicable, cite sources for complex information.
- **Metric System:** Prefer the metric system (e.g., meters, kilograms, Celsius) for all units.
- **Engaging Content:** Write questions and explanations in an interesting way that makes the user want to learn more. Use surprising facts, real-world scenarios, or narrative elements where appropriate to maintain learner interest.
- **Unpredictable Answer Length:** The length of the correct answer's text must be varied. It should not consistently be the longest or shortest option. This is critical to avoid giving away the answer.
- **Option Explanations:** Every option, correct or incorrect, MUST have a brief \`explanation\` field.

**JSON OUTPUT FORMAT:**
- The final output MUST be ONLY a single, raw JSON object, starting with \`{\` and ending with \`}\`. Do not include any surrounding text, explanations, or markdown formatting.
- The JSON object must follow this exact schema:
{
  "name": "The exact name for the deck from your outline, e.g., 'Level 1.1: Foundations...'",
  "description": "A concise description of this specific deck's content, based on its topics.",
  "questions": [
    {
      "questionType": "multipleChoice",
      "questionText": "The text of the first question...",
      "tags": ["relevant", "tags"],
      "detailedExplanation": "A thorough explanation that meets all quality requirements.",
      "options": [
        { "id": "q1_opt1", "text": "First answer option", "explanation": "Brief reason why this option is correct or incorrect." },
        { "id": "q1_opt2", "text": "Second answer option", "explanation": "Brief reason why this option is correct or incorrect." }
      ],
      "correctAnswerId": "q1_opt2"
    }
  ]
}

Now, based on the text outline I provided, please generate the JSON for the **first deck**.`,J=`Please act as an expert instructional designer and generate a complete, structured Deck Series in a single JSON object.

**Topic:** [YOUR TOPIC HERE]
**User's Current Level:** [USER'S LEVEL HERE]

**CONTENT REQUIREMENTS FOR ALL QUESTIONS:**
-   **Comprehensive Coverage:** The generated series must be comprehensive, covering the topic in-depth to provide a thorough understanding for the specified user level.
-   **Factual Accuracy:** All correct answers and explanations must be verifiable and factually correct.
-   **Engaging Content Style:** Frame questions and explanations in an interesting way. Use surprising facts, real-world examples, or historical context to make the material more memorable and engaging. Avoid a dry, academic, textbook-like tone.
-   **Practical Application:** Frame questions to enable the user to put the learned information into practice.
-   **Clarity:** Questions must be easy to understand and unambiguous.
-   **Clarity with Acronyms:** When using an acronym, provide the full term in parentheses upon its first use (e.g., 'CPU (Central Processing Unit)').
-   **Metric System:** Prefer the metric system (e.g., meters, kilograms, Celsius) for all units.
-   **Unpredictable Answer Length:** The length of the correct answer's text must be varied and not consistently be the longest or shortest option.
-   **Option Explanations:** Every option, correct or incorrect, MUST have a brief \`explanation\` field.

**FINAL JSON OUTPUT FORMAT:**
The final output MUST be ONLY a single, raw JSON object without any surrounding text or markdown. The root object must have this exact schema:
{
  "seriesName": "A descriptive name for the whole series",
  "seriesDescription": "A brief description of what the series covers. Can include basic HTML for formatting.",
  "levels": [
    {
      "title": "Level 1: The Basics",
      "decks": [
        {
          "name": "Level 1.1: Deck Name",
          "description": "Description of this deck's content. Can include basic HTML for formatting.",
          "questions": [
            {
              "questionType": "multipleChoice",
              "questionText": "...",
              "tags": ["tag1", "tag2"],
              "detailedExplanation": "...",
              "options": [ { "id": "q1_opt1", "text": "...", "explanation": "Brief reason..." }, { "id": "q1_opt2", "text": "...", "explanation": "Brief reason..." } ],
              "correctAnswerId": "q1_opt2"
            }
          ]
        }
      ]
    }
  ]
}

Now, generate the complete JSON object based on all the above requirements.`,Y="Please generate a JSON object for a single multiple-choice quiz.\n\n**Topic:** [YOUR TOPIC HERE]\n**Designed for Level:** [USER'S LEVEL HERE]\n\n**CONTENT REQUIREMENTS:**\n-   **Engaging & Curiosity-Driven:** All content must be written in an engaging style that sparks curiosity. Avoid a dry, academic, textbook-like tone. Use surprising facts, real-world scenarios, or narrative elements where appropriate to make the material more memorable.\n-   **Factual Accuracy:** All information must be factually correct and from reliable, verifiable sources.\n-   **In-Depth Questions:** The questions should cover the topic comprehensively, moving beyond surface-level facts to ensure a deep understanding.\n-   **Relevance:** Questions must be directly pertinent to the chosen topic and appropriate for the specified level.\n-   **Question Quantity:** Generate 10-100 high-quality questions. Do not include multiple questions that are essentially asking the same thing.\n-   **Clarity:** Questions must be easy to understand and unambiguous.\n-   **Clarity with Acronyms:** When using an acronym, provide the full term in parentheses upon its first use (e.g., 'CPU (Central Processing Unit)').\n-   **Problem-Solving Focus:** Prioritize questions that require applying knowledge to solve a problem.\n-   **Explanation Quality:** The `detailedExplanation` must explain the reasoning behind the correct answer and provide additional context.\n-   **Metric System:** Prefer the metric system (e.g., meters, kilograms, Celsius) for all units.\n-   **Unpredictable Answer Length:** The length of the correct answer's text must be varied and not consistently be the longest or shortest option.\n-   **Option Explanations:** Every option, correct or incorrect, MUST have a brief `explanation` field.\n\n**JSON SCHEMA & RULES:**\n-   The final output must be ONLY the raw JSON object, starting with `{` and ending with `}`.\n-   The root object must contain `name`, `description`, and `questions` (array).\n-   Each question object must contain `questionType` (\"multipleChoice\"), `questionText`, `tags` (array), `detailedExplanation`, `options` (array), and `correctAnswerId`.\n-   Each option object must contain a unique `id`, `text`, and a brief `explanation`.\n-   Do NOT include top-level SRS fields like `id` or `dueDate` on the questions.\n\nNow, generate the complete JSON deck based on all the above requirements.",H=(z,Q)=>{navigator.clipboard.writeText(z).then(()=>{r("Prompt copied to clipboard!","success"),D(Q),setTimeout(()=>D(null),2e3)}).catch(ue=>{r("Failed to copy prompt.","error"),console.error("Could not copy text: ",ue)})},K=()=>{const z=g.trim()||"[YOUR TOPIC HERE]",Q=R.replace("[YOUR TOPIC HERE]",z).replace("[USER'S LEVEL HERE]",u);H(Q,"outline-prompt")},q=()=>{H($,"scaffold-prompt")},W=()=>{H(X,"deck-from-outline-prompt")},A=()=>{const z=i.trim()||"[YOUR TOPIC HERE]",Q=J.replace("[YOUR TOPIC HERE]",z).replace("[USER'S LEVEL HERE]",d);H(Q,"series-prompt")},B=()=>{const z=m.trim()||"[YOUR TOPIC HERE]",Q=Y.replace("[YOUR TOPIC HERE]",z).replace("[USER'S LEVEL HERE]",y);H(Q,"quiz-prompt")};return n.jsxs("div",{className:"max-w-4xl mx-auto animate-fade-in space-y-6 pb-10",children:[n.jsxs("div",{children:[n.jsx("h1",{className:"text-4xl font-bold text-gray-900 dark:text-gray-100",children:"AI & JSON Import Guide"}),n.jsx("p",{className:"mt-2 text-lg text-gray-500 dark:text-gray-400",children:"Use this expert-led workflow to generate high-quality learning content with AI, or follow the formats to import your own data."})]}),n.jsx(rr,{title:"Step 1: Generate Learning Outline (Text)",iconName:"list",defaultOpen:!0,children:n.jsxs("div",{className:"space-y-4 bg-green-900/10 dark:bg-green-900/20 p-6 rounded-lg border border-green-500/20",children:[n.jsx("p",{className:"text-green-800/90 dark:text-green-200/90",children:"Begin by generating a high-level, human-readable outline for your learning path using an external AI chat service. This allows you to review and approve the structure before generating the full content."}),n.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[n.jsxs("div",{children:[n.jsx("label",{htmlFor:"outline-topic-input",className:"block text-sm font-medium text-green-700 dark:text-green-300",children:"Enter Topic"}),n.jsx("input",{id:"outline-topic-input",type:"text",value:g,onChange:z=>l(z.target.value),className:"w-full p-2 mt-1 bg-green-50 dark:bg-gray-900 border border-green-300 dark:border-green-700 rounded-md focus:ring-2 focus:ring-green-500 focus:outline-none",placeholder:"e.g., The History of Ancient Rome"})]}),n.jsxs("div",{children:[n.jsx("label",{htmlFor:"outline-level-select",className:"block text-sm font-medium text-green-700 dark:text-green-300",children:"My Current Level Is"}),n.jsx("select",{id:"outline-level-select",value:u,onChange:z=>f(z.target.value),className:"w-full p-2 mt-1 bg-green-50 dark:bg-gray-900 border border-green-300 dark:border-green-700 rounded-md focus:ring-2 focus:ring-green-500 focus:outline-none",children:w.map(z=>n.jsx("option",{value:z,children:z},z))})]})]}),n.jsx("p",{className:"text-xs text-green-600/80 dark:text-green-400/80 mt-1",children:"Your topic and level will be inserted into the prompt."}),n.jsxs("div",{className:"relative",children:[n.jsx(Fr,{children:R}),n.jsx(ce,{variant:"secondary",className:"absolute top-2 right-2 px-2 py-1 text-xs bg-gray-200/50 dark:bg-gray-900/50 border border-gray-300 dark:border-gray-600",onClick:K,children:b==="outline-prompt"?n.jsxs(n.Fragment,{children:[n.jsx(te,{name:"check-circle",className:"w-4 h-4 mr-1"})," Copied!"]}):n.jsxs(n.Fragment,{children:[n.jsx(te,{name:"download",className:"w-4 h-4 mr-1"})," Copy Prompt"]})})]})]})}),n.jsx(rr,{title:"Step 2: Create the Series Scaffold",iconName:"code",children:n.jsxs("div",{className:"space-y-4 bg-yellow-900/10 dark:bg-yellow-900/20 p-6 rounded-lg border border-yellow-500/20",children:[n.jsx("p",{className:"text-yellow-800/90 dark:text-yellow-200/90",children:'You can now create the series structure in CogniFlow. Use the in-app "Generate with AI" feature with your topic. This will automatically create the series with empty decks, ready for you to populate.'}),n.jsx("p",{className:"text-sm text-yellow-700/90 dark:text-yellow-300/90",children:'Alternatively, you can manually convert your text outline from Step 1 into a JSON "scaffold" using the prompt below and import it via the "Create / Import" modal.'}),n.jsxs("div",{className:"relative",children:[n.jsx(Fr,{children:$}),n.jsx(ce,{variant:"secondary",className:"absolute top-2 right-2 px-2 py-1 text-xs bg-gray-200/50 dark:bg-gray-900/50 border border-gray-300 dark:border-gray-600",onClick:q,children:b==="scaffold-prompt"?n.jsxs(n.Fragment,{children:[n.jsx(te,{name:"check-circle",className:"w-4 h-4 mr-1"})," Copied!"]}):n.jsxs(n.Fragment,{children:[n.jsx(te,{name:"download",className:"w-4 h-4 mr-1"})," Copy Prompt"]})})]})]})}),n.jsx(rr,{title:"Step 3: Generate Questions for Each Deck",iconName:"zap",children:n.jsxs("div",{className:"space-y-4 bg-blue-900/10 dark:bg-blue-900/20 p-6 rounded-lg border border-blue-500/20",children:[n.jsx("p",{className:"text-blue-800/90 dark:text-blue-200/90",children:'Navigate to your newly created series page in CogniFlow. Each empty deck will have a "Generate Questions" button. Click it to have the AI populate that specific deck with high-quality, relevant questions automatically.'}),n.jsx("p",{className:"text-sm text-blue-700/90 dark:text-blue-300/90",children:"If you are working with an external AI and your JSON scaffold from Step 2, you can use the prompt below to generate the questions for each deck. Paste your text outline into the chat first, then use the prompt. Copy the generated `questions` array into the correct deck in your scaffold JSON. Repeat for all decks, then import the final JSON file."}),n.jsxs("div",{className:"relative",children:[n.jsx(Fr,{children:X}),n.jsx(ce,{variant:"secondary",className:"absolute top-2 right-2 px-2 py-1 text-xs bg-gray-200/50 dark:bg-gray-900/50 border border-gray-300 dark:border-gray-600",onClick:W,children:b==="deck-from-outline-prompt"?n.jsxs(n.Fragment,{children:[n.jsx(te,{name:"check-circle",className:"w-4 h-4 mr-1"})," Copied!"]}):n.jsxs(n.Fragment,{children:[n.jsx(te,{name:"download",className:"w-4 h-4 mr-1"})," Copy Prompt"]})})]})]})}),n.jsx(rr,{title:"Alternative: Generate Full Series at Once (JSON)",iconName:"zap",children:n.jsxs("div",{className:"space-y-4 bg-purple-900/10 dark:bg-purple-900/20 p-6 rounded-lg border border-purple-500/20",children:[n.jsx("p",{className:"text-purple-700/90 dark:text-purple-300/90",children:"For a faster, one-shot approach, use this powerful prompt to generate a complete, structured learning path on any topic. This is less controlled but much quicker."}),n.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[n.jsxs("div",{children:[n.jsx("label",{htmlFor:"series-topic-input",className:"block text-sm font-medium text-purple-700 dark:text-purple-300",children:"Enter Topic"}),n.jsx("input",{id:"series-topic-input",type:"text",value:i,onChange:z=>o(z.target.value),className:"w-full p-2 mt-1 bg-purple-50 dark:bg-gray-900 border border-purple-300 dark:border-purple-700 rounded-md focus:ring-2 focus:ring-purple-500 focus:outline-none",placeholder:"e.g., Quantum Physics"})]}),n.jsxs("div",{children:[n.jsx("label",{htmlFor:"series-level-select",className:"block text-sm font-medium text-purple-700 dark:text-purple-300",children:"My Current Level Is"}),n.jsx("select",{id:"series-level-select",value:d,onChange:z=>j(z.target.value),className:"w-full p-2 mt-1 bg-purple-50 dark:bg-gray-900 border border-purple-300 dark:border-purple-700 rounded-md focus:ring-2 focus:ring-purple-500 focus:outline-none",children:w.map(z=>n.jsx("option",{value:z,children:z},z))})]})]}),n.jsx("p",{className:"text-xs text-purple-600/80 dark:text-purple-400/80 mt-1",children:"Your topic and level will be inserted into the prompt."}),n.jsxs("div",{className:"relative",children:[n.jsx(Fr,{children:J}),n.jsx(ce,{variant:"secondary",className:"absolute top-2 right-2 px-2 py-1 text-xs bg-gray-200/50 dark:bg-gray-900/50 border border-gray-300 dark:border-gray-600",onClick:A,children:b==="series-prompt"?n.jsxs(n.Fragment,{children:[n.jsx(te,{name:"check-circle",className:"w-4 h-4 mr-1"})," Copied!"]}):n.jsxs(n.Fragment,{children:[n.jsx(te,{name:"download",className:"w-4 h-4 mr-1"})," Copy Prompt"]})})]})]})}),n.jsx(rr,{title:"Alternative: Generate a Single Quiz Deck",iconName:"zap",children:n.jsxs("div",{className:"space-y-4 bg-blue-900/10 dark:bg-blue-900/20 p-6 rounded-lg border border-blue-500/20",children:[n.jsx("p",{className:"text-blue-700/90 dark:text-blue-300/90",children:"Use this prompt to generate a single quiz deck on any topic, tailored to a specific difficulty level."}),n.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 mb-4",children:[n.jsxs("div",{children:[n.jsx("label",{htmlFor:"quiz-topic-input",className:"block text-sm font-medium text-blue-700 dark:text-blue-300",children:"Enter Topic"}),n.jsx("input",{id:"quiz-topic-input",type:"text",value:m,onChange:z=>x(z.target.value),className:"w-full p-2 mt-1 bg-blue-50 dark:bg-gray-900 border border-blue-300 dark:border-blue-700 rounded-md focus:ring-2 focus:ring-blue-500 focus:outline-none",placeholder:"e.g., The Roman Empire"})]}),n.jsxs("div",{children:[n.jsx("label",{htmlFor:"quiz-level-select",className:"block text-sm font-medium text-blue-700 dark:text-blue-300",children:"Deck Difficulty Level"}),n.jsx("select",{id:"quiz-level-select",value:y,onChange:z=>_(z.target.value),className:"w-full p-2 mt-1 bg-blue-50 dark:bg-gray-900 border border-blue-300 dark:border-blue-700 rounded-md focus:ring-2 focus:ring-blue-500 focus:outline-none",children:w.map(z=>n.jsx("option",{value:z,children:z},z))})]})]}),n.jsxs("div",{className:"relative",children:[n.jsx(Fr,{children:Y}),n.jsx(ce,{variant:"secondary",className:"absolute top-2 right-2 px-2 py-1 text-xs bg-gray-200/50 dark:bg-gray-900/50 border border-gray-300 dark:border-gray-600",onClick:B,children:b==="quiz-prompt"?n.jsxs(n.Fragment,{children:[n.jsx(te,{name:"check-circle",className:"w-4 h-4 mr-1"})," Copied!"]}):n.jsxs(n.Fragment,{children:[n.jsx(te,{name:"download",className:"w-4 h-4 mr-1"})," Copy Prompt"]})})]})]})}),n.jsxs(rr,{title:"Format 1: Full Deck Series (JSON)",iconName:"list",children:[n.jsx("p",{className:"text-gray-600 dark:text-gray-400 mb-4",children:"To import an entire learning path at once, provide a single JSON object containing the series details and a `levels` array. Each level has a title and contains its own array of decks."}),n.jsx(Fr,{children:C}),n.jsx("h4",{className:"text-lg font-semibold mt-6 mb-2",children:"Field Definitions"}),n.jsx(vg,{fields:M})]}),n.jsxs(rr,{title:"Format 2: Single Quiz Deck (JSON)",iconName:"help-circle",children:[n.jsx("p",{className:"text-gray-600 dark:text-gray-400 mb-4",children:"For a single multiple-choice quiz, provide a JSON object with a name, description, and an array of question objects. See the field definitions below for more details."}),n.jsx(Fr,{children:S}),n.jsx("h4",{className:"text-lg font-semibold mt-6 mb-2",children:"Field Definitions"}),n.jsx(vg,{fields:O})]}),n.jsxs(rr,{title:"Format 3: Simple Flashcard Deck (JSON)",iconName:"laptop",children:[n.jsxs("p",{className:"text-gray-600 dark:text-gray-400 mb-4",children:["For basic front-and-back flashcards, provide a JSON array. Each object in the array must have a ",n.jsx("code",{className:"bg-gray-200 dark:bg-gray-700 px-1 py-0.5 rounded-sm",children:"front"})," and a ",n.jsx("code",{className:"bg-gray-200 dark:bg-gray-700 px-1 py-0.5 rounded-sm",children:"back"})," key, both with string values. This format is ideal for quick, manual creation or for exporting from other simple flashcard apps."]}),n.jsx(Fr,{children:N})]}),n.jsx(rr,{title:"General Tips & Troubleshooting",iconName:"settings",children:n.jsxs("ul",{className:"space-y-4 list-disc list-inside text-gray-600 dark:text-gray-400",children:[n.jsxs("li",{children:[n.jsx("strong",{children:"Validate Your JSON:"})," Before importing, it's a good idea to paste your JSON into an online validator to check for syntax errors. A common mistake is a trailing comma after the last item in an array or object.",n.jsx("br",{}),n.jsx("code",{children:'[ { "key": "value" }, ] &larr; Invalid Trailing Comma'})]}),n.jsxs("li",{children:[n.jsx("strong",{children:"Check Your Quotes:"}),` All keys and string values in JSON must be enclosed in double quotes ("). Single quotes (') are not valid.`]}),n.jsxs("li",{children:[n.jsx("strong",{children:"Schema Mismatches:"}),' Ensure your JSON structure matches one of the three formats above. For example, pasting an array of flashcards into the "Bulk Add" modal inside a quiz deck will fail. The main "Import" modal is more flexible and can detect the format automatically.']}),n.jsxs("li",{children:[n.jsx("strong",{children:"Unique IDs:"}),' When creating quiz questions, ensure the `id` for each option within a single question is unique. You can use simple strings like "opt1", "opt2", or a UUID.']}),n.jsxs("li",{children:[n.jsx("strong",{children:"AI-Generated Content:"})," Always review content generated by an AI for factual accuracy before studying it. The prompts are designed to request accuracy, but AI can still make mistakes."]})]})})]})},Qo=({deck:r,sessionsToResume:g,onUpdateLastOpened:l,draggedDeckId:u,onDragStart:f,onDragEnd:i,onUpdateDeck:o,onDeleteDeck:m,openConfirmModal:x,handleGenerateQuestionsForDeck:d,handleGenerateContentForLearningDeck:j})=>{var A;const{navigate:y}=ra(),{aiGenerationStatus:_}=et(),{aiFeaturesEnabled:b}=sa(),D=Da(r),w=g.has(r.id),N=(r.type===Ce.Quiz||r.type===Ce.Learning?r.questions:r.cards)||[],S=(N==null?void 0:N.length)||0;let O,C;r.type===Ce.Quiz||r.type===Ce.Learning?(O=S===1?"question":"questions",C=r.type===Ce.Learning?"book-open":"help-circle"):(O=S===1?"card":"cards",C="laptop");const[M,R]=U.useState(!1),$=U.useRef(null),X=U.useMemo(()=>{const{currentTask:B,queue:z}=_;return(B==null?void 0:B.deckId)===r.id?B:(Array.isArray(z)?z:[]).find(ue=>ue.deckId===r.id)},[_,r.id]),J=!!X,Y=_.currentTask!==null||(((A=_.queue)==null?void 0:A.length)||0)>0,H=(r.type===Ce.Quiz||r.type===Ce.Learning)&&S===0;U.useEffect(()=>{const B=z=>{$.current&&!$.current.contains(z.target)&&R(!1)};return M?document.addEventListener("mousedown",B):document.removeEventListener("mousedown",B),()=>document.removeEventListener("mousedown",B)},[M]);const K=U.useMemo(()=>{if(N.length===0)return 0;const B=N.filter(Q=>!Q.suspended);return B.length===0?0:B.reduce((Q,ue)=>Q+Rn(ue),0)/B.length},[N]),q=U.useMemo(()=>r.locked?"Locked":H&&!Y?"Generate":w?"Resume":`Study (${D})`,[r.locked,H,Y,w,D]),W=B=>{if(B.preventDefault(),B.stopPropagation(),!r.locked){if(H&&!Y){r.type===Ce.Quiz&&d?d(r):r.type===Ce.Learning&&j&&j(r);return}S>0&&y(`/decks/${r.id}/study`)}};return n.jsx(Gt,{href:`/decks/${r.id}`,draggable:"true",onDragStart:B=>{B.dataTransfer.setData("text/plain",r.id),B.dataTransfer.effectAllowed="move",f(r.id)},onDragEnd:i,onClick:()=>l(r.id),className:`block bg-surface rounded-lg shadow-md hover:shadow-lg transition-all duration-200 border border-transparent hover:border-primary ${u===r.id?"opacity-30":""}`,children:n.jsxs("div",{className:"p-4",children:[n.jsxs("div",{className:"flex items-start justify-between",children:[n.jsxs("div",{className:"flex-1 min-w-0 mr-4",children:[n.jsxs("div",{className:"flex items-center mb-1",children:[n.jsx(te,{name:C,className:"w-5 h-5 mr-2 text-text-muted flex-shrink-0"}),n.jsx("h3",{className:"text-xl font-bold text-text break-words",children:r.name})]}),r.description&&n.jsx("div",{className:"prose prose-sm dark:prose-invert max-w-none text-text-muted mt-1 truncate",title:Sn(r.description),dangerouslySetInnerHTML:{__html:r.description}})]}),n.jsxs("div",{ref:$,className:"relative flex-shrink-0 -mr-2",children:[n.jsx(ce,{variant:"ghost",className:"p-2 h-auto",onClick:B=>{B.preventDefault(),B.stopPropagation(),R(z=>!z)},"aria-label":`More options for deck ${r.name}`,children:n.jsx(te,{name:"more-vertical",className:"w-5 h-5"})}),M&&n.jsxs("div",{className:"absolute right-0 mt-2 w-48 bg-surface rounded-md shadow-lg py-1 z-10 ring-1 ring-black ring-opacity-5 animate-fade-in",style:{animationDuration:"150ms"},children:[n.jsxs("button",{onClick:B=>{B.preventDefault(),o({...r,archived:!0},{toastMessage:`Deck "${r.name}" archived.`}),R(!1)},className:"flex items-center w-full px-4 py-2 text-sm text-left text-text hover:bg-border/20",children:[n.jsx(te,{name:"archive",className:"w-4 h-4 mr-3"})," Archive"]}),n.jsxs("button",{onClick:B=>{B.preventDefault(),m(r.id),R(!1)},className:"flex items-center w-full px-4 py-2 text-sm text-left text-red-600 dark:text-red-400 hover:bg-red-50 dark:hover:bg-red-900/20",children:[n.jsx(te,{name:"trash-2",className:"w-4 h-4 mr-3"})," Move to Trash"]})]})]})]}),S>0&&n.jsx("div",{className:"mt-3",children:n.jsx(gs,{level:K})}),n.jsxs("div",{className:"mt-4 pt-4 border-t border-border/50 flex justify-between items-center",children:[n.jsxs("div",{className:"text-sm text-text-muted",children:[S," ",O]}),J?n.jsxs("div",{className:"flex items-center gap-2",children:[n.jsx(tn,{size:"sm"}),n.jsx("span",{className:"text-sm font-semibold text-text-muted",children:X.statusText||"Generating..."})]}):n.jsxs(ce,{variant:H&&b?"primary":"secondary",size:"sm",onClick:W,disabled:r.locked||S===0&&!H,children:[n.jsx(te,{name:r.locked?"lock":H?"zap":"laptop",className:"w-4 h-4 mr-2"}),q]})]})]})})},Mv=r=>{var D;const{series:g,sessionsToResume:l,onUpdateLastOpened:u,onUpdateDeck:f,onDeleteDeck:i,openConfirmModal:o,handleGenerateQuestionsForDeck:m,handleGenerateContentForLearningDeck:x}=r,{decks:d,aiGenerationStatus:j}=et(),{aiFeaturesEnabled:y}=sa();Hr.useEffect(()=>{u(g.id)},[g.id,u]);const _=Hr.useMemo(()=>{const w=new Set((g.levels||[]).flatMap(S=>(S==null?void 0:S.deckIds)||[]));return d.filter(S=>w.has(S.id)).some(S=>{var O;return(S.type===Ce.Quiz||S.type===Ce.Learning)&&(((O=S.questions)==null?void 0:O.length)||0)===0})},[g.levels,d]),b=((D=j.currentTask)==null?void 0:D.seriesId)===g.id;return n.jsxs("div",{className:"max-w-4xl mx-auto animate-fade-in space-y-8",children:[n.jsxs("div",{className:"bg-surface rounded-lg shadow-md p-6 border border-border",children:[n.jsx("h2",{className:"text-3xl font-bold mb-2 text-text break-words",children:g.name}),g.description&&n.jsx(mx,{html:g.description,className:"text-text-muted prose dark:prose-invert max-w-none"}),n.jsxs("div",{className:"flex items-center gap-2 mt-4 flex-wrap",children:[n.jsxs(ce,{variant:"ghost",onClick:()=>r.onExportSeries(g),children:[n.jsx(te,{name:"download",className:"mr-2"})," Export"]}),n.jsxs(ce,{variant:"ghost",onClick:()=>r.onDeleteSeries(g.id),children:[n.jsx(te,{name:"trash-2",className:"mr-2"})," Move to Trash"]}),y&&_&&n.jsxs(ce,{variant:"secondary",onClick:()=>r.handleGenerateQuestionsForEmptyDecksInSeries(g.id),disabled:b,children:[b?n.jsx("span",{className:"mr-2",children:n.jsx(tn,{size:"sm"})}):n.jsx(te,{name:"zap",className:"w-4 h-4 mr-2"}),b?"Generating...":"Generate All Questions"]})]})]}),n.jsx("div",{className:"space-y-8",children:(g.levels||[]).map((w,N)=>n.jsxs("div",{children:[n.jsx("h3",{className:"text-2xl font-semibold text-text mb-4 border-b border-border pb-2",children:w.title}),n.jsx("div",{className:"space-y-4",children:w.deckIds.map(S=>{const O=d.find(C=>C.id===S);return O?n.jsx(Qo,{deck:O,sessionsToResume:l,onUpdateLastOpened:()=>u(g.id),draggedDeckId:null,onDragStart:()=>{},onDragEnd:()=>{},onUpdateDeck:f,onDeleteDeck:i,openConfirmModal:o,handleGenerateQuestionsForDeck:m,handleGenerateContentForLearningDeck:x},O.id):n.jsxs("div",{className:"p-4 bg-red-100 text-red-800 rounded-md",children:['Deck with ID "',S,'" not found.']},S)})})]},N))})]})},Uv=({onUpdateDeck:r,onUpdateSeries:g,onDeleteDeck:l,onDeleteSeries:u,openConfirmModal:f})=>{const{decks:i,deckSeries:o}=et(),m=U.useMemo(()=>i.filter(b=>b.archived&&!b.deletedAt),[i]),x=U.useMemo(()=>o.filter(b=>b.archived&&!b.deletedAt),[o]),d=b=>{r({...b,archived:!1})},j=b=>{g({...b,archived:!1})},y=b=>{f({title:"Move Deck to Trash",message:`Are you sure you want to move the archived deck "${b.name}" to the trash? This will un-archive it and place it in the trash for 10 days, after which it will be permanently deleted.`,onConfirm:()=>l(b.id)})},_=b=>{f({title:"Move Series to Trash",message:`Are you sure you want to move the archived series "${b.name}" to the trash? It will be un-archived and placed in the trash for 10 days. Decks within the series will NOT be deleted.`,onConfirm:()=>u(b.id)})};return n.jsxs("div",{className:"max-w-4xl mx-auto animate-fade-in space-y-8",children:[n.jsx("h1",{className:"text-3xl font-bold mb-6 text-text border-b border-border pb-4",children:"Archive"}),n.jsxs("section",{children:[n.jsx("h2",{className:"text-2xl font-semibold text-text mb-4",children:"Archived Series"}),x.length>0?n.jsx("div",{className:"bg-surface rounded-lg shadow-md divide-y divide-border",children:x.map(b=>n.jsxs("div",{className:"p-4 flex justify-between items-center",children:[n.jsxs("div",{className:"flex items-center min-w-0",children:[n.jsx(te,{name:"list",className:"w-6 h-6 mr-4 text-purple-500 dark:text-purple-400 flex-shrink-0"}),n.jsxs("div",{className:"min-w-0",children:[n.jsx("p",{className:"font-semibold truncate text-text",children:b.name}),n.jsx("div",{className:"prose prose-sm dark:prose-invert max-w-none text-text-muted truncate",title:Sn(b.description),dangerouslySetInnerHTML:{__html:b.description}})]})]}),n.jsxs("div",{className:"flex-shrink-0 flex items-center gap-2",children:[n.jsxs(ce,{variant:"secondary",size:"sm",onClick:()=>j(b),children:[n.jsx(te,{name:"unarchive",className:"w-4 h-4 mr-2"}),"Unarchive"]}),n.jsxs(ce,{variant:"danger",size:"sm",onClick:()=>_(b),children:[n.jsx(te,{name:"trash-2",className:"w-4 h-4 mr-2"}),"Move to Trash"]})]})]},b.id))}):n.jsxs("div",{className:"text-center py-10 bg-surface rounded-lg border border-border",children:[n.jsx(te,{name:"archive",className:"w-12 h-12 mx-auto text-text-muted/50"}),n.jsx("h3",{className:"mt-2 text-xl font-medium text-text",children:"No Archived Series"}),n.jsx("p",{className:"mt-1 text-sm text-text-muted",children:"You can archive series from their page to hide them from the main list."})]})]}),n.jsxs("section",{children:[n.jsx("h2",{className:"text-2xl font-semibold text-text mb-4",children:"Archived Decks"}),m.length>0?n.jsx("div",{className:"bg-surface rounded-lg shadow-md divide-y divide-border",children:m.map(b=>n.jsxs("div",{className:"p-4 flex justify-between items-center",children:[n.jsxs("div",{className:"flex items-center min-w-0",children:[n.jsx(te,{name:b.type==="quiz"?"help-circle":"laptop",className:"w-6 h-6 mr-4 text-text-muted flex-shrink-0"}),n.jsxs("div",{className:"min-w-0",children:[n.jsx("p",{className:"font-semibold truncate text-text",children:b.name}),n.jsx("div",{className:"prose prose-sm dark:prose-invert max-w-none text-text-muted truncate",title:Sn(b.description),dangerouslySetInnerHTML:{__html:b.description}})]})]}),n.jsxs("div",{className:"flex-shrink-0 flex items-center gap-2",children:[n.jsxs(ce,{variant:"secondary",size:"sm",onClick:()=>d(b),children:[n.jsx(te,{name:"unarchive",className:"w-4 h-4 mr-2"}),"Unarchive"]}),n.jsxs(ce,{variant:"danger",size:"sm",onClick:()=>y(b),children:[n.jsx(te,{name:"trash-2",className:"w-4 h-4 mr-2"}),"Move to Trash"]})]})]},b.id))}):n.jsxs("div",{className:"text-center py-10 bg-surface rounded-lg border border-border",children:[n.jsx(te,{name:"archive",className:"w-12 h-12 mx-auto text-text-muted/50"}),n.jsx("h3",{className:"mt-2 text-xl font-medium text-text",children:"No Archived Decks"}),n.jsx("p",{className:"mt-1 text-sm text-text-muted",children:"You can archive decks from their page to hide them from the main list."})]})]})]})},zo=10,wg=r=>{const g=new Date(r),f=(new Date().getTime()-g.getTime())/(1e3*60*60*24);return Math.max(0,Math.ceil(zo-f))},zv=({onRestoreDeck:r,onRestoreSeries:g,onDeleteDeckPermanently:l,onDeleteSeriesPermanently:u,openConfirmModal:f})=>{const{decks:i,deckSeries:o}=et(),m=U.useMemo(()=>i.filter(y=>y.deletedAt),[i]),x=U.useMemo(()=>o.filter(y=>y.deletedAt),[o]),d=y=>{f({title:"Permanently Delete Deck",message:`Are you sure you want to permanently delete the deck "${y.name}"? This action cannot be undone.`,onConfirm:()=>l(y.id)})},j=y=>{const _=(y.levels||[]).reduce((b,D)=>{var w;return b+(((w=D==null?void 0:D.deckIds)==null?void 0:w.length)||0)},0);f({title:"Permanently Delete Series",message:`Are you sure you want to permanently delete the series "${y.name}"? All ${_} deck(s) inside it will also be permanently deleted. This action cannot be undone.`,onConfirm:()=>u(y.id)})};return n.jsxs("div",{className:"max-w-4xl mx-auto animate-fade-in space-y-8",children:[n.jsxs("div",{className:"border-b border-border pb-4",children:[n.jsx("h1",{className:"text-3xl font-bold text-text",children:"Trash"}),n.jsxs("p",{className:"mt-2 text-text-muted",children:["Items in the trash will be permanently deleted after ",zo," days."]})]}),n.jsxs("section",{children:[n.jsx("h2",{className:"text-2xl font-semibold text-text mb-4",children:"Trashed Series"}),x.length>0?n.jsx("div",{className:"bg-surface rounded-lg shadow-md divide-y divide-border",children:x.map(y=>{const _=wg(y.deletedAt);return n.jsxs("div",{className:"p-4 flex justify-between items-center",children:[n.jsxs("div",{className:"flex items-center min-w-0",children:[n.jsx(te,{name:"list",className:"w-6 h-6 mr-4 text-purple-500 dark:text-purple-400 flex-shrink-0"}),n.jsxs("div",{className:"min-w-0",children:[n.jsx("p",{className:"font-semibold truncate text-text",children:y.name}),n.jsx("p",{className:`text-sm ${_<=2?"text-red-500":"text-text-muted"}`,children:_>0?`${_} days left`:"Deleting soon..."})]})]}),n.jsxs("div",{className:"flex-shrink-0 flex items-center gap-2",children:[n.jsxs(ce,{variant:"secondary",size:"sm",onClick:()=>g(y.id),children:[n.jsx(te,{name:"unarchive",className:"w-4 h-4 mr-2"}),"Restore"]}),n.jsxs(ce,{variant:"danger",size:"sm",onClick:()=>j(y),children:[n.jsx(te,{name:"trash-2",className:"w-4 h-4 mr-2"}),"Delete Now"]})]})]},y.id)})}):n.jsxs("div",{className:"text-center py-10 bg-surface rounded-lg border border-border",children:[n.jsx(te,{name:"trash-2",className:"w-12 h-12 mx-auto text-text-muted/50"}),n.jsx("h3",{className:"mt-2 text-xl font-medium text-text",children:"Trash is Empty"}),n.jsxs("p",{className:"mt-1 text-sm text-text-muted",children:["Deleted series will appear here for ",zo," days."]})]})]}),n.jsxs("section",{children:[n.jsx("h2",{className:"text-2xl font-semibold text-text mb-4",children:"Trashed Decks"}),m.length>0?n.jsx("div",{className:"bg-surface rounded-lg shadow-md divide-y divide-border",children:m.map(y=>{const _=wg(y.deletedAt);return n.jsxs("div",{className:"p-4 flex justify-between items-center",children:[n.jsxs("div",{className:"flex items-center min-w-0",children:[n.jsx(te,{name:y.type==="quiz"?"help-circle":"laptop",className:"w-6 h-6 mr-4 text-text-muted flex-shrink-0"}),n.jsxs("div",{className:"min-w-0",children:[n.jsx("p",{className:"font-semibold truncate text-text",children:y.name}),n.jsx("p",{className:`text-sm ${_<=2?"text-red-500":"text-text-muted"}`,children:_>0?`${_} days left`:"Deleting soon..."})]})]}),n.jsxs("div",{className:"flex-shrink-0 flex items-center gap-2",children:[n.jsxs(ce,{variant:"secondary",size:"sm",onClick:()=>r(y.id),children:[n.jsx(te,{name:"unarchive",className:"w-4 h-4 mr-2"}),"Restore"]}),n.jsxs(ce,{variant:"danger",size:"sm",onClick:()=>d(y),children:[n.jsx(te,{name:"trash-2",className:"w-4 h-4 mr-2"}),"Delete Now"]})]})]},y.id)})}):n.jsxs("div",{className:"text-center py-10 bg-surface rounded-lg border border-border",children:[n.jsx(te,{name:"trash-2",className:"w-12 h-12 mx-auto text-text-muted/50"}),n.jsx("h3",{className:"mt-2 text-xl font-medium text-text",children:"Trash is Empty"}),n.jsxs("p",{className:"mt-1 text-sm text-text-muted",children:["Deleted decks will appear here for ",zo," days."]})]})]})]})},px=({series:r,completedCount:g,dueCount:l,onStartSeriesStudy:u,masteryLevel:f,nextUpDeckId:i,onGenerateAllQuestions:o})=>{var b;const{aiGenerationStatus:m,decks:x}=et(),d=(r.levels||[]).reduce((D,w)=>{var N;return D+(((N=w==null?void 0:w.deckIds)==null?void 0:N.length)||0)},0),j=g>=d&&d>0,y=((b=m.currentTask)==null?void 0:b.seriesId)===r.id,_=U.useMemo(()=>{const D=new Set((r.levels||[]).flatMap(N=>(N==null?void 0:N.deckIds)||[]));return x.filter(N=>D.has(N.id)).some(N=>{var S;return(N.type===Ce.Quiz||N.type===Ce.Learning)&&(((S=N.questions)==null?void 0:S.length)||0)===0})},[r.levels,x]);return n.jsx(Gt,{href:`/series/${r.id}`,className:"block bg-surface rounded-lg shadow-md hover:shadow-lg transition-all duration-200 border border-transparent hover:border-primary",children:n.jsxs("div",{className:"p-4",children:[n.jsxs("div",{className:"flex items-start justify-between",children:[n.jsxs("div",{className:"flex-1 min-w-0 mr-4",children:[n.jsxs("div",{className:"flex items-center mb-1",children:[n.jsx(te,{name:"layers",className:"w-5 h-5 mr-2 text-purple-500 dark:text-purple-400"}),n.jsx("h3",{className:"text-xl font-bold text-text break-words",children:r.name})]}),r.description&&n.jsx("div",{className:"prose prose-sm dark:prose-invert max-w-none text-text-muted mt-1 truncate",title:Sn(r.description),dangerouslySetInnerHTML:{__html:r.description}})]}),j&&n.jsxs("div",{className:"flex-shrink-0 flex items-center gap-2 text-green-500 dark:text-green-400 bg-green-100 dark:bg-green-900/50 px-3 py-1 rounded-full",children:[n.jsx(te,{name:"check-circle",className:"w-4 h-4"}),n.jsx("span",{className:"text-sm font-semibold",children:"Completed"})]})]}),d>0&&n.jsxs("div",{className:"mt-3 space-y-3",children:[n.jsxs("div",{children:[n.jsxs("div",{className:"flex justify-between items-center text-sm mb-1",children:[n.jsx("span",{className:"font-medium text-text-muted",children:"Completion"}),n.jsxs("span",{className:"font-semibold text-text-muted",children:[g," / ",d]})]}),n.jsx(lx,{current:g,total:d})]}),n.jsx("div",{children:n.jsx(gs,{level:f})})]}),n.jsx("div",{className:"mt-4 pt-4 border-t border-border/50 flex justify-end gap-2",children:y?n.jsxs("div",{className:"flex items-center text-text-muted",children:[n.jsx(tn,{size:"sm"}),n.jsx("span",{className:"ml-2 text-sm font-semibold",children:"Generating..."})]}):n.jsxs(n.Fragment,{children:[i&&n.jsxs(Gt,{href:`/decks/${i}/study?seriesId=${r.id}`,passAs:ce,variant:"primary",size:"sm",onClick:D=>{D.stopPropagation()},children:[n.jsx(te,{name:"laptop",className:"w-4 h-4 mr-2"}),"Continue"]}),_&&l===0&&!i&&o&&n.jsxs(ce,{variant:"secondary",size:"sm",onClick:D=>{D.preventDefault(),D.stopPropagation(),o(r.id)},children:[n.jsx(te,{name:"zap",className:"w-4 h-4 mr-2"}),"Generate Questions"]}),n.jsxs(ce,{variant:"secondary",size:"sm",onClick:D=>{D.preventDefault(),D.stopPropagation(),u(r.id)},disabled:l===0,children:[n.jsx(te,{name:"zap",className:"w-4 h-4 mr-2"}),"Study Due (",l,")"]})]})})]})})},Lv=({totalDueQuestions:r,onStartGeneralStudy:g,sessionsToResume:l,onUpdateLastOpened:u,onUpdateDeck:f,onDeleteDeck:i,openConfirmModal:o,seriesProgress:m,onStartSeriesStudy:x,handleGenerateQuestionsForDeck:d,handleGenerateContentForLearningDeck:j,handleGenerateQuestionsForEmptyDecksInSeries:y,onGenerateAI:_})=>{const{decks:b,deckSeries:D}=et(),{aiFeaturesEnabled:w}=sa(),{recentDecks:N,recentSeries:S,seriesData:O}=U.useMemo(()=>{const M=new Set;D.forEach(H=>{(H.levels||[]).filter(Boolean).forEach(K=>(K.deckIds||[]).forEach(q=>M.add(q)))});const R=b.filter(H=>!H.archived&&!H.deletedAt&&!M.has(H.id)),X=[...D.filter(H=>!H.archived&&!H.deletedAt)].sort((H,K)=>{const q=(H.levels||[]).filter(Boolean).flatMap(z=>z.deckIds||[]).map(z=>b.find(Q=>Q.id===z)).filter(Boolean),W=(K.levels||[]).filter(Boolean).flatMap(z=>z.deckIds||[]).map(z=>b.find(Q=>Q.id===z)).filter(Boolean),A=Math.max(new Date(H.lastOpened||H.createdAt||0).getTime(),...q.map(z=>new Date(z.lastOpened||0).getTime()));return Math.max(new Date(K.lastOpened||K.createdAt||0).getTime(),...W.map(z=>new Date(z.lastOpened||0).getTime()))-A}).slice(0,2),J=[...R].sort((H,K)=>(K.lastOpened||"").localeCompare(H.lastOpened||"")).slice(0,2),Y=new Map;return D.forEach(H=>{var ue;const K=(H.levels||[]).filter(Boolean).flatMap(ee=>ee.deckIds||[]).map(ee=>b.find(V=>V.id===ee)).filter(Boolean),q=((ue=m.get(H.id))==null?void 0:ue.size)||0,W=new Set;(H.levels||[]).filter(Boolean).flatMap(ee=>ee.deckIds||[]).forEach((ee,V)=>{V<=q&&W.add(ee)});const B=K.reduce((ee,V)=>W.has(V.id)?ee+Da(V):ee,0),z=K.flatMap(ee=>ee.type===Ce.Flashcard?ee.cards||[]:ee.questions||[]).filter(ee=>!ee.suspended),Q=z.length>0?z.reduce((ee,V)=>ee+Rn(V),0)/z.length:0;Y.set(H.id,{dueCount:B,mastery:Q})}),{recentDecks:J,recentSeries:X,seriesData:Y}},[b,D,m]),C=r>0||w&&_;return n.jsxs("div",{className:"space-y-12",children:[C&&n.jsxs("div",{className:"mb-6 flex flex-wrap items-center gap-4",children:[r>0&&n.jsxs(ce,{onClick:g,variant:"primary",className:"w-full sm:w-auto text-lg py-3",children:[n.jsx(te,{name:"zap",className:"w-5 h-5 mr-2"}),"Study All Due Items (",r,")"]}),w&&_&&n.jsxs(ce,{onClick:_,variant:"secondary",className:"w-full sm:w-auto text-lg py-3",children:[n.jsx(te,{name:"bot",className:"w-5 h-5 mr-2"}),"Generate with AI"]})]}),S.length>0&&n.jsxs("section",{children:[n.jsxs("div",{className:"flex justify-between items-center mb-4",children:[n.jsx("h2",{className:"text-3xl font-bold text-gray-900 dark:text-gray-100",children:"Recent Series"}),n.jsxs(Gt,{href:"/series",passAs:ce,variant:"ghost",children:["View all ",n.jsx(te,{name:"chevron-left",className:"w-4 h-4 ml-2 rotate-180"})]})]}),n.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:S.map(M=>{var Y;const R=O.get(M.id)||{dueCount:0,mastery:0},$=m.get(M.id)||new Set,J=(M.levels||[]).filter(Boolean).flatMap(H=>H.deckIds||[]).find(H=>!$.has(H))||null;return n.jsx(px,{series:M,completedCount:((Y=m.get(M.id))==null?void 0:Y.size)||0,dueCount:R.dueCount,masteryLevel:R.mastery,onStartSeriesStudy:x,nextUpDeckId:J,onGenerateAllQuestions:y},M.id)})})]}),N.length>0&&n.jsxs("section",{children:[n.jsxs("div",{className:"flex justify-between items-center mb-4",children:[n.jsx("h2",{className:"text-3xl font-bold text-gray-900 dark:text-gray-100",children:"Recent Decks"}),n.jsxs(Gt,{href:"/decks",passAs:ce,variant:"ghost",children:["View all ",n.jsx(te,{name:"chevron-left",className:"w-4 h-4 ml-2 rotate-180"})]})]}),n.jsx("div",{className:"space-y-4",children:N.map(M=>n.jsx(Qo,{deck:M,sessionsToResume:l,onUpdateLastOpened:u,draggedDeckId:null,onDragStart:()=>{},onDragEnd:()=>{},onUpdateDeck:f,onDeleteDeck:i,openConfirmModal:o,handleGenerateQuestionsForDeck:d,handleGenerateContentForLearningDeck:j},M.id))})]})]})},Bv=({folder:r,decks:g,isOpen:l,onToggle:u,sessionsToResume:f,onUpdateLastOpened:i,onDeleteFolder:o,draggedDeckId:m,onDragStart:x,onDragEnd:d,onMoveDeck:j,onUpdateDeck:y,onDeleteDeck:_,openConfirmModal:b,onSaveFolder:D,onGenerateQuestionsForDeck:w,onGenerateContentForLearningDeck:N})=>{const[S,O]=U.useState(!1),[C,M]=U.useState(!1),[R,$]=U.useState(r.name),X=U.useRef(null),{addToast:J}=Mt();U.useEffect(()=>{C&&X.current&&(X.current.focus(),X.current.select())},[C]);const Y=B=>{B.stopPropagation(),$(r.name),M(!0)},H=B=>{B.stopPropagation(),M(!1)},K=B=>{if(B==null||B.stopPropagation(),R.trim()===""){J("Folder name cannot be empty.","error");return}D({id:r.id,name:R.trim()}),M(!1)},q=B=>{B.preventDefault(),B.stopPropagation();const z=B.dataTransfer.getData("text/plain");z&&z===m&&(j(z,r.id),d()),O(!1)},W=B=>{B.preventDefault(),B.dataTransfer.dropEffect="move",O(!0)},A=()=>{O(!1)};return n.jsxs("div",{className:`rounded-lg transition-all duration-200 ${S?"bg-primary/20 ring-2 ring-primary ring-inset":"bg-surface border border-border"}`,onDrop:q,onDragOver:W,onDragLeave:A,children:[n.jsx("div",{className:"border-b border-border",children:n.jsxs("div",{onClick:C?void 0:u,className:"w-full flex justify-between items-center text-left p-4 cursor-pointer","aria-expanded":l,children:[n.jsxs("div",{className:"flex items-center flex-grow min-w-0",children:[n.jsx(te,{name:"chevron-down",className:`w-5 h-5 transition-transform duration-300 mr-3 ${l?"":"-rotate-90"} text-text-muted`}),C?n.jsxs("div",{className:"flex items-center flex-grow gap-2 min-w-0",onClick:B=>B.stopPropagation(),children:[n.jsx(te,{name:"folder",className:"w-6 h-6 text-yellow-600 dark:text-yellow-500 flex-shrink-0"}),n.jsx("input",{ref:X,type:"text",value:R,onChange:B=>$(B.target.value),onKeyDown:B=>{B.key==="Enter"&&K(B),B.key==="Escape"&&H(B)},className:"text-xl font-bold p-1 bg-background rounded-md w-full"})]}):n.jsxs(n.Fragment,{children:[n.jsx(te,{name:"folder",className:"w-6 h-6 mr-3 text-yellow-600 dark:text-yellow-500"}),n.jsx("h3",{className:"text-xl font-bold text-text truncate",children:r.name})]})]}),n.jsx("div",{className:"flex items-center gap-1 flex-shrink-0",children:C?n.jsxs(n.Fragment,{children:[n.jsx(ce,{variant:"primary",size:"sm",onClick:K,"aria-label":`Save changes for folder ${r.name}`,children:"Save"}),n.jsx(ce,{variant:"secondary",size:"sm",onClick:H,"aria-label":"Cancel editing",children:"Cancel"})]}):n.jsxs(n.Fragment,{children:[n.jsx(ce,{variant:"ghost",className:"p-2 h-auto",onClick:Y,"aria-label":`Edit folder ${r.name}`,children:n.jsx(te,{name:"edit",className:"w-4 h-4"})}),n.jsx(ce,{variant:"ghost",className:"p-2 h-auto hover:text-red-500",onClick:B=>{B.stopPropagation(),o(r.id)},"aria-label":`Delete folder ${r.name}`,children:n.jsx(te,{name:"trash-2",className:"w-4 h-4"})})]})})]})}),l&&n.jsx("div",{className:"p-4 space-y-4",children:g.length>0?g.map(B=>n.jsx(Qo,{deck:B,sessionsToResume:f,onUpdateLastOpened:i,draggedDeckId:m,onDragStart:x,onDragEnd:d,onUpdateDeck:y,onDeleteDeck:_,openConfirmModal:b,handleGenerateQuestionsForDeck:w,handleGenerateContentForLearningDeck:N},B.id)):n.jsxs("div",{className:"flex flex-col items-center justify-center p-6 border-2 border-dashed border-border rounded-md m-4 text-center",children:[n.jsx(te,{name:"grip-vertical",className:"w-8 h-8 text-text-muted mb-2"}),n.jsx("p",{className:"text-sm font-medium text-text-muted",children:"Drag a deck here to organize it!"})]})})]})},Fv=({decks:r,folders:g,sessionsToResume:l,onUpdateLastOpened:u,onDeleteFolder:f,draggedDeckId:i,onDragStart:o,onDragEnd:m,onMoveDeck:x,openFolderIds:d,onToggleFolder:j,onUpdateDeck:y,onDeleteDeck:_,openConfirmModal:b,onSaveFolder:D,onGenerateQuestionsForDeck:w,onGenerateContentForLearningDeck:N})=>{const{decksByFolder:S,ungroupedDecks:O}=U.useMemo(()=>{const X=new Map,J=[];return r.forEach(Y=>{Y.folderId&&g.some(H=>H.id===Y.folderId)?(X.has(Y.folderId)||X.set(Y.folderId,[]),X.get(Y.folderId).push(Y)):J.push(Y)}),{decksByFolder:X,ungroupedDecks:J}},[r,g]),[C,M]=U.useState(!1),R=X=>{X.preventDefault();const J=X.dataTransfer.getData("text/plain");J&&J===i&&(x(J,null),m()),M(!1)},$=X=>{X.preventDefault(),X.dataTransfer.dropEffect="move",M(!0)};return n.jsxs("div",{className:"space-y-4",children:[g.map(X=>n.jsx(Bv,{folder:X,decks:S.get(X.id)||[],isOpen:d.has(X.id),onToggle:()=>j(X.id),sessionsToResume:l,onUpdateLastOpened:u,onDeleteFolder:f,draggedDeckId:i,onDragStart:o,onDragEnd:m,onMoveDeck:x,onUpdateDeck:y,onDeleteDeck:_,openConfirmModal:b,onSaveFolder:D,onGenerateQuestionsForDeck:w,onGenerateContentForLearningDeck:N},X.id)),n.jsx("div",{onDrop:R,onDragOver:$,onDragLeave:()=>M(!1),className:`p-2 -m-2 rounded-lg transition-all duration-200 ${C?"bg-primary/20 ring-2 ring-primary ring-inset":""}`,children:n.jsx("div",{className:"space-y-4",children:O.map(X=>n.jsx(Qo,{deck:X,sessionsToResume:l,onUpdateLastOpened:u,draggedDeckId:i,onDragStart:o,onDragEnd:m,onUpdateDeck:y,onDeleteDeck:_,openConfirmModal:b,handleGenerateQuestionsForDeck:w,handleGenerateContentForLearningDeck:N},X.id))})})]})},qv=[{key:"lastOpened",label:"Recent"},{key:"name",label:"Name"},{key:"dueCount",label:"Due"}],_d=({currentSort:r,onSortChange:g,sortOptions:l})=>{const u=l??qv;return n.jsx("div",{className:"inline-flex rounded-md shadow-sm bg-gray-100 dark:bg-gray-800 p-1",role:"group",children:u&&u.map((f,i)=>n.jsx("button",{type:"button",onClick:()=>g(f.key),className:`px-4 py-1.5 text-sm font-medium transition-colors focus:z-10 focus:outline-none focus:ring-2 focus:ring-blue-500
            ${r===f.key?"bg-white dark:bg-gray-700 text-blue-600 dark:text-blue-300 shadow-sm":"text-gray-600 dark:text-gray-400 hover:bg-gray-200/50 dark:hover:bg-gray-700/50"}
            ${i===0?"rounded-l-md":""}
            ${i===u.length-1?"rounded-r-md":""}
          `,"aria-pressed":r===f.key,children:f.label},f.key))})},Hv=r=>{const[g,l]=U.useState(""),u=et(x=>x.folders),f=rx(),i=U.useMemo(()=>{const x=g.toLowerCase().trim();if(!x){const y=[...f];switch(r.sortPreference){case"name":return y.sort((_,b)=>_.name.localeCompare(b.name));case"dueCount":return y.sort((_,b)=>Da(b)-Da(_));case"lastOpened":default:return y.sort((_,b)=>(b.lastOpened||"").localeCompare(_.lastOpened||""))}}const d=x.split(/\s+/).filter(Boolean),j=f.map(y=>{let _=0;const b=y.name.toLowerCase(),D=Sn(y.description).toLowerCase();b.startsWith(x)?_+=20:b.includes(x)&&(_+=10),D.includes(x)&&(_+=2);for(const S of d)b.includes(S)&&(_+=5),D.includes(S)&&(_+=1);const w=(y.type===Ce.Flashcard?y.cards:(y.type===Ce.Learning,y.questions))||[];let N=0;if(w)for(const S of w){let O;if(y.type===Ce.Flashcard){const C=S;O=Sn(`${C.front} ${C.back}`).toLowerCase()}else{const C=S,M=(C.options||[]).map(R=>R.text).join(" ");O=Sn(`${C.questionText} ${M} ${C.detailedExplanation}`).toLowerCase()}d.some(C=>O.includes(C))&&N++}return _+=Math.min(N,20)*.5,{deck:y,score:_}}).filter(({score:y})=>y>0);return j.sort((y,_)=>{if(y.score!==_.score)return _.score-y.score;switch(r.sortPreference){case"name":return y.deck.name.localeCompare(_.deck.name);case"dueCount":return Da(_.deck)-Da(y.deck);case"lastOpened":default:return(_.deck.lastOpened||"").localeCompare(y.deck.lastOpened||"")}}),j.map(({deck:y})=>y)},[f,g,r.sortPreference]),o=U.useMemo(()=>[...u].sort((x,d)=>x.name.localeCompare(d.name)),[u]);return f.length>0||u.length>0?n.jsxs("div",{className:"space-y-6",children:[n.jsxs("div",{className:"flex flex-col sm:flex-row justify-between items-center gap-4",children:[n.jsx("h1",{className:"text-3xl font-bold text-text",children:"All Decks"}),n.jsxs(ce,{variant:"primary",onClick:r.onImportDecks,children:[n.jsx(te,{name:"plus",className:"w-5 h-5 mr-2"}),"Create / Import Deck"]})]}),n.jsxs("div",{className:"flex flex-col md:flex-row justify-between items-center gap-4 p-4 bg-surface rounded-lg border border-border",children:[n.jsxs("div",{className:"relative w-full md:max-w-xs",children:[n.jsx(te,{name:"search",className:"absolute left-3 top-1/2 -translate-y-1/2 w-5 h-5 text-text-muted"}),n.jsx("input",{type:"text",placeholder:"Search decks...",value:g,onChange:x=>l(x.target.value),className:"w-full pl-10 pr-4 py-2 bg-background border border-border rounded-md focus:ring-2 focus:ring-primary focus:outline-none"})]}),n.jsxs("div",{className:"flex flex-wrap items-center justify-center gap-2",children:[n.jsxs(ce,{variant:"ghost",onClick:r.onNewFolder,children:[n.jsx(te,{name:"folder-plus",className:"w-5 h-5 mr-2"}),n.jsx("span",{className:"hidden sm:inline",children:"New Folder"})]}),n.jsx(_d,{currentSort:r.sortPreference,onSortChange:r.onSortChange})]})]}),i.length===0&&g?n.jsxs("div",{className:"text-center py-20",children:[n.jsx(te,{name:"search",className:"w-16 h-16 mx-auto text-text-muted/50"}),n.jsx("h2",{className:"mt-4 text-2xl font-bold text-text-muted",children:"No Decks Found"}),n.jsxs("p",{className:"mt-2 text-text-muted",children:['Your search for "',g,'" did not match any decks.']}),n.jsx(ce,{variant:"secondary",onClick:()=>l(""),className:"mt-6",children:"Clear Search"})]}):n.jsx(Fv,{decks:i,folders:o,sessionsToResume:r.sessionsToResume,onUpdateLastOpened:r.onUpdateLastOpened,onDeleteFolder:r.onDeleteFolder,draggedDeckId:r.draggedDeckId,onDragStart:r.onDragStart,onDragEnd:r.onDragEnd,onMoveDeck:r.onMoveDeck,openFolderIds:r.openFolderIds,onToggleFolder:r.onToggleFolder,onUpdateDeck:r.onUpdateDeck,onDeleteDeck:r.onDeleteDeck,openConfirmModal:r.openConfirmModal,onSaveFolder:r.handleSaveFolder,onGenerateQuestionsForDeck:r.handleGenerateQuestionsForDeck,onGenerateContentForLearningDeck:r.handleGenerateContentForLearningDeck})]}):n.jsxs("div",{className:"text-center py-20",children:[n.jsx(te,{name:"folder",className:"w-16 h-16 mx-auto text-gray-300 dark:text-gray-600"}),n.jsx("h2",{className:"mt-4 text-2xl font-bold text-text-muted",children:"Your deck collection is empty"}),n.jsx("p",{className:"mt-2 text-text-muted",children:"Create a new deck, import from a file, or try a sample deck to get started."}),n.jsxs("div",{className:"flex flex-col sm:flex-row items-center justify-center gap-4 mt-8",children:[n.jsxs(ce,{onClick:r.onImportDecks,children:[n.jsx(te,{name:"plus",className:"w-5 h-5 mr-2"}),"Create or Import Deck"]}),n.jsxs(ce,{onClick:r.onCreateSampleDeck,variant:"secondary",children:[n.jsx(te,{name:"laptop",className:"w-5 h-5 mr-2"}),"Create Sample Deck"]})]})]})},Gv=({onStartSeriesStudy:r,onCreateNewSeries:g,onCreateSampleSeries:l,onGenerateAI:u,handleGenerateQuestionsForEmptyDecksInSeries:f})=>{const{deckSeries:i,decks:o,seriesProgress:m}=et(),{aiFeaturesEnabled:x}=sa(),[d,j]=U.useState(""),[y,_]=U.useState("recent"),[b,D]=U.useState("all"),w=U.useMemo(()=>i.filter(M=>!M.archived&&!M.deletedAt),[i]),N=U.useMemo(()=>{const M=new Map;return w.forEach(R=>{var W;const $=(R.levels||[]).flatMap(A=>(A==null?void 0:A.deckIds)||[]).map(A=>o.find(B=>B.id===A)).filter(Boolean),X=((W=m.get(R.id))==null?void 0:W.size)||0,J=new Set;(R.levels||[]).flatMap(A=>(A==null?void 0:A.deckIds)||[]).forEach((A,B)=>{B<=X&&J.add(A)});const H=$.reduce((A,B)=>J.has(B.id)?A+Da(B):A,0),K=$.flatMap(A=>A.type===Ce.Flashcard?A.cards||[]:A.questions||[]).filter(A=>!A.suspended),q=K.length>0?K.reduce((A,B)=>A+Rn(B),0)/K.length:0;M.set(R.id,{dueCount:H,mastery:q})}),M},[w,o,m]),S=U.useMemo(()=>{let M=w.filter(R=>R.name.toLowerCase().includes(d.toLowerCase())||R.description.toLowerCase().includes(d.toLowerCase()));switch(b!=="all"&&(M=M.filter(R=>{var Y;const $=(R.levels||[]).reduce((H,K)=>{var q;return H+(((q=K==null?void 0:K.deckIds)==null?void 0:q.length)||0)},0);if($===0)return b==="inProgress";const J=(((Y=m.get(R.id))==null?void 0:Y.size)||0)>=$;return b==="completed"?J:!J})),y){case"recent":return M.sort((R,$)=>{const X=new Date(R.lastOpened||R.createdAt||0).getTime();return new Date($.lastOpened||$.createdAt||0).getTime()-X});case"progress":return M.sort((R,$)=>{var Y,H;const X=(((Y=m.get(R.id))==null?void 0:Y.size)||0)/((R.levels||[]).reduce((K,q)=>{var W;return K+(((W=q==null?void 0:q.deckIds)==null?void 0:W.length)||0)},0)||1);return(((H=m.get($.id))==null?void 0:H.size)||0)/(($.levels||[]).reduce((K,q)=>{var W;return K+(((W=q==null?void 0:q.deckIds)==null?void 0:W.length)||0)},0)||1)-X});case"mastery":return M.sort((R,$)=>{var Y,H;const X=((Y=N.get(R.id))==null?void 0:Y.mastery)||0;return(((H=N.get($.id))==null?void 0:H.mastery)||0)-X});case"name":default:return M.sort((R,$)=>R.name.localeCompare($.name))}},[w,d,y,b,m,N]),O=[{key:"recent",label:"Recent"},{key:"name",label:"Name"},{key:"progress",label:"Progress"},{key:"mastery",label:"Mastery"}],C=[{key:"all",label:"All"},{key:"inProgress",label:"In Progress"},{key:"completed",label:"Completed"}];return n.jsxs("div",{className:"space-y-6",children:[n.jsxs("div",{className:"flex flex-col sm:flex-row justify-between items-center gap-4",children:[n.jsx("h1",{className:"text-3xl font-bold text-text",children:"All Series"}),n.jsxs("div",{className:"flex gap-2",children:[x&&n.jsxs(ce,{variant:"primary",onClick:u,children:[n.jsx(te,{name:"zap",className:"w-5 h-5 mr-2"}),"Generate with AI"]}),n.jsxs(ce,{variant:"secondary",onClick:g,children:[n.jsx(te,{name:"layers",className:"w-5 h-5 mr-2"}),"Create New Series"]})]})]}),n.jsxs("div",{className:"flex flex-col md:flex-row justify-between items-center gap-4 p-4 bg-surface rounded-lg border border-border",children:[n.jsxs("div",{className:"relative w-full md:max-w-xs",children:[n.jsx(te,{name:"search",className:"absolute left-3 top-1/2 -translate-y-1/2 w-5 h-5 text-text-muted"}),n.jsx("input",{type:"text",placeholder:"Search series...",value:d,onChange:M=>j(M.target.value),className:"w-full pl-10 pr-4 py-2 bg-background border border-border rounded-md focus:ring-2 focus:ring-primary focus:outline-none"})]}),n.jsxs("div",{className:"flex flex-wrap items-center justify-center gap-4",children:[n.jsxs("div",{className:"flex items-center gap-2",children:[n.jsx(te,{name:"filter",className:"w-5 h-5 text-text-muted"}),n.jsx(_d,{currentSort:b,onSortChange:M=>D(M),sortOptions:C})]}),n.jsx(_d,{currentSort:y,onSortChange:M=>_(M),sortOptions:O})]})]}),S.length>0?n.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:S.map(M=>{const R=N.get(M.id)||{dueCount:0,mastery:0},$=m.get(M.id)||new Set,J=(M.levels||[]).flatMap(Y=>(Y==null?void 0:Y.deckIds)||[]).find(Y=>!$.has(Y))||null;return n.jsx(px,{series:M,completedCount:$.size,dueCount:R.dueCount,masteryLevel:R.mastery,onStartSeriesStudy:r,nextUpDeckId:J,onGenerateAllQuestions:f},M.id)})}):n.jsxs("div",{className:"text-center py-10",children:[n.jsx(te,{name:"layers",className:"w-12 h-12 mx-auto text-gray-300 dark:text-gray-600"}),n.jsx("h3",{className:"mt-2 text-xl font-medium text-text",children:d?"No series found":"Your series collection is empty"}),n.jsx("p",{className:"mt-1 text-sm text-text-muted",children:d?"Try adjusting your search or filter.":"Create a new series or try a sample to get started."}),!d&&w.length===0&&n.jsx("div",{className:"mt-6",children:n.jsxs(ce,{onClick:l,variant:"secondary",children:[n.jsx(te,{name:"zap",className:"w-4 h-4 mr-2"})," Create Sample Series"]})})]})]})},Sd=({icon:r,label:g,value:l})=>n.jsxs("div",{className:"bg-surface p-6 rounded-lg shadow-md border border-border flex items-center",children:[n.jsx("div",{className:"flex-shrink-0",children:r}),n.jsxs("div",{className:"ml-5 w-0 flex-1",children:[n.jsx("dt",{className:"text-sm font-medium text-text-muted truncate",children:g}),n.jsx("dd",{className:"text-2xl font-bold text-text",children:l})]})]}),Yv=({stats:r})=>n.jsxs("div",{className:"grid grid-cols-1 gap-5 sm:grid-cols-3",children:[n.jsx(Sd,{icon:n.jsx(te,{name:"zap",className:"h-8 w-8 text-orange-400"}),label:"Current Streak",value:`${r.streak} day${r.streak!==1?"s":""}`}),n.jsx(Sd,{icon:n.jsx(te,{name:"check-circle",className:"h-8 w-8 text-blue-400"}),label:"Total Reviews",value:r.totalReviews.toLocaleString()}),n.jsx(Sd,{icon:n.jsx(te,{name:"trending-up",className:"h-8 w-8 text-green-400"}),label:"Mature Items",value:r.matureCount.toLocaleString()})]}),Qv=({reviews:r})=>{const{grid:g,maxCount:l}=U.useMemo(()=>{const i=new Date;i.setHours(0,0,0,0);const o=new Date(i);o.setDate(o.getDate()+1);const m=new Date(o);m.setDate(m.getDate()-364-i.getDay());const x=new Map;r.forEach(_=>{const b=new Date(_.timestamp);b.setHours(0,0,0,0);const D=b.toISOString().split("T")[0];x.set(D,(x.get(D)||0)+1)});const d=Math.max(...Array.from(x.values()),1),j=[];let y=new Date(m);for(;j.length<371;){const _=y.toISOString().split("T")[0],b=x.get(_)||0;j.push({date:new Date(y),count:b}),y.setDate(y.getDate()+1)}return{grid:j,maxCount:d}},[r]),u=i=>{if(i===0)return"fill-gray-200 dark:fill-gray-700/50";const o=Math.min(i/(l*.75),1);return o>.8?"fill-green-600":o>.5?"fill-green-500":o>.2?"fill-green-400":"fill-green-300"},f=U.useMemo(()=>{var m;const i=[];let o=-1;for(let x=0;x<53;x++){const d=(m=g[x*7])==null?void 0:m.date;if(d){const j=d.getMonth();j!==o&&i.push({month:d.toLocaleString("default",{month:"short"}),col:x}),o=j}}return i},[g]);return n.jsx("div",{className:"overflow-x-auto",children:n.jsxs("svg",{width:"100%",viewBox:"0 0 848 128",children:[f.map(({month:i,col:o})=>n.jsx("text",{x:16*o+24,y:"15",className:"text-xs fill-text-muted",children:i},o)),n.jsx("text",{x:"0",y:"37",className:"text-xs fill-text-muted",children:"Mon"}),n.jsx("text",{x:"0",y:"69",className:"text-xs fill-text-muted",children:"Wed"}),n.jsx("text",{x:"0",y:"101",className:"text-xs fill-text-muted",children:"Fri"}),g.map((i,o)=>{if(!i)return null;const m=Math.floor(o/7),x=o%7;return n.jsx("rect",{x:16*m+24,y:16*x+24,width:"12",height:"12",rx:"2",ry:"2",className:u(i.count),children:n.jsx("title",{children:`${i.date.toDateString()}: ${i.count} review${i.count!==1?"s":""}`})},o)})]})})},$v=({items:r})=>{const g=U.useMemo(()=>{const d=new Date;d.setHours(0,0,0,0);const j=Array(30).fill(0);r.forEach(_=>{const b=new Date(_.dueDate);b.setHours(0,0,0,0);const D=b.getTime()-d.getTime();if(D>=0){const w=Math.floor(D/864e5);w<30&&j[w]++}});const y=Array.from({length:30},(_,b)=>{const D=new Date(d);return D.setDate(D.getDate()+b),b%7===0||b===0?D.toLocaleDateString("en-US",{month:"short",day:"numeric"}):""});return{counts:j,labels:y}},[r]),l=Math.max(...g.counts,1),u=350,f=180,i={top:25,right:10,bottom:25,left:10},o=u-i.left-i.right,m=f-i.top-i.bottom,x=o/g.counts.length-2;return n.jsx("div",{className:"w-full",children:n.jsxs("svg",{viewBox:`0 0 ${u} ${f}`,width:"100%",height:"auto","aria-labelledby":"forecast-graph-title",role:"img",className:"overflow-visible",children:[n.jsx("title",{id:"forecast-graph-title",children:"A bar chart showing the number of items due each day for the next 30 days."}),g.counts.map((d,j)=>{const y=d>0?d/l*m:0,_=i.left+j*(x+2),b=i.top+m-y;return n.jsxs("g",{className:"group cursor-pointer",children:[n.jsxs("title",{children:[g.labels[j]||new Date(new Date().setDate(new Date().getDate()+j)).toLocaleDateString(),": ",d," items"]}),n.jsx("rect",{x:_,y:b,width:x,height:y,rx:"2",className:"fill-primary/60 transition-colors group-hover:fill-primary"}),n.jsx("text",{x:_+x/2,y:b-6,textAnchor:"middle",className:"text-xs font-semibold fill-text-muted transition-opacity opacity-0 group-hover:opacity-100 pointer-events-none",children:d})]},j)}),g.labels.map((d,j)=>d?n.jsx("text",{x:i.left+j*(x+2)+x/2,y:f-i.bottom+15,textAnchor:"middle",className:"text-xs fill-text-muted",children:d},j):null)]})})},Pv=({reviews:r})=>{const g=U.useMemo(()=>{const u=new Date;u.setDate(u.getDate()-30);const f=r.filter(x=>x.rating!==null&&new Date(x.timestamp)>=u),i={[wt.Again]:0,[wt.Hard]:0,[wt.Good]:0,[wt.Easy]:0};let o=0;f.forEach(x=>{x.rating&&i.hasOwnProperty(x.rating)&&(i[x.rating]++,o++)});const m=x=>o>0?(x/o*100).toFixed(1):"0.0";return{total:o,again:{count:i[wt.Again],percent:m(i[wt.Again])},hard:{count:i[wt.Hard],percent:m(i[wt.Hard])},good:{count:i[wt.Good],percent:m(i[wt.Good])},easy:{count:i[wt.Easy],percent:m(i[wt.Easy])},correctPercent:m(i[wt.Hard]+i[wt.Good]+i[wt.Easy])}},[r]);if(g.total===0)return n.jsx("div",{className:"text-center py-10",children:n.jsx("p",{className:"text-text-muted",children:"Not enough data from the last 30 days."})});const l=[{label:"Again",percent:g.again.percent,color:"bg-red-500"},{label:"Hard",percent:g.hard.percent,color:"bg-orange-500"},{label:"Good",percent:g.good.percent,color:"bg-green-500"},{label:"Easy",percent:g.easy.percent,color:"bg-blue-500"}];return n.jsxs("div",{className:"space-y-6",children:[n.jsxs("div",{className:"text-center",children:[n.jsx("p",{className:"text-lg text-text-muted",children:"Reviews Marked Correct"}),n.jsxs("p",{className:"text-4xl font-bold text-green-500",children:[g.correctPercent,"%"]})]}),n.jsx("div",{className:"flex w-full h-4 rounded-full overflow-hidden",role:"progressbar",children:l.map(u=>u.percent!=="0.0"&&n.jsx("div",{className:u.color,style:{width:`${u.percent}%`},title:`${u.label}: ${u.percent}%`},u.label))}),n.jsxs("div",{className:"grid grid-cols-2 gap-x-4 gap-y-2 text-sm",children:[n.jsxs("div",{className:"flex items-center",children:[n.jsx("span",{className:"w-2.5 h-2.5 rounded-full bg-red-500 mr-2"}),n.jsxs("span",{className:"text-text-muted",children:["Again: ",n.jsx("strong",{children:g.again.count})," (",g.again.percent,"%)"]})]}),n.jsxs("div",{className:"flex items-center",children:[n.jsx("span",{className:"w-2.5 h-2.5 rounded-full bg-orange-500 mr-2"}),n.jsxs("span",{className:"text-text-muted",children:["Hard: ",n.jsx("strong",{children:g.hard.count})," (",g.hard.percent,"%)"]})]}),n.jsxs("div",{className:"flex items-center",children:[n.jsx("span",{className:"w-2.5 h-2.5 rounded-full bg-green-500 mr-2"}),n.jsxs("span",{className:"text-text-muted",children:["Good: ",n.jsx("strong",{children:g.good.count})," (",g.good.percent,"%)"]})]}),n.jsxs("div",{className:"flex items-center",children:[n.jsx("span",{className:"w-2.5 h-2.5 rounded-full bg-blue-500 mr-2"}),n.jsxs("span",{className:"text-text-muted",children:["Easy: ",n.jsx("strong",{children:g.easy.count})," (",g.easy.percent,"%)"]})]})]})]})},Jv=()=>{const[r,g]=U.useState([]),[l,u]=U.useState(!0),[f,i]=U.useState(null),o=et(d=>d.decks);U.useEffect(()=>{(async()=>{try{const j=new Date;j.setFullYear(j.getFullYear()-1);const y=await Bg(j);g(y)}catch(j){console.error("Failed to load review data:",j),i("Could not load your review data. Please try again later.")}finally{u(!1)}})()},[]);const m=U.useMemo(()=>{if(l)return null;let d=0;const j=r.map(D=>new Date(D.timestamp).setHours(0,0,0,0)),y=[...new Set(j)];if(y.sort((D,w)=>w-D),y.length>0){const D=new Date().setHours(0,0,0,0),w=new Date(D).setDate(new Date(D).getDate()-1);if(y[0]===D||y[0]===w){d=1;for(let N=1;N<y.length;N++){const S=y[N-1],O=y[N],C=new Date(S).setDate(new Date(S).getDate()-1);if(O===C)d++;else break}}}const b=o.reduce((D,w)=>w.type==="flashcard"?D.concat(w.cards||[]):D.concat(w.questions||[]),[]).filter(D=>(D.interval||0)>=21&&!D.suspended).length;return{streak:d,totalReviews:r.length,matureCount:b}},[r,o,l]),x=U.useMemo(()=>o.reduce((j,y)=>y.type==="flashcard"?j.concat(y.cards||[]):j.concat(y.questions||[]),[]).filter(j=>!j.suspended),[o]);return l?n.jsxs("div",{className:"flex items-center justify-center h-64",children:[n.jsx(tn,{size:"lg"}),n.jsx("p",{className:"ml-4 text-text-muted",children:"Calculating your progress..."})]}):f?n.jsx("div",{className:"text-center py-10",children:n.jsx("p",{className:"text-red-500",children:f})}):r.length===0?n.jsxs("div",{className:"text-center py-20",children:[n.jsx("h2",{className:"text-2xl font-bold text-text-muted",children:"No review history yet."}),n.jsx("p",{className:"mt-2 text-text-muted",children:"Complete a study session to start tracking your progress!"})]}):n.jsxs("div",{className:"max-w-5xl mx-auto animate-fade-in space-y-8",children:[n.jsx("h1",{className:"text-3xl font-bold text-text border-b border-border pb-4",children:"Your Progress"}),n.jsx(Yv,{stats:m}),n.jsxs("div",{className:"bg-surface p-6 rounded-lg shadow-md border border-border",children:[n.jsx("h2",{className:"text-xl font-semibold text-text mb-4",children:"Activity"}),n.jsx(Qv,{reviews:r})]}),n.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-8",children:[n.jsxs("div",{className:"bg-surface p-6 rounded-lg shadow-md border border-border",children:[n.jsx("h2",{className:"text-xl font-semibold text-text mb-4",children:"30-Day Forecast"}),n.jsx($v,{items:x})]}),n.jsxs("div",{className:"bg-surface p-6 rounded-lg shadow-md border border-border",children:[n.jsx("h2",{className:"text-xl font-semibold text-text mb-4",children:"Retention (Last 30 Days)"}),n.jsx(Pv,{reviews:r})]})]})]})},gx=U.createContext(null),xx=()=>{const r=U.useContext(gx);if(!r)throw new Error("useData must be used within a DataManagementProvider");return r},Vv=({children:r,value:g})=>n.jsx(gx.Provider,{value:g,children:r}),Sg=(r,g)=>r.length>g?r.substring(0,g)+"...":r,Kv=({items:r})=>{if(!r||r.length<=1)return null;const g=l=>n.jsxs(n.Fragment,{children:[n.jsx("span",{className:"sm:hidden",title:l,children:Sg(l,10)}),n.jsx("span",{className:"hidden sm:inline",title:l,children:Sg(l,25)})]});return n.jsx("nav",{"aria-label":"Breadcrumb",className:"mb-6",children:n.jsx("ol",{className:"flex items-center space-x-2 text-sm text-text-muted flex-wrap",children:r.map((l,u)=>{const f=u===r.length-1;return n.jsxs("li",{className:"flex items-center",children:[u>0&&n.jsx(te,{name:"chevron-left",className:"w-4 h-4 rotate-180 mx-2 flex-shrink-0"}),f?n.jsx("span",{className:"font-semibold text-text","aria-current":"page",children:g(l.label)}):n.jsx(Gt,{href:l.href,className:"hover:underline hover:text-primary",children:g(l.label)})]},u)})})})},Zv=r=>{const{path:g}=ra(),{activeDeck:l,activeSeries:u,generalStudyDeck:f}=r,{aiFeaturesEnabled:i}=sa(),o=xx(),[m]=g.split("?"),{deckSeries:x}=et(),{openModal:d}=li(),j=S=>d("confirm",S),y=rx(),_=Tb(),b=Cb(),D=U.useMemo(()=>m.startsWith("/study/")||m.endsWith("/study")||m.endsWith("/cram")||m.endsWith("/study-reversed")||m.endsWith("/study-flip"),[m]),w=U.useMemo(()=>{const S=[{label:"Home",href:"/"}],O=new URLSearchParams(window.location.hash.split("?")[1]);if(m==="/series")S.push({label:"Series"});else if(m.startsWith("/series/")&&u)S.push({label:"Series",href:"/series"}),S.push({label:u.name});else if(m==="/decks")S.push({label:"Decks"});else if(m.startsWith("/decks/")&&l){const C=O.get("seriesId");if(C){const M=x.find(R=>R.id===C);M&&(S.push({label:"Series",href:"/series"}),S.push({label:M.name,href:`/series/${M.id}`}))}else S.push({label:"Decks",href:"/decks"});S.push({label:l.name})}else m==="/settings"?S.push({label:"Settings"}):m==="/trash"?S.push({label:"Trash"}):m==="/archive"?S.push({label:"Archive"}):m==="/progress"?S.push({label:"Progress"}):m==="/instructions/json"&&S.push({label:"JSON Guide"});return S},[m,l,u,x]),N=()=>{if(m==="/settings")return n.jsx(xv,{onExport:o.handleExportData,onRestore:()=>o.openModal("restore"),onResetProgress:()=>o.openModal("resetProgress"),onFactoryReset:o.handleFactoryReset,onSync:r.onSync,onForceFetch:o.handleForceFetchFromServer,onForceUpload:o.handleForceUploadToServer,isSyncing:r.isSyncing,lastSyncStatus:r.lastSyncStatus,onManageServerBackups:()=>o.openModal("serverBackup"),onCreateServerBackup:o.handleCreateServerBackup,isGapiReady:r.isGapiReady,isGapiSignedIn:r.isGapiSignedIn,gapiUser:r.gapiUser,onGoogleSignIn:o.handleGoogleSignIn,onGoogleSignOut:o.handleGoogleSignOut,onBackupToDrive:o.handleBackupToDrive,onRestoreFromDrive:o.openRestoreFromDriveModal,onClearAppCache:o.handleClearAppCache,onClearCdnCache:o.handleClearCdnCache,onRevertLastFetch:o.handleRevertLastFetch});if(m==="/trash")return n.jsx(zv,{onRestoreDeck:o.handleRestoreDeck,onRestoreSeries:o.handleRestoreSeries,onDeleteDeckPermanently:o.handleDeleteDeckPermanently,onDeleteSeriesPermanently:o.handleDeleteSeriesPermanently,openConfirmModal:j});if(m==="/archive")return n.jsx(Uv,{onUpdateDeck:o.handleUpdateDeck,onUpdateSeries:o.handleUpdateSeries,onDeleteDeck:o.handleDeleteDeck,onDeleteSeries:o.handleDeleteSeries,openConfirmModal:j});if(m==="/progress")return n.jsx(Jv,{});if(m.startsWith("/series/")&&u)return n.jsx(Mv,{series:u,sessionsToResume:r.sessionsToResume,onUpdateSeries:o.handleUpdateSeries,onDeleteSeries:o.handleDeleteSeries,onAddDeckToSeries:o.handleAddDeckToSeries,onUpdateDeck:o.handleUpdateDeck,onStartSeriesStudy:o.handleStartSeriesStudy,onUpdateLastOpened:o.updateLastOpenedSeries,openConfirmModal:j,onAiAddLevelsToSeries:o.handleAiAddLevelsToSeries,onAiAddDecksToLevel:o.handleAiAddDecksToLevel,handleGenerateQuestionsForEmptyDecksInSeries:o.handleGenerateQuestionsForEmptyDecksInSeries,handleGenerateQuestionsForDeck:o.handleGenerateQuestionsForDeck,onCancelAIGeneration:o.handleCancelAIGeneration,onExportSeries:o.handleExportSeries,onDeleteDeck:o.handleDeleteDeck,handleGenerateContentForLearningDeck:o.handleGenerateContentForLearningDeck},u.id);if(m==="/study/general"){const S=new URLSearchParams(window.location.hash.split("?")[1]).get("seriesId")||void 0;return f&&n.jsx(cl,{deck:f,seriesId:S,onSessionEnd:o.handleSessionEnd,onItemReviewed:o.handleItemReviewed,onUpdateLastOpened:()=>{},onStudyNextDeck:o.handleStudyNextDeckInSeries},"general-study")}if(m.startsWith("/decks/")&&m.endsWith("/cram")){if(!l)return null;const O=[...((l.type===Ce.Flashcard?l.cards:l.questions)||[]).filter(R=>!R.suspended)].sort(()=>Math.random()-.5),C=l.type===Ce.Flashcard?{...l,name:`${l.name} (Cram)`,cards:O}:{...l,name:`${l.name} (Cram)`,questions:O},M=new URLSearchParams(window.location.hash.split("?")[1]).get("seriesId")||void 0;return n.jsx(cl,{deck:C,seriesId:M,onSessionEnd:o.handleSessionEnd,onItemReviewed:o.handleItemReviewed,onUpdateLastOpened:o.updateLastOpened,sessionKeySuffix:"_cram",onStudyNextDeck:o.handleStudyNextDeckInSeries},`${l.id}-cram`)}if(m.startsWith("/decks/")&&m.endsWith("/study-reversed")){if(!l||l.type!=="flashcard")return null;const S={...l,name:`${l.name} (Reversed)`,cards:(l.cards||[]).map(C=>({...C,front:C.back,back:C.front}))},O=new URLSearchParams(window.location.hash.split("?")[1]).get("seriesId")||void 0;return n.jsx(cl,{deck:S,seriesId:O,onSessionEnd:o.handleSessionEnd,onItemReviewed:o.handleItemReviewed,onUpdateLastOpened:o.updateLastOpened,sessionKeySuffix:"_reversed",onStudyNextDeck:o.handleStudyNextDeckInSeries},`${l.id}-reversed`)}if(m.startsWith("/decks/")&&m.endsWith("/study-flip")){if(!l||l.type!=="quiz"&&l.type!=="learning")return null;const S=l,O=(S.questions||[]).filter(R=>!R.suspended).map(R=>{const $=(R.options||[]).find(J=>J.id===R.correctAnswerId),X=`<div class="text-left w-full"><p class="text-xl"><b>Answer:</b> ${($==null?void 0:$.text)||"N/A"}</p><hr class="my-4"/><div class="prose prose-sm dark:prose-invert max-w-none">${R.detailedExplanation}</div></div>`;return{...R,front:R.questionText,back:X}}),C={...S,name:`${S.name} (Review)`,type:Ce.Flashcard,cards:O.sort(()=>Math.random()-.5)},M=new URLSearchParams(window.location.hash.split("?")[1]).get("seriesId")||void 0;return n.jsx(cl,{deck:C,seriesId:M,onSessionEnd:o.handleSessionEnd,onItemReviewed:o.handleItemReviewed,onUpdateLastOpened:o.updateLastOpened,sessionKeySuffix:"_flip",onStudyNextDeck:o.handleStudyNextDeckInSeries},`${l.id}-flip`)}if(m.startsWith("/decks/")&&m.endsWith("/study")){const S=new URLSearchParams(window.location.hash.split("?")[1]).get("seriesId")||void 0;return l&&n.jsx(cl,{deck:l,seriesId:S,onSessionEnd:o.handleSessionEnd,onItemReviewed:o.handleItemReviewed,onUpdateLastOpened:o.updateLastOpened,onStudyNextDeck:o.handleStudyNextDeckInSeries},l.id)}return m.startsWith("/decks/")?l&&n.jsx(Iv,{deck:l,sessionsToResume:r.sessionsToResume,onUpdateDeck:o.handleUpdateDeck,onDeleteDeck:o.handleDeleteDeck,onUpdateLastOpened:o.updateLastOpened,openConfirmModal:j,handleGenerateQuestionsForDeck:o.handleGenerateQuestionsForDeck,handleGenerateContentForLearningDeck:o.handleGenerateContentForLearningDeck,onCancelAIGeneration:o.handleCancelAIGeneration,onSaveLearningBlock:o.handleSaveLearningBlock,onDeleteLearningBlock:o.handleDeleteLearningBlock,onExportDeck:o.handleExportDeck,onRegenerateQuestion:o.handleRegenerateQuestion,onExpandText:o.handleExpandText},l.id):m==="/instructions/json"?n.jsx(Rv,{}):m==="/decks"?n.jsx(Hv,{sessionsToResume:r.sessionsToResume,sortPreference:r.sortPreference,onSortChange:r.setSortPreference,onUpdateLastOpened:o.updateLastOpened,onDeleteFolder:o.handleDeleteFolder,draggedDeckId:r.draggedDeckId,onDragStart:r.setDraggedDeckId,onDragEnd:()=>r.setDraggedDeckId(null),onMoveDeck:o.handleMoveDeck,openFolderIds:r.openFolderIds,onToggleFolder:r.onToggleFolder,onUpdateDeck:o.handleUpdateDeck,onDeleteDeck:o.handleDeleteDeck,openConfirmModal:j,onNewFolder:()=>o.openModal("folder",{folder:"new"}),onImportDecks:()=>o.openModal("import"),onCreateSampleDeck:o.handleCreateSampleDeck,handleSaveFolder:o.handleSaveFolder,handleGenerateQuestionsForDeck:o.handleGenerateQuestionsForDeck,handleGenerateContentForLearningDeck:o.handleGenerateContentForLearningDeck,onCancelAIGeneration:o.handleCancelAIGeneration}):m==="/series"?n.jsx(Gv,{onStartSeriesStudy:o.handleStartSeriesStudy,onCreateNewSeries:()=>o.openModal("series",{series:"new"}),onCreateSampleSeries:o.handleCreateSampleSeries,onGenerateAI:()=>o.openModal("aiGeneration"),handleGenerateQuestionsForEmptyDecksInSeries:o.handleGenerateQuestionsForEmptyDecksInSeries,onCancelAIGeneration:o.handleCancelAIGeneration}):y.length>0||_.length>0?n.jsx(Lv,{onGenerateAI:()=>o.openModal("aiGeneration"),totalDueQuestions:b,onStartGeneralStudy:o.handleStartGeneralStudy,sessionsToResume:r.sessionsToResume,onUpdateLastOpened:o.updateLastOpened,onUpdateDeck:o.handleUpdateDeck,onDeleteDeck:o.handleDeleteDeck,openConfirmModal:j,seriesProgress:et.getState().seriesProgress,onStartSeriesStudy:o.handleStartSeriesStudy,handleGenerateQuestionsForDeck:o.handleGenerateQuestionsForDeck,handleGenerateContentForLearningDeck:o.handleGenerateContentForLearningDeck,handleGenerateQuestionsForEmptyDecksInSeries:o.handleGenerateQuestionsForEmptyDecksInSeries,onCancelAIGeneration:o.handleCancelAIGeneration}):n.jsxs("div",{className:"text-center py-20",children:[n.jsx("h2",{className:"text-3xl font-bold text-gray-600 dark:text-gray-400",children:"Welcome to CogniFlow"}),n.jsx("p",{className:"mt-4 text-gray-500 dark:text-gray-500",children:"Get started by creating or importing content."}),n.jsxs("div",{className:"flex flex-col sm:flex-row items-center justify-center gap-4 mt-8 flex-wrap",children:[i&&n.jsxs(ce,{onClick:()=>o.openModal("aiGeneration"),variant:"primary",children:[n.jsx(te,{name:"zap",className:"w-5 h-5 mr-2"}),"Generate with AI"]}),n.jsxs(ce,{onClick:()=>o.openModal("import"),children:[n.jsx(te,{name:"plus",className:"w-5 h-5 mr-2"}),"Create or Import Deck"]}),n.jsxs(ce,{onClick:()=>o.openModal("restore"),variant:"secondary",children:[n.jsx(te,{name:"upload-cloud",className:"w-5 h-5 mr-2"}),"Restore from Backup"]}),n.jsxs(ce,{onClick:()=>o.openModal("series",{series:"new"}),variant:"secondary",children:[n.jsx(te,{name:"layers",className:"w-5 h-5 mr-2"}),"Create New Series"]}),n.jsxs(ce,{onClick:o.handleCreateSampleDeck,variant:"ghost",children:[n.jsx(te,{name:"laptop",className:"w-5 h-5 mr-2"}),"Create Sample Deck"]}),n.jsxs(ce,{onClick:o.handleCreateSampleSeries,variant:"ghost",children:[n.jsx(te,{name:"zap",className:"w-5 h-5 mr-2"}),"Create Sample Series"]})]})]})};return n.jsxs(n.Fragment,{children:[!D&&n.jsx(Kv,{items:w}),N()]})},Xv=()=>{const{openModal:r}=li(),g=()=>{r("aiChat")};return n.jsx("div",{className:"fixed bottom-6 right-6 z-40",children:n.jsx(ce,{variant:"primary",onClick:g,className:"rounded-full w-16 h-16 shadow-lg flex items-center justify-center","aria-label":"Open AI Assistant",children:n.jsx(te,{name:"bot",className:"w-8 h-8"})})})},Wv=({onOpen:r,onCancel:g})=>{const{currentTask:l,queue:u}=et(x=>x.aiGenerationStatus),f=l!==null,i=(u==null?void 0:u.length)||0,o=(f?1:0)+i;if(o===0)return null;const m=(l==null?void 0:l.statusText)||`${i} task(s) queued...`;return n.jsx("div",{className:"fixed bottom-6 left-6 z-40",children:n.jsxs("button",{onClick:r,className:"bg-surface rounded-lg shadow-lg flex items-center p-2 gap-3 transition-all hover:shadow-xl animate-fade-in","aria-label":"View AI generation status",children:[n.jsxs("div",{className:"relative w-10 h-10 flex items-center justify-center",children:[n.jsx("svg",{className:"absolute w-full h-full",style:{animation:f?"spin 1.5s linear infinite":"none"},viewBox:"0 0 24 24",children:n.jsx("circle",{cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"2",fill:"none",className:f?"text-primary/50":"text-text-muted/50",strokeDasharray:f?"40 100":"5 15"})}),n.jsx(te,{name:"bot",className:`w-6 h-6 ${f?"text-primary":"text-text-muted"}`})]}),n.jsxs("div",{className:"flex flex-col text-left pr-2",children:[n.jsx("span",{className:"font-semibold text-sm text-text",children:f?"AI is working...":"AI Queue"}),n.jsx("span",{className:"text-xs text-text-muted truncate max-w-[200px]",title:m,children:m})]}),o>0&&n.jsx("div",{className:"bg-primary text-on-primary text-xs font-bold rounded-full h-6 w-6 flex items-center justify-center self-center mr-2",children:o})]})})},e1=({isOpen:r,onClose:g,onAddDecks:l,onAddSeriesWithDecks:u})=>{const[f,i]=U.useState("create"),[o,m]=U.useState(""),[x,d]=U.useState(""),[j,y]=U.useState(""),[_,b]=U.useState(!1),D=U.useRef(null),{addToast:w}=Mt(),N=U.useRef(null);Yt(N,r);const S=U.useCallback(()=>{i("create"),m(""),d(""),y(""),b(!1)},[]),O=U.useCallback(()=>{S(),g()},[S,g]),C=U.useCallback(Y=>{d(Y);try{const H=Fo(Y);(H==null?void 0:H.type)===Ce.Quiz?m(H.data.name):(H==null?void 0:H.type)==="series"&&m(H.data.seriesName)}catch{}},[]),M=U.useCallback(async Y=>{if(Y){y(Y.name),b(!0);try{const H=await Y.arrayBuffer(),K=new Uint8Array(H,0,2),q=K[0]===80&&K[1]===75,W=Y.name.toLowerCase().endsWith(".json");if(q){m("");const A=H.slice(0);let B=[];try{B=await tx(H)}catch(z){console.warn("Anki worker failed, trying main thread fallback:",z),w("Import via worker failed. Trying a slower fallback method... this may freeze the app.","info");try{B=await nx(A)}catch(Q){throw console.error("Anki main thread fallback also failed:",Q),Q}}B.length>0?(l(B),w(`Successfully imported ${B.length} deck(s) from ${Y.name}.`,"success"),O()):(w("No valid decks found in the Anki package.","info"),S())}else if(W){const A=new TextDecoder().decode(H);C(A),b(!1),w("File loaded. Confirm name and import, or paste content directly.","info")}else w("Unsupported file type. Please upload a '.json' or Anki package (.apkg, .zip) file.","error"),y(""),b(!1)}catch(H){console.error("Failed to process file:",H),w(`An error occurred: ${H instanceof Error?H.message:"Unknown error"}`,"error"),S()}}},[w,O,C,l,S]),R=U.useCallback(()=>{if(f==="create"){if(!o.trim()){w("Please enter a deck name.","error");return}const Y={id:crypto.randomUUID(),name:o.trim(),type:Ce.Flashcard,cards:[],description:`An empty deck created on ${l0()}`};l([Y]),w(`Deck "${Y.name}" created.`,"success"),O();return}if(!x){w("Please paste or upload content.","error");return}try{const Y=Fo(x);if(!Y)return;if(Y.type==="series"){const{seriesName:K,seriesDescription:q,levels:W}=Y.data,A=[],B=W.map(Q=>{const ue=Q.decks.map(ee=>ee.type===Ce.Quiz?{id:crypto.randomUUID(),name:ee.name,description:ee.description,type:Ce.Quiz,questions:pa(ee.questions||[])}:ee.type===Ce.Flashcard?{id:crypto.randomUUID(),name:ee.name,description:ee.description,type:Ce.Flashcard,cards:pl(ee.cards||[])}:null).filter(ee=>ee!==null);return A.push(...ue),{title:Q.title,deckIds:ue.map(ee=>ee.id)}}),z={id:crypto.randomUUID(),type:"series",name:K,description:q,levels:B,archived:!1,createdAt:new Date().toISOString()};u(z,A),O();return}if(!o.trim()){w("Please enter a deck name.","error");return}let H;if(Y.type===Ce.Flashcard){const K=pl(Y.data);H={id:crypto.randomUUID(),name:o.trim(),type:Ce.Flashcard,cards:K,description:`${K.length} imported flashcard${K.length===1?"":"s"}.`}}else{const K=pa(Y.data.questions);H={id:crypto.randomUUID(),name:o.trim(),description:Y.data.description,type:Ce.Quiz,questions:K}}l([H]),w(`Deck "${H.name}" imported successfully.`,"success"),O()}catch(Y){w(Y instanceof Error?Y.message:"Invalid JSON content.","error")}},[o,f,x,l,O,w,u]),$=Y=>{var K;const H=(K=Y.target.files)==null?void 0:K[0];H&&M(H),Y.target&&(Y.target.value="")};if(!r)return null;const X=()=>{const Y=j.toLowerCase().endsWith(".apkg");if(f==="upload"&&Y)return n.jsx("div",{className:"text-text-muted text-center py-12",children:"Anki file selected. Decks will be imported automatically."});switch(f){case"paste":return n.jsxs("div",{children:[n.jsx("textarea",{className:"w-full h-48 p-2 bg-background border border-border rounded-md focus:ring-2 focus:ring-primary focus:outline-none text-text",placeholder:'Paste JSON here... e.g., [{"front": "Q1", "back": "A1"}] or a Quiz/Series object.',value:x,onChange:H=>C(H.target.value)}),n.jsxs(Gt,{href:"/instructions/json",onClick:g,className:"text-sm text-primary hover:underline mt-2 inline-flex items-center gap-1",children:[n.jsx(te,{name:"help-circle",className:"w-4 h-4"}),"View JSON format guide"]})]});case"upload":return n.jsxs(n.Fragment,{children:[n.jsx("input",{type:"file",ref:D,className:"hidden",accept:".json, .apkg, .zip",onChange:$}),n.jsxs("label",{className:"flex flex-col items-center justify-center w-full h-48 border-2 border-dashed border-border rounded-lg cursor-pointer hover:bg-background transition-colors",children:[n.jsx(te,{name:"upload-cloud",className:"w-10 h-10 text-text-muted mb-2"}),n.jsxs("p",{className:"text-sm text-text-muted",children:[n.jsx("span",{className:"font-semibold text-primary",onClick:H=>{var K;H.preventDefault(),(K=D.current)==null||K.click()},children:"Click to upload"})," or drag and drop anywhere"]}),n.jsx("p",{className:"text-xs text-text-muted/70",children:"JSON or Anki Package (.apkg, .zip)"}),j&&n.jsx("p",{className:"text-sm text-green-500 dark:text-green-400 mt-2 truncate",title:j,children:j})]})]});case"create":default:return n.jsx("p",{className:"text-text-muted text-center py-12",children:"Create an empty flashcard deck."})}},J=!(f==="upload"&&j.toLowerCase().endsWith(".apkg"));return n.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-75 flex items-center justify-center z-[60] p-4",children:n.jsxs("div",{ref:N,className:"bg-surface rounded-lg shadow-xl w-full max-w-lg overflow-hidden transform transition-all relative",children:[_&&n.jsxs("div",{className:"absolute inset-0 bg-surface/80 flex flex-col items-center justify-center z-20",children:[n.jsx(tn,{}),n.jsx("p",{className:"text-lg text-text mt-4",children:"Processing file..."})]}),n.jsxs("div",{className:"flex justify-between items-center p-4 border-b border-border",children:[n.jsx("h2",{className:"text-xl font-bold text-text",children:"Create / Import"}),n.jsx(ce,{variant:"ghost",onClick:O,className:"p-1 h-auto",children:n.jsx(te,{name:"x"})})]}),n.jsxs("div",{className:"p-6 space-y-4",children:[J&&n.jsxs("div",{children:[n.jsx("label",{htmlFor:"deck-name",className:"block text-sm font-medium text-text-muted mb-1",children:"Deck / Series Name"}),n.jsx("input",{type:"text",id:"deck-name",value:o,onChange:Y=>m(Y.target.value),className:"w-full p-2 bg-background border border-border rounded-md focus:ring-2 focus:ring-primary focus:outline-none",placeholder:"e.g. Japanese Vocabulary"}),n.jsx("p",{className:"text-xs text-text-muted mt-1",children:"For single deck or new deck creation. This is auto-filled when pasting a Series object."})]}),n.jsx("div",{className:"flex border-b border-border",children:["create","paste","upload"].map(Y=>n.jsx("button",{onClick:()=>i(Y),className:`capitalize px-4 py-2 text-sm font-medium transition-colors ${f===Y?"border-b-2 border-primary text-text":"text-text-muted hover:text-text"}`,children:Y==="create"?"Create Empty":Y},Y))}),n.jsx("div",{className:"mt-4",children:X()})]}),n.jsxs("div",{className:"flex justify-end p-4 bg-background/50 border-t border-border",children:[n.jsx(ce,{variant:"secondary",onClick:O,className:"mr-2",children:"Cancel"}),n.jsx(ce,{variant:"primary",onClick:R,disabled:_||f==="create"&&!o.trim()||f!=="create"&&!x&&!j,children:f==="create"?"Create Deck":"Import"})]})]})})},ul=({label:r,localValue:g,backupValue:l,hasChanged:u})=>u?n.jsxs("div",{className:"text-xs",children:[n.jsxs("span",{className:"font-semibold",children:[r,": "]}),n.jsx("span",{className:"text-text-muted",children:g}),n.jsx(te,{name:"arrow-down",className:"inline w-3 h-3 mx-1 rotate-[-90deg]"}),n.jsx("span",{className:"text-primary font-semibold",children:l})]}):null,t1=({isOpen:r,onClose:g,onCompare:l,onRestoreSelected:u,onFullRestore:f,openConfirmModal:i,file:o})=>{const[m,x]=U.useState("upload"),[d,j]=U.useState(""),[y,_]=U.useState(null),[b,D]=U.useState(null),[w,N]=U.useState(new Set),S=U.useRef(null),{addToast:O}=Mt(),C=U.useRef(null);Yt(C,r);const{seriesProgress:M}=et();U.useEffect(()=>{o&&r&&$(o)},[o,r]);const R=()=>{x("upload"),j(""),_(null),D(null),N(new Set),g()},$=async B=>{if(B){x("loading"),j(B.name);try{const z=await B.text(),Q=Go(z);_(Q);const ue=l(Q);D(ue);const ee=[...ue.newSeries.map(V=>V.id),...ue.newDecks.map(V=>V.id),...ue.changedSeries.map(V=>V.backup.id),...ue.changedDecks.map(V=>V.backup.id)];N(new Set(ee)),x("compare")}catch(z){O(`Restore failed: ${z instanceof Error?z.message:"Unknown error"}`,"error"),R()}}},X=B=>{var Q;if(m==="loading")return;const z=(Q=B.target.files)==null?void 0:Q[0];z&&$(z),B.target&&(B.target.value="")},J=B=>{var Q;if(B.preventDefault(),m==="loading")return;const z=(Q=B.dataTransfer.files)==null?void 0:Q[0];z&&$(z)},Y=B=>B.preventDefault(),H=async()=>{y&&(x("loading"),await u({selectedIds:w,backupData:y}),R())},K=()=>{y&&(g(),i({title:"Confirm Full Restore",message:"This will completely overwrite all your local data with the contents of the backup file. This action cannot be undone.",confirmText:"overwrite everything",onConfirm:()=>f(y)}))},q=B=>{N(z=>{const Q=new Set(z);return Q.has(B)?Q.delete(B):Q.add(B),Q})};if(!r)return null;const W=B=>{var z,Q;return B.type===Ce.Flashcard?((z=B.cards)==null?void 0:z.length)||0:((Q=B.questions)==null?void 0:Q.length)||0},A=()=>{if(m==="loading")return n.jsxs("div",{className:"absolute inset-0 bg-surface/80 flex flex-col items-center justify-center z-20",children:[n.jsx(tn,{}),n.jsx("p",{className:"text-lg text-text mt-4",children:"Analyzing backup..."})]});if(m==="compare"&&b){const{newSeries:B,newDecks:z,changedSeries:Q,changedDecks:ue,dueCounts:ee,masteryLevels:V}=b,E=new Set(B.flatMap(Ne=>(Ne.levels||[]).flatMap(we=>we.deckIds||[]))),L=z.filter(Ne=>!E.has(Ne.id)),se=B.length>0||L.length>0,ie=Q.length>0||ue.length>0,oe=[];return B.length>0&&oe.push("new-series"),L.length>0&&oe.push("new-decks"),Q.length>0&&oe.push("changed-series"),ue.length>0&&oe.push("changed-decks"),n.jsx("div",{className:"p-6 space-y-4 max-h-[60vh] overflow-y-auto",children:!se&&!ie?n.jsxs("div",{className:"text-center py-8 text-text-muted",children:[n.jsx(te,{name:"check-circle",className:"w-12 h-12 mx-auto text-green-500"}),n.jsx("p",{className:"mt-2 font-medium",children:"Everything is up-to-date!"}),n.jsx("p",{className:"text-sm",children:"Your local data already matches the contents of this backup file."})]}):n.jsxs(hx,{type:"multiple",defaultValue:oe,children:[B.length>0&&n.jsxs(fa,{value:"new-series",className:"border-b",children:[n.jsxs(ha,{children:["New Series (",B.length,")"]}),n.jsx(ma,{className:"p-2 space-y-2",children:B.map(Ne=>n.jsx("div",{className:"p-3 bg-background rounded-md border border-border",children:n.jsxs("label",{className:"flex items-start gap-3 cursor-pointer",children:[n.jsx("input",{type:"checkbox",checked:w.has(Ne.id),onChange:()=>q(Ne.id),className:"mt-1 h-4 w-4 rounded border-gray-300 text-primary focus:ring-primary"}),n.jsxs("div",{className:"flex-grow",children:[n.jsx("p",{className:"font-semibold text-text",children:Ne.name}),n.jsxs("p",{className:"text-xs text-text-muted",children:[(Ne.levels||[]).reduce((we,je)=>{var ve;return we+(((ve=je.deckIds)==null?void 0:ve.length)||0)},0)," deck(s)"]})]})]})},Ne.id))})]}),Q.length>0&&n.jsxs(fa,{value:"changed-series",className:"border-b",children:[n.jsxs(ha,{children:["Changed Series (",Q.length,")"]}),n.jsx(ma,{className:"p-2 space-y-2",children:Q.map(({local:Ne,backup:we,diff:je})=>{var Re,k;const ve=`${((Re=M.get(Ne.id))==null?void 0:Re.size)||0}/${(Ne.levels||[]).reduce((xe,he)=>{var Z;return xe+(((Z=he.deckIds)==null?void 0:Z.length)||0)},0)}`,Me=`${((k=((y==null?void 0:y.seriesProgress)||{})[we.id])==null?void 0:k.length)||0}/${(we.levels||[]).reduce((xe,he)=>{var Z;return xe+(((Z=he.deckIds)==null?void 0:Z.length)||0)},0)}`,Fe=Math.round((V.get(`local-${Ne.id}`)||0)*100),Pe=Math.round((V.get(we.id)||0)*100);return n.jsx("div",{className:"p-3 bg-background rounded-md border border-border",children:n.jsxs("label",{className:"flex items-start gap-3 cursor-pointer",children:[n.jsx("input",{type:"checkbox",checked:w.has(we.id),onChange:()=>q(we.id),className:"mt-1 h-4 w-4 rounded border-gray-300 text-primary focus:ring-primary"}),n.jsxs("div",{className:"flex-grow space-y-1",children:[n.jsx("p",{className:"font-semibold text-text",children:we.name}),n.jsx(ul,{label:"Completion",localValue:ve,backupValue:Me,hasChanged:je.completion}),n.jsx(ul,{label:"Mastery",localValue:`${Fe}%`,backupValue:`${Pe}%`,hasChanged:je.mastery}),je.structure&&n.jsx("p",{className:"text-xs font-semibold text-primary",children:"Content/Structure updated"})]})]})},we.id)})})]}),L.length>0&&n.jsxs(fa,{value:"new-decks",className:"border-b",children:[n.jsxs(ha,{children:["New Standalone Decks (",L.length,")"]}),n.jsx(ma,{className:"p-2 space-y-2",children:L.map(Ne=>n.jsx("div",{className:"p-3 bg-background rounded-md border border-border",children:n.jsxs("label",{className:"flex items-start gap-3 cursor-pointer",children:[n.jsx("input",{type:"checkbox",checked:w.has(Ne.id),onChange:()=>q(Ne.id),className:"mt-1 h-4 w-4 rounded border-gray-300 text-primary focus:ring-primary"}),n.jsxs("div",{className:"flex-grow",children:[n.jsx("p",{className:"font-semibold text-text",children:Ne.name}),n.jsxs("p",{className:"text-xs text-text-muted",children:[W(Ne)," item(s) • ",ee.get(Ne.id)||0," due"]})]})]})},Ne.id))})]}),ue.length>0&&n.jsxs(fa,{value:"changed-decks",className:"border-b",children:[n.jsxs(ha,{children:["Changed Decks (",ue.length,")"]}),n.jsx(ma,{className:"p-2 space-y-2",children:ue.map(({local:Ne,backup:we,diff:je})=>{const ve=Math.round((V.get(`local-${Ne.id}`)||0)*100),Me=Math.round((V.get(we.id)||0)*100);return n.jsx("div",{className:"p-3 bg-background rounded-md border border-border",children:n.jsxs("label",{className:"flex items-start gap-3 cursor-pointer",children:[n.jsx("input",{type:"checkbox",checked:w.has(we.id),onChange:()=>q(we.id),className:"mt-1 h-4 w-4 rounded border-gray-300 text-primary focus:ring-primary"}),n.jsxs("div",{className:"flex-grow space-y-1",children:[n.jsx("p",{className:"font-semibold text-text",children:we.name}),n.jsx(ul,{label:"Items",localValue:W(Ne),backupValue:W(we),hasChanged:je.content}),n.jsx(ul,{label:"Due",localValue:ee.get(`local-${Ne.id}`),backupValue:ee.get(we.id),hasChanged:je.dueCount}),n.jsx(ul,{label:"Mastery",localValue:`${ve}%`,backupValue:`${Me}%`,hasChanged:je.mastery}),je.content&&n.jsx("p",{className:"text-xs font-semibold text-primary",children:"Content updated"})]})]})},we.id)})})]})]})})}return n.jsxs("div",{className:"p-6 space-y-4",children:[n.jsx("input",{type:"file",ref:S,className:"hidden",accept:".json,application/json",onChange:X}),n.jsxs("label",{onDragOver:Y,onDrop:J,className:"flex flex-col items-center justify-center w-full h-48 border-2 border-dashed border-border rounded-lg cursor-pointer hover:bg-background",children:[n.jsx(te,{name:"upload-cloud",className:"w-10 h-10 text-text-muted mb-2"}),n.jsxs("p",{className:"text-sm text-text-muted",children:[n.jsx("span",{className:"font-semibold text-primary",onClick:B=>{var z;B.preventDefault(),(z=S.current)==null||z.click()},children:"Click to upload"})," or drag and drop"]}),n.jsx("p",{className:"text-xs text-text-muted/70",children:"CogniFlow Backup JSON file"})]})]})};return n.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-75 flex items-center justify-center z-[60] p-4",children:n.jsxs("div",{ref:C,className:"bg-surface rounded-lg shadow-xl w-full max-w-lg overflow-hidden transform transition-all relative",children:[n.jsxs("div",{className:"flex justify-between items-center p-4 border-b border-border",children:[n.jsx("h2",{className:"text-xl font-bold",children:"Restore from Backup"}),n.jsx(ce,{variant:"ghost",onClick:R,className:"p-1 h-auto",disabled:m==="loading",children:n.jsx(te,{name:"x"})})]}),A(),n.jsxs("div",{className:"flex justify-between items-center p-4 bg-background/50 border-t border-border",children:[n.jsx("div",{children:m==="compare"&&n.jsx(ce,{variant:"danger",onClick:K,children:"Full Restore"})}),n.jsxs("div",{className:"flex gap-2",children:[n.jsx(ce,{variant:"secondary",onClick:R,disabled:m==="loading",children:"Cancel"}),m==="compare"&&n.jsxs(ce,{variant:"primary",onClick:H,disabled:w.size===0,children:["Add/Update Selected (",w.size,")"]})]})]})]})})},n1=({isOpen:r,onClose:g,onReset:l,decks:u})=>{const[f,i]=U.useState(""),{addToast:o}=Mt(),m=U.useRef(null);Yt(m,r);const d=!!U.useMemo(()=>u.find(_=>_.id===f),[u,f]),j=()=>{if(!d){o("Please select a deck to reset.","error");return}l(f),g()},y=()=>{i(""),g()};return r?n.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-75 flex items-center justify-center z-[60] p-4",children:n.jsxs("div",{ref:m,className:"bg-surface rounded-lg shadow-xl w-full max-w-lg transform transition-all relative",children:[n.jsxs("div",{className:"flex justify-between items-center p-4 border-b border-border",children:[n.jsx("h2",{className:"text-xl font-bold",children:"Reset Deck Progress"}),n.jsx(ce,{type:"button",variant:"ghost",onClick:y,className:"p-1 h-auto",children:n.jsx(te,{name:"x"})})]}),n.jsxs("div",{className:"p-6 space-y-4",children:[n.jsx("div",{className:"bg-red-900/20 border border-red-500/30 rounded-lg p-4 text-sm text-red-700 dark:text-red-200",children:n.jsxs("p",{children:[n.jsx("strong",{className:"font-bold",children:"Warning:"})," This will reset all spaced repetition data (due dates, intervals) for the selected deck. The cards themselves will not be deleted. This action cannot be undone."]})}),n.jsxs("div",{children:[n.jsx("label",{htmlFor:"deck-select",className:"block text-sm font-medium text-text-muted mb-1",children:"Select Deck"}),n.jsxs("select",{id:"deck-select",value:f,onChange:_=>{i(_.target.value)},className:"w-full p-2 bg-background border border-border rounded-md focus:ring-2 focus:ring-primary focus:outline-none",children:[n.jsx("option",{value:"",disabled:!0,children:"-- Select a deck --"}),u.map(_=>n.jsx("option",{value:_.id,children:_.name},_.id))]})]})]}),n.jsxs("div",{className:"flex justify-end p-4 bg-background/50 border-t border-border",children:[n.jsx(ce,{type:"button",variant:"secondary",onClick:y,className:"mr-2",children:"Cancel"}),n.jsxs(ce,{type:"button",variant:"danger",onClick:j,disabled:!d,children:[n.jsx(te,{name:"refresh-ccw",className:"w-5 h-5 mr-2"}),"Reset Progress"]})]})]})}):null},a1=({folder:r,isOpen:g,onClose:l,onSave:u})=>{const[f,i]=U.useState(""),{addToast:o}=Mt(),m=U.useRef(null);Yt(m,g),U.useEffect(()=>{i(r?r.name:"")},[r]);const x=d=>{if(d.preventDefault(),!f.trim()){o("Folder name cannot be empty.","error");return}u({id:(r==null?void 0:r.id)||null,name:f.trim()}),l()};return g?n.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-75 flex items-center justify-center z-[60] p-4",children:n.jsx("div",{ref:m,className:"bg-surface rounded-lg shadow-xl w-full max-w-md transform transition-all relative",children:n.jsxs("form",{onSubmit:x,children:[n.jsxs("div",{className:"flex justify-between items-center p-4 border-b border-border",children:[n.jsx("h2",{className:"text-xl font-bold",children:r?"Edit Folder":"Create New Folder"}),n.jsx(ce,{type:"button",variant:"ghost",onClick:l,className:"p-1 h-auto",children:n.jsx(te,{name:"x"})})]}),n.jsx("div",{className:"p-6 space-y-4",children:n.jsxs("div",{children:[n.jsx("label",{htmlFor:"folder-name",className:"block text-sm font-medium text-text-muted mb-1",children:"Folder Name"}),n.jsx("input",{id:"folder-name",type:"text",value:f,onChange:d=>i(d.target.value),className:"w-full p-2 bg-background border border-border rounded-md focus:ring-2 focus:ring-primary focus:outline-none",placeholder:"e.g., University Courses",autoFocus:!0})]})}),n.jsxs("div",{className:"flex justify-end p-4 bg-background/50 border-t border-border",children:[n.jsx(ce,{type:"button",variant:"secondary",onClick:l,className:"mr-2",children:"Cancel"}),n.jsxs(ce,{type:"submit",variant:"primary",children:[n.jsx(te,{name:"save",className:"w-4 h-4 mr-2"}),r?"Save Changes":"Create Folder"]})]})]})})}):null},r1=({series:r,isOpen:g,onClose:l,onSave:u})=>{const[f,i]=U.useState(""),[o,m]=U.useState(""),[x,d]=U.useState(null),{addToast:j}=Mt(),y=U.useRef(null);Yt(y,g);const _=r===null;U.useEffect(()=>{r?(i(r.name),m(r.description),d(null)):(i(""),m(""),d(null))},[r]);const b=w=>{if(!_)return;const N=w.clipboardData.getData("text");if(N.trim().startsWith("{"))try{const S=JSON.parse(N);typeof S.seriesName=="string"&&typeof S.seriesDescription=="string"&&Array.isArray(S.levels)&&(w.preventDefault(),i(S.seriesName),m(S.seriesDescription),d(S),j("Series details and structure populated from JSON scaffold!","success"))}catch{}},D=w=>{if(w.preventDefault(),!f.trim()){j("Series name cannot be empty.","error");return}u({id:_?null:r.id,name:f.trim(),description:o.trim(),scaffold:_?x:null}),l()};return g?n.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-75 flex items-center justify-center z-[60] p-4",children:n.jsx("div",{ref:y,className:"bg-surface rounded-lg shadow-xl w-full max-w-lg transform transition-all relative",children:n.jsxs("form",{onSubmit:D,children:[n.jsxs("div",{className:"flex justify-between items-center p-4 border-b border-border",children:[n.jsx("h2",{className:"text-xl font-bold",children:_?"Create New Series":"Edit Series"}),n.jsx(ce,{type:"button",variant:"ghost",onClick:l,className:"p-1 h-auto",children:n.jsx(te,{name:"x"})})]}),n.jsxs("div",{className:"p-6 space-y-4",children:[n.jsxs("div",{children:[n.jsx("label",{htmlFor:"series-name",className:"block text-sm font-medium text-text-muted mb-1",children:"Series Name"}),n.jsx("input",{id:"series-name",type:"text",value:f,onChange:w=>i(w.target.value),onPaste:b,className:"w-full p-2 bg-background border border-border rounded-md focus:ring-2 focus:ring-primary focus:outline-none",placeholder:"e.g., Introduction to Algebra",autoFocus:!0}),_&&n.jsx("p",{className:"text-xs text-text-muted mt-1",children:"You can paste a full JSON scaffold object here to auto-populate."})]}),n.jsxs("div",{children:[n.jsx("label",{htmlFor:"series-description",className:"block text-sm font-medium text-text-muted mb-1",children:"Description"}),n.jsx("textarea",{id:"series-description",value:o,onChange:w=>m(w.target.value),onPaste:b,rows:3,className:"w-full p-2 bg-background border border-border rounded-md focus:ring-2 focus:ring-primary focus:outline-none",placeholder:"A collection of decks covering core concepts."})]}),_&&x&&n.jsxs("div",{className:"space-y-2 animate-fade-in",children:[n.jsx("h4",{className:"text-sm font-semibold text-text-muted",children:"Structure Preview"}),n.jsx("div",{className:"bg-background border border-border rounded-md p-3 max-h-48 overflow-y-auto text-sm",children:n.jsx("ul",{className:"space-y-3",children:(x.levels||[]).filter(w=>!!w).map((w,N)=>{const S=w.decks||[];return n.jsxs("li",{children:[n.jsxs("div",{className:"flex items-center gap-2 font-medium text-text",children:[n.jsx(te,{name:"layers",className:"w-4 h-4 text-purple-500 flex-shrink-0"}),n.jsx("span",{className:"font-semibold",children:w.title})]}),n.jsxs("ul",{className:"pl-6 mt-1 space-y-1",children:[S.map((O,C)=>n.jsxs("li",{className:"flex items-center gap-2 text-text-muted",children:[n.jsx(te,{name:"help-circle",className:"w-3.5 h-3.5 flex-shrink-0"}),n.jsx("span",{children:O.name})]},C)),S.length===0&&n.jsx("li",{className:"flex items-center gap-2 text-xs text-text-muted/70 italic",children:"(No decks in this level)"})]})]},N)})})})]})]}),n.jsxs("div",{className:"flex justify-end p-4 bg-background/50 border-t border-border",children:[n.jsx(ce,{type:"button",variant:"secondary",onClick:l,className:"mr-2",children:"Cancel"}),n.jsxs(ce,{type:"submit",variant:"primary",children:[n.jsx(te,{name:"save",className:"w-4 h-4 mr-2"}),_?"Create Series":"Save Changes"]})]})]})})}):null},yx="cogniflow-ai-options",Eg={understandingLevels:["Auto","Novice","Beginner","Intermediate","Advanced","Expert"],comprehensivenessLevels:["Quick Overview","Standard","Comprehensive","Exhaustive"],learningGoalOptions:["Auto","Master a subject","Learn for the sake of curiosity","Explore a new interest","Become more informed","Understand a complex topic","Practically learn the topic"],learningStyleOptions:["Auto","Conceptual Understanding (Why & How)","Factual Recall (What, Who, When)","Practical Application & Scenarios"],languageOptions:["Auto","English","Swedish","Spanish","French","German","Japanese","Mandarin","Russian"],toneOptions:["Auto","Neutral","Formal","Casual","Academic","Enthusiastic","Humorous"],personas:[{id:"default",name:"Default Assistant",instruction:"You are a helpful and neutral AI assistant."},{id:"tutor",name:"Friendly Tutor",instruction:"You are a friendly and encouraging tutor. You use analogies and explain complex topics in a simple, easy-to-understand way."},{id:"professor",name:"University Professor",instruction:"You are an expert professor. Your tone is formal, academic, and you provide in-depth, precise information."},{id:"author",name:"Technical Author",instruction:"You are a technical author. Your style is concise, precise, and fact-focused. You avoid fluff and get straight to the point."}],customFields:[]},s1=()=>{try{const r=localStorage.getItem(yx);if(r){const g=JSON.parse(r);return{...Eg,...g}}}catch(r){console.error("Failed to parse AI options from localStorage",r)}return Eg},zd=()=>{const[r,g]=U.useState(s1),l=f=>{try{localStorage.setItem(yx,JSON.stringify(f)),g(f)}catch(i){console.error("Failed to save AI options to localStorage",i)}},u=U.useCallback((f,i)=>{g(o=>{const m={...o,[f]:i};return l(m),m})},[]);return{options:r,updateCategory:u}},ai=({title:r,category:g})=>{const{options:l,updateCategory:u}=zd(),[f,i]=U.useState(l[g]),[o,m]=U.useState(""),x=()=>{if(o.trim()){const j=[...f,o.trim()];i(j),u(g,j),m("")}},d=j=>{const y=f.filter((_,b)=>b!==j);i(y),u(g,y)};return n.jsxs("div",{className:"p-4 bg-background border border-border rounded-lg",children:[n.jsx("h4",{className:"font-semibold text-text mb-2",children:r}),n.jsx("ul",{className:"space-y-2",children:f.map((j,y)=>n.jsxs("li",{className:"flex items-center justify-between p-2 bg-surface rounded-md",children:[n.jsx("span",{children:j}),n.jsx(ce,{variant:"ghost",size:"sm",className:"p-1 h-auto",onClick:()=>d(y),children:n.jsx(te,{name:"trash-2",className:"w-4 h-4 text-red-500"})})]},y))}),n.jsxs("div",{className:"flex items-center gap-2 mt-2",children:[n.jsx("input",{type:"text",value:o,onChange:j=>m(j.target.value),onKeyDown:j=>{j.key==="Enter"&&(j.preventDefault(),x())},placeholder:"Add new option...",className:"flex-grow p-2 bg-surface border border-border rounded-md"}),n.jsx(ce,{variant:"secondary",onClick:x,children:"Add"})]})]})},i1=()=>{const{options:r,updateCategory:g}=zd(),[l,u]=U.useState(()=>JSON.parse(JSON.stringify(r.personas))),{addToast:f}=Mt(),i=(d,j,y)=>{const _=[...l];_[d]={..._[d],[j]:y},u(_)},o=()=>{u([...l,{id:crypto.randomUUID(),name:"",instruction:""}])},m=d=>{l[d].id!=="default"&&u(l.filter((j,y)=>y!==d))},x=()=>{g("personas",l.filter(d=>d.name.trim()&&d.instruction.trim())),f("Personas saved!","success")};return n.jsxs("div",{className:"space-y-4",children:[n.jsxs("div",{className:"flex justify-between items-center",children:[n.jsx("h4",{className:"font-semibold text-text",children:"AI Personas"}),n.jsx(ce,{variant:"secondary",size:"sm",onClick:x,children:"Save Personas"})]}),l.map((d,j)=>n.jsxs("div",{className:"space-y-2 p-3 bg-background border border-border rounded-md",children:[n.jsx("input",{type:"text",placeholder:"Persona Name (e.g., Cheerful Tutor)",value:d.name,onChange:y=>i(j,"name",y.target.value),className:"w-full p-2 bg-surface border border-border rounded-md",disabled:d.id==="default"}),n.jsx("textarea",{placeholder:"System instruction for this persona...",value:d.instruction,onChange:y=>i(j,"instruction",y.target.value),rows:3,className:"w-full p-2 bg-surface border border-border rounded-md"}),d.id!=="default"&&n.jsxs(ce,{variant:"ghost",size:"sm",onClick:()=>m(j),className:"text-red-500",children:[n.jsx(te,{name:"trash-2",className:"w-4 h-4 mr-2"})," Remove Persona"]})]},d.id)),n.jsxs(ce,{variant:"ghost",size:"sm",onClick:o,children:[n.jsx(te,{name:"plus",className:"w-4 h-4 mr-2"})," Add Persona"]})]})},l1=({onBack:r})=>n.jsxs(n.Fragment,{children:[n.jsx("header",{className:"flex-shrink-0 flex justify-between items-center p-4 border-b border-border",children:n.jsxs("div",{className:"flex items-center gap-2",children:[n.jsx(ce,{variant:"ghost",onClick:r,className:"p-1 h-auto",children:n.jsx(te,{name:"chevron-left"})}),n.jsx("h2",{className:"text-xl font-bold",children:"Manage AI Options"})]})}),n.jsxs("main",{className:"flex-grow p-6 overflow-y-auto space-y-6",children:[n.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[n.jsx(ai,{title:"Understanding Levels",category:"understandingLevels"}),n.jsx(ai,{title:"Comprehensiveness Levels",category:"comprehensivenessLevels"}),n.jsx(ai,{title:"Learning Goals",category:"learningGoalOptions"}),n.jsx(ai,{title:"Learning Styles",category:"learningStyleOptions"}),n.jsx(ai,{title:"Languages",category:"languageOptions"}),n.jsx(ai,{title:"Tones",category:"toneOptions"})]}),n.jsx("div",{className:"border-t border-border pt-6",children:n.jsx(i1,{})})]})]}),o1=({isOpen:r,onClose:g,suggestedTopics:l,onApply:u})=>{const[f,i]=U.useState(new Map),o=U.useRef(null);Yt(o,r);const m=U.useMemo(()=>{const y=new Set([...l.include,...l.exclude]);return Array.from(y).sort()},[l]);U.useEffect(()=>{if(r){const y=new Map;m.forEach(_=>{l.include.includes(_)?y.set(_,"include"):l.exclude.includes(_)?y.set(_,"exclude"):y.set(_,"ignore")}),i(y)}},[r,m,l]);const x=(y,_)=>{i(b=>new Map(b).set(y,_))},d=()=>{const y=[],_=[];for(const[b,D]of f.entries())D==="include"?y.push(b):D==="exclude"&&_.push(b);u({included:y,excluded:_})};if(!r)return null;const j=(y,_)=>`px-3 py-1 text-xs rounded-full cursor-pointer transition-colors border ${y===_?"font-semibold "+(y==="include"?"bg-green-100 dark:bg-green-900/50 border-green-500 text-green-700 dark:text-green-300":y==="exclude"?"bg-red-100 dark:bg-red-900/50 border-red-500 text-red-700 dark:text-red-300":"bg-background border-border text-text-muted"):"bg-surface hover:bg-border/50 border-border text-text-muted"}`;return n.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-75 flex items-center justify-center z-[70] p-4",children:n.jsxs("div",{ref:o,className:"bg-surface rounded-lg shadow-xl w-full max-w-2xl transform transition-all relative max-h-[90vh] flex flex-col",children:[n.jsxs("header",{className:"flex-shrink-0 flex justify-between items-center p-4 border-b border-border",children:[n.jsx("h2",{className:"text-xl font-bold",children:"Categorize AI Topic Suggestions"}),n.jsx(ce,{type:"button",variant:"ghost",onClick:g,className:"p-1 h-auto",children:n.jsx(te,{name:"x"})})]}),n.jsxs("main",{className:"flex-grow p-6 overflow-y-auto",children:[n.jsx("p",{className:"text-sm text-text-muted mb-4",children:"Review the topics suggested by the AI. Choose whether to include, exclude, or ignore each one."}),n.jsx("ul",{className:"space-y-2",children:m.map(y=>n.jsxs("li",{className:"flex items-center justify-between p-3 bg-background rounded-md border border-border",children:[n.jsx("span",{className:"text-text flex-grow",children:y}),n.jsxs("div",{className:"flex items-center gap-2 flex-shrink-0",children:[n.jsxs("label",{className:j("include",f.get(y)),children:[n.jsx("input",{type:"radio",name:`topic-${y}`,checked:f.get(y)==="include",onChange:()=>x(y,"include"),className:"sr-only"}),"Include"]}),n.jsxs("label",{className:j("exclude",f.get(y)),children:[n.jsx("input",{type:"radio",name:`topic-${y}`,checked:f.get(y)==="exclude",onChange:()=>x(y,"exclude"),className:"sr-only"}),"Exclude"]}),n.jsxs("label",{className:j("ignore",f.get(y)),children:[n.jsx("input",{type:"radio",name:`topic-${y}`,checked:f.get(y)==="ignore",onChange:()=>x(y,"ignore"),className:"sr-only"}),"Ignore"]})]})]},y))})]}),n.jsxs("footer",{className:"flex-shrink-0 flex justify-end p-4 bg-background/50 border-t border-border",children:[n.jsx(ce,{type:"button",variant:"secondary",onClick:g,className:"mr-2",children:"Cancel"}),n.jsx(ce,{type:"button",variant:"primary",onClick:d,children:"Apply Selections"})]})]})})},c1=({isOpen:r,onClose:g,onGenerate:l})=>{const[u,f]=U.useState(1),[i,o]=U.useState(!1),[m,x]=U.useState(!1),[d,j]=U.useState("series"),[y,_]=U.useState(!1),[b,D]=U.useState({topic:"",understandingLevel:"Auto",learningGoal:"Auto",learningStyle:"Auto",language:"English",tone:"Auto",comprehensiveness:"Standard",customInstructions:"",topicsToInclude:"",topicsToExclude:""}),[w,N]=U.useState([]),[S,O]=U.useState(""),[C,M]=U.useState(""),[R,$]=U.useState(null),[X,J]=U.useState(""),[Y,H]=U.useState(void 0),[K,q]=U.useState([]),[W,A]=U.useState(""),[B,z]=U.useState(!1),[Q,ue]=U.useState(!1),[ee,V]=U.useState(null),[E,L]=U.useState("default"),[se,ie]=U.useState(.7),{addToast:oe}=Mt(),Ne=U.useRef(null),we=U.useRef(null),je=U.useRef(null),ve=U.useRef(null);Yt(Ne,r);const{options:Me}=zd();U.useEffect(()=>{var _e;(_e=je.current)==null||_e.scrollIntoView({behavior:"smooth"})},[K]),U.useEffect(()=>{const _e=ve.current;_e&&(_e.style.height="auto",_e.style.height=`${_e.scrollHeight}px`)},[W]);const Fe=U.useMemo(()=>d==="series"?"series-scaffold":y?"deck-learning":"deck-quiz",[d,y]),Pe=U.useCallback(()=>{f(1),o(!1),j("series"),_(!1),D({topic:"",understandingLevel:"Auto",learningGoal:"Auto",learningStyle:"Auto",language:"English",tone:"Auto",comprehensiveness:"Standard",customInstructions:"",topicsToInclude:"",topicsToExclude:""}),N([]),O(""),M(""),$(null),J(""),H(void 0),q([]),A(""),g()},[g]),Re=(_e,pe)=>{D(Be=>({...Be,[_e]:pe}))},k=async _e=>{const pe=_e.target.files;if(pe){const Be=[];for(const He of Array.from(pe))try{const Xe=He,qe=await Xe.text();Be.push({name:Xe.name,content:qe})}catch{oe(`Could not read file "${He.name}".`,"error")}N(He=>[...He,...Be]),oe(`${Be.length} file(s) loaded successfully.`,"success")}},xe=_e=>{N(pe=>pe.filter(Be=>Be.name!==_e))},he=async()=>{var _e;if(!((_e=b.topic)!=null&&_e.trim())){oe("Please enter a primary topic first to get suggestions.","error");return}x(!0);try{const pe=await Vb(b.topic);V({include:pe.topicsToInclude,exclude:pe.topicsToExclude}),ue(!0)}catch(pe){oe(pe instanceof Error?pe.message:"Failed to get topic suggestions.","error")}finally{x(!1)}},Z=_e=>{var qe,Ge;const pe=((qe=b.topicsToInclude)==null?void 0:qe.split(",").map(at=>at.trim()).filter(Boolean))||[],Be=[...new Set([...pe,..._e.included])].join(", "),He=((Ge=b.topicsToExclude)==null?void 0:Ge.split(",").map(at=>at.trim()).filter(Boolean))||[],Xe=[...new Set([...He,..._e.excluded])].join(", ");D(at=>({...at,topicsToInclude:Be,topicsToExclude:Xe})),ue(!1),V(null)},P=()=>{var qe,Ge,at;const pe=[w.map(Je=>`--- Start of ${Je.name} ---
${Je.content}
--- End of ${Je.name} ---`).join(`

`),C.trim()].filter(Boolean).join(`

`),Be=Me.personas.find(Je=>Je.id===E),He=E==="custom"?b.customInstructions:Be==null?void 0:Be.instruction,Xe=K.map(Je=>`${Je.role==="user"?"User":"AI"}: ${Je.text}`).join(`
`);return{...b,topic:((qe=b.topic)==null?void 0:qe.trim())||"Content from provided sources",generationType:Fe,isLearningMode:y,finalTitle:X,questionCount:Y,brainstormHistory:Xe,sourceContent:pe||void 0,sourceUrl:S.trim()||void 0,topicsToInclude:((Ge=b.topicsToInclude)==null?void 0:Ge.trim())||void 0,topicsToExclude:((at=b.topicsToExclude)==null?void 0:at.trim())||void 0,systemInstruction:He||void 0,temperature:se,customFields:Me.customFields}},ae=async()=>{var _e;if(!((_e=b.topic)!=null&&_e.trim())&&!w.length&&!C.trim()&&!S.trim()){oe("Please provide a topic or source material.","error");return}o(!0);try{const pe=P(),Be=await Kb(pe);if($(Be),J(Be.titleSuggestions[0]||b.topic),Be.questionCountSuggestions.length>0){const Xe=Be.questionCountSuggestions.find(qe=>qe.label.toLowerCase().includes("standard"))||Be.questionCountSuggestions[0];Xe&&H(Xe.count)}const He={id:crypto.randomUUID(),role:"model",text:`${Be.interpretation}

To help create the best content, can you answer these questions?
- ${Be.followUpQuestions.join(`
- `)}`};q([He]),f(2)}catch(pe){oe(pe instanceof Error?pe.message:"Failed to get AI analysis.","error")}finally{o(!1)}},fe=U.useCallback(async _e=>{_e.preventDefault();const pe=W.trim();if(!pe||i)return;const Be={id:crypto.randomUUID(),role:"user",text:pe},He={id:crypto.randomUUID(),role:"model",text:"",isLoading:!0},Xe=[...K,Be,He];q(Xe),A(""),o(!0);try{const qe=P(),Ge=await Zb(qe,[...K,Be]),at={id:crypto.randomUUID(),role:"model",text:Ge};q(Je=>[...Je.slice(0,-1),at])}catch(qe){const Ge={id:crypto.randomUUID(),role:"model",text:qe instanceof Error?qe.message:"An unknown error occurred."};q(at=>[...at.slice(0,-1),Ge])}finally{o(!1)}},[W,i,K,P]),Ae=_e=>{_e.key==="Enter"&&!_e.shiftKey&&(_e.preventDefault(),fe({preventDefault:()=>{}}))},de=_e=>{_e.preventDefault(),u===1?ae():(l(P()),Pe())};if(!r)return null;const Ue=()=>{var _e;return n.jsxs(n.Fragment,{children:[n.jsxs("div",{children:[n.jsx("label",{htmlFor:"topic",className:"block text-sm font-bold text-text mb-1",children:"Primary Topic"}),n.jsx("input",{id:"topic",type:"text",value:b.topic,onChange:pe=>Re("topic",pe.target.value),className:"w-full p-2 bg-background border border-border rounded-md focus:ring-2 focus:ring-primary focus:outline-none",placeholder:"e.g., The History of Ancient Rome",autoFocus:!0}),n.jsx("p",{className:"text-xs text-text-muted mt-1",children:"The main subject of the content you want to generate. Also used if no other sources are provided."})]}),n.jsxs("div",{className:"space-y-4",children:[n.jsx("h3",{className:"text-sm font-bold text-text",children:"Source Material (Optional)"}),n.jsxs("div",{children:[n.jsx("input",{type:"file",ref:we,multiple:!0,className:"hidden",accept:".txt,.md,.html",onChange:k}),n.jsxs(ce,{type:"button",variant:"secondary",onClick:()=>{var pe;return(pe=we.current)==null?void 0:pe.click()},className:"w-full",children:[n.jsx(te,{name:"upload-cloud",className:"w-5 h-5 mr-2"}),"Upload Files"]}),w.length>0&&n.jsx("ul",{className:"mt-2 space-y-1 max-h-24 overflow-y-auto",children:w.map(pe=>n.jsxs("li",{className:"flex items-center justify-between text-sm bg-background p-2 rounded-md border border-border",children:[n.jsxs("div",{className:"flex items-center gap-2 min-w-0",children:[n.jsx(te,{name:"file-text",className:"w-4 h-4 text-text-muted flex-shrink-0"}),n.jsx("span",{className:"truncate",title:pe.name,children:pe.name})]}),n.jsx(ce,{type:"button",variant:"ghost",size:"sm",className:"p-1 h-auto",onClick:()=>xe(pe.name),children:n.jsx(te,{name:"trash-2",className:"w-4 h-4 text-red-500"})})]},pe.name))})]}),n.jsxs("div",{children:[n.jsx("label",{htmlFor:"source-url",className:"block text-sm font-medium text-text-muted mb-1",children:"From URL"}),n.jsxs("div",{className:"relative",children:[n.jsx(te,{name:"link",className:"absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-text-muted"}),n.jsx("input",{id:"source-url",type:"url",value:S,onChange:pe=>O(pe.target.value),className:"w-full p-2 pl-9 bg-background border border-border rounded-md focus:ring-2 focus:ring-primary focus:outline-none",placeholder:"https://..."})]})]}),n.jsxs("div",{children:[n.jsx("label",{htmlFor:"paste-source",className:"block text-sm font-medium text-text-muted mb-1",children:"Paste Text"}),n.jsx("textarea",{id:"paste-source",value:C,onChange:pe=>M(pe.target.value),rows:4,className:"w-full p-2 bg-background border border-border rounded-md focus:ring-2 focus:ring-primary focus:outline-none",placeholder:"Paste an article, notes, or any other text..."})]})]}),n.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4",children:[n.jsxs("div",{children:[n.jsx("label",{htmlFor:"generation-target",className:"block text-sm font-medium text-text-muted mb-1",children:"Content Type"}),n.jsxs("select",{id:"generation-target",value:d,onChange:pe=>j(pe.target.value),className:"w-full p-2 bg-background border border-border rounded-md focus:ring-2 focus:ring-primary focus:outline-none",children:[n.jsx("option",{value:"series",children:"Series"}),n.jsx("option",{value:"deck",children:"Single Deck"})]})]}),n.jsxs("div",{children:[n.jsx("label",{htmlFor:"comprehensiveness",className:"block text-sm font-medium text-text-muted mb-1",children:"Comprehensiveness"}),n.jsx("select",{id:"comprehensiveness",value:b.comprehensiveness,onChange:pe=>Re("comprehensiveness",pe.target.value),className:"w-full p-2 bg-background border border-border rounded-md focus:ring-2 focus:ring-primary focus:outline-none",children:Me.comprehensivenessLevels.map(pe=>n.jsx("option",{value:pe,children:pe},pe))})]}),n.jsxs("div",{children:[n.jsx("label",{htmlFor:"language",className:"block text-sm font-medium text-text-muted mb-1",children:"Language"}),n.jsxs("select",{id:"language",value:b.language,onChange:pe=>Re("language",pe.target.value),className:"w-full p-2 bg-background border border-border rounded-md focus:ring-2 focus:ring-primary focus:outline-none",children:[n.jsx("option",{value:"English",children:"English"}),n.jsx("option",{value:"Swedish",children:"Swedish"})]})]})]}),n.jsx(ri,{label:"Learning Mode",description:"Generates info sections followed by questions.",checked:y,onChange:_}),n.jsxs("div",{className:"space-y-4 pt-4 border-t border-border",children:[n.jsx("h3",{className:"text-sm font-bold text-text -mb-2",children:"Fine-Tuning"}),n.jsxs("div",{children:[n.jsx("label",{htmlFor:"persona",className:"block text-sm font-medium text-text-muted mb-1",children:"AI Persona"}),n.jsxs("select",{id:"persona",value:E,onChange:pe=>L(pe.target.value),className:"w-full p-2 bg-background border border-border rounded-md focus:ring-2 focus:ring-primary focus:outline-none",children:[Me.personas.map(pe=>n.jsx("option",{value:pe.id,children:pe.name},pe.id)),n.jsx("option",{value:"custom",children:"Custom..."})]})]}),E==="custom"&&n.jsxs("div",{children:[n.jsx("label",{htmlFor:"custom-instructions",className:"block text-sm font-medium text-text-muted mb-1",children:"Custom Instructions"}),n.jsx("textarea",{id:"custom-instructions",value:b.customInstructions,onChange:pe=>Re("customInstructions",pe.target.value),rows:3,className:"w-full p-2 bg-background border border-border rounded-md",placeholder:"e.g., 'Act as a pirate and explain everything in character...'"})]}),n.jsxs("div",{children:[n.jsxs("label",{htmlFor:"temperature",className:"block text-sm font-medium text-text-muted mb-1",children:["Creativity vs. Precision (",se.toFixed(1),")"]}),n.jsx("input",{id:"temperature",type:"range",min:"0",max:"1",step:"0.1",value:se,onChange:pe=>ie(parseFloat(pe.target.value)),className:"w-full"})]}),n.jsxs("div",{children:[n.jsx("label",{htmlFor:"topics-to-include",className:"block text-sm font-medium text-text-muted mb-1",children:"Topics to Include (comma-separated)"}),n.jsx("textarea",{id:"topics-to-include",value:b.topicsToInclude,onChange:pe=>Re("topicsToInclude",pe.target.value),rows:2,className:"w-full p-2 bg-background border border-border rounded-md",placeholder:"e.g., 'republican era', 'julius caesar'"})]}),n.jsx("div",{className:"text-center -my-2",children:n.jsxs(ce,{type:"button",variant:"ghost",onClick:he,disabled:!((_e=b.topic)!=null&&_e.trim())||m||i,className:"px-2","aria-label":"Get AI suggestions for topics to include and exclude",children:[m?n.jsx(tn,{size:"sm"}):n.jsx(te,{name:"zap",className:"w-4 h-4 mr-1"})," Suggest Topics"]})}),n.jsxs("div",{children:[n.jsx("label",{htmlFor:"topics-to-exclude",className:"block text-sm font-medium text-text-muted mb-1",children:"Topics to Exclude (comma-separated)"}),n.jsx("textarea",{id:"topics-to-exclude",value:b.topicsToExclude,onChange:pe=>Re("topicsToExclude",pe.target.value),rows:2,className:"w-full p-2 bg-background border border-border rounded-md",placeholder:"e.g., 'imperial era', 'byzantine history'"})]})]})]})},Le=()=>n.jsxs("div",{className:"h-full flex flex-col",children:[n.jsxs("div",{className:"flex-grow overflow-y-auto space-y-4 -mx-6 px-6",children:[K.map(_e=>n.jsxs("div",{className:`flex gap-3 ${_e.role==="user"?"justify-end":"justify-start"}`,children:[_e.role==="model"&&n.jsx(te,{name:"bot",className:"w-6 h-6 text-primary flex-shrink-0 mt-1"}),n.jsx("div",{className:`max-w-md p-3 rounded-2xl ${_e.role==="user"?"bg-primary text-on-primary rounded-br-lg":"bg-background rounded-bl-lg"}`,children:_e.isLoading?n.jsxs("div",{className:"flex items-center gap-2",children:[n.jsx(tn,{size:"sm"}),n.jsx("span",{className:"text-text-muted",children:"Thinking..."})]}):n.jsx("p",{className:"whitespace-pre-wrap",children:_e.text})})]},_e.id)),n.jsx("div",{ref:je})]}),n.jsxs("div",{className:"flex-shrink-0 flex items-start gap-2 pt-4",children:[n.jsx("textarea",{ref:ve,value:W,onChange:_e=>A(_e.target.value),onKeyDown:Ae,placeholder:"Your response... (Shift+Enter for new line)",className:"flex-grow p-2 bg-background border border-border rounded-lg focus:ring-2 focus:ring-primary focus:outline-none px-4 resize-none overflow-y-auto",rows:1,style:{maxHeight:"120px"},disabled:i}),n.jsx(ce,{type:"button",onClick:fe,variant:"primary",className:"rounded-full w-10 h-10 p-0 flex-shrink-0","aria-label":"Send message",disabled:i,children:n.jsx(te,{name:"arrow-down",className:"w-5 h-5 -rotate-90"})})]})]});return n.jsxs(n.Fragment,{children:[n.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-75 flex items-center justify-center z-[60] p-4",children:n.jsx("div",{ref:Ne,className:"bg-surface rounded-lg shadow-xl w-full max-w-2xl transform transition-all relative max-h-[90vh] flex flex-col",children:B?n.jsx(l1,{onBack:()=>z(!1)}):n.jsxs(n.Fragment,{children:[n.jsxs("header",{className:"flex-shrink-0 flex justify-between items-center p-4 border-b border-border",children:[n.jsxs("h2",{className:"text-xl font-bold",children:["Generate with AI (Step ",u," of 2)"]}),n.jsx(ce,{type:"button",variant:"ghost",onClick:Pe,className:"p-1 h-auto",disabled:i,children:n.jsx(te,{name:"x"})})]}),n.jsx("main",{className:"flex-grow p-6 overflow-y-auto",children:n.jsx("form",{id:"ai-gen-form",onSubmit:de,className:"space-y-6 h-full",children:u===1?Ue():Le()})}),n.jsxs("footer",{className:"flex-shrink-0 flex justify-between items-center p-4 bg-background/50 border-t border-border",children:[u===1?n.jsxs(ce,{type:"button",variant:"ghost",onClick:()=>z(!0),children:[n.jsx(te,{name:"settings",className:"w-4 h-4 mr-2"})," Manage Options"]}):n.jsxs(ce,{type:"button",variant:"ghost",onClick:()=>f(1),children:[n.jsx(te,{name:"chevron-left",className:"w-4 h-4 mr-2"})," Back"]}),n.jsxs("div",{className:"flex gap-2",children:[n.jsx(ce,{type:"button",variant:"secondary",onClick:Pe,children:"Cancel"}),n.jsx(ce,{type:"submit",form:"ai-gen-form",variant:"primary",disabled:i,children:i?n.jsx(tn,{size:"sm"}):u===1?n.jsxs(n.Fragment,{children:["Next ",n.jsx(te,{name:"chevron-left",className:"w-4 h-4 ml-2 rotate-180"})]}):n.jsxs(n.Fragment,{children:[n.jsx(te,{name:"zap",className:"w-4 h-4 mr-2"})," Generate Content"]})})]})]})]})})}),Q&&ee&&n.jsx(o1,{isOpen:Q,onClose:()=>ue(!1),suggestedTopics:ee,onApply:Z})]})},u1=({isOpen:r,onClose:g,onCancel:l})=>{const{currentTask:u,queue:f}=et(x=>x.aiGenerationStatus),i=U.useRef(null);Yt(i,r);const o=()=>{l()},m=x=>{l(x)};return r?n.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-75 flex items-center justify-center z-[60] p-4",children:n.jsxs("div",{ref:i,className:"bg-surface rounded-lg shadow-xl w-full max-w-lg transform transition-all relative max-h-[90vh] flex flex-col",role:"dialog","aria-modal":"true","aria-labelledby":"ai-status-title",children:[n.jsxs("div",{className:"flex-shrink-0 flex justify-between items-center p-4 border-b border-border",children:[n.jsx("h2",{id:"ai-status-title",className:"text-xl font-bold text-text",children:"AI Generation Status"}),n.jsx(ce,{type:"button",variant:"ghost",onClick:g,className:"p-1 h-auto","aria-label":"Close",children:n.jsx(te,{name:"x"})})]}),n.jsxs("div",{className:"p-6 overflow-y-auto space-y-6",children:[n.jsxs("div",{children:[n.jsx("h3",{className:"text-sm font-semibold uppercase tracking-wider text-text-muted mb-2",children:"Current Task"}),n.jsx("div",{className:"bg-background p-4 rounded-lg",children:u?n.jsxs("div",{className:"flex items-center gap-4",children:[n.jsx(tn,{size:"sm"}),n.jsx("p",{className:"text-text-muted flex-grow",children:u.statusText||"Processing your request..."}),n.jsx(ce,{variant:"danger",size:"sm",onClick:o,children:"Cancel"})]}):n.jsx("p",{className:"text-text-muted text-center py-4",children:"No AI tasks are currently running."})})]}),f&&f.length>0&&n.jsxs("div",{children:[n.jsxs("h3",{className:"text-sm font-semibold uppercase tracking-wider text-text-muted mb-2",children:["Queued Tasks (",f.length,")"]}),n.jsx("ul",{className:"space-y-2",children:f.map(x=>n.jsxs("li",{className:"bg-background p-3 rounded-lg flex items-center justify-between gap-4",children:[n.jsx("p",{className:"text-text-muted text-sm truncate flex-grow",children:x.statusText}),n.jsx(ce,{variant:"ghost",size:"sm",className:"p-1 h-auto hover:text-red-500",onClick:()=>m(x.id),"aria-label":`Cancel task: ${x.statusText}`,children:n.jsx(te,{name:"x-circle",className:"w-5 h-5"})})]},x.id))})]})]}),n.jsx("div",{className:"flex-shrink-0 flex justify-end p-4 bg-background/50 border-t border-border",children:n.jsx(ce,{type:"button",variant:"primary",onClick:g,children:"Close"})})]})}):null},d1=({isOpen:r,onClose:g,onRestore:l,onDelete:u})=>{const[f,i]=U.useState([]),[o,m]=U.useState(!1),[x,d]=U.useState(null),[j,y]=U.useState(null),{addToast:_}=Mt(),b=U.useRef(null);Yt(b,r),U.useEffect(()=>{r&&(async()=>{m(!0),d(null),y("Loading sync file info...");try{const[S,{metadata:O}]=await Promise.all([H0(),ii()]),C=S.sort((M,R)=>new Date(R.modified).getTime()-new Date(M.modified).getTime());if(i(C),O){const M=new Date(O.modified),R=(O.size/1024).toFixed(1);y(`Live sync file: ${M.toLocaleString()} (${R} KB)`)}else y("No live sync file found on server.")}catch(S){const O=S instanceof Error?S.message:"Failed to load backups.";d(O),y("Could not retrieve live sync file info.")}finally{m(!1)}})()},[r]);const D=N=>{l(N),g()},w=async N=>{try{await u(N),i(S=>S.filter(O=>O.filename!==N)),_(`Deleted backup: ${N}`,"success")}catch{}};return n.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-75 flex items-center justify-center z-[60] p-4",children:n.jsxs("div",{ref:b,className:"bg-surface rounded-lg shadow-xl w-full max-w-2xl transform transition-all relative max-h-[90vh] flex flex-col",children:[n.jsxs("div",{className:"flex-shrink-0 flex justify-between items-center p-4 border-b border-border",children:[n.jsx("h2",{className:"text-xl font-bold",children:"Manage Server Backups"}),n.jsx(ce,{type:"button",variant:"ghost",onClick:g,className:"p-1 h-auto",children:n.jsx(te,{name:"x"})})]}),n.jsxs("div",{className:"p-6 overflow-y-auto",children:[n.jsx("p",{className:"text-text-muted mb-2",children:"Select a backup to restore your live sync data from, or delete old backups. Restoring will overwrite the current sync file on the server."}),j&&n.jsx("p",{className:"text-sm text-text-muted mb-4 p-2 bg-background rounded-md",children:j}),o?n.jsx("div",{className:"text-center py-8",children:n.jsx(tn,{})}):x?n.jsx("div",{className:"text-center py-8 text-red-500",children:x}):f.length>0?n.jsx("div",{className:"space-y-2 border border-border rounded-md",children:f.map(N=>n.jsxs("div",{className:"flex items-center justify-between p-3 hover:bg-background border-b border-border last:border-b-0",children:[n.jsxs("div",{className:"text-sm min-w-0",children:[n.jsx("p",{className:"font-medium text-text truncate",children:N.filename}),n.jsxs("p",{className:"text-text-muted",children:[new Date(N.modified).toLocaleString()," - ",(N.size/1024).toFixed(2)," KB"]})]}),n.jsxs("div",{className:"flex-shrink-0 flex items-center gap-1",children:[n.jsx(ce,{variant:"secondary",size:"sm",onClick:()=>D(N.filename),children:"Restore"}),n.jsx(ce,{variant:"danger",size:"sm",onClick:()=>w(N.filename),children:"Delete"})]})]},N.filename))}):n.jsx("div",{className:"text-center py-8 text-text-muted",children:n.jsx("p",{children:"No server backups found."})})]}),n.jsx("div",{className:"flex-shrink-0 flex justify-end p-4 bg-background/50 border-t border-border",children:n.jsx(ce,{type:"button",variant:"primary",onClick:g,children:"Close"})})]})})},f1=({isOpen:r,onClose:g,onConfirm:l,analysis:u})=>{const[f,i]=U.useState(""),o=U.useRef(null);Yt(o,r),U.useEffect(()=>{u.type==="quiz"&&u.data.name?i(u.data.name):i("")},[u]);const{title:m,message:x,confirmText:d}=U.useMemo(()=>{switch(u.type){case"backup":return{title:"Restore from Backup",message:`You dropped the backup file "${u.fileName}". Restoring will merge its content with your current data. Do you want to continue?`,confirmText:"Restore"};case"series":return{title:"Import Series",message:`You dropped a file containing the series "${u.data.seriesName}". Would you like to import it?`,confirmText:"Import Series"};case"quiz":return{title:"Import Quiz Deck",message:`You dropped a file for the quiz deck "${u.data.name}". Would you like to import it?`,confirmText:"Import Deck"};case"flashcard":return{title:"Import Flashcard Deck",message:`You dropped a file with ${u.data.length} flashcard(s). Please provide a name for the new deck.`,confirmText:"Import Deck"};default:return{title:"Confirm Import",message:"Unknown file type.",confirmText:"Confirm"}}},[u]),j=u.type==="flashcard"&&!f.trim(),y=()=>{l(u,f.trim())};return r?n.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-75 flex items-center justify-center z-[60] p-4",children:n.jsxs("div",{ref:o,className:"bg-surface rounded-lg shadow-xl w-full max-w-lg transform transition-all relative",children:[n.jsxs("div",{className:"flex justify-between items-center p-4 border-b border-border",children:[n.jsx("h2",{className:"text-xl font-bold text-text",children:m}),n.jsx(ce,{type:"button",variant:"ghost",onClick:g,className:"p-1 h-auto","aria-label":"Close",children:n.jsx(te,{name:"x"})})]}),n.jsxs("div",{className:"p-6 space-y-4",children:[n.jsx("p",{className:"text-text-muted",children:x}),(u.type==="flashcard"||u.type==="quiz")&&n.jsxs("div",{children:[n.jsx("label",{htmlFor:"deck-name-input",className:"block text-sm font-medium text-text-muted mb-1",children:"Deck Name"}),n.jsx("input",{id:"deck-name-input",type:"text",value:f,onChange:_=>i(_.target.value),className:"w-full p-2 bg-background border border-border rounded-md focus:ring-2 focus:ring-primary focus:outline-none",placeholder:"Enter a name for the new deck",autoFocus:!0})]})]}),n.jsxs("div",{className:"flex justify-end p-4 bg-background/50 border-t border-border",children:[n.jsx(ce,{type:"button",variant:"secondary",onClick:g,className:"mr-2",children:"Cancel"}),n.jsx(ce,{type:"button",variant:"primary",onClick:y,disabled:j,children:d})]})]})}):null},h1=()=>{throw new Error("AI features are disabled. A Google Gemini API key is required.")},m1={type:Ze.ARRAY,description:"An array of one or more actions the user wants to perform. If the user is just chatting, return an array with a single NO_ACTION.",items:{type:Ze.OBJECT,properties:{action:{type:Ze.STRING,enum:Object.values(Ta),description:"The specific action the user wants to perform. Use NO_ACTION for conversational replies."},payload:{type:Ze.OBJECT,description:"The data needed to perform the action. Include only necessary fields.",properties:{deckId:{type:Ze.STRING,description:"The ID of the target deck."},folderId:{type:Ze.STRING,description:"The ID of the target folder. Use null to move a deck out of a folder."},name:{type:Ze.STRING,description:"The name for a new deck or folder."},newName:{type:Ze.STRING,description:"The new name for a deck or folder being renamed."},seriesId:{type:Ze.STRING,description:"The ID of the target series for expansion."},levelIndex:{type:Ze.NUMBER,description:"The 0-based index of the level within the series to add decks to."},count:{type:Ze.NUMBER,description:"The number of questions to generate for a deck."}}},confirmationMessage:{type:Ze.STRING,description:"A friendly message to the user asking them to confirm the action. For a NO_ACTION, this should be the AI's conversational reply."}},required:["action","payload","confirmationMessage"]}},p1=async(r,g)=>{const l=h1(),u=g.decks.map(m=>`- Deck: "${m.name}" (id: ${m.id}, folderId: ${m.folderId||"none"})`).join(`
`),f=g.folders.map(m=>`- Folder: "${m.name}" (id: ${m.id})`).join(`
`),i=g.series.map(m=>{const x=(m.levels||[]).map((d,j)=>`  - Level ${j}: ${d.title} (${(d.deckIds||[]).length} decks)`).join(`
`);return`- Series: "${m.name}" (id: ${m.id})
${x}`}).join(`
`),o=`
        You are an AI assistant for the 'CogniFlow' flashcard app. Your goal is to help users manage their decks and folders by interpreting their natural language requests.

        You MUST respond with a JSON object that is an array of actions, conforming to the provided schema.

        **Your Capabilities:**
        - Create, rename, move, and delete decks.
        - Create, rename, and delete folders.
        - Analyze and expand learning series by adding new levels or decks.
        - Generate new, unique questions for a specific quiz deck, with support for HTML formatting (e.g., \`<b>\`, \`<i>\`, \`<ruby>\`).

        **Instructions:**
        1.  Analyze the user's request.
        2.  Analyze the provided application state to find the relevant IDs for decks and folders mentioned by name.
        3.  If the user's request is ambiguous (e.g., "delete the history deck" when multiple exist), ask for clarification by using the 'NO_ACTION' type and formulating a question in the 'confirmationMessage'.
        4.  If the user is just chatting or asking a question you can't perform an action for, use the 'NO_ACTION' type and provide a helpful response in the 'confirmationMessage'.
        5.  For any action that modifies data, construct a clear and concise 'confirmationMessage' that will be presented as a button for the user to approve. Example: "Delete 'Ancient Rome' Deck?" or "Create 'Languages' Folder?".
        6.  For MOVE_DECK_TO_FOLDER, if the user wants to move a deck out of a folder, the 'folderId' in the payload should be \`null\`.
        7.  For EXPAND_SERIES_ADD_DECKS, you must identify the correct series by name to get its ID, and determine the correct 0-based 'levelIndex' from the user's request (e.g., "add a deck to the first level" means levelIndex: 0).
        8.  For GENERATE_QUESTIONS_FOR_DECK, identify the target deck by name to get its ID. If the user specifies a number (e.g., "add 10 questions"), include it in the 'count' payload property. The generated content should leverage HTML formatting where appropriate for clarity (e.g., using <b> for emphasis or <ruby> for annotations in language decks).

        **Current Application State:**
        
        **Folders:**
        ${f||"No folders exist."}
        
        **Decks:**
        ${u||"No decks exist."}

        **Series:**
        ${i||"No series exist."}
    `;try{const x=(await l.models.generateContent({model:"gemini-2.5-flash",contents:r,config:{systemInstruction:o,responseMimeType:"application/json",responseSchema:m1}})).text.trim(),d=JSON.parse(x);if(!Array.isArray(d))throw new Error("AI response was not a valid array of actions.");return d}catch(m){throw console.error("Error getting AI response:",m),m instanceof Error&&m.message.includes("SAFETY")?new Error("The request was blocked due to safety settings. Please try a different request."):new Error("Sorry, I had trouble understanding that. Could you try rephrasing?")}},g1=({isOpen:r,onClose:g,onExecuteAction:l,history:u})=>{const{dispatch:f,decks:i,folders:o,deckSeries:m}=et(),[x,d]=U.useState(""),j=U.useRef(null);U.useEffect(()=>{var b;(b=j.current)==null||b.scrollIntoView({behavior:"smooth"})},[u]),U.useEffect(()=>{r&&qg(u)},[u,r]);const y=async b=>{var O;b.preventDefault();const D=x.trim();if(!D)return;d("");const w={id:crypto.randomUUID(),role:"user",text:D},N={id:crypto.randomUUID(),role:"model",text:"",isLoading:!0},S=[...u,w,N];f({type:"SET_AI_CHAT_HISTORY",payload:S});try{const C=await p1(D,{decks:i,folders:o,series:m}),M={id:crypto.randomUUID(),role:"model",text:((O=C.find(R=>R.confirmationMessage))==null?void 0:O.confirmationMessage)||"Here are the actions I can perform for you.",actions:C};f({type:"SET_AI_CHAT_HISTORY",payload:[...u,w,M]})}catch(C){const M={id:crypto.randomUUID(),role:"model",text:C instanceof Error?C.message:"An unknown error occurred."};f({type:"SET_AI_CHAT_HISTORY",payload:[...u,w,M]})}},_=b=>{l(b),g()};return r?n.jsxs("div",{className:"fixed inset-0 bg-black/50 z-[60] flex flex-col items-center justify-end",onClick:g,children:[n.jsxs("div",{className:"bg-surface w-full max-w-2xl h-[70vh] max-h-[600px] rounded-t-2xl shadow-2xl flex flex-col transform transition-transform duration-300 animate-fade-in",style:{animationName:"slideUp",animationDuration:"0.3s"},onClick:b=>b.stopPropagation(),children:[n.jsxs("header",{className:"flex-shrink-0 flex items-center justify-between p-4 border-b border-border",children:[n.jsxs("div",{className:"flex items-center gap-2",children:[n.jsx(te,{name:"bot",className:"w-6 h-6 text-primary"}),n.jsx("h2",{className:"text-xl font-bold text-text",children:"AI Assistant"})]}),n.jsx(ce,{variant:"ghost",onClick:g,className:"p-1 h-auto",children:n.jsx(te,{name:"x"})})]}),n.jsx("main",{className:"flex-grow p-4 overflow-y-auto",children:n.jsxs("div",{className:"space-y-4",children:[u.map(b=>n.jsxs("div",{className:`flex gap-3 ${b.role==="user"?"justify-end":"justify-start"}`,children:[b.role==="model"&&n.jsx(te,{name:"bot",className:"w-6 h-6 text-primary flex-shrink-0 mt-1"}),n.jsxs("div",{className:`max-w-md p-3 rounded-2xl ${b.role==="user"?"bg-primary text-on-primary rounded-br-lg":"bg-background rounded-bl-lg"}`,children:[b.isLoading?n.jsxs("div",{className:"flex items-center gap-2",children:[n.jsx(tn,{size:"sm"}),n.jsx("span",{className:"text-text-muted",children:"Thinking..."})]}):n.jsx("p",{className:"whitespace-pre-wrap",children:b.text}),b.actions&&b.actions.length>0&&n.jsx("div",{className:"mt-3 pt-3 border-t border-border/50 flex flex-wrap gap-2",children:b.actions.map((D,w)=>D.action!=="NO_ACTION"&&n.jsx(ce,{size:"sm",variant:"secondary",onClick:()=>_(D),children:D.confirmationMessage},w))})]})]},b.id)),n.jsx("div",{ref:j})]})}),n.jsx("footer",{className:"flex-shrink-0 p-4 border-t border-border",children:n.jsxs("form",{onSubmit:y,className:"flex items-center gap-2",children:[n.jsx("input",{type:"text",value:x,onChange:b=>d(b.target.value),placeholder:"e.g., 'Rename my history deck...'",className:"flex-grow p-2 bg-background border border-border rounded-full focus:ring-2 focus:ring-primary focus:outline-none px-4",autoFocus:!0}),n.jsx(ce,{type:"submit",variant:"primary",className:"rounded-full w-10 h-10 p-0","aria-label":"Send message",children:n.jsx(te,{name:"arrow-down",className:"w-5 h-5 -rotate-90"})})]})})]}),n.jsx("style",{children:`
              @keyframes slideUp {
                from { transform: translateY(100%); }
                to { transform: translateY(0); }
              }
            `})]}):null},x1=({isOpen:r,onClose:g,onRestore:l,files:u})=>{const[f,i]=U.useState(""),o=U.useRef(null);Yt(o,r);const m=()=>{f&&l(f)};return r?n.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-75 flex items-center justify-center z-[60] p-4",children:n.jsxs("div",{ref:o,className:"bg-white dark:bg-gray-800 rounded-lg shadow-xl w-full max-w-lg transform transition-all relative max-h-[90vh] flex flex-col",children:[n.jsxs("div",{className:"flex-shrink-0 flex justify-between items-center p-4 border-b border-gray-200 dark:border-gray-700",children:[n.jsx("h2",{className:"text-xl font-bold",children:"Restore from Google Drive"}),n.jsx(ce,{type:"button",variant:"ghost",onClick:g,className:"p-1 h-auto",children:n.jsx(te,{name:"x"})})]}),n.jsxs("div",{className:"p-6 overflow-y-auto",children:[n.jsx("p",{className:"text-gray-600 dark:text-gray-400 mb-4",children:"Select a backup file to restore. Restoring will overwrite decks with the same ID."}),u.length>0?n.jsx("div",{className:"space-y-2 border border-gray-200 dark:border-gray-700 rounded-md",children:u.map(x=>n.jsxs("label",{className:"flex items-center p-3 hover:bg-gray-100 dark:hover:bg-gray-700/50 cursor-pointer border-b border-gray-200 dark:border-gray-700 last:border-b-0",children:[n.jsx("input",{type:"radio",name:"backup-file",value:x.id,checked:f===x.id,onChange:()=>i(x.id),className:"h-4 w-4 text-blue-600 focus:ring-blue-500 border-gray-300 dark:border-gray-600 dark:bg-gray-900"}),n.jsxs("div",{className:"ml-3 text-sm",children:[n.jsx("p",{className:"font-medium text-gray-900 dark:text-gray-100",children:x.name}),n.jsxs("p",{className:"text-gray-500 dark:text-gray-400",children:["Last modified: ",new Date(x.modifiedTime).toLocaleString()]})]})]},x.id))}):n.jsx("div",{className:"text-center py-8 text-gray-500 dark:text-gray-400",children:n.jsx("p",{children:"No backup files found in your Google Drive application folder."})})]}),n.jsxs("div",{className:"flex-shrink-0 flex justify-end p-4 bg-gray-100/50 dark:bg-gray-900/50 border-t border-gray-200 dark:border-gray-700",children:[n.jsx(ce,{type:"button",variant:"secondary",onClick:g,className:"mr-2",children:"Cancel"}),n.jsx(ce,{type:"button",variant:"danger",onClick:m,disabled:!f,children:"Restore Selected"})]})]})}):null},y1=({isOpen:r,onClose:g,onResolve:l,localData:u,remoteData:f})=>{const i=U.useRef(null);Yt(i,r);const o=d=>{l(d),g()},m=u.lastModified?new Date(u.lastModified).toLocaleString():"N/A",x=new Date(f.modified).toLocaleString();return r?n.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-75 flex items-center justify-center z-[60] p-4",children:n.jsxs("div",{ref:i,className:"bg-surface rounded-lg shadow-xl w-full max-w-lg transform transition-all relative",role:"alertdialog","aria-modal":"true","aria-labelledby":"conflict-title",children:[n.jsx("div",{className:"flex justify-between items-center p-4 border-b border-border",children:n.jsx("h2",{id:"conflict-title",className:"text-xl font-bold text-yellow-600 dark:text-yellow-400",children:"Sync Conflict"})}),n.jsxs("div",{className:"p-6 space-y-4",children:[n.jsx("p",{className:"text-text-muted",children:"Both your local data and the server data have changed since the last sync. Please choose which version to keep."}),n.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[n.jsxs("div",{className:"p-4 border border-border rounded-lg text-center",children:[n.jsx("h3",{className:"font-semibold text-text",children:"Keep Local Changes"}),n.jsxs("p",{className:"text-xs text-text-muted mt-1",children:["Last modified: ",m]}),n.jsxs(ce,{variant:"secondary",className:"mt-4 w-full",onClick:()=>o("local"),children:[n.jsx(te,{name:"laptop",className:"mr-2"}),"Choose Local"]})]}),n.jsxs("div",{className:"p-4 border-2 border-primary rounded-lg text-center bg-primary/5",children:[n.jsx("h3",{className:"font-semibold text-text",children:"Keep Server Changes"}),n.jsxs("p",{className:"text-xs text-text-muted mt-1",children:["Last modified: ",x]}),n.jsxs(ce,{variant:"primary",className:"mt-4 w-full",onClick:()=>o("remote"),children:[n.jsx(te,{name:"upload-cloud",className:"mr-2"}),"Choose Server"]})]})]})]}),n.jsx("div",{className:"flex justify-end p-4 bg-background/50 border-t border-border",children:n.jsx(ce,{type:"button",variant:"danger",onClick:g,children:"Cancel Sync"})})]})}):null},b1=({isOpen:r,onClose:g,actions:l})=>{const[u,f]=U.useState(""),[i,o]=U.useState(0),m=U.useRef(null),x=U.useRef(null),{navigate:d}=ra(),{decks:j,deckSeries:y}=et();Yt(m,r);const _=U.useMemo(()=>{const M=[];return l.forEach(R=>M.push({type:"action",id:R.id,label:R.label,icon:R.icon,run:R.action,keywords:R.keywords,searchableOnly:R.searchableOnly})),j.filter(R=>!R.archived&&!R.deletedAt).forEach(R=>M.push({type:"deck",id:R.id,name:R.name,itemType:R.type})),y.filter(R=>!R.archived&&!R.deletedAt).forEach(R=>M.push({type:"series",id:R.id,name:R.name})),j.filter(R=>!R.archived&&!R.deletedAt).forEach(R=>{R.type==="flashcard"?(R.cards||[]).forEach($=>M.push({type:"card",id:$.id,deckId:R.id,deckName:R.name,front:$.front})):(R.questions||[]).forEach($=>M.push({type:"question",id:$.id,deckId:R.id,deckName:R.name,text:$.questionText}))}),M},[l,j,y]),b=U.useMemo(()=>{if(!u.trim())return _.filter($=>$.type==="action"&&!$.searchableOnly);const M=u.toLowerCase();return _.filter($=>{switch($.type){case"action":{const X=$,J=X.label.toLowerCase().includes(M),Y=(X.keywords||[]).some(H=>H.toLowerCase().includes(M));return J||Y}case"deck":return $.name.toLowerCase().includes(M);case"series":return $.name.toLowerCase().includes(M);case"card":return Sn($.front).toLowerCase().includes(M);case"question":return $.text.toLowerCase().includes(M);default:return!1}}).slice(0,50)},[u,_]),D=U.useMemo(()=>{const M={Actions:[],Series:[],Decks:[],Cards:[]};return b.forEach(R=>{R.type==="action"?M.Actions.push(R):R.type==="series"?M.Series.push(R):R.type==="deck"?M.Decks.push(R):(R.type==="card"||R.type==="question")&&M.Cards.push(R)}),Object.entries(M).filter(([,R])=>R.length>0)},[b]),w=U.useMemo(()=>D.flatMap(([,M])=>M),[D]),N=U.useCallback(M=>{switch(M.type){case"action":M.run();break;case"deck":d(`/decks/${M.id}`);break;case"series":d(`/series/${M.id}`);break;case"card":case"question":d(`/decks/${M.deckId}`);break}g()},[d,g]);U.useEffect(()=>{const M=R=>{if(r)if(R.key==="ArrowDown")R.preventDefault(),o($=>($+1)%(w.length||1));else if(R.key==="ArrowUp")R.preventDefault(),o($=>($-1+(w.length||1))%(w.length||1));else if(R.key==="Enter"){R.preventDefault();const $=w[i];$&&N($)}else R.key==="Escape"&&g()};return window.addEventListener("keydown",M),()=>window.removeEventListener("keydown",M)},[r,i,w,N,g]),U.useEffect(()=>{r&&(f(""),o(0))},[r]),U.useEffect(()=>{o(0)},[u]),U.useEffect(()=>{var M;(M=document.getElementById(`cmdk-item-${i}`))==null||M.scrollIntoView({block:"nearest"})},[i]);const S=M=>{M.target===M.currentTarget&&g()};if(!r)return null;const O=(M,R)=>{let $,X="",J;switch(M.type){case"action":$=M.icon,X=M.label;break;case"deck":$="help-circle",M.itemType===Ce.Flashcard?$="laptop":M.itemType===Ce.Learning&&($="layers"),X=M.name;break;case"series":$="layers",X=M.name;break;case"card":$="laptop",X=Sn(M.front),J=`In: ${M.deckName}`;break;case"question":$="help-circle",X=M.text,J=`In: ${M.deckName}`;break}return n.jsxs("li",{id:`cmdk-item-${R}`,role:"option","aria-selected":i===R,onClick:()=>N(M),className:`flex items-center gap-4 px-4 py-3 cursor-pointer rounded-md ${i===R?"bg-primary/10":"hover:bg-border/30"}`,children:[n.jsx(te,{name:$,className:"w-5 h-5 text-text-muted flex-shrink-0"}),n.jsxs("div",{className:"flex-grow min-w-0",children:[n.jsx("p",{className:`font-medium truncate ${i===R?"text-primary":"text-text"}`,children:X}),J&&n.jsx("p",{className:`text-sm truncate ${i===R?"text-primary/80":"text-text-muted"}`,children:J})]})]},M.id)};let C=0;return n.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-70 flex justify-center items-start pt-4 sm:pt-[15vh] z-[60] p-4",onClick:S,children:n.jsxs("div",{ref:m,role:"dialog","aria-modal":"true",className:"bg-surface rounded-lg shadow-xl w-full max-w-2xl transform transition-all relative max-h-[70vh] flex flex-col",children:[n.jsxs("div",{className:"flex items-center gap-2 p-4 border-b border-border",children:[n.jsx(te,{name:"search",className:"w-5 h-5 text-text-muted"}),n.jsx("input",{type:"text",value:u,onChange:M=>f(M.target.value),placeholder:"Search for anything or type a command...",className:"w-full bg-transparent focus:outline-none text-lg placeholder:text-text-muted",autoFocus:!0}),n.jsx("div",{className:"hidden sm:block text-xs text-text-muted border border-border rounded px-1.5 py-0.5",children:"ESC"})]}),n.jsx("div",{className:"flex-grow overflow-y-auto p-2",children:w.length>0?n.jsx("ul",{ref:x,role:"listbox",children:D.map(([M,R])=>n.jsxs("li",{children:[n.jsx("p",{className:"px-4 py-2 text-xs font-semibold text-text-muted uppercase tracking-wider",children:M}),n.jsx("ul",{className:"space-y-1",children:R.map($=>O($,C++))})]},M))}):n.jsx("div",{className:"text-center py-10 px-4",children:n.jsxs("p",{className:"text-text-muted",children:['No results found for "',u,'".']})})}),n.jsx("div",{className:"hidden sm:flex flex-shrink-0 justify-end items-center p-2 border-t border-border",children:n.jsxs("span",{className:"text-sm text-text-muted",children:[n.jsx(te,{name:"terminal",className:"inline-block w-4 h-4 mr-2"}),n.jsx("kbd",{className:"font-sans",children:"Cmd+K"})," to toggle"]})})]})})},v1=({isOpen:r,onClose:g,onAddDeck:l})=>{const[u,f]=U.useState(""),{addToast:i}=Mt(),o=U.useRef(null);Yt(o,r);const m=`{
  "name": "New Quiz Deck Name",
  "description": "A description for the new deck.",
  "questions": [
    {
      "questionText": "What is 2+2?",
      "options": [{"id":"1","text":"4"}, {"id":"2","text":"3"}],
      "correctAnswerId": "1",
      "detailedExplanation": "It's basic math.",
      "tags": []
    }
  ]
}`,x=j=>{if(j.preventDefault(),!u.trim()){i("JSON content cannot be empty.","error");return}try{const y=Fo(u);if(y.type!==Ce.Quiz){i("The provided JSON is not a valid Quiz Deck format.","error");return}const _={id:crypto.randomUUID(),name:y.data.name,description:y.data.description,type:Ce.Quiz,questions:y.data.questions.map(b=>({...b,id:crypto.randomUUID(),questionType:"multipleChoice",dueDate:new Date().toISOString(),interval:0,easeFactor:2.5,suspended:!1}))};l(_),i(`Successfully created and added deck: "${_.name}"`,"success"),g()}catch(y){i(y instanceof Error?y.message:"Invalid JSON format.","error")}},d=j=>{if(j.key==="Tab"){j.preventDefault();const y=j.target,_=y.selectionStart,b=y.selectionEnd;y.value=y.value.substring(0,_)+"  "+y.value.substring(b),y.selectionStart=y.selectionEnd=_+2}};return r?n.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-75 flex items-center justify-center z-[60] p-4",children:n.jsx("div",{ref:o,className:"bg-surface rounded-lg shadow-xl w-full max-w-2xl transform transition-all relative",children:n.jsxs("form",{onSubmit:x,children:[n.jsxs("div",{className:"flex justify-between items-center p-4 border-b border-border",children:[n.jsx("h2",{className:"text-xl font-bold",children:"Add New Deck to Series"}),n.jsx(ce,{type:"button",variant:"ghost",onClick:g,className:"p-1 h-auto",children:n.jsx(te,{name:"x"})})]}),n.jsxs("div",{className:"p-6",children:[n.jsx("label",{htmlFor:"json-content",className:"block text-sm font-medium text-text-muted mb-1",children:"Paste a complete quiz deck object in JSON format."}),n.jsx("textarea",{id:"json-content",value:u,onChange:j=>f(j.target.value),onKeyDown:d,rows:15,className:"w-full p-2 bg-background border border-border rounded-md focus:ring-2 focus:ring-primary focus:outline-none font-mono text-sm",placeholder:m})]}),n.jsxs("div",{className:"flex justify-end p-4 bg-background/50 border-t border-border",children:[n.jsx(ce,{type:"button",variant:"secondary",onClick:g,className:"mr-2",children:"Cancel"}),n.jsx(ce,{type:"submit",variant:"primary",children:"Create & Add Deck"})]})]})})}):null},w1=({isOpen:r,onClose:g,badJson:l,onRetry:u,onCancel:f})=>{const[i,o]=U.useState(l),{addToast:m}=Mt(),x=U.useRef(null);Yt(x,r);const d=()=>{try{const _=JSON.parse(i);u(_),g()}catch(_){m(`Still not valid JSON. ${_.message}`,"error")}},j=()=>{f(),g()},y=_=>{if(_.key==="Tab"){_.preventDefault();const b=_.target,D=b.selectionStart,w=b.selectionEnd;b.value=b.value.substring(0,D)+"  "+b.value.substring(w),b.selectionStart=b.selectionEnd=D+2}};return r?n.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-75 flex items-center justify-center z-[70] p-4",children:n.jsxs("div",{ref:x,className:"bg-surface rounded-lg shadow-xl w-full max-w-3xl transform transition-all relative max-h-[90vh] flex flex-col",children:[n.jsxs("div",{className:"flex-shrink-0 flex justify-between items-center p-4 border-b border-border",children:[n.jsx("h2",{className:"text-xl font-bold",children:"Fix AI Response"}),n.jsx(ce,{type:"button",variant:"ghost",onClick:j,className:"p-1 h-auto",children:n.jsx(te,{name:"x"})})]}),n.jsxs("div",{className:"flex-grow p-6 space-y-4 overflow-y-auto",children:[n.jsxs("div",{className:"bg-yellow-900/10 border border-yellow-500/30 rounded-lg p-4 text-sm text-yellow-800 dark:text-yellow-200",children:[n.jsxs("p",{children:[n.jsx("strong",{className:"font-bold",children:"Error:"})," The AI returned malformed JSON. This can happen if the response is too long and gets cut off. You can try to fix it manually below."]}),n.jsx("p",{className:"mt-2",children:'Common fixes include adding a missing closing quote (`"`) or bracket/brace (`]` or `}`).'})]}),n.jsxs("div",{children:[n.jsx("label",{htmlFor:"json-fix-content",className:"block text-sm font-medium text-text-muted mb-1",children:"Edit JSON response:"}),n.jsx("textarea",{id:"json-fix-content",value:i,onChange:_=>o(_.target.value),onKeyDown:y,rows:20,className:"w-full p-2 bg-background border border-border rounded-md focus:ring-2 focus:ring-primary focus:outline-none font-mono text-sm"})]})]}),n.jsxs("div",{className:"flex-shrink-0 flex justify-end p-4 bg-background/50 border-t border-border",children:[n.jsx(ce,{type:"button",variant:"secondary",onClick:j,className:"mr-2",children:"Cancel"}),n.jsxs(ce,{type:"button",variant:"primary",onClick:d,children:[n.jsx(te,{name:"refresh-ccw",className:"w-4 h-4 mr-2"}),"Retry with Fix"]})]})]})}):null},S1=({driveFiles:r})=>{const{modalType:g,modalPayload:l,closeModal:u,openModal:f}=li(),i=xx(),{decks:o,aiChatHistory:m}=et(),{navigate:x}=ra();if(!g)return null;const d=l||{};return n.jsxs(n.Fragment,{children:[g==="import"&&n.jsx(e1,{isOpen:!0,onClose:u,onAddDecks:i.handleAddDecks,onAddSeriesWithDecks:i.handleAddSeriesWithDecks}),g==="restore"&&n.jsx(t1,{isOpen:!0,onClose:u,onCompare:i.handleCompareBackup,onRestoreSelected:i.handleRestoreSelectedItems,file:d.file,onFullRestore:i.onRestoreData,openConfirmModal:j=>f("confirm",j)}),g==="resetProgress"&&n.jsx(n1,{isOpen:!0,onClose:u,onReset:i.handleResetDeckProgress,decks:o}),g==="confirm"&&n.jsx(Ud,{isOpen:!0,onClose:u,...d}),g==="folder"&&n.jsx(a1,{isOpen:!0,onClose:u,onSave:i.handleSaveFolder,folder:d.folder==="new"?null:d.folder}),g==="series"&&n.jsx(r1,{isOpen:!0,onClose:u,onSave:i.handleSaveSeries,series:d.series==="new"?null:d.series}),g==="aiGeneration"&&n.jsx(c1,{isOpen:!0,onClose:u,onGenerate:i.handleGenerateWithAI}),g==="aiStatus"&&n.jsx(u1,{isOpen:!0,onClose:u,onCancel:i.handleCancelAIGeneration}),g==="serverBackup"&&n.jsx(d1,{isOpen:!0,onClose:u,onRestore:i.handleRestoreFromServerBackup,onDelete:i.handleDeleteServerBackup}),g==="droppedFile"&&n.jsx(f1,{isOpen:!0,onClose:u,onConfirm:i.handleDroppedFileConfirm,analysis:d.analysis}),g==="aiChat"&&n.jsx(g1,{isOpen:!0,onClose:u,onExecuteAction:i.handleExecuteAIAction,history:m}),g==="restoreFromDrive"&&n.jsx(x1,{isOpen:!0,onClose:u,onRestore:i.handleRestoreFromDrive,files:r}),g==="addDeckToSeries"&&n.jsx(v1,{isOpen:!0,onClose:u,onAddDeck:j=>i.handleAddDeckToSeries(d.seriesId,j)}),g==="mergeConflict"&&n.jsx(y1,{isOpen:!0,onClose:u,onResolve:i.handleMergeResolution,localData:d.localData,remoteData:d.remoteData}),g==="commandPalette"&&n.jsx(b1,{isOpen:!0,onClose:u,actions:[{id:"import",label:"Create / Import Deck",icon:"plus",action:()=>f("import"),keywords:["new","add"]},{id:"settings",label:"Settings",icon:"settings",action:()=>x("/settings")},{id:"trash",label:"View Trash",icon:"trash-2",action:()=>x("/trash")},{id:"archive",label:"View Archive",icon:"archive",action:()=>x("/archive")},{id:"progress",label:"View Progress",icon:"trending-up",action:()=>x("/progress")}]}),g==="aiResponseFix"&&n.jsx(w1,{isOpen:!0,onClose:u,...d})]})},E1=10,j1=()=>{const[r,g]=U.useState(!0),l=U.useRef(0),u=U.useRef(!1),f=U.useCallback(()=>{const i=window.scrollY;i<=0||i<l.current?g(!0):i>l.current&&i>E1&&g(!1),l.current=i},[]);return U.useEffect(()=>{const i=()=>{u.current||(window.requestAnimationFrame(()=>{f(),u.current=!1}),u.current=!0)};return window.addEventListener("scroll",i,{passive:!0}),()=>window.removeEventListener("scroll",i)},[f]),r},N1=()=>{const{dispatch:r,...g}=et(),{aiGenerationStatus:l}=g,[u,f]=U.useState(null),[i,o]=U.useState(!1),[m,x]=U.useState(new Set),[d,j]=U.useState(null),[y,_]=U.useState("lastOpened"),[b,D]=U.useState(null),[w,N]=U.useState(new Set),[S,O]=U.useState(!1),C=U.useRef(0),[M,R]=Y0(),{addToast:$}=Mt(),{path:X,navigate:J}=ra(),{modalType:Y,openModal:H}=li(),{aiFeaturesEnabled:K,backupEnabled:q,backupApiKey:W,syncOnCellular:A}=sa(),{isOnline:B}=Od(),[z,Q]=U.useState(!1),[ue,ee]=U.useState("Never synced."),{pullToRefreshState:V,handleTouchStart:E,handleTouchMove:L,handleTouchEnd:se,REFRESH_THRESHOLD:ie}=rv(),oe=U.useRef(!1),[Ne,we]=U.useState(null),[je,ve]=U.useState(!1),[Me,Fe]=U.useState(!1),[Pe,Re]=U.useState(null),[k,xe]=U.useState([]),he=U.useCallback(qe=>{N(Ge=>{const at=new Set(Ge);return at.has(qe)?at.delete(qe):at.add(qe),at})},[]),Z=U.useCallback(()=>o(!0),[]),P=U.useCallback(()=>o(!1),[]),ae=av({sessionsToResume:m,setSessionsToResume:x,setGeneralStudyDeck:j,isGapiReady:je,isGapiSignedIn:Me,gapiUser:Pe,setDriveFiles:xe,isSyncing:z,setIsSyncing:Q,setLastSyncStatus:ee,backupEnabled:q,backupApiKey:W,syncOnCellular:A}),{fetchAndRestoreFromServer:fe,handleSync:Ae}=ae;U.useEffect(()=>{(async()=>{if(!l||!l.queue||l.currentTask||l.queue.length===0)return;console.log("[AI Queue] Picking up next task from queue.");const Ge=l.queue[0],at=new AbortController;r({type:"START_NEXT_AI_TASK",payload:{task:Ge,abortController:at}}),console.log(`[AI Queue] Starting task: ${Ge.type} (${Ge.id})`);try{switch(Ge.type){case"generateSeriesScaffoldWithAI":await ae.onGenerateSeriesScaffold(Ge.payload);break;case"generateFullSeriesFromScaffold":await ae.onGenerateSeriesScaffold(Ge.payload);break;case"generateDeckWithAI":await ae.onGenerateDeck(Ge.payload);break;case"generateLearningDeckWithAI":await ae.onGenerateLearningDeck(Ge.payload);break;case"generateQuestionsForDeck":await ae.onGenerateQuestionsForDeck(Ge.payload.deck,Ge.payload.count);break;case"generateMoreLevelsForSeries":await ae.handleAiAddLevelsToSeries(Ge.payload.seriesId);break;case"generateMoreDecksForLevel":await ae.handleAiAddDecksToLevel(Ge.payload.seriesId,Ge.payload.levelIndex);break;case"generateSeriesQuestionsInBatches":await ae.onGenerateSeriesQuestionsInBatches(Ge.payload.seriesId);break;case"generateSeriesLearningContentInBatches":await ae.onGenerateSeriesLearningContentInBatches(Ge.payload.seriesId);break;default:console.warn(`[AI Queue] Unknown task type: ${Ge.type}`)}console.log(`[AI Queue] Task completed successfully: ${Ge.type} (${Ge.id})`)}catch(Je){console.error(`[AI Queue] Task failed: ${Ge.type} (${Ge.id})`,Je),Je.name!=="AbortError"&&$(`AI Task Failed: ${Je.message}`,"error")}finally{console.log(`[AI Queue] Finishing task: ${Ge.type} (${Ge.id})`),r({type:"FINISH_CURRENT_AI_TASK"})}})()},[l.queue,l.currentTask,r,$,ae]);const de=U.useCallback(async()=>{try{console.log("[App] Starting initial data load...");const[qe,Ge,at,Je,xt,Rt]=await Promise.all([_g(),Ag(),Og(),zg(),Cd(),Gg()]);console.log(`[App] Initial data loaded from DB. Decks: ${qe.length}, Folders: ${Ge.length}, Series: ${at.length}, Sessions: ${Je.length}, Progress sets: ${Object.keys(Rt).length}, Chat history: ${xt.length}.`),r({type:"LOAD_DATA",payload:{decks:qe,folders:Ge,deckSeries:at}});const vt=new Map;if(Object.entries(Rt).forEach(([Lt,it])=>{Array.isArray(it)&&vt.set(Lt,new Set(it))}),r({type:"SET_SERIES_PROGRESS",payload:vt}),x(new Set(Je.map(Lt=>Lt.replace("session_deck_","")))),xt.length>0&&r({type:"SET_AI_CHAT_HISTORY",payload:xt}),!oe.current&&q&&qe.length===0&&Ge.length===0&&at.length===0){oe.current=!0;try{const{metadata:Lt}=await ii();Lt!=null&&Lt.size&&H("confirm",{title:"Restore from Server?",message:`Your local data is empty, but a backup was found on the server from ${new Date(Lt.modified).toLocaleString()}. Would you like to restore it?`,onConfirm:fe,confirmText:"Restore"})}catch(Lt){Lt.status!==404&&console.warn("Failed to check for server backup on initial load:",Lt)}}localStorage.getItem("cogniflow-post-merge-sync")&&(localStorage.removeItem("cogniflow-post-merge-sync"),Ae({isManual:!1,force:!0}))}catch(qe){console.error("Initialization Error during data load:",qe),f(qe),r({type:"SET_LOADING",payload:!1})}},[r,$,q,H,fe,Ae]);U.useEffect(()=>{de()},[de]),U.useEffect(()=>{const Ge=setTimeout(async()=>{if(!q||!W||!B)return;const at=localStorage.getItem("cogniflow-lastServerUpdateCheck"),Je=new Date().getTime();if(!(at&&Je-parseInt(at,10)<864e5)){console.log("[Sync Check] Performing daily check for server updates..."),localStorage.setItem("cogniflow-lastServerUpdateCheck",Je.toString());try{const{lastModified:xt}=et.getState(),Rt=localStorage.getItem("cogniflow-lastSyncTimestamp"),vt=xt!==null&&(!Rt||xt>new Date(Rt).getTime()),{metadata:Lt}=await ii(),it=Lt&&(!Rt||new Date(Lt.modified).getTime()>new Date(Rt).getTime());vt&&it?await Ae({isManual:!1}):it&&we({modified:Lt.modified,size:Lt.size})}catch(xt){console.warn("Daily check for server updates failed:",xt)}}},5e3);return()=>clearTimeout(Ge)},[q,W,B,Ae]),U.useEffect(()=>i0(()=>{$("Data updated in another tab. Refreshing...","info"),de()}),[$,de]),U.useEffect(()=>{try{const qe=localStorage.getItem("cogniflow-openFolderIds");if(qe){const Ge=JSON.parse(qe);Array.isArray(Ge)&&Ge.every(at=>typeof at=="string")&&N(new Set(Ge))}}catch(qe){console.error("Failed to load open folder IDs",qe)}},[]),U.useEffect(()=>{try{localStorage.setItem("cogniflow-openFolderIds",JSON.stringify(Array.from(w)))}catch(qe){console.error("Failed to save open folder IDs",qe)}},[w]);const{activeDeck:Ue,activeSeries:Le}=U.useMemo(()=>{const[qe]=X.split("?");if(qe.startsWith("/decks/")){const Ge=qe.split("/")[2];return{activeDeck:g.decks.find(at=>at.id===Ge)||null,activeSeries:null}}if(qe.startsWith("/series/")){const Ge=qe.split("/")[2];return{activeDeck:null,activeSeries:g.deckSeries.find(at=>at.id===Ge)||null}}return{activeDeck:null,activeSeries:null}},[X,g.decks,g.deckSeries]),_e=qe=>{var Ge;qe.preventDefault(),qe.stopPropagation(),!(Y==="import"||Y==="restore"||Y==="aiGeneration")&&(C.current++,(Ge=qe.dataTransfer.items)!=null&&Ge.length&&O(!0))},pe=qe=>{qe.preventDefault(),qe.stopPropagation(),C.current--,C.current===0&&O(!1)},Be=qe=>{qe.preventDefault(),qe.stopPropagation()},He=qe=>{qe.preventDefault(),qe.stopPropagation(),O(!1),C.current=0;const Ge=qe.dataTransfer.files[0];if(Ge)if(Ge.name.toLowerCase().endsWith(".apkg")){const at=new FileReader;at.onload=async()=>{try{const Je=at.result,xt=await tx(Je.slice(0)).catch(()=>nx(Je));xt.length>0?(ae.handleAddDecks(xt),$(`Imported ${xt.length} deck(s).`,"success")):$("No valid decks found.","info")}catch(Je){$(`Error processing Anki package: ${Je instanceof Error?Je.message:"Unknown"}`,"error")}},at.readAsArrayBuffer(Ge)}else if(Ge.name.toLowerCase().endsWith(".json")){const at=new FileReader;at.onload=async Je=>{var vt;const xt=(vt=Je.target)==null?void 0:vt.result,Rt=M0(xt);Rt?Rt.type==="backup"?H("restore",{file:Ge}):H("droppedFile",{analysis:{...Rt,fileName:Ge.name}}):$("Unsupported JSON file format.","error")},at.readAsText(Ge)}else $("Unsupported file type. Please drop a .json or .apkg file.","error")},Xe=j1();return u?n.jsx("div",{className:"min-h-screen flex items-center justify-center p-4 bg-background",children:n.jsxs("div",{className:"text-center bg-surface p-8 rounded-lg shadow-xl max-w-lg w-full border border-border",children:[n.jsx(te,{name:"x-circle",className:"w-16 h-16 text-red-500 mx-auto mb-4"}),n.jsx("h1",{className:"text-3xl font-bold text-red-500 mb-4",children:"Application Error"}),n.jsx("p",{className:"text-text-muted mb-6",children:"A critical database error occurred. Please clear website data in your browser settings, then reload."}),n.jsx(ce,{variant:"danger",onClick:()=>window.location.reload(),children:"Reload Page"})]})}):n.jsx(Vv,{value:ae,children:n.jsxs("div",{className:"min-h-screen text-text flex flex-col overflow-x-hidden",onDragEnter:_e,onDragLeave:pe,onDragOver:Be,onDrop:He,onTouchStart:E,onTouchMove:L,onTouchEnd:se,children:[n.jsx(nb,{pullDistance:V.pullDistance,isRefreshing:V.isRefreshing,threshold:ie}),n.jsx(Z0,{isOpen:i,onClose:P,onImport:()=>H("import"),onCreateSeries:()=>H("series",{series:"new"}),onGenerateAI:()=>H("aiGeneration"),onInstall:M?R:null}),n.jsxs("div",{className:"flex-1 flex flex-col",children:[n.jsx(sv,{onOpenMenu:Z,onOpenCommandPalette:()=>H("commandPalette"),activeDeck:Ue,isVisible:Xe}),n.jsxs("main",{className:"main-content-area flex-1 container mx-auto px-4 pb-4 sm:px-6 sm:pb-6 lg:px-8 lg:pb-8 pt-20 sm:pt-[5.5rem] lg:pt-24",children:[Ne&&n.jsxs("div",{className:"bg-blue-100 dark:bg-blue-900/50 border-l-4 border-blue-500 text-blue-800 dark:text-blue-200 p-4 rounded-r-lg mb-6 flex items-center justify-between gap-4 shadow-md animate-fade-in",role:"alert",children:[n.jsxs("div",{className:"flex items-center gap-3",children:[n.jsx(te,{name:"upload-cloud",className:"w-6 h-6 text-blue-500"}),n.jsxs("div",{children:[n.jsx("p",{className:"font-bold",children:"Update Available"}),n.jsxs("p",{className:"text-sm",children:["Newer data found on server from ",new Date(Ne.modified).toLocaleString(),"."]})]})]}),n.jsxs("div",{className:"flex items-center gap-2",children:[n.jsx(ce,{size:"sm",onClick:()=>{ae.handleForceFetchFromServer(),we(null)},children:"Sync Now"}),n.jsx(ce,{size:"sm",variant:"ghost",onClick:()=>we(null),children:"Dismiss"})]})]}),g.isLoading?n.jsx("div",{className:"text-center p-8",children:n.jsx(tn,{})}):n.jsx(Zv,{sessionsToResume:m,sortPreference:y,setSortPreference:_,draggedDeckId:b,setDraggedDeckId:D,openFolderIds:w,onToggleFolder:he,generalStudyDeck:d,activeDeck:Ue,activeSeries:Le,onSync:ae.handleManualSync,isSyncing:z,lastSyncStatus:ue,isGapiReady:je,isGapiSignedIn:Me,gapiUser:Pe})]})]}),n.jsx($0,{}),n.jsx(S1,{driveFiles:k}),S&&n.jsx("div",{className:"fixed inset-0 bg-black/50 z-[55] flex items-center justify-center p-4",children:n.jsxs("div",{className:"bg-surface rounded-lg p-8 text-center border-4 border-dashed border-primary",children:[n.jsx(te,{name:"upload-cloud",className:"w-16 h-16 text-primary mx-auto mb-4"}),n.jsx("p",{className:"text-xl font-semibold",children:"Drop file to import"})]})}),K&&n.jsxs(n.Fragment,{children:[n.jsx(Xv,{}),n.jsx(Wv,{onOpen:()=>H("aiStatus"),onCancel:ae.handleCancelAIGeneration})]})]})})};class _1 extends Hr.Component{constructor(){super(...arguments),this.state={hasError:!1,error:null},this.handleReload=()=>{window.location.reload()}}static getDerivedStateFromError(g){return{hasError:!0,error:g}}componentDidCatch(g,l){console.error("Uncaught error:",g,l)}render(){return this.state.hasError?n.jsx("div",{className:"min-h-screen flex items-center justify-center p-4 bg-background",children:n.jsxs("div",{className:"text-center bg-surface p-8 rounded-lg shadow-xl max-w-lg w-full border border-border",children:[n.jsx(te,{name:"x-circle",className:"w-16 h-16 text-red-500 mx-auto mb-4"}),n.jsx("h1",{className:"text-3xl font-bold text-red-500 mb-4",children:"Something went wrong"}),n.jsx("p",{className:"text-text-muted mb-6",children:"An unexpected error occurred. Please try reloading the page. If the problem persists, you may need to clear your application data."}),this.state.error&&n.jsxs("details",{className:"text-left bg-background p-4 rounded-md mb-6",children:[n.jsx("summary",{className:"cursor-pointer text-sm text-text-muted",children:"Error Details"}),n.jsx("pre",{className:"mt-2 text-xs text-red-400 whitespace-pre-wrap break-all",children:n.jsx("code",{children:this.state.error.stack||this.state.error.toString()})})]}),n.jsx(ce,{variant:"danger",onClick:this.handleReload,children:"Reload Page"})]})}):this.props.children}}function bx(r,g,l={}){const u=g instanceof Error;console.groupCollapsed(`%c[${r}] ${u?g.message:"An error occurred"}`,"color: red; font-weight: bold;"),console.error(g),Object.keys(l).length>0&&console.log("Additional Info:",l),u&&g.stack&&console.log("Stack Trace:",g.stack),console.groupEnd()}window.addEventListener("error",r=>{bx("Unhandled Global Error",r.error||r.message,{message:r.message,filename:r.filename,lineno:r.lineno,colno:r.colno})});window.addEventListener("unhandledrejection",r=>{bx("Unhandled Promise Rejection",r.reason)});console.log(window.location);const vx=document.getElementById("root");if(!vx)throw new Error("Could not find root element to mount to");const k1=r0.createRoot(vx);k1.render(n.jsx(Hr.StrictMode,{children:n.jsx(hv,{children:n.jsx(eb,{children:n.jsx(K0,{children:n.jsx(J0,{children:n.jsx(tb,{children:n.jsx(_1,{children:n.jsx(N1,{})})})})})})})}));
