import{j as e,B as h,I as s,r as a,a as Se,c as je,i as ve,u as ye,S as me,x as ze,e as F,d as be,D as pe,g as Me,C as Ve,s as Ne,L as he,y as ct,z as Te,E as re,F as mt,G as xt,H as ut,J as ht,K as pt,R as ft,M as gt,N as bt,O as jt}from"./index-Db7ZDnWd.js";import{M as $e}from"./MasteryBar-DwmeWyCF.js";import{T as vt}from"./TruncatedText-bWIIOVrb.js";const Ce=({targetId:t,value:o,onChange:g,className:w=""})=>{const r=(c,m)=>{var l;const u=document.getElementById(t);if(!u)return;const j=u.selectionStart,b=u.selectionEnd,S=o.substring(j,b),D=o.substring(0,j),N=o.substring(b);let E="",z=0;if(E=`${D}<${c}>${N}`,z=j+c.length+2,c==="b"||c==="i"||c==="u"||c==="code")E=`${D}<${c}>${S}</${c}>${N}`,S.length===0?z=j+c.length+2:z=j+c.length+2+S.length+c.length+3;else if(c==="br")E=`${D}<br>
${N}`,z=j+5;else if(c==="ul"){const C=S.split(`
`).map(p=>`  <li>${p}</li>`).join(`
`),d=C||"  <li></li>";E=`${D}<ul>
${d}
</ul>${N}`,z=C?j+d.length+11:j+9}const k=(l=Object.getOwnPropertyDescriptor(window.HTMLTextAreaElement.prototype,"value"))==null?void 0:l.set;k&&k.call(u,E);const I=new Event("input",{bubbles:!0});u.dispatchEvent(I),g(E),setTimeout(()=>{u.focus(),u.setSelectionRange(z,z)},0)};return e.jsxs("div",{className:`flex flex-wrap items-center gap-1 p-1 bg-surface border-b border-border rounded-t-md ${w}`,children:[e.jsx(h,{type:"button",variant:"ghost",size:"sm",onClick:()=>r("b"),title:"Bold",className:"px-2 h-8 min-w-[2rem] font-bold",children:"B"}),e.jsx(h,{type:"button",variant:"ghost",size:"sm",onClick:()=>r("i"),title:"Italic",className:"px-2 h-8 min-w-[2rem] italic",children:"I"}),e.jsx(h,{type:"button",variant:"ghost",size:"sm",onClick:()=>r("u"),title:"Underline",className:"px-2 h-8 min-w-[2rem] underline",children:"U"}),e.jsx("div",{className:"w-px h-4 bg-border mx-1"}),e.jsx(h,{type:"button",variant:"ghost",size:"sm",onClick:()=>r("code"),title:"Code",className:"px-2 h-8 min-w-[2rem] font-mono text-xs",children:"</>"}),e.jsx(h,{type:"button",variant:"ghost",size:"sm",onClick:()=>r("br"),title:"Line Break",className:"px-2 h-8 min-w-[2rem] text-xs",children:"BR"}),e.jsx("div",{className:"w-px h-4 bg-border mx-1"}),e.jsx(h,{type:"button",variant:"ghost",size:"sm",onClick:()=>r("ul"),title:"List",className:"px-2 h-8 min-w-[2rem]",children:e.jsx(s,{name:"list",className:"w-4 h-4"})})]})},yt=({card:t,onClose:o,onSave:g,deckName:w})=>{const[r,c]=a.useState(""),[m,u]=a.useState(""),[j,b]=a.useState(""),[S,D]=a.useState(!1),{addToast:N}=Se(),E=a.useRef(null);je(E,!0);const z=ve(),{aiFeaturesEnabled:k}=ye();a.useEffect(()=>{t&&(c(t.front),u(t.back),b(t.css||""))},[t]);const I=d=>{if(d.preventDefault(),!r.trim()||!m.trim()){N("Both front and back fields are required.","error");return}g({id:(t==null?void 0:t.id)||"",front:r.trim(),back:m.trim(),css:j.trim()})},l=d=>{if(d.key==="Tab"){d.preventDefault();const p=d.target,R=p.selectionStart,T=p.selectionEnd;p.value=p.value.substring(0,R)+"	"+p.value.substring(T),p.selectionStart=p.selectionEnd=R+1;const P=p.id;P==="card-front"&&c(p.value),P==="card-back"&&u(p.value),P==="card-css"&&b(p.value)}},C=async()=>{if(!r.trim()||!m.trim()){N("Please fill in both front and back fields first.","error");return}D(!0);try{const d=await z.handleGenerateCardExamples(r,m,w);d&&(u(p=>`${p}<br><br><strong>Examples:</strong><br>${d}`),N("Examples added to the back of the card.","success"))}catch{}finally{D(!1)}};return e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-75 flex items-center justify-center z-[60] p-4",children:e.jsx("div",{ref:E,className:"bg-surface rounded-lg shadow-xl w-full max-w-2xl transform transition-all relative",children:e.jsxs("form",{onSubmit:I,children:[e.jsxs("div",{className:"flex justify-between items-center p-4 border-b border-border",children:[e.jsx("h2",{className:"text-xl font-bold",children:t?"Edit Card":"Add New Card"}),e.jsx(h,{type:"button",variant:"ghost",onClick:o,className:"p-1 h-auto",children:e.jsx(s,{name:"x"})})]}),e.jsxs("div",{className:"p-6 space-y-4 max-h-[70vh] overflow-y-auto",children:[e.jsxs("div",{children:[e.jsx("label",{htmlFor:"card-front",className:"block text-sm font-medium text-text-muted mb-1",children:"Front (Supports HTML)"}),e.jsxs("div",{className:"border border-border rounded-md focus-within:ring-2 focus-within:ring-primary overflow-hidden",children:[e.jsx(Ce,{targetId:"card-front",value:r,onChange:c}),e.jsx("textarea",{id:"card-front",value:r,onChange:d=>c(d.target.value),onKeyDown:l,rows:5,className:"w-full p-2 bg-background focus:outline-none font-mono text-sm block"})]})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex justify-between items-end mb-1",children:[e.jsx("label",{htmlFor:"card-back",className:"block text-sm font-medium text-text-muted",children:"Back (Supports HTML)"}),k&&e.jsxs(h,{type:"button",variant:"ghost",size:"sm",onClick:C,disabled:S,className:"text-primary hover:text-primary-hover",title:"Use AI to generate real-world examples",children:[S?e.jsx(me,{size:"sm"}):e.jsx(s,{name:"zap",className:"w-3 h-3 mr-1"}),S?"Generating...":"Generate Examples"]})]}),e.jsxs("div",{className:"border border-border rounded-md focus-within:ring-2 focus-within:ring-primary overflow-hidden",children:[e.jsx(Ce,{targetId:"card-back",value:m,onChange:u}),e.jsx("textarea",{id:"card-back",value:m,onChange:d=>u(d.target.value),onKeyDown:l,rows:5,className:"w-full p-2 bg-background focus:outline-none font-mono text-sm block"})]})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"card-css",className:"block text-sm font-medium text-text-muted mb-1",children:"Custom CSS (Optional)"}),e.jsx("textarea",{id:"card-css",value:j,onChange:d=>b(d.target.value),onKeyDown:l,rows:5,className:"w-full p-2 bg-background border border-border rounded-md focus:ring-2 focus:ring-primary focus:outline-none font-mono text-sm",placeholder:".card { font-family: 'Arial'; }"})]})]}),e.jsxs("div",{className:"flex justify-end p-4 bg-background/50 border-t border-border",children:[e.jsx(h,{type:"button",variant:"secondary",onClick:o,className:"mr-2",children:"Cancel"}),e.jsx(h,{type:"submit",variant:"primary",children:t?"Save Changes":"Add Card"})]})]})})})},Oe=({deck:t,onGenerateMore:o,onRework:g,onAnalyze:w,onAutoTag:r,onHardenDistractors:c,onGenerateAudio:m,onHolisticUpgrade:u,isGenerating:j})=>{const[b,S]=a.useState(!1),D=a.useRef(null),{openModal:N}=ze();a.useEffect(()=>{const k=I=>{D.current&&!D.current.contains(I.target)&&S(!1)};return b&&document.addEventListener("mousedown",k),()=>document.removeEventListener("mousedown",k)},[b]);const E=k=>{k(),S(!1)},z=k=>{S(!1),N("synthesisConfig",{title:k==="text"?"Holistic Course Upgrade":"Mass Assessment Deepening",type:k,onConfirm:I=>u==null?void 0:u(k,I)})};return e.jsxs("div",{className:"relative inline-block",ref:D,children:[e.jsxs(h,{variant:"primary",onClick:()=>S(!b),disabled:j,className:"bg-gradient-to-r from-blue-600 to-indigo-600 border-none shadow-md hover:shadow-lg transition-all",children:[j?e.jsx(me,{size:"sm"}):e.jsx(s,{name:"bot",className:"w-5 h-5 mr-2"}),j?"AI Processing...":"âœ¨ AI Actions",e.jsx(s,{name:"chevron-down",className:`ml-2 w-4 h-4 transition-transform duration-200 ${b?"rotate-180":""}`})]}),b&&e.jsxs("div",{className:"absolute bottom-full left-0 mb-2 w-64 bg-surface rounded-xl shadow-2xl border border-border z-50 py-2 animate-fade-in origin-bottom-left overflow-hidden",children:[e.jsx("div",{className:"px-4 py-2 border-b border-border mb-1",children:e.jsx("span",{className:"text-[10px] font-bold text-text-muted uppercase tracking-widest",children:"Synthesis Studio"})}),e.jsxs("button",{onClick:()=>E(o),className:"flex items-center w-full px-4 py-2.5 text-sm text-left text-text hover:bg-primary/10 transition-colors group",children:[e.jsx(s,{name:"zap",className:"w-4 h-4 mr-3 text-primary group-hover:scale-110 transition-transform"}),"Expand Deck with AI"]}),e.jsxs("button",{onClick:()=>E(g),className:"flex items-center w-full px-4 py-2.5 text-sm text-left text-text hover:bg-primary/10 transition-colors group",children:[e.jsx(s,{name:"refresh-ccw",className:"w-4 h-4 mr-3 text-blue-500 group-hover:scale-110 transition-transform"}),"Rework Entire Deck"]}),e.jsx("div",{className:"my-1 border-t border-border"}),e.jsx("div",{className:"px-4 py-1",children:e.jsx("span",{className:"text-[9px] font-black text-indigo-600 uppercase tracking-tighter",children:"Conceptual Transformers"})}),u&&e.jsxs("button",{onClick:()=>z("text"),className:"flex items-center w-full px-4 py-2.5 text-sm text-left text-text hover:bg-indigo-50 dark:hover:bg-indigo-900/20 transition-colors group",children:[e.jsx(s,{name:"bot",className:"w-4 h-4 mr-3 text-indigo-500 group-hover:scale-110 transition-transform"}),"Holistic Text Upgrade (All)"]}),u&&t.type===F.Learning&&e.jsxs("button",{onClick:()=>z("questions"),className:"flex items-center w-full px-4 py-2.5 text-sm text-left text-text hover:bg-indigo-50 dark:hover:bg-indigo-900/20 transition-colors group",children:[e.jsx(s,{name:"layers",className:"w-4 h-4 mr-3 text-indigo-500 group-hover:scale-110 transition-transform"}),"Deepen All Quizzes"]}),e.jsx("div",{className:"my-1 border-t border-border"}),e.jsxs("button",{onClick:()=>E(w),className:"flex items-center w-full px-4 py-2.5 text-sm text-left text-text hover:bg-primary/10 transition-colors group",children:[e.jsx(s,{name:"save",className:"w-4 h-4 mr-3 text-yellow-500 group-hover:scale-110 transition-transform"}),"Analyze & Improve"]}),(t.type===F.Quiz||t.type===F.Learning)&&e.jsxs(e.Fragment,{children:[r&&e.jsxs("button",{onClick:()=>E(r),className:"flex items-center w-full px-4 py-2.5 text-sm text-left text-text hover:bg-primary/10 transition-colors group",children:[e.jsx(s,{name:"filter",className:"w-4 h-4 mr-3 text-indigo-500 group-hover:scale-110 transition-transform"}),"Smart-Tag Questions"]}),c&&e.jsxs("button",{onClick:()=>E(c),className:"flex items-center w-full px-4 py-2.5 text-sm text-left text-text hover:bg-primary/10 transition-colors group",children:[e.jsx(s,{name:"trending-up",className:"w-4 h-4 mr-3 text-red-500 group-hover:scale-110 transition-transform"}),"Harden Distractors"]})]}),t.type===F.Flashcard&&m&&e.jsxs("button",{onClick:()=>E(m),className:"flex items-center w-full px-4 py-2.5 text-sm text-left text-text hover:bg-primary/10 transition-colors group",children:[e.jsx(s,{name:"mic",className:"w-4 h-4 mr-3 text-green-500 group-hover:scale-110 transition-transform"}),"Generate Audio"]})]})]})},Ke=50,wt=t=>{const o=new Date;o.setHours(0,0,0,0);const g=new Date(t);g.setHours(0,0,0,0);const w=g.getTime()-o.getTime(),r=Math.round(w/(1e3*60*60*24)),c=r<=0;let m;return r<0?m="Due":r===0?m="Due today":r===1?m="Due tomorrow":m=`Due in ${r} days`,{text:m,isDue:c}},Nt=({cards:t,onCardsChange:o,onAddCard:g,onBulkAdd:w,deckName:r,deck:c})=>{const[m,u]=a.useState(null),[j,b]=a.useState(!1),[S,D]=a.useState(null),[N,E]=a.useState(!0),[z,k]=a.useState(Ke),[I,l]=a.useState(null),[C,d]=a.useState(new Set),p=a.useRef(null),{aiFeaturesEnabled:R}=ye(),T=ve(),{openModal:P}=ze(),U=be(f=>f.aiGenerationStatus.currentTask),K=be(f=>f.aiGenerationStatus.queue),ae=a.useCallback(f=>{var x;return((x=U==null?void 0:U.payload)==null?void 0:x.itemId)===f&&(U==null?void 0:U.type)==="holistic-expand-item"?!0:(K||[]).some(X=>{var n;return((n=X.payload)==null?void 0:n.itemId)===f&&X.type==="holistic-expand-item"})},[U,K]),ee=!!U&&U.deckId===c.id,W=a.useMemo(()=>t.slice(0,z),[t,z]),J=()=>{k(f=>Math.min(f+Ke,t.length))},oe=f=>{const x=new Set(C);x.has(f)?x.delete(f):x.add(f),d(x)},ie=()=>{d(new Set(t.map(f=>f.id)))},le=()=>{d(new Set)},te=(f,x)=>{f.stopPropagation(),P("synthesisConfig",{title:"Custom Card Synthesis",type:"text",onConfirm:X=>{T==null||T.handleImmediateAIGeneration({generationType:"holistic-expand-item",topic:c.name,deckId:c.id,itemId:x,...X})}})},y=(f,x)=>{u(f),x&&(p.current=x.currentTarget),b(!0)},$=()=>{var f;b(!1),(f=p.current)==null||f.focus(),u(null)},B=(f,x)=>{D(f),x&&(p.current=x.currentTarget)},v=()=>{S&&o(t.filter(f=>f.id!==S.id)),D(null)},M=f=>{m?o(t.map(x=>x.id===f.id?{...x,...f}:x)):g(f),$()},O=f=>{o(t.map(x=>x.id===f?{...x,suspended:!1}:x))},Y=(f,x)=>{l(f),x.dataTransfer.effectAllowed="move"},Z=(f,x)=>{x.preventDefault(),x.dataTransfer.dropEffect="move"},se=(f,x)=>{if(x.preventDefault(),I===null||I===f)return;const X=[...t],[n]=X.splice(I,1);X.splice(f,0,n),o(X),l(null)};return e.jsxs("div",{children:[e.jsxs("div",{className:"border-b border-border flex justify-between items-center bg-surface sticky top-0 z-10",children:[e.jsxs("button",{onClick:()=>E(!N),className:"flex-grow flex justify-between items-center text-left p-6","aria-expanded":N,"aria-controls":"card-list-content",children:[e.jsxs("h3",{className:"text-xl font-semibold text-text",children:["Cards (",t.length,")"]}),e.jsx(s,{name:"chevron-down",className:`w-6 h-6 transition-transform duration-300 ${N?"":"-rotate-90"} text-text-muted`})]}),N&&t.length>0&&e.jsxs("div",{className:"pr-6 flex gap-2",children:[e.jsx(h,{variant:"ghost",size:"sm",onClick:ie,title:"Expand All",children:e.jsx(s,{name:"maximize",className:"w-4 h-4"})}),e.jsx(h,{variant:"ghost",size:"sm",onClick:le,title:"Collapse All",children:e.jsx(s,{name:"minimize",className:"w-4 h-4"})})]})]}),N&&e.jsxs("div",{id:"card-list-content",className:"animate-fade-in",children:[e.jsx("div",{className:"p-6",children:t.length>0?e.jsxs(e.Fragment,{children:[e.jsx("ul",{className:"space-y-4",children:W.map((f,x)=>{const{text:X,isDue:n}=wt(f.dueDate),A=I===x,L=C.has(f.id),H=ae(f.id);return e.jsx("li",{className:`p-4 rounded-lg flex flex-col transition-all border border-transparent ${f.suspended?"bg-yellow-500/10 opacity-70":"bg-background"} ${A?"opacity-50 ring-2 ring-primary":"hover:border-border"} ${H?"ring-2 ring-indigo-500/50 animate-pulse":""}`,draggable:!0,onDragStart:V=>Y(x,V),onDragOver:V=>Z(x,V),onDrop:V=>se(x,V),children:e.jsxs("div",{className:"flex items-start justify-between w-full",children:[e.jsxs("div",{className:"flex items-start flex-1 min-w-0",children:[e.jsx("div",{className:"mr-3 mt-1 cursor-grab active:cursor-grabbing text-text-muted hover:text-text",onClick:V=>V.stopPropagation(),children:e.jsx(s,{name:"grip-vertical",className:"w-5 h-5"})}),e.jsxs("div",{className:"flex-1 min-w-0 mr-4",children:[L?e.jsxs("div",{className:"space-y-4 py-2",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-xs font-bold text-text-muted uppercase mb-1",children:"Front"}),e.jsx(pe,{html:f.front,className:"prose prose-sm dark:prose-invert max-w-none"})]}),e.jsxs("div",{className:"pt-2 border-t border-border/50",children:[e.jsx("p",{className:"text-xs font-bold text-text-muted uppercase mb-1",children:"Back"}),e.jsx(pe,{html:f.back,className:"prose prose-sm dark:prose-invert max-w-none"})]})]}):e.jsxs(e.Fragment,{children:[e.jsxs("p",{className:"text-sm font-medium text-text truncate",children:[e.jsx("strong",{children:"Front:"})," ",f.front.replace(/<[^>]+>/g,"")]}),e.jsxs("p",{className:"text-sm text-text-muted truncate",children:[e.jsx("strong",{children:"Back:"})," ",f.back.replace(/<[^>]+>/g,"")]})]}),e.jsxs("div",{className:"mt-3 flex flex-wrap gap-4 items-center",children:[e.jsx("div",{className:"flex-grow max-w-[150px]",children:e.jsx($e,{level:Me(f)})}),e.jsx("div",{className:"flex items-center gap-4 text-xs text-text-muted",children:e.jsxs("span",{className:`font-semibold ${n?"text-primary":""}`,children:[e.jsx(s,{name:"zap",className:"w-3 h-3 inline-block mr-1"}),X]})}),R&&e.jsxs("button",{onClick:V=>te(V,f.id),disabled:H,className:`text-[10px] flex items-center gap-1 font-bold uppercase tracking-widest transition-colors ${H?"text-primary":"text-indigo-500 hover:text-indigo-700"}`,children:[H?e.jsx(me,{size:"sm"}):e.jsx(s,{name:"zap",className:"w-3 h-3"}),H?"Synthesizing":"AI Enhance"]})]})]})]}),e.jsxs("div",{className:"flex-shrink-0 flex items-center gap-1",children:[e.jsx(h,{variant:"ghost",size:"sm",className:"p-2 h-auto text-text-muted",onClick:()=>oe(f.id),title:L?"Collapse":"Expand",children:e.jsx(s,{name:L?"minimize":"maximize",className:"w-4 h-4"})}),f.suspended?e.jsx(h,{variant:"ghost",size:"sm",className:"p-2 h-auto text-yellow-600 dark:text-yellow-400",onClick:()=>O(f.id),title:"Unsuspend this card",children:e.jsx(s,{name:"eye",className:"w-4 h-4"})}):e.jsx(h,{variant:"ghost",size:"sm",className:"p-2 h-auto",onClick:V=>y(f,V),title:"Edit this card",children:e.jsx(s,{name:"edit",className:"w-4 h-4"})}),e.jsx(h,{variant:"ghost",size:"sm",className:"p-2 h-auto text-text-muted hover:text-red-500",onClick:V=>B(f,V),title:"Delete this card",children:e.jsx(s,{name:"trash-2",className:"w-4 h-4"})})]})]})},f.id)})}),z<t.length&&e.jsx("div",{className:"mt-4 text-center",children:e.jsxs(h,{variant:"secondary",onClick:J,children:["Show More (",t.length-z," remaining)"]})})]}):e.jsxs("div",{className:"flex flex-col items-center justify-center p-8 border-2 border-dashed border-border rounded-lg bg-background/50",children:[e.jsx(s,{name:"laptop",className:"w-12 h-12 text-text-muted mb-3"}),e.jsx("p",{className:"text-text font-medium mb-1",children:"No cards yet"}),e.jsx("p",{className:"text-sm text-text-muted text-center max-w-xs",children:"Start building your deck by adding your first flashcard."}),e.jsx("div",{className:"mt-4",children:e.jsxs(h,{variant:"primary",onClick:f=>y(null,f),children:[e.jsx(s,{name:"plus",className:"w-4 h-4 mr-2"}),"Create First Card"]})})]})}),e.jsxs("div",{className:"px-6 py-4 border-t border-border flex flex-wrap gap-2 items-center",children:[e.jsxs(h,{variant:"secondary",onClick:f=>y(null,f),className:"flex-grow sm:flex-grow-0",children:[e.jsx(s,{name:"plus",className:"w-5 h-5 mr-2"}),"Add New Card"]}),e.jsxs(h,{variant:"ghost",onClick:w,className:"flex-grow sm:flex-grow-0",children:[e.jsx(s,{name:"code",className:"w-5 h-5 mr-2"}),"Bulk Add via JSON"]}),e.jsx("div",{className:"flex-grow"}),R&&e.jsx(Oe,{deck:c,isGenerating:ee,onGenerateMore:()=>T==null?void 0:T.handleOpenAIGenerationForDeck(c),onRework:()=>T==null?void 0:T.handleOpenAIReworkForDeck(c),onAnalyze:()=>T==null?void 0:T.handleOpenDeckAnalysis(c),onGenerateAudio:()=>T==null?void 0:T.handleGenerateAudioForAllCards(c),onHolisticUpgrade:(f,x)=>T.handleHolisticUpgrade(c,f,x)})]})]}),j&&e.jsx(yt,{card:m,onClose:$,onSave:M,deckName:r}),S&&e.jsx(Ve,{isOpen:!!S,onClose:()=>D(null),onConfirm:v,title:"Delete Card",message:"Are you sure you want to delete this card? This action cannot be undone."})]})},Ct=({question:t,onClose:o,onSave:g,deckName:w})=>{const[r,c]=a.useState(""),[m,u]=a.useState(""),[j,b]=a.useState([]),[S,D]=a.useState(""),[N,E]=a.useState([]),[z,k]=a.useState(""),[I,l]=a.useState(new Set),[C,d]=a.useState(!1),{addToast:p}=Se(),R=a.useRef(null);je(R,!0);const T=ve(),{aiFeaturesEnabled:P}=ye();a.useEffect(()=>{if(t)c(t.questionText),u(t.detailedExplanation),b((t.options||[]).map(y=>({...y}))),D(t.correctAnswerId),E(t.tags||[]);else{const y=[{id:crypto.randomUUID(),text:""},{id:crypto.randomUUID(),text:""}];b(y),E([])}},[t]);const U=(y,$,B)=>{b(j.map(v=>v.id===y?{...v,[$]:B}:v))},K=y=>{l($=>{const B=new Set($);return B.has(y)?B.delete(y):B.add(y),B})},ae=()=>{b([...j,{id:crypto.randomUUID(),text:""}])},ee=y=>{if(j.length<=2){p("A question must have at least two options.","error");return}b(j.filter($=>$.id!==y)),S===y&&D("")},W=y=>{k(y.target.value)},J=y=>{if(y.key===","||y.key==="Enter"){y.preventDefault();const $=z.trim();$&&!N.includes($)&&E([...N,$]),k("")}else y.key==="Backspace"&&!z&&N.length>0&&E(N.slice(0,-1))},oe=y=>{E(N.filter($=>$!==y))},ie=(y,$)=>{if(y.key==="Tab"){y.preventDefault();const B=y.target,v=B.selectionStart,M=B.selectionEnd,O=B.value.substring(0,v)+"	"+B.value.substring(M);B.value=O,$(O),B.selectionStart=B.selectionEnd=v+1}},le=async()=>{if(!r.trim()||!S){p("Please enter a question and select a correct answer first.","error");return}const y=j.find($=>$.id===S);if(!y||!y.text.trim()){p("The correct answer text must be set.","error");return}d(!0);try{const $={id:"temp",questionText:r,options:j,correctAnswerId:S,detailedExplanation:m,questionType:"multipleChoice",dueDate:"",interval:0,easeFactor:0,lapses:0},B=await T.handleHardenDistractors($,w);B&&(b(B),p("Distractors updated!","success"))}catch{}finally{d(!1)}},te=y=>{if(y.preventDefault(),!r.trim()){p("Question text is required.","error");return}if(j.some($=>!$.text.trim())){p("All options must have text.","error");return}if(!S){p("You must select a correct answer.","error");return}g({id:t==null?void 0:t.id,questionText:r.trim(),detailedExplanation:m.trim(),options:j,correctAnswerId:S,tags:N})};return e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-75 flex items-center justify-center z-[60] p-4",children:e.jsx("div",{ref:R,className:"bg-surface rounded-lg shadow-xl w-full max-w-3xl transform transition-all relative max-h-[90vh] flex flex-col",children:e.jsxs("form",{onSubmit:te,className:"flex flex-col h-full",children:[e.jsxs("div",{className:"flex-shrink-0 flex justify-between items-center p-4 border-b border-border",children:[e.jsx("h2",{className:"text-xl font-bold",children:t?"Edit Question":"Add New Question"}),e.jsx(h,{type:"button",variant:"ghost",onClick:o,className:"p-1 h-auto",children:e.jsx(s,{name:"x"})})]}),e.jsxs("div",{className:"p-6 space-y-4 overflow-y-auto",children:[e.jsxs("div",{children:[e.jsx("label",{htmlFor:"question-text",className:"block text-sm font-medium text-text-muted mb-1",children:"Question Text (Supports HTML)"}),e.jsxs("div",{className:"border border-border rounded-md focus-within:ring-2 focus-within:ring-primary overflow-hidden",children:[e.jsx(Ce,{targetId:"question-text",value:r,onChange:c}),e.jsx("textarea",{id:"question-text",value:r,onChange:y=>c(y.target.value),onKeyDown:y=>ie(y,c),rows:4,className:"w-full p-2 bg-background focus:outline-none font-mono text-sm block",placeholder:"What is the capital of France?"})]})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex justify-between items-end mb-1",children:[e.jsx("label",{className:"block text-sm font-medium text-text-muted",children:"Options"}),P&&e.jsxs(h,{type:"button",variant:"ghost",size:"sm",onClick:le,disabled:C,className:"text-primary hover:text-primary-hover",title:"Use AI to generate more challenging incorrect answers",children:[C?e.jsx(me,{size:"sm"}):e.jsx(s,{name:"zap",className:"w-3 h-3 mr-1"}),C?"Hardening...":"Harden Distractors"]})]}),e.jsx("div",{className:"space-y-2",children:j.map((y,$)=>e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"radio",name:"correct-answer",checked:S===y.id,onChange:()=>D(y.id),className:"h-5 w-5 text-primary bg-border/50 border-border focus:ring-primary","aria-label":`Set option ${$+1} as correct`}),e.jsx("input",{type:"text",value:y.text,onChange:B=>U(y.id,"text",B.target.value),className:"flex-grow p-2 bg-background border border-border rounded-md focus:ring-2 focus:ring-primary focus:outline-none",placeholder:`Option ${$+1}`}),e.jsx(h,{type:"button",variant:"ghost",onClick:()=>K(y.id),className:`p-2 h-auto ${I.has(y.id)?"bg-primary/10 text-primary":"text-text-muted"}`,title:"Add/Edit option explanation",children:e.jsx(s,{name:"info",className:"w-4 h-4"})}),e.jsx(h,{type:"button",variant:"ghost",onClick:()=>ee(y.id),className:"p-2 h-auto text-text-muted hover:text-red-500",children:e.jsx(s,{name:"x",className:"w-4 h-4"})})]}),I.has(y.id)&&e.jsx("div",{className:"pl-7 mt-1 animate-fade-in",children:e.jsx("input",{type:"text",value:y.explanation||"",onChange:B=>U(y.id,"explanation",B.target.value),className:"w-full p-1 bg-background border border-border rounded-md focus:ring-2 focus:ring-primary focus:outline-none text-sm",placeholder:"Brief explanation for this option..."})})]},y.id))}),e.jsxs(h,{type:"button",variant:"ghost",onClick:ae,size:"sm",className:"mt-2",children:[e.jsx(s,{name:"plus",className:"w-4 h-4 mr-2"}),"Add Option"]})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"detailed-explanation",className:"block text-sm font-medium text-text-muted mb-1",children:"Detailed Explanation (Supports HTML)"}),e.jsxs("div",{className:"border border-border rounded-md focus-within:ring-2 focus-within:ring-primary overflow-hidden",children:[e.jsx(Ce,{targetId:"detailed-explanation",value:m,onChange:u}),e.jsx("textarea",{id:"detailed-explanation",value:m,onChange:y=>u(y.target.value),onKeyDown:y=>ie(y,u),rows:4,className:"w-full p-2 bg-background focus:outline-none font-mono text-sm block",placeholder:"Explain why the correct answer is right..."})]})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"tags-input",className:"block text-sm font-medium text-text-muted mb-1",children:"Tags"}),e.jsxs("div",{className:"flex flex-wrap items-center gap-2 p-2 bg-background border border-border rounded-md",children:[N.map((y,$)=>e.jsxs("span",{className:"flex items-center gap-1 bg-primary/10 text-primary text-sm px-2 py-1 rounded-md",children:[y,e.jsx("button",{type:"button",onClick:()=>oe(y),className:"text-primary hover:text-primary-hover",children:e.jsx(s,{name:"x",className:"w-3 h-3"})})]},$)),e.jsx("input",{id:"tags-input",type:"text",value:z,onChange:W,onKeyDown:J,className:"flex-grow bg-transparent focus:outline-none",placeholder:N.length===0?"Add tags (comma or enter)...":""})]})]})]}),e.jsxs("div",{className:"flex-shrink-0 flex justify-end p-4 bg-background/50 border-t border-border",children:[e.jsx(h,{type:"button",variant:"secondary",onClick:o,className:"mr-2",children:"Cancel"}),e.jsx(h,{type:"submit",variant:"primary",children:t?"Save Changes":"Add Question"})]})]})})})},St=t=>{const o=new Date;o.setHours(0,0,0,0);const g=new Date(t);g.setHours(0,0,0,0);const w=g.getTime()-o.getTime(),r=Math.round(w/(1e3*60*60*24)),c=r<=0;let m;return r<0?m="Due":r===0?m="Due today":r===1?m="Due tomorrow":m=`Due in ${r} days`,{text:m,isDue:c}},kt=({deck:t,questions:o,onQuestionsChange:g,onAddQuestion:w,onBulkAdd:r,onGenerateAI:c,isGeneratingAI:m,onRegenerateQuestion:u,onAutoTag:j,deckName:b})=>{const[S,D]=a.useState(null),[N,E]=a.useState(!1),[z,k]=a.useState(null),[I,l]=a.useState(!0),[C,d]=a.useState(null),[p,R]=a.useState(null),[T,P]=a.useState(null),[U,K]=a.useState(new Set),ae=a.useRef(null),ee=a.useRef(null),{aiFeaturesEnabled:W}=ye(),J=ve(),ie=!!be(a.useCallback(n=>{const{currentTask:A,queue:L}=n.aiGenerationStatus;return(A==null?void 0:A.deckId)===t.id?A:(L||[]).find(H=>H.deckId===t.id)},[t.id]));a.useEffect(()=>{const n=A=>{ee.current&&!ee.current.contains(A.target)&&d(null)};return C&&document.addEventListener("mousedown",n),()=>{document.removeEventListener("mousedown",n)}},[C]);const le=n=>{K(A=>{const L=new Set(A);return L.has(n)?L.delete(n):L.add(n),L})},te=()=>K(new Set(o.map(n=>n.id))),y=()=>K(new Set),$=(n,A)=>{D(n),A&&(ae.current=A.currentTarget),E(!0)},B=()=>{var n;E(!1),(n=ae.current)==null||n.focus(),D(null)},v=(n,A)=>{k(n),A&&(ae.current=A.currentTarget)},M=()=>{z&&g(o.filter(n=>n.id!==z.id)),k(null)},O=n=>{if(S&&n.id)g(o.map(A=>A.id===n.id?{...A,...n}:A));else{const{id:A,...L}=n,H={...L,questionType:"multipleChoice",suspended:!1};w(H)}B()},Y=n=>{g(o.map(A=>A.id===n?{...A,suspended:!0}:A)),d(null)},Z=n=>{g(o.map(A=>A.id===n?{...A,suspended:!1}:A)),d(null)},se=async n=>{d(null),R(n.id);try{await u(t,n)}finally{R(null)}},f=(n,A)=>{P(n),A.dataTransfer.effectAllowed="move"},x=(n,A)=>{A.preventDefault(),A.dataTransfer.dropEffect="move"},X=(n,A)=>{if(A.preventDefault(),T===null||T===n)return;const L=[...o],[H]=L.splice(T,1);L.splice(n,0,H),g(L),P(null)};return e.jsxs("div",{children:[e.jsxs("div",{className:"border-b border-border flex justify-between items-center bg-surface sticky top-0 z-10",children:[e.jsxs("button",{onClick:()=>l(!I),className:"flex-grow flex justify-between items-center text-left p-6","aria-expanded":I,"aria-controls":"question-list-content",children:[e.jsxs("h3",{className:"text-xl font-semibold text-text",children:["Questions (",o.length,")"]}),e.jsx(s,{name:"chevron-down",className:`w-6 h-6 transition-transform duration-300 ${I?"":"-rotate-90"} text-text-muted`})]}),I&&o.length>0&&e.jsxs("div",{className:"pr-6 flex gap-2",children:[e.jsx(h,{variant:"ghost",size:"sm",onClick:te,title:"Expand All",children:e.jsx(s,{name:"maximize",className:"w-4 h-4"})}),e.jsx(h,{variant:"ghost",size:"sm",onClick:y,title:"Collapse All",children:e.jsx(s,{name:"minimize",className:"w-4 h-4"})})]})]}),I&&e.jsxs("div",{id:"question-list-content",className:"animate-fade-in",children:[e.jsx("div",{className:"p-6",children:o.length>0?e.jsx("ul",{className:"space-y-4",children:o.map((n,A)=>{const{text:L,isDue:H}=St(n.dueDate),V=T===A,ne=U.has(n.id);return e.jsx("li",{className:`p-4 rounded-lg flex flex-col transition-all border border-transparent ${n.suspended?"bg-yellow-500/10 opacity-70":"bg-background"} ${V?"opacity-50 ring-2 ring-primary":"hover:border-border"}`,draggable:!0,onDragStart:G=>f(A,G),onDragOver:G=>x(A,G),onDrop:G=>X(A,G),children:e.jsxs("div",{className:"flex items-start justify-between w-full",children:[e.jsxs("div",{className:"flex items-start flex-1 min-w-0",children:[e.jsx("div",{className:"mr-3 mt-1 cursor-grab active:cursor-grabbing text-text-muted hover:text-text",onClick:G=>G.stopPropagation(),children:e.jsx(s,{name:"grip-vertical",className:"w-5 h-5"})}),e.jsxs("div",{className:"flex-1 min-w-0 mr-4",children:[ne?e.jsxs("div",{className:"py-2 space-y-4",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-xs font-bold text-text-muted uppercase mb-1",children:"Question"}),e.jsx(pe,{html:n.questionText,className:"prose prose-sm dark:prose-invert max-w-none font-semibold text-text"})]}),e.jsxs("div",{className:"pt-2 border-t border-border/50",children:[e.jsx("p",{className:"text-xs font-bold text-text-muted uppercase mb-2",children:"Options"}),e.jsx("ul",{className:"space-y-2",children:n.options.map(G=>e.jsxs("li",{className:`p-2 rounded border text-sm ${G.id===n.correctAnswerId?"bg-green-500/10 border-green-500/30":"bg-background border-border/50"}`,children:[e.jsxs("div",{className:"flex items-center gap-2",children:[G.id===n.correctAnswerId&&e.jsx(s,{name:"check-circle",className:"w-4 h-4 text-green-500"}),e.jsx("span",{className:G.id===n.correctAnswerId?"font-bold":"",children:G.text})]}),G.explanation&&e.jsx("p",{className:"text-[10px] text-text-muted mt-1 italic pl-6",children:G.explanation})]},G.id))})]}),n.detailedExplanation&&e.jsxs("div",{className:"pt-2 border-t border-border/50",children:[e.jsx("p",{className:"text-xs font-bold text-text-muted uppercase mb-1",children:"Full Explanation"}),e.jsx(pe,{html:n.detailedExplanation,className:"prose prose-sm dark:prose-invert max-w-none text-text-muted"})]})]}):e.jsx("p",{className:"text-base font-medium text-text break-words truncate",title:Ne(n.questionText),children:Ne(n.questionText)}),e.jsxs("div",{className:"mt-3 space-y-2",children:[e.jsx($e,{level:Me(n)}),e.jsxs("div",{className:"flex items-center gap-4 text-xs text-text-muted",children:[e.jsxs("span",{className:`font-semibold ${H?"text-primary":""}`,children:[e.jsx(s,{name:"zap",className:"w-3 h-3 inline-block mr-1"}),L]}),e.jsxs("span",{children:[e.jsx(s,{name:"list",className:"w-3 h-3 inline-block mr-1"}),(n.options||[]).length," options"]})]}),n.tags&&n.tags.length>0&&e.jsx("div",{className:"flex flex-wrap items-center gap-1 mt-2",children:n.tags.map(G=>e.jsx("span",{className:"bg-border/50 text-text-muted text-xs px-2 py-0.5 rounded-full",children:G},G))})]})]})]}),e.jsxs("div",{className:"flex-shrink-0 flex items-center gap-1",ref:C===n.id?ee:null,children:[e.jsx(h,{variant:"ghost",size:"sm",className:"p-2 h-auto text-text-muted",onClick:()=>le(n.id),title:ne?"Collapse":"Expand",children:e.jsx(s,{name:ne?"minimize":"maximize",className:"w-4 h-4"})}),p===n.id?e.jsx("div",{className:"p-2",children:e.jsx(me,{size:"sm"})}):e.jsx(h,{variant:"ghost",size:"sm",className:"p-2 h-auto",onClick:G=>{G.stopPropagation(),d(we=>we===n.id?null:n.id)},"aria-label":"More options for question",children:e.jsx(s,{name:"more-vertical",className:"w-5 h-5"})}),C===n.id&&e.jsxs("div",{className:"absolute right-0 mt-2 w-48 bg-surface rounded-md shadow-lg py-1 z-10 ring-1 ring-black ring-opacity-5 animate-fade-in",style:{animationDuration:"150ms"},children:[e.jsxs("button",{type:"button",onClick:G=>{$(n,G),d(null)},className:"flex items-center w-full px-4 py-2 text-sm text-left text-text hover:bg-border/20",children:[e.jsx(s,{name:"edit",className:"w-4 h-4 mr-3"}),"Edit"]}),e.jsxs("button",{type:"button",onClick:()=>se(n),className:"flex items-center w-full px-4 py-2 text-sm text-left text-text hover:bg-border/20",children:[e.jsx(s,{name:"zap",className:"w-4 h-4 mr-3"}),"Regenerate"]}),n.suspended?e.jsxs("button",{type:"button",onClick:()=>Z(n.id),className:"flex items-center w-full px-4 py-2 text-sm text-left text-text hover:bg-border/20",children:[e.jsx(s,{name:"eye",className:"w-4 h-4 mr-3"}),"Unsuspend"]}):e.jsxs("button",{type:"button",onClick:()=>Y(n.id),className:"flex items-center w-full px-4 py-2 text-sm text-left text-text hover:bg-border/20",children:[e.jsx(s,{name:"eye-off",className:"w-4 h-4 mr-3"}),"Suspend"]}),e.jsx("div",{className:"border-t border-border my-1"}),e.jsxs("button",{type:"button",onClick:G=>{v(n,G),d(null)},className:"flex items-center w-full px-4 py-2 text-sm text-left text-red-600 dark:text-red-400 hover:bg-red-50 dark:hover:bg-red-900/20",children:[e.jsx(s,{name:"trash-2",className:"w-4 h-4 mr-3"}),"Delete"]})]})]})]})},n.id)})}):e.jsxs("div",{className:"flex flex-col items-center justify-center p-8 border-2 border-dashed border-border rounded-lg bg-background/50",children:[e.jsx(s,{name:"help-circle",className:"w-12 h-12 text-text-muted mb-3"}),e.jsx("p",{className:"text-text font-medium mb-1",children:"No questions yet"}),e.jsx("p",{className:"text-sm text-text-muted text-center max-w-xs",children:"Start adding questions to build your quiz."}),e.jsx("div",{className:"mt-4 flex flex-col sm:flex-row gap-3",children:e.jsxs(h,{variant:"primary",onClick:n=>$(null,n),children:[e.jsx(s,{name:"plus",className:"w-4 h-4 mr-2"}),"Add Question"]})})]})}),e.jsxs("div",{className:"px-6 py-4 border-t border-border flex flex-wrap gap-2 items-center",children:[e.jsxs(h,{variant:"secondary",onClick:n=>$(null,n),className:"flex-grow sm:flex-grow-0",children:[e.jsx(s,{name:"plus",className:"w-5 h-5 mr-2"}),"Add New Question"]}),e.jsxs(h,{variant:"ghost",onClick:r,className:"flex-grow sm:flex-grow-0",children:[e.jsx(s,{name:"code",className:"w-5 h-5 mr-2"}),"Bulk Add via JSON"]}),e.jsx("div",{className:"flex-grow"}),W&&e.jsx(Oe,{deck:t,isGenerating:ie,onGenerateMore:()=>J==null?void 0:J.handleOpenAIGenerationForDeck(t),onRework:()=>J==null?void 0:J.handleOpenAIReworkForDeck(t),onAnalyze:()=>J==null?void 0:J.handleOpenDeckAnalysis(t),onAutoTag:()=>J==null?void 0:J.handleAutoTagQuestions(t),onHardenDistractors:()=>J==null?void 0:J.handleHardenAllDistractors(t)})]})]}),N&&e.jsx(Ct,{question:S,onClose:B,onSave:O,deckName:b}),z&&e.jsx(Ve,{isOpen:!!z,onClose:()=>k(null),onConfirm:M,title:"Delete Question",message:"Are you sure you want to delete this question? This action cannot be undone."})]})},Dt=({isOpen:t,onClose:o,onAddItems:g,deckType:w})=>{const[r,c]=a.useState(""),{addToast:m}=Se(),u=a.useRef(null);je(u,t);const j=a.useMemo(()=>w===F.Flashcard?`[
  {
    "front": "What is the capital of Japan?",
    "back": "Tokyo"
  },
  {
    "front": "What is 2 + 2?",
    "back": "4"
  }
]`:`[
  {
    "questionText": "Which planet is known as the Red Planet?",
    "options": [
      { "id": "1", "text": "Earth" },
      { "id": "2", "text": "Mars" }
    ],
    "correctAnswerId": "2",
    "detailedExplanation": "Mars is called the Red Planet because of its reddish appearance."
  }
]`,[w]),b=D=>{if(D.preventDefault(),!r.trim()){m("JSON content cannot be empty.","error");return}try{const N=ct(r,w);if(N.length===0){m("The JSON array is empty. No items were added.","info"),o();return}g(N),m(`Successfully added ${N.length} item(s).`,"success"),o()}catch(N){m(N instanceof Error?N.message:"Invalid JSON format.","error")}},S=D=>{if(D.key==="Tab"){D.preventDefault();const N=D.target,E=N.selectionStart,z=N.selectionEnd;N.value=N.value.substring(0,E)+"  "+N.value.substring(z),N.selectionStart=N.selectionEnd=E+2}};return t?e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-75 flex items-center justify-center z-[60] p-4",children:e.jsx("div",{ref:u,className:"bg-surface rounded-lg shadow-xl w-full max-w-2xl transform transition-all relative",children:e.jsxs("form",{onSubmit:b,children:[e.jsxs("div",{className:"flex justify-between items-center p-4 border-b border-border",children:[e.jsxs("h2",{className:"text-xl font-bold",children:["Bulk Add ",w===F.Flashcard?"Cards":"Questions"]}),e.jsx(h,{type:"button",variant:"ghost",onClick:o,className:"p-1 h-auto",children:e.jsx(s,{name:"x"})})]}),e.jsxs("div",{className:"p-6",children:[e.jsx("label",{htmlFor:"json-content-bulk",className:"block text-sm font-medium text-text-muted mb-1",children:"Paste an array of items in JSON format."}),e.jsx("textarea",{id:"json-content-bulk",value:r,onChange:D=>c(D.target.value),onKeyDown:S,rows:15,className:"w-full p-2 bg-background border border-border rounded-md focus:ring-2 focus:ring-primary focus:outline-none font-mono text-sm",placeholder:j}),e.jsxs(he,{href:"/instructions/json",onClick:o,className:"text-sm text-primary hover:underline mt-2 inline-flex items-center gap-1",children:[e.jsx(s,{name:"help-circle",className:"w-4 h-4"}),"View JSON format guide"]})]}),e.jsxs("div",{className:"flex justify-end p-4 bg-background/50 border-t border-border",children:[e.jsx(h,{type:"button",variant:"secondary",onClick:o,className:"mr-2",children:"Cancel"}),e.jsx(h,{type:"submit",variant:"primary",children:"Add Items"})]})]})})}):null},It=({data:t,total:o})=>o===0?e.jsx("div",{className:"w-full bg-gray-200 dark:bg-gray-700 rounded-full h-4"}):e.jsx("div",{className:"flex w-full h-4 bg-gray-200 dark:bg-gray-700 rounded-full overflow-hidden",role:"progressbar","aria-valuenow":t.reduce((g,w)=>g+w.value,0),"aria-valuemin":0,"aria-valuemax":o,children:t.map((g,w)=>{if(g.value===0)return null;const r=g.value/o*100;return e.jsx("div",{className:`${g.color} transition-all duration-500`,style:{width:`${r}%`},title:`${g.label}: ${g.value} item(s)`},w)})}),At=({data:t})=>{const o=Math.max(...t.map(b=>b.count),1),g=350,w=120,r={top:25,right:15,bottom:25,left:15},c=g-r.left-r.right,m=w-r.top-r.bottom,u=c/t.length,j=Math.max(6,u*.1);return e.jsxs("div",{className:"w-full",children:[e.jsx("h4",{className:"text-sm font-semibold text-gray-700 dark:text-gray-300 mb-2",children:"Upcoming Due Dates (Next 7 Days)"}),e.jsx("div",{className:"bg-gray-50 dark:bg-gray-900/50 p-2 rounded-lg border border-gray-200 dark:border-gray-700/50",children:e.jsxs("svg",{viewBox:`0 0 ${g} ${w}`,width:"100%",height:"auto","aria-labelledby":"due-date-graph-title",role:"img",className:"overflow-visible",children:[e.jsx("title",{id:"due-date-graph-title",children:"A bar chart showing the number of items due over the next 7 days."}),t.map((b,S)=>{const D=b.count>0?b.count/o*m:0,N=r.left+S*u+(u-j)/2,E=r.top+m-D;return e.jsxs("g",{className:"group",style:{cursor:"pointer"},children:[e.jsxs("title",{children:[b.date,": ",b.count," item",b.count!==1?"s":""," due"]}),e.jsx("rect",{x:N,y:E,width:j,height:D,rx:"2",className:"fill-blue-500 transition-colors group-hover:fill-blue-400"}),e.jsx("text",{x:N+j/2,y:E-6,textAnchor:"middle",className:"fill-gray-600 dark:fill-gray-300 font-semibold text-sm transition-opacity opacity-0 group-hover:opacity-100 pointer-events-none",children:b.count}),e.jsx("text",{x:N+j/2,y:w-r.bottom+15,textAnchor:"middle",className:"fill-gray-400 dark:fill-gray-500 text-xs pointer-events-none",children:b.dayLabel})]},S)})]})})]})},Et=({reviews:t})=>{const[o,g]=a.useState(null),w=a.useMemo(()=>{if(!t||t.length===0)return[];const k=new Map;t.forEach(l=>{const C=new Date(l.timestamp).toISOString().split("T")[0],d=k.get(C)||{totalMastery:0,count:0};d.totalMastery+=l.masteryLevel,d.count++,k.set(C,d)});const I=Array.from(k.entries()).map(([l,{totalMastery:C,count:d}])=>({date:new Date(l),avgMastery:C/d}));return I.sort((l,C)=>l.date.getTime()-C.date.getTime()),I.slice(-90)},[t]);if(w.length<2)return e.jsx("div",{className:"text-center text-sm text-text-muted py-8",children:"Not enough review history to plot a graph."});const r=350,c=150,m={top:10,right:10,bottom:20,left:30},u=r-m.left-m.right,j=c-m.top-m.bottom,b=w[0].date.getTime(),S=w[w.length-1].date.getTime(),D=k=>(k.getTime()-b)/(S-b)*u+m.left,N=k=>c-m.bottom-k*j,E=w.map(k=>`${D(k.date)},${N(k.avgMastery)}`).join(" L "),z=k=>{const I=k.currentTarget.getBoundingClientRect(),l=k.clientX-I.left;let C=w[0],d=1/0;w.forEach(p=>{const R=D(p.date),T=Math.abs(l-R);T<d&&(d=T,C=p)}),d<20?g({x:D(C.date),y:N(C.avgMastery),data:C}):g(null)};return e.jsx("div",{className:"w-full",children:e.jsxs("svg",{viewBox:`0 0 ${r} ${c}`,width:"100%",height:"auto","aria-labelledby":"mastery-graph-title",role:"img",className:"overflow-visible",onMouseMove:z,onMouseLeave:()=>g(null),children:[e.jsx("title",{id:"mastery-graph-title",children:"A line chart showing average mastery over time."}),[0,.25,.5,.75,1].map(k=>e.jsxs("g",{children:[e.jsx("line",{x1:m.left,y1:N(k),x2:r-m.right,y2:N(k),className:"stroke-current text-border/70",strokeWidth:"0.5"}),e.jsx("text",{x:m.left-8,y:N(k)+4,textAnchor:"end",className:"text-xs fill-text-muted",children:`${k*100}%`})]},k)),e.jsx("text",{x:m.left,y:c-5,textAnchor:"start",className:"text-xs fill-text-muted",children:w[0].date.toLocaleDateString("en-us",{month:"short",day:"numeric"})}),e.jsx("text",{x:r-m.right,y:c-5,textAnchor:"end",className:"text-xs fill-text-muted",children:w[w.length-1].date.toLocaleDateString("en-us",{month:"short",day:"numeric"})}),e.jsx("path",{d:`M ${E}`,className:"stroke-primary",fill:"none",strokeWidth:"2",strokeLinejoin:"round",strokeLinecap:"round"}),o&&e.jsxs("g",{children:[e.jsx("line",{x1:o.x,y1:m.top,x2:o.x,y2:c-m.bottom,className:"stroke-current text-border",strokeDasharray:"2,2"}),e.jsx("circle",{cx:o.x,cy:o.y,r:"4",className:"fill-primary"}),e.jsxs("g",{transform:`translate(${o.x>r/2?o.x-100:o.x+10}, ${m.top})`,children:[e.jsx("rect",{x:"0",y:"0",width:"90",height:"35",rx:"4",className:"fill-surface opacity-90",stroke:"rgb(var(--color-border))"}),e.jsx("text",{x:"5",y:"15",className:"text-xs fill-text font-semibold",children:o.data.date.toLocaleDateString("en-us",{month:"short",day:"numeric"})}),e.jsxs("text",{x:"5",y:"30",className:"text-xs fill-text-muted",children:["Mastery: ",Math.round(o.data.avgMastery*100),"%"]})]})]})]})})},Tt=({block:t,onClose:o,onSave:g})=>{const[w,r]=a.useState(""),[c,m]=a.useState([]),{addToast:u}=Se(),j=a.useRef(null);je(j,!0),a.useEffect(()=>{t?(r(t.infoCard.content),m(t.questions.map(l=>({...l})))):m([{id:crypto.randomUUID(),questionText:"",options:[{id:crypto.randomUUID(),text:""},{id:crypto.randomUUID(),text:""}],correctAnswerId:"",detailedExplanation:""}])},[t]);const b=(l,C,d)=>{const p=[...c];p[l][C]=d,m(p)},S=(l,C,d)=>{const p=[...c];p[l].options&&(p[l].options[C].text=d,m(p))},D=()=>{m([...c,{id:crypto.randomUUID(),questionText:"",options:[{id:crypto.randomUUID(),text:""},{id:crypto.randomUUID(),text:""}],correctAnswerId:"",detailedExplanation:""}])},N=l=>{if(c.length<=1){u("A learning block must have at least one question.","error");return}m(c.filter((C,d)=>d!==l))},E=l=>{var d;const C=[...c];(d=C[l].options)==null||d.push({id:crypto.randomUUID(),text:""}),m(C)},z=(l,C)=>{const d=[...c],p=d[l];if(p.options&&p.options.length>2){const R=p.options.splice(C,1)[0];p.correctAnswerId===R.id&&(p.correctAnswerId=""),m(d)}else u("A question must have at least two options.","error")},k=(l,C)=>{if(l.key==="Tab"){l.preventDefault();const d=l.target,p=d.selectionStart,R=d.selectionEnd,T=d.value.substring(0,p)+"	"+d.value.substring(R);d.value=T,C(T),d.selectionStart=d.selectionEnd=p+1}},I=l=>{var R,T;if(l.preventDefault(),!w.trim()){u("Informational content cannot be empty.","error");return}for(const P of c){if(!((R=P.questionText)!=null&&R.trim())){u("Question text is required.","error");return}if((T=P.options)!=null&&T.some(U=>!U.text.trim())){u("All options must have text.","error");return}if(!P.correctAnswerId){u("You must select a correct answer for each question.","error");return}}const C=new Date().toISOString(),d={id:(t==null?void 0:t.infoCard.id)||crypto.randomUUID(),content:w,unlocksQuestionIds:c.map(P=>P.id)},p=c.map((P,U)=>{const K=t==null?void 0:t.questions[U];return{...K,...P,id:P.id,questionType:"multipleChoice",infoCardIds:[d.id],dueDate:(K==null?void 0:K.dueDate)||C,interval:(K==null?void 0:K.interval)||0,easeFactor:(K==null?void 0:K.easeFactor)||Te,tags:P.tags||[]}});g({infoCard:d,questions:p})};return e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-75 flex items-center justify-center z-[60] p-4",children:e.jsx("div",{ref:j,className:"bg-surface rounded-lg shadow-xl w-full max-w-4xl transform transition-all relative max-h-[90vh] flex flex-col",children:e.jsxs("form",{onSubmit:I,className:"flex flex-col h-full",children:[e.jsxs("header",{className:"flex-shrink-0 flex justify-between items-center p-4 border-b border-border",children:[e.jsx("h2",{className:"text-xl font-bold",children:t?"Edit Learning Block":"Add New Learning Block"}),e.jsx(h,{type:"button",variant:"ghost",onClick:o,className:"p-1 h-auto",children:e.jsx(s,{name:"x"})})]}),e.jsxs("main",{className:"p-6 space-y-6 overflow-y-auto",children:[e.jsxs("div",{children:[e.jsx("label",{htmlFor:"info-content",className:"block text-sm font-bold text-text mb-1",children:"Informational Content (Supports HTML)"}),e.jsxs("div",{className:"border border-border rounded-md focus-within:ring-2 focus-within:ring-primary overflow-hidden",children:[e.jsx(Ce,{targetId:"info-content",value:w,onChange:r}),e.jsx("textarea",{id:"info-content",value:w,onChange:l=>r(l.target.value),onKeyDown:l=>k(l,r),rows:12,className:"w-full p-2 bg-background focus:outline-none font-mono text-sm block",placeholder:"Explain a concept here..."})]})]}),e.jsxs("div",{className:"border-t border-border pt-4",children:[e.jsx("h3",{className:"text-lg font-bold text-text mb-2",children:"Questions"}),e.jsxs("div",{className:"space-y-6",children:[c.map((l,C)=>{var d;return e.jsxs("div",{className:"p-4 bg-background rounded-lg border border-border space-y-3 relative",children:[e.jsxs("label",{className:"block text-sm font-medium text-text-muted",children:["Question ",C+1]}),e.jsx("textarea",{value:l.questionText,onChange:p=>b(C,"questionText",p.target.value),rows:2,className:"w-full p-2 bg-surface border border-border rounded-md focus:ring-2 focus:ring-primary focus:outline-none",placeholder:"Question related to the info above"}),e.jsx("div",{className:"space-y-2",children:(d=l.options)==null?void 0:d.map((p,R)=>e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"radio",name:`correct-answer-${C}`,checked:l.correctAnswerId===p.id,onChange:()=>b(C,"correctAnswerId",p.id),className:"h-5 w-5 text-primary bg-border/50 border-border focus:ring-primary"}),e.jsx("input",{type:"text",value:p.text,onChange:T=>S(C,R,T.target.value),className:"flex-grow p-2 bg-surface border border-border rounded-md focus:ring-2 focus:ring-primary focus:outline-none",placeholder:`Option ${R+1}`}),e.jsx(h,{type:"button",variant:"ghost",onClick:()=>z(C,R),className:"p-2 h-auto text-text-muted hover:text-red-500",children:e.jsx(s,{name:"x",className:"w-4 h-4"})})]},p.id||R))}),e.jsxs(h,{type:"button",variant:"ghost",onClick:()=>E(C),size:"sm",children:[e.jsx(s,{name:"plus",className:"w-4 h-4 mr-1"}),"Add Option"]}),e.jsx("textarea",{value:l.detailedExplanation,onChange:p=>b(C,"detailedExplanation",p.target.value),rows:2,className:"w-full p-2 bg-surface border border-border rounded-md focus:ring-2 focus:ring-primary focus:outline-none",placeholder:"Detailed explanation for the answer"}),e.jsx(h,{type:"button",variant:"ghost",onClick:()=>N(C),className:"absolute top-2 right-2 p-2 h-auto text-text-muted hover:text-red-500",children:e.jsx(s,{name:"trash-2",className:"w-4 h-4"})})]},l.id||C)}),e.jsxs(h,{type:"button",variant:"secondary",onClick:D,children:[e.jsx(s,{name:"plus",className:"w-4 h-4 mr-2"}),"Add Question"]})]})]})]}),e.jsxs("footer",{className:"flex-shrink-0 flex justify-end p-4 bg-background/50 border-t border-border",children:[e.jsx(h,{type:"button",variant:"secondary",onClick:o,className:"mr-2",children:"Cancel"}),e.jsx(h,{type:"submit",variant:"primary",children:t?"Save Changes":"Add Block"})]})]})})})},zt=({deck:t,onSaveBlock:o,onDeleteBlock:g,onBlockClick:w,onReorderBlocks:r})=>{const[c,m]=a.useState(null),[u,j]=a.useState(!1),[b,S]=a.useState(null),[D,N]=a.useState(new Set),[E,z]=a.useState(new Set),k=a.useRef(null),{aiFeaturesEnabled:I}=ye(),l=ve(),{openModal:C}=ze(),d=be(v=>v.aiGenerationStatus.currentTask),p=be(v=>v.aiGenerationStatus.queue),R=a.useCallback((v,M)=>{var Y;const O=M==="text"?"holistic-expand-item":"deep-expand-questions";return((Y=d==null?void 0:d.payload)==null?void 0:Y.itemId)===v&&(d==null?void 0:d.type)===O?!0:(p||[]).some(Z=>{var se;return((se=Z.payload)==null?void 0:se.itemId)===v&&Z.type===O})},[d,p]),T=!!d&&d.deckId===t.id,P=(v,M)=>{m(v),M&&(k.current=M.currentTarget),j(!0)},U=()=>{var v;j(!1),(v=k.current)==null||v.focus(),m(null)},K=v=>{o(v),U()},ae=(v,M)=>{v.stopPropagation();const O=new Set(D);O.has(M)?O.delete(M):O.add(M),N(O)},ee=(v,M)=>{v.stopPropagation();const O=new Set(E);O.has(M)?O.delete(M):O.add(M),z(O)},W=()=>N(new Set(t.infoCards.map(v=>v.id))),J=()=>N(new Set),oe=()=>z(new Set(t.infoCards.map(v=>v.id))),ie=()=>z(new Set),le=(v,M,O)=>{v.stopPropagation(),C("synthesisConfig",{title:O==="text"?"Custom Holistic Synthesis":"Assessment Deepening",type:O,onConfirm:Y=>{l==null||l.handleImmediateAIGeneration({generationType:O==="text"?"holistic-expand-item":"deep-expand-questions",topic:t.name,deckId:t.id,itemId:M,...Y})}})},te=a.useMemo(()=>(t.infoCards||[]).map(v=>({infoCard:v,questions:(t.questions||[]).filter(M=>{var O;return(O=M.infoCardIds)==null?void 0:O.includes(v.id)})})),[t.infoCards,t.questions]),y=(v,M)=>{S(v),M.dataTransfer.effectAllowed="move"},$=(v,M)=>{M.preventDefault(),M.dataTransfer.dropEffect="move"},B=(v,M)=>{if(M.preventDefault(),b===null||b===v)return;const O=[...t.infoCards||[]],[Y]=O.splice(b,1);O.splice(v,0,Y),r(O),S(null)};return e.jsxs("div",{children:[e.jsxs("div",{className:"border-b border-border p-6 flex justify-between items-start bg-surface sticky top-0 z-10",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-xl font-semibold text-text",children:"Learning Blocks"}),e.jsx("p",{className:"text-sm text-text-muted mt-1",children:"Each block contains an info card and its related questions."})]}),te.length>0&&e.jsxs("div",{className:"flex flex-col gap-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-[10px] font-bold text-text-muted uppercase w-12",children:"Text:"}),e.jsx(h,{variant:"ghost",size:"sm",onClick:W,title:"Expand All Text",children:e.jsx(s,{name:"maximize",className:"w-3.5 h-3.5"})}),e.jsx(h,{variant:"ghost",size:"sm",onClick:J,title:"Collapse All Text",children:e.jsx(s,{name:"minimize",className:"w-3.5 h-3.5"})})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-[10px] font-bold text-text-muted uppercase w-12",children:"Quiz:"}),e.jsx(h,{variant:"ghost",size:"sm",onClick:oe,title:"Expand All Questions",children:e.jsx(s,{name:"maximize",className:"w-3.5 h-3.5"})}),e.jsx(h,{variant:"ghost",size:"sm",onClick:ie,title:"Collapse All Questions",children:e.jsx(s,{name:"minimize",className:"w-3.5 h-3.5"})})]})]})]}),e.jsx("div",{className:"p-6",children:te.length>0?e.jsx("ul",{className:"space-y-4",children:te.map((v,M)=>{const O=b===M,Y=D.has(v.infoCard.id),Z=E.has(v.infoCard.id),se=R(v.infoCard.id,"text"),f=R(v.infoCard.id,"questions");return e.jsx("li",{className:`p-4 rounded-lg bg-background border transition-all duration-200 cursor-pointer ${O?"opacity-50 ring-2 ring-primary border-transparent":"border-border hover:border-primary hover:shadow-md"}`,draggable:!0,onDragStart:x=>y(M,x),onDragOver:x=>$(M,x),onDrop:x=>B(M,x),onClick:()=>w(v),onKeyDown:x=>{(x.key==="Enter"||x.key===" ")&&w(v)},tabIndex:0,role:"button",children:e.jsxs("div",{className:"flex flex-col gap-4",children:[e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex items-start flex-1 min-w-0 mr-4",children:[e.jsx("div",{className:"mr-3 mt-1 cursor-grab active:cursor-grabbing text-text-muted hover:text-text",onClick:x=>x.stopPropagation(),children:e.jsx(s,{name:"grip-vertical",className:"w-5 h-5"})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center gap-2 text-text font-semibold mb-1",children:[se||f?e.jsx("div",{className:"p-1 animate-pulse bg-primary/10 rounded",children:e.jsx(s,{name:"bot",className:"w-4 h-4 text-primary"})}):e.jsx(s,{name:"book-open",className:"w-5 h-5 text-purple-500 flex-shrink-0"}),e.jsx("p",{className:"truncate",title:Ne(v.infoCard.content),children:Ne(v.infoCard.content)})]}),e.jsxs("div",{className:"flex flex-wrap gap-x-4 gap-y-2",children:[e.jsxs("button",{onClick:x=>ae(x,v.infoCard.id),className:"text-[10px] flex items-center gap-1 font-bold uppercase tracking-widest text-text-muted hover:text-primary transition-colors",children:[e.jsx(s,{name:Y?"minimize":"maximize",className:"w-3 h-3"}),Y?"Collapse Text":"Full Text"]}),e.jsxs("button",{onClick:x=>ee(x,v.infoCard.id),className:"text-[10px] flex items-center gap-1 font-bold uppercase tracking-widest text-text-muted hover:text-primary transition-colors",children:[e.jsx(s,{name:Z?"minimize":"maximize",className:"w-3 h-3"}),Z?"Hide Quiz":`${v.questions.length} Questions`]}),I&&e.jsxs("div",{className:"flex gap-2 pl-2 border-l border-border",children:[e.jsxs("button",{onClick:x=>le(x,v.infoCard.id,"text"),disabled:se,className:`text-[10px] flex items-center gap-1 font-bold uppercase tracking-widest transition-colors ${se?"text-primary animate-pulse":"text-indigo-500 hover:text-indigo-700"}`,title:"AI: Holistic Text Expansion",children:[se?e.jsx(me,{size:"sm"}):e.jsx(s,{name:"zap",className:"w-3 h-3"}),"Enhance"]}),e.jsxs("button",{onClick:x=>le(x,v.infoCard.id,"questions"),disabled:f,className:`text-[10px] flex items-center gap-1 font-bold uppercase tracking-widest transition-colors ${f?"text-primary animate-pulse":"text-indigo-500 hover:text-indigo-700"}`,title:"AI: Add Deeper Questions",children:[f?e.jsx(me,{size:"sm"}):e.jsx(s,{name:"plus",className:"w-3 h-3"}),"More Quiz"]})]})]})]})]}),e.jsxs("div",{className:"flex-shrink-0 flex items-center gap-1",children:[e.jsx(h,{variant:"ghost",size:"sm",className:"p-2 h-auto",onClick:x=>{x.stopPropagation(),P(v,x)},title:"Edit this block",children:e.jsx(s,{name:"edit",className:"w-4 h-4"})}),e.jsx(h,{variant:"ghost",size:"sm",className:"p-2 h-auto text-text-muted hover:text-red-500",onClick:x=>{x.stopPropagation(),g(v.infoCard.id)},title:"Delete this block",children:e.jsx(s,{name:"trash-2",className:"w-4 h-4"})})]})]}),Y&&e.jsxs("div",{className:"bg-surface p-4 rounded border border-border animate-fade-in",onClick:x=>x.stopPropagation(),children:[e.jsx("p",{className:"text-[10px] font-bold text-text-muted uppercase mb-3 tracking-widest border-b border-border pb-1",children:"Instructional Material"}),e.jsx(pe,{html:v.infoCard.content,className:"prose prose-sm dark:prose-invert max-w-none"})]}),Z&&e.jsxs("div",{className:"bg-surface p-4 rounded border border-border animate-fade-in",onClick:x=>x.stopPropagation(),children:[e.jsx("p",{className:"text-[10px] font-bold text-text-muted uppercase mb-3 tracking-widest border-b border-border pb-1",children:"Block Assessment"}),e.jsx("ul",{className:"space-y-4",children:v.questions.map((x,X)=>e.jsx("li",{className:"text-sm",children:e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsxs("span",{className:"font-bold text-primary flex-shrink-0",children:[X+1,"."]}),e.jsxs("div",{children:[e.jsx("p",{className:"font-semibold text-text",children:Ne(x.questionText)}),e.jsx("ul",{className:"mt-2 grid grid-cols-1 sm:grid-cols-2 gap-2",children:x.options.map(n=>e.jsxs("li",{className:`p-2 rounded border text-xs flex items-center gap-2 ${n.id===x.correctAnswerId?"bg-green-500/10 border-green-500/30 font-bold":"bg-background border-border/50"}`,children:[n.id===x.correctAnswerId&&e.jsx(s,{name:"check-circle",className:"w-3 h-3 text-green-500"}),n.text]},n.id))})]})]})},x.id))})]})]})},v.infoCard.id)})}):e.jsxs("div",{className:"text-center text-text-muted py-8",children:[e.jsx(s,{name:"layers",className:"w-12 h-12 mx-auto mb-2 opacity-50"}),e.jsx("p",{children:"This deck has no learning blocks yet."})]})}),e.jsxs("div",{className:"px-6 py-4 border-t border-border flex flex-wrap gap-2 items-center",children:[e.jsxs(h,{variant:"secondary",onClick:v=>P(null,v),className:"flex-grow sm:flex-grow-0",children:[e.jsx(s,{name:"plus",className:"w-5 h-5 mr-2"}),"Add Learning Block"]}),e.jsx("div",{className:"flex-grow"}),I&&e.jsx(Oe,{deck:t,isGenerating:T,onGenerateMore:()=>l==null?void 0:l.handleOpenAIGenerationForDeck(t),onRework:()=>l==null?void 0:l.handleOpenAIReworkForDeck(t),onAnalyze:()=>l==null?void 0:l.handleOpenDeckAnalysis(t),onAutoTag:()=>l==null?void 0:l.handleAutoTagQuestions(t),onHardenDistractors:()=>l==null?void 0:l.handleHardenAllDistractors(t),onHolisticUpgrade:(v,M)=>l.handleHolisticUpgrade(t,v,M)})]}),u&&e.jsx(Tt,{block:c,onClose:U,onSave:K})]})},Mt=({isOpen:t,onClose:o,block:g,deckName:w,onExpandText:r})=>{const c=a.useRef(null),m=a.useRef(null),[u,j]=a.useState(null),[b,S]=a.useState(null);je(c,t);const D=()=>{j(null),S(null),o()},N=()=>{var l;if(b)return;const I=window.getSelection();if(I&&I.toString().trim().length>10){const C=I.toString().trim(),p=I.getRangeAt(0).getBoundingClientRect(),R=(l=c.current)==null?void 0:l.getBoundingClientRect();R&&j({visible:!0,top:p.top-R.top+p.height,left:p.left-R.left+p.width/2,text:C})}else j(null)},E=async()=>{if(!(u!=null&&u.text)||!g)return;const{text:I}=u;j(null),S({isLoading:!0,content:null});const l=await r(w,g.infoCard.content,I);S({isLoading:!1,content:l})},z=()=>e.jsxs(e.Fragment,{children:[e.jsxs("div",{onMouseUp:N,ref:m,children:[e.jsx("h3",{className:"text-sm font-semibold uppercase tracking-wider text-text-muted mb-2",children:"Informational Content"}),e.jsx("div",{className:"p-4 bg-background rounded-lg border border-border",children:e.jsx(pe,{html:g.infoCard.content,className:"prose dark:prose-invert max-w-none"})})]}),e.jsxs("div",{children:[e.jsxs("h3",{className:"text-sm font-semibold uppercase tracking-wider text-text-muted mb-2",children:["Associated Questions (",(g.questions||[]).length,")"]}),e.jsx("ul",{className:"space-y-3",children:(g.questions||[]).map(I=>e.jsxs("li",{className:"p-3 bg-background rounded-lg border border-border",children:[e.jsx("p",{className:"font-semibold text-text",dangerouslySetInnerHTML:{__html:I.questionText}}),e.jsx("ul",{className:"mt-2 pl-4 text-sm space-y-1",children:(I.options||[]).map(l=>e.jsxs("li",{className:`flex items-start gap-2 ${l.id===I.correctAnswerId?"text-green-600 dark:text-green-400 font-medium":"text-text-muted"}`,children:[l.id===I.correctAnswerId?e.jsx(s,{name:"check-circle",className:"w-4 h-4 flex-shrink-0 mt-0.5"}):e.jsx("div",{className:"w-4 h-4 flex-shrink-0"}),e.jsx("span",{dangerouslySetInnerHTML:{__html:l.text}})]},l.id))})]},I.id))})]})]}),k=()=>e.jsxs("div",{className:"space-y-4",children:[e.jsxs(h,{variant:"ghost",size:"sm",onClick:()=>S(null),children:[e.jsx(s,{name:"chevron-left",className:"w-4 h-4 mr-1"}),"Back to Content"]}),b!=null&&b.isLoading?e.jsx("div",{className:"flex justify-center items-center h-48",children:e.jsx(me,{})}):b!=null&&b.content?e.jsx("div",{className:"p-4 bg-background rounded-lg border border-border",children:e.jsx(pe,{html:b.content,className:"prose dark:prose-invert max-w-none"})}):e.jsx("p",{className:"text-center text-red-500",children:"Failed to generate explanation."})]});return!t||!g?null:e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-75 flex items-center justify-center z-[60] p-4",children:e.jsxs("div",{ref:c,className:"bg-surface rounded-lg shadow-xl w-full max-w-3xl transform transition-all relative max-h-[90vh] flex flex-col",role:"dialog","aria-modal":"true","aria-labelledby":"block-detail-title",children:[(u==null?void 0:u.visible)&&e.jsx("div",{className:"absolute z-10 p-1",style:{top:u.top,left:u.left,transform:"translateX(-50%)"},children:e.jsxs(h,{size:"sm",onClick:E,children:[e.jsx(s,{name:"zap",className:"w-4 h-4 mr-1"})," Expand"]})}),e.jsxs("div",{className:"flex-shrink-0 flex justify-between items-center p-4 border-b border-border",children:[e.jsx("h2",{id:"block-detail-title",className:"text-xl font-bold text-text",children:"Learning Block Details"}),e.jsx(h,{type:"button",variant:"ghost",onClick:D,className:"p-1 h-auto","aria-label":"Close",children:e.jsx(s,{name:"x"})})]}),e.jsx("div",{className:"p-6 overflow-y-auto space-y-6",children:b?k():z()}),e.jsx("div",{className:"flex-shrink-0 flex justify-end p-4 bg-background/50 border-t border-border",children:e.jsx(h,{type:"button",variant:"primary",onClick:D,children:"Close"})})]})})},$t=()=>e.jsx("div",{className:"space-y-8",children:e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-8",children:[e.jsxs("div",{className:"bg-surface p-6 rounded-lg shadow-md border border-border h-64 flex flex-col",children:[e.jsxs("div",{className:"mb-4",children:[e.jsx(re,{width:180,height:24}),e.jsx(re,{width:250,height:16,className:"mt-2"})]}),e.jsxs("div",{className:"flex-1 flex items-end gap-2 pb-4 px-2",children:[e.jsx(re,{width:"15%",height:"30%",className:"rounded-t-sm"}),e.jsx(re,{width:"15%",height:"50%",className:"rounded-t-sm"}),e.jsx(re,{width:"15%",height:"40%",className:"rounded-t-sm"}),e.jsx(re,{width:"15%",height:"70%",className:"rounded-t-sm"}),e.jsx(re,{width:"15%",height:"60%",className:"rounded-t-sm"}),e.jsx(re,{width:"15%",height:"80%",className:"rounded-t-sm"})]})]}),e.jsxs("div",{className:"bg-surface p-6 rounded-lg shadow-md border border-border h-64",children:[e.jsxs("div",{className:"mb-4",children:[e.jsx(re,{width:150,height:24}),e.jsx(re,{width:200,height:16,className:"mt-2"})]}),e.jsx("div",{className:"space-y-3",children:[1,2,3].map(t=>e.jsxs("div",{className:"p-3 bg-background rounded-md border border-transparent",children:[e.jsx(re,{width:"80%",height:16}),e.jsx(re,{width:"30%",height:12,className:"mt-2"})]},t))})]})]})}),Ot=({isOpen:t,onClose:o,onStart:g,totalItems:w})=>{const[r,c]=a.useState("random"),[m,u]=a.useState("all"),j=a.useRef(null);je(j,t);const b=()=>{g({sort:r,limit:m}),o()};return t?e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-75 flex items-center justify-center z-[60] p-4",children:e.jsxs("div",{ref:j,className:"bg-surface rounded-lg shadow-xl w-full max-w-sm transform transition-all relative",children:[e.jsxs("div",{className:"flex justify-between items-center p-4 border-b border-border",children:[e.jsx("h2",{className:"text-xl font-bold text-text",children:"Cram Session Options"}),e.jsx(h,{variant:"ghost",onClick:o,className:"p-1 h-auto",children:e.jsx(s,{name:"x"})})]}),e.jsxs("div",{className:"p-6 space-y-6",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-text-muted mb-2",children:"Sort Order"}),e.jsx("div",{className:"grid grid-cols-2 gap-2",children:["random","hardest","newest","oldest"].map(S=>e.jsx("button",{onClick:()=>c(S),className:`p-2 rounded-md text-sm border capitalize transition-colors ${r===S?"bg-primary text-on-primary border-primary":"bg-background border-border text-text hover:border-primary"}`,children:S},S))}),e.jsxs("p",{className:"text-xs text-text-muted mt-2",children:[r==="random"&&"Shuffle cards randomly.",r==="hardest"&&"Focus on cards with high lapse counts and low ease factors.",r==="newest"&&"Review the most recently added cards first.",r==="oldest"&&"Review cards from the beginning of the deck."]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-text-muted mb-2",children:"Card Limit"}),e.jsxs("select",{value:m,onChange:S=>u(S.target.value==="all"?"all":Number(S.target.value)),className:"w-full p-2 bg-background border border-border rounded-md focus:ring-2 focus:ring-primary outline-none",children:[e.jsxs("option",{value:"all",children:["All (",w,")"]}),e.jsx("option",{value:"10",disabled:w<10,children:"10 Items"}),e.jsx("option",{value:"20",disabled:w<20,children:"20 Items"}),e.jsx("option",{value:"50",disabled:w<50,children:"50 Items"}),e.jsx("option",{value:"100",disabled:w<100,children:"100 Items"})]})]})]}),e.jsxs("div",{className:"flex justify-end p-4 bg-background/50 border-t border-border",children:[e.jsx(h,{variant:"secondary",onClick:o,className:"mr-2",children:"Cancel"}),e.jsxs(h,{variant:"primary",onClick:b,children:[e.jsx(s,{name:"zap",className:"w-4 h-4 mr-2"})," Start Cramming"]})]})]})}):null},Rt=t=>{const o={new:0,learning:0,young:0,mature:0};return t.forEach(g=>{g.interval===0?o.new++:g.interval<7?o.learning++:g.interval<21?o.young++:o.mature++}),o},Lt=({deck:t})=>{const[o,g]=a.useState([]),[w,r]=a.useState(!0),c=(t.type===F.Flashcard?t.cards:(t.type===F.Learning,t.questions))||[];a.useEffect(()=>{(async()=>{r(!0);try{const j=await jt(t.id);g(j)}catch(j){console.error("Failed to fetch review history for deck:",j)}finally{r(!1)}})()},[t.id]);const m=a.useMemo(()=>{if(!o.length)return[];const u=new Map;return o.forEach(j=>{j.rating===ft.Again&&u.set(j.itemId,(u.get(j.itemId)||0)+1)}),Array.from(u.entries()).sort((j,b)=>b[1]-j[1]).slice(0,5).map(([j,b])=>{const S=c.find(D=>D.id===j);return S?{...S,failureCount:b}:null}).filter(j=>!!j)},[o,c]);return w?e.jsx($t,{}):o.length===0?e.jsxs("div",{className:"text-center py-10 bg-surface rounded-lg border border-border",children:[e.jsx(s,{name:"trending-up",className:"w-12 h-12 mx-auto text-text-muted/50"}),e.jsx("h3",{className:"mt-2 text-xl font-medium text-text",children:"No Statistics Yet"}),e.jsx("p",{className:"mt-1 text-sm text-text-muted",children:"Complete a study session for this deck to see your stats."})]}):e.jsx("div",{className:"space-y-8 animate-fade-in",children:e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-8",children:[e.jsxs("div",{className:"bg-surface p-6 rounded-lg shadow-md border border-border",children:[e.jsx("h3",{className:"text-xl font-semibold text-text mb-4",children:"Mastery Over Time"}),e.jsx("p",{className:"text-sm text-text-muted mb-4",children:"Average mastery level of reviewed cards per day over the last 90 days of activity."}),e.jsx(Et,{reviews:o})]}),e.jsxs("div",{className:"bg-surface p-6 rounded-lg shadow-md border border-border",children:[e.jsx("h3",{className:"text-xl font-semibold text-text mb-4",children:"Most Difficult Items"}),e.jsx("p",{className:"text-sm text-text-muted mb-4",children:`Items you've marked "Again" most frequently.`}),m.length>0?e.jsx("ul",{className:"space-y-3",children:m.map(u=>{const b=("questionText"in u?u.questionText:u.front).replace(/<[^>]+>/g,"").trim();return e.jsxs("li",{className:"p-3 bg-background rounded-md border border-border",children:[e.jsx("p",{className:"font-semibold text-sm text-text break-words truncate",title:b,children:b}),e.jsxs("p",{className:"text-xs text-red-500 font-medium",children:['Marked "Again" ',u.failureCount," time",u.failureCount>1?"s":""]})]},u.id)})}):e.jsx("p",{className:"text-sm text-text-muted",children:"No items have been repeatedly marked as difficult. Great job!"})]})]})})},Je=({icon:t,label:o,value:g,subtext:w,color:r="primary"})=>e.jsxs("div",{className:"bg-surface p-4 rounded-lg shadow-sm border border-border flex items-center gap-4",children:[e.jsx("div",{className:`p-3 rounded-full bg-${r}/10 text-${r}`,children:e.jsx(s,{name:t,className:"w-6 h-6"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-text-muted",children:o}),e.jsx("p",{className:"text-2xl font-bold text-text",children:g}),w&&e.jsx("p",{className:"text-xs text-text-muted mt-0.5",children:w})]})]}),Gt=({deck:t,sessionsToResume:o,onUpdateDeck:g,onDeleteDeck:w,onUpdateLastOpened:r,openConfirmModal:c,handleGenerateQuestionsForDeck:m,handleGenerateContentForLearningDeck:u,onCancelAIGeneration:j,onSaveLearningBlock:b,onDeleteLearningBlock:S,onExportDeck:D,onRegenerateQuestion:N,onExpandText:E,onGenerateAI:z})=>{var Be,Ge,Pe;const[k,I]=a.useState(!1),[l,C]=a.useState(t.name),[d,p]=a.useState(t.description||""),[R,T]=a.useState(t.folderId||""),[P,U]=a.useState(t.icon),[K,ae]=a.useState(!1),[ee,W]=a.useState(!1),[J,oe]=a.useState(!1),[ie,le]=a.useState(!1),[te,y]=a.useState("overview"),[$,B]=a.useState(!1),[v,M]=a.useState(null),{navigate:O}=mt(),{addToast:Y}=Se(),{aiFeaturesEnabled:Z}=ye(),{folders:se,aiGenerationStatus:f,learningProgress:x}=be(),X=xt(),n=ve(),A=a.useRef(null),L=(t.type===F.Flashcard?t.cards:(t.type===F.Learning,t.questions))||[],H=a.useMemo(()=>{const{currentTask:i,queue:Q}=f;return(i==null?void 0:i.deckId)===t.id?i:(Array.isArray(Q)?Q:[]).find(q=>q.deckId===t.id)},[f,t.id]),V=!!H,ne=t.type===F.Learning&&!!t.curriculum,G=a.useMemo(()=>ne&&(t.generationStatus==="generating"||t.generationStatus==="error")&&!V,[ne,t.generationStatus,V]),we=a.useMemo(()=>X.find(i=>!i.deletedAt&&(i.levels||[]).some(Q=>{var _;return(_=Q.deckIds)==null?void 0:_.includes(t.id)})),[X,t.id]);a.useEffect(()=>{r(t.id)},[t.id,r]),a.useEffect(()=>{(t.archived||t.deletedAt)&&O("/")},[t.archived,t.deletedAt,O]),a.useEffect(()=>{k||(C(t.name),p(t.description||""),T(t.folderId||""),U(t.icon))},[t,k]),a.useEffect(()=>{const i=Q=>{A.current&&!A.current.contains(Q.target)&&W(!1)};return ee&&document.addEventListener("mousedown",i),()=>document.removeEventListener("mousedown",i)},[ee]);const _e=()=>{g({...t,name:l,description:d,folderId:R||null,icon:P}),I(!1)},We=()=>{I(!1)},Ye=async()=>{if(L.length===0){Y("Add some cards or questions first so the AI has context.","info");return}ae(!0);try{const i=L.slice(0,20).map(q=>"front"in q?q.front:q.questionText).join(`
`),{name:Q,description:_}=await pt(i,"deck");C(Q),p(_),Y("Details generated!","success")}catch{Y("Failed to generate details.","error")}finally{ae(!1)}},qe=()=>{var q;if(!ne)return;const i=t,Q=i.curriculum,_={generationType:"deep-course",topic:i.name,persona:"default",understanding:"Intermediate",comprehensiveness:"Standard",chapterCount:((q=Q.chapters)==null?void 0:q.length)||12,deckId:t.id,partialProgress:{curriculum:Q,deckId:t.id,completedChapterIds:i.infoCards.map(ce=>ce.id),previousSummariesMap:{}}};n==null||n.handleImmediateAIGeneration(_)},Xe=i=>{if(t.type===F.Flashcard&&i.every(Q=>"front"in Q)){const Q=gt(i),_=[...t.cards||[],...Q];g({...t,cards:_})}else if((t.type===F.Quiz||t.type===F.Learning)&&i.every(Q=>"questionText"in Q)){const Q=bt(i),q=[...t.questions||[],...Q];g({...t,questions:q})}},Ze=()=>{c({title:"Move Deck to Trash",message:`Are you sure you want to move the deck "${t.name}" to the trash? It will be permanently deleted after 10 days. This will also remove it from any series it belongs to.`,onConfirm:()=>w(t.id)})},He=()=>{t.type!==F.Learning&&c({title:"Upgrade to Learning Deck?",message:`This will use AI to analyze your existing ${L.length} items and generate a structured curriculum (InfoCards) for them. You'll be able to read instructional chapters before taking the quiz.`,confirmText:"Upgrade with AI âœ¨",onConfirm:()=>n==null?void 0:n.handleUpgradeDeckToLearning(t)})},et=i=>{M(i),B(!0)},tt=i=>{const Q={...t,infoCards:i};g(Q,{silent:!0})},st=i=>{r(t.id),O(`/decks/${t.id}/cram?sort=${i.sort}&limit=${i.limit}`)},de=L.filter(i=>!i.suspended),Re=L.length-de.length,xe=Rt(de),fe=x[t.id],ke=new Set((fe==null?void 0:fe.unlockedQuestionIds)||[]),ge=t.type===F.Learning?t.questions.filter(i=>ke.has(i.id)&&!i.suspended&&new Date(i.dueDate)<=new Date).length:ut(t),De=o.has(t.id),Le=((Be=fe==null?void 0:fe.readInfoCardIds)==null?void 0:Be.length)||0,Qe=((Ge=t.infoCards)==null?void 0:Ge.length)||0,Fe=t.type===F.Learning&&Le<Qe;t.type===F.Learning&&t.questions.filter(i=>ke.has(i.id)).length,t.type===F.Learning&&t.questions.length;const nt=a.useMemo(()=>de.length===0?0:de.reduce((Q,_)=>Q+Me(_),0)/de.length,[de]),at=a.useMemo(()=>{const i=new Date;i.setHours(0,0,0,0);const Q=Array(7).fill(0),_=[],q=[];for(let ce=0;ce<7;ce++){const ue=new Date(i);ue.setDate(i.getDate()+ce),ce===0?_.push("Today"):ce===1?_.push("Tom"):_.push(ue.toLocaleDateString("en-US",{weekday:"short"})),q.push(ue.toLocaleDateString("en-US",{month:"short",day:"numeric"}));const dt=ue.getTime();L.forEach(Ee=>{if(Ee.suspended||t.type===F.Learning&&!ke.has(Ee.id))return;const Ue=new Date(Ee.dueDate);Ue.setHours(0,0,0,0),Ue.getTime()===dt&&Q[ce]++})}return _.map((ce,ue)=>({dayLabel:ce,count:Q[ue],date:q[ue]}))},[L,t.type,ke]),rt=a.useMemo(()=>L.length===0&&!V?"No Items to Study":t.locked?"Deck is Locked":t.type===F.Quiz?De?"Resume Quiz":"Start Quiz":t.type===F.Learning?t.learningMode==="mixed"?"Start Course":"Practice":De?"Resume Study":"Study Cards",[t.type,De,t.locked,L.length,t.learningMode,V]),it=[{value:xe.new,color:"bg-blue-500",label:"New"},{value:xe.learning,color:"bg-orange-500",label:"Learning"},{value:xe.young,color:"bg-teal-500",label:"Young"},{value:xe.mature,color:"bg-green-500",label:"Mature"}],Ie=i=>`px-4 py-2 text-sm font-medium transition-colors border-b-2 ${te===i?"border-primary text-primary":"border-transparent text-text-muted hover:text-text"}`,Ae=L.length===0&&(t.type!==F.Learning||t.infoCards.length===0),lt=t.type===F.Learning&&t.learningMode!=="mixed",ot=a.useMemo(()=>{var _;if(!ne)return[];const i=t,Q=new Set(i.infoCards.map(q=>q.id));return(((_=i.curriculum)==null?void 0:_.chapters)||[]).map(q=>({...q,status:Q.has(q.id)?"complete":"pending"}))},[t,ne]);return e.jsxs("div",{className:"max-w-5xl mx-auto animate-fade-in space-y-6 pb-20",children:[G&&e.jsxs("div",{className:"bg-indigo-600 text-white rounded-xl shadow-lg p-6 flex flex-col md:flex-row items-center justify-between gap-4 animate-fade-in border-b-4 border-indigo-800",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"bg-white/20 p-3 rounded-full animate-pulse",children:e.jsx(s,{name:"zap",className:"w-8 h-8"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-xl font-bold",children:"Synthesis Interrupted"}),e.jsx("p",{className:"text-indigo-100 text-sm",children:"This master course is incomplete. Resume now to finish generating chapters and assessments."})]})]}),e.jsx(h,{onClick:qe,className:"bg-white text-indigo-600 hover:bg-indigo-50 border-none font-bold py-3 px-8 shadow-md transition-all active:scale-95",children:"Resume Synthesis"})]}),e.jsx("div",{className:`bg-surface rounded-xl shadow-sm border border-border ${k?"overflow-hidden":""} ${ne?"border-indigo-500/30":""}`,children:k?e.jsxs("div",{className:"p-6 space-y-4 animate-fade-in bg-background/50",children:[e.jsxs("div",{className:"flex justify-between items-center mb-4",children:[e.jsx("h2",{className:"text-xl font-bold text-text",children:"Edit Deck Details"}),Z&&e.jsxs(h,{variant:"ghost",size:"sm",onClick:Ye,disabled:K,className:"text-primary hover:text-primary-hover",children:[K?e.jsx(me,{size:"sm"}):e.jsx(s,{name:"bot",className:"w-4 h-4 mr-2"}),"Auto-generate with AI"]})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"deck-name-edit",className:"block text-sm font-medium text-text-muted mb-1",children:"Deck Name"}),e.jsx("input",{id:"deck-name-edit",type:"text",value:l,onChange:i=>C(i.target.value),className:"w-full p-2 bg-background border border-border rounded-md focus:ring-2 focus:ring-primary focus:outline-none text-xl font-bold",autoFocus:!0})]}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-text-muted mb-1",children:"Deck Icon"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs("select",{value:P||"",onChange:i=>U(i.target.value),className:"w-full p-2 bg-background border border-border rounded-md focus:ring-2 focus:ring-primary focus:outline-none",children:[e.jsx("option",{value:"",children:"Default"}),ht.map(i=>e.jsx("option",{value:i,children:i},i))]}),Z&&e.jsxs(h,{variant:"secondary",onClick:()=>n==null?void 0:n.handleSuggestDeckIcon(t),title:"Suggest Icon with AI",children:[e.jsx(s,{name:"zap",className:"w-4 h-4 mr-1"})," Auto"]})]})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"deck-folder",className:"block text-sm font-medium text-text-muted mb-1",children:"Folder"}),e.jsxs("select",{id:"deck-folder",value:R,onChange:i=>T(i.target.value),className:"w-full p-2 bg-background border border-border rounded-md focus:ring-2 focus:ring-primary focus:outline-none",children:[e.jsx("option",{value:"",children:"No folder"}),Object.values(se).map(i=>e.jsx("option",{value:i.id,children:i.name},i.id))]})]})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"deck-desc",className:"block text-sm font-medium text-text-muted mb-1",children:"Description"}),e.jsx("textarea",{id:"deck-desc",value:d,onChange:i=>p(i.target.value),rows:4,className:"w-full p-2 bg-background border border-border rounded-md focus:ring-2 focus:ring-primary focus:outline-none"})]}),e.jsxs("div",{className:"flex justify-end gap-2 pt-2 border-t border-border mt-4",children:[e.jsx(h,{variant:"secondary",onClick:We,children:"Cancel"}),e.jsxs(h,{onClick:_e,children:[e.jsx(s,{name:"save",className:"mr-2"})," Save Changes"]})]})]}):e.jsxs("div",{className:"p-6 md:p-8 flex items-start justify-between gap-4 relative",children:[e.jsx("div",{className:"flex-1 min-w-0 pr-10 sm:pr-0",children:e.jsxs("div",{className:"flex items-start gap-4",children:[e.jsx("div",{className:`p-3 rounded-xl flex-shrink-0 hidden sm:block ${ne?"bg-indigo-100 dark:bg-indigo-900/30":"bg-primary/10"}`,children:e.jsx(s,{name:t.icon||(t.type==="flashcard"?"laptop":t.type==="learning"?"book-open":"help-circle"),className:`w-8 h-8 ${ne?"text-indigo-600 dark:text-indigo-400":"text-primary"}`})}),e.jsxs("div",{className:"min-w-0 flex-1",children:[e.jsxs("div",{className:"flex flex-wrap items-center gap-x-2 gap-y-1 mb-2",children:[ne&&e.jsxs("span",{className:"flex items-center gap-1 bg-indigo-600 text-white text-[10px] font-black uppercase px-2 py-0.5 rounded tracking-tighter shadow-sm",children:[e.jsx(s,{name:"bot",className:"w-3 h-3"}),"Hyper-Course"]}),we?e.jsxs(he,{href:`/series/${we.id}`,className:"flex items-center text-xs font-bold text-primary uppercase tracking-wider hover:underline whitespace-nowrap",children:[e.jsx(s,{name:"layers",className:"w-3 h-3 mr-1"}),e.jsx("span",{children:we.name})]}):t.folderId&&e.jsxs("div",{className:"flex items-center text-xs font-semibold text-text-muted uppercase tracking-wider",children:[e.jsx(s,{name:"folder",className:"w-3 h-3 mr-1"}),e.jsx("span",{children:((Pe=se[t.folderId])==null?void 0:Pe.name)||"Uncategorized"})]})]}),e.jsx("h1",{className:"text-2xl sm:text-3xl font-extrabold text-text break-words leading-tight",children:t.name}),t.description&&e.jsx("div",{className:"mt-2 text-text-muted",children:e.jsx(vt,{html:t.description,className:"prose prose-sm dark:prose-invert max-w-none text-text-muted leading-relaxed"})})]})]})}),e.jsxs("div",{className:"absolute top-6 right-6 md:static md:flex-shrink-0 md:self-start",ref:A,children:[e.jsx(h,{variant:"ghost",onClick:()=>W(!ee),className:"p-2 rounded-full hover:bg-border/50",children:e.jsx(s,{name:"more-vertical",className:"w-6 h-6 text-text-muted"})}),ee&&e.jsxs("div",{className:"absolute right-0 mt-2 w-56 bg-surface rounded-lg shadow-xl border border-border z-30 py-1 animate-fade-in origin-top-right",children:[e.jsxs("button",{onClick:()=>{I(!0),W(!1)},className:"flex items-center w-full px-4 py-2.5 text-sm text-left text-text hover:bg-primary/5 hover:text-primary transition-colors",children:[e.jsx(s,{name:"edit",className:"w-4 h-4 mr-3"})," Edit Details"]}),Z&&!Ae&&e.jsxs(e.Fragment,{children:[e.jsxs("button",{onClick:()=>{n==null||n.handleOpenDeckAnalysis(t),W(!1)},className:"flex items-center w-full px-4 py-2.5 text-sm text-left text-text hover:bg-primary/5 hover:text-primary transition-colors",children:[e.jsx(s,{name:"zap",className:"w-4 h-4 mr-3"})," Analyze & Improve"]}),t.type!==F.Learning&&e.jsxs("button",{onClick:()=>{He(),W(!1)},className:"flex items-center w-full px-4 py-2.5 text-sm text-left text-text hover:bg-primary/5 hover:text-primary transition-colors",children:[e.jsx(s,{name:"layers",className:"w-4 h-4 mr-3 text-purple-500"})," Upgrade to Course âœ¨"]})]}),e.jsxs(he,{href:`/decks/${t.id}/print`,className:"flex items-center w-full px-4 py-2.5 text-sm text-left text-text hover:bg-primary/5 hover:text-primary transition-colors",children:[e.jsx(s,{name:"printer",className:"w-4 h-4 mr-3"})," Print / PDF"]}),e.jsxs("button",{onClick:()=>{n.handleViewDeckJson(t),W(!1)},className:"flex items-center w-full px-4 py-2.5 text-sm text-left text-text hover:bg-primary/5 hover:text-primary transition-colors",children:[e.jsx(s,{name:"code",className:"w-4 h-4 mr-3"})," View JSON"]}),e.jsxs("button",{onClick:()=>{D(t),W(!1)},className:"flex items-center w-full px-4 py-2.5 text-sm text-left text-text hover:bg-primary/5 hover:text-primary transition-colors",children:[e.jsx(s,{name:"download",className:"w-4 h-4 mr-3"})," Export JSON"]}),t.type==="flashcard"&&e.jsxs("button",{onClick:()=>{n==null||n.handleExportDeckCSV(t),W(!1)},className:"flex items-center w-full px-4 py-2.5 text-sm text-left text-text hover:bg-primary/5 hover:text-primary transition-colors",children:[e.jsx(s,{name:"file-text",className:"w-4 h-4 mr-3"})," Export CSV"]}),e.jsx("div",{className:"my-1 border-t border-border"}),e.jsxs("button",{onClick:()=>{g({...t,archived:!0},{toastMessage:"Deck archived."}),W(!1)},className:"flex items-center w-full px-4 py-2.5 text-sm text-left text-text hover:bg-primary/5 hover:text-primary transition-colors",children:[e.jsx(s,{name:"archive",className:"w-4 h-4 mr-3"})," Archive"]}),e.jsxs("button",{onClick:()=>{Ze(),W(!1)},className:"flex items-center w-full px-4 py-2.5 text-sm text-left text-red-600 dark:text-red-400 hover:bg-red-50 dark:hover:bg-red-900/20 transition-colors",children:[e.jsx(s,{name:"trash-2",className:"w-4 h-4 mr-3"})," Move to Trash"]})]})]})]})}),e.jsxs("div",{className:"flex space-x-1 border-b border-border overflow-x-auto no-scrollbar",children:[e.jsx("button",{className:Ie("overview"),onClick:()=>y("overview"),children:"Overview"}),e.jsxs("button",{className:Ie("items"),onClick:()=>y("items"),children:["Items (",L.length,")"]}),e.jsx("button",{className:Ie("stats"),onClick:()=>y("stats"),children:"Statistics"})]}),e.jsxs("div",{className:"min-h-[300px]",children:[te==="overview"&&e.jsxs("div",{className:"space-y-6 sm:space-y-8 animate-fade-in",children:[ne&&e.jsxs("div",{className:"bg-surface rounded-xl p-6 border border-indigo-500/20 shadow-sm",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsxs("h3",{className:"text-sm font-bold text-text-muted uppercase tracking-widest flex items-center gap-2",children:[e.jsx(s,{name:"layers",className:"w-4 h-4 text-indigo-500"}),"Project Blueprint"]}),e.jsxs("div",{className:"flex gap-4 text-[10px] font-bold text-text-muted uppercase",children:[e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("span",{className:"w-2 h-2 rounded-full bg-green-500"})," Synthesized"]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("span",{className:"w-2 h-2 rounded-full bg-border"})," Pending"]})]})]}),e.jsx("div",{className:"grid grid-cols-4 sm:grid-cols-6 md:grid-cols-8 lg:grid-cols-10 gap-3",children:ot.map((i,Q)=>e.jsx("div",{title:`${Q+1}. ${i.title} (${i.status})`,className:`aspect-square rounded-lg flex items-center justify-center text-xs font-black transition-all ${i.status==="complete"?"bg-green-500 text-white shadow-[0_0_10px_rgba(34,197,94,0.3)]":"bg-background text-text-muted border border-border border-dashed"}`,children:Q+1},i.id))}),G&&e.jsxs("p",{className:"mt-4 text-xs text-indigo-600 dark:text-indigo-400 font-medium italic",children:["* Project paused at chapter ",Qe+1,". Resume synthesis to complete the blueprint."]})]}),e.jsxs("div",{className:"flex flex-col md:flex-row gap-4 items-center justify-between p-6 bg-primary/5 rounded-xl border border-primary/10",children:[e.jsxs("div",{className:"flex-1 text-center md:text-left",children:[e.jsx("h3",{className:"text-lg font-bold text-text mb-1",children:ge>0?`You have ${ge} item${ge!==1?"s":""} due today.`:"All caught up for now!"}),e.jsx("p",{className:"text-sm text-text-muted",children:ge>0?"Keep up your streak and review now.":"Review ahead or add new cards."})]}),e.jsxs("div",{className:"flex flex-wrap gap-3 justify-center md:justify-end w-full md:w-auto",children:[Ae&&Z?V?e.jsxs("div",{className:"flex items-center justify-center py-3 px-6 bg-surface rounded-md border border-border w-full md:w-auto shadow-sm",children:[e.jsx(me,{size:"sm"}),e.jsx("span",{className:"ml-3 text-text-muted text-sm font-semibold",children:H.statusText||"Architecting..."}),e.jsx(h,{variant:"ghost",size:"sm",onClick:j,className:"ml-2 text-red-500 p-1 h-auto",children:e.jsx(s,{name:"x-circle",className:"w-5 h-5"})})]}):e.jsxs(h,{variant:"primary",size:"lg",onClick:()=>{t.type===F.Quiz?m(t):t.type===F.Learning?u(t):z(t)},className:"w-full md:w-auto",children:[e.jsx(s,{name:"zap",className:"w-5 h-5 mr-2"}),"Generate Content"]}):Ae&&!Z?e.jsxs(h,{variant:"primary",size:"lg",onClick:()=>y("items"),className:"w-full md:w-auto",children:[e.jsx(s,{name:"plus",className:"w-5 h-5 mr-2"}),"Create First Item"]}):e.jsxs(e.Fragment,{children:[lt&&e.jsxs(he,{href:`/decks/${t.id}/read`,passAs:h,variant:"secondary",size:"lg",className:"font-semibold flex-1 md:flex-none",children:[e.jsx(s,{name:"book-open",className:"w-5 h-5 mr-2"}),Le===0?"Read":Fe?"Continue Reading":"Review"]}),e.jsxs(he,{href:`/decks/${t.id}/study`,passAs:h,variant:t.type!==F.Learning||!Fe||t.learningMode==="mixed"?"primary":"secondary",size:"lg",onClick:()=>r(t.id),disabled:ge===0&&!De||!!t.locked||L.length===0&&!V,className:"font-bold px-8 shadow-md flex-1 md:flex-none",children:[e.jsx(s,{name:"refresh-ccw",className:"w-5 h-5 mr-2"})," ",rt]}),e.jsx(h,{variant:"secondary",size:"lg",onClick:()=>le(!0),disabled:L.length===0,title:"Review without affecting stats",className:"w-full md:w-auto",children:"Cram"})]}),e.jsxs("div",{className:"flex gap-2 w-full sm:w-auto justify-center",children:[t.type===F.Flashcard&&de.length>0&&e.jsx(he,{href:`/decks/${t.id}/study-reversed`,passAs:h,variant:"ghost",size:"lg",onClick:()=>r(t.id),title:"Study Back-to-Front",className:"flex-1 sm:flex-none",children:e.jsx(s,{name:"repeat",className:"w-5 h-5"})}),t.type===F.Quiz&&de.length>0&&e.jsx(he,{href:`/decks/${t.id}/study-flip`,passAs:h,variant:"ghost",size:"lg",onClick:()=>r(t.id),title:"Review as Flashcards",className:"flex-1 sm:flex-none",children:e.jsx(s,{name:"columns",className:"w-5 h-5"})})]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-4",children:[e.jsx(Je,{icon:"layers",label:"Total Items",value:de.length,color:"blue"}),e.jsx(Je,{icon:"zap",label:"Due Today",value:ge,subtext:Re>0?`${Re} suspended`:void 0,color:"orange"}),e.jsx("div",{className:"sm:col-span-2 bg-surface p-4 rounded-lg shadow-sm border border-border flex flex-col justify-center",children:e.jsx($e,{level:nt})})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6 sm:gap-8",children:[e.jsxs("div",{className:"bg-surface p-6 rounded-lg shadow-md border border-border flex flex-col justify-center",children:[e.jsxs("h4",{className:"text-sm font-semibold text-text mb-4 flex items-center gap-2",children:[e.jsx(s,{name:"trending-up",className:"w-4 h-4"})," Retention Breakdown"]}),e.jsx(It,{data:it,total:de.length}),e.jsxs("div",{className:"grid grid-cols-2 gap-4 mt-6",children:[e.jsxs("div",{className:"flex items-center gap-2 text-sm text-text-muted",children:[e.jsx("div",{className:"w-3 h-3 rounded-full bg-blue-500"}),e.jsxs("span",{children:["New: ",e.jsx("strong",{children:xe.new})]})]}),e.jsxs("div",{className:"flex items-center gap-2 text-sm text-text-muted",children:[e.jsx("div",{className:"w-3 h-3 rounded-full bg-orange-500"}),e.jsxs("span",{children:["Learning: ",e.jsx("strong",{children:xe.learning})]})]}),e.jsxs("div",{className:"flex items-center gap-2 text-sm text-text-muted",children:[e.jsx("div",{className:"w-3 h-3 rounded-full bg-teal-500"}),e.jsxs("span",{children:["Young: ",e.jsx("strong",{children:xe.young})]})]}),e.jsxs("div",{className:"flex items-center gap-2 text-sm text-text-muted",children:[e.jsx("div",{className:"w-3 h-3 rounded-full bg-green-500"}),e.jsxs("span",{children:["Mature: ",e.jsx("strong",{children:xe.mature})]})]})]})]}),e.jsx("div",{className:"bg-surface p-6 rounded-lg shadow-md border border-border",children:e.jsx(At,{data:at})})]})]}),te==="items"&&e.jsx("div",{className:"bg-surface rounded-lg shadow-md border border-border animate-fade-in",children:t.type===F.Flashcard?e.jsx(Nt,{cards:t.cards||[],onCardsChange:i=>g({...t,cards:i},{silent:!0}),onAddCard:i=>g({...t,cards:[...t.cards||[],{...i,id:crypto.randomUUID(),dueDate:new Date().toISOString(),interval:0,easeFactor:Te,lapses:0}]},{silent:!0}),onBulkAdd:()=>oe(!0),deckName:t.name,deck:t}):t.type===F.Quiz?e.jsx(kt,{deck:t,questions:t.questions||[],onQuestionsChange:i=>g({...t,questions:i},{silent:!0}),onAddQuestion:i=>{const Q={questionType:i.questionType,questionText:i.questionText,options:i.options,correctAnswerId:i.correctAnswerId,detailedExplanation:i.detailedExplanation,tags:i.tags,infoCardIds:i.infoCardIds,suspended:i.suspended,id:crypto.randomUUID(),dueDate:new Date().toISOString(),interval:0,easeFactor:Te,lapses:0,masteryLevel:0};g({...t,questions:[...t.questions||[],Q]},{silent:!0})},onBulkAdd:()=>oe(!0),onGenerateAI:()=>m(t),isGeneratingAI:V,onRegenerateQuestion:N,onAutoTag:()=>n==null?void 0:n.handleAutoTagQuestions(t),deckName:t.name}):t.type===F.Learning?e.jsx(zt,{deck:t,onSaveBlock:i=>b(t.id,i),onDeleteBlock:i=>S(t.id,i),onBlockClick:et,onReorderBlocks:tt}):e.jsx("div",{className:"p-6 text-center text-text-muted",children:e.jsx("p",{children:"Unsupported deck type."})})}),te==="stats"&&e.jsx("div",{className:"animate-fade-in",children:e.jsx(Lt,{deck:t})})]}),J&&e.jsx(Dt,{isOpen:J,onClose:()=>oe(!1),onAddItems:Xe,deckType:t.type}),$&&e.jsx(Mt,{isOpen:$,onClose:()=>B(!1),block:v,deckName:t.name,onExpandText:E}),ie&&e.jsx(Ot,{isOpen:ie,onClose:()=>le(!1),onStart:st,totalItems:L.length})]})};export{Gt as default};
