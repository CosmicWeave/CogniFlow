import{F as T,O as F,d as G,u as R,r as f,G as q,e as Q,g as U,j as s,B as w,I as g}from"./index-D_FLfjBw.js";import{S as Y}from"./SeriesListItem-DN-q-9J5.js";import{D as v}from"./DeckSortControl-CuzjDKvZ.js";import"./MasteryBar-OxNLaxF2.js";import"./ProgressBar-uuvsF9ns.js";const X=({onStartSeriesStudy:I,onCreateNewSeries:b,onCreateSampleSeries:D,onGenerateAI:A,handleGenerateQuestionsForEmptyDecksInSeries:M})=>{const S=T(),C=F(),p=G(e=>e.seriesProgress),{aiFeaturesEnabled:B}=R(),[x,L]=f.useState(""),[j,z]=f.useState("recent"),[h,P]=f.useState("all"),y=f.useMemo(()=>S.filter(e=>!e.archived&&!e.deletedAt),[S]),k=f.useMemo(()=>{const e=new Map;return y.forEach(t=>{var m;const a=(t.levels||[]).flatMap(r=>(r==null?void 0:r.deckIds)||[]).map(r=>C.find(u=>u.id===r)).filter(Boolean),i=((m=p.get(t.id))==null?void 0:m.size)||0,l=new Set;(t.levels||[]).flatMap(r=>(r==null?void 0:r.deckIds)||[]).forEach((r,u)=>{u<=i&&l.add(r)});const d=a.reduce((r,u)=>l.has(u.id)?r+q(u):r,0),c=a.flatMap(r=>r.type===Q.Flashcard?r.cards||[]:r.questions||[]).filter(r=>!r.suspended),o=c.length>0?c.reduce((r,u)=>r+U(u),0)/c.length:0;e.set(t.id,{dueCount:d,mastery:o})}),e},[y,C,p]),N=f.useMemo(()=>{let e=y.filter(t=>(t.name||"").toLowerCase().includes(x.toLowerCase())||(t.description||"").toLowerCase().includes(x.toLowerCase()));switch(h!=="all"&&(e=e.filter(t=>{var n;const a=(t.levels||[]).reduce((d,c)=>{var o;return d+(((o=c==null?void 0:c.deckIds)==null?void 0:o.length)||0)},0);if(a===0)return h==="inProgress";const l=(((n=p.get(t.id))==null?void 0:n.size)||0)>=a;return h==="completed"?l:!l})),j){case"recent":return e.sort((t,a)=>{const i=new Date(t.lastOpened||t.createdAt||0).getTime();return new Date(a.lastOpened||a.createdAt||0).getTime()-i});case"progress":return e.sort((t,a)=>{var n,d;const i=(((n=p.get(t.id))==null?void 0:n.size)||0)/((t.levels||[]).reduce((c,o)=>{var m;return c+(((m=o==null?void 0:o.deckIds)==null?void 0:m.length)||0)},0)||1);return(((d=p.get(a.id))==null?void 0:d.size)||0)/((a.levels||[]).reduce((c,o)=>{var m;return c+(((m=o==null?void 0:o.deckIds)==null?void 0:m.length)||0)},0)||1)-i});case"mastery":return e.sort((t,a)=>{var n,d;const i=((n=k.get(t.id))==null?void 0:n.mastery)||0;return(((d=k.get(a.id))==null?void 0:d.mastery)||0)-i});case"name":default:return e.sort((t,a)=>(t.name||"").localeCompare(a.name||""))}},[y,x,j,h,p,k]),E=[{key:"recent",label:"Recent"},{key:"name",label:"Name"},{key:"progress",label:"Progress"},{key:"mastery",label:"Mastery"}],O=[{key:"all",label:"All"},{key:"inProgress",label:"In Progress"},{key:"completed",label:"Completed"}];return s.jsxs("div",{className:"space-y-6",children:[s.jsxs("div",{className:"flex flex-col sm:flex-row justify-between items-center gap-4",children:[s.jsx("h1",{className:"text-3xl font-bold text-text",children:"All Series"}),s.jsxs("div",{className:"flex gap-2",children:[B&&s.jsxs(w,{variant:"primary",onClick:A,children:[s.jsx(g,{name:"zap",className:"w-5 h-5 mr-2"}),"Generate with AI"]}),s.jsxs(w,{variant:"secondary",onClick:b,children:[s.jsx(g,{name:"layers",className:"w-5 h-5 mr-2"}),"Create New Series"]})]})]}),s.jsxs("div",{className:"flex flex-col md:flex-row justify-between items-center gap-4 p-4 bg-surface rounded-lg border border-border",children:[s.jsxs("div",{className:"relative w-full md:max-w-xs",children:[s.jsx(g,{name:"search",className:"absolute left-3 top-1/2 -translate-y-1/2 w-5 h-5 text-text-muted"}),s.jsx("input",{type:"text",placeholder:"Search series...",value:x,onChange:e=>L(e.target.value),className:"w-full pl-10 pr-4 py-2 bg-background border border-border rounded-md focus:ring-2 focus:ring-primary focus:outline-none"})]}),s.jsxs("div",{className:"flex flex-wrap items-center justify-center gap-4",children:[s.jsxs("div",{className:"flex items-center gap-2",children:[s.jsx(g,{name:"filter",className:"w-5 h-5 text-text-muted"}),s.jsx(v,{currentSort:h,onSortChange:e=>P(e),sortOptions:O})]}),s.jsx(v,{currentSort:j,onSortChange:e=>z(e),sortOptions:E})]})]}),N.length>0?s.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:N.map(e=>{const t=k.get(e.id)||{dueCount:0,mastery:0},a=p.get(e.id)||new Set,l=(e.levels||[]).flatMap(n=>(n==null?void 0:n.deckIds)||[]).find(n=>!a.has(n))||null;return s.jsx(Y,{series:e,completedCount:a.size,dueCount:t.dueCount,masteryLevel:t.mastery,onStartSeriesStudy:I,nextUpDeckId:l,onGenerateAllQuestions:M},e.id)})}):s.jsxs("div",{className:"text-center py-10",children:[s.jsx(g,{name:"layers",className:"w-12 h-12 mx-auto text-gray-300 dark:text-gray-600"}),s.jsx("h3",{className:"mt-2 text-xl font-medium text-text",children:x?"No series found":"Your series collection is empty"}),s.jsx("p",{className:"mt-1 text-sm text-text-muted",children:x?"Try adjusting your search or filter.":"Create a new series or try a sample to get started."}),!x&&y.length===0&&s.jsx("div",{className:"mt-6",children:s.jsxs(w,{onClick:D,variant:"secondary",children:[s.jsx(g,{name:"zap",className:"w-4 h-4 mr-2"})," Create Sample Series"]})})]})]})};export{X as default};
