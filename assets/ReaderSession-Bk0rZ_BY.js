import{d as xe,i as pe,r as a,j as e,I as x,B as p,s as he,D as be}from"./index-Db7ZDnWd.js";import{u as ge}from"./useKeyboardShortcuts-BOc8y4wx.js";const we=({deck:l,onExit:O,onPractice:D})=>{var W,Z,_,ee,se,te,re;const{learningProgress:B,aiGenerationStatus:ne}=xe(),N=pe(),m=a.useMemo(()=>B[l.id]||{deckId:l.id,readInfoCardIds:[],unlockedQuestionIds:[],cardScrollIndices:{}},[B,l.id]),b=a.useMemo(()=>new Set(m.readInfoCardIds),[m]),L=(W=l.infoCards)==null?void 0:W.findIndex(s=>s.id===m.lastReadCardId),H=L!==-1?L:((Z=l.infoCards)==null?void 0:Z.findIndex(s=>!b.has(s.id)))??0,[f,I]=a.useState(H===-1?0:H),[le,M]=a.useState(!1),[ie,y]=a.useState(!1),[k,R]=a.useState(!1),[c,oe]=a.useState(m.readerTheme||"white"),[g,Q]=a.useState(m.readerFont||"serif"),[K,T]=a.useState(!0),[ce,V]=a.useState(0),G=a.useRef(0),E=a.useRef(null),j=a.useRef(null),C=a.useRef(0),q=a.useRef(null),r=(_=l.infoCards)==null?void 0:_[f],w=((ee=l.infoCards)==null?void 0:ee.length)||0,de=((se=ne.currentTask)==null?void 0:se.deckId)===l.id||l.generationStatus==="generating",h=r&&(!r.content||r.content.trim()===""),U=((re=(te=l.curriculum)==null?void 0:te.chapters)==null?void 0:re.length)||w,u=a.useMemo(()=>r?(r.prerequisiteIds||[]).some(t=>!b.has(t)):!1,[r,b]),me=a.useMemo(()=>!r||!u?[]:(r.prerequisiteIds||[]).filter(t=>!b.has(t)).map(t=>{var i;const o=l.infoCards.find(d=>d.id===t);if(o!=null&&o.content)return o.content.replace(/<[^>]+>/g,"").substring(0,50)+"...";const n=(i=l.curriculum)==null?void 0:i.chapters.find(d=>d.id===t);return(n==null?void 0:n.title)||"Foundational Topic"}),[r,u,b,l.infoCards,l.curriculum]),F=a.useCallback(async(s={})=>{const t={...m,lastReadCardId:r==null?void 0:r.id,readerTheme:c,readerFont:g,cardScrollIndices:{...m.cardScrollIndices||{},[(r==null?void 0:r.id)||""]:C.current},...s};await(N==null?void 0:N.handleUpdateLearningProgress(t))},[m,r,c,g,N]);a.useEffect(()=>{const s=()=>{const o=j.current;if(!o)return;const n=o.scrollTop,i=o.scrollHeight-o.clientHeight,d=i>0&&n>=i-20;n<50||d?T(!0):n>G.current?T(!1):T(!0),G.current=n,i>0?V(n/i*100):V(100)},t=j.current;return t&&(t.addEventListener("scroll",s,{passive:!0}),s()),()=>t==null?void 0:t.removeEventListener("scroll",s)},[f,h,u]),a.useEffect(()=>{const s=j.current;if(!s||!r||h||u)return;const t={root:s,rootMargin:"0px 0px -90% 0px",threshold:[0,1]},o=new IntersectionObserver(i=>{const d=s.querySelector(".prose");if(!d)return;const A=Array.from(d.children),ae=i.filter(v=>v.isIntersecting).sort((v,S)=>A.indexOf(v.target)-A.indexOf(S.target));if(ae.length>0){const v=ae[0].target,S=A.indexOf(v);S!==-1&&(C.current=S)}},t),n=window.setTimeout(()=>{const i=s.querySelector(".prose");i&&Array.from(i.children).forEach(d=>o.observe(d))},500);return()=>{window.clearTimeout(n),o.disconnect()}},[r,h,u]),a.useEffect(()=>{var o;q.current&&window.clearTimeout(q.current);const s=j.current;if(!s||!r)return;const t=(o=m.cardScrollIndices)==null?void 0:o[r.id];t!==void 0&&t>0?q.current=window.setTimeout(()=>{const n=s.querySelector(".prose");if(n){const i=n.children[t];i&&(i.scrollIntoView({block:"start",behavior:"instant"}),C.current=t)}},100):(s.scrollTo({top:0,behavior:"instant"}),C.current=0),F()},[f,l.id]),a.useEffect(()=>{const s=t=>{E.current&&!E.current.contains(t.target)&&R(!1)};return k&&document.addEventListener("mousedown",s),()=>document.removeEventListener("mousedown",s)},[k]);const X=a.useCallback(async()=>{if(!r||u||h)return;const s=Array.from(new Set([...m.readInfoCardIds,r.id])),t=Array.from(new Set([...m.unlockedQuestionIds,...r.unlocksQuestionIds]));await F({readInfoCardIds:s,unlockedQuestionIds:t})},[r,m,u,h,F]),$=a.useCallback(async()=>{!u&&!h&&await X(),f<w-1?I(s=>s+1):M(!0)},[f,w,X,u,h]),z=()=>{f>0&&(I(s=>s-1),M(!1))},fe=s=>{I(s),y(!1)};ge({ArrowRight:$,ArrowLeft:z,Space:$,KeyT:()=>y(s=>!s),KeyS:()=>R(s=>!s)});const P={white:"bg-[#FFFFFF] text-[#1A1A1A]",sepia:"bg-[#F4ECD8] text-[#5B4636]",charcoal:"bg-[#2C2C2C] text-[#D1D1D1]",black:"bg-[#000000] text-[#E0E0E0]"},ue=`
    flex-grow prose max-w-prose mx-auto ${g==="serif"?"font-serif":"font-sans"}
    ${c==="white"?"prose-slate":""}
    ${c==="sepia"?"prose-stone":""}
    ${c==="charcoal"||c==="black"?"prose-invert":""}
    leading-relaxed md:leading-loose text-lg md:text-xl
    prose-p:mb-8 prose-p:mt-2
    prose-headings:font-bold prose-headings:tracking-tight prose-headings:mt-12 prose-headings:mb-6
    prose-img:rounded-lg prose-img:shadow-xl prose-img:my-10
    prose-blockquote:border-l-4 prose-blockquote:border-primary prose-blockquote:bg-black/5 prose-blockquote:py-4 prose-blockquote:px-6 prose-blockquote:rounded-r prose-blockquote:italic
    prose-pre:bg-black/10 prose-pre:rounded-xl
    drop-cap-enabled
  `;if(le&&!de)return e.jsx("div",{className:`fixed inset-0 z-[100] flex items-center justify-center p-6 ${P[c]} animate-fade-in`,children:e.jsxs("div",{className:"max-w-md text-center",children:[e.jsx("div",{className:"mb-8 inline-flex p-6 bg-primary/10 rounded-full text-primary",children:e.jsx(x,{name:"check-circle",className:"w-20 h-20"})}),e.jsx("h2",{className:"text-4xl font-black mb-4",children:"Finis."}),e.jsx("p",{className:"opacity-70 mb-10 text-lg",children:"You have absorbed the knowledge of this section. The next stage of mastery awaits."}),e.jsxs("div",{className:"flex flex-col gap-4",children:[e.jsx(p,{variant:"primary",size:"lg",onClick:D,className:"py-4 font-bold text-xl rounded-full shadow-lg",children:"Begin Practice Session"}),e.jsx(p,{variant:"ghost",onClick:O,className:"rounded-full",children:"Return to Library"})]})]})});const Y=c==="black"?"rgba(0,0,0,0.8)":c==="charcoal"?"rgba(44,44,44,0.8)":c==="sepia"?"rgba(244,236,216,0.8)":"rgba(255,255,255,0.8)",J=c==="black"||c==="charcoal"?"rgba(255,255,255,0.1)":"rgba(0,0,0,0.05)";return e.jsxs("div",{className:`fixed inset-0 z-[100] flex flex-col overflow-y-auto no-scrollbar transition-colors duration-500 ${P[c]}`,ref:j,children:[ie&&e.jsxs("div",{className:"fixed inset-0 z-[120] flex animate-fade-in",children:[e.jsx("div",{className:"absolute inset-0 bg-black/40 backdrop-blur-sm",onClick:()=>y(!1)}),e.jsxs("div",{className:`relative w-80 h-full shadow-2xl flex flex-col transform transition-transform duration-300 translate-x-0 ${P[c]} border-r border-black/10`,children:[e.jsxs("header",{className:"p-6 border-b border-black/5 flex justify-between items-center",children:[e.jsx("h3",{className:"font-black uppercase tracking-widest text-sm opacity-50",children:"Contents"}),e.jsx(p,{variant:"ghost",size:"sm",onClick:()=>y(!1),className:"p-1 h-auto",children:e.jsx(x,{name:"x"})})]}),e.jsx("nav",{className:"flex-grow overflow-y-auto p-4 space-y-1",children:l.infoCards.map((s,t)=>{var d;const o=((d=s.content.match(/<h[123]>(.*?)<\/h/))==null?void 0:d[1])||he(s.content).substring(0,30)||`Chapter ${t+1}`,n=t===f,i=b.has(s.id);return e.jsxs("button",{onClick:()=>fe(t),className:`w-full text-left p-3 rounded-lg flex items-center gap-3 transition-all ${n?"bg-primary text-on-primary shadow-md scale-[1.02]":"hover:bg-black/5"}`,children:[e.jsx("span",{className:`text-xs font-bold w-6 h-6 flex items-center justify-center rounded-full border ${n?"border-white/40":"border-black/10 opacity-50"}`,children:t+1}),e.jsx("span",{className:`flex-grow truncate text-sm ${n?"font-bold":i?"opacity-100":"opacity-50"}`,children:o}),i&&!n&&e.jsx(x,{name:"check-circle",className:"w-4 h-4 text-green-500"})]},s.id)})}),e.jsx("footer",{className:"p-6 border-t border-black/5",children:e.jsx(p,{variant:"secondary",onClick:D,className:"w-full rounded-full",children:"Practice Deck"})})]})]}),e.jsxs("header",{className:`fixed top-0 left-0 right-0 z-[110] transition-all duration-500 h-16 flex flex-col justify-center backdrop-blur-md border-b ${K?"translate-y-0 opacity-100":"-translate-y-full opacity-0"}`,style:{backgroundColor:Y,borderColor:J},children:[e.jsxs("div",{className:"flex items-center justify-between px-6 w-full",children:[e.jsxs("div",{className:"flex items-center gap-4 flex-1 min-w-0 mr-4",children:[e.jsx(p,{variant:"ghost",size:"sm",onClick:()=>y(!0),className:"p-2 -ml-2 rounded-full hover:bg-black/5 flex-shrink-0",children:e.jsx(x,{name:"list",className:"w-6 h-6"})}),e.jsxs("div",{className:"flex flex-col min-w-0",children:[e.jsx("span",{className:"text-[10px] font-black uppercase tracking-tighter opacity-50 truncate",title:l.name,children:l.name}),e.jsxs("span",{className:"text-xs font-bold truncate",children:["Chapter ",f+1," of ",U]})]})]}),e.jsxs("div",{className:"flex items-center gap-2 flex-shrink-0",ref:E,children:[e.jsxs("div",{className:"relative",children:[e.jsx("button",{onClick:()=>R(!k),className:"w-10 h-10 flex items-center justify-center rounded-full hover:bg-black/5 transition-all",children:e.jsx("span",{className:`text-lg ${g==="serif"?"font-serif":"font-sans"}`,children:"Aa"})}),k&&e.jsx("div",{className:"absolute top-full right-0 mt-2 w-72 bg-surface shadow-2xl border border-border rounded-2xl p-5 animate-fade-in z-[120]",children:e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-[10px] font-black uppercase tracking-widest text-text-muted mb-3 block",children:"Typography"}),e.jsxs("div",{className:"flex bg-background rounded-xl p-1 border border-border",children:[e.jsx("button",{onClick:()=>Q("sans"),className:`flex-1 py-2 rounded-lg text-sm transition-all ${g==="sans"?"bg-primary text-white shadow-md font-bold":"text-text-muted hover:text-text"}`,children:"San Serif"}),e.jsx("button",{onClick:()=>Q("serif"),className:`flex-1 py-2 rounded-lg text-sm transition-all ${g==="serif"?"bg-primary text-white shadow-md font-serif font-bold":"text-text-muted hover:text-text font-serif"}`,children:"Serif"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-[10px] font-black uppercase tracking-widest text-text-muted mb-3 block",children:"Theme"}),e.jsx("div",{className:"grid grid-cols-4 gap-3",children:["white","sepia","charcoal","black"].map(s=>e.jsx("button",{onClick:()=>oe(s),className:`aspect-square rounded-full border-2 transition-all ${c===s?"border-primary scale-110":"border-transparent"}`,style:{backgroundColor:s==="white"?"#FFF":s==="sepia"?"#F4ECD8":s==="charcoal"?"#2C2C2C":"#000"},title:s},s))})]})]})})]}),e.jsx(p,{variant:"ghost",size:"sm",onClick:O,className:"p-2 rounded-full hover:bg-black/5",children:e.jsx(x,{name:"x",className:"w-6 h-6"})})]})]}),e.jsx("div",{className:"absolute bottom-0 left-0 w-full h-[2px] bg-text/5 z-[111]",children:e.jsx("div",{className:"h-full bg-text/20 transition-all duration-150 ease-out",style:{width:`${ce}%`}})})]}),e.jsx("main",{className:"flex-grow pt-24 px-6 md:px-12 pb-32",children:u?e.jsxs("div",{className:"max-w-prose mx-auto py-20 text-center animate-fade-in",children:[e.jsx("div",{className:"mb-8 inline-flex p-8 bg-red-500/10 rounded-full text-red-500",children:e.jsx(x,{name:"lock",className:"w-16 h-16"})}),e.jsx("h3",{className:"text-3xl font-black mb-4",children:"Chapter Encrypted"}),e.jsx("p",{className:"opacity-70 mb-10 text-lg",children:"Knowledge architecture requires a sequential flow. Please complete the following foundational sections first:"}),e.jsx("div",{className:"space-y-3",children:me.map((s,t)=>e.jsxs("div",{className:"p-4 bg-black/5 rounded-xl text-left font-bold flex items-center gap-3",children:[e.jsx("span",{className:"w-2 h-2 rounded-full bg-primary"}),e.jsx("span",{className:"truncate",children:s})]},t))}),e.jsx(p,{variant:"secondary",onClick:z,className:"mt-10 rounded-full px-8",children:"Return to Prerequisites"})]}):h?e.jsxs("div",{className:"max-w-prose mx-auto py-24 text-center animate-fade-in",children:[e.jsxs("div",{className:"relative mb-10 inline-block",children:[e.jsx("div",{className:"absolute inset-0 bg-primary rounded-full blur-3xl opacity-20 animate-pulse"}),e.jsx(x,{name:"bot",className:"relative w-24 h-24 text-primary animate-bounce"})]}),e.jsx("h3",{className:"text-4xl font-black mb-6",children:"Synthesizing..."}),e.jsx("p",{className:"text-xl opacity-60 max-w-md mx-auto leading-relaxed",children:"The Hyper-Course engine is actively weaving this chapter from your source documents. Verifying claims and drafting diagrams."}),e.jsx("div",{className:"mt-12 h-1 rounded-full w-48 mx-auto bg-black/5 overflow-hidden",children:e.jsx("div",{className:"h-full bg-primary w-1/2 animate-infinite-load"})})]}):r&&e.jsx("div",{className:ue,children:e.jsx(be,{html:r.content})})}),e.jsxs("footer",{className:`fixed bottom-0 left-0 right-0 z-[110] transition-all duration-500 h-16 flex items-center justify-between px-6 backdrop-blur-md border-t ${K?"translate-y-0 opacity-100":"translate-y-full opacity-0"}`,style:{backgroundColor:Y,borderColor:J},children:[e.jsx("div",{className:"flex-1 flex justify-start",children:e.jsxs(p,{variant:"ghost",onClick:z,disabled:f===0,className:"rounded-xl px-2 sm:px-4 py-2 font-bold text-sm hover:bg-black/5 disabled:opacity-10 transition-all flex items-center gap-1.5",children:[e.jsx(x,{name:"chevron-left",className:"w-5 h-5"}),e.jsx("span",{className:"hidden sm:inline",children:"Previous"})]})}),e.jsx("div",{className:"flex flex-col items-center",children:e.jsxs("span",{className:"text-[10px] font-black uppercase tracking-widest opacity-25 select-none",children:[f+1," / ",U]})}),e.jsx("div",{className:"flex-1 flex justify-end",children:e.jsxs(p,{variant:"ghost",onClick:$,className:"rounded-xl px-2 sm:px-4 py-2 font-black text-sm text-primary hover:bg-primary/5 transition-all flex items-center gap-1.5",children:[e.jsx("span",{className:"hidden sm:inline",children:f===w-1?"Finish":"Next"}),f<w-1?e.jsx(x,{name:"chevron-left",className:"w-5 h-5 rotate-180"}):e.jsx(x,{name:"check-circle",className:"w-5 h-5"})]})})]}),e.jsx("style",{children:`
          .font-serif { font-family: ui-serif, Georgia, Cambria, "Times New Roman", Times, serif; }
          .font-sans { font-family: ui-sans-serif, system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif; }
          
          .drop-cap-enabled p:first-of-type::first-letter {
            float: left;
            font-size: 4.5rem;
            line-height: 4rem;
            padding-right: 0.5rem;
            font-weight: 900;
            color: var(--color-primary);
          }

          @keyframes infinite-load {
              0% { transform: translateX(-100%); }
              100% { transform: translateX(250%); }
          }
          .animate-infinite-load { animation: infinite-load 2s ease-in-out infinite; }
          
          .no-scrollbar::-webkit-scrollbar { display: none; }
          .no-scrollbar { -ms-overflow-style: none; scrollbar-width: none; }
      `})]})};export{we as default};
