import{j as e,I as b,r as j,R as h,N as M,Q as C,S as R,B as A,T as H}from"./index-aMUeowKE.js";const N=({icon:o,label:a,value:g})=>e.jsxs("div",{className:"bg-surface p-6 rounded-lg shadow-md border border-border flex items-center",children:[e.jsx("div",{className:"flex-shrink-0",children:o}),e.jsxs("div",{className:"ml-5 w-0 flex-1",children:[e.jsx("dt",{className:"text-sm font-medium text-text-muted truncate",children:a}),e.jsx("dd",{className:"text-2xl font-bold text-text",children:g})]})]}),k=({stats:o})=>e.jsxs("div",{className:"grid grid-cols-1 gap-5 sm:grid-cols-3",children:[e.jsx(N,{icon:e.jsx(b,{name:"zap",className:"h-8 w-8 text-orange-400"}),label:"Current Streak",value:`${o.streak} day${o.streak!==1?"s":""}`}),e.jsx(N,{icon:e.jsx(b,{name:"check-circle",className:"h-8 w-8 text-blue-400"}),label:"Total Reviews",value:o.totalReviews.toLocaleString()}),e.jsx(N,{icon:e.jsx(b,{name:"trending-up",className:"h-8 w-8 text-green-400"}),label:"Mature Items",value:o.matureCount.toLocaleString()})]}),E=({reviews:o})=>{const{grid:a,maxCount:g}=j.useMemo(()=>{const t=new Date;t.setHours(0,0,0,0);const s=new Date(t);s.setDate(s.getDate()+1);const d=new Date(s);d.setDate(d.getDate()-364-t.getDay());const r=new Map;o.forEach(l=>{const u=new Date(l.timestamp);u.setHours(0,0,0,0);const f=u.toISOString().split("T")[0];r.set(f,(r.get(f)||0)+1)});const i=Math.max(...Array.from(r.values()),1),n=[];let c=new Date(d);for(;n.length<371;){const l=c.toISOString().split("T")[0],u=r.get(l)||0;n.push({date:new Date(c),count:u}),c.setDate(c.getDate()+1)}return{grid:n,maxCount:i}},[o]),x=t=>{if(t===0)return"fill-gray-200 dark:fill-gray-700/50";const s=Math.min(t/(g*.75),1);return s>.8?"fill-green-600":s>.5?"fill-green-500":s>.2?"fill-green-400":"fill-green-300"},p=j.useMemo(()=>{var d;const t=[];let s=-1;for(let r=0;r<53;r++){const i=(d=a[r*7])==null?void 0:d.date;if(i){const n=i.getMonth();n!==s&&t.push({month:i.toLocaleString("default",{month:"short"}),col:r}),s=n}}return t},[a]);return e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("svg",{width:"100%",viewBox:"0 0 848 128",children:[p.map(({month:t,col:s})=>e.jsx("text",{x:16*s+24,y:"15",className:"text-xs fill-text-muted",children:t},s)),e.jsx("text",{x:"0",y:"37",className:"text-xs fill-text-muted",children:"Mon"}),e.jsx("text",{x:"0",y:"69",className:"text-xs fill-text-muted",children:"Wed"}),e.jsx("text",{x:"0",y:"101",className:"text-xs fill-text-muted",children:"Fri"}),a.map((t,s)=>{if(!t)return null;const d=Math.floor(s/7),r=s%7;return e.jsx("rect",{x:16*d+24,y:16*r+24,width:"12",height:"12",rx:"2",ry:"2",className:x(t.count),children:e.jsx("title",{children:`${t.date.toDateString()}: ${t.count} review${t.count!==1?"s":""}`})},s)})]})})},I=({items:o})=>{const a=j.useMemo(()=>{const i=new Date;i.setHours(0,0,0,0);const n=Array(30).fill(0);o.forEach(l=>{const u=new Date(l.dueDate);u.setHours(0,0,0,0);const f=u.getTime()-i.getTime();if(f>=0){const m=Math.floor(f/864e5);m<30&&n[m]++}});const c=Array.from({length:30},(l,u)=>{const f=new Date(i);return f.setDate(f.getDate()+u),u%7===0||u===0?f.toLocaleDateString("en-US",{month:"short",day:"numeric"}):""});return{counts:n,labels:c}},[o]),g=Math.max(...a.counts,1),x=350,p=180,t={top:25,right:10,bottom:25,left:10},s=x-t.left-t.right,d=p-t.top-t.bottom,r=s/a.counts.length-2;return e.jsx("div",{className:"w-full",children:e.jsxs("svg",{viewBox:`0 0 ${x} ${p}`,width:"100%",height:"auto","aria-labelledby":"forecast-graph-title",role:"img",className:"overflow-visible",children:[e.jsx("title",{id:"forecast-graph-title",children:"A bar chart showing the number of items due each day for the next 30 days."}),a.counts.map((i,n)=>{const c=i>0?i/g*d:0,l=t.left+n*(r+2),u=t.top+d-c;return e.jsxs("g",{className:"group cursor-pointer",children:[e.jsxs("title",{children:[a.labels[n]||new Date(new Date().setDate(new Date().getDate()+n)).toLocaleDateString(),": ",i," items"]}),e.jsx("rect",{x:l,y:u,width:r,height:c,rx:"2",className:"fill-primary/60 transition-colors group-hover:fill-primary"}),e.jsx("text",{x:l+r/2,y:u-6,textAnchor:"middle",className:"text-xs font-semibold fill-text-muted transition-opacity opacity-0 group-hover:opacity-100 pointer-events-none",children:i})]},n)}),a.labels.map((i,n)=>i?e.jsx("text",{x:t.left+n*(r+2)+r/2,y:p-t.bottom+15,textAnchor:"middle",className:"text-xs fill-text-muted",children:i},n):null)]})})},L=({reviews:o})=>{const a=j.useMemo(()=>{const x=new Date;x.setDate(x.getDate()-30);const p=o.filter(r=>r.rating!==null&&new Date(r.timestamp)>=x),t={[h.Again]:0,[h.Hard]:0,[h.Good]:0,[h.Easy]:0};let s=0;p.forEach(r=>{r.rating&&t.hasOwnProperty(r.rating)&&(t[r.rating]++,s++)});const d=r=>s>0?(r/s*100).toFixed(1):"0.0";return{total:s,again:{count:t[h.Again],percent:d(t[h.Again])},hard:{count:t[h.Hard],percent:d(t[h.Hard])},good:{count:t[h.Good],percent:d(t[h.Good])},easy:{count:t[h.Easy],percent:d(t[h.Easy])},correctPercent:d(t[h.Hard]+t[h.Good]+t[h.Easy])}},[o]);if(a.total===0)return e.jsx("div",{className:"text-center py-10",children:e.jsx("p",{className:"text-text-muted",children:"Not enough data from the last 30 days."})});const g=[{label:"Again",percent:a.again.percent,color:"bg-red-500"},{label:"Hard",percent:a.hard.percent,color:"bg-orange-500"},{label:"Good",percent:a.good.percent,color:"bg-green-500"},{label:"Easy",percent:a.easy.percent,color:"bg-blue-500"}];return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"text-center",children:[e.jsx("p",{className:"text-lg text-text-muted",children:"Reviews Marked Correct"}),e.jsxs("p",{className:"text-4xl font-bold text-green-500",children:[a.correctPercent,"%"]})]}),e.jsx("div",{className:"flex w-full h-4 rounded-full overflow-hidden",role:"progressbar",children:g.map(x=>x.percent!=="0.0"&&e.jsx("div",{className:x.color,style:{width:`${x.percent}%`},title:`${x.label}: ${x.percent}%`},x.label))}),e.jsxs("div",{className:"grid grid-cols-2 gap-x-4 gap-y-2 text-sm",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx("span",{className:"w-2.5 h-2.5 rounded-full bg-red-500 mr-2"}),e.jsxs("span",{className:"text-text-muted",children:["Again: ",e.jsx("strong",{children:a.again.count})," (",a.again.percent,"%)"]})]}),e.jsxs("div",{className:"flex items-center",children:[e.jsx("span",{className:"w-2.5 h-2.5 rounded-full bg-orange-500 mr-2"}),e.jsxs("span",{className:"text-text-muted",children:["Hard: ",e.jsx("strong",{children:a.hard.count})," (",a.hard.percent,"%)"]})]}),e.jsxs("div",{className:"flex items-center",children:[e.jsx("span",{className:"w-2.5 h-2.5 rounded-full bg-green-500 mr-2"}),e.jsxs("span",{className:"text-text-muted",children:["Good: ",e.jsx("strong",{children:a.good.count})," (",a.good.percent,"%)"]})]}),e.jsxs("div",{className:"flex items-center",children:[e.jsx("span",{className:"w-2.5 h-2.5 rounded-full bg-blue-500 mr-2"}),e.jsxs("span",{className:"text-text-muted",children:["Easy: ",e.jsx("strong",{children:a.easy.count})," (",a.easy.percent,"%)"]})]})]})]})},P=()=>{const[o,a]=j.useState([]),[g,x]=j.useState(!0),[p,t]=j.useState(null),s=M(),{openModal:d}=C();j.useEffect(()=>{(async()=>{try{const c=new Date;c.setFullYear(c.getFullYear()-1);const l=await H(c);a(l)}catch(c){console.error("Failed to load review data:",c),t("Could not load your review data. Please try again later.")}finally{x(!1)}})()},[]);const r=j.useMemo(()=>{if(g)return null;let n=0;const c=o.map(m=>new Date(m.timestamp).setHours(0,0,0,0)),l=[...new Set(c)];if(l.sort((m,y)=>y-m),l.length>0){const m=new Date().setHours(0,0,0,0),y=new Date(m).setDate(new Date(m).getDate()-1);if(l[0]===m||l[0]===y){n=1;for(let w=1;w<l.length;w++){const v=l[w-1],D=l[w],S=new Date(v).setDate(new Date(v).getDate()-1);if(D===S)n++;else break}}}const f=s.reduce((m,y)=>y.type==="flashcard"?m.concat(y.cards||[]):m.concat(y.questions||[]),[]).filter(m=>(m.interval||0)>=21&&!m.suspended).length;return{streak:n,totalReviews:o.length,matureCount:f}},[o,s,g]),i=j.useMemo(()=>s.reduce((c,l)=>l.type==="flashcard"?c.concat(l.cards||[]):c.concat(l.questions||[]),[]).filter(c=>!c.suspended),[s]);return g?e.jsxs("div",{className:"flex items-center justify-center h-64",children:[e.jsx(R,{size:"lg"}),e.jsx("p",{className:"ml-4 text-text-muted",children:"Calculating your progress..."})]}):p?e.jsx("div",{className:"text-center py-10",children:e.jsx("p",{className:"text-red-500",children:p})}):o.length===0&&i.length===0?e.jsxs("div",{className:"text-center py-20",children:[e.jsx("h2",{className:"text-2xl font-bold text-text-muted",children:"No review history yet."}),e.jsx("p",{className:"mt-2 text-text-muted",children:"Complete a study session to start tracking your progress!"})]}):e.jsxs("div",{className:"max-w-5xl mx-auto animate-fade-in space-y-8",children:[e.jsxs("div",{className:"flex justify-between items-center border-b border-border pb-4",children:[e.jsx("h1",{className:"text-3xl font-bold text-text",children:"Your Progress"}),e.jsxs(A,{variant:"secondary",size:"sm",onClick:()=>d("workloadSimulator"),children:[e.jsx(b,{name:"trending-up",className:"w-4 h-4 mr-2"}),"Simulate Workload"]})]}),e.jsx(k,{stats:r||{streak:0,totalReviews:0,matureCount:0}}),e.jsxs("div",{className:"bg-surface p-6 rounded-lg shadow-md border border-border",children:[e.jsx("h2",{className:"text-xl font-semibold text-text mb-4",children:"Activity"}),e.jsx(E,{reviews:o})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-8",children:[e.jsxs("div",{className:"bg-surface p-6 rounded-lg shadow-md border border-border",children:[e.jsx("h2",{className:"text-xl font-semibold text-text mb-4",children:"30-Day Forecast"}),e.jsx(I,{items:i})]}),e.jsxs("div",{className:"bg-surface p-6 rounded-lg shadow-md border border-border",children:[e.jsx("h2",{className:"text-xl font-semibold text-text mb-4",children:"Retention (Last 30 Days)"}),e.jsx(L,{reviews:o})]})]})]})};export{P as default};
