(function(){const p=document.createElement("link").relList;if(p&&p.supports&&p.supports("modulepreload"))return;for(const h of document.querySelectorAll('link[rel="modulepreload"]'))v(h);new MutationObserver(h=>{for(const u of h)if(u.type==="childList")for(const l of u.addedNodes)l.tagName==="LINK"&&l.rel==="modulepreload"&&v(l)}).observe(document,{childList:!0,subtree:!0});function o(h){const u={};return h.integrity&&(u.integrity=h.integrity),h.referrerPolicy&&(u.referrerPolicy=h.referrerPolicy),h.crossOrigin==="use-credentials"?u.credentials="include":h.crossOrigin==="anonymous"?u.credentials="omit":u.credentials="same-origin",u}function v(h){if(h.ep)return;h.ep=!0;const u=o(h);fetch(h.href,u)}})();var fo=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function si(s){return s&&s.__esModule&&Object.prototype.hasOwnProperty.call(s,"default")?s.default:s}function Nm(s){if(Object.prototype.hasOwnProperty.call(s,"__esModule"))return s;var p=s.default;if(typeof p=="function"){var o=function v(){return this instanceof v?Reflect.construct(p,arguments,this.constructor):p.apply(this,arguments)};o.prototype=p.prototype}else o={};return Object.defineProperty(o,"__esModule",{value:!0}),Object.keys(s).forEach(function(v){var h=Object.getOwnPropertyDescriptor(s,v);Object.defineProperty(o,v,h.get?h:{enumerable:!0,get:function(){return s[v]}})}),o}var nc={exports:{}},Xa={},sc={exports:{}},ht={};/**
 * @license React
 * react.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Pd;function jm(){if(Pd)return ht;Pd=1;var s=Symbol.for("react.element"),p=Symbol.for("react.portal"),o=Symbol.for("react.fragment"),v=Symbol.for("react.strict_mode"),h=Symbol.for("react.profiler"),u=Symbol.for("react.provider"),l=Symbol.for("react.context"),f=Symbol.for("react.forward_ref"),x=Symbol.for("react.suspense"),d=Symbol.for("react.memo"),T=Symbol.for("react.lazy"),b=Symbol.iterator;function N(S){return S===null||typeof S!="object"?null:(S=b&&S[b]||S["@@iterator"],typeof S=="function"?S:null)}var w={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},I=Object.assign,k={};function C(S,A,ce){this.props=S,this.context=A,this.refs=k,this.updater=ce||w}C.prototype.isReactComponent={},C.prototype.setState=function(S,A){if(typeof S!="object"&&typeof S!="function"&&S!=null)throw Error("setState(...): takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,S,A,"setState")},C.prototype.forceUpdate=function(S){this.updater.enqueueForceUpdate(this,S,"forceUpdate")};function j(){}j.prototype=C.prototype;function O(S,A,ce){this.props=S,this.context=A,this.refs=k,this.updater=ce||w}var F=O.prototype=new j;F.constructor=O,I(F,C.prototype),F.isPureReactComponent=!0;var R=Array.isArray,M=Object.prototype.hasOwnProperty,H={current:null},V={key:!0,ref:!0,__self:!0,__source:!0};function oe(S,A,ce){var pe,me={},Te=null,he=null;if(A!=null)for(pe in A.ref!==void 0&&(he=A.ref),A.key!==void 0&&(Te=""+A.key),A)M.call(A,pe)&&!V.hasOwnProperty(pe)&&(me[pe]=A[pe]);var Se=arguments.length-2;if(Se===1)me.children=ce;else if(1<Se){for(var Ee=Array(Se),Le=0;Le<Se;Le++)Ee[Le]=arguments[Le+2];me.children=Ee}if(S&&S.defaultProps)for(pe in Se=S.defaultProps,Se)me[pe]===void 0&&(me[pe]=Se[pe]);return{$$typeof:s,type:S,key:Te,ref:he,props:me,_owner:H.current}}function J(S,A){return{$$typeof:s,type:S.type,key:A,ref:S.ref,props:S.props,_owner:S._owner}}function Z(S){return typeof S=="object"&&S!==null&&S.$$typeof===s}function de(S){var A={"=":"=0",":":"=2"};return"$"+S.replace(/[=:]/g,function(ce){return A[ce]})}var $=/\/+/g;function W(S,A){return typeof S=="object"&&S!==null&&S.key!=null?de(""+S.key):A.toString(36)}function _(S,A,ce,pe,me){var Te=typeof S;(Te==="undefined"||Te==="boolean")&&(S=null);var he=!1;if(S===null)he=!0;else switch(Te){case"string":case"number":he=!0;break;case"object":switch(S.$$typeof){case s:case p:he=!0}}if(he)return he=S,me=me(he),S=pe===""?"."+W(he,0):pe,R(me)?(ce="",S!=null&&(ce=S.replace($,"$&/")+"/"),_(me,A,ce,"",function(Le){return Le})):me!=null&&(Z(me)&&(me=J(me,ce+(!me.key||he&&he.key===me.key?"":(""+me.key).replace($,"$&/")+"/")+S)),A.push(me)),1;if(he=0,pe=pe===""?".":pe+":",R(S))for(var Se=0;Se<S.length;Se++){Te=S[Se];var Ee=pe+W(Te,Se);he+=_(Te,A,ce,Ee,me)}else if(Ee=N(S),typeof Ee=="function")for(S=Ee.call(S),Se=0;!(Te=S.next()).done;)Te=Te.value,Ee=pe+W(Te,Se++),he+=_(Te,A,ce,Ee,me);else if(Te==="object")throw A=String(S),Error("Objects are not valid as a React child (found: "+(A==="[object Object]"?"object with keys {"+Object.keys(S).join(", ")+"}":A)+"). If you meant to render a collection of children, use an array instead.");return he}function ie(S,A,ce){if(S==null)return S;var pe=[],me=0;return _(S,pe,"","",function(Te){return A.call(ce,Te,me++)}),pe}function be(S){if(S._status===-1){var A=S._result;A=A(),A.then(function(ce){(S._status===0||S._status===-1)&&(S._status=1,S._result=ce)},function(ce){(S._status===0||S._status===-1)&&(S._status=2,S._result=ce)}),S._status===-1&&(S._status=0,S._result=A)}if(S._status===1)return S._result.default;throw S._result}var ge={current:null},je={transition:null},fe={ReactCurrentDispatcher:ge,ReactCurrentBatchConfig:je,ReactCurrentOwner:H};function B(){throw Error("act(...) is not supported in production builds of React.")}return ht.Children={map:ie,forEach:function(S,A,ce){ie(S,function(){A.apply(this,arguments)},ce)},count:function(S){var A=0;return ie(S,function(){A++}),A},toArray:function(S){return ie(S,function(A){return A})||[]},only:function(S){if(!Z(S))throw Error("React.Children.only expected to receive a single React element child.");return S}},ht.Component=C,ht.Fragment=o,ht.Profiler=h,ht.PureComponent=O,ht.StrictMode=v,ht.Suspense=x,ht.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=fe,ht.act=B,ht.cloneElement=function(S,A,ce){if(S==null)throw Error("React.cloneElement(...): The argument must be a React element, but you passed "+S+".");var pe=I({},S.props),me=S.key,Te=S.ref,he=S._owner;if(A!=null){if(A.ref!==void 0&&(Te=A.ref,he=H.current),A.key!==void 0&&(me=""+A.key),S.type&&S.type.defaultProps)var Se=S.type.defaultProps;for(Ee in A)M.call(A,Ee)&&!V.hasOwnProperty(Ee)&&(pe[Ee]=A[Ee]===void 0&&Se!==void 0?Se[Ee]:A[Ee])}var Ee=arguments.length-2;if(Ee===1)pe.children=ce;else if(1<Ee){Se=Array(Ee);for(var Le=0;Le<Ee;Le++)Se[Le]=arguments[Le+2];pe.children=Se}return{$$typeof:s,type:S.type,key:me,ref:Te,props:pe,_owner:he}},ht.createContext=function(S){return S={$$typeof:l,_currentValue:S,_currentValue2:S,_threadCount:0,Provider:null,Consumer:null,_defaultValue:null,_globalName:null},S.Provider={$$typeof:u,_context:S},S.Consumer=S},ht.createElement=oe,ht.createFactory=function(S){var A=oe.bind(null,S);return A.type=S,A},ht.createRef=function(){return{current:null}},ht.forwardRef=function(S){return{$$typeof:f,render:S}},ht.isValidElement=Z,ht.lazy=function(S){return{$$typeof:T,_payload:{_status:-1,_result:S},_init:be}},ht.memo=function(S,A){return{$$typeof:d,type:S,compare:A===void 0?null:A}},ht.startTransition=function(S){var A=je.transition;je.transition={};try{S()}finally{je.transition=A}},ht.unstable_act=B,ht.useCallback=function(S,A){return ge.current.useCallback(S,A)},ht.useContext=function(S){return ge.current.useContext(S)},ht.useDebugValue=function(){},ht.useDeferredValue=function(S){return ge.current.useDeferredValue(S)},ht.useEffect=function(S,A){return ge.current.useEffect(S,A)},ht.useId=function(){return ge.current.useId()},ht.useImperativeHandle=function(S,A,ce){return ge.current.useImperativeHandle(S,A,ce)},ht.useInsertionEffect=function(S,A){return ge.current.useInsertionEffect(S,A)},ht.useLayoutEffect=function(S,A){return ge.current.useLayoutEffect(S,A)},ht.useMemo=function(S,A){return ge.current.useMemo(S,A)},ht.useReducer=function(S,A,ce){return ge.current.useReducer(S,A,ce)},ht.useRef=function(S){return ge.current.useRef(S)},ht.useState=function(S){return ge.current.useState(S)},ht.useSyncExternalStore=function(S,A,ce){return ge.current.useSyncExternalStore(S,A,ce)},ht.useTransition=function(){return ge.current.useTransition()},ht.version="18.3.1",ht}var Ud;function ai(){return Ud||(Ud=1,sc.exports=jm()),sc.exports}/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var zd;function Cm(){if(zd)return Xa;zd=1;var s=ai(),p=Symbol.for("react.element"),o=Symbol.for("react.fragment"),v=Object.prototype.hasOwnProperty,h=s.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,u={key:!0,ref:!0,__self:!0,__source:!0};function l(f,x,d){var T,b={},N=null,w=null;d!==void 0&&(N=""+d),x.key!==void 0&&(N=""+x.key),x.ref!==void 0&&(w=x.ref);for(T in x)v.call(x,T)&&!u.hasOwnProperty(T)&&(b[T]=x[T]);if(f&&f.defaultProps)for(T in x=f.defaultProps,x)b[T]===void 0&&(b[T]=x[T]);return{$$typeof:p,type:f,key:N,ref:w,props:b,_owner:h.current}}return Xa.Fragment=o,Xa.jsx=l,Xa.jsxs=l,Xa}var qd;function Im(){return qd||(qd=1,nc.exports=Cm()),nc.exports}var r=Im(),U=ai();const ni=si(U);var ho={},ac={exports:{}},Tr={},ic={exports:{}},oc={};/**
 * @license React
 * scheduler.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Bd;function Tm(){return Bd||(Bd=1,function(s){function p(je,fe){var B=je.length;je.push(fe);e:for(;0<B;){var S=B-1>>>1,A=je[S];if(0<h(A,fe))je[S]=fe,je[B]=A,B=S;else break e}}function o(je){return je.length===0?null:je[0]}function v(je){if(je.length===0)return null;var fe=je[0],B=je.pop();if(B!==fe){je[0]=B;e:for(var S=0,A=je.length,ce=A>>>1;S<ce;){var pe=2*(S+1)-1,me=je[pe],Te=pe+1,he=je[Te];if(0>h(me,B))Te<A&&0>h(he,me)?(je[S]=he,je[Te]=B,S=Te):(je[S]=me,je[pe]=B,S=pe);else if(Te<A&&0>h(he,B))je[S]=he,je[Te]=B,S=Te;else break e}}return fe}function h(je,fe){var B=je.sortIndex-fe.sortIndex;return B!==0?B:je.id-fe.id}if(typeof performance=="object"&&typeof performance.now=="function"){var u=performance;s.unstable_now=function(){return u.now()}}else{var l=Date,f=l.now();s.unstable_now=function(){return l.now()-f}}var x=[],d=[],T=1,b=null,N=3,w=!1,I=!1,k=!1,C=typeof setTimeout=="function"?setTimeout:null,j=typeof clearTimeout=="function"?clearTimeout:null,O=typeof setImmediate<"u"?setImmediate:null;typeof navigator<"u"&&navigator.scheduling!==void 0&&navigator.scheduling.isInputPending!==void 0&&navigator.scheduling.isInputPending.bind(navigator.scheduling);function F(je){for(var fe=o(d);fe!==null;){if(fe.callback===null)v(d);else if(fe.startTime<=je)v(d),fe.sortIndex=fe.expirationTime,p(x,fe);else break;fe=o(d)}}function R(je){if(k=!1,F(je),!I)if(o(x)!==null)I=!0,be(M);else{var fe=o(d);fe!==null&&ge(R,fe.startTime-je)}}function M(je,fe){I=!1,k&&(k=!1,j(oe),oe=-1),w=!0;var B=N;try{for(F(fe),b=o(x);b!==null&&(!(b.expirationTime>fe)||je&&!de());){var S=b.callback;if(typeof S=="function"){b.callback=null,N=b.priorityLevel;var A=S(b.expirationTime<=fe);fe=s.unstable_now(),typeof A=="function"?b.callback=A:b===o(x)&&v(x),F(fe)}else v(x);b=o(x)}if(b!==null)var ce=!0;else{var pe=o(d);pe!==null&&ge(R,pe.startTime-fe),ce=!1}return ce}finally{b=null,N=B,w=!1}}var H=!1,V=null,oe=-1,J=5,Z=-1;function de(){return!(s.unstable_now()-Z<J)}function $(){if(V!==null){var je=s.unstable_now();Z=je;var fe=!0;try{fe=V(!0,je)}finally{fe?W():(H=!1,V=null)}}else H=!1}var W;if(typeof O=="function")W=function(){O($)};else if(typeof MessageChannel<"u"){var _=new MessageChannel,ie=_.port2;_.port1.onmessage=$,W=function(){ie.postMessage(null)}}else W=function(){C($,0)};function be(je){V=je,H||(H=!0,W())}function ge(je,fe){oe=C(function(){je(s.unstable_now())},fe)}s.unstable_IdlePriority=5,s.unstable_ImmediatePriority=1,s.unstable_LowPriority=4,s.unstable_NormalPriority=3,s.unstable_Profiling=null,s.unstable_UserBlockingPriority=2,s.unstable_cancelCallback=function(je){je.callback=null},s.unstable_continueExecution=function(){I||w||(I=!0,be(M))},s.unstable_forceFrameRate=function(je){0>je||125<je?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):J=0<je?Math.floor(1e3/je):5},s.unstable_getCurrentPriorityLevel=function(){return N},s.unstable_getFirstCallbackNode=function(){return o(x)},s.unstable_next=function(je){switch(N){case 1:case 2:case 3:var fe=3;break;default:fe=N}var B=N;N=fe;try{return je()}finally{N=B}},s.unstable_pauseExecution=function(){},s.unstable_requestPaint=function(){},s.unstable_runWithPriority=function(je,fe){switch(je){case 1:case 2:case 3:case 4:case 5:break;default:je=3}var B=N;N=je;try{return fe()}finally{N=B}},s.unstable_scheduleCallback=function(je,fe,B){var S=s.unstable_now();switch(typeof B=="object"&&B!==null?(B=B.delay,B=typeof B=="number"&&0<B?S+B:S):B=S,je){case 1:var A=-1;break;case 2:A=250;break;case 5:A=1073741823;break;case 4:A=1e4;break;default:A=5e3}return A=B+A,je={id:T++,callback:fe,priorityLevel:je,startTime:B,expirationTime:A,sortIndex:-1},B>S?(je.sortIndex=B,p(d,je),o(x)===null&&je===o(d)&&(k?(j(oe),oe=-1):k=!0,ge(R,B-S))):(je.sortIndex=A,p(x,je),I||w||(I=!0,be(M))),je},s.unstable_shouldYield=de,s.unstable_wrapCallback=function(je){var fe=N;return function(){var B=N;N=fe;try{return je.apply(this,arguments)}finally{N=B}}}}(oc)),oc}var Gd;function Dm(){return Gd||(Gd=1,ic.exports=Tm()),ic.exports}/**
 * @license React
 * react-dom.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var $d;function Am(){if($d)return Tr;$d=1;var s=ai(),p=Dm();function o(e){for(var t="https://reactjs.org/docs/error-decoder.html?invariant="+e,n=1;n<arguments.length;n++)t+="&args[]="+encodeURIComponent(arguments[n]);return"Minified React error #"+e+"; visit "+t+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}var v=new Set,h={};function u(e,t){l(e,t),l(e+"Capture",t)}function l(e,t){for(h[e]=t,e=0;e<t.length;e++)v.add(t[e])}var f=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),x=Object.prototype.hasOwnProperty,d=/^[:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD][:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\-.0-9\u00B7\u0300-\u036F\u203F-\u2040]*$/,T={},b={};function N(e){return x.call(b,e)?!0:x.call(T,e)?!1:d.test(e)?b[e]=!0:(T[e]=!0,!1)}function w(e,t,n,a){if(n!==null&&n.type===0)return!1;switch(typeof t){case"function":case"symbol":return!0;case"boolean":return a?!1:n!==null?!n.acceptsBooleans:(e=e.toLowerCase().slice(0,5),e!=="data-"&&e!=="aria-");default:return!1}}function I(e,t,n,a){if(t===null||typeof t>"u"||w(e,t,n,a))return!0;if(a)return!1;if(n!==null)switch(n.type){case 3:return!t;case 4:return t===!1;case 5:return isNaN(t);case 6:return isNaN(t)||1>t}return!1}function k(e,t,n,a,c,y,D){this.acceptsBooleans=t===2||t===3||t===4,this.attributeName=a,this.attributeNamespace=c,this.mustUseProperty=n,this.propertyName=e,this.type=t,this.sanitizeURL=y,this.removeEmptyString=D}var C={};"children dangerouslySetInnerHTML defaultValue defaultChecked innerHTML suppressContentEditableWarning suppressHydrationWarning style".split(" ").forEach(function(e){C[e]=new k(e,0,!1,e,null,!1,!1)}),[["acceptCharset","accept-charset"],["className","class"],["htmlFor","for"],["httpEquiv","http-equiv"]].forEach(function(e){var t=e[0];C[t]=new k(t,1,!1,e[1],null,!1,!1)}),["contentEditable","draggable","spellCheck","value"].forEach(function(e){C[e]=new k(e,2,!1,e.toLowerCase(),null,!1,!1)}),["autoReverse","externalResourcesRequired","focusable","preserveAlpha"].forEach(function(e){C[e]=new k(e,2,!1,e,null,!1,!1)}),"allowFullScreen async autoFocus autoPlay controls default defer disabled disablePictureInPicture disableRemotePlayback formNoValidate hidden loop noModule noValidate open playsInline readOnly required reversed scoped seamless itemScope".split(" ").forEach(function(e){C[e]=new k(e,3,!1,e.toLowerCase(),null,!1,!1)}),["checked","multiple","muted","selected"].forEach(function(e){C[e]=new k(e,3,!0,e,null,!1,!1)}),["capture","download"].forEach(function(e){C[e]=new k(e,4,!1,e,null,!1,!1)}),["cols","rows","size","span"].forEach(function(e){C[e]=new k(e,6,!1,e,null,!1,!1)}),["rowSpan","start"].forEach(function(e){C[e]=new k(e,5,!1,e.toLowerCase(),null,!1,!1)});var j=/[\-:]([a-z])/g;function O(e){return e[1].toUpperCase()}"accent-height alignment-baseline arabic-form baseline-shift cap-height clip-path clip-rule color-interpolation color-interpolation-filters color-profile color-rendering dominant-baseline enable-background fill-opacity fill-rule flood-color flood-opacity font-family font-size font-size-adjust font-stretch font-style font-variant font-weight glyph-name glyph-orientation-horizontal glyph-orientation-vertical horiz-adv-x horiz-origin-x image-rendering letter-spacing lighting-color marker-end marker-mid marker-start overline-position overline-thickness paint-order panose-1 pointer-events rendering-intent shape-rendering stop-color stop-opacity strikethrough-position strikethrough-thickness stroke-dasharray stroke-dashoffset stroke-linecap stroke-linejoin stroke-miterlimit stroke-opacity stroke-width text-anchor text-decoration text-rendering underline-position underline-thickness unicode-bidi unicode-range units-per-em v-alphabetic v-hanging v-ideographic v-mathematical vector-effect vert-adv-y vert-origin-x vert-origin-y word-spacing writing-mode xmlns:xlink x-height".split(" ").forEach(function(e){var t=e.replace(j,O);C[t]=new k(t,1,!1,e,null,!1,!1)}),"xlink:actuate xlink:arcrole xlink:role xlink:show xlink:title xlink:type".split(" ").forEach(function(e){var t=e.replace(j,O);C[t]=new k(t,1,!1,e,"http://www.w3.org/1999/xlink",!1,!1)}),["xml:base","xml:lang","xml:space"].forEach(function(e){var t=e.replace(j,O);C[t]=new k(t,1,!1,e,"http://www.w3.org/XML/1998/namespace",!1,!1)}),["tabIndex","crossOrigin"].forEach(function(e){C[e]=new k(e,1,!1,e.toLowerCase(),null,!1,!1)}),C.xlinkHref=new k("xlinkHref",1,!1,"xlink:href","http://www.w3.org/1999/xlink",!0,!1),["src","href","action","formAction"].forEach(function(e){C[e]=new k(e,1,!1,e.toLowerCase(),null,!0,!0)});function F(e,t,n,a){var c=C.hasOwnProperty(t)?C[t]:null;(c!==null?c.type!==0:a||!(2<t.length)||t[0]!=="o"&&t[0]!=="O"||t[1]!=="n"&&t[1]!=="N")&&(I(t,n,c,a)&&(n=null),a||c===null?N(t)&&(n===null?e.removeAttribute(t):e.setAttribute(t,""+n)):c.mustUseProperty?e[c.propertyName]=n===null?c.type===3?!1:"":n:(t=c.attributeName,a=c.attributeNamespace,n===null?e.removeAttribute(t):(c=c.type,n=c===3||c===4&&n===!0?"":""+n,a?e.setAttributeNS(a,t,n):e.setAttribute(t,n))))}var R=s.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED,M=Symbol.for("react.element"),H=Symbol.for("react.portal"),V=Symbol.for("react.fragment"),oe=Symbol.for("react.strict_mode"),J=Symbol.for("react.profiler"),Z=Symbol.for("react.provider"),de=Symbol.for("react.context"),$=Symbol.for("react.forward_ref"),W=Symbol.for("react.suspense"),_=Symbol.for("react.suspense_list"),ie=Symbol.for("react.memo"),be=Symbol.for("react.lazy"),ge=Symbol.for("react.offscreen"),je=Symbol.iterator;function fe(e){return e===null||typeof e!="object"?null:(e=je&&e[je]||e["@@iterator"],typeof e=="function"?e:null)}var B=Object.assign,S;function A(e){if(S===void 0)try{throw Error()}catch(n){var t=n.stack.trim().match(/\n( *(at )?)/);S=t&&t[1]||""}return`
`+S+e}var ce=!1;function pe(e,t){if(!e||ce)return"";ce=!0;var n=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{if(t)if(t=function(){throw Error()},Object.defineProperty(t.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(t,[])}catch(_e){var a=_e}Reflect.construct(e,[],t)}else{try{t.call()}catch(_e){a=_e}e.call(t.prototype)}else{try{throw Error()}catch(_e){a=_e}e()}}catch(_e){if(_e&&a&&typeof _e.stack=="string"){for(var c=_e.stack.split(`
`),y=a.stack.split(`
`),D=c.length-1,K=y.length-1;1<=D&&0<=K&&c[D]!==y[K];)K--;for(;1<=D&&0<=K;D--,K--)if(c[D]!==y[K]){if(D!==1||K!==1)do if(D--,K--,0>K||c[D]!==y[K]){var ne=`
`+c[D].replace(" at new "," at ");return e.displayName&&ne.includes("<anonymous>")&&(ne=ne.replace("<anonymous>",e.displayName)),ne}while(1<=D&&0<=K);break}}}finally{ce=!1,Error.prepareStackTrace=n}return(e=e?e.displayName||e.name:"")?A(e):""}function me(e){switch(e.tag){case 5:return A(e.type);case 16:return A("Lazy");case 13:return A("Suspense");case 19:return A("SuspenseList");case 0:case 2:case 15:return e=pe(e.type,!1),e;case 11:return e=pe(e.type.render,!1),e;case 1:return e=pe(e.type,!0),e;default:return""}}function Te(e){if(e==null)return null;if(typeof e=="function")return e.displayName||e.name||null;if(typeof e=="string")return e;switch(e){case V:return"Fragment";case H:return"Portal";case J:return"Profiler";case oe:return"StrictMode";case W:return"Suspense";case _:return"SuspenseList"}if(typeof e=="object")switch(e.$$typeof){case de:return(e.displayName||"Context")+".Consumer";case Z:return(e._context.displayName||"Context")+".Provider";case $:var t=e.render;return e=e.displayName,e||(e=t.displayName||t.name||"",e=e!==""?"ForwardRef("+e+")":"ForwardRef"),e;case ie:return t=e.displayName||null,t!==null?t:Te(e.type)||"Memo";case be:t=e._payload,e=e._init;try{return Te(e(t))}catch{}}return null}function he(e){var t=e.type;switch(e.tag){case 24:return"Cache";case 9:return(t.displayName||"Context")+".Consumer";case 10:return(t._context.displayName||"Context")+".Provider";case 18:return"DehydratedFragment";case 11:return e=t.render,e=e.displayName||e.name||"",t.displayName||(e!==""?"ForwardRef("+e+")":"ForwardRef");case 7:return"Fragment";case 5:return t;case 4:return"Portal";case 3:return"Root";case 6:return"Text";case 16:return Te(t);case 8:return t===oe?"StrictMode":"Mode";case 22:return"Offscreen";case 12:return"Profiler";case 21:return"Scope";case 13:return"Suspense";case 19:return"SuspenseList";case 25:return"TracingMarker";case 1:case 0:case 17:case 2:case 14:case 15:if(typeof t=="function")return t.displayName||t.name||null;if(typeof t=="string")return t}return null}function Se(e){switch(typeof e){case"boolean":case"number":case"string":case"undefined":return e;case"object":return e;default:return""}}function Ee(e){var t=e.type;return(e=e.nodeName)&&e.toLowerCase()==="input"&&(t==="checkbox"||t==="radio")}function Le(e){var t=Ee(e)?"checked":"value",n=Object.getOwnPropertyDescriptor(e.constructor.prototype,t),a=""+e[t];if(!e.hasOwnProperty(t)&&typeof n<"u"&&typeof n.get=="function"&&typeof n.set=="function"){var c=n.get,y=n.set;return Object.defineProperty(e,t,{configurable:!0,get:function(){return c.call(this)},set:function(D){a=""+D,y.call(this,D)}}),Object.defineProperty(e,t,{enumerable:n.enumerable}),{getValue:function(){return a},setValue:function(D){a=""+D},stopTracking:function(){e._valueTracker=null,delete e[t]}}}}function qe(e){e._valueTracker||(e._valueTracker=Le(e))}function te(e){if(!e)return!1;var t=e._valueTracker;if(!t)return!0;var n=t.getValue(),a="";return e&&(a=Ee(e)?e.checked?"true":"false":e.value),e=a,e!==n?(t.setValue(e),!0):!1}function Y(e){if(e=e||(typeof document<"u"?document:void 0),typeof e>"u")return null;try{return e.activeElement||e.body}catch{return e.body}}function g(e,t){var n=t.checked;return B({},t,{defaultChecked:void 0,defaultValue:void 0,value:void 0,checked:n??e._wrapperState.initialChecked})}function ee(e,t){var n=t.defaultValue==null?"":t.defaultValue,a=t.checked!=null?t.checked:t.defaultChecked;n=Se(t.value!=null?t.value:n),e._wrapperState={initialChecked:a,initialValue:n,controlled:t.type==="checkbox"||t.type==="radio"?t.checked!=null:t.value!=null}}function G(e,t){t=t.checked,t!=null&&F(e,"checked",t,!1)}function P(e,t){G(e,t);var n=Se(t.value),a=t.type;if(n!=null)a==="number"?(n===0&&e.value===""||e.value!=n)&&(e.value=""+n):e.value!==""+n&&(e.value=""+n);else if(a==="submit"||a==="reset"){e.removeAttribute("value");return}t.hasOwnProperty("value")?q(e,t.type,n):t.hasOwnProperty("defaultValue")&&q(e,t.type,Se(t.defaultValue)),t.checked==null&&t.defaultChecked!=null&&(e.defaultChecked=!!t.defaultChecked)}function L(e,t,n){if(t.hasOwnProperty("value")||t.hasOwnProperty("defaultValue")){var a=t.type;if(!(a!=="submit"&&a!=="reset"||t.value!==void 0&&t.value!==null))return;t=""+e._wrapperState.initialValue,n||t===e.value||(e.value=t),e.defaultValue=t}n=e.name,n!==""&&(e.name=""),e.defaultChecked=!!e._wrapperState.initialChecked,n!==""&&(e.name=n)}function q(e,t,n){(t!=="number"||Y(e.ownerDocument)!==e)&&(n==null?e.defaultValue=""+e._wrapperState.initialValue:e.defaultValue!==""+n&&(e.defaultValue=""+n))}var X=Array.isArray;function se(e,t,n,a){if(e=e.options,t){t={};for(var c=0;c<n.length;c++)t["$"+n[c]]=!0;for(n=0;n<e.length;n++)c=t.hasOwnProperty("$"+e[n].value),e[n].selected!==c&&(e[n].selected=c),c&&a&&(e[n].defaultSelected=!0)}else{for(n=""+Se(n),t=null,c=0;c<e.length;c++){if(e[c].value===n){e[c].selected=!0,a&&(e[c].defaultSelected=!0);return}t!==null||e[c].disabled||(t=e[c])}t!==null&&(t.selected=!0)}}function Q(e,t){if(t.dangerouslySetInnerHTML!=null)throw Error(o(91));return B({},t,{value:void 0,defaultValue:void 0,children:""+e._wrapperState.initialValue})}function ue(e,t){var n=t.value;if(n==null){if(n=t.children,t=t.defaultValue,n!=null){if(t!=null)throw Error(o(92));if(X(n)){if(1<n.length)throw Error(o(93));n=n[0]}t=n}t==null&&(t=""),n=t}e._wrapperState={initialValue:Se(n)}}function Ie(e,t){var n=Se(t.value),a=Se(t.defaultValue);n!=null&&(n=""+n,n!==e.value&&(e.value=n),t.defaultValue==null&&e.defaultValue!==n&&(e.defaultValue=n)),a!=null&&(e.defaultValue=""+a)}function ye(e){var t=e.textContent;t===e._wrapperState.initialValue&&t!==""&&t!==null&&(e.value=t)}function Ce(e){switch(e){case"svg":return"http://www.w3.org/2000/svg";case"math":return"http://www.w3.org/1998/Math/MathML";default:return"http://www.w3.org/1999/xhtml"}}function Be(e,t){return e==null||e==="http://www.w3.org/1999/xhtml"?Ce(t):e==="http://www.w3.org/2000/svg"&&t==="foreignObject"?"http://www.w3.org/1999/xhtml":e}var $e,ct=function(e){return typeof MSApp<"u"&&MSApp.execUnsafeLocalFunction?function(t,n,a,c){MSApp.execUnsafeLocalFunction(function(){return e(t,n,a,c)})}:e}(function(e,t){if(e.namespaceURI!=="http://www.w3.org/2000/svg"||"innerHTML"in e)e.innerHTML=t;else{for($e=$e||document.createElement("div"),$e.innerHTML="<svg>"+t.valueOf().toString()+"</svg>",t=$e.firstChild;e.firstChild;)e.removeChild(e.firstChild);for(;t.firstChild;)e.appendChild(t.firstChild)}});function et(e,t){if(t){var n=e.firstChild;if(n&&n===e.lastChild&&n.nodeType===3){n.nodeValue=t;return}}e.textContent=t}var pt={animationIterationCount:!0,aspectRatio:!0,borderImageOutset:!0,borderImageSlice:!0,borderImageWidth:!0,boxFlex:!0,boxFlexGroup:!0,boxOrdinalGroup:!0,columnCount:!0,columns:!0,flex:!0,flexGrow:!0,flexPositive:!0,flexShrink:!0,flexNegative:!0,flexOrder:!0,gridArea:!0,gridRow:!0,gridRowEnd:!0,gridRowSpan:!0,gridRowStart:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnSpan:!0,gridColumnStart:!0,fontWeight:!0,lineClamp:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,tabSize:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,strokeDasharray:!0,strokeDashoffset:!0,strokeMiterlimit:!0,strokeOpacity:!0,strokeWidth:!0},qt=["Webkit","ms","Moz","O"];Object.keys(pt).forEach(function(e){qt.forEach(function(t){t=t+e.charAt(0).toUpperCase()+e.substring(1),pt[t]=pt[e]})});function ft(e,t,n){return t==null||typeof t=="boolean"||t===""?"":n||typeof t!="number"||t===0||pt.hasOwnProperty(e)&&pt[e]?(""+t).trim():t+"px"}function jt(e,t){e=e.style;for(var n in t)if(t.hasOwnProperty(n)){var a=n.indexOf("--")===0,c=ft(n,t[n],a);n==="float"&&(n="cssFloat"),a?e.setProperty(n,c):e[n]=c}}var gr=B({menuitem:!0},{area:!0,base:!0,br:!0,col:!0,embed:!0,hr:!0,img:!0,input:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0});function Ct(e,t){if(t){if(gr[e]&&(t.children!=null||t.dangerouslySetInnerHTML!=null))throw Error(o(137,e));if(t.dangerouslySetInnerHTML!=null){if(t.children!=null)throw Error(o(60));if(typeof t.dangerouslySetInnerHTML!="object"||!("__html"in t.dangerouslySetInnerHTML))throw Error(o(61))}if(t.style!=null&&typeof t.style!="object")throw Error(o(62))}}function Mt(e,t){if(e.indexOf("-")===-1)return typeof t.is=="string";switch(e){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var tt=null;function Wt(e){return e=e.target||e.srcElement||window,e.correspondingUseElement&&(e=e.correspondingUseElement),e.nodeType===3?e.parentNode:e}var ar=null,ir=null,ut=null;function br(e){if(e=Pa(e)){if(typeof ar!="function")throw Error(o(280));var t=e.stateNode;t&&(t=Ni(t),ar(e.stateNode,e.type,t))}}function kr(e){ir?ut?ut.push(e):ut=[e]:ir=e}function ln(){if(ir){var e=ir,t=ut;if(ut=ir=null,br(e),t)for(e=0;e<t.length;e++)br(t[e])}}function Ue(e,t){return e(t)}function Fn(){}var Lt=!1;function cn(e,t,n){if(Lt)return e(t,n);Lt=!0;try{return Ue(e,t,n)}finally{Lt=!1,(ir!==null||ut!==null)&&(Fn(),ln())}}function Ur(e,t){var n=e.stateNode;if(n===null)return null;var a=Ni(n);if(a===null)return null;n=a[t];e:switch(t){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(a=!a.disabled)||(e=e.type,a=!(e==="button"||e==="input"||e==="select"||e==="textarea")),e=!a;break e;default:e=!1}if(e)return null;if(n&&typeof n!="function")throw Error(o(231,t,typeof n));return n}var bn=!1;if(f)try{var or={};Object.defineProperty(or,"passive",{get:function(){bn=!0}}),window.addEventListener("test",or,or),window.removeEventListener("test",or,or)}catch{bn=!1}function hs(e,t,n,a,c,y,D,K,ne){var _e=Array.prototype.slice.call(arguments,3);try{t.apply(n,_e)}catch(Me){this.onError(Me)}}var Bt=!1,kn=null,Dr=!1,Pn=null,Hs={onError:function(e){Bt=!0,kn=e}};function ze(e,t,n,a,c,y,D,K,ne){Bt=!1,kn=null,hs.apply(Hs,arguments)}function He(e,t,n,a,c,y,D,K,ne){if(ze.apply(this,arguments),Bt){if(Bt){var _e=kn;Bt=!1,kn=null}else throw Error(o(198));Dr||(Dr=!0,Pn=_e)}}function Je(e){var t=e,n=e;if(e.alternate)for(;t.return;)t=t.return;else{e=t;do t=e,(t.flags&4098)!==0&&(n=t.return),e=t.return;while(e)}return t.tag===3?n:null}function xt(e){if(e.tag===13){var t=e.memoizedState;if(t===null&&(e=e.alternate,e!==null&&(t=e.memoizedState)),t!==null)return t.dehydrated}return null}function Vt(e){if(Je(e)!==e)throw Error(o(188))}function lr(e){var t=e.alternate;if(!t){if(t=Je(e),t===null)throw Error(o(188));return t!==e?null:e}for(var n=e,a=t;;){var c=n.return;if(c===null)break;var y=c.alternate;if(y===null){if(a=c.return,a!==null){n=a;continue}break}if(c.child===y.child){for(y=c.child;y;){if(y===n)return Vt(c),e;if(y===a)return Vt(c),t;y=y.sibling}throw Error(o(188))}if(n.return!==a.return)n=c,a=y;else{for(var D=!1,K=c.child;K;){if(K===n){D=!0,n=c,a=y;break}if(K===a){D=!0,a=c,n=y;break}K=K.sibling}if(!D){for(K=y.child;K;){if(K===n){D=!0,n=y,a=c;break}if(K===a){D=!0,a=y,n=c;break}K=K.sibling}if(!D)throw Error(o(189))}}if(n.alternate!==a)throw Error(o(190))}if(n.tag!==3)throw Error(o(188));return n.stateNode.current===n?e:t}function Ft(e){return e=lr(e),e!==null?Et(e):null}function Et(e){if(e.tag===5||e.tag===6)return e;for(e=e.child;e!==null;){var t=Et(e);if(t!==null)return t;e=e.sibling}return null}var Gt=p.unstable_scheduleCallback,Yr=p.unstable_cancelCallback,zr=p.unstable_shouldYield,ii=p.unstable_requestPaint,It=p.unstable_now,ms=p.unstable_getCurrentPriorityLevel,Ws=p.unstable_ImmediatePriority,ps=p.unstable_UserBlockingPriority,gs=p.unstable_NormalPriority,Un=p.unstable_LowPriority,Qs=p.unstable_IdlePriority,xs=null,Ar=null;function oi(e){if(Ar&&typeof Ar.onCommitFiberRoot=="function")try{Ar.onCommitFiberRoot(xs,e,void 0,(e.current.flags&128)===128)}catch{}}var Or=Math.clz32?Math.clz32:ys,li=Math.log,ci=Math.LN2;function ys(e){return e>>>=0,e===0?32:31-(li(e)/ci|0)|0}var vs=64,bt=4194304;function Vr(e){switch(e&-e){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return e&4194240;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return e&130023424;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 1073741824;default:return e}}function zn(e,t){var n=e.pendingLanes;if(n===0)return 0;var a=0,c=e.suspendedLanes,y=e.pingedLanes,D=n&268435455;if(D!==0){var K=D&~c;K!==0?a=Vr(K):(y&=D,y!==0&&(a=Vr(y)))}else D=n&~c,D!==0?a=Vr(D):y!==0&&(a=Vr(y));if(a===0)return 0;if(t!==0&&t!==a&&(t&c)===0&&(c=a&-a,y=t&-t,c>=y||c===16&&(y&4194240)!==0))return t;if((a&4)!==0&&(a|=n&16),t=e.entangledLanes,t!==0)for(e=e.entanglements,t&=a;0<t;)n=31-Or(t),c=1<<n,a|=e[n],t&=~c;return a}function Sn(e,t){switch(e){case 1:case 2:case 4:return t+250;case 8:case 16:case 32:case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return t+5e3;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return-1;case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function Ys(e,t){for(var n=e.suspendedLanes,a=e.pingedLanes,c=e.expirationTimes,y=e.pendingLanes;0<y;){var D=31-Or(y),K=1<<D,ne=c[D];ne===-1?((K&n)===0||(K&a)!==0)&&(c[D]=Sn(K,t)):ne<=t&&(e.expiredLanes|=K),y&=~K}}function qn(e){return e=e.pendingLanes&-1073741825,e!==0?e:e&1073741824?1073741824:0}function ws(){var e=vs;return vs<<=1,(vs&4194240)===0&&(vs=64),e}function En(e){for(var t=[],n=0;31>n;n++)t.push(e);return t}function bs(e,t,n){e.pendingLanes|=t,t!==536870912&&(e.suspendedLanes=0,e.pingedLanes=0),e=e.eventTimes,t=31-Or(t),e[t]=n}function ko(e,t){var n=e.pendingLanes&~t;e.pendingLanes=t,e.suspendedLanes=0,e.pingedLanes=0,e.expiredLanes&=t,e.mutableReadLanes&=t,e.entangledLanes&=t,t=e.entanglements;var a=e.eventTimes;for(e=e.expirationTimes;0<n;){var c=31-Or(n),y=1<<c;t[c]=0,a[c]=-1,e[c]=-1,n&=~y}}function Vs(e,t){var n=e.entangledLanes|=t;for(e=e.entanglements;n;){var a=31-Or(n),c=1<<a;c&t|e[a]&t&&(e[a]|=t),n&=~c}}var yt=0;function Sa(e){return e&=-e,1<e?4<e?(e&268435455)!==0?16:536870912:4:1}var Js,ks,ui,Ss,Es,Jr=!1,Bn=[],Jt=null,xr=null,Rr=null,Gn=new Map,_s=new Map,Ye=[],di="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset submit".split(" ");function Ns(e,t){switch(e){case"focusin":case"focusout":Jt=null;break;case"dragenter":case"dragleave":xr=null;break;case"mouseover":case"mouseout":Rr=null;break;case"pointerover":case"pointerout":Gn.delete(t.pointerId);break;case"gotpointercapture":case"lostpointercapture":_s.delete(t.pointerId)}}function un(e,t,n,a,c,y){return e===null||e.nativeEvent!==y?(e={blockedOn:t,domEventName:n,eventSystemFlags:a,nativeEvent:y,targetContainers:[c]},t!==null&&(t=Pa(t),t!==null&&ks(t)),e):(e.eventSystemFlags|=a,t=e.targetContainers,c!==null&&t.indexOf(c)===-1&&t.push(c),e)}function fi(e,t,n,a,c){switch(t){case"focusin":return Jt=un(Jt,e,t,n,a,c),!0;case"dragenter":return xr=un(xr,e,t,n,a,c),!0;case"mouseover":return Rr=un(Rr,e,t,n,a,c),!0;case"pointerover":var y=c.pointerId;return Gn.set(y,un(Gn.get(y)||null,e,t,n,a,c)),!0;case"gotpointercapture":return y=c.pointerId,_s.set(y,un(_s.get(y)||null,e,t,n,a,c)),!0}return!1}function $n(e){var t=Ds(e.target);if(t!==null){var n=Je(t);if(n!==null){if(t=n.tag,t===13){if(t=xt(n),t!==null){e.blockedOn=t,Es(e.priority,function(){ui(n)});return}}else if(t===3&&n.stateNode.current.memoizedState.isDehydrated){e.blockedOn=n.tag===3?n.stateNode.containerInfo:null;return}}}e.blockedOn=null}function dn(e){if(e.blockedOn!==null)return!1;for(var t=e.targetContainers;0<t.length;){var n=st(e.domEventName,e.eventSystemFlags,t[0],e.nativeEvent);if(n===null){n=e.nativeEvent;var a=new n.constructor(n.type,n);tt=a,n.target.dispatchEvent(a),tt=null}else return t=Pa(n),t!==null&&ks(t),e.blockedOn=n,!1;t.shift()}return!0}function Kr(e,t,n){dn(e)&&n.delete(t)}function Ks(){Jr=!1,Jt!==null&&dn(Jt)&&(Jt=null),xr!==null&&dn(xr)&&(xr=null),Rr!==null&&dn(Rr)&&(Rr=null),Gn.forEach(Kr),_s.forEach(Kr)}function Hn(e,t){e.blockedOn===t&&(e.blockedOn=null,Jr||(Jr=!0,p.unstable_scheduleCallback(p.unstable_NormalPriority,Ks)))}function i(e){function t(c){return Hn(c,e)}if(0<Bn.length){Hn(Bn[0],e);for(var n=1;n<Bn.length;n++){var a=Bn[n];a.blockedOn===e&&(a.blockedOn=null)}}for(Jt!==null&&Hn(Jt,e),xr!==null&&Hn(xr,e),Rr!==null&&Hn(Rr,e),Gn.forEach(t),_s.forEach(t),n=0;n<Ye.length;n++)a=Ye[n],a.blockedOn===e&&(a.blockedOn=null);for(;0<Ye.length&&(n=Ye[0],n.blockedOn===null);)$n(n),n.blockedOn===null&&Ye.shift()}var m=R.ReactCurrentBatchConfig,E=!0;function z(e,t,n,a){var c=yt,y=m.transition;m.transition=null;try{yt=1,Ne(e,t,n,a)}finally{yt=c,m.transition=y}}function re(e,t,n,a){var c=yt,y=m.transition;m.transition=null;try{yt=4,Ne(e,t,n,a)}finally{yt=c,m.transition=y}}function Ne(e,t,n,a){if(E){var c=st(e,t,n,a);if(c===null)Qo(e,t,a,De,n),Ns(e,a);else if(fi(c,e,t,n,a))a.stopPropagation();else if(Ns(e,a),t&4&&-1<di.indexOf(e)){for(;c!==null;){var y=Pa(c);if(y!==null&&Js(y),y=st(e,t,n,a),y===null&&Qo(e,t,a,De,n),y===c)break;c=y}c!==null&&a.stopPropagation()}else Qo(e,t,a,null,n)}}var De=null;function st(e,t,n,a){if(De=null,e=Wt(a),e=Ds(e),e!==null)if(t=Je(e),t===null)e=null;else if(n=t.tag,n===13){if(e=xt(t),e!==null)return e;e=null}else if(n===3){if(t.stateNode.current.memoizedState.isDehydrated)return t.tag===3?t.stateNode.containerInfo:null;e=null}else t!==e&&(e=null);return De=e,null}function gt(e){switch(e){case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 1;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"toggle":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 4;case"message":switch(ms()){case Ws:return 1;case ps:return 4;case gs:case Un:return 16;case Qs:return 536870912;default:return 16}default:return 16}}var it=null,Tt=null,At=null;function Ea(){if(At)return At;var e,t=Tt,n=t.length,a,c="value"in it?it.value:it.textContent,y=c.length;for(e=0;e<n&&t[e]===c[e];e++);var D=n-e;for(a=1;a<=D&&t[n-a]===c[y-a];a++);return At=c.slice(e,1<a?1-a:void 0)}function Zs(e){var t=e.keyCode;return"charCode"in e?(e=e.charCode,e===0&&t===13&&(e=13)):e=t,e===10&&(e=13),32<=e||e===13?e:0}function js(){return!0}function hi(){return!1}function cr(e){function t(n,a,c,y,D){this._reactName=n,this._targetInst=c,this.type=a,this.nativeEvent=y,this.target=D,this.currentTarget=null;for(var K in e)e.hasOwnProperty(K)&&(n=e[K],this[K]=n?n(y):y[K]);return this.isDefaultPrevented=(y.defaultPrevented!=null?y.defaultPrevented:y.returnValue===!1)?js:hi,this.isPropagationStopped=hi,this}return B(t.prototype,{preventDefault:function(){this.defaultPrevented=!0;var n=this.nativeEvent;n&&(n.preventDefault?n.preventDefault():typeof n.returnValue!="unknown"&&(n.returnValue=!1),this.isDefaultPrevented=js)},stopPropagation:function(){var n=this.nativeEvent;n&&(n.stopPropagation?n.stopPropagation():typeof n.cancelBubble!="unknown"&&(n.cancelBubble=!0),this.isPropagationStopped=js)},persist:function(){},isPersistent:js}),t}var Wn={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(e){return e.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},_a=cr(Wn),Cs=B({},Wn,{view:0,detail:0}),So=cr(Cs),Na,ja,Is,Xs=B({},Cs,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:ea,button:0,buttons:0,relatedTarget:function(e){return e.relatedTarget===void 0?e.fromElement===e.srcElement?e.toElement:e.fromElement:e.relatedTarget},movementX:function(e){return"movementX"in e?e.movementX:(e!==Is&&(Is&&e.type==="mousemove"?(Na=e.screenX-Is.screenX,ja=e.screenY-Is.screenY):ja=Na=0,Is=e),Na)},movementY:function(e){return"movementY"in e?e.movementY:ja}}),Ca=cr(Xs),Eo=B({},Xs,{dataTransfer:0}),_o=cr(Eo),No=B({},Cs,{relatedTarget:0}),Ia=cr(No),jo=B({},Wn,{animationName:0,elapsedTime:0,pseudoElement:0}),Co=cr(jo),Io=B({},Wn,{clipboardData:function(e){return"clipboardData"in e?e.clipboardData:window.clipboardData}}),mi=cr(Io),To=B({},Wn,{data:0}),pi=cr(To),Do={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},Ao={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},Oo={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function Ro(e){var t=this.nativeEvent;return t.getModifierState?t.getModifierState(e):(e=Oo[e])?!!t[e]:!1}function ea(){return Ro}var Mo=B({},Cs,{key:function(e){if(e.key){var t=Do[e.key]||e.key;if(t!=="Unidentified")return t}return e.type==="keypress"?(e=Zs(e),e===13?"Enter":String.fromCharCode(e)):e.type==="keydown"||e.type==="keyup"?Ao[e.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:ea,charCode:function(e){return e.type==="keypress"?Zs(e):0},keyCode:function(e){return e.type==="keydown"||e.type==="keyup"?e.keyCode:0},which:function(e){return e.type==="keypress"?Zs(e):e.type==="keydown"||e.type==="keyup"?e.keyCode:0}}),Lo=cr(Mo),Fo=B({},Xs,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),Ts=cr(Fo),gi=B({},Cs,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:ea}),xi=cr(gi),we=B({},Wn,{propertyName:0,elapsedTime:0,pseudoElement:0}),Oe=cr(we),Ze=B({},Xs,{deltaX:function(e){return"deltaX"in e?e.deltaX:"wheelDeltaX"in e?-e.wheelDeltaX:0},deltaY:function(e){return"deltaY"in e?e.deltaY:"wheelDeltaY"in e?-e.wheelDeltaY:"wheelDelta"in e?-e.wheelDelta:0},deltaZ:0,deltaMode:0}),ot=cr(Ze),dt=[9,13,27,32],kt=f&&"CompositionEvent"in window,tr=null;f&&"documentMode"in document&&(tr=document.documentMode);var Sr=f&&"TextEvent"in window&&!tr,ur=f&&(!kt||tr&&8<tr&&11>=tr),Er=" ",ta=!1;function fn(e,t){switch(e){case"keyup":return dt.indexOf(t.keyCode)!==-1;case"keydown":return t.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function yi(e){return e=e.detail,typeof e=="object"&&"data"in e?e.data:null}var ra=!1;function Sh(e,t){switch(e){case"compositionend":return yi(t);case"keypress":return t.which!==32?null:(ta=!0,Er);case"textInput":return e=t.data,e===Er&&ta?null:e;default:return null}}function Eh(e,t){if(ra)return e==="compositionend"||!kt&&fn(e,t)?(e=Ea(),At=Tt=it=null,ra=!1,e):null;switch(e){case"paste":return null;case"keypress":if(!(t.ctrlKey||t.altKey||t.metaKey)||t.ctrlKey&&t.altKey){if(t.char&&1<t.char.length)return t.char;if(t.which)return String.fromCharCode(t.which)}return null;case"compositionend":return ur&&t.locale!=="ko"?null:t.data;default:return null}}var _h={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function Mc(e){var t=e&&e.nodeName&&e.nodeName.toLowerCase();return t==="input"?!!_h[e.type]:t==="textarea"}function Lc(e,t,n,a){kr(a),t=Si(t,"onChange"),0<t.length&&(n=new _a("onChange","change",null,n,a),e.push({event:n,listeners:t}))}var Ta=null,Da=null;function Nh(e){eu(e,0)}function vi(e){var t=oa(e);if(te(t))return e}function jh(e,t){if(e==="change")return t}var Fc=!1;if(f){var Po;if(f){var Uo="oninput"in document;if(!Uo){var Pc=document.createElement("div");Pc.setAttribute("oninput","return;"),Uo=typeof Pc.oninput=="function"}Po=Uo}else Po=!1;Fc=Po&&(!document.documentMode||9<document.documentMode)}function Uc(){Ta&&(Ta.detachEvent("onpropertychange",zc),Da=Ta=null)}function zc(e){if(e.propertyName==="value"&&vi(Da)){var t=[];Lc(t,Da,e,Wt(e)),cn(Nh,t)}}function Ch(e,t,n){e==="focusin"?(Uc(),Ta=t,Da=n,Ta.attachEvent("onpropertychange",zc)):e==="focusout"&&Uc()}function Ih(e){if(e==="selectionchange"||e==="keyup"||e==="keydown")return vi(Da)}function Th(e,t){if(e==="click")return vi(t)}function Dh(e,t){if(e==="input"||e==="change")return vi(t)}function Ah(e,t){return e===t&&(e!==0||1/e===1/t)||e!==e&&t!==t}var Zr=typeof Object.is=="function"?Object.is:Ah;function Aa(e,t){if(Zr(e,t))return!0;if(typeof e!="object"||e===null||typeof t!="object"||t===null)return!1;var n=Object.keys(e),a=Object.keys(t);if(n.length!==a.length)return!1;for(a=0;a<n.length;a++){var c=n[a];if(!x.call(t,c)||!Zr(e[c],t[c]))return!1}return!0}function qc(e){for(;e&&e.firstChild;)e=e.firstChild;return e}function Bc(e,t){var n=qc(e);e=0;for(var a;n;){if(n.nodeType===3){if(a=e+n.textContent.length,e<=t&&a>=t)return{node:n,offset:t-e};e=a}e:{for(;n;){if(n.nextSibling){n=n.nextSibling;break e}n=n.parentNode}n=void 0}n=qc(n)}}function Gc(e,t){return e&&t?e===t?!0:e&&e.nodeType===3?!1:t&&t.nodeType===3?Gc(e,t.parentNode):"contains"in e?e.contains(t):e.compareDocumentPosition?!!(e.compareDocumentPosition(t)&16):!1:!1}function $c(){for(var e=window,t=Y();t instanceof e.HTMLIFrameElement;){try{var n=typeof t.contentWindow.location.href=="string"}catch{n=!1}if(n)e=t.contentWindow;else break;t=Y(e.document)}return t}function zo(e){var t=e&&e.nodeName&&e.nodeName.toLowerCase();return t&&(t==="input"&&(e.type==="text"||e.type==="search"||e.type==="tel"||e.type==="url"||e.type==="password")||t==="textarea"||e.contentEditable==="true")}function Oh(e){var t=$c(),n=e.focusedElem,a=e.selectionRange;if(t!==n&&n&&n.ownerDocument&&Gc(n.ownerDocument.documentElement,n)){if(a!==null&&zo(n)){if(t=a.start,e=a.end,e===void 0&&(e=t),"selectionStart"in n)n.selectionStart=t,n.selectionEnd=Math.min(e,n.value.length);else if(e=(t=n.ownerDocument||document)&&t.defaultView||window,e.getSelection){e=e.getSelection();var c=n.textContent.length,y=Math.min(a.start,c);a=a.end===void 0?y:Math.min(a.end,c),!e.extend&&y>a&&(c=a,a=y,y=c),c=Bc(n,y);var D=Bc(n,a);c&&D&&(e.rangeCount!==1||e.anchorNode!==c.node||e.anchorOffset!==c.offset||e.focusNode!==D.node||e.focusOffset!==D.offset)&&(t=t.createRange(),t.setStart(c.node,c.offset),e.removeAllRanges(),y>a?(e.addRange(t),e.extend(D.node,D.offset)):(t.setEnd(D.node,D.offset),e.addRange(t)))}}for(t=[],e=n;e=e.parentNode;)e.nodeType===1&&t.push({element:e,left:e.scrollLeft,top:e.scrollTop});for(typeof n.focus=="function"&&n.focus(),n=0;n<t.length;n++)e=t[n],e.element.scrollLeft=e.left,e.element.scrollTop=e.top}}var Rh=f&&"documentMode"in document&&11>=document.documentMode,na=null,qo=null,Oa=null,Bo=!1;function Hc(e,t,n){var a=n.window===n?n.document:n.nodeType===9?n:n.ownerDocument;Bo||na==null||na!==Y(a)||(a=na,"selectionStart"in a&&zo(a)?a={start:a.selectionStart,end:a.selectionEnd}:(a=(a.ownerDocument&&a.ownerDocument.defaultView||window).getSelection(),a={anchorNode:a.anchorNode,anchorOffset:a.anchorOffset,focusNode:a.focusNode,focusOffset:a.focusOffset}),Oa&&Aa(Oa,a)||(Oa=a,a=Si(qo,"onSelect"),0<a.length&&(t=new _a("onSelect","select",null,t,n),e.push({event:t,listeners:a}),t.target=na)))}function wi(e,t){var n={};return n[e.toLowerCase()]=t.toLowerCase(),n["Webkit"+e]="webkit"+t,n["Moz"+e]="moz"+t,n}var sa={animationend:wi("Animation","AnimationEnd"),animationiteration:wi("Animation","AnimationIteration"),animationstart:wi("Animation","AnimationStart"),transitionend:wi("Transition","TransitionEnd")},Go={},Wc={};f&&(Wc=document.createElement("div").style,"AnimationEvent"in window||(delete sa.animationend.animation,delete sa.animationiteration.animation,delete sa.animationstart.animation),"TransitionEvent"in window||delete sa.transitionend.transition);function bi(e){if(Go[e])return Go[e];if(!sa[e])return e;var t=sa[e],n;for(n in t)if(t.hasOwnProperty(n)&&n in Wc)return Go[e]=t[n];return e}var Qc=bi("animationend"),Yc=bi("animationiteration"),Vc=bi("animationstart"),Jc=bi("transitionend"),Kc=new Map,Zc="abort auxClick cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");function Qn(e,t){Kc.set(e,t),u(t,[e])}for(var $o=0;$o<Zc.length;$o++){var Ho=Zc[$o],Mh=Ho.toLowerCase(),Lh=Ho[0].toUpperCase()+Ho.slice(1);Qn(Mh,"on"+Lh)}Qn(Qc,"onAnimationEnd"),Qn(Yc,"onAnimationIteration"),Qn(Vc,"onAnimationStart"),Qn("dblclick","onDoubleClick"),Qn("focusin","onFocus"),Qn("focusout","onBlur"),Qn(Jc,"onTransitionEnd"),l("onMouseEnter",["mouseout","mouseover"]),l("onMouseLeave",["mouseout","mouseover"]),l("onPointerEnter",["pointerout","pointerover"]),l("onPointerLeave",["pointerout","pointerover"]),u("onChange","change click focusin focusout input keydown keyup selectionchange".split(" ")),u("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" ")),u("onBeforeInput",["compositionend","keypress","textInput","paste"]),u("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" ")),u("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" ")),u("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var Ra="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),Fh=new Set("cancel close invalid load scroll toggle".split(" ").concat(Ra));function Xc(e,t,n){var a=e.type||"unknown-event";e.currentTarget=n,He(a,t,void 0,e),e.currentTarget=null}function eu(e,t){t=(t&4)!==0;for(var n=0;n<e.length;n++){var a=e[n],c=a.event;a=a.listeners;e:{var y=void 0;if(t)for(var D=a.length-1;0<=D;D--){var K=a[D],ne=K.instance,_e=K.currentTarget;if(K=K.listener,ne!==y&&c.isPropagationStopped())break e;Xc(c,K,_e),y=ne}else for(D=0;D<a.length;D++){if(K=a[D],ne=K.instance,_e=K.currentTarget,K=K.listener,ne!==y&&c.isPropagationStopped())break e;Xc(c,K,_e),y=ne}}}if(Dr)throw e=Pn,Dr=!1,Pn=null,e}function _t(e,t){var n=t[Xo];n===void 0&&(n=t[Xo]=new Set);var a=e+"__bubble";n.has(a)||(tu(t,e,2,!1),n.add(a))}function Wo(e,t,n){var a=0;t&&(a|=4),tu(n,e,a,t)}var ki="_reactListening"+Math.random().toString(36).slice(2);function Ma(e){if(!e[ki]){e[ki]=!0,v.forEach(function(n){n!=="selectionchange"&&(Fh.has(n)||Wo(n,!1,e),Wo(n,!0,e))});var t=e.nodeType===9?e:e.ownerDocument;t===null||t[ki]||(t[ki]=!0,Wo("selectionchange",!1,t))}}function tu(e,t,n,a){switch(gt(t)){case 1:var c=z;break;case 4:c=re;break;default:c=Ne}n=c.bind(null,t,n,e),c=void 0,!bn||t!=="touchstart"&&t!=="touchmove"&&t!=="wheel"||(c=!0),a?c!==void 0?e.addEventListener(t,n,{capture:!0,passive:c}):e.addEventListener(t,n,!0):c!==void 0?e.addEventListener(t,n,{passive:c}):e.addEventListener(t,n,!1)}function Qo(e,t,n,a,c){var y=a;if((t&1)===0&&(t&2)===0&&a!==null)e:for(;;){if(a===null)return;var D=a.tag;if(D===3||D===4){var K=a.stateNode.containerInfo;if(K===c||K.nodeType===8&&K.parentNode===c)break;if(D===4)for(D=a.return;D!==null;){var ne=D.tag;if((ne===3||ne===4)&&(ne=D.stateNode.containerInfo,ne===c||ne.nodeType===8&&ne.parentNode===c))return;D=D.return}for(;K!==null;){if(D=Ds(K),D===null)return;if(ne=D.tag,ne===5||ne===6){a=y=D;continue e}K=K.parentNode}}a=a.return}cn(function(){var _e=y,Me=Wt(n),Fe=[];e:{var Re=Kc.get(e);if(Re!==void 0){var Ge=_a,Qe=e;switch(e){case"keypress":if(Zs(n)===0)break e;case"keydown":case"keyup":Ge=Lo;break;case"focusin":Qe="focus",Ge=Ia;break;case"focusout":Qe="blur",Ge=Ia;break;case"beforeblur":case"afterblur":Ge=Ia;break;case"click":if(n.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":Ge=Ca;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":Ge=_o;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":Ge=xi;break;case Qc:case Yc:case Vc:Ge=Co;break;case Jc:Ge=Oe;break;case"scroll":Ge=So;break;case"wheel":Ge=ot;break;case"copy":case"cut":case"paste":Ge=mi;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":Ge=Ts}var Ve=(t&4)!==0,zt=!Ve&&e==="scroll",xe=Ve?Re!==null?Re+"Capture":null:Re;Ve=[];for(var le=_e,ke;le!==null;){ke=le;var Pe=ke.stateNode;if(ke.tag===5&&Pe!==null&&(ke=Pe,xe!==null&&(Pe=Ur(le,xe),Pe!=null&&Ve.push(La(le,Pe,ke)))),zt)break;le=le.return}0<Ve.length&&(Re=new Ge(Re,Qe,null,n,Me),Fe.push({event:Re,listeners:Ve}))}}if((t&7)===0){e:{if(Re=e==="mouseover"||e==="pointerover",Ge=e==="mouseout"||e==="pointerout",Re&&n!==tt&&(Qe=n.relatedTarget||n.fromElement)&&(Ds(Qe)||Qe[_n]))break e;if((Ge||Re)&&(Re=Me.window===Me?Me:(Re=Me.ownerDocument)?Re.defaultView||Re.parentWindow:window,Ge?(Qe=n.relatedTarget||n.toElement,Ge=_e,Qe=Qe?Ds(Qe):null,Qe!==null&&(zt=Je(Qe),Qe!==zt||Qe.tag!==5&&Qe.tag!==6)&&(Qe=null)):(Ge=null,Qe=_e),Ge!==Qe)){if(Ve=Ca,Pe="onMouseLeave",xe="onMouseEnter",le="mouse",(e==="pointerout"||e==="pointerover")&&(Ve=Ts,Pe="onPointerLeave",xe="onPointerEnter",le="pointer"),zt=Ge==null?Re:oa(Ge),ke=Qe==null?Re:oa(Qe),Re=new Ve(Pe,le+"leave",Ge,n,Me),Re.target=zt,Re.relatedTarget=ke,Pe=null,Ds(Me)===_e&&(Ve=new Ve(xe,le+"enter",Qe,n,Me),Ve.target=ke,Ve.relatedTarget=zt,Pe=Ve),zt=Pe,Ge&&Qe)t:{for(Ve=Ge,xe=Qe,le=0,ke=Ve;ke;ke=aa(ke))le++;for(ke=0,Pe=xe;Pe;Pe=aa(Pe))ke++;for(;0<le-ke;)Ve=aa(Ve),le--;for(;0<ke-le;)xe=aa(xe),ke--;for(;le--;){if(Ve===xe||xe!==null&&Ve===xe.alternate)break t;Ve=aa(Ve),xe=aa(xe)}Ve=null}else Ve=null;Ge!==null&&ru(Fe,Re,Ge,Ve,!1),Qe!==null&&zt!==null&&ru(Fe,zt,Qe,Ve,!0)}}e:{if(Re=_e?oa(_e):window,Ge=Re.nodeName&&Re.nodeName.toLowerCase(),Ge==="select"||Ge==="input"&&Re.type==="file")var Xe=jh;else if(Mc(Re))if(Fc)Xe=Dh;else{Xe=Ih;var rt=Ch}else(Ge=Re.nodeName)&&Ge.toLowerCase()==="input"&&(Re.type==="checkbox"||Re.type==="radio")&&(Xe=Th);if(Xe&&(Xe=Xe(e,_e))){Lc(Fe,Xe,n,Me);break e}rt&&rt(e,Re,_e),e==="focusout"&&(rt=Re._wrapperState)&&rt.controlled&&Re.type==="number"&&q(Re,"number",Re.value)}switch(rt=_e?oa(_e):window,e){case"focusin":(Mc(rt)||rt.contentEditable==="true")&&(na=rt,qo=_e,Oa=null);break;case"focusout":Oa=qo=na=null;break;case"mousedown":Bo=!0;break;case"contextmenu":case"mouseup":case"dragend":Bo=!1,Hc(Fe,n,Me);break;case"selectionchange":if(Rh)break;case"keydown":case"keyup":Hc(Fe,n,Me)}var nt;if(kt)e:{switch(e){case"compositionstart":var lt="onCompositionStart";break e;case"compositionend":lt="onCompositionEnd";break e;case"compositionupdate":lt="onCompositionUpdate";break e}lt=void 0}else ra?fn(e,n)&&(lt="onCompositionEnd"):e==="keydown"&&n.keyCode===229&&(lt="onCompositionStart");lt&&(ur&&n.locale!=="ko"&&(ra||lt!=="onCompositionStart"?lt==="onCompositionEnd"&&ra&&(nt=Ea()):(it=Me,Tt="value"in it?it.value:it.textContent,ra=!0)),rt=Si(_e,lt),0<rt.length&&(lt=new pi(lt,e,null,n,Me),Fe.push({event:lt,listeners:rt}),nt?lt.data=nt:(nt=yi(n),nt!==null&&(lt.data=nt)))),(nt=Sr?Sh(e,n):Eh(e,n))&&(_e=Si(_e,"onBeforeInput"),0<_e.length&&(Me=new pi("onBeforeInput","beforeinput",null,n,Me),Fe.push({event:Me,listeners:_e}),Me.data=nt))}eu(Fe,t)})}function La(e,t,n){return{instance:e,listener:t,currentTarget:n}}function Si(e,t){for(var n=t+"Capture",a=[];e!==null;){var c=e,y=c.stateNode;c.tag===5&&y!==null&&(c=y,y=Ur(e,n),y!=null&&a.unshift(La(e,y,c)),y=Ur(e,t),y!=null&&a.push(La(e,y,c))),e=e.return}return a}function aa(e){if(e===null)return null;do e=e.return;while(e&&e.tag!==5);return e||null}function ru(e,t,n,a,c){for(var y=t._reactName,D=[];n!==null&&n!==a;){var K=n,ne=K.alternate,_e=K.stateNode;if(ne!==null&&ne===a)break;K.tag===5&&_e!==null&&(K=_e,c?(ne=Ur(n,y),ne!=null&&D.unshift(La(n,ne,K))):c||(ne=Ur(n,y),ne!=null&&D.push(La(n,ne,K)))),n=n.return}D.length!==0&&e.push({event:t,listeners:D})}var Ph=/\r\n?/g,Uh=/\u0000|\uFFFD/g;function nu(e){return(typeof e=="string"?e:""+e).replace(Ph,`
`).replace(Uh,"")}function Ei(e,t,n){if(t=nu(t),nu(e)!==t&&n)throw Error(o(425))}function _i(){}var Yo=null,Vo=null;function Jo(e,t){return e==="textarea"||e==="noscript"||typeof t.children=="string"||typeof t.children=="number"||typeof t.dangerouslySetInnerHTML=="object"&&t.dangerouslySetInnerHTML!==null&&t.dangerouslySetInnerHTML.__html!=null}var Ko=typeof setTimeout=="function"?setTimeout:void 0,zh=typeof clearTimeout=="function"?clearTimeout:void 0,su=typeof Promise=="function"?Promise:void 0,qh=typeof queueMicrotask=="function"?queueMicrotask:typeof su<"u"?function(e){return su.resolve(null).then(e).catch(Bh)}:Ko;function Bh(e){setTimeout(function(){throw e})}function Zo(e,t){var n=t,a=0;do{var c=n.nextSibling;if(e.removeChild(n),c&&c.nodeType===8)if(n=c.data,n==="/$"){if(a===0){e.removeChild(c),i(t);return}a--}else n!=="$"&&n!=="$?"&&n!=="$!"||a++;n=c}while(n);i(t)}function Yn(e){for(;e!=null;e=e.nextSibling){var t=e.nodeType;if(t===1||t===3)break;if(t===8){if(t=e.data,t==="$"||t==="$!"||t==="$?")break;if(t==="/$")return null}}return e}function au(e){e=e.previousSibling;for(var t=0;e;){if(e.nodeType===8){var n=e.data;if(n==="$"||n==="$!"||n==="$?"){if(t===0)return e;t--}else n==="/$"&&t++}e=e.previousSibling}return null}var ia=Math.random().toString(36).slice(2),hn="__reactFiber$"+ia,Fa="__reactProps$"+ia,_n="__reactContainer$"+ia,Xo="__reactEvents$"+ia,Gh="__reactListeners$"+ia,$h="__reactHandles$"+ia;function Ds(e){var t=e[hn];if(t)return t;for(var n=e.parentNode;n;){if(t=n[_n]||n[hn]){if(n=t.alternate,t.child!==null||n!==null&&n.child!==null)for(e=au(e);e!==null;){if(n=e[hn])return n;e=au(e)}return t}e=n,n=e.parentNode}return null}function Pa(e){return e=e[hn]||e[_n],!e||e.tag!==5&&e.tag!==6&&e.tag!==13&&e.tag!==3?null:e}function oa(e){if(e.tag===5||e.tag===6)return e.stateNode;throw Error(o(33))}function Ni(e){return e[Fa]||null}var el=[],la=-1;function Vn(e){return{current:e}}function Nt(e){0>la||(e.current=el[la],el[la]=null,la--)}function St(e,t){la++,el[la]=e.current,e.current=t}var Jn={},dr=Vn(Jn),_r=Vn(!1),As=Jn;function ca(e,t){var n=e.type.contextTypes;if(!n)return Jn;var a=e.stateNode;if(a&&a.__reactInternalMemoizedUnmaskedChildContext===t)return a.__reactInternalMemoizedMaskedChildContext;var c={},y;for(y in n)c[y]=t[y];return a&&(e=e.stateNode,e.__reactInternalMemoizedUnmaskedChildContext=t,e.__reactInternalMemoizedMaskedChildContext=c),c}function Nr(e){return e=e.childContextTypes,e!=null}function ji(){Nt(_r),Nt(dr)}function iu(e,t,n){if(dr.current!==Jn)throw Error(o(168));St(dr,t),St(_r,n)}function ou(e,t,n){var a=e.stateNode;if(t=t.childContextTypes,typeof a.getChildContext!="function")return n;a=a.getChildContext();for(var c in a)if(!(c in t))throw Error(o(108,he(e)||"Unknown",c));return B({},n,a)}function Ci(e){return e=(e=e.stateNode)&&e.__reactInternalMemoizedMergedChildContext||Jn,As=dr.current,St(dr,e),St(_r,_r.current),!0}function lu(e,t,n){var a=e.stateNode;if(!a)throw Error(o(169));n?(e=ou(e,t,As),a.__reactInternalMemoizedMergedChildContext=e,Nt(_r),Nt(dr),St(dr,e)):Nt(_r),St(_r,n)}var Nn=null,Ii=!1,tl=!1;function cu(e){Nn===null?Nn=[e]:Nn.push(e)}function Hh(e){Ii=!0,cu(e)}function Kn(){if(!tl&&Nn!==null){tl=!0;var e=0,t=yt;try{var n=Nn;for(yt=1;e<n.length;e++){var a=n[e];do a=a(!0);while(a!==null)}Nn=null,Ii=!1}catch(c){throw Nn!==null&&(Nn=Nn.slice(e+1)),Gt(Ws,Kn),c}finally{yt=t,tl=!1}}return null}var ua=[],da=0,Ti=null,Di=0,qr=[],Br=0,Os=null,jn=1,Cn="";function Rs(e,t){ua[da++]=Di,ua[da++]=Ti,Ti=e,Di=t}function uu(e,t,n){qr[Br++]=jn,qr[Br++]=Cn,qr[Br++]=Os,Os=e;var a=jn;e=Cn;var c=32-Or(a)-1;a&=~(1<<c),n+=1;var y=32-Or(t)+c;if(30<y){var D=c-c%5;y=(a&(1<<D)-1).toString(32),a>>=D,c-=D,jn=1<<32-Or(t)+c|n<<c|a,Cn=y+e}else jn=1<<y|n<<c|a,Cn=e}function rl(e){e.return!==null&&(Rs(e,1),uu(e,1,0))}function nl(e){for(;e===Ti;)Ti=ua[--da],ua[da]=null,Di=ua[--da],ua[da]=null;for(;e===Os;)Os=qr[--Br],qr[Br]=null,Cn=qr[--Br],qr[Br]=null,jn=qr[--Br],qr[Br]=null}var Mr=null,Lr=null,Dt=!1,Xr=null;function du(e,t){var n=Wr(5,null,null,0);n.elementType="DELETED",n.stateNode=t,n.return=e,t=e.deletions,t===null?(e.deletions=[n],e.flags|=16):t.push(n)}function fu(e,t){switch(e.tag){case 5:var n=e.type;return t=t.nodeType!==1||n.toLowerCase()!==t.nodeName.toLowerCase()?null:t,t!==null?(e.stateNode=t,Mr=e,Lr=Yn(t.firstChild),!0):!1;case 6:return t=e.pendingProps===""||t.nodeType!==3?null:t,t!==null?(e.stateNode=t,Mr=e,Lr=null,!0):!1;case 13:return t=t.nodeType!==8?null:t,t!==null?(n=Os!==null?{id:jn,overflow:Cn}:null,e.memoizedState={dehydrated:t,treeContext:n,retryLane:1073741824},n=Wr(18,null,null,0),n.stateNode=t,n.return=e,e.child=n,Mr=e,Lr=null,!0):!1;default:return!1}}function sl(e){return(e.mode&1)!==0&&(e.flags&128)===0}function al(e){if(Dt){var t=Lr;if(t){var n=t;if(!fu(e,t)){if(sl(e))throw Error(o(418));t=Yn(n.nextSibling);var a=Mr;t&&fu(e,t)?du(a,n):(e.flags=e.flags&-4097|2,Dt=!1,Mr=e)}}else{if(sl(e))throw Error(o(418));e.flags=e.flags&-4097|2,Dt=!1,Mr=e}}}function hu(e){for(e=e.return;e!==null&&e.tag!==5&&e.tag!==3&&e.tag!==13;)e=e.return;Mr=e}function Ai(e){if(e!==Mr)return!1;if(!Dt)return hu(e),Dt=!0,!1;var t;if((t=e.tag!==3)&&!(t=e.tag!==5)&&(t=e.type,t=t!=="head"&&t!=="body"&&!Jo(e.type,e.memoizedProps)),t&&(t=Lr)){if(sl(e))throw mu(),Error(o(418));for(;t;)du(e,t),t=Yn(t.nextSibling)}if(hu(e),e.tag===13){if(e=e.memoizedState,e=e!==null?e.dehydrated:null,!e)throw Error(o(317));e:{for(e=e.nextSibling,t=0;e;){if(e.nodeType===8){var n=e.data;if(n==="/$"){if(t===0){Lr=Yn(e.nextSibling);break e}t--}else n!=="$"&&n!=="$!"&&n!=="$?"||t++}e=e.nextSibling}Lr=null}}else Lr=Mr?Yn(e.stateNode.nextSibling):null;return!0}function mu(){for(var e=Lr;e;)e=Yn(e.nextSibling)}function fa(){Lr=Mr=null,Dt=!1}function il(e){Xr===null?Xr=[e]:Xr.push(e)}var Wh=R.ReactCurrentBatchConfig;function Ua(e,t,n){if(e=n.ref,e!==null&&typeof e!="function"&&typeof e!="object"){if(n._owner){if(n=n._owner,n){if(n.tag!==1)throw Error(o(309));var a=n.stateNode}if(!a)throw Error(o(147,e));var c=a,y=""+e;return t!==null&&t.ref!==null&&typeof t.ref=="function"&&t.ref._stringRef===y?t.ref:(t=function(D){var K=c.refs;D===null?delete K[y]:K[y]=D},t._stringRef=y,t)}if(typeof e!="string")throw Error(o(284));if(!n._owner)throw Error(o(290,e))}return e}function Oi(e,t){throw e=Object.prototype.toString.call(t),Error(o(31,e==="[object Object]"?"object with keys {"+Object.keys(t).join(", ")+"}":e))}function pu(e){var t=e._init;return t(e._payload)}function gu(e){function t(xe,le){if(e){var ke=xe.deletions;ke===null?(xe.deletions=[le],xe.flags|=16):ke.push(le)}}function n(xe,le){if(!e)return null;for(;le!==null;)t(xe,le),le=le.sibling;return null}function a(xe,le){for(xe=new Map;le!==null;)le.key!==null?xe.set(le.key,le):xe.set(le.index,le),le=le.sibling;return xe}function c(xe,le){return xe=as(xe,le),xe.index=0,xe.sibling=null,xe}function y(xe,le,ke){return xe.index=ke,e?(ke=xe.alternate,ke!==null?(ke=ke.index,ke<le?(xe.flags|=2,le):ke):(xe.flags|=2,le)):(xe.flags|=1048576,le)}function D(xe){return e&&xe.alternate===null&&(xe.flags|=2),xe}function K(xe,le,ke,Pe){return le===null||le.tag!==6?(le=Kl(ke,xe.mode,Pe),le.return=xe,le):(le=c(le,ke),le.return=xe,le)}function ne(xe,le,ke,Pe){var Xe=ke.type;return Xe===V?Me(xe,le,ke.props.children,Pe,ke.key):le!==null&&(le.elementType===Xe||typeof Xe=="object"&&Xe!==null&&Xe.$$typeof===be&&pu(Xe)===le.type)?(Pe=c(le,ke.props),Pe.ref=Ua(xe,le,ke),Pe.return=xe,Pe):(Pe=no(ke.type,ke.key,ke.props,null,xe.mode,Pe),Pe.ref=Ua(xe,le,ke),Pe.return=xe,Pe)}function _e(xe,le,ke,Pe){return le===null||le.tag!==4||le.stateNode.containerInfo!==ke.containerInfo||le.stateNode.implementation!==ke.implementation?(le=Zl(ke,xe.mode,Pe),le.return=xe,le):(le=c(le,ke.children||[]),le.return=xe,le)}function Me(xe,le,ke,Pe,Xe){return le===null||le.tag!==7?(le=Bs(ke,xe.mode,Pe,Xe),le.return=xe,le):(le=c(le,ke),le.return=xe,le)}function Fe(xe,le,ke){if(typeof le=="string"&&le!==""||typeof le=="number")return le=Kl(""+le,xe.mode,ke),le.return=xe,le;if(typeof le=="object"&&le!==null){switch(le.$$typeof){case M:return ke=no(le.type,le.key,le.props,null,xe.mode,ke),ke.ref=Ua(xe,null,le),ke.return=xe,ke;case H:return le=Zl(le,xe.mode,ke),le.return=xe,le;case be:var Pe=le._init;return Fe(xe,Pe(le._payload),ke)}if(X(le)||fe(le))return le=Bs(le,xe.mode,ke,null),le.return=xe,le;Oi(xe,le)}return null}function Re(xe,le,ke,Pe){var Xe=le!==null?le.key:null;if(typeof ke=="string"&&ke!==""||typeof ke=="number")return Xe!==null?null:K(xe,le,""+ke,Pe);if(typeof ke=="object"&&ke!==null){switch(ke.$$typeof){case M:return ke.key===Xe?ne(xe,le,ke,Pe):null;case H:return ke.key===Xe?_e(xe,le,ke,Pe):null;case be:return Xe=ke._init,Re(xe,le,Xe(ke._payload),Pe)}if(X(ke)||fe(ke))return Xe!==null?null:Me(xe,le,ke,Pe,null);Oi(xe,ke)}return null}function Ge(xe,le,ke,Pe,Xe){if(typeof Pe=="string"&&Pe!==""||typeof Pe=="number")return xe=xe.get(ke)||null,K(le,xe,""+Pe,Xe);if(typeof Pe=="object"&&Pe!==null){switch(Pe.$$typeof){case M:return xe=xe.get(Pe.key===null?ke:Pe.key)||null,ne(le,xe,Pe,Xe);case H:return xe=xe.get(Pe.key===null?ke:Pe.key)||null,_e(le,xe,Pe,Xe);case be:var rt=Pe._init;return Ge(xe,le,ke,rt(Pe._payload),Xe)}if(X(Pe)||fe(Pe))return xe=xe.get(ke)||null,Me(le,xe,Pe,Xe,null);Oi(le,Pe)}return null}function Qe(xe,le,ke,Pe){for(var Xe=null,rt=null,nt=le,lt=le=0,Xt=null;nt!==null&&lt<ke.length;lt++){nt.index>lt?(Xt=nt,nt=null):Xt=nt.sibling;var wt=Re(xe,nt,ke[lt],Pe);if(wt===null){nt===null&&(nt=Xt);break}e&&nt&&wt.alternate===null&&t(xe,nt),le=y(wt,le,lt),rt===null?Xe=wt:rt.sibling=wt,rt=wt,nt=Xt}if(lt===ke.length)return n(xe,nt),Dt&&Rs(xe,lt),Xe;if(nt===null){for(;lt<ke.length;lt++)nt=Fe(xe,ke[lt],Pe),nt!==null&&(le=y(nt,le,lt),rt===null?Xe=nt:rt.sibling=nt,rt=nt);return Dt&&Rs(xe,lt),Xe}for(nt=a(xe,nt);lt<ke.length;lt++)Xt=Ge(nt,xe,lt,ke[lt],Pe),Xt!==null&&(e&&Xt.alternate!==null&&nt.delete(Xt.key===null?lt:Xt.key),le=y(Xt,le,lt),rt===null?Xe=Xt:rt.sibling=Xt,rt=Xt);return e&&nt.forEach(function(is){return t(xe,is)}),Dt&&Rs(xe,lt),Xe}function Ve(xe,le,ke,Pe){var Xe=fe(ke);if(typeof Xe!="function")throw Error(o(150));if(ke=Xe.call(ke),ke==null)throw Error(o(151));for(var rt=Xe=null,nt=le,lt=le=0,Xt=null,wt=ke.next();nt!==null&&!wt.done;lt++,wt=ke.next()){nt.index>lt?(Xt=nt,nt=null):Xt=nt.sibling;var is=Re(xe,nt,wt.value,Pe);if(is===null){nt===null&&(nt=Xt);break}e&&nt&&is.alternate===null&&t(xe,nt),le=y(is,le,lt),rt===null?Xe=is:rt.sibling=is,rt=is,nt=Xt}if(wt.done)return n(xe,nt),Dt&&Rs(xe,lt),Xe;if(nt===null){for(;!wt.done;lt++,wt=ke.next())wt=Fe(xe,wt.value,Pe),wt!==null&&(le=y(wt,le,lt),rt===null?Xe=wt:rt.sibling=wt,rt=wt);return Dt&&Rs(xe,lt),Xe}for(nt=a(xe,nt);!wt.done;lt++,wt=ke.next())wt=Ge(nt,xe,lt,wt.value,Pe),wt!==null&&(e&&wt.alternate!==null&&nt.delete(wt.key===null?lt:wt.key),le=y(wt,le,lt),rt===null?Xe=wt:rt.sibling=wt,rt=wt);return e&&nt.forEach(function(_m){return t(xe,_m)}),Dt&&Rs(xe,lt),Xe}function zt(xe,le,ke,Pe){if(typeof ke=="object"&&ke!==null&&ke.type===V&&ke.key===null&&(ke=ke.props.children),typeof ke=="object"&&ke!==null){switch(ke.$$typeof){case M:e:{for(var Xe=ke.key,rt=le;rt!==null;){if(rt.key===Xe){if(Xe=ke.type,Xe===V){if(rt.tag===7){n(xe,rt.sibling),le=c(rt,ke.props.children),le.return=xe,xe=le;break e}}else if(rt.elementType===Xe||typeof Xe=="object"&&Xe!==null&&Xe.$$typeof===be&&pu(Xe)===rt.type){n(xe,rt.sibling),le=c(rt,ke.props),le.ref=Ua(xe,rt,ke),le.return=xe,xe=le;break e}n(xe,rt);break}else t(xe,rt);rt=rt.sibling}ke.type===V?(le=Bs(ke.props.children,xe.mode,Pe,ke.key),le.return=xe,xe=le):(Pe=no(ke.type,ke.key,ke.props,null,xe.mode,Pe),Pe.ref=Ua(xe,le,ke),Pe.return=xe,xe=Pe)}return D(xe);case H:e:{for(rt=ke.key;le!==null;){if(le.key===rt)if(le.tag===4&&le.stateNode.containerInfo===ke.containerInfo&&le.stateNode.implementation===ke.implementation){n(xe,le.sibling),le=c(le,ke.children||[]),le.return=xe,xe=le;break e}else{n(xe,le);break}else t(xe,le);le=le.sibling}le=Zl(ke,xe.mode,Pe),le.return=xe,xe=le}return D(xe);case be:return rt=ke._init,zt(xe,le,rt(ke._payload),Pe)}if(X(ke))return Qe(xe,le,ke,Pe);if(fe(ke))return Ve(xe,le,ke,Pe);Oi(xe,ke)}return typeof ke=="string"&&ke!==""||typeof ke=="number"?(ke=""+ke,le!==null&&le.tag===6?(n(xe,le.sibling),le=c(le,ke),le.return=xe,xe=le):(n(xe,le),le=Kl(ke,xe.mode,Pe),le.return=xe,xe=le),D(xe)):n(xe,le)}return zt}var ha=gu(!0),xu=gu(!1),Ri=Vn(null),Mi=null,ma=null,ol=null;function ll(){ol=ma=Mi=null}function cl(e){var t=Ri.current;Nt(Ri),e._currentValue=t}function ul(e,t,n){for(;e!==null;){var a=e.alternate;if((e.childLanes&t)!==t?(e.childLanes|=t,a!==null&&(a.childLanes|=t)):a!==null&&(a.childLanes&t)!==t&&(a.childLanes|=t),e===n)break;e=e.return}}function pa(e,t){Mi=e,ol=ma=null,e=e.dependencies,e!==null&&e.firstContext!==null&&((e.lanes&t)!==0&&(jr=!0),e.firstContext=null)}function Gr(e){var t=e._currentValue;if(ol!==e)if(e={context:e,memoizedValue:t,next:null},ma===null){if(Mi===null)throw Error(o(308));ma=e,Mi.dependencies={lanes:0,firstContext:e}}else ma=ma.next=e;return t}var Ms=null;function dl(e){Ms===null?Ms=[e]:Ms.push(e)}function yu(e,t,n,a){var c=t.interleaved;return c===null?(n.next=n,dl(t)):(n.next=c.next,c.next=n),t.interleaved=n,In(e,a)}function In(e,t){e.lanes|=t;var n=e.alternate;for(n!==null&&(n.lanes|=t),n=e,e=e.return;e!==null;)e.childLanes|=t,n=e.alternate,n!==null&&(n.childLanes|=t),n=e,e=e.return;return n.tag===3?n.stateNode:null}var Zn=!1;function fl(e){e.updateQueue={baseState:e.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,interleaved:null,lanes:0},effects:null}}function vu(e,t){e=e.updateQueue,t.updateQueue===e&&(t.updateQueue={baseState:e.baseState,firstBaseUpdate:e.firstBaseUpdate,lastBaseUpdate:e.lastBaseUpdate,shared:e.shared,effects:e.effects})}function Tn(e,t){return{eventTime:e,lane:t,tag:0,payload:null,callback:null,next:null}}function Xn(e,t,n){var a=e.updateQueue;if(a===null)return null;if(a=a.shared,(vt&2)!==0){var c=a.pending;return c===null?t.next=t:(t.next=c.next,c.next=t),a.pending=t,In(e,n)}return c=a.interleaved,c===null?(t.next=t,dl(a)):(t.next=c.next,c.next=t),a.interleaved=t,In(e,n)}function Li(e,t,n){if(t=t.updateQueue,t!==null&&(t=t.shared,(n&4194240)!==0)){var a=t.lanes;a&=e.pendingLanes,n|=a,t.lanes=n,Vs(e,n)}}function wu(e,t){var n=e.updateQueue,a=e.alternate;if(a!==null&&(a=a.updateQueue,n===a)){var c=null,y=null;if(n=n.firstBaseUpdate,n!==null){do{var D={eventTime:n.eventTime,lane:n.lane,tag:n.tag,payload:n.payload,callback:n.callback,next:null};y===null?c=y=D:y=y.next=D,n=n.next}while(n!==null);y===null?c=y=t:y=y.next=t}else c=y=t;n={baseState:a.baseState,firstBaseUpdate:c,lastBaseUpdate:y,shared:a.shared,effects:a.effects},e.updateQueue=n;return}e=n.lastBaseUpdate,e===null?n.firstBaseUpdate=t:e.next=t,n.lastBaseUpdate=t}function Fi(e,t,n,a){var c=e.updateQueue;Zn=!1;var y=c.firstBaseUpdate,D=c.lastBaseUpdate,K=c.shared.pending;if(K!==null){c.shared.pending=null;var ne=K,_e=ne.next;ne.next=null,D===null?y=_e:D.next=_e,D=ne;var Me=e.alternate;Me!==null&&(Me=Me.updateQueue,K=Me.lastBaseUpdate,K!==D&&(K===null?Me.firstBaseUpdate=_e:K.next=_e,Me.lastBaseUpdate=ne))}if(y!==null){var Fe=c.baseState;D=0,Me=_e=ne=null,K=y;do{var Re=K.lane,Ge=K.eventTime;if((a&Re)===Re){Me!==null&&(Me=Me.next={eventTime:Ge,lane:0,tag:K.tag,payload:K.payload,callback:K.callback,next:null});e:{var Qe=e,Ve=K;switch(Re=t,Ge=n,Ve.tag){case 1:if(Qe=Ve.payload,typeof Qe=="function"){Fe=Qe.call(Ge,Fe,Re);break e}Fe=Qe;break e;case 3:Qe.flags=Qe.flags&-65537|128;case 0:if(Qe=Ve.payload,Re=typeof Qe=="function"?Qe.call(Ge,Fe,Re):Qe,Re==null)break e;Fe=B({},Fe,Re);break e;case 2:Zn=!0}}K.callback!==null&&K.lane!==0&&(e.flags|=64,Re=c.effects,Re===null?c.effects=[K]:Re.push(K))}else Ge={eventTime:Ge,lane:Re,tag:K.tag,payload:K.payload,callback:K.callback,next:null},Me===null?(_e=Me=Ge,ne=Fe):Me=Me.next=Ge,D|=Re;if(K=K.next,K===null){if(K=c.shared.pending,K===null)break;Re=K,K=Re.next,Re.next=null,c.lastBaseUpdate=Re,c.shared.pending=null}}while(!0);if(Me===null&&(ne=Fe),c.baseState=ne,c.firstBaseUpdate=_e,c.lastBaseUpdate=Me,t=c.shared.interleaved,t!==null){c=t;do D|=c.lane,c=c.next;while(c!==t)}else y===null&&(c.shared.lanes=0);Ps|=D,e.lanes=D,e.memoizedState=Fe}}function bu(e,t,n){if(e=t.effects,t.effects=null,e!==null)for(t=0;t<e.length;t++){var a=e[t],c=a.callback;if(c!==null){if(a.callback=null,a=n,typeof c!="function")throw Error(o(191,c));c.call(a)}}}var za={},mn=Vn(za),qa=Vn(za),Ba=Vn(za);function Ls(e){if(e===za)throw Error(o(174));return e}function hl(e,t){switch(St(Ba,t),St(qa,e),St(mn,za),e=t.nodeType,e){case 9:case 11:t=(t=t.documentElement)?t.namespaceURI:Be(null,"");break;default:e=e===8?t.parentNode:t,t=e.namespaceURI||null,e=e.tagName,t=Be(t,e)}Nt(mn),St(mn,t)}function ga(){Nt(mn),Nt(qa),Nt(Ba)}function ku(e){Ls(Ba.current);var t=Ls(mn.current),n=Be(t,e.type);t!==n&&(St(qa,e),St(mn,n))}function ml(e){qa.current===e&&(Nt(mn),Nt(qa))}var Ot=Vn(0);function Pi(e){for(var t=e;t!==null;){if(t.tag===13){var n=t.memoizedState;if(n!==null&&(n=n.dehydrated,n===null||n.data==="$?"||n.data==="$!"))return t}else if(t.tag===19&&t.memoizedProps.revealOrder!==void 0){if((t.flags&128)!==0)return t}else if(t.child!==null){t.child.return=t,t=t.child;continue}if(t===e)break;for(;t.sibling===null;){if(t.return===null||t.return===e)return null;t=t.return}t.sibling.return=t.return,t=t.sibling}return null}var pl=[];function gl(){for(var e=0;e<pl.length;e++)pl[e]._workInProgressVersionPrimary=null;pl.length=0}var Ui=R.ReactCurrentDispatcher,xl=R.ReactCurrentBatchConfig,Fs=0,Rt=null,Qt=null,Kt=null,zi=!1,Ga=!1,$a=0,Qh=0;function fr(){throw Error(o(321))}function yl(e,t){if(t===null)return!1;for(var n=0;n<t.length&&n<e.length;n++)if(!Zr(e[n],t[n]))return!1;return!0}function vl(e,t,n,a,c,y){if(Fs=y,Rt=t,t.memoizedState=null,t.updateQueue=null,t.lanes=0,Ui.current=e===null||e.memoizedState===null?Kh:Zh,e=n(a,c),Ga){y=0;do{if(Ga=!1,$a=0,25<=y)throw Error(o(301));y+=1,Kt=Qt=null,t.updateQueue=null,Ui.current=Xh,e=n(a,c)}while(Ga)}if(Ui.current=Gi,t=Qt!==null&&Qt.next!==null,Fs=0,Kt=Qt=Rt=null,zi=!1,t)throw Error(o(300));return e}function wl(){var e=$a!==0;return $a=0,e}function pn(){var e={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return Kt===null?Rt.memoizedState=Kt=e:Kt=Kt.next=e,Kt}function $r(){if(Qt===null){var e=Rt.alternate;e=e!==null?e.memoizedState:null}else e=Qt.next;var t=Kt===null?Rt.memoizedState:Kt.next;if(t!==null)Kt=t,Qt=e;else{if(e===null)throw Error(o(310));Qt=e,e={memoizedState:Qt.memoizedState,baseState:Qt.baseState,baseQueue:Qt.baseQueue,queue:Qt.queue,next:null},Kt===null?Rt.memoizedState=Kt=e:Kt=Kt.next=e}return Kt}function Ha(e,t){return typeof t=="function"?t(e):t}function bl(e){var t=$r(),n=t.queue;if(n===null)throw Error(o(311));n.lastRenderedReducer=e;var a=Qt,c=a.baseQueue,y=n.pending;if(y!==null){if(c!==null){var D=c.next;c.next=y.next,y.next=D}a.baseQueue=c=y,n.pending=null}if(c!==null){y=c.next,a=a.baseState;var K=D=null,ne=null,_e=y;do{var Me=_e.lane;if((Fs&Me)===Me)ne!==null&&(ne=ne.next={lane:0,action:_e.action,hasEagerState:_e.hasEagerState,eagerState:_e.eagerState,next:null}),a=_e.hasEagerState?_e.eagerState:e(a,_e.action);else{var Fe={lane:Me,action:_e.action,hasEagerState:_e.hasEagerState,eagerState:_e.eagerState,next:null};ne===null?(K=ne=Fe,D=a):ne=ne.next=Fe,Rt.lanes|=Me,Ps|=Me}_e=_e.next}while(_e!==null&&_e!==y);ne===null?D=a:ne.next=K,Zr(a,t.memoizedState)||(jr=!0),t.memoizedState=a,t.baseState=D,t.baseQueue=ne,n.lastRenderedState=a}if(e=n.interleaved,e!==null){c=e;do y=c.lane,Rt.lanes|=y,Ps|=y,c=c.next;while(c!==e)}else c===null&&(n.lanes=0);return[t.memoizedState,n.dispatch]}function kl(e){var t=$r(),n=t.queue;if(n===null)throw Error(o(311));n.lastRenderedReducer=e;var a=n.dispatch,c=n.pending,y=t.memoizedState;if(c!==null){n.pending=null;var D=c=c.next;do y=e(y,D.action),D=D.next;while(D!==c);Zr(y,t.memoizedState)||(jr=!0),t.memoizedState=y,t.baseQueue===null&&(t.baseState=y),n.lastRenderedState=y}return[y,a]}function Su(){}function Eu(e,t){var n=Rt,a=$r(),c=t(),y=!Zr(a.memoizedState,c);if(y&&(a.memoizedState=c,jr=!0),a=a.queue,Sl(ju.bind(null,n,a,e),[e]),a.getSnapshot!==t||y||Kt!==null&&Kt.memoizedState.tag&1){if(n.flags|=2048,Wa(9,Nu.bind(null,n,a,c,t),void 0,null),Zt===null)throw Error(o(349));(Fs&30)!==0||_u(n,t,c)}return c}function _u(e,t,n){e.flags|=16384,e={getSnapshot:t,value:n},t=Rt.updateQueue,t===null?(t={lastEffect:null,stores:null},Rt.updateQueue=t,t.stores=[e]):(n=t.stores,n===null?t.stores=[e]:n.push(e))}function Nu(e,t,n,a){t.value=n,t.getSnapshot=a,Cu(t)&&Iu(e)}function ju(e,t,n){return n(function(){Cu(t)&&Iu(e)})}function Cu(e){var t=e.getSnapshot;e=e.value;try{var n=t();return!Zr(e,n)}catch{return!0}}function Iu(e){var t=In(e,1);t!==null&&nn(t,e,1,-1)}function Tu(e){var t=pn();return typeof e=="function"&&(e=e()),t.memoizedState=t.baseState=e,e={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:Ha,lastRenderedState:e},t.queue=e,e=e.dispatch=Jh.bind(null,Rt,e),[t.memoizedState,e]}function Wa(e,t,n,a){return e={tag:e,create:t,destroy:n,deps:a,next:null},t=Rt.updateQueue,t===null?(t={lastEffect:null,stores:null},Rt.updateQueue=t,t.lastEffect=e.next=e):(n=t.lastEffect,n===null?t.lastEffect=e.next=e:(a=n.next,n.next=e,e.next=a,t.lastEffect=e)),e}function Du(){return $r().memoizedState}function qi(e,t,n,a){var c=pn();Rt.flags|=e,c.memoizedState=Wa(1|t,n,void 0,a===void 0?null:a)}function Bi(e,t,n,a){var c=$r();a=a===void 0?null:a;var y=void 0;if(Qt!==null){var D=Qt.memoizedState;if(y=D.destroy,a!==null&&yl(a,D.deps)){c.memoizedState=Wa(t,n,y,a);return}}Rt.flags|=e,c.memoizedState=Wa(1|t,n,y,a)}function Au(e,t){return qi(8390656,8,e,t)}function Sl(e,t){return Bi(2048,8,e,t)}function Ou(e,t){return Bi(4,2,e,t)}function Ru(e,t){return Bi(4,4,e,t)}function Mu(e,t){if(typeof t=="function")return e=e(),t(e),function(){t(null)};if(t!=null)return e=e(),t.current=e,function(){t.current=null}}function Lu(e,t,n){return n=n!=null?n.concat([e]):null,Bi(4,4,Mu.bind(null,t,e),n)}function El(){}function Fu(e,t){var n=$r();t=t===void 0?null:t;var a=n.memoizedState;return a!==null&&t!==null&&yl(t,a[1])?a[0]:(n.memoizedState=[e,t],e)}function Pu(e,t){var n=$r();t=t===void 0?null:t;var a=n.memoizedState;return a!==null&&t!==null&&yl(t,a[1])?a[0]:(e=e(),n.memoizedState=[e,t],e)}function Uu(e,t,n){return(Fs&21)===0?(e.baseState&&(e.baseState=!1,jr=!0),e.memoizedState=n):(Zr(n,t)||(n=ws(),Rt.lanes|=n,Ps|=n,e.baseState=!0),t)}function Yh(e,t){var n=yt;yt=n!==0&&4>n?n:4,e(!0);var a=xl.transition;xl.transition={};try{e(!1),t()}finally{yt=n,xl.transition=a}}function zu(){return $r().memoizedState}function Vh(e,t,n){var a=ns(e);if(n={lane:a,action:n,hasEagerState:!1,eagerState:null,next:null},qu(e))Bu(t,n);else if(n=yu(e,t,n,a),n!==null){var c=vr();nn(n,e,a,c),Gu(n,t,a)}}function Jh(e,t,n){var a=ns(e),c={lane:a,action:n,hasEagerState:!1,eagerState:null,next:null};if(qu(e))Bu(t,c);else{var y=e.alternate;if(e.lanes===0&&(y===null||y.lanes===0)&&(y=t.lastRenderedReducer,y!==null))try{var D=t.lastRenderedState,K=y(D,n);if(c.hasEagerState=!0,c.eagerState=K,Zr(K,D)){var ne=t.interleaved;ne===null?(c.next=c,dl(t)):(c.next=ne.next,ne.next=c),t.interleaved=c;return}}catch{}finally{}n=yu(e,t,c,a),n!==null&&(c=vr(),nn(n,e,a,c),Gu(n,t,a))}}function qu(e){var t=e.alternate;return e===Rt||t!==null&&t===Rt}function Bu(e,t){Ga=zi=!0;var n=e.pending;n===null?t.next=t:(t.next=n.next,n.next=t),e.pending=t}function Gu(e,t,n){if((n&4194240)!==0){var a=t.lanes;a&=e.pendingLanes,n|=a,t.lanes=n,Vs(e,n)}}var Gi={readContext:Gr,useCallback:fr,useContext:fr,useEffect:fr,useImperativeHandle:fr,useInsertionEffect:fr,useLayoutEffect:fr,useMemo:fr,useReducer:fr,useRef:fr,useState:fr,useDebugValue:fr,useDeferredValue:fr,useTransition:fr,useMutableSource:fr,useSyncExternalStore:fr,useId:fr,unstable_isNewReconciler:!1},Kh={readContext:Gr,useCallback:function(e,t){return pn().memoizedState=[e,t===void 0?null:t],e},useContext:Gr,useEffect:Au,useImperativeHandle:function(e,t,n){return n=n!=null?n.concat([e]):null,qi(4194308,4,Mu.bind(null,t,e),n)},useLayoutEffect:function(e,t){return qi(4194308,4,e,t)},useInsertionEffect:function(e,t){return qi(4,2,e,t)},useMemo:function(e,t){var n=pn();return t=t===void 0?null:t,e=e(),n.memoizedState=[e,t],e},useReducer:function(e,t,n){var a=pn();return t=n!==void 0?n(t):t,a.memoizedState=a.baseState=t,e={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:e,lastRenderedState:t},a.queue=e,e=e.dispatch=Vh.bind(null,Rt,e),[a.memoizedState,e]},useRef:function(e){var t=pn();return e={current:e},t.memoizedState=e},useState:Tu,useDebugValue:El,useDeferredValue:function(e){return pn().memoizedState=e},useTransition:function(){var e=Tu(!1),t=e[0];return e=Yh.bind(null,e[1]),pn().memoizedState=e,[t,e]},useMutableSource:function(){},useSyncExternalStore:function(e,t,n){var a=Rt,c=pn();if(Dt){if(n===void 0)throw Error(o(407));n=n()}else{if(n=t(),Zt===null)throw Error(o(349));(Fs&30)!==0||_u(a,t,n)}c.memoizedState=n;var y={value:n,getSnapshot:t};return c.queue=y,Au(ju.bind(null,a,y,e),[e]),a.flags|=2048,Wa(9,Nu.bind(null,a,y,n,t),void 0,null),n},useId:function(){var e=pn(),t=Zt.identifierPrefix;if(Dt){var n=Cn,a=jn;n=(a&~(1<<32-Or(a)-1)).toString(32)+n,t=":"+t+"R"+n,n=$a++,0<n&&(t+="H"+n.toString(32)),t+=":"}else n=Qh++,t=":"+t+"r"+n.toString(32)+":";return e.memoizedState=t},unstable_isNewReconciler:!1},Zh={readContext:Gr,useCallback:Fu,useContext:Gr,useEffect:Sl,useImperativeHandle:Lu,useInsertionEffect:Ou,useLayoutEffect:Ru,useMemo:Pu,useReducer:bl,useRef:Du,useState:function(){return bl(Ha)},useDebugValue:El,useDeferredValue:function(e){var t=$r();return Uu(t,Qt.memoizedState,e)},useTransition:function(){var e=bl(Ha)[0],t=$r().memoizedState;return[e,t]},useMutableSource:Su,useSyncExternalStore:Eu,useId:zu,unstable_isNewReconciler:!1},Xh={readContext:Gr,useCallback:Fu,useContext:Gr,useEffect:Sl,useImperativeHandle:Lu,useInsertionEffect:Ou,useLayoutEffect:Ru,useMemo:Pu,useReducer:kl,useRef:Du,useState:function(){return kl(Ha)},useDebugValue:El,useDeferredValue:function(e){var t=$r();return Qt===null?t.memoizedState=e:Uu(t,Qt.memoizedState,e)},useTransition:function(){var e=kl(Ha)[0],t=$r().memoizedState;return[e,t]},useMutableSource:Su,useSyncExternalStore:Eu,useId:zu,unstable_isNewReconciler:!1};function en(e,t){if(e&&e.defaultProps){t=B({},t),e=e.defaultProps;for(var n in e)t[n]===void 0&&(t[n]=e[n]);return t}return t}function _l(e,t,n,a){t=e.memoizedState,n=n(a,t),n=n==null?t:B({},t,n),e.memoizedState=n,e.lanes===0&&(e.updateQueue.baseState=n)}var $i={isMounted:function(e){return(e=e._reactInternals)?Je(e)===e:!1},enqueueSetState:function(e,t,n){e=e._reactInternals;var a=vr(),c=ns(e),y=Tn(a,c);y.payload=t,n!=null&&(y.callback=n),t=Xn(e,y,c),t!==null&&(nn(t,e,c,a),Li(t,e,c))},enqueueReplaceState:function(e,t,n){e=e._reactInternals;var a=vr(),c=ns(e),y=Tn(a,c);y.tag=1,y.payload=t,n!=null&&(y.callback=n),t=Xn(e,y,c),t!==null&&(nn(t,e,c,a),Li(t,e,c))},enqueueForceUpdate:function(e,t){e=e._reactInternals;var n=vr(),a=ns(e),c=Tn(n,a);c.tag=2,t!=null&&(c.callback=t),t=Xn(e,c,a),t!==null&&(nn(t,e,a,n),Li(t,e,a))}};function $u(e,t,n,a,c,y,D){return e=e.stateNode,typeof e.shouldComponentUpdate=="function"?e.shouldComponentUpdate(a,y,D):t.prototype&&t.prototype.isPureReactComponent?!Aa(n,a)||!Aa(c,y):!0}function Hu(e,t,n){var a=!1,c=Jn,y=t.contextType;return typeof y=="object"&&y!==null?y=Gr(y):(c=Nr(t)?As:dr.current,a=t.contextTypes,y=(a=a!=null)?ca(e,c):Jn),t=new t(n,y),e.memoizedState=t.state!==null&&t.state!==void 0?t.state:null,t.updater=$i,e.stateNode=t,t._reactInternals=e,a&&(e=e.stateNode,e.__reactInternalMemoizedUnmaskedChildContext=c,e.__reactInternalMemoizedMaskedChildContext=y),t}function Wu(e,t,n,a){e=t.state,typeof t.componentWillReceiveProps=="function"&&t.componentWillReceiveProps(n,a),typeof t.UNSAFE_componentWillReceiveProps=="function"&&t.UNSAFE_componentWillReceiveProps(n,a),t.state!==e&&$i.enqueueReplaceState(t,t.state,null)}function Nl(e,t,n,a){var c=e.stateNode;c.props=n,c.state=e.memoizedState,c.refs={},fl(e);var y=t.contextType;typeof y=="object"&&y!==null?c.context=Gr(y):(y=Nr(t)?As:dr.current,c.context=ca(e,y)),c.state=e.memoizedState,y=t.getDerivedStateFromProps,typeof y=="function"&&(_l(e,t,y,n),c.state=e.memoizedState),typeof t.getDerivedStateFromProps=="function"||typeof c.getSnapshotBeforeUpdate=="function"||typeof c.UNSAFE_componentWillMount!="function"&&typeof c.componentWillMount!="function"||(t=c.state,typeof c.componentWillMount=="function"&&c.componentWillMount(),typeof c.UNSAFE_componentWillMount=="function"&&c.UNSAFE_componentWillMount(),t!==c.state&&$i.enqueueReplaceState(c,c.state,null),Fi(e,n,c,a),c.state=e.memoizedState),typeof c.componentDidMount=="function"&&(e.flags|=4194308)}function xa(e,t){try{var n="",a=t;do n+=me(a),a=a.return;while(a);var c=n}catch(y){c=`
Error generating stack: `+y.message+`
`+y.stack}return{value:e,source:t,stack:c,digest:null}}function jl(e,t,n){return{value:e,source:null,stack:n??null,digest:t??null}}function Cl(e,t){try{console.error(t.value)}catch(n){setTimeout(function(){throw n})}}var em=typeof WeakMap=="function"?WeakMap:Map;function Qu(e,t,n){n=Tn(-1,n),n.tag=3,n.payload={element:null};var a=t.value;return n.callback=function(){Ki||(Ki=!0,Gl=a),Cl(e,t)},n}function Yu(e,t,n){n=Tn(-1,n),n.tag=3;var a=e.type.getDerivedStateFromError;if(typeof a=="function"){var c=t.value;n.payload=function(){return a(c)},n.callback=function(){Cl(e,t)}}var y=e.stateNode;return y!==null&&typeof y.componentDidCatch=="function"&&(n.callback=function(){Cl(e,t),typeof a!="function"&&(ts===null?ts=new Set([this]):ts.add(this));var D=t.stack;this.componentDidCatch(t.value,{componentStack:D!==null?D:""})}),n}function Vu(e,t,n){var a=e.pingCache;if(a===null){a=e.pingCache=new em;var c=new Set;a.set(t,c)}else c=a.get(t),c===void 0&&(c=new Set,a.set(t,c));c.has(n)||(c.add(n),e=mm.bind(null,e,t,n),t.then(e,e))}function Ju(e){do{var t;if((t=e.tag===13)&&(t=e.memoizedState,t=t!==null?t.dehydrated!==null:!0),t)return e;e=e.return}while(e!==null);return null}function Ku(e,t,n,a,c){return(e.mode&1)===0?(e===t?e.flags|=65536:(e.flags|=128,n.flags|=131072,n.flags&=-52805,n.tag===1&&(n.alternate===null?n.tag=17:(t=Tn(-1,1),t.tag=2,Xn(n,t,1))),n.lanes|=1),e):(e.flags|=65536,e.lanes=c,e)}var tm=R.ReactCurrentOwner,jr=!1;function yr(e,t,n,a){t.child=e===null?xu(t,null,n,a):ha(t,e.child,n,a)}function Zu(e,t,n,a,c){n=n.render;var y=t.ref;return pa(t,c),a=vl(e,t,n,a,y,c),n=wl(),e!==null&&!jr?(t.updateQueue=e.updateQueue,t.flags&=-2053,e.lanes&=~c,Dn(e,t,c)):(Dt&&n&&rl(t),t.flags|=1,yr(e,t,a,c),t.child)}function Xu(e,t,n,a,c){if(e===null){var y=n.type;return typeof y=="function"&&!Jl(y)&&y.defaultProps===void 0&&n.compare===null&&n.defaultProps===void 0?(t.tag=15,t.type=y,ed(e,t,y,a,c)):(e=no(n.type,null,a,t,t.mode,c),e.ref=t.ref,e.return=t,t.child=e)}if(y=e.child,(e.lanes&c)===0){var D=y.memoizedProps;if(n=n.compare,n=n!==null?n:Aa,n(D,a)&&e.ref===t.ref)return Dn(e,t,c)}return t.flags|=1,e=as(y,a),e.ref=t.ref,e.return=t,t.child=e}function ed(e,t,n,a,c){if(e!==null){var y=e.memoizedProps;if(Aa(y,a)&&e.ref===t.ref)if(jr=!1,t.pendingProps=a=y,(e.lanes&c)!==0)(e.flags&131072)!==0&&(jr=!0);else return t.lanes=e.lanes,Dn(e,t,c)}return Il(e,t,n,a,c)}function td(e,t,n){var a=t.pendingProps,c=a.children,y=e!==null?e.memoizedState:null;if(a.mode==="hidden")if((t.mode&1)===0)t.memoizedState={baseLanes:0,cachePool:null,transitions:null},St(va,Fr),Fr|=n;else{if((n&1073741824)===0)return e=y!==null?y.baseLanes|n:n,t.lanes=t.childLanes=1073741824,t.memoizedState={baseLanes:e,cachePool:null,transitions:null},t.updateQueue=null,St(va,Fr),Fr|=e,null;t.memoizedState={baseLanes:0,cachePool:null,transitions:null},a=y!==null?y.baseLanes:n,St(va,Fr),Fr|=a}else y!==null?(a=y.baseLanes|n,t.memoizedState=null):a=n,St(va,Fr),Fr|=a;return yr(e,t,c,n),t.child}function rd(e,t){var n=t.ref;(e===null&&n!==null||e!==null&&e.ref!==n)&&(t.flags|=512,t.flags|=2097152)}function Il(e,t,n,a,c){var y=Nr(n)?As:dr.current;return y=ca(t,y),pa(t,c),n=vl(e,t,n,a,y,c),a=wl(),e!==null&&!jr?(t.updateQueue=e.updateQueue,t.flags&=-2053,e.lanes&=~c,Dn(e,t,c)):(Dt&&a&&rl(t),t.flags|=1,yr(e,t,n,c),t.child)}function nd(e,t,n,a,c){if(Nr(n)){var y=!0;Ci(t)}else y=!1;if(pa(t,c),t.stateNode===null)Wi(e,t),Hu(t,n,a),Nl(t,n,a,c),a=!0;else if(e===null){var D=t.stateNode,K=t.memoizedProps;D.props=K;var ne=D.context,_e=n.contextType;typeof _e=="object"&&_e!==null?_e=Gr(_e):(_e=Nr(n)?As:dr.current,_e=ca(t,_e));var Me=n.getDerivedStateFromProps,Fe=typeof Me=="function"||typeof D.getSnapshotBeforeUpdate=="function";Fe||typeof D.UNSAFE_componentWillReceiveProps!="function"&&typeof D.componentWillReceiveProps!="function"||(K!==a||ne!==_e)&&Wu(t,D,a,_e),Zn=!1;var Re=t.memoizedState;D.state=Re,Fi(t,a,D,c),ne=t.memoizedState,K!==a||Re!==ne||_r.current||Zn?(typeof Me=="function"&&(_l(t,n,Me,a),ne=t.memoizedState),(K=Zn||$u(t,n,K,a,Re,ne,_e))?(Fe||typeof D.UNSAFE_componentWillMount!="function"&&typeof D.componentWillMount!="function"||(typeof D.componentWillMount=="function"&&D.componentWillMount(),typeof D.UNSAFE_componentWillMount=="function"&&D.UNSAFE_componentWillMount()),typeof D.componentDidMount=="function"&&(t.flags|=4194308)):(typeof D.componentDidMount=="function"&&(t.flags|=4194308),t.memoizedProps=a,t.memoizedState=ne),D.props=a,D.state=ne,D.context=_e,a=K):(typeof D.componentDidMount=="function"&&(t.flags|=4194308),a=!1)}else{D=t.stateNode,vu(e,t),K=t.memoizedProps,_e=t.type===t.elementType?K:en(t.type,K),D.props=_e,Fe=t.pendingProps,Re=D.context,ne=n.contextType,typeof ne=="object"&&ne!==null?ne=Gr(ne):(ne=Nr(n)?As:dr.current,ne=ca(t,ne));var Ge=n.getDerivedStateFromProps;(Me=typeof Ge=="function"||typeof D.getSnapshotBeforeUpdate=="function")||typeof D.UNSAFE_componentWillReceiveProps!="function"&&typeof D.componentWillReceiveProps!="function"||(K!==Fe||Re!==ne)&&Wu(t,D,a,ne),Zn=!1,Re=t.memoizedState,D.state=Re,Fi(t,a,D,c);var Qe=t.memoizedState;K!==Fe||Re!==Qe||_r.current||Zn?(typeof Ge=="function"&&(_l(t,n,Ge,a),Qe=t.memoizedState),(_e=Zn||$u(t,n,_e,a,Re,Qe,ne)||!1)?(Me||typeof D.UNSAFE_componentWillUpdate!="function"&&typeof D.componentWillUpdate!="function"||(typeof D.componentWillUpdate=="function"&&D.componentWillUpdate(a,Qe,ne),typeof D.UNSAFE_componentWillUpdate=="function"&&D.UNSAFE_componentWillUpdate(a,Qe,ne)),typeof D.componentDidUpdate=="function"&&(t.flags|=4),typeof D.getSnapshotBeforeUpdate=="function"&&(t.flags|=1024)):(typeof D.componentDidUpdate!="function"||K===e.memoizedProps&&Re===e.memoizedState||(t.flags|=4),typeof D.getSnapshotBeforeUpdate!="function"||K===e.memoizedProps&&Re===e.memoizedState||(t.flags|=1024),t.memoizedProps=a,t.memoizedState=Qe),D.props=a,D.state=Qe,D.context=ne,a=_e):(typeof D.componentDidUpdate!="function"||K===e.memoizedProps&&Re===e.memoizedState||(t.flags|=4),typeof D.getSnapshotBeforeUpdate!="function"||K===e.memoizedProps&&Re===e.memoizedState||(t.flags|=1024),a=!1)}return Tl(e,t,n,a,y,c)}function Tl(e,t,n,a,c,y){rd(e,t);var D=(t.flags&128)!==0;if(!a&&!D)return c&&lu(t,n,!1),Dn(e,t,y);a=t.stateNode,tm.current=t;var K=D&&typeof n.getDerivedStateFromError!="function"?null:a.render();return t.flags|=1,e!==null&&D?(t.child=ha(t,e.child,null,y),t.child=ha(t,null,K,y)):yr(e,t,K,y),t.memoizedState=a.state,c&&lu(t,n,!0),t.child}function sd(e){var t=e.stateNode;t.pendingContext?iu(e,t.pendingContext,t.pendingContext!==t.context):t.context&&iu(e,t.context,!1),hl(e,t.containerInfo)}function ad(e,t,n,a,c){return fa(),il(c),t.flags|=256,yr(e,t,n,a),t.child}var Dl={dehydrated:null,treeContext:null,retryLane:0};function Al(e){return{baseLanes:e,cachePool:null,transitions:null}}function id(e,t,n){var a=t.pendingProps,c=Ot.current,y=!1,D=(t.flags&128)!==0,K;if((K=D)||(K=e!==null&&e.memoizedState===null?!1:(c&2)!==0),K?(y=!0,t.flags&=-129):(e===null||e.memoizedState!==null)&&(c|=1),St(Ot,c&1),e===null)return al(t),e=t.memoizedState,e!==null&&(e=e.dehydrated,e!==null)?((t.mode&1)===0?t.lanes=1:e.data==="$!"?t.lanes=8:t.lanes=1073741824,null):(D=a.children,e=a.fallback,y?(a=t.mode,y=t.child,D={mode:"hidden",children:D},(a&1)===0&&y!==null?(y.childLanes=0,y.pendingProps=D):y=so(D,a,0,null),e=Bs(e,a,n,null),y.return=t,e.return=t,y.sibling=e,t.child=y,t.child.memoizedState=Al(n),t.memoizedState=Dl,e):Ol(t,D));if(c=e.memoizedState,c!==null&&(K=c.dehydrated,K!==null))return rm(e,t,D,a,K,c,n);if(y){y=a.fallback,D=t.mode,c=e.child,K=c.sibling;var ne={mode:"hidden",children:a.children};return(D&1)===0&&t.child!==c?(a=t.child,a.childLanes=0,a.pendingProps=ne,t.deletions=null):(a=as(c,ne),a.subtreeFlags=c.subtreeFlags&14680064),K!==null?y=as(K,y):(y=Bs(y,D,n,null),y.flags|=2),y.return=t,a.return=t,a.sibling=y,t.child=a,a=y,y=t.child,D=e.child.memoizedState,D=D===null?Al(n):{baseLanes:D.baseLanes|n,cachePool:null,transitions:D.transitions},y.memoizedState=D,y.childLanes=e.childLanes&~n,t.memoizedState=Dl,a}return y=e.child,e=y.sibling,a=as(y,{mode:"visible",children:a.children}),(t.mode&1)===0&&(a.lanes=n),a.return=t,a.sibling=null,e!==null&&(n=t.deletions,n===null?(t.deletions=[e],t.flags|=16):n.push(e)),t.child=a,t.memoizedState=null,a}function Ol(e,t){return t=so({mode:"visible",children:t},e.mode,0,null),t.return=e,e.child=t}function Hi(e,t,n,a){return a!==null&&il(a),ha(t,e.child,null,n),e=Ol(t,t.pendingProps.children),e.flags|=2,t.memoizedState=null,e}function rm(e,t,n,a,c,y,D){if(n)return t.flags&256?(t.flags&=-257,a=jl(Error(o(422))),Hi(e,t,D,a)):t.memoizedState!==null?(t.child=e.child,t.flags|=128,null):(y=a.fallback,c=t.mode,a=so({mode:"visible",children:a.children},c,0,null),y=Bs(y,c,D,null),y.flags|=2,a.return=t,y.return=t,a.sibling=y,t.child=a,(t.mode&1)!==0&&ha(t,e.child,null,D),t.child.memoizedState=Al(D),t.memoizedState=Dl,y);if((t.mode&1)===0)return Hi(e,t,D,null);if(c.data==="$!"){if(a=c.nextSibling&&c.nextSibling.dataset,a)var K=a.dgst;return a=K,y=Error(o(419)),a=jl(y,a,void 0),Hi(e,t,D,a)}if(K=(D&e.childLanes)!==0,jr||K){if(a=Zt,a!==null){switch(D&-D){case 4:c=2;break;case 16:c=8;break;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:c=32;break;case 536870912:c=268435456;break;default:c=0}c=(c&(a.suspendedLanes|D))!==0?0:c,c!==0&&c!==y.retryLane&&(y.retryLane=c,In(e,c),nn(a,e,c,-1))}return Vl(),a=jl(Error(o(421))),Hi(e,t,D,a)}return c.data==="$?"?(t.flags|=128,t.child=e.child,t=pm.bind(null,e),c._reactRetry=t,null):(e=y.treeContext,Lr=Yn(c.nextSibling),Mr=t,Dt=!0,Xr=null,e!==null&&(qr[Br++]=jn,qr[Br++]=Cn,qr[Br++]=Os,jn=e.id,Cn=e.overflow,Os=t),t=Ol(t,a.children),t.flags|=4096,t)}function od(e,t,n){e.lanes|=t;var a=e.alternate;a!==null&&(a.lanes|=t),ul(e.return,t,n)}function Rl(e,t,n,a,c){var y=e.memoizedState;y===null?e.memoizedState={isBackwards:t,rendering:null,renderingStartTime:0,last:a,tail:n,tailMode:c}:(y.isBackwards=t,y.rendering=null,y.renderingStartTime=0,y.last=a,y.tail=n,y.tailMode=c)}function ld(e,t,n){var a=t.pendingProps,c=a.revealOrder,y=a.tail;if(yr(e,t,a.children,n),a=Ot.current,(a&2)!==0)a=a&1|2,t.flags|=128;else{if(e!==null&&(e.flags&128)!==0)e:for(e=t.child;e!==null;){if(e.tag===13)e.memoizedState!==null&&od(e,n,t);else if(e.tag===19)od(e,n,t);else if(e.child!==null){e.child.return=e,e=e.child;continue}if(e===t)break e;for(;e.sibling===null;){if(e.return===null||e.return===t)break e;e=e.return}e.sibling.return=e.return,e=e.sibling}a&=1}if(St(Ot,a),(t.mode&1)===0)t.memoizedState=null;else switch(c){case"forwards":for(n=t.child,c=null;n!==null;)e=n.alternate,e!==null&&Pi(e)===null&&(c=n),n=n.sibling;n=c,n===null?(c=t.child,t.child=null):(c=n.sibling,n.sibling=null),Rl(t,!1,c,n,y);break;case"backwards":for(n=null,c=t.child,t.child=null;c!==null;){if(e=c.alternate,e!==null&&Pi(e)===null){t.child=c;break}e=c.sibling,c.sibling=n,n=c,c=e}Rl(t,!0,n,null,y);break;case"together":Rl(t,!1,null,null,void 0);break;default:t.memoizedState=null}return t.child}function Wi(e,t){(t.mode&1)===0&&e!==null&&(e.alternate=null,t.alternate=null,t.flags|=2)}function Dn(e,t,n){if(e!==null&&(t.dependencies=e.dependencies),Ps|=t.lanes,(n&t.childLanes)===0)return null;if(e!==null&&t.child!==e.child)throw Error(o(153));if(t.child!==null){for(e=t.child,n=as(e,e.pendingProps),t.child=n,n.return=t;e.sibling!==null;)e=e.sibling,n=n.sibling=as(e,e.pendingProps),n.return=t;n.sibling=null}return t.child}function nm(e,t,n){switch(t.tag){case 3:sd(t),fa();break;case 5:ku(t);break;case 1:Nr(t.type)&&Ci(t);break;case 4:hl(t,t.stateNode.containerInfo);break;case 10:var a=t.type._context,c=t.memoizedProps.value;St(Ri,a._currentValue),a._currentValue=c;break;case 13:if(a=t.memoizedState,a!==null)return a.dehydrated!==null?(St(Ot,Ot.current&1),t.flags|=128,null):(n&t.child.childLanes)!==0?id(e,t,n):(St(Ot,Ot.current&1),e=Dn(e,t,n),e!==null?e.sibling:null);St(Ot,Ot.current&1);break;case 19:if(a=(n&t.childLanes)!==0,(e.flags&128)!==0){if(a)return ld(e,t,n);t.flags|=128}if(c=t.memoizedState,c!==null&&(c.rendering=null,c.tail=null,c.lastEffect=null),St(Ot,Ot.current),a)break;return null;case 22:case 23:return t.lanes=0,td(e,t,n)}return Dn(e,t,n)}var cd,Ml,ud,dd;cd=function(e,t){for(var n=t.child;n!==null;){if(n.tag===5||n.tag===6)e.appendChild(n.stateNode);else if(n.tag!==4&&n.child!==null){n.child.return=n,n=n.child;continue}if(n===t)break;for(;n.sibling===null;){if(n.return===null||n.return===t)return;n=n.return}n.sibling.return=n.return,n=n.sibling}},Ml=function(){},ud=function(e,t,n,a){var c=e.memoizedProps;if(c!==a){e=t.stateNode,Ls(mn.current);var y=null;switch(n){case"input":c=g(e,c),a=g(e,a),y=[];break;case"select":c=B({},c,{value:void 0}),a=B({},a,{value:void 0}),y=[];break;case"textarea":c=Q(e,c),a=Q(e,a),y=[];break;default:typeof c.onClick!="function"&&typeof a.onClick=="function"&&(e.onclick=_i)}Ct(n,a);var D;n=null;for(_e in c)if(!a.hasOwnProperty(_e)&&c.hasOwnProperty(_e)&&c[_e]!=null)if(_e==="style"){var K=c[_e];for(D in K)K.hasOwnProperty(D)&&(n||(n={}),n[D]="")}else _e!=="dangerouslySetInnerHTML"&&_e!=="children"&&_e!=="suppressContentEditableWarning"&&_e!=="suppressHydrationWarning"&&_e!=="autoFocus"&&(h.hasOwnProperty(_e)?y||(y=[]):(y=y||[]).push(_e,null));for(_e in a){var ne=a[_e];if(K=c!=null?c[_e]:void 0,a.hasOwnProperty(_e)&&ne!==K&&(ne!=null||K!=null))if(_e==="style")if(K){for(D in K)!K.hasOwnProperty(D)||ne&&ne.hasOwnProperty(D)||(n||(n={}),n[D]="");for(D in ne)ne.hasOwnProperty(D)&&K[D]!==ne[D]&&(n||(n={}),n[D]=ne[D])}else n||(y||(y=[]),y.push(_e,n)),n=ne;else _e==="dangerouslySetInnerHTML"?(ne=ne?ne.__html:void 0,K=K?K.__html:void 0,ne!=null&&K!==ne&&(y=y||[]).push(_e,ne)):_e==="children"?typeof ne!="string"&&typeof ne!="number"||(y=y||[]).push(_e,""+ne):_e!=="suppressContentEditableWarning"&&_e!=="suppressHydrationWarning"&&(h.hasOwnProperty(_e)?(ne!=null&&_e==="onScroll"&&_t("scroll",e),y||K===ne||(y=[])):(y=y||[]).push(_e,ne))}n&&(y=y||[]).push("style",n);var _e=y;(t.updateQueue=_e)&&(t.flags|=4)}},dd=function(e,t,n,a){n!==a&&(t.flags|=4)};function Qa(e,t){if(!Dt)switch(e.tailMode){case"hidden":t=e.tail;for(var n=null;t!==null;)t.alternate!==null&&(n=t),t=t.sibling;n===null?e.tail=null:n.sibling=null;break;case"collapsed":n=e.tail;for(var a=null;n!==null;)n.alternate!==null&&(a=n),n=n.sibling;a===null?t||e.tail===null?e.tail=null:e.tail.sibling=null:a.sibling=null}}function hr(e){var t=e.alternate!==null&&e.alternate.child===e.child,n=0,a=0;if(t)for(var c=e.child;c!==null;)n|=c.lanes|c.childLanes,a|=c.subtreeFlags&14680064,a|=c.flags&14680064,c.return=e,c=c.sibling;else for(c=e.child;c!==null;)n|=c.lanes|c.childLanes,a|=c.subtreeFlags,a|=c.flags,c.return=e,c=c.sibling;return e.subtreeFlags|=a,e.childLanes=n,t}function sm(e,t,n){var a=t.pendingProps;switch(nl(t),t.tag){case 2:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return hr(t),null;case 1:return Nr(t.type)&&ji(),hr(t),null;case 3:return a=t.stateNode,ga(),Nt(_r),Nt(dr),gl(),a.pendingContext&&(a.context=a.pendingContext,a.pendingContext=null),(e===null||e.child===null)&&(Ai(t)?t.flags|=4:e===null||e.memoizedState.isDehydrated&&(t.flags&256)===0||(t.flags|=1024,Xr!==null&&(Wl(Xr),Xr=null))),Ml(e,t),hr(t),null;case 5:ml(t);var c=Ls(Ba.current);if(n=t.type,e!==null&&t.stateNode!=null)ud(e,t,n,a,c),e.ref!==t.ref&&(t.flags|=512,t.flags|=2097152);else{if(!a){if(t.stateNode===null)throw Error(o(166));return hr(t),null}if(e=Ls(mn.current),Ai(t)){a=t.stateNode,n=t.type;var y=t.memoizedProps;switch(a[hn]=t,a[Fa]=y,e=(t.mode&1)!==0,n){case"dialog":_t("cancel",a),_t("close",a);break;case"iframe":case"object":case"embed":_t("load",a);break;case"video":case"audio":for(c=0;c<Ra.length;c++)_t(Ra[c],a);break;case"source":_t("error",a);break;case"img":case"image":case"link":_t("error",a),_t("load",a);break;case"details":_t("toggle",a);break;case"input":ee(a,y),_t("invalid",a);break;case"select":a._wrapperState={wasMultiple:!!y.multiple},_t("invalid",a);break;case"textarea":ue(a,y),_t("invalid",a)}Ct(n,y),c=null;for(var D in y)if(y.hasOwnProperty(D)){var K=y[D];D==="children"?typeof K=="string"?a.textContent!==K&&(y.suppressHydrationWarning!==!0&&Ei(a.textContent,K,e),c=["children",K]):typeof K=="number"&&a.textContent!==""+K&&(y.suppressHydrationWarning!==!0&&Ei(a.textContent,K,e),c=["children",""+K]):h.hasOwnProperty(D)&&K!=null&&D==="onScroll"&&_t("scroll",a)}switch(n){case"input":qe(a),L(a,y,!0);break;case"textarea":qe(a),ye(a);break;case"select":case"option":break;default:typeof y.onClick=="function"&&(a.onclick=_i)}a=c,t.updateQueue=a,a!==null&&(t.flags|=4)}else{D=c.nodeType===9?c:c.ownerDocument,e==="http://www.w3.org/1999/xhtml"&&(e=Ce(n)),e==="http://www.w3.org/1999/xhtml"?n==="script"?(e=D.createElement("div"),e.innerHTML="<script><\/script>",e=e.removeChild(e.firstChild)):typeof a.is=="string"?e=D.createElement(n,{is:a.is}):(e=D.createElement(n),n==="select"&&(D=e,a.multiple?D.multiple=!0:a.size&&(D.size=a.size))):e=D.createElementNS(e,n),e[hn]=t,e[Fa]=a,cd(e,t,!1,!1),t.stateNode=e;e:{switch(D=Mt(n,a),n){case"dialog":_t("cancel",e),_t("close",e),c=a;break;case"iframe":case"object":case"embed":_t("load",e),c=a;break;case"video":case"audio":for(c=0;c<Ra.length;c++)_t(Ra[c],e);c=a;break;case"source":_t("error",e),c=a;break;case"img":case"image":case"link":_t("error",e),_t("load",e),c=a;break;case"details":_t("toggle",e),c=a;break;case"input":ee(e,a),c=g(e,a),_t("invalid",e);break;case"option":c=a;break;case"select":e._wrapperState={wasMultiple:!!a.multiple},c=B({},a,{value:void 0}),_t("invalid",e);break;case"textarea":ue(e,a),c=Q(e,a),_t("invalid",e);break;default:c=a}Ct(n,c),K=c;for(y in K)if(K.hasOwnProperty(y)){var ne=K[y];y==="style"?jt(e,ne):y==="dangerouslySetInnerHTML"?(ne=ne?ne.__html:void 0,ne!=null&&ct(e,ne)):y==="children"?typeof ne=="string"?(n!=="textarea"||ne!=="")&&et(e,ne):typeof ne=="number"&&et(e,""+ne):y!=="suppressContentEditableWarning"&&y!=="suppressHydrationWarning"&&y!=="autoFocus"&&(h.hasOwnProperty(y)?ne!=null&&y==="onScroll"&&_t("scroll",e):ne!=null&&F(e,y,ne,D))}switch(n){case"input":qe(e),L(e,a,!1);break;case"textarea":qe(e),ye(e);break;case"option":a.value!=null&&e.setAttribute("value",""+Se(a.value));break;case"select":e.multiple=!!a.multiple,y=a.value,y!=null?se(e,!!a.multiple,y,!1):a.defaultValue!=null&&se(e,!!a.multiple,a.defaultValue,!0);break;default:typeof c.onClick=="function"&&(e.onclick=_i)}switch(n){case"button":case"input":case"select":case"textarea":a=!!a.autoFocus;break e;case"img":a=!0;break e;default:a=!1}}a&&(t.flags|=4)}t.ref!==null&&(t.flags|=512,t.flags|=2097152)}return hr(t),null;case 6:if(e&&t.stateNode!=null)dd(e,t,e.memoizedProps,a);else{if(typeof a!="string"&&t.stateNode===null)throw Error(o(166));if(n=Ls(Ba.current),Ls(mn.current),Ai(t)){if(a=t.stateNode,n=t.memoizedProps,a[hn]=t,(y=a.nodeValue!==n)&&(e=Mr,e!==null))switch(e.tag){case 3:Ei(a.nodeValue,n,(e.mode&1)!==0);break;case 5:e.memoizedProps.suppressHydrationWarning!==!0&&Ei(a.nodeValue,n,(e.mode&1)!==0)}y&&(t.flags|=4)}else a=(n.nodeType===9?n:n.ownerDocument).createTextNode(a),a[hn]=t,t.stateNode=a}return hr(t),null;case 13:if(Nt(Ot),a=t.memoizedState,e===null||e.memoizedState!==null&&e.memoizedState.dehydrated!==null){if(Dt&&Lr!==null&&(t.mode&1)!==0&&(t.flags&128)===0)mu(),fa(),t.flags|=98560,y=!1;else if(y=Ai(t),a!==null&&a.dehydrated!==null){if(e===null){if(!y)throw Error(o(318));if(y=t.memoizedState,y=y!==null?y.dehydrated:null,!y)throw Error(o(317));y[hn]=t}else fa(),(t.flags&128)===0&&(t.memoizedState=null),t.flags|=4;hr(t),y=!1}else Xr!==null&&(Wl(Xr),Xr=null),y=!0;if(!y)return t.flags&65536?t:null}return(t.flags&128)!==0?(t.lanes=n,t):(a=a!==null,a!==(e!==null&&e.memoizedState!==null)&&a&&(t.child.flags|=8192,(t.mode&1)!==0&&(e===null||(Ot.current&1)!==0?Yt===0&&(Yt=3):Vl())),t.updateQueue!==null&&(t.flags|=4),hr(t),null);case 4:return ga(),Ml(e,t),e===null&&Ma(t.stateNode.containerInfo),hr(t),null;case 10:return cl(t.type._context),hr(t),null;case 17:return Nr(t.type)&&ji(),hr(t),null;case 19:if(Nt(Ot),y=t.memoizedState,y===null)return hr(t),null;if(a=(t.flags&128)!==0,D=y.rendering,D===null)if(a)Qa(y,!1);else{if(Yt!==0||e!==null&&(e.flags&128)!==0)for(e=t.child;e!==null;){if(D=Pi(e),D!==null){for(t.flags|=128,Qa(y,!1),a=D.updateQueue,a!==null&&(t.updateQueue=a,t.flags|=4),t.subtreeFlags=0,a=n,n=t.child;n!==null;)y=n,e=a,y.flags&=14680066,D=y.alternate,D===null?(y.childLanes=0,y.lanes=e,y.child=null,y.subtreeFlags=0,y.memoizedProps=null,y.memoizedState=null,y.updateQueue=null,y.dependencies=null,y.stateNode=null):(y.childLanes=D.childLanes,y.lanes=D.lanes,y.child=D.child,y.subtreeFlags=0,y.deletions=null,y.memoizedProps=D.memoizedProps,y.memoizedState=D.memoizedState,y.updateQueue=D.updateQueue,y.type=D.type,e=D.dependencies,y.dependencies=e===null?null:{lanes:e.lanes,firstContext:e.firstContext}),n=n.sibling;return St(Ot,Ot.current&1|2),t.child}e=e.sibling}y.tail!==null&&It()>wa&&(t.flags|=128,a=!0,Qa(y,!1),t.lanes=4194304)}else{if(!a)if(e=Pi(D),e!==null){if(t.flags|=128,a=!0,n=e.updateQueue,n!==null&&(t.updateQueue=n,t.flags|=4),Qa(y,!0),y.tail===null&&y.tailMode==="hidden"&&!D.alternate&&!Dt)return hr(t),null}else 2*It()-y.renderingStartTime>wa&&n!==1073741824&&(t.flags|=128,a=!0,Qa(y,!1),t.lanes=4194304);y.isBackwards?(D.sibling=t.child,t.child=D):(n=y.last,n!==null?n.sibling=D:t.child=D,y.last=D)}return y.tail!==null?(t=y.tail,y.rendering=t,y.tail=t.sibling,y.renderingStartTime=It(),t.sibling=null,n=Ot.current,St(Ot,a?n&1|2:n&1),t):(hr(t),null);case 22:case 23:return Yl(),a=t.memoizedState!==null,e!==null&&e.memoizedState!==null!==a&&(t.flags|=8192),a&&(t.mode&1)!==0?(Fr&1073741824)!==0&&(hr(t),t.subtreeFlags&6&&(t.flags|=8192)):hr(t),null;case 24:return null;case 25:return null}throw Error(o(156,t.tag))}function am(e,t){switch(nl(t),t.tag){case 1:return Nr(t.type)&&ji(),e=t.flags,e&65536?(t.flags=e&-65537|128,t):null;case 3:return ga(),Nt(_r),Nt(dr),gl(),e=t.flags,(e&65536)!==0&&(e&128)===0?(t.flags=e&-65537|128,t):null;case 5:return ml(t),null;case 13:if(Nt(Ot),e=t.memoizedState,e!==null&&e.dehydrated!==null){if(t.alternate===null)throw Error(o(340));fa()}return e=t.flags,e&65536?(t.flags=e&-65537|128,t):null;case 19:return Nt(Ot),null;case 4:return ga(),null;case 10:return cl(t.type._context),null;case 22:case 23:return Yl(),null;case 24:return null;default:return null}}var Qi=!1,mr=!1,im=typeof WeakSet=="function"?WeakSet:Set,We=null;function ya(e,t){var n=e.ref;if(n!==null)if(typeof n=="function")try{n(null)}catch(a){Pt(e,t,a)}else n.current=null}function Ll(e,t,n){try{n()}catch(a){Pt(e,t,a)}}var fd=!1;function om(e,t){if(Yo=E,e=$c(),zo(e)){if("selectionStart"in e)var n={start:e.selectionStart,end:e.selectionEnd};else e:{n=(n=e.ownerDocument)&&n.defaultView||window;var a=n.getSelection&&n.getSelection();if(a&&a.rangeCount!==0){n=a.anchorNode;var c=a.anchorOffset,y=a.focusNode;a=a.focusOffset;try{n.nodeType,y.nodeType}catch{n=null;break e}var D=0,K=-1,ne=-1,_e=0,Me=0,Fe=e,Re=null;t:for(;;){for(var Ge;Fe!==n||c!==0&&Fe.nodeType!==3||(K=D+c),Fe!==y||a!==0&&Fe.nodeType!==3||(ne=D+a),Fe.nodeType===3&&(D+=Fe.nodeValue.length),(Ge=Fe.firstChild)!==null;)Re=Fe,Fe=Ge;for(;;){if(Fe===e)break t;if(Re===n&&++_e===c&&(K=D),Re===y&&++Me===a&&(ne=D),(Ge=Fe.nextSibling)!==null)break;Fe=Re,Re=Fe.parentNode}Fe=Ge}n=K===-1||ne===-1?null:{start:K,end:ne}}else n=null}n=n||{start:0,end:0}}else n=null;for(Vo={focusedElem:e,selectionRange:n},E=!1,We=t;We!==null;)if(t=We,e=t.child,(t.subtreeFlags&1028)!==0&&e!==null)e.return=t,We=e;else for(;We!==null;){t=We;try{var Qe=t.alternate;if((t.flags&1024)!==0)switch(t.tag){case 0:case 11:case 15:break;case 1:if(Qe!==null){var Ve=Qe.memoizedProps,zt=Qe.memoizedState,xe=t.stateNode,le=xe.getSnapshotBeforeUpdate(t.elementType===t.type?Ve:en(t.type,Ve),zt);xe.__reactInternalSnapshotBeforeUpdate=le}break;case 3:var ke=t.stateNode.containerInfo;ke.nodeType===1?ke.textContent="":ke.nodeType===9&&ke.documentElement&&ke.removeChild(ke.documentElement);break;case 5:case 6:case 4:case 17:break;default:throw Error(o(163))}}catch(Pe){Pt(t,t.return,Pe)}if(e=t.sibling,e!==null){e.return=t.return,We=e;break}We=t.return}return Qe=fd,fd=!1,Qe}function Ya(e,t,n){var a=t.updateQueue;if(a=a!==null?a.lastEffect:null,a!==null){var c=a=a.next;do{if((c.tag&e)===e){var y=c.destroy;c.destroy=void 0,y!==void 0&&Ll(t,n,y)}c=c.next}while(c!==a)}}function Yi(e,t){if(t=t.updateQueue,t=t!==null?t.lastEffect:null,t!==null){var n=t=t.next;do{if((n.tag&e)===e){var a=n.create;n.destroy=a()}n=n.next}while(n!==t)}}function Fl(e){var t=e.ref;if(t!==null){var n=e.stateNode;switch(e.tag){case 5:e=n;break;default:e=n}typeof t=="function"?t(e):t.current=e}}function hd(e){var t=e.alternate;t!==null&&(e.alternate=null,hd(t)),e.child=null,e.deletions=null,e.sibling=null,e.tag===5&&(t=e.stateNode,t!==null&&(delete t[hn],delete t[Fa],delete t[Xo],delete t[Gh],delete t[$h])),e.stateNode=null,e.return=null,e.dependencies=null,e.memoizedProps=null,e.memoizedState=null,e.pendingProps=null,e.stateNode=null,e.updateQueue=null}function md(e){return e.tag===5||e.tag===3||e.tag===4}function pd(e){e:for(;;){for(;e.sibling===null;){if(e.return===null||md(e.return))return null;e=e.return}for(e.sibling.return=e.return,e=e.sibling;e.tag!==5&&e.tag!==6&&e.tag!==18;){if(e.flags&2||e.child===null||e.tag===4)continue e;e.child.return=e,e=e.child}if(!(e.flags&2))return e.stateNode}}function Pl(e,t,n){var a=e.tag;if(a===5||a===6)e=e.stateNode,t?n.nodeType===8?n.parentNode.insertBefore(e,t):n.insertBefore(e,t):(n.nodeType===8?(t=n.parentNode,t.insertBefore(e,n)):(t=n,t.appendChild(e)),n=n._reactRootContainer,n!=null||t.onclick!==null||(t.onclick=_i));else if(a!==4&&(e=e.child,e!==null))for(Pl(e,t,n),e=e.sibling;e!==null;)Pl(e,t,n),e=e.sibling}function Ul(e,t,n){var a=e.tag;if(a===5||a===6)e=e.stateNode,t?n.insertBefore(e,t):n.appendChild(e);else if(a!==4&&(e=e.child,e!==null))for(Ul(e,t,n),e=e.sibling;e!==null;)Ul(e,t,n),e=e.sibling}var rr=null,tn=!1;function es(e,t,n){for(n=n.child;n!==null;)gd(e,t,n),n=n.sibling}function gd(e,t,n){if(Ar&&typeof Ar.onCommitFiberUnmount=="function")try{Ar.onCommitFiberUnmount(xs,n)}catch{}switch(n.tag){case 5:mr||ya(n,t);case 6:var a=rr,c=tn;rr=null,es(e,t,n),rr=a,tn=c,rr!==null&&(tn?(e=rr,n=n.stateNode,e.nodeType===8?e.parentNode.removeChild(n):e.removeChild(n)):rr.removeChild(n.stateNode));break;case 18:rr!==null&&(tn?(e=rr,n=n.stateNode,e.nodeType===8?Zo(e.parentNode,n):e.nodeType===1&&Zo(e,n),i(e)):Zo(rr,n.stateNode));break;case 4:a=rr,c=tn,rr=n.stateNode.containerInfo,tn=!0,es(e,t,n),rr=a,tn=c;break;case 0:case 11:case 14:case 15:if(!mr&&(a=n.updateQueue,a!==null&&(a=a.lastEffect,a!==null))){c=a=a.next;do{var y=c,D=y.destroy;y=y.tag,D!==void 0&&((y&2)!==0||(y&4)!==0)&&Ll(n,t,D),c=c.next}while(c!==a)}es(e,t,n);break;case 1:if(!mr&&(ya(n,t),a=n.stateNode,typeof a.componentWillUnmount=="function"))try{a.props=n.memoizedProps,a.state=n.memoizedState,a.componentWillUnmount()}catch(K){Pt(n,t,K)}es(e,t,n);break;case 21:es(e,t,n);break;case 22:n.mode&1?(mr=(a=mr)||n.memoizedState!==null,es(e,t,n),mr=a):es(e,t,n);break;default:es(e,t,n)}}function xd(e){var t=e.updateQueue;if(t!==null){e.updateQueue=null;var n=e.stateNode;n===null&&(n=e.stateNode=new im),t.forEach(function(a){var c=gm.bind(null,e,a);n.has(a)||(n.add(a),a.then(c,c))})}}function rn(e,t){var n=t.deletions;if(n!==null)for(var a=0;a<n.length;a++){var c=n[a];try{var y=e,D=t,K=D;e:for(;K!==null;){switch(K.tag){case 5:rr=K.stateNode,tn=!1;break e;case 3:rr=K.stateNode.containerInfo,tn=!0;break e;case 4:rr=K.stateNode.containerInfo,tn=!0;break e}K=K.return}if(rr===null)throw Error(o(160));gd(y,D,c),rr=null,tn=!1;var ne=c.alternate;ne!==null&&(ne.return=null),c.return=null}catch(_e){Pt(c,t,_e)}}if(t.subtreeFlags&12854)for(t=t.child;t!==null;)yd(t,e),t=t.sibling}function yd(e,t){var n=e.alternate,a=e.flags;switch(e.tag){case 0:case 11:case 14:case 15:if(rn(t,e),gn(e),a&4){try{Ya(3,e,e.return),Yi(3,e)}catch(Ve){Pt(e,e.return,Ve)}try{Ya(5,e,e.return)}catch(Ve){Pt(e,e.return,Ve)}}break;case 1:rn(t,e),gn(e),a&512&&n!==null&&ya(n,n.return);break;case 5:if(rn(t,e),gn(e),a&512&&n!==null&&ya(n,n.return),e.flags&32){var c=e.stateNode;try{et(c,"")}catch(Ve){Pt(e,e.return,Ve)}}if(a&4&&(c=e.stateNode,c!=null)){var y=e.memoizedProps,D=n!==null?n.memoizedProps:y,K=e.type,ne=e.updateQueue;if(e.updateQueue=null,ne!==null)try{K==="input"&&y.type==="radio"&&y.name!=null&&G(c,y),Mt(K,D);var _e=Mt(K,y);for(D=0;D<ne.length;D+=2){var Me=ne[D],Fe=ne[D+1];Me==="style"?jt(c,Fe):Me==="dangerouslySetInnerHTML"?ct(c,Fe):Me==="children"?et(c,Fe):F(c,Me,Fe,_e)}switch(K){case"input":P(c,y);break;case"textarea":Ie(c,y);break;case"select":var Re=c._wrapperState.wasMultiple;c._wrapperState.wasMultiple=!!y.multiple;var Ge=y.value;Ge!=null?se(c,!!y.multiple,Ge,!1):Re!==!!y.multiple&&(y.defaultValue!=null?se(c,!!y.multiple,y.defaultValue,!0):se(c,!!y.multiple,y.multiple?[]:"",!1))}c[Fa]=y}catch(Ve){Pt(e,e.return,Ve)}}break;case 6:if(rn(t,e),gn(e),a&4){if(e.stateNode===null)throw Error(o(162));c=e.stateNode,y=e.memoizedProps;try{c.nodeValue=y}catch(Ve){Pt(e,e.return,Ve)}}break;case 3:if(rn(t,e),gn(e),a&4&&n!==null&&n.memoizedState.isDehydrated)try{i(t.containerInfo)}catch(Ve){Pt(e,e.return,Ve)}break;case 4:rn(t,e),gn(e);break;case 13:rn(t,e),gn(e),c=e.child,c.flags&8192&&(y=c.memoizedState!==null,c.stateNode.isHidden=y,!y||c.alternate!==null&&c.alternate.memoizedState!==null||(Bl=It())),a&4&&xd(e);break;case 22:if(Me=n!==null&&n.memoizedState!==null,e.mode&1?(mr=(_e=mr)||Me,rn(t,e),mr=_e):rn(t,e),gn(e),a&8192){if(_e=e.memoizedState!==null,(e.stateNode.isHidden=_e)&&!Me&&(e.mode&1)!==0)for(We=e,Me=e.child;Me!==null;){for(Fe=We=Me;We!==null;){switch(Re=We,Ge=Re.child,Re.tag){case 0:case 11:case 14:case 15:Ya(4,Re,Re.return);break;case 1:ya(Re,Re.return);var Qe=Re.stateNode;if(typeof Qe.componentWillUnmount=="function"){a=Re,n=Re.return;try{t=a,Qe.props=t.memoizedProps,Qe.state=t.memoizedState,Qe.componentWillUnmount()}catch(Ve){Pt(a,n,Ve)}}break;case 5:ya(Re,Re.return);break;case 22:if(Re.memoizedState!==null){bd(Fe);continue}}Ge!==null?(Ge.return=Re,We=Ge):bd(Fe)}Me=Me.sibling}e:for(Me=null,Fe=e;;){if(Fe.tag===5){if(Me===null){Me=Fe;try{c=Fe.stateNode,_e?(y=c.style,typeof y.setProperty=="function"?y.setProperty("display","none","important"):y.display="none"):(K=Fe.stateNode,ne=Fe.memoizedProps.style,D=ne!=null&&ne.hasOwnProperty("display")?ne.display:null,K.style.display=ft("display",D))}catch(Ve){Pt(e,e.return,Ve)}}}else if(Fe.tag===6){if(Me===null)try{Fe.stateNode.nodeValue=_e?"":Fe.memoizedProps}catch(Ve){Pt(e,e.return,Ve)}}else if((Fe.tag!==22&&Fe.tag!==23||Fe.memoizedState===null||Fe===e)&&Fe.child!==null){Fe.child.return=Fe,Fe=Fe.child;continue}if(Fe===e)break e;for(;Fe.sibling===null;){if(Fe.return===null||Fe.return===e)break e;Me===Fe&&(Me=null),Fe=Fe.return}Me===Fe&&(Me=null),Fe.sibling.return=Fe.return,Fe=Fe.sibling}}break;case 19:rn(t,e),gn(e),a&4&&xd(e);break;case 21:break;default:rn(t,e),gn(e)}}function gn(e){var t=e.flags;if(t&2){try{e:{for(var n=e.return;n!==null;){if(md(n)){var a=n;break e}n=n.return}throw Error(o(160))}switch(a.tag){case 5:var c=a.stateNode;a.flags&32&&(et(c,""),a.flags&=-33);var y=pd(e);Ul(e,y,c);break;case 3:case 4:var D=a.stateNode.containerInfo,K=pd(e);Pl(e,K,D);break;default:throw Error(o(161))}}catch(ne){Pt(e,e.return,ne)}e.flags&=-3}t&4096&&(e.flags&=-4097)}function lm(e,t,n){We=e,vd(e)}function vd(e,t,n){for(var a=(e.mode&1)!==0;We!==null;){var c=We,y=c.child;if(c.tag===22&&a){var D=c.memoizedState!==null||Qi;if(!D){var K=c.alternate,ne=K!==null&&K.memoizedState!==null||mr;K=Qi;var _e=mr;if(Qi=D,(mr=ne)&&!_e)for(We=c;We!==null;)D=We,ne=D.child,D.tag===22&&D.memoizedState!==null?kd(c):ne!==null?(ne.return=D,We=ne):kd(c);for(;y!==null;)We=y,vd(y),y=y.sibling;We=c,Qi=K,mr=_e}wd(e)}else(c.subtreeFlags&8772)!==0&&y!==null?(y.return=c,We=y):wd(e)}}function wd(e){for(;We!==null;){var t=We;if((t.flags&8772)!==0){var n=t.alternate;try{if((t.flags&8772)!==0)switch(t.tag){case 0:case 11:case 15:mr||Yi(5,t);break;case 1:var a=t.stateNode;if(t.flags&4&&!mr)if(n===null)a.componentDidMount();else{var c=t.elementType===t.type?n.memoizedProps:en(t.type,n.memoizedProps);a.componentDidUpdate(c,n.memoizedState,a.__reactInternalSnapshotBeforeUpdate)}var y=t.updateQueue;y!==null&&bu(t,y,a);break;case 3:var D=t.updateQueue;if(D!==null){if(n=null,t.child!==null)switch(t.child.tag){case 5:n=t.child.stateNode;break;case 1:n=t.child.stateNode}bu(t,D,n)}break;case 5:var K=t.stateNode;if(n===null&&t.flags&4){n=K;var ne=t.memoizedProps;switch(t.type){case"button":case"input":case"select":case"textarea":ne.autoFocus&&n.focus();break;case"img":ne.src&&(n.src=ne.src)}}break;case 6:break;case 4:break;case 12:break;case 13:if(t.memoizedState===null){var _e=t.alternate;if(_e!==null){var Me=_e.memoizedState;if(Me!==null){var Fe=Me.dehydrated;Fe!==null&&i(Fe)}}}break;case 19:case 17:case 21:case 22:case 23:case 25:break;default:throw Error(o(163))}mr||t.flags&512&&Fl(t)}catch(Re){Pt(t,t.return,Re)}}if(t===e){We=null;break}if(n=t.sibling,n!==null){n.return=t.return,We=n;break}We=t.return}}function bd(e){for(;We!==null;){var t=We;if(t===e){We=null;break}var n=t.sibling;if(n!==null){n.return=t.return,We=n;break}We=t.return}}function kd(e){for(;We!==null;){var t=We;try{switch(t.tag){case 0:case 11:case 15:var n=t.return;try{Yi(4,t)}catch(ne){Pt(t,n,ne)}break;case 1:var a=t.stateNode;if(typeof a.componentDidMount=="function"){var c=t.return;try{a.componentDidMount()}catch(ne){Pt(t,c,ne)}}var y=t.return;try{Fl(t)}catch(ne){Pt(t,y,ne)}break;case 5:var D=t.return;try{Fl(t)}catch(ne){Pt(t,D,ne)}}}catch(ne){Pt(t,t.return,ne)}if(t===e){We=null;break}var K=t.sibling;if(K!==null){K.return=t.return,We=K;break}We=t.return}}var cm=Math.ceil,Vi=R.ReactCurrentDispatcher,zl=R.ReactCurrentOwner,Hr=R.ReactCurrentBatchConfig,vt=0,Zt=null,$t=null,nr=0,Fr=0,va=Vn(0),Yt=0,Va=null,Ps=0,Ji=0,ql=0,Ja=null,Cr=null,Bl=0,wa=1/0,An=null,Ki=!1,Gl=null,ts=null,Zi=!1,rs=null,Xi=0,Ka=0,$l=null,eo=-1,to=0;function vr(){return(vt&6)!==0?It():eo!==-1?eo:eo=It()}function ns(e){return(e.mode&1)===0?1:(vt&2)!==0&&nr!==0?nr&-nr:Wh.transition!==null?(to===0&&(to=ws()),to):(e=yt,e!==0||(e=window.event,e=e===void 0?16:gt(e.type)),e)}function nn(e,t,n,a){if(50<Ka)throw Ka=0,$l=null,Error(o(185));bs(e,n,a),((vt&2)===0||e!==Zt)&&(e===Zt&&((vt&2)===0&&(Ji|=n),Yt===4&&ss(e,nr)),Ir(e,a),n===1&&vt===0&&(t.mode&1)===0&&(wa=It()+500,Ii&&Kn()))}function Ir(e,t){var n=e.callbackNode;Ys(e,t);var a=zn(e,e===Zt?nr:0);if(a===0)n!==null&&Yr(n),e.callbackNode=null,e.callbackPriority=0;else if(t=a&-a,e.callbackPriority!==t){if(n!=null&&Yr(n),t===1)e.tag===0?Hh(Ed.bind(null,e)):cu(Ed.bind(null,e)),qh(function(){(vt&6)===0&&Kn()}),n=null;else{switch(Sa(a)){case 1:n=Ws;break;case 4:n=ps;break;case 16:n=gs;break;case 536870912:n=Qs;break;default:n=gs}n=Ad(n,Sd.bind(null,e))}e.callbackPriority=t,e.callbackNode=n}}function Sd(e,t){if(eo=-1,to=0,(vt&6)!==0)throw Error(o(327));var n=e.callbackNode;if(ba()&&e.callbackNode!==n)return null;var a=zn(e,e===Zt?nr:0);if(a===0)return null;if((a&30)!==0||(a&e.expiredLanes)!==0||t)t=ro(e,a);else{t=a;var c=vt;vt|=2;var y=Nd();(Zt!==e||nr!==t)&&(An=null,wa=It()+500,zs(e,t));do try{fm();break}catch(K){_d(e,K)}while(!0);ll(),Vi.current=y,vt=c,$t!==null?t=0:(Zt=null,nr=0,t=Yt)}if(t!==0){if(t===2&&(c=qn(e),c!==0&&(a=c,t=Hl(e,c))),t===1)throw n=Va,zs(e,0),ss(e,a),Ir(e,It()),n;if(t===6)ss(e,a);else{if(c=e.current.alternate,(a&30)===0&&!um(c)&&(t=ro(e,a),t===2&&(y=qn(e),y!==0&&(a=y,t=Hl(e,y))),t===1))throw n=Va,zs(e,0),ss(e,a),Ir(e,It()),n;switch(e.finishedWork=c,e.finishedLanes=a,t){case 0:case 1:throw Error(o(345));case 2:qs(e,Cr,An);break;case 3:if(ss(e,a),(a&130023424)===a&&(t=Bl+500-It(),10<t)){if(zn(e,0)!==0)break;if(c=e.suspendedLanes,(c&a)!==a){vr(),e.pingedLanes|=e.suspendedLanes&c;break}e.timeoutHandle=Ko(qs.bind(null,e,Cr,An),t);break}qs(e,Cr,An);break;case 4:if(ss(e,a),(a&4194240)===a)break;for(t=e.eventTimes,c=-1;0<a;){var D=31-Or(a);y=1<<D,D=t[D],D>c&&(c=D),a&=~y}if(a=c,a=It()-a,a=(120>a?120:480>a?480:1080>a?1080:1920>a?1920:3e3>a?3e3:4320>a?4320:1960*cm(a/1960))-a,10<a){e.timeoutHandle=Ko(qs.bind(null,e,Cr,An),a);break}qs(e,Cr,An);break;case 5:qs(e,Cr,An);break;default:throw Error(o(329))}}}return Ir(e,It()),e.callbackNode===n?Sd.bind(null,e):null}function Hl(e,t){var n=Ja;return e.current.memoizedState.isDehydrated&&(zs(e,t).flags|=256),e=ro(e,t),e!==2&&(t=Cr,Cr=n,t!==null&&Wl(t)),e}function Wl(e){Cr===null?Cr=e:Cr.push.apply(Cr,e)}function um(e){for(var t=e;;){if(t.flags&16384){var n=t.updateQueue;if(n!==null&&(n=n.stores,n!==null))for(var a=0;a<n.length;a++){var c=n[a],y=c.getSnapshot;c=c.value;try{if(!Zr(y(),c))return!1}catch{return!1}}}if(n=t.child,t.subtreeFlags&16384&&n!==null)n.return=t,t=n;else{if(t===e)break;for(;t.sibling===null;){if(t.return===null||t.return===e)return!0;t=t.return}t.sibling.return=t.return,t=t.sibling}}return!0}function ss(e,t){for(t&=~ql,t&=~Ji,e.suspendedLanes|=t,e.pingedLanes&=~t,e=e.expirationTimes;0<t;){var n=31-Or(t),a=1<<n;e[n]=-1,t&=~a}}function Ed(e){if((vt&6)!==0)throw Error(o(327));ba();var t=zn(e,0);if((t&1)===0)return Ir(e,It()),null;var n=ro(e,t);if(e.tag!==0&&n===2){var a=qn(e);a!==0&&(t=a,n=Hl(e,a))}if(n===1)throw n=Va,zs(e,0),ss(e,t),Ir(e,It()),n;if(n===6)throw Error(o(345));return e.finishedWork=e.current.alternate,e.finishedLanes=t,qs(e,Cr,An),Ir(e,It()),null}function Ql(e,t){var n=vt;vt|=1;try{return e(t)}finally{vt=n,vt===0&&(wa=It()+500,Ii&&Kn())}}function Us(e){rs!==null&&rs.tag===0&&(vt&6)===0&&ba();var t=vt;vt|=1;var n=Hr.transition,a=yt;try{if(Hr.transition=null,yt=1,e)return e()}finally{yt=a,Hr.transition=n,vt=t,(vt&6)===0&&Kn()}}function Yl(){Fr=va.current,Nt(va)}function zs(e,t){e.finishedWork=null,e.finishedLanes=0;var n=e.timeoutHandle;if(n!==-1&&(e.timeoutHandle=-1,zh(n)),$t!==null)for(n=$t.return;n!==null;){var a=n;switch(nl(a),a.tag){case 1:a=a.type.childContextTypes,a!=null&&ji();break;case 3:ga(),Nt(_r),Nt(dr),gl();break;case 5:ml(a);break;case 4:ga();break;case 13:Nt(Ot);break;case 19:Nt(Ot);break;case 10:cl(a.type._context);break;case 22:case 23:Yl()}n=n.return}if(Zt=e,$t=e=as(e.current,null),nr=Fr=t,Yt=0,Va=null,ql=Ji=Ps=0,Cr=Ja=null,Ms!==null){for(t=0;t<Ms.length;t++)if(n=Ms[t],a=n.interleaved,a!==null){n.interleaved=null;var c=a.next,y=n.pending;if(y!==null){var D=y.next;y.next=c,a.next=D}n.pending=a}Ms=null}return e}function _d(e,t){do{var n=$t;try{if(ll(),Ui.current=Gi,zi){for(var a=Rt.memoizedState;a!==null;){var c=a.queue;c!==null&&(c.pending=null),a=a.next}zi=!1}if(Fs=0,Kt=Qt=Rt=null,Ga=!1,$a=0,zl.current=null,n===null||n.return===null){Yt=1,Va=t,$t=null;break}e:{var y=e,D=n.return,K=n,ne=t;if(t=nr,K.flags|=32768,ne!==null&&typeof ne=="object"&&typeof ne.then=="function"){var _e=ne,Me=K,Fe=Me.tag;if((Me.mode&1)===0&&(Fe===0||Fe===11||Fe===15)){var Re=Me.alternate;Re?(Me.updateQueue=Re.updateQueue,Me.memoizedState=Re.memoizedState,Me.lanes=Re.lanes):(Me.updateQueue=null,Me.memoizedState=null)}var Ge=Ju(D);if(Ge!==null){Ge.flags&=-257,Ku(Ge,D,K,y,t),Ge.mode&1&&Vu(y,_e,t),t=Ge,ne=_e;var Qe=t.updateQueue;if(Qe===null){var Ve=new Set;Ve.add(ne),t.updateQueue=Ve}else Qe.add(ne);break e}else{if((t&1)===0){Vu(y,_e,t),Vl();break e}ne=Error(o(426))}}else if(Dt&&K.mode&1){var zt=Ju(D);if(zt!==null){(zt.flags&65536)===0&&(zt.flags|=256),Ku(zt,D,K,y,t),il(xa(ne,K));break e}}y=ne=xa(ne,K),Yt!==4&&(Yt=2),Ja===null?Ja=[y]:Ja.push(y),y=D;do{switch(y.tag){case 3:y.flags|=65536,t&=-t,y.lanes|=t;var xe=Qu(y,ne,t);wu(y,xe);break e;case 1:K=ne;var le=y.type,ke=y.stateNode;if((y.flags&128)===0&&(typeof le.getDerivedStateFromError=="function"||ke!==null&&typeof ke.componentDidCatch=="function"&&(ts===null||!ts.has(ke)))){y.flags|=65536,t&=-t,y.lanes|=t;var Pe=Yu(y,K,t);wu(y,Pe);break e}}y=y.return}while(y!==null)}Cd(n)}catch(Xe){t=Xe,$t===n&&n!==null&&($t=n=n.return);continue}break}while(!0)}function Nd(){var e=Vi.current;return Vi.current=Gi,e===null?Gi:e}function Vl(){(Yt===0||Yt===3||Yt===2)&&(Yt=4),Zt===null||(Ps&268435455)===0&&(Ji&268435455)===0||ss(Zt,nr)}function ro(e,t){var n=vt;vt|=2;var a=Nd();(Zt!==e||nr!==t)&&(An=null,zs(e,t));do try{dm();break}catch(c){_d(e,c)}while(!0);if(ll(),vt=n,Vi.current=a,$t!==null)throw Error(o(261));return Zt=null,nr=0,Yt}function dm(){for(;$t!==null;)jd($t)}function fm(){for(;$t!==null&&!zr();)jd($t)}function jd(e){var t=Dd(e.alternate,e,Fr);e.memoizedProps=e.pendingProps,t===null?Cd(e):$t=t,zl.current=null}function Cd(e){var t=e;do{var n=t.alternate;if(e=t.return,(t.flags&32768)===0){if(n=sm(n,t,Fr),n!==null){$t=n;return}}else{if(n=am(n,t),n!==null){n.flags&=32767,$t=n;return}if(e!==null)e.flags|=32768,e.subtreeFlags=0,e.deletions=null;else{Yt=6,$t=null;return}}if(t=t.sibling,t!==null){$t=t;return}$t=t=e}while(t!==null);Yt===0&&(Yt=5)}function qs(e,t,n){var a=yt,c=Hr.transition;try{Hr.transition=null,yt=1,hm(e,t,n,a)}finally{Hr.transition=c,yt=a}return null}function hm(e,t,n,a){do ba();while(rs!==null);if((vt&6)!==0)throw Error(o(327));n=e.finishedWork;var c=e.finishedLanes;if(n===null)return null;if(e.finishedWork=null,e.finishedLanes=0,n===e.current)throw Error(o(177));e.callbackNode=null,e.callbackPriority=0;var y=n.lanes|n.childLanes;if(ko(e,y),e===Zt&&($t=Zt=null,nr=0),(n.subtreeFlags&2064)===0&&(n.flags&2064)===0||Zi||(Zi=!0,Ad(gs,function(){return ba(),null})),y=(n.flags&15990)!==0,(n.subtreeFlags&15990)!==0||y){y=Hr.transition,Hr.transition=null;var D=yt;yt=1;var K=vt;vt|=4,zl.current=null,om(e,n),yd(n,e),Oh(Vo),E=!!Yo,Vo=Yo=null,e.current=n,lm(n),ii(),vt=K,yt=D,Hr.transition=y}else e.current=n;if(Zi&&(Zi=!1,rs=e,Xi=c),y=e.pendingLanes,y===0&&(ts=null),oi(n.stateNode),Ir(e,It()),t!==null)for(a=e.onRecoverableError,n=0;n<t.length;n++)c=t[n],a(c.value,{componentStack:c.stack,digest:c.digest});if(Ki)throw Ki=!1,e=Gl,Gl=null,e;return(Xi&1)!==0&&e.tag!==0&&ba(),y=e.pendingLanes,(y&1)!==0?e===$l?Ka++:(Ka=0,$l=e):Ka=0,Kn(),null}function ba(){if(rs!==null){var e=Sa(Xi),t=Hr.transition,n=yt;try{if(Hr.transition=null,yt=16>e?16:e,rs===null)var a=!1;else{if(e=rs,rs=null,Xi=0,(vt&6)!==0)throw Error(o(331));var c=vt;for(vt|=4,We=e.current;We!==null;){var y=We,D=y.child;if((We.flags&16)!==0){var K=y.deletions;if(K!==null){for(var ne=0;ne<K.length;ne++){var _e=K[ne];for(We=_e;We!==null;){var Me=We;switch(Me.tag){case 0:case 11:case 15:Ya(8,Me,y)}var Fe=Me.child;if(Fe!==null)Fe.return=Me,We=Fe;else for(;We!==null;){Me=We;var Re=Me.sibling,Ge=Me.return;if(hd(Me),Me===_e){We=null;break}if(Re!==null){Re.return=Ge,We=Re;break}We=Ge}}}var Qe=y.alternate;if(Qe!==null){var Ve=Qe.child;if(Ve!==null){Qe.child=null;do{var zt=Ve.sibling;Ve.sibling=null,Ve=zt}while(Ve!==null)}}We=y}}if((y.subtreeFlags&2064)!==0&&D!==null)D.return=y,We=D;else e:for(;We!==null;){if(y=We,(y.flags&2048)!==0)switch(y.tag){case 0:case 11:case 15:Ya(9,y,y.return)}var xe=y.sibling;if(xe!==null){xe.return=y.return,We=xe;break e}We=y.return}}var le=e.current;for(We=le;We!==null;){D=We;var ke=D.child;if((D.subtreeFlags&2064)!==0&&ke!==null)ke.return=D,We=ke;else e:for(D=le;We!==null;){if(K=We,(K.flags&2048)!==0)try{switch(K.tag){case 0:case 11:case 15:Yi(9,K)}}catch(Xe){Pt(K,K.return,Xe)}if(K===D){We=null;break e}var Pe=K.sibling;if(Pe!==null){Pe.return=K.return,We=Pe;break e}We=K.return}}if(vt=c,Kn(),Ar&&typeof Ar.onPostCommitFiberRoot=="function")try{Ar.onPostCommitFiberRoot(xs,e)}catch{}a=!0}return a}finally{yt=n,Hr.transition=t}}return!1}function Id(e,t,n){t=xa(n,t),t=Qu(e,t,1),e=Xn(e,t,1),t=vr(),e!==null&&(bs(e,1,t),Ir(e,t))}function Pt(e,t,n){if(e.tag===3)Id(e,e,n);else for(;t!==null;){if(t.tag===3){Id(t,e,n);break}else if(t.tag===1){var a=t.stateNode;if(typeof t.type.getDerivedStateFromError=="function"||typeof a.componentDidCatch=="function"&&(ts===null||!ts.has(a))){e=xa(n,e),e=Yu(t,e,1),t=Xn(t,e,1),e=vr(),t!==null&&(bs(t,1,e),Ir(t,e));break}}t=t.return}}function mm(e,t,n){var a=e.pingCache;a!==null&&a.delete(t),t=vr(),e.pingedLanes|=e.suspendedLanes&n,Zt===e&&(nr&n)===n&&(Yt===4||Yt===3&&(nr&130023424)===nr&&500>It()-Bl?zs(e,0):ql|=n),Ir(e,t)}function Td(e,t){t===0&&((e.mode&1)===0?t=1:(t=bt,bt<<=1,(bt&130023424)===0&&(bt=4194304)));var n=vr();e=In(e,t),e!==null&&(bs(e,t,n),Ir(e,n))}function pm(e){var t=e.memoizedState,n=0;t!==null&&(n=t.retryLane),Td(e,n)}function gm(e,t){var n=0;switch(e.tag){case 13:var a=e.stateNode,c=e.memoizedState;c!==null&&(n=c.retryLane);break;case 19:a=e.stateNode;break;default:throw Error(o(314))}a!==null&&a.delete(t),Td(e,n)}var Dd;Dd=function(e,t,n){if(e!==null)if(e.memoizedProps!==t.pendingProps||_r.current)jr=!0;else{if((e.lanes&n)===0&&(t.flags&128)===0)return jr=!1,nm(e,t,n);jr=(e.flags&131072)!==0}else jr=!1,Dt&&(t.flags&1048576)!==0&&uu(t,Di,t.index);switch(t.lanes=0,t.tag){case 2:var a=t.type;Wi(e,t),e=t.pendingProps;var c=ca(t,dr.current);pa(t,n),c=vl(null,t,a,e,c,n);var y=wl();return t.flags|=1,typeof c=="object"&&c!==null&&typeof c.render=="function"&&c.$$typeof===void 0?(t.tag=1,t.memoizedState=null,t.updateQueue=null,Nr(a)?(y=!0,Ci(t)):y=!1,t.memoizedState=c.state!==null&&c.state!==void 0?c.state:null,fl(t),c.updater=$i,t.stateNode=c,c._reactInternals=t,Nl(t,a,e,n),t=Tl(null,t,a,!0,y,n)):(t.tag=0,Dt&&y&&rl(t),yr(null,t,c,n),t=t.child),t;case 16:a=t.elementType;e:{switch(Wi(e,t),e=t.pendingProps,c=a._init,a=c(a._payload),t.type=a,c=t.tag=ym(a),e=en(a,e),c){case 0:t=Il(null,t,a,e,n);break e;case 1:t=nd(null,t,a,e,n);break e;case 11:t=Zu(null,t,a,e,n);break e;case 14:t=Xu(null,t,a,en(a.type,e),n);break e}throw Error(o(306,a,""))}return t;case 0:return a=t.type,c=t.pendingProps,c=t.elementType===a?c:en(a,c),Il(e,t,a,c,n);case 1:return a=t.type,c=t.pendingProps,c=t.elementType===a?c:en(a,c),nd(e,t,a,c,n);case 3:e:{if(sd(t),e===null)throw Error(o(387));a=t.pendingProps,y=t.memoizedState,c=y.element,vu(e,t),Fi(t,a,null,n);var D=t.memoizedState;if(a=D.element,y.isDehydrated)if(y={element:a,isDehydrated:!1,cache:D.cache,pendingSuspenseBoundaries:D.pendingSuspenseBoundaries,transitions:D.transitions},t.updateQueue.baseState=y,t.memoizedState=y,t.flags&256){c=xa(Error(o(423)),t),t=ad(e,t,a,n,c);break e}else if(a!==c){c=xa(Error(o(424)),t),t=ad(e,t,a,n,c);break e}else for(Lr=Yn(t.stateNode.containerInfo.firstChild),Mr=t,Dt=!0,Xr=null,n=xu(t,null,a,n),t.child=n;n;)n.flags=n.flags&-3|4096,n=n.sibling;else{if(fa(),a===c){t=Dn(e,t,n);break e}yr(e,t,a,n)}t=t.child}return t;case 5:return ku(t),e===null&&al(t),a=t.type,c=t.pendingProps,y=e!==null?e.memoizedProps:null,D=c.children,Jo(a,c)?D=null:y!==null&&Jo(a,y)&&(t.flags|=32),rd(e,t),yr(e,t,D,n),t.child;case 6:return e===null&&al(t),null;case 13:return id(e,t,n);case 4:return hl(t,t.stateNode.containerInfo),a=t.pendingProps,e===null?t.child=ha(t,null,a,n):yr(e,t,a,n),t.child;case 11:return a=t.type,c=t.pendingProps,c=t.elementType===a?c:en(a,c),Zu(e,t,a,c,n);case 7:return yr(e,t,t.pendingProps,n),t.child;case 8:return yr(e,t,t.pendingProps.children,n),t.child;case 12:return yr(e,t,t.pendingProps.children,n),t.child;case 10:e:{if(a=t.type._context,c=t.pendingProps,y=t.memoizedProps,D=c.value,St(Ri,a._currentValue),a._currentValue=D,y!==null)if(Zr(y.value,D)){if(y.children===c.children&&!_r.current){t=Dn(e,t,n);break e}}else for(y=t.child,y!==null&&(y.return=t);y!==null;){var K=y.dependencies;if(K!==null){D=y.child;for(var ne=K.firstContext;ne!==null;){if(ne.context===a){if(y.tag===1){ne=Tn(-1,n&-n),ne.tag=2;var _e=y.updateQueue;if(_e!==null){_e=_e.shared;var Me=_e.pending;Me===null?ne.next=ne:(ne.next=Me.next,Me.next=ne),_e.pending=ne}}y.lanes|=n,ne=y.alternate,ne!==null&&(ne.lanes|=n),ul(y.return,n,t),K.lanes|=n;break}ne=ne.next}}else if(y.tag===10)D=y.type===t.type?null:y.child;else if(y.tag===18){if(D=y.return,D===null)throw Error(o(341));D.lanes|=n,K=D.alternate,K!==null&&(K.lanes|=n),ul(D,n,t),D=y.sibling}else D=y.child;if(D!==null)D.return=y;else for(D=y;D!==null;){if(D===t){D=null;break}if(y=D.sibling,y!==null){y.return=D.return,D=y;break}D=D.return}y=D}yr(e,t,c.children,n),t=t.child}return t;case 9:return c=t.type,a=t.pendingProps.children,pa(t,n),c=Gr(c),a=a(c),t.flags|=1,yr(e,t,a,n),t.child;case 14:return a=t.type,c=en(a,t.pendingProps),c=en(a.type,c),Xu(e,t,a,c,n);case 15:return ed(e,t,t.type,t.pendingProps,n);case 17:return a=t.type,c=t.pendingProps,c=t.elementType===a?c:en(a,c),Wi(e,t),t.tag=1,Nr(a)?(e=!0,Ci(t)):e=!1,pa(t,n),Hu(t,a,c),Nl(t,a,c,n),Tl(null,t,a,!0,e,n);case 19:return ld(e,t,n);case 22:return td(e,t,n)}throw Error(o(156,t.tag))};function Ad(e,t){return Gt(e,t)}function xm(e,t,n,a){this.tag=e,this.key=n,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.ref=null,this.pendingProps=t,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=a,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function Wr(e,t,n,a){return new xm(e,t,n,a)}function Jl(e){return e=e.prototype,!(!e||!e.isReactComponent)}function ym(e){if(typeof e=="function")return Jl(e)?1:0;if(e!=null){if(e=e.$$typeof,e===$)return 11;if(e===ie)return 14}return 2}function as(e,t){var n=e.alternate;return n===null?(n=Wr(e.tag,t,e.key,e.mode),n.elementType=e.elementType,n.type=e.type,n.stateNode=e.stateNode,n.alternate=e,e.alternate=n):(n.pendingProps=t,n.type=e.type,n.flags=0,n.subtreeFlags=0,n.deletions=null),n.flags=e.flags&14680064,n.childLanes=e.childLanes,n.lanes=e.lanes,n.child=e.child,n.memoizedProps=e.memoizedProps,n.memoizedState=e.memoizedState,n.updateQueue=e.updateQueue,t=e.dependencies,n.dependencies=t===null?null:{lanes:t.lanes,firstContext:t.firstContext},n.sibling=e.sibling,n.index=e.index,n.ref=e.ref,n}function no(e,t,n,a,c,y){var D=2;if(a=e,typeof e=="function")Jl(e)&&(D=1);else if(typeof e=="string")D=5;else e:switch(e){case V:return Bs(n.children,c,y,t);case oe:D=8,c|=8;break;case J:return e=Wr(12,n,t,c|2),e.elementType=J,e.lanes=y,e;case W:return e=Wr(13,n,t,c),e.elementType=W,e.lanes=y,e;case _:return e=Wr(19,n,t,c),e.elementType=_,e.lanes=y,e;case ge:return so(n,c,y,t);default:if(typeof e=="object"&&e!==null)switch(e.$$typeof){case Z:D=10;break e;case de:D=9;break e;case $:D=11;break e;case ie:D=14;break e;case be:D=16,a=null;break e}throw Error(o(130,e==null?e:typeof e,""))}return t=Wr(D,n,t,c),t.elementType=e,t.type=a,t.lanes=y,t}function Bs(e,t,n,a){return e=Wr(7,e,a,t),e.lanes=n,e}function so(e,t,n,a){return e=Wr(22,e,a,t),e.elementType=ge,e.lanes=n,e.stateNode={isHidden:!1},e}function Kl(e,t,n){return e=Wr(6,e,null,t),e.lanes=n,e}function Zl(e,t,n){return t=Wr(4,e.children!==null?e.children:[],e.key,t),t.lanes=n,t.stateNode={containerInfo:e.containerInfo,pendingChildren:null,implementation:e.implementation},t}function vm(e,t,n,a,c){this.tag=t,this.containerInfo=e,this.finishedWork=this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.pendingContext=this.context=null,this.callbackPriority=0,this.eventTimes=En(0),this.expirationTimes=En(-1),this.entangledLanes=this.finishedLanes=this.mutableReadLanes=this.expiredLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=En(0),this.identifierPrefix=a,this.onRecoverableError=c,this.mutableSourceEagerHydrationData=null}function Xl(e,t,n,a,c,y,D,K,ne){return e=new vm(e,t,n,K,ne),t===1?(t=1,y===!0&&(t|=8)):t=0,y=Wr(3,null,null,t),e.current=y,y.stateNode=e,y.memoizedState={element:a,isDehydrated:n,cache:null,transitions:null,pendingSuspenseBoundaries:null},fl(y),e}function wm(e,t,n){var a=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:H,key:a==null?null:""+a,children:e,containerInfo:t,implementation:n}}function Od(e){if(!e)return Jn;e=e._reactInternals;e:{if(Je(e)!==e||e.tag!==1)throw Error(o(170));var t=e;do{switch(t.tag){case 3:t=t.stateNode.context;break e;case 1:if(Nr(t.type)){t=t.stateNode.__reactInternalMemoizedMergedChildContext;break e}}t=t.return}while(t!==null);throw Error(o(171))}if(e.tag===1){var n=e.type;if(Nr(n))return ou(e,n,t)}return t}function Rd(e,t,n,a,c,y,D,K,ne){return e=Xl(n,a,!0,e,c,y,D,K,ne),e.context=Od(null),n=e.current,a=vr(),c=ns(n),y=Tn(a,c),y.callback=t??null,Xn(n,y,c),e.current.lanes=c,bs(e,c,a),Ir(e,a),e}function ao(e,t,n,a){var c=t.current,y=vr(),D=ns(c);return n=Od(n),t.context===null?t.context=n:t.pendingContext=n,t=Tn(y,D),t.payload={element:e},a=a===void 0?null:a,a!==null&&(t.callback=a),e=Xn(c,t,D),e!==null&&(nn(e,c,D,y),Li(e,c,D)),D}function io(e){if(e=e.current,!e.child)return null;switch(e.child.tag){case 5:return e.child.stateNode;default:return e.child.stateNode}}function Md(e,t){if(e=e.memoizedState,e!==null&&e.dehydrated!==null){var n=e.retryLane;e.retryLane=n!==0&&n<t?n:t}}function ec(e,t){Md(e,t),(e=e.alternate)&&Md(e,t)}function bm(){return null}var Ld=typeof reportError=="function"?reportError:function(e){console.error(e)};function tc(e){this._internalRoot=e}oo.prototype.render=tc.prototype.render=function(e){var t=this._internalRoot;if(t===null)throw Error(o(409));ao(e,t,null,null)},oo.prototype.unmount=tc.prototype.unmount=function(){var e=this._internalRoot;if(e!==null){this._internalRoot=null;var t=e.containerInfo;Us(function(){ao(null,e,null,null)}),t[_n]=null}};function oo(e){this._internalRoot=e}oo.prototype.unstable_scheduleHydration=function(e){if(e){var t=Ss();e={blockedOn:null,target:e,priority:t};for(var n=0;n<Ye.length&&t!==0&&t<Ye[n].priority;n++);Ye.splice(n,0,e),n===0&&$n(e)}};function rc(e){return!(!e||e.nodeType!==1&&e.nodeType!==9&&e.nodeType!==11)}function lo(e){return!(!e||e.nodeType!==1&&e.nodeType!==9&&e.nodeType!==11&&(e.nodeType!==8||e.nodeValue!==" react-mount-point-unstable "))}function Fd(){}function km(e,t,n,a,c){if(c){if(typeof a=="function"){var y=a;a=function(){var _e=io(D);y.call(_e)}}var D=Rd(t,a,e,0,null,!1,!1,"",Fd);return e._reactRootContainer=D,e[_n]=D.current,Ma(e.nodeType===8?e.parentNode:e),Us(),D}for(;c=e.lastChild;)e.removeChild(c);if(typeof a=="function"){var K=a;a=function(){var _e=io(ne);K.call(_e)}}var ne=Xl(e,0,!1,null,null,!1,!1,"",Fd);return e._reactRootContainer=ne,e[_n]=ne.current,Ma(e.nodeType===8?e.parentNode:e),Us(function(){ao(t,ne,n,a)}),ne}function co(e,t,n,a,c){var y=n._reactRootContainer;if(y){var D=y;if(typeof c=="function"){var K=c;c=function(){var ne=io(D);K.call(ne)}}ao(t,D,e,c)}else D=km(n,t,e,c,a);return io(D)}Js=function(e){switch(e.tag){case 3:var t=e.stateNode;if(t.current.memoizedState.isDehydrated){var n=Vr(t.pendingLanes);n!==0&&(Vs(t,n|1),Ir(t,It()),(vt&6)===0&&(wa=It()+500,Kn()))}break;case 13:Us(function(){var a=In(e,1);if(a!==null){var c=vr();nn(a,e,1,c)}}),ec(e,1)}},ks=function(e){if(e.tag===13){var t=In(e,134217728);if(t!==null){var n=vr();nn(t,e,134217728,n)}ec(e,134217728)}},ui=function(e){if(e.tag===13){var t=ns(e),n=In(e,t);if(n!==null){var a=vr();nn(n,e,t,a)}ec(e,t)}},Ss=function(){return yt},Es=function(e,t){var n=yt;try{return yt=e,t()}finally{yt=n}},ar=function(e,t,n){switch(t){case"input":if(P(e,n),t=n.name,n.type==="radio"&&t!=null){for(n=e;n.parentNode;)n=n.parentNode;for(n=n.querySelectorAll("input[name="+JSON.stringify(""+t)+'][type="radio"]'),t=0;t<n.length;t++){var a=n[t];if(a!==e&&a.form===e.form){var c=Ni(a);if(!c)throw Error(o(90));te(a),P(a,c)}}}break;case"textarea":Ie(e,n);break;case"select":t=n.value,t!=null&&se(e,!!n.multiple,t,!1)}},Ue=Ql,Fn=Us;var Sm={usingClientEntryPoint:!1,Events:[Pa,oa,Ni,kr,ln,Ql]},Za={findFiberByHostInstance:Ds,bundleType:0,version:"18.3.1",rendererPackageName:"react-dom"},Em={bundleType:Za.bundleType,version:Za.version,rendererPackageName:Za.rendererPackageName,rendererConfig:Za.rendererConfig,overrideHookState:null,overrideHookStateDeletePath:null,overrideHookStateRenamePath:null,overrideProps:null,overridePropsDeletePath:null,overridePropsRenamePath:null,setErrorHandler:null,setSuspenseHandler:null,scheduleUpdate:null,currentDispatcherRef:R.ReactCurrentDispatcher,findHostInstanceByFiber:function(e){return e=Ft(e),e===null?null:e.stateNode},findFiberByHostInstance:Za.findFiberByHostInstance||bm,findHostInstancesForRefresh:null,scheduleRefresh:null,scheduleRoot:null,setRefreshHandler:null,getCurrentFiber:null,reconcilerVersion:"18.3.1-next-f1338f8080-20240426"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var uo=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!uo.isDisabled&&uo.supportsFiber)try{xs=uo.inject(Em),Ar=uo}catch{}}return Tr.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=Sm,Tr.createPortal=function(e,t){var n=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!rc(t))throw Error(o(200));return wm(e,t,null,n)},Tr.createRoot=function(e,t){if(!rc(e))throw Error(o(299));var n=!1,a="",c=Ld;return t!=null&&(t.unstable_strictMode===!0&&(n=!0),t.identifierPrefix!==void 0&&(a=t.identifierPrefix),t.onRecoverableError!==void 0&&(c=t.onRecoverableError)),t=Xl(e,1,!1,null,null,n,!1,a,c),e[_n]=t.current,Ma(e.nodeType===8?e.parentNode:e),new tc(t)},Tr.findDOMNode=function(e){if(e==null)return null;if(e.nodeType===1)return e;var t=e._reactInternals;if(t===void 0)throw typeof e.render=="function"?Error(o(188)):(e=Object.keys(e).join(","),Error(o(268,e)));return e=Ft(t),e=e===null?null:e.stateNode,e},Tr.flushSync=function(e){return Us(e)},Tr.hydrate=function(e,t,n){if(!lo(t))throw Error(o(200));return co(null,e,t,!0,n)},Tr.hydrateRoot=function(e,t,n){if(!rc(e))throw Error(o(405));var a=n!=null&&n.hydratedSources||null,c=!1,y="",D=Ld;if(n!=null&&(n.unstable_strictMode===!0&&(c=!0),n.identifierPrefix!==void 0&&(y=n.identifierPrefix),n.onRecoverableError!==void 0&&(D=n.onRecoverableError)),t=Rd(t,null,e,1,n??null,c,!1,y,D),e[_n]=t.current,Ma(e),a)for(e=0;e<a.length;e++)n=a[e],c=n._getVersion,c=c(n._source),t.mutableSourceEagerHydrationData==null?t.mutableSourceEagerHydrationData=[n,c]:t.mutableSourceEagerHydrationData.push(n,c);return new oo(t)},Tr.render=function(e,t,n){if(!lo(t))throw Error(o(200));return co(null,e,t,!1,n)},Tr.unmountComponentAtNode=function(e){if(!lo(e))throw Error(o(40));return e._reactRootContainer?(Us(function(){co(null,null,e,!1,function(){e._reactRootContainer=null,e[_n]=null})}),!0):!1},Tr.unstable_batchedUpdates=Ql,Tr.unstable_renderSubtreeIntoContainer=function(e,t,n,a){if(!lo(n))throw Error(o(200));if(e==null||e._reactInternals===void 0)throw Error(o(38));return co(e,t,n,!1,a)},Tr.version="18.3.1-next-f1338f8080-20240426",Tr}var Hd;function Om(){if(Hd)return ac.exports;Hd=1;function s(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(s)}catch(p){console.error(p)}}return s(),ac.exports=Am(),ac.exports}var Wd;function Rm(){if(Wd)return ho;Wd=1;var s=Om();return ho.createRoot=s.createRoot,ho.hydrateRoot=s.hydrateRoot,ho}var Mm=Rm();const Lm=si(Mm);var mt=(s=>(s[s.Again=1]="Again",s[s.Hard=2]="Hard",s[s.Good=3]="Good",s[s.Easy=4]="Easy",s))(mt||{}),Ae=(s=>(s.Flashcard="flashcard",s.Quiz="quiz",s.Learning="learning",s))(Ae||{}),Pr=(s=>(s.CREATE_DECK="CREATE_DECK",s.RENAME_DECK="RENAME_DECK",s.MOVE_DECK_TO_FOLDER="MOVE_DECK_TO_FOLDER",s.DELETE_DECK="DELETE_DECK",s.CREATE_FOLDER="CREATE_FOLDER",s.RENAME_FOLDER="RENAME_FOLDER",s.DELETE_FOLDER="DELETE_FOLDER",s.EXPAND_SERIES_ADD_LEVELS="EXPAND_SERIES_ADD_LEVELS",s.EXPAND_SERIES_ADD_DECKS="EXPAND_SERIES_ADD_DECKS",s.GENERATE_QUESTIONS_FOR_DECK="GENERATE_QUESTIONS_FOR_DECK",s.NO_ACTION="NO_ACTION",s))(Pr||{});const Fm="cogniflow-sync";let lc=null;const Pm=()=>(lc||(lc=new BroadcastChannel(Fm)),lc),vn=()=>{Pm().postMessage({type:"data-changed"})},lh="Europe/Stockholm",Um=()=>new Date().toLocaleDateString("sv-SE",{timeZone:lh}),zm=()=>new Date().toLocaleString("sv-SE",{timeZone:lh,year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit",second:"2-digit",hour12:!1}).replace(/ /g,"_").replace(/:/g,"-"),ch="CogniFlowDB",qm=6,Mn="decks",an="folders",xn="deckSeries",yn="sessions",Rn="reviews";let ls=null;function Ht(){return ls||(ls=new Promise((s,p)=>{const o=indexedDB.open(ch,qm);o.onblocked=v=>{console.error("IndexedDB open request blocked. Please close other tabs with this app open.",v),p(new Error("Database upgrade is required, but it is blocked by another open tab of this application. Please close all other tabs and reload."))},o.onerror=()=>{var v;console.error("IndexedDB error:",o.error),ls=null,p(new Error(`IndexedDB error: ${((v=o.error)==null?void 0:v.message)||"Unknown error"}`))},o.onsuccess=()=>{const v=o.result;v.onclose=()=>{ls=null,console.warn("Database connection closed.")},s(v)},o.onupgradeneeded=v=>{const h=v.target.result,u=v.target.transaction;if(!u){console.error("Upgrade transaction is not available.");return}switch(v.oldVersion){case 0:h.createObjectStore(Mn,{keyPath:"id"}),h.createObjectStore(an,{keyPath:"id"});case 1:case 2:h.objectStoreNames.contains(xn)||h.createObjectStore(xn,{keyPath:"id"});case 3:h.objectStoreNames.contains(yn)||h.createObjectStore(yn,{keyPath:"id"});case 4:h.objectStoreNames.contains(Rn)||h.createObjectStore(Rn,{keyPath:"id",autoIncrement:!0}).createIndex("timestamp","timestamp",{unique:!1});case 5:const l=u.objectStore(Rn);l.indexNames.contains("deckId")||l.createIndex("deckId","deckId",{unique:!1})}}}),ls)}async function Nc(){const s=await Ht();return new Promise((p,o)=>{const u=s.transaction(Mn,"readonly").objectStore(Mn).getAll();u.onerror=()=>o("Error fetching decks"),u.onsuccess=()=>p(u.result)})}async function ri(s){if(s.length===0)return;const p=await Ht();return new Promise((o,v)=>{const h=p.transaction(Mn,"readwrite"),u=h.objectStore(Mn);h.oncomplete=()=>{vn(),o()},h.onerror=()=>{console.error("Transaction error adding/updating decks",h.error),v("Transaction error adding/updating decks")},s.forEach(l=>{const f=u.put(l);f.onerror=()=>{console.error(`Error putting deck ${l.name}`,f.error)}})})}async function Qd(s){await ri(s)}async function Yd(s){const p=await Ht();return new Promise((o,v)=>{const h=p.transaction(Mn,"readwrite");h.oncomplete=()=>{vn(),o()},h.onerror=()=>v("Transaction error deleting deck"),h.objectStore(Mn).delete(s)})}async function Bm(s){const p=await Ht();return new Promise((o,v)=>{const h=p.transaction(Mn,"readwrite");h.oncomplete=()=>{vn(),o()},h.onerror=()=>v("Transaction error updating deck"),h.objectStore(Mn).put(s)})}async function jc(){const s=await Ht();return new Promise((p,o)=>{const u=s.transaction(an,"readonly").objectStore(an).getAll();u.onerror=()=>o("Error fetching folders"),u.onsuccess=()=>p(u.result)})}async function Gm(s){const p=await Ht();return new Promise((o,v)=>{const h=p.transaction(an,"readwrite");h.oncomplete=()=>{vn(),o()},h.onerror=()=>v("Transaction error adding folder"),h.objectStore(an).add(s)})}async function $m(s){if(s.length===0)return;const p=await Ht();return new Promise((o,v)=>{const h=p.transaction(an,"readwrite");h.oncomplete=()=>{vn(),o()},h.onerror=()=>{console.error("Transaction error adding/updating folders",h.error),v("Transaction error adding/updating folders")};const u=h.objectStore(an);s.forEach(l=>{const f=u.put(l);f.onerror=()=>{console.error(`Error putting folder ${l.name}`,f.error)}})})}async function Hm(s){const p=await Ht();return new Promise((o,v)=>{const h=p.transaction(an,"readwrite");h.oncomplete=()=>{vn(),o()},h.onerror=()=>v("Transaction error updating folder"),h.objectStore(an).put(s)})}async function Wm(s){const p=await Ht();return new Promise((o,v)=>{const h=p.transaction(an,"readwrite");h.oncomplete=()=>{vn(),o()},h.onerror=()=>v("Transaction error deleting folder"),h.objectStore(an).delete(s)})}async function Cc(){const s=await Ht();return new Promise((p,o)=>{const u=s.transaction(xn,"readonly").objectStore(xn).getAll();u.onerror=()=>o("Error fetching deck series"),u.onsuccess=()=>p(u.result)})}async function mo(s){if(s.length===0)return;const p=await Ht();return new Promise((o,v)=>{const h=p.transaction(xn,"readwrite");h.oncomplete=()=>{vn(),o()},h.onerror=()=>v("Transaction error adding deck series");const u=h.objectStore(xn);s.forEach(l=>u.put(l))})}async function Vd(s){const p=await Ht();return new Promise((o,v)=>{const h=p.transaction(xn,"readwrite");h.oncomplete=()=>{vn(),o()},h.onerror=()=>v("Error updating deck series"),h.objectStore(xn).put(s)})}async function Qm(s){const p=await Ht();return new Promise((o,v)=>{const h=p.transaction(xn,"readwrite");h.oncomplete=()=>{vn(),o()},h.onerror=()=>v("Error deleting deck series"),h.objectStore(xn).delete(s)})}async function Ym(s,p){const o=await Ht();return new Promise((v,h)=>{const u=o.transaction(yn,"readwrite");u.oncomplete=()=>v(),u.onerror=()=>h("Transaction error saving session state"),u.objectStore(yn).put({id:s,...p})})}async function Vm(s){const p=await Ht();return new Promise((o,v)=>{const l=p.transaction(yn,"readonly").objectStore(yn).get(s);l.onerror=()=>v("Error fetching session state"),l.onsuccess=()=>o(l.result||null)})}async function vo(s){const p=await Ht();return new Promise((o,v)=>{const h=p.transaction(yn,"readwrite");h.oncomplete=()=>o(),h.onerror=()=>v("Transaction error deleting session state"),h.objectStore(yn).delete(s)})}async function Jm(){const s=await Ht();return new Promise((p,o)=>{const u=s.transaction(yn,"readonly").objectStore(yn).getAllKeys();u.onerror=()=>o("Error fetching session keys"),u.onsuccess=()=>p(u.result)})}async function Km(s){const p=await Ht();return new Promise((o,v)=>{const h=p.transaction(Rn,"readwrite");h.oncomplete=()=>o(),h.onerror=()=>{console.error("Transaction error adding review log",h.error),v("Transaction error adding review log")},h.objectStore(Rn).add(s)})}async function Zm(s){const p=await Ht();return new Promise((o,v)=>{const l=p.transaction(Rn,"readonly").objectStore(Rn).index("timestamp"),f=IDBKeyRange.lowerBound(s.toISOString()),x=l.getAll(f);x.onerror=()=>v("Error fetching review logs"),x.onsuccess=()=>o(x.result)})}async function Xm(s){const p=await Ht();return new Promise((o,v)=>{const f=p.transaction(Rn,"readonly").objectStore(Rn).index("deckId").getAll(s);f.onerror=()=>v("Error fetching reviews for deck"),f.onsuccess=()=>o(f.result)})}async function ep(){const[s,p,o]=await Promise.all([Nc(),jc(),Cc()]);if(s.length===0&&p.length===0&&o.length===0)throw new Error("There is no data to export.");const h=JSON.stringify({version:3,decks:s,folders:p,deckSeries:o},null,2),u=new Blob([h],{type:"application/json"}),l=URL.createObjectURL(u),f=document.createElement("a");f.style.display="none",f.href=l;const x=zm();return f.download=`cogniflow-backup-${x}.json`,document.body.appendChild(f),f.click(),window.URL.revokeObjectURL(l),document.body.removeChild(f),f.download}async function tp(){return ls&&(await ls).close(),new Promise((s,p)=>{const o=indexedDB.deleteDatabase(ch);o.onerror=v=>{console.error("Error deleting database.",v),p(new Error("Error deleting database."))},o.onsuccess=()=>{console.log("Database deleted successfully."),s()},o.onblocked=()=>{console.error("Database deletion blocked. Please close other tabs of this app and try again."),p(new Error("Deletion blocked. Please close other tabs of this app."))}})}const us=2.5,bc=1.3,rp=1,np=1.2,sp=1.3,ap={1:-.2,2:-.15,3:0,4:.15},Ic=s=>{try{if(!s.trim())throw new Error("File content is empty.");let p=JSON.parse(s);if(typeof p=="string")try{p=JSON.parse(p)}catch{}if(typeof p=="object"&&p!==null&&!("version"in p)&&!Array.isArray(p)&&("data"in p&&typeof p.data=="object"?p=p.data:"content"in p&&typeof p.content=="object"&&(p=p.content)),typeof p=="object"&&p!==null&&"version"in p&&Array.isArray(p.decks)){if(p.version>3)throw new Error(`Unsupported backup version: ${p.version}`);const o=p.decks,v=p.folders||[],h=(Array.isArray(p.deckSeries)?p.deckSeries:[]).filter(u=>u&&typeof u.id=="string"&&typeof u.name=="string").map(u=>{if(Array.isArray(u.levels))return u.levels.forEach(l=>{Array.isArray(l.deckIds)||(l.deckIds=[])}),u;if(Array.isArray(u.deckIds)){const l={...u};return l.levels=[{title:"Decks",deckIds:l.deckIds}],delete l.deckIds,l}return{...u,levels:[]}});for(const u of o)if(typeof u.id!="string"||typeof u.name!="string"||!u.type)throw new Error("Invalid deck structure in backup file.");for(const u of v)if(typeof u.id!="string"||typeof u.name!="string")throw new Error("Invalid folder structure in backup file.");return{decks:o,folders:v,deckSeries:h}}if(Array.isArray(p)){const o=p.map(v=>(v.type||(Array.isArray(v.cards)?v.type=Ae.Flashcard:Array.isArray(v.questions)&&(v.type=Ae.Quiz)),v));for(const v of o)if(typeof v.id!="string"||typeof v.name!="string"||v.type!==Ae.Flashcard&&v.type!==Ae.Quiz)throw new Error("Invalid backup file. One or more decks have an incorrect structure.");return{decks:o,folders:[],deckSeries:[]}}throw new Error("The file is not a valid CogniFlow backup file.")}catch(p){throw console.error("Failed to parse backup file:",p),p instanceof SyntaxError?new Error("Invalid JSON format in the backup file."):new Error(p instanceof Error?p.message:"Invalid JSON format")}},kc=s=>{try{if(!s.trim())throw new Error("Pasted content is empty.");const p=JSON.parse(s);if(typeof p=="object"&&p!==null&&"seriesName"in p&&"levels"in p){if(typeof p.seriesName!="string"||typeof p.seriesDescription!="string"||!Array.isArray(p.levels))throw new Error("Invalid series format. Must have 'seriesName' (string), 'seriesDescription' (string), and a 'levels' (array).");for(const o of p.levels){if(typeof o.title!="string"||!Array.isArray(o.decks))throw new Error("Each level in the series must have a 'title' (string) and a 'decks' (array).");for(const v of o.decks)if(typeof v.name!="string"||typeof v.description!="string"||!Array.isArray(v.questions))throw new Error("Each deck in a level must be a valid quiz deck object with 'name', 'description', and 'questions' properties.")}return{type:"quiz_series",data:p}}if(Array.isArray(p)){const o=[];for(const v of p){if(typeof v.front!="string"||typeof v.back!="string")throw new Error("Each item in the array must be an object with 'front' and 'back' string properties.");o.push({front:v.front,back:v.back})}return{type:Ae.Flashcard,data:o}}if(typeof p=="object"&&p!==null&&"questions"in p){if(typeof p.name!="string"||typeof p.description!="string"||!Array.isArray(p.questions))throw new Error("Quiz JSON must be an object with 'name' (string), 'description' (string), and 'questions' (array) properties.");for(const o of p.questions)if(typeof o.questionText!="string"||!Array.isArray(o.options)||typeof o.correctAnswerId!="string")throw new Error("Each question in a quiz must have 'questionText', an 'options' array, and a 'correctAnswerId'.");return{type:Ae.Quiz,data:p}}throw new Error("Unsupported JSON structure. Expected an array of flashcards, a single quiz object, or a series object.")}catch(p){throw console.error("Failed to parse JSON:",p),new Error(p instanceof Error?p.message:"Invalid JSON format")}},ip=(s,p)=>{try{if(!s.trim())throw new Error("Pasted content is empty.");const o=JSON.parse(s);if(!Array.isArray(o))throw new Error("JSON must be an array of items.");if(o.length===0)return[];if(p===Ae.Flashcard){const v=[];for(const h of o){if(typeof h.front!="string"||typeof h.back!="string")throw new Error("Each item in the array must be an object with 'front' and 'back' string properties.");v.push({front:h.front,back:h.back})}return v}else{const v=[];for(const h of o){if(typeof h.questionText!="string"||!Array.isArray(h.options)||typeof h.correctAnswerId!="string")throw new Error("Each question must have 'questionText', an 'options' array, and a 'correctAnswerId'.");v.push(h)}return v}}catch(o){throw console.error("Failed to parse items JSON:",o),new Error(o instanceof Error?o.message:"Invalid JSON format")}},Tc=s=>{const p=new Date;return p.setHours(0,0,0,0),s.map(o=>({id:crypto.randomUUID(),front:o.front,back:o.back,dueDate:p.toISOString(),interval:0,easeFactor:us,masteryLevel:0,lapses:0}))},wr=s=>{const p=new Date;return p.setHours(0,0,0,0),s.map(o=>({...o,id:crypto.randomUUID(),dueDate:p.toISOString(),interval:0,easeFactor:us,masteryLevel:0,lapses:0}))},op=s=>{try{return{type:"backup",data:Ic(s)}}catch{}try{const p=kc(s);return{type:p.type,data:p.data}}catch{}return null},lp="https://www.greenyogafestival.org/backup-api/api/v1",cp="cogniflow-data",uh=()=>localStorage.getItem("cogniflow-backupApiKey")||"qRt+gU/57GHKhxTZeRnRi+dfT274iSkKKq2UnTr9Bxs=";async function dh(s,p={}){const o=uh(),v=`${lp}/apps/${cp}${s}`,h={"X-API-Key":o,...p.headers},u=await fetch(v,{...p,headers:h});if(!u.ok&&u.status!==304){let l=`Backup API Error (${u.status}): ${u.statusText||"An unknown error occurred"}`;try{const f=await u.json(),x=f.message||f.error;x&&typeof x=="string"&&(l=`Backup API Error (${u.status}): ${x}`)}catch{}throw new Error(l)}return u}async function Sc(s){const p={};s&&(p.headers={"If-None-Match":s});const o=await dh("/backups/latest",p);if(o.status===304)return{metadata:null,isNotModified:!0};const v=await o.json();if(!v.download_url){const h=new Error("404: Backup metadata from server is missing a download_url.");throw o.status===404&&(h.status=404),h}return{metadata:v,isNotModified:!1}}async function Jd(s){const p=s?{metadata:s}:await Sc();if(!p.metadata)throw new Error("Could not retrieve backup metadata to download the file.");const o=p.metadata,v=uh(),h=await fetch(o.download_url,{headers:{"X-API-Key":v}});if(!h.ok)throw new Error(`Failed to download backup content from ${o.download_url}: ${h.statusText}`);const u=await h.text();return Ic(u)}async function up(){const[s,p,o]=await Promise.all([Nc(),jc(),Cc()]),h=JSON.stringify({version:3,decks:s,folders:p,deckSeries:o}),u=new Blob([h],{type:"application/json"}),l=new FormData;l.append("file",u,"backup.json");const x=await(await dh("/backups",{method:"POST",body:l})).json();return{timestamp:new Date().toISOString(),etag:x.etag}}const dp=()=>{const[s,p]=U.useState(null);return U.useEffect(()=>{const v=h=>{h.preventDefault(),p(h)};return window.addEventListener("beforeinstallprompt",v),()=>{window.removeEventListener("beforeinstallprompt",v)}},[]),[s,()=>{s&&(s.prompt(),s.userChoice.then(v=>{v.outcome==="accepted"?console.log("User accepted the install prompt"):console.log("User dismissed the install prompt"),p(null)}))}]},fp=()=>{const[s,p]=U.useState(navigator.onLine);return U.useEffect(()=>{const o=()=>p(!0),v=()=>p(!1);return window.addEventListener("online",o),window.addEventListener("offline",v),()=>{window.removeEventListener("online",o),window.removeEventListener("offline",v)}},[]),s},hp=()=>fp()?null:r.jsx("div",{role:"status","aria-live":"assertive",className:"fixed bottom-0 left-0 right-0 bg-red-600 text-white text-center p-3 z-50 animate-fade-in",children:r.jsx("p",{className:"text-sm font-semibold",children:"You are currently offline. Some features may be unavailable."})}),mp={plus:r.jsxs(r.Fragment,{children:[r.jsx("line",{x1:"12",y1:"5",x2:"12",y2:"19"}),r.jsx("line",{x1:"5",y1:"12",x2:"19",y2:"12"})]}),"upload-cloud":r.jsxs(r.Fragment,{children:[r.jsx("path",{d:"M20 16.58A5 5 0 0 0 18 7h-1.26A8 8 0 1 0 4 15.25"}),r.jsx("polyline",{points:"16 16 12 12 8 16"}),r.jsx("line",{x1:"12",y1:"12",x2:"12",y2:"21"})]}),x:r.jsxs(r.Fragment,{children:[r.jsx("line",{x1:"18",y1:"6",x2:"6",y2:"18"}),r.jsx("line",{x1:"6",y1:"6",x2:"18",y2:"18"})]}),"chevron-left":r.jsx(r.Fragment,{children:r.jsx("polyline",{points:"15 18 9 12 15 6"})}),"trash-2":r.jsxs(r.Fragment,{children:[r.jsx("polyline",{points:"3 6 5 6 21 6"}),r.jsx("path",{d:"M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"}),r.jsx("line",{x1:"10",y1:"11",x2:"10",y2:"17"}),r.jsx("line",{x1:"14",y1:"11",x2:"14",y2:"17"})]}),"check-circle":r.jsxs(r.Fragment,{children:[r.jsx("path",{d:"M22 11.08V12a10 10 0 1 1-5.93-9.14"}),r.jsx("polyline",{points:"22 4 12 14.01 9 11.01"})]}),"x-circle":r.jsxs(r.Fragment,{children:[r.jsx("circle",{cx:"12",cy:"12",r:"10"}),r.jsx("line",{x1:"15",y1:"9",x2:"9",y2:"15"}),r.jsx("line",{x1:"9",y1:"9",x2:"15",y2:"15"})]}),download:r.jsxs(r.Fragment,{children:[r.jsx("path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"}),r.jsx("polyline",{points:"7 10 12 15 17 10"}),r.jsx("line",{x1:"12",y1:"15",x2:"12",y2:"3"})]}),laptop:r.jsxs(r.Fragment,{children:[r.jsx("path",{d:"M20 16V7a2 2 0 0 0-2-2H6a2 2 0 0 0-2 2v9h16z"}),r.jsx("rect",{x:"2",y:"17",width:"20",height:"4",rx:"1"})]}),menu:r.jsxs(r.Fragment,{children:[r.jsx("line",{x1:"3",y1:"12",x2:"21",y2:"12"}),r.jsx("line",{x1:"3",y1:"6",x2:"21",y2:"6"}),r.jsx("line",{x1:"3",y1:"18",x2:"21",y2:"18"})]}),edit:r.jsxs(r.Fragment,{children:[r.jsx("path",{d:"M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"}),r.jsx("path",{d:"M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"})]}),save:r.jsxs(r.Fragment,{children:[r.jsx("path",{d:"M19 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11l5 5v11a2 2 0 0 1-2 2z"}),r.jsx("polyline",{points:"17 21 17 13 7 13 7 21"}),r.jsx("polyline",{points:"7 3 7 8 15 8"})]}),sun:r.jsxs(r.Fragment,{children:[r.jsx("circle",{cx:"12",cy:"12",r:"5"}),r.jsx("line",{x1:"12",y1:"1",x2:"12",y2:"3"}),r.jsx("line",{x1:"12",y1:"21",x2:"12",y2:"23"}),r.jsx("line",{x1:"4.22",y1:"4.22",x2:"5.64",y2:"5.64"}),r.jsx("line",{x1:"18.36",y1:"18.36",x2:"19.78",y2:"19.78"}),r.jsx("line",{x1:"1",y1:"12",x2:"3",y2:"12"}),r.jsx("line",{x1:"21",y1:"12",x2:"23",y2:"12"}),r.jsx("line",{x1:"4.22",y1:"19.78",x2:"5.64",y2:"18.36"}),r.jsx("line",{x1:"18.36",y1:"5.64",x2:"19.78",y2:"4.22"})]}),moon:r.jsx(r.Fragment,{children:r.jsx("path",{d:"M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"})}),code:r.jsxs(r.Fragment,{children:[r.jsx("polyline",{points:"16 18 22 12 16 6"}),r.jsx("polyline",{points:"8 6 2 12 8 18"})]}),"refresh-ccw":r.jsxs(r.Fragment,{children:[r.jsx("polyline",{points:"1 4 1 10 7 10"}),r.jsx("polyline",{points:"23 20 23 14 17 14"}),r.jsx("path",{d:"M20.49 9A9 9 0 0 0 7.2 6.51"}),r.jsx("path",{d:"M3.51 15A9 9 0 0 0 16.8 17.49"})]}),broom:r.jsx(r.Fragment,{children:r.jsx("path",{d:"M9.59 4.59A2 2 0 1 1 11 8H2m10.59 11.41A2 2 0 1 0 14 16H2m15.73-8.27A2.5 2.5 0 1 1 19.5 12H2"})}),settings:r.jsxs(r.Fragment,{children:[r.jsx("circle",{cx:"12",cy:"12",r:"3"}),r.jsx("path",{d:"M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 0 1 0 2.83 2 2 0 0 1-2.83 0l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-2 2 2 2 0 0 1-2-2v-.09A1.65 1.65 0 0 0 9 19.4a1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 0 1-2.83 0 2 2 0 0 1 0-2.83l.06-.06a1.65 1.65 0 0 0 .33-1.82 1.65 1.65 0 0 0-1.51-1H3a2 2 0 0 1-2-2 2 2 0 0 1 2-2h.09A1.65 1.65 0 0 0 4.6 9a1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 0 1 0-2.83 2 2 0 0 1 2.83 0l.06.06a1.65 1.65 0 0 0 1.82.33H9a1.65 1.65 0 0 0 1-1.51V3a2 2 0 0 1 2-2 2 2 0 0 1 2 2v.09a1.65 1.65 0 0 0 1 1.51 1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 0 1 2.83 0 2 2 0 0 1 0 2.83l-.06.06a1.65 1.65 0 0 0-.33 1.82V9a1.65 1.65 0 0 0 1.51 1H21a2 2 0 0 1 2 2 2 2 0 0 1-2 2h-.09a1.65 1.65 0 0 0-1.51 1z"})]}),info:r.jsxs(r.Fragment,{children:[r.jsx("circle",{cx:"12",cy:"12",r:"10"}),r.jsx("line",{x1:"12",y1:"16",x2:"12",y2:"12"}),r.jsx("line",{x1:"12",y1:"8",x2:"12.01",y2:"8"})]}),"chevron-down":r.jsx(r.Fragment,{children:r.jsx("polyline",{points:"6 9 12 15 18 9"})}),eye:r.jsxs(r.Fragment,{children:[r.jsx("path",{d:"M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"}),r.jsx("circle",{cx:"12",cy:"12",r:"3"})]}),"eye-off":r.jsxs(r.Fragment,{children:[r.jsx("path",{d:"M17.94 17.94A10.07 10.07 0 0 1 12 20c-7 0-11-8-11-8a18.45 18.45 0 0 1 5.06-5.94M9.9 4.24A9.12 9.12 0 0 1 12 4c7 0 11 8 11 8a18.5 18.5 0 0 1-2.16 3.19m-6.72-1.07a3 3 0 1 1-4.24-4.24"}),r.jsx("line",{x1:"1",y1:"1",x2:"23",y2:"23"})]}),zap:r.jsx(r.Fragment,{children:r.jsx("polygon",{points:"13 2 3 14 12 14 11 22 21 10 12 10 13 2"})}),"help-circle":r.jsxs(r.Fragment,{children:[r.jsx("circle",{cx:"12",cy:"12",r:"10"}),r.jsx("path",{d:"M9.09 9a3 3 0 0 1 5.83 1c0 2-3 3-3 3"}),r.jsx("line",{x1:"12",y1:"17",x2:"12.01",y2:"17"})]}),google:r.jsxs(r.Fragment,{children:[r.jsx("path",{d:"M17.64 9.2c0-.63-.06-1.25-.16-1.84H9v3.48h4.84c-.2 1.12-.84 2.08-1.74 2.71v2.26h2.92c1.7-1.56 2.68-3.88 2.68-6.61z"}),r.jsx("path",{d:"M9 18c2.43 0 4.47-.8 5.96-2.18l-2.92-2.26c-.8.54-1.82.86-3.04.86-2.34 0-4.32-1.58-5.04-3.7H1v2.34C2.64 16.32 5.57 18 9 18z"}),r.jsx("path",{d:"M3.96 10.71c-.18-.54-.28-1.12-.28-1.71s.1-1.17.28-1.71V4.96H1c-.64 1.28-1 2.74-1 4.34s.36 3.06 1 4.34l2.96-2.34z"}),r.jsx("path",{d:"M9 3.6c1.32 0 2.52.45 3.44 1.34l2.6-2.6C13.46.8 11.43 0 9 0 5.57 0 2.64 1.68 1 4.34l2.96 2.34C4.68 4.54 6.66 3.6 9 3.6z"})]}),folder:r.jsx(r.Fragment,{children:r.jsx("path",{d:"M22 19a2 2 0 0 1-2 2H4a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h5l2 3h9a2 2 0 0 1 2 2z"})}),"folder-plus":r.jsxs(r.Fragment,{children:[r.jsx("path",{d:"M22 19a2 2 0 0 1-2 2H4a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h5l2 3h9a2 2 0 0 1 2 2z"}),r.jsx("line",{x1:"12",y1:"11",x2:"12",y2:"17"}),r.jsx("line",{x1:"9",y1:"14",x2:"15",y2:"14"})]}),"folder-edit":r.jsxs(r.Fragment,{children:[r.jsx("path",{d:"M22 19a2 2 0 0 1-2 2H4a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h5l2 3h9a2 2 0 0 1 2 2z"}),r.jsx("path",{d:"M14 13.5l2 2-4 4-2-2 4-4zm-1.5 2.5l2-2"})]}),list:r.jsxs(r.Fragment,{children:[r.jsx("line",{x1:"8",y1:"6",x2:"21",y2:"6"}),r.jsx("line",{x1:"8",y1:"12",x2:"21",y2:"12"}),r.jsx("line",{x1:"8",y1:"18",x2:"21",y2:"18"}),r.jsx("line",{x1:"3",y1:"6",x2:"3.01",y2:"6"}),r.jsx("line",{x1:"3",y1:"12",x2:"3.01",y2:"12"}),r.jsx("line",{x1:"3",y1:"18",x2:"3.01",y2:"18"})]}),lock:r.jsxs(r.Fragment,{children:[r.jsx("rect",{x:"3",y:"11",width:"18",height:"11",rx:"2",ry:"2"}),r.jsx("path",{d:"M7 11V7a5 5 0 0 1 10 0v4"})]}),unlock:r.jsxs(r.Fragment,{children:[r.jsx("rect",{x:"3",y:"11",width:"18",height:"11",rx:"2",ry:"2"}),r.jsx("path",{d:"M7 11V7a5 5 0 0 1 9.9-1"})]}),archive:r.jsxs(r.Fragment,{children:[r.jsx("polyline",{points:"21 8 21 21 3 21 3 8"}),r.jsx("rect",{x:"1",y:"3",width:"22",height:"5"}),r.jsx("line",{x1:"10",y1:"12",x2:"14",y2:"12"})]}),unarchive:r.jsxs(r.Fragment,{children:[r.jsx("polyline",{points:"21 8 21 21 3 21 3 8"}),r.jsx("rect",{x:"1",y:"3",width:"22",height:"5"}),r.jsx("polyline",{points:"10 13 12 11 14 13"}),r.jsx("line",{x1:"12",y1:"11",x2:"12",y2:"17"})]}),"arrow-down":r.jsxs(r.Fragment,{children:[r.jsx("line",{x1:"12",y1:"5",x2:"12",y2:"19"}),r.jsx("polyline",{points:"19 12 12 19 5 12"})]}),monitor:r.jsxs(r.Fragment,{children:[r.jsx("rect",{x:"2",y:"3",width:"20",height:"14",rx:"2",ry:"2"}),r.jsx("line",{x1:"8",y1:"21",x2:"16",y2:"21"}),r.jsx("line",{x1:"12",y1:"17",x2:"12",y2:"21"})]}),"more-vertical":r.jsxs(r.Fragment,{children:[r.jsx("circle",{cx:"12",cy:"12",r:"1"}),r.jsx("circle",{cx:"12",cy:"5",r:"1"}),r.jsx("circle",{cx:"12",cy:"19",r:"1"})]}),search:r.jsxs(r.Fragment,{children:[r.jsx("circle",{cx:"11",cy:"11",r:"8"}),r.jsx("line",{x1:"21",y1:"21",x2:"16.65",y2:"16.65"})]}),filter:r.jsx(r.Fragment,{children:r.jsx("polygon",{points:"22 3 2 3 10 12.46 10 19 14 21 14 12.46 22 3"})}),layers:r.jsxs(r.Fragment,{children:[r.jsx("polygon",{points:"12 2 2 7 12 12 22 7 12 2"}),r.jsx("polyline",{points:"2 17 12 22 22 17"}),r.jsx("polyline",{points:"2 12 12 17 22 12"})]}),terminal:r.jsxs(r.Fragment,{children:[r.jsx("polyline",{points:"4 17 10 11 4 5"}),r.jsx("line",{x1:"12",y1:"19",x2:"20",y2:"19"})]}),"trending-up":r.jsxs(r.Fragment,{children:[r.jsx("polyline",{points:"23 6 13.5 15.5 8.5 10.5 1 18"}),r.jsx("polyline",{points:"17 6 23 6 23 12"})]}),"grip-vertical":r.jsxs(r.Fragment,{children:[r.jsx("circle",{cx:"9",cy:"12",r:"1"}),r.jsx("circle",{cx:"9",cy:"5",r:"1"}),r.jsx("circle",{cx:"9",cy:"19",r:"1"}),r.jsx("circle",{cx:"15",cy:"12",r:"1"}),r.jsx("circle",{cx:"15",cy:"5",r:"1"}),r.jsx("circle",{cx:"15",cy:"19",r:"1"})]}),repeat:r.jsxs(r.Fragment,{children:[r.jsx("polyline",{points:"17 1 21 5 17 9"}),r.jsx("path",{d:"M3 11V9a4 4 0 0 1 4-4h14"}),r.jsx("polyline",{points:"7 23 3 19 7 15"}),r.jsx("path",{d:"M21 13v2a4 4 0 0 1-4 4H3"})]}),bot:r.jsxs(r.Fragment,{children:[r.jsx("rect",{x:"5",y:"10",width:"14",height:"10",rx:"2"}),r.jsx("circle",{cx:"8.5",cy:"15",r:"1"}),r.jsx("circle",{cx:"15.5",cy:"15",r:"1"}),r.jsx("path",{d:"M9 10V4m6 6V4"}),r.jsx("line",{x1:"9",y1:"4",x2:"15",y2:"4"})]}),"book-open":r.jsxs(r.Fragment,{children:[r.jsx("path",{d:"M2 3h6a4 4 0 0 1 4 4v14a3 3 0 0 0-3-3H2z"}),r.jsx("path",{d:"M22 3h-6a4 4 0 0 0-4 4v14a3 3 0 0 1 3-3h7z"})]})},ae=({name:s,className:p="w-6 h-6",...o})=>r.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",className:`${p} pointer-events-none`,...o,children:mp[s]}),ve=({children:s,variant:p="primary",size:o="md",className:v="",...h})=>{const u="inline-flex items-center justify-center rounded-md font-medium transition-colors focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-offset-background disabled:opacity-50 disabled:pointer-events-none",l={primary:"bg-primary text-on-primary hover:bg-primary-hover focus:ring-primary",secondary:"bg-surface text-text border border-border hover:bg-border/20 focus:ring-primary",danger:"bg-red-600 text-white hover:bg-red-700 focus:ring-red-500",ghost:"text-text-muted hover:bg-border/50 hover:text-text focus:ring-primary"},f={sm:"px-2 py-1 text-xs",md:"px-4 py-2 text-sm",lg:"px-6 py-3 text-base"};return r.jsx("button",{className:`${u} ${l[p]} ${f[o]} ${v}`,...h,children:s})},pp='a[href], button:not([disabled]), textarea, input, select, [tabindex]:not([tabindex="-1"])',pr=(s,p)=>{const o=U.useRef([]);U.useEffect(()=>{if(p&&s.current){o.current=Array.from(s.current.querySelectorAll(pp));const v=o.current[0];v&&setTimeout(()=>v.focus(),100);const h=u=>{var x;if(u.key!=="Tab"||!((x=s.current)!=null&&x.contains(document.activeElement)))return;const l=o.current[0],f=o.current[o.current.length-1];u.shiftKey?document.activeElement===l&&(u.preventDefault(),f==null||f.focus()):document.activeElement===f&&(u.preventDefault(),l==null||l.focus())};return document.addEventListener("keydown",h),()=>{document.removeEventListener("keydown",h)}}},[p,s])},fh=U.createContext(void 0),Kd=()=>window.location.hash.startsWith("#/")?window.location.hash.substring(1):"/",gp=({children:s})=>{const[p,o]=U.useState(Kd()),v=U.useCallback(()=>{o(Kd())},[]);U.useEffect(()=>(window.addEventListener("hashchange",v),()=>{window.removeEventListener("hashchange",v)}),[v]);const h=U.useCallback((l,f)=>{const x=`#${l}`;if(f!=null&&f.replace){const d=new URL(window.location.href);d.hash=x,window.location.replace(d.toString())}else window.location.hash=x},[]),u={path:p,navigate:h};return r.jsx(fh.Provider,{value:u,children:s})},Ln=()=>{const s=U.useContext(fh);if(s===void 0)throw new Error("useRouter must be used within a RouterProvider");return s},Ut=({href:s,children:p,passAs:o,...v})=>{const{navigate:h}=Ln(),u=f=>{f.currentTarget.tagName==="A"&&(f.metaKey||f.ctrlKey)||(f.preventDefault(),v.onClick&&v.onClick(f),h(s))},l=`#${s}`;return o?r.jsx(o,{...v,onClick:u,children:p}):r.jsx("a",{...v,href:l,onClick:u,children:p})},hh=U.createContext(void 0),cc=(s,p)=>{if(typeof window>"u")return p;try{const o=window.localStorage.getItem(s);return o?JSON.parse(o)===!0:p}catch(o){return console.error(`Error reading ${s} from localStorage`,o),p}},xp=()=>{if(typeof window>"u")return!1;try{const s=window.localStorage.getItem("cogniflow-aiFeaturesEnabled");return s!==null?JSON.parse(s)===!0:!!(window.location.origin.endsWith("aistudio.google.com")||window.location.origin.endsWith("scf.usercontent.goog"))}catch(s){return console.error("Error reading cogniflow-aiFeaturesEnabled from localStorage",s),!1}},yp=({children:s})=>{const[p,o]=U.useState(()=>cc("cogniflow-disableAnimations",!1)),[v,h]=U.useState(()=>cc("cogniflow-hapticsEnabled",!0)),[u,l]=U.useState(xp),[f,x]=U.useState(()=>cc("cogniflow-backupEnabled",!1)),[d,T]=U.useState(()=>{try{return window.localStorage.getItem("cogniflow-backupApiKey")||"qRt+gU/57GHKhxTZeRnRi+dfT274iSkKKq2UnTr9Bxs="}catch{return"qRt+gU/57GHKhxTZeRnRi+dfT274iSkKKq2UnTr9Bxs="}}),b=U.useCallback(j=>{o(j);try{window.localStorage.setItem("cogniflow-disableAnimations",JSON.stringify(j))}catch(O){console.error("Error writing animation setting to localStorage",O)}},[]),N=U.useCallback(j=>{h(j);try{window.localStorage.setItem("cogniflow-hapticsEnabled",JSON.stringify(j))}catch(O){console.error("Error writing haptics setting to localStorage",O)}},[]),w=U.useCallback(j=>{l(j);try{window.localStorage.setItem("cogniflow-aiFeaturesEnabled",JSON.stringify(j))}catch(O){console.error("Error writing AI features setting to localStorage",O)}},[]),I=U.useCallback(j=>{x(j);try{window.localStorage.setItem("cogniflow-backupEnabled",JSON.stringify(j))}catch(O){console.error("Error writing backup enabled setting to localStorage",O)}},[]),k=U.useCallback(j=>{T(j);try{window.localStorage.setItem("cogniflow-backupApiKey",j)}catch(O){console.error("Error writing backup API key to localStorage",O)}},[]),C={disableAnimations:p,setDisableAnimations:b,hapticsEnabled:v,setHapticsEnabled:N,aiFeaturesEnabled:u,setAiFeaturesEnabled:w,backupEnabled:f,setBackupEnabled:I,backupApiKey:d,setBackupApiKey:k};return r.jsx(hh.Provider,{value:C,children:s})},on=()=>{const s=U.useContext(hh);if(s===void 0)throw new Error("useSettings must be used within a SettingsProvider");return s},vp=({isOpen:s,onClose:p,onImport:o,onCreateSeries:v,onGenerateAI:h,onInstall:u})=>{const l=U.useRef(null),{aiFeaturesEnabled:f}=on();return pr(l,s),U.useEffect(()=>{const x=d=>{d.key==="Escape"&&p()};return s&&document.addEventListener("keydown",x),()=>{document.removeEventListener("keydown",x)}},[s,p]),r.jsxs(r.Fragment,{children:[r.jsx("div",{className:`fixed inset-0 bg-black bg-opacity-60 z-50 transition-opacity duration-300 ${s?"opacity-100":"opacity-0 pointer-events-none"}`,onClick:p,"aria-hidden":"true"}),r.jsx("div",{ref:l,className:`fixed top-0 right-0 h-full w-full max-w-xs z-[51] transform transition-transform duration-300 ease-in-out ${s?"translate-x-0":"translate-x-full"}`,role:"dialog","aria-modal":"true","aria-labelledby":"sidebar-title",children:r.jsxs("div",{className:"bg-surface shadow-xl h-full flex flex-col",children:[r.jsxs("div",{className:"flex items-center justify-between p-4 border-b border-border",children:[r.jsx("h2",{id:"sidebar-title",className:"text-xl font-bold text-transparent bg-clip-text bg-gradient-to-r from-blue-400 to-teal-300",children:"Menu"}),r.jsx(ve,{variant:"ghost",onClick:p,className:"p-1 h-auto","aria-label":"Close menu",children:r.jsx(ae,{name:"x"})})]}),r.jsxs("nav",{className:"flex-grow p-4 space-y-2",children:[r.jsxs(Ut,{href:"/",onClick:p,className:"flex items-center px-3 py-2 text-text rounded-md hover:bg-border/30 text-lg",children:[r.jsx(ae,{name:"laptop",className:"w-6 h-6 mr-3"})," Home"]}),r.jsxs(Ut,{href:"/series",onClick:p,className:"flex items-center px-3 py-2 text-text rounded-md hover:bg-border/30 text-lg",children:[r.jsx(ae,{name:"layers",className:"w-6 h-6 mr-3"})," Series"]}),r.jsxs(Ut,{href:"/decks",onClick:p,className:"flex items-center px-3 py-2 text-text rounded-md hover:bg-border/30 text-lg",children:[r.jsx(ae,{name:"folder",className:"w-6 h-6 mr-3"})," Decks"]}),r.jsxs(Ut,{href:"/progress",onClick:p,className:"flex items-center px-3 py-2 text-text rounded-md hover:bg-border/30 text-lg",children:[r.jsx(ae,{name:"trending-up",className:"w-6 h-6 mr-3"}),"Progress"]}),r.jsxs(Ut,{href:"/archive",onClick:p,className:"flex items-center px-3 py-2 text-text rounded-md hover:bg-border/30 text-lg",children:[r.jsx(ae,{name:"archive",className:"w-6 h-6 mr-3"}),"Archive"]}),r.jsxs(Ut,{href:"/trash",onClick:p,className:"flex items-center px-3 py-2 text-text rounded-md hover:bg-border/30 text-lg",children:[r.jsx(ae,{name:"trash-2",className:"w-6 h-6 mr-3"}),"Trash"]}),r.jsxs(Ut,{href:"/settings",onClick:p,className:"flex items-center px-3 py-2 text-text rounded-md hover:bg-border/30 text-lg",children:[r.jsx(ae,{name:"settings",className:"w-6 h-6 mr-3"}),"Settings"]}),r.jsxs(Ut,{href:"/instructions/json",onClick:p,className:"flex items-center px-3 py-2 text-text rounded-md hover:bg-border/30 text-lg",children:[r.jsx(ae,{name:"help-circle",className:"w-6 h-6 mr-3"}),"JSON Guide"]})]}),r.jsxs("div",{className:"p-4 border-t border-border space-y-2",children:[f&&r.jsxs(ve,{variant:"primary",onClick:h,className:"w-full",children:[r.jsx(ae,{name:"zap",className:"w-5 h-5 mr-2"}),"Generate with AI"]}),r.jsxs(ve,{variant:"secondary",onClick:v,className:"w-full",children:[r.jsx(ae,{name:"layers",className:"w-5 h-5 mr-2"}),"Create New Series"]}),r.jsxs(ve,{variant:"secondary",onClick:o,className:"w-full",children:[r.jsx(ae,{name:"plus",className:"w-5 h-5 mr-2"}),"Create / Import Deck"]}),u&&r.jsxs(ve,{variant:"secondary",onClick:u,className:"w-full",children:[r.jsx(ae,{name:"download",className:"w-5 h-5 mr-2"}),"Install App"]})]})]})})]})},wp={success:r.jsx(ae,{name:"check-circle",className:"w-6 h-6 text-green-500"}),error:r.jsx(ae,{name:"x-circle",className:"w-6 h-6 text-red-500"}),info:r.jsx(ae,{name:"info",className:"w-6 h-6 text-blue-500"})},bp=({message:s,onDismiss:p})=>(U.useEffect(()=>{const o=setTimeout(()=>{p(s.id)},5e3);return()=>{clearTimeout(o)}},[s.id,p]),r.jsx("div",{className:"bg-surface shadow-lg rounded-lg pointer-events-auto ring-1 ring-black ring-opacity-5 overflow-hidden animate-fade-in-right",children:r.jsx("div",{className:"p-4",children:r.jsxs("div",{className:"flex items-start",children:[r.jsx("div",{className:"flex-shrink-0",children:wp[s.type]}),r.jsx("div",{className:"ml-3 w-0 flex-1 pt-0.5",children:r.jsx("p",{className:"text-sm font-medium text-text break-words",children:s.message})}),r.jsx("div",{className:"ml-4 flex-shrink-0 flex",children:r.jsxs("button",{onClick:()=>p(s.id),className:"bg-surface rounded-md inline-flex text-text-muted hover:text-text focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-offset-surface focus:ring-primary",children:[r.jsx("span",{className:"sr-only",children:"Close"}),r.jsx(ae,{name:"x",className:"h-5 w-5"})]})})]})})})),mh=U.createContext(void 0),kp=({children:s})=>{const[p,o]=U.useState([]),v=U.useCallback((u,l)=>{const f=crypto.randomUUID();o(x=>[...x,{id:f,message:u,type:l}])},[]),h=U.useCallback(u=>{o(l=>l.filter(f=>f.id!==u))},[]);return r.jsxs(mh.Provider,{value:{addToast:v},children:[s,r.jsx("div",{className:"fixed top-5 right-5 z-[100] w-full max-w-xs space-y-3",children:p.map(u=>r.jsx(bp,{message:u,onDismiss:h},u.id))})]})},er=()=>{const s=U.useContext(mh);if(s===void 0)throw new Error("useToast must be used within a ToastProvider");return s},sr=({size:s="md"})=>{const p={sm:"h-6 w-6",md:"h-10 w-10",lg:"h-16 w-16"};return r.jsx("div",{className:"flex justify-center items-center p-4",role:"status","aria-label":"Loading",children:r.jsxs("svg",{className:`animate-spin text-blue-500 dark:text-blue-400 ${p[s]}`,xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",children:[r.jsx("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),r.jsx("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]})})};function po(s){throw new Error('Could not dynamically require "'+s+'". Please configure the dynamicRequireTargets or/and ignoreDynamicRequires option of @rollup/plugin-commonjs appropriately for this require call to work.')}var uc={exports:{}};/*!

JSZip v3.10.1 - A JavaScript class for generating and reading zip files
<http://stuartk.com/jszip>

(c) 2009-2016 Stuart Knightley <stuart [at] stuartk.com>
Dual licenced under the MIT license or GPLv3. See https://raw.github.com/Stuk/jszip/main/LICENSE.markdown.

JSZip uses the library pako released under the MIT license :
https://github.com/nodeca/pako/blob/main/LICENSE
*/var Zd;function Sp(){return Zd||(Zd=1,function(s,p){(function(o){s.exports=o()})(function(){return function o(v,h,u){function l(d,T){if(!h[d]){if(!v[d]){var b=typeof po=="function"&&po;if(!T&&b)return b(d,!0);if(f)return f(d,!0);var N=new Error("Cannot find module '"+d+"'");throw N.code="MODULE_NOT_FOUND",N}var w=h[d]={exports:{}};v[d][0].call(w.exports,function(I){var k=v[d][1][I];return l(k||I)},w,w.exports,o,v,h,u)}return h[d].exports}for(var f=typeof po=="function"&&po,x=0;x<u.length;x++)l(u[x]);return l}({1:[function(o,v,h){var u=o("./utils"),l=o("./support"),f="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";h.encode=function(x){for(var d,T,b,N,w,I,k,C=[],j=0,O=x.length,F=O,R=u.getTypeOf(x)!=="string";j<x.length;)F=O-j,b=R?(d=x[j++],T=j<O?x[j++]:0,j<O?x[j++]:0):(d=x.charCodeAt(j++),T=j<O?x.charCodeAt(j++):0,j<O?x.charCodeAt(j++):0),N=d>>2,w=(3&d)<<4|T>>4,I=1<F?(15&T)<<2|b>>6:64,k=2<F?63&b:64,C.push(f.charAt(N)+f.charAt(w)+f.charAt(I)+f.charAt(k));return C.join("")},h.decode=function(x){var d,T,b,N,w,I,k=0,C=0,j="data:";if(x.substr(0,j.length)===j)throw new Error("Invalid base64 input, it looks like a data url.");var O,F=3*(x=x.replace(/[^A-Za-z0-9+/=]/g,"")).length/4;if(x.charAt(x.length-1)===f.charAt(64)&&F--,x.charAt(x.length-2)===f.charAt(64)&&F--,F%1!=0)throw new Error("Invalid base64 input, bad content length.");for(O=l.uint8array?new Uint8Array(0|F):new Array(0|F);k<x.length;)d=f.indexOf(x.charAt(k++))<<2|(N=f.indexOf(x.charAt(k++)))>>4,T=(15&N)<<4|(w=f.indexOf(x.charAt(k++)))>>2,b=(3&w)<<6|(I=f.indexOf(x.charAt(k++))),O[C++]=d,w!==64&&(O[C++]=T),I!==64&&(O[C++]=b);return O}},{"./support":30,"./utils":32}],2:[function(o,v,h){var u=o("./external"),l=o("./stream/DataWorker"),f=o("./stream/Crc32Probe"),x=o("./stream/DataLengthProbe");function d(T,b,N,w,I){this.compressedSize=T,this.uncompressedSize=b,this.crc32=N,this.compression=w,this.compressedContent=I}d.prototype={getContentWorker:function(){var T=new l(u.Promise.resolve(this.compressedContent)).pipe(this.compression.uncompressWorker()).pipe(new x("data_length")),b=this;return T.on("end",function(){if(this.streamInfo.data_length!==b.uncompressedSize)throw new Error("Bug : uncompressed data size mismatch")}),T},getCompressedWorker:function(){return new l(u.Promise.resolve(this.compressedContent)).withStreamInfo("compressedSize",this.compressedSize).withStreamInfo("uncompressedSize",this.uncompressedSize).withStreamInfo("crc32",this.crc32).withStreamInfo("compression",this.compression)}},d.createWorkerFrom=function(T,b,N){return T.pipe(new f).pipe(new x("uncompressedSize")).pipe(b.compressWorker(N)).pipe(new x("compressedSize")).withStreamInfo("compression",b)},v.exports=d},{"./external":6,"./stream/Crc32Probe":25,"./stream/DataLengthProbe":26,"./stream/DataWorker":27}],3:[function(o,v,h){var u=o("./stream/GenericWorker");h.STORE={magic:"\0\0",compressWorker:function(){return new u("STORE compression")},uncompressWorker:function(){return new u("STORE decompression")}},h.DEFLATE=o("./flate")},{"./flate":7,"./stream/GenericWorker":28}],4:[function(o,v,h){var u=o("./utils"),l=function(){for(var f,x=[],d=0;d<256;d++){f=d;for(var T=0;T<8;T++)f=1&f?3988292384^f>>>1:f>>>1;x[d]=f}return x}();v.exports=function(f,x){return f!==void 0&&f.length?u.getTypeOf(f)!=="string"?function(d,T,b,N){var w=l,I=N+b;d^=-1;for(var k=N;k<I;k++)d=d>>>8^w[255&(d^T[k])];return-1^d}(0|x,f,f.length,0):function(d,T,b,N){var w=l,I=N+b;d^=-1;for(var k=N;k<I;k++)d=d>>>8^w[255&(d^T.charCodeAt(k))];return-1^d}(0|x,f,f.length,0):0}},{"./utils":32}],5:[function(o,v,h){h.base64=!1,h.binary=!1,h.dir=!1,h.createFolders=!0,h.date=null,h.compression=null,h.compressionOptions=null,h.comment=null,h.unixPermissions=null,h.dosPermissions=null},{}],6:[function(o,v,h){var u=null;u=typeof Promise<"u"?Promise:o("lie"),v.exports={Promise:u}},{lie:37}],7:[function(o,v,h){var u=typeof Uint8Array<"u"&&typeof Uint16Array<"u"&&typeof Uint32Array<"u",l=o("pako"),f=o("./utils"),x=o("./stream/GenericWorker"),d=u?"uint8array":"array";function T(b,N){x.call(this,"FlateWorker/"+b),this._pako=null,this._pakoAction=b,this._pakoOptions=N,this.meta={}}h.magic="\b\0",f.inherits(T,x),T.prototype.processChunk=function(b){this.meta=b.meta,this._pako===null&&this._createPako(),this._pako.push(f.transformTo(d,b.data),!1)},T.prototype.flush=function(){x.prototype.flush.call(this),this._pako===null&&this._createPako(),this._pako.push([],!0)},T.prototype.cleanUp=function(){x.prototype.cleanUp.call(this),this._pako=null},T.prototype._createPako=function(){this._pako=new l[this._pakoAction]({raw:!0,level:this._pakoOptions.level||-1});var b=this;this._pako.onData=function(N){b.push({data:N,meta:b.meta})}},h.compressWorker=function(b){return new T("Deflate",b)},h.uncompressWorker=function(){return new T("Inflate",{})}},{"./stream/GenericWorker":28,"./utils":32,pako:38}],8:[function(o,v,h){function u(w,I){var k,C="";for(k=0;k<I;k++)C+=String.fromCharCode(255&w),w>>>=8;return C}function l(w,I,k,C,j,O){var F,R,M=w.file,H=w.compression,V=O!==d.utf8encode,oe=f.transformTo("string",O(M.name)),J=f.transformTo("string",d.utf8encode(M.name)),Z=M.comment,de=f.transformTo("string",O(Z)),$=f.transformTo("string",d.utf8encode(Z)),W=J.length!==M.name.length,_=$.length!==Z.length,ie="",be="",ge="",je=M.dir,fe=M.date,B={crc32:0,compressedSize:0,uncompressedSize:0};I&&!k||(B.crc32=w.crc32,B.compressedSize=w.compressedSize,B.uncompressedSize=w.uncompressedSize);var S=0;I&&(S|=8),V||!W&&!_||(S|=2048);var A=0,ce=0;je&&(A|=16),j==="UNIX"?(ce=798,A|=function(me,Te){var he=me;return me||(he=Te?16893:33204),(65535&he)<<16}(M.unixPermissions,je)):(ce=20,A|=function(me){return 63&(me||0)}(M.dosPermissions)),F=fe.getUTCHours(),F<<=6,F|=fe.getUTCMinutes(),F<<=5,F|=fe.getUTCSeconds()/2,R=fe.getUTCFullYear()-1980,R<<=4,R|=fe.getUTCMonth()+1,R<<=5,R|=fe.getUTCDate(),W&&(be=u(1,1)+u(T(oe),4)+J,ie+="up"+u(be.length,2)+be),_&&(ge=u(1,1)+u(T(de),4)+$,ie+="uc"+u(ge.length,2)+ge);var pe="";return pe+=`
\0`,pe+=u(S,2),pe+=H.magic,pe+=u(F,2),pe+=u(R,2),pe+=u(B.crc32,4),pe+=u(B.compressedSize,4),pe+=u(B.uncompressedSize,4),pe+=u(oe.length,2),pe+=u(ie.length,2),{fileRecord:b.LOCAL_FILE_HEADER+pe+oe+ie,dirRecord:b.CENTRAL_FILE_HEADER+u(ce,2)+pe+u(de.length,2)+"\0\0\0\0"+u(A,4)+u(C,4)+oe+ie+de}}var f=o("../utils"),x=o("../stream/GenericWorker"),d=o("../utf8"),T=o("../crc32"),b=o("../signature");function N(w,I,k,C){x.call(this,"ZipFileWorker"),this.bytesWritten=0,this.zipComment=I,this.zipPlatform=k,this.encodeFileName=C,this.streamFiles=w,this.accumulate=!1,this.contentBuffer=[],this.dirRecords=[],this.currentSourceOffset=0,this.entriesCount=0,this.currentFile=null,this._sources=[]}f.inherits(N,x),N.prototype.push=function(w){var I=w.meta.percent||0,k=this.entriesCount,C=this._sources.length;this.accumulate?this.contentBuffer.push(w):(this.bytesWritten+=w.data.length,x.prototype.push.call(this,{data:w.data,meta:{currentFile:this.currentFile,percent:k?(I+100*(k-C-1))/k:100}}))},N.prototype.openedSource=function(w){this.currentSourceOffset=this.bytesWritten,this.currentFile=w.file.name;var I=this.streamFiles&&!w.file.dir;if(I){var k=l(w,I,!1,this.currentSourceOffset,this.zipPlatform,this.encodeFileName);this.push({data:k.fileRecord,meta:{percent:0}})}else this.accumulate=!0},N.prototype.closedSource=function(w){this.accumulate=!1;var I=this.streamFiles&&!w.file.dir,k=l(w,I,!0,this.currentSourceOffset,this.zipPlatform,this.encodeFileName);if(this.dirRecords.push(k.dirRecord),I)this.push({data:function(C){return b.DATA_DESCRIPTOR+u(C.crc32,4)+u(C.compressedSize,4)+u(C.uncompressedSize,4)}(w),meta:{percent:100}});else for(this.push({data:k.fileRecord,meta:{percent:0}});this.contentBuffer.length;)this.push(this.contentBuffer.shift());this.currentFile=null},N.prototype.flush=function(){for(var w=this.bytesWritten,I=0;I<this.dirRecords.length;I++)this.push({data:this.dirRecords[I],meta:{percent:100}});var k=this.bytesWritten-w,C=function(j,O,F,R,M){var H=f.transformTo("string",M(R));return b.CENTRAL_DIRECTORY_END+"\0\0\0\0"+u(j,2)+u(j,2)+u(O,4)+u(F,4)+u(H.length,2)+H}(this.dirRecords.length,k,w,this.zipComment,this.encodeFileName);this.push({data:C,meta:{percent:100}})},N.prototype.prepareNextSource=function(){this.previous=this._sources.shift(),this.openedSource(this.previous.streamInfo),this.isPaused?this.previous.pause():this.previous.resume()},N.prototype.registerPrevious=function(w){this._sources.push(w);var I=this;return w.on("data",function(k){I.processChunk(k)}),w.on("end",function(){I.closedSource(I.previous.streamInfo),I._sources.length?I.prepareNextSource():I.end()}),w.on("error",function(k){I.error(k)}),this},N.prototype.resume=function(){return!!x.prototype.resume.call(this)&&(!this.previous&&this._sources.length?(this.prepareNextSource(),!0):this.previous||this._sources.length||this.generatedError?void 0:(this.end(),!0))},N.prototype.error=function(w){var I=this._sources;if(!x.prototype.error.call(this,w))return!1;for(var k=0;k<I.length;k++)try{I[k].error(w)}catch{}return!0},N.prototype.lock=function(){x.prototype.lock.call(this);for(var w=this._sources,I=0;I<w.length;I++)w[I].lock()},v.exports=N},{"../crc32":4,"../signature":23,"../stream/GenericWorker":28,"../utf8":31,"../utils":32}],9:[function(o,v,h){var u=o("../compressions"),l=o("./ZipFileWorker");h.generateWorker=function(f,x,d){var T=new l(x.streamFiles,d,x.platform,x.encodeFileName),b=0;try{f.forEach(function(N,w){b++;var I=function(O,F){var R=O||F,M=u[R];if(!M)throw new Error(R+" is not a valid compression method !");return M}(w.options.compression,x.compression),k=w.options.compressionOptions||x.compressionOptions||{},C=w.dir,j=w.date;w._compressWorker(I,k).withStreamInfo("file",{name:N,dir:C,date:j,comment:w.comment||"",unixPermissions:w.unixPermissions,dosPermissions:w.dosPermissions}).pipe(T)}),T.entriesCount=b}catch(N){T.error(N)}return T}},{"../compressions":3,"./ZipFileWorker":8}],10:[function(o,v,h){function u(){if(!(this instanceof u))return new u;if(arguments.length)throw new Error("The constructor with parameters has been removed in JSZip 3.0, please check the upgrade guide.");this.files=Object.create(null),this.comment=null,this.root="",this.clone=function(){var l=new u;for(var f in this)typeof this[f]!="function"&&(l[f]=this[f]);return l}}(u.prototype=o("./object")).loadAsync=o("./load"),u.support=o("./support"),u.defaults=o("./defaults"),u.version="3.10.1",u.loadAsync=function(l,f){return new u().loadAsync(l,f)},u.external=o("./external"),v.exports=u},{"./defaults":5,"./external":6,"./load":11,"./object":15,"./support":30}],11:[function(o,v,h){var u=o("./utils"),l=o("./external"),f=o("./utf8"),x=o("./zipEntries"),d=o("./stream/Crc32Probe"),T=o("./nodejsUtils");function b(N){return new l.Promise(function(w,I){var k=N.decompressed.getContentWorker().pipe(new d);k.on("error",function(C){I(C)}).on("end",function(){k.streamInfo.crc32!==N.decompressed.crc32?I(new Error("Corrupted zip : CRC32 mismatch")):w()}).resume()})}v.exports=function(N,w){var I=this;return w=u.extend(w||{},{base64:!1,checkCRC32:!1,optimizedBinaryString:!1,createFolders:!1,decodeFileName:f.utf8decode}),T.isNode&&T.isStream(N)?l.Promise.reject(new Error("JSZip can't accept a stream when loading a zip file.")):u.prepareContent("the loaded zip file",N,!0,w.optimizedBinaryString,w.base64).then(function(k){var C=new x(w);return C.load(k),C}).then(function(k){var C=[l.Promise.resolve(k)],j=k.files;if(w.checkCRC32)for(var O=0;O<j.length;O++)C.push(b(j[O]));return l.Promise.all(C)}).then(function(k){for(var C=k.shift(),j=C.files,O=0;O<j.length;O++){var F=j[O],R=F.fileNameStr,M=u.resolve(F.fileNameStr);I.file(M,F.decompressed,{binary:!0,optimizedBinaryString:!0,date:F.date,dir:F.dir,comment:F.fileCommentStr.length?F.fileCommentStr:null,unixPermissions:F.unixPermissions,dosPermissions:F.dosPermissions,createFolders:w.createFolders}),F.dir||(I.file(M).unsafeOriginalName=R)}return C.zipComment.length&&(I.comment=C.zipComment),I})}},{"./external":6,"./nodejsUtils":14,"./stream/Crc32Probe":25,"./utf8":31,"./utils":32,"./zipEntries":33}],12:[function(o,v,h){var u=o("../utils"),l=o("../stream/GenericWorker");function f(x,d){l.call(this,"Nodejs stream input adapter for "+x),this._upstreamEnded=!1,this._bindStream(d)}u.inherits(f,l),f.prototype._bindStream=function(x){var d=this;(this._stream=x).pause(),x.on("data",function(T){d.push({data:T,meta:{percent:0}})}).on("error",function(T){d.isPaused?this.generatedError=T:d.error(T)}).on("end",function(){d.isPaused?d._upstreamEnded=!0:d.end()})},f.prototype.pause=function(){return!!l.prototype.pause.call(this)&&(this._stream.pause(),!0)},f.prototype.resume=function(){return!!l.prototype.resume.call(this)&&(this._upstreamEnded?this.end():this._stream.resume(),!0)},v.exports=f},{"../stream/GenericWorker":28,"../utils":32}],13:[function(o,v,h){var u=o("readable-stream").Readable;function l(f,x,d){u.call(this,x),this._helper=f;var T=this;f.on("data",function(b,N){T.push(b)||T._helper.pause(),d&&d(N)}).on("error",function(b){T.emit("error",b)}).on("end",function(){T.push(null)})}o("../utils").inherits(l,u),l.prototype._read=function(){this._helper.resume()},v.exports=l},{"../utils":32,"readable-stream":16}],14:[function(o,v,h){v.exports={isNode:typeof Buffer<"u",newBufferFrom:function(u,l){if(Buffer.from&&Buffer.from!==Uint8Array.from)return Buffer.from(u,l);if(typeof u=="number")throw new Error('The "data" argument must not be a number');return new Buffer(u,l)},allocBuffer:function(u){if(Buffer.alloc)return Buffer.alloc(u);var l=new Buffer(u);return l.fill(0),l},isBuffer:function(u){return Buffer.isBuffer(u)},isStream:function(u){return u&&typeof u.on=="function"&&typeof u.pause=="function"&&typeof u.resume=="function"}}},{}],15:[function(o,v,h){function u(M,H,V){var oe,J=f.getTypeOf(H),Z=f.extend(V||{},T);Z.date=Z.date||new Date,Z.compression!==null&&(Z.compression=Z.compression.toUpperCase()),typeof Z.unixPermissions=="string"&&(Z.unixPermissions=parseInt(Z.unixPermissions,8)),Z.unixPermissions&&16384&Z.unixPermissions&&(Z.dir=!0),Z.dosPermissions&&16&Z.dosPermissions&&(Z.dir=!0),Z.dir&&(M=j(M)),Z.createFolders&&(oe=C(M))&&O.call(this,oe,!0);var de=J==="string"&&Z.binary===!1&&Z.base64===!1;V&&V.binary!==void 0||(Z.binary=!de),(H instanceof b&&H.uncompressedSize===0||Z.dir||!H||H.length===0)&&(Z.base64=!1,Z.binary=!0,H="",Z.compression="STORE",J="string");var $=null;$=H instanceof b||H instanceof x?H:I.isNode&&I.isStream(H)?new k(M,H):f.prepareContent(M,H,Z.binary,Z.optimizedBinaryString,Z.base64);var W=new N(M,$,Z);this.files[M]=W}var l=o("./utf8"),f=o("./utils"),x=o("./stream/GenericWorker"),d=o("./stream/StreamHelper"),T=o("./defaults"),b=o("./compressedObject"),N=o("./zipObject"),w=o("./generate"),I=o("./nodejsUtils"),k=o("./nodejs/NodejsStreamInputAdapter"),C=function(M){M.slice(-1)==="/"&&(M=M.substring(0,M.length-1));var H=M.lastIndexOf("/");return 0<H?M.substring(0,H):""},j=function(M){return M.slice(-1)!=="/"&&(M+="/"),M},O=function(M,H){return H=H!==void 0?H:T.createFolders,M=j(M),this.files[M]||u.call(this,M,null,{dir:!0,createFolders:H}),this.files[M]};function F(M){return Object.prototype.toString.call(M)==="[object RegExp]"}var R={load:function(){throw new Error("This method has been removed in JSZip 3.0, please check the upgrade guide.")},forEach:function(M){var H,V,oe;for(H in this.files)oe=this.files[H],(V=H.slice(this.root.length,H.length))&&H.slice(0,this.root.length)===this.root&&M(V,oe)},filter:function(M){var H=[];return this.forEach(function(V,oe){M(V,oe)&&H.push(oe)}),H},file:function(M,H,V){if(arguments.length!==1)return M=this.root+M,u.call(this,M,H,V),this;if(F(M)){var oe=M;return this.filter(function(Z,de){return!de.dir&&oe.test(Z)})}var J=this.files[this.root+M];return J&&!J.dir?J:null},folder:function(M){if(!M)return this;if(F(M))return this.filter(function(J,Z){return Z.dir&&M.test(J)});var H=this.root+M,V=O.call(this,H),oe=this.clone();return oe.root=V.name,oe},remove:function(M){M=this.root+M;var H=this.files[M];if(H||(M.slice(-1)!=="/"&&(M+="/"),H=this.files[M]),H&&!H.dir)delete this.files[M];else for(var V=this.filter(function(J,Z){return Z.name.slice(0,M.length)===M}),oe=0;oe<V.length;oe++)delete this.files[V[oe].name];return this},generate:function(){throw new Error("This method has been removed in JSZip 3.0, please check the upgrade guide.")},generateInternalStream:function(M){var H,V={};try{if((V=f.extend(M||{},{streamFiles:!1,compression:"STORE",compressionOptions:null,type:"",platform:"DOS",comment:null,mimeType:"application/zip",encodeFileName:l.utf8encode})).type=V.type.toLowerCase(),V.compression=V.compression.toUpperCase(),V.type==="binarystring"&&(V.type="string"),!V.type)throw new Error("No output type specified.");f.checkSupport(V.type),V.platform!=="darwin"&&V.platform!=="freebsd"&&V.platform!=="linux"&&V.platform!=="sunos"||(V.platform="UNIX"),V.platform==="win32"&&(V.platform="DOS");var oe=V.comment||this.comment||"";H=w.generateWorker(this,V,oe)}catch(J){(H=new x("error")).error(J)}return new d(H,V.type||"string",V.mimeType)},generateAsync:function(M,H){return this.generateInternalStream(M).accumulate(H)},generateNodeStream:function(M,H){return(M=M||{}).type||(M.type="nodebuffer"),this.generateInternalStream(M).toNodejsStream(H)}};v.exports=R},{"./compressedObject":2,"./defaults":5,"./generate":9,"./nodejs/NodejsStreamInputAdapter":12,"./nodejsUtils":14,"./stream/GenericWorker":28,"./stream/StreamHelper":29,"./utf8":31,"./utils":32,"./zipObject":35}],16:[function(o,v,h){v.exports=o("stream")},{stream:void 0}],17:[function(o,v,h){var u=o("./DataReader");function l(f){u.call(this,f);for(var x=0;x<this.data.length;x++)f[x]=255&f[x]}o("../utils").inherits(l,u),l.prototype.byteAt=function(f){return this.data[this.zero+f]},l.prototype.lastIndexOfSignature=function(f){for(var x=f.charCodeAt(0),d=f.charCodeAt(1),T=f.charCodeAt(2),b=f.charCodeAt(3),N=this.length-4;0<=N;--N)if(this.data[N]===x&&this.data[N+1]===d&&this.data[N+2]===T&&this.data[N+3]===b)return N-this.zero;return-1},l.prototype.readAndCheckSignature=function(f){var x=f.charCodeAt(0),d=f.charCodeAt(1),T=f.charCodeAt(2),b=f.charCodeAt(3),N=this.readData(4);return x===N[0]&&d===N[1]&&T===N[2]&&b===N[3]},l.prototype.readData=function(f){if(this.checkOffset(f),f===0)return[];var x=this.data.slice(this.zero+this.index,this.zero+this.index+f);return this.index+=f,x},v.exports=l},{"../utils":32,"./DataReader":18}],18:[function(o,v,h){var u=o("../utils");function l(f){this.data=f,this.length=f.length,this.index=0,this.zero=0}l.prototype={checkOffset:function(f){this.checkIndex(this.index+f)},checkIndex:function(f){if(this.length<this.zero+f||f<0)throw new Error("End of data reached (data length = "+this.length+", asked index = "+f+"). Corrupted zip ?")},setIndex:function(f){this.checkIndex(f),this.index=f},skip:function(f){this.setIndex(this.index+f)},byteAt:function(){},readInt:function(f){var x,d=0;for(this.checkOffset(f),x=this.index+f-1;x>=this.index;x--)d=(d<<8)+this.byteAt(x);return this.index+=f,d},readString:function(f){return u.transformTo("string",this.readData(f))},readData:function(){},lastIndexOfSignature:function(){},readAndCheckSignature:function(){},readDate:function(){var f=this.readInt(4);return new Date(Date.UTC(1980+(f>>25&127),(f>>21&15)-1,f>>16&31,f>>11&31,f>>5&63,(31&f)<<1))}},v.exports=l},{"../utils":32}],19:[function(o,v,h){var u=o("./Uint8ArrayReader");function l(f){u.call(this,f)}o("../utils").inherits(l,u),l.prototype.readData=function(f){this.checkOffset(f);var x=this.data.slice(this.zero+this.index,this.zero+this.index+f);return this.index+=f,x},v.exports=l},{"../utils":32,"./Uint8ArrayReader":21}],20:[function(o,v,h){var u=o("./DataReader");function l(f){u.call(this,f)}o("../utils").inherits(l,u),l.prototype.byteAt=function(f){return this.data.charCodeAt(this.zero+f)},l.prototype.lastIndexOfSignature=function(f){return this.data.lastIndexOf(f)-this.zero},l.prototype.readAndCheckSignature=function(f){return f===this.readData(4)},l.prototype.readData=function(f){this.checkOffset(f);var x=this.data.slice(this.zero+this.index,this.zero+this.index+f);return this.index+=f,x},v.exports=l},{"../utils":32,"./DataReader":18}],21:[function(o,v,h){var u=o("./ArrayReader");function l(f){u.call(this,f)}o("../utils").inherits(l,u),l.prototype.readData=function(f){if(this.checkOffset(f),f===0)return new Uint8Array(0);var x=this.data.subarray(this.zero+this.index,this.zero+this.index+f);return this.index+=f,x},v.exports=l},{"../utils":32,"./ArrayReader":17}],22:[function(o,v,h){var u=o("../utils"),l=o("../support"),f=o("./ArrayReader"),x=o("./StringReader"),d=o("./NodeBufferReader"),T=o("./Uint8ArrayReader");v.exports=function(b){var N=u.getTypeOf(b);return u.checkSupport(N),N!=="string"||l.uint8array?N==="nodebuffer"?new d(b):l.uint8array?new T(u.transformTo("uint8array",b)):new f(u.transformTo("array",b)):new x(b)}},{"../support":30,"../utils":32,"./ArrayReader":17,"./NodeBufferReader":19,"./StringReader":20,"./Uint8ArrayReader":21}],23:[function(o,v,h){h.LOCAL_FILE_HEADER="PK",h.CENTRAL_FILE_HEADER="PK",h.CENTRAL_DIRECTORY_END="PK",h.ZIP64_CENTRAL_DIRECTORY_LOCATOR="PK\x07",h.ZIP64_CENTRAL_DIRECTORY_END="PK",h.DATA_DESCRIPTOR="PK\x07\b"},{}],24:[function(o,v,h){var u=o("./GenericWorker"),l=o("../utils");function f(x){u.call(this,"ConvertWorker to "+x),this.destType=x}l.inherits(f,u),f.prototype.processChunk=function(x){this.push({data:l.transformTo(this.destType,x.data),meta:x.meta})},v.exports=f},{"../utils":32,"./GenericWorker":28}],25:[function(o,v,h){var u=o("./GenericWorker"),l=o("../crc32");function f(){u.call(this,"Crc32Probe"),this.withStreamInfo("crc32",0)}o("../utils").inherits(f,u),f.prototype.processChunk=function(x){this.streamInfo.crc32=l(x.data,this.streamInfo.crc32||0),this.push(x)},v.exports=f},{"../crc32":4,"../utils":32,"./GenericWorker":28}],26:[function(o,v,h){var u=o("../utils"),l=o("./GenericWorker");function f(x){l.call(this,"DataLengthProbe for "+x),this.propName=x,this.withStreamInfo(x,0)}u.inherits(f,l),f.prototype.processChunk=function(x){if(x){var d=this.streamInfo[this.propName]||0;this.streamInfo[this.propName]=d+x.data.length}l.prototype.processChunk.call(this,x)},v.exports=f},{"../utils":32,"./GenericWorker":28}],27:[function(o,v,h){var u=o("../utils"),l=o("./GenericWorker");function f(x){l.call(this,"DataWorker");var d=this;this.dataIsReady=!1,this.index=0,this.max=0,this.data=null,this.type="",this._tickScheduled=!1,x.then(function(T){d.dataIsReady=!0,d.data=T,d.max=T&&T.length||0,d.type=u.getTypeOf(T),d.isPaused||d._tickAndRepeat()},function(T){d.error(T)})}u.inherits(f,l),f.prototype.cleanUp=function(){l.prototype.cleanUp.call(this),this.data=null},f.prototype.resume=function(){return!!l.prototype.resume.call(this)&&(!this._tickScheduled&&this.dataIsReady&&(this._tickScheduled=!0,u.delay(this._tickAndRepeat,[],this)),!0)},f.prototype._tickAndRepeat=function(){this._tickScheduled=!1,this.isPaused||this.isFinished||(this._tick(),this.isFinished||(u.delay(this._tickAndRepeat,[],this),this._tickScheduled=!0))},f.prototype._tick=function(){if(this.isPaused||this.isFinished)return!1;var x=null,d=Math.min(this.max,this.index+16384);if(this.index>=this.max)return this.end();switch(this.type){case"string":x=this.data.substring(this.index,d);break;case"uint8array":x=this.data.subarray(this.index,d);break;case"array":case"nodebuffer":x=this.data.slice(this.index,d)}return this.index=d,this.push({data:x,meta:{percent:this.max?this.index/this.max*100:0}})},v.exports=f},{"../utils":32,"./GenericWorker":28}],28:[function(o,v,h){function u(l){this.name=l||"default",this.streamInfo={},this.generatedError=null,this.extraStreamInfo={},this.isPaused=!0,this.isFinished=!1,this.isLocked=!1,this._listeners={data:[],end:[],error:[]},this.previous=null}u.prototype={push:function(l){this.emit("data",l)},end:function(){if(this.isFinished)return!1;this.flush();try{this.emit("end"),this.cleanUp(),this.isFinished=!0}catch(l){this.emit("error",l)}return!0},error:function(l){return!this.isFinished&&(this.isPaused?this.generatedError=l:(this.isFinished=!0,this.emit("error",l),this.previous&&this.previous.error(l),this.cleanUp()),!0)},on:function(l,f){return this._listeners[l].push(f),this},cleanUp:function(){this.streamInfo=this.generatedError=this.extraStreamInfo=null,this._listeners=[]},emit:function(l,f){if(this._listeners[l])for(var x=0;x<this._listeners[l].length;x++)this._listeners[l][x].call(this,f)},pipe:function(l){return l.registerPrevious(this)},registerPrevious:function(l){if(this.isLocked)throw new Error("The stream '"+this+"' has already been used.");this.streamInfo=l.streamInfo,this.mergeStreamInfo(),this.previous=l;var f=this;return l.on("data",function(x){f.processChunk(x)}),l.on("end",function(){f.end()}),l.on("error",function(x){f.error(x)}),this},pause:function(){return!this.isPaused&&!this.isFinished&&(this.isPaused=!0,this.previous&&this.previous.pause(),!0)},resume:function(){if(!this.isPaused||this.isFinished)return!1;var l=this.isPaused=!1;return this.generatedError&&(this.error(this.generatedError),l=!0),this.previous&&this.previous.resume(),!l},flush:function(){},processChunk:function(l){this.push(l)},withStreamInfo:function(l,f){return this.extraStreamInfo[l]=f,this.mergeStreamInfo(),this},mergeStreamInfo:function(){for(var l in this.extraStreamInfo)Object.prototype.hasOwnProperty.call(this.extraStreamInfo,l)&&(this.streamInfo[l]=this.extraStreamInfo[l])},lock:function(){if(this.isLocked)throw new Error("The stream '"+this+"' has already been used.");this.isLocked=!0,this.previous&&this.previous.lock()},toString:function(){var l="Worker "+this.name;return this.previous?this.previous+" -> "+l:l}},v.exports=u},{}],29:[function(o,v,h){var u=o("../utils"),l=o("./ConvertWorker"),f=o("./GenericWorker"),x=o("../base64"),d=o("../support"),T=o("../external"),b=null;if(d.nodestream)try{b=o("../nodejs/NodejsStreamOutputAdapter")}catch{}function N(I,k){return new T.Promise(function(C,j){var O=[],F=I._internalType,R=I._outputType,M=I._mimeType;I.on("data",function(H,V){O.push(H),k&&k(V)}).on("error",function(H){O=[],j(H)}).on("end",function(){try{var H=function(V,oe,J){switch(V){case"blob":return u.newBlob(u.transformTo("arraybuffer",oe),J);case"base64":return x.encode(oe);default:return u.transformTo(V,oe)}}(R,function(V,oe){var J,Z=0,de=null,$=0;for(J=0;J<oe.length;J++)$+=oe[J].length;switch(V){case"string":return oe.join("");case"array":return Array.prototype.concat.apply([],oe);case"uint8array":for(de=new Uint8Array($),J=0;J<oe.length;J++)de.set(oe[J],Z),Z+=oe[J].length;return de;case"nodebuffer":return Buffer.concat(oe);default:throw new Error("concat : unsupported type '"+V+"'")}}(F,O),M);C(H)}catch(V){j(V)}O=[]}).resume()})}function w(I,k,C){var j=k;switch(k){case"blob":case"arraybuffer":j="uint8array";break;case"base64":j="string"}try{this._internalType=j,this._outputType=k,this._mimeType=C,u.checkSupport(j),this._worker=I.pipe(new l(j)),I.lock()}catch(O){this._worker=new f("error"),this._worker.error(O)}}w.prototype={accumulate:function(I){return N(this,I)},on:function(I,k){var C=this;return I==="data"?this._worker.on(I,function(j){k.call(C,j.data,j.meta)}):this._worker.on(I,function(){u.delay(k,arguments,C)}),this},resume:function(){return u.delay(this._worker.resume,[],this._worker),this},pause:function(){return this._worker.pause(),this},toNodejsStream:function(I){if(u.checkSupport("nodestream"),this._outputType!=="nodebuffer")throw new Error(this._outputType+" is not supported by this method");return new b(this,{objectMode:this._outputType!=="nodebuffer"},I)}},v.exports=w},{"../base64":1,"../external":6,"../nodejs/NodejsStreamOutputAdapter":13,"../support":30,"../utils":32,"./ConvertWorker":24,"./GenericWorker":28}],30:[function(o,v,h){if(h.base64=!0,h.array=!0,h.string=!0,h.arraybuffer=typeof ArrayBuffer<"u"&&typeof Uint8Array<"u",h.nodebuffer=typeof Buffer<"u",h.uint8array=typeof Uint8Array<"u",typeof ArrayBuffer>"u")h.blob=!1;else{var u=new ArrayBuffer(0);try{h.blob=new Blob([u],{type:"application/zip"}).size===0}catch{try{var l=new(self.BlobBuilder||self.WebKitBlobBuilder||self.MozBlobBuilder||self.MSBlobBuilder);l.append(u),h.blob=l.getBlob("application/zip").size===0}catch{h.blob=!1}}}try{h.nodestream=!!o("readable-stream").Readable}catch{h.nodestream=!1}},{"readable-stream":16}],31:[function(o,v,h){for(var u=o("./utils"),l=o("./support"),f=o("./nodejsUtils"),x=o("./stream/GenericWorker"),d=new Array(256),T=0;T<256;T++)d[T]=252<=T?6:248<=T?5:240<=T?4:224<=T?3:192<=T?2:1;d[254]=d[254]=1;function b(){x.call(this,"utf-8 decode"),this.leftOver=null}function N(){x.call(this,"utf-8 encode")}h.utf8encode=function(w){return l.nodebuffer?f.newBufferFrom(w,"utf-8"):function(I){var k,C,j,O,F,R=I.length,M=0;for(O=0;O<R;O++)(64512&(C=I.charCodeAt(O)))==55296&&O+1<R&&(64512&(j=I.charCodeAt(O+1)))==56320&&(C=65536+(C-55296<<10)+(j-56320),O++),M+=C<128?1:C<2048?2:C<65536?3:4;for(k=l.uint8array?new Uint8Array(M):new Array(M),O=F=0;F<M;O++)(64512&(C=I.charCodeAt(O)))==55296&&O+1<R&&(64512&(j=I.charCodeAt(O+1)))==56320&&(C=65536+(C-55296<<10)+(j-56320),O++),C<128?k[F++]=C:(C<2048?k[F++]=192|C>>>6:(C<65536?k[F++]=224|C>>>12:(k[F++]=240|C>>>18,k[F++]=128|C>>>12&63),k[F++]=128|C>>>6&63),k[F++]=128|63&C);return k}(w)},h.utf8decode=function(w){return l.nodebuffer?u.transformTo("nodebuffer",w).toString("utf-8"):function(I){var k,C,j,O,F=I.length,R=new Array(2*F);for(k=C=0;k<F;)if((j=I[k++])<128)R[C++]=j;else if(4<(O=d[j]))R[C++]=65533,k+=O-1;else{for(j&=O===2?31:O===3?15:7;1<O&&k<F;)j=j<<6|63&I[k++],O--;1<O?R[C++]=65533:j<65536?R[C++]=j:(j-=65536,R[C++]=55296|j>>10&1023,R[C++]=56320|1023&j)}return R.length!==C&&(R.subarray?R=R.subarray(0,C):R.length=C),u.applyFromCharCode(R)}(w=u.transformTo(l.uint8array?"uint8array":"array",w))},u.inherits(b,x),b.prototype.processChunk=function(w){var I=u.transformTo(l.uint8array?"uint8array":"array",w.data);if(this.leftOver&&this.leftOver.length){if(l.uint8array){var k=I;(I=new Uint8Array(k.length+this.leftOver.length)).set(this.leftOver,0),I.set(k,this.leftOver.length)}else I=this.leftOver.concat(I);this.leftOver=null}var C=function(O,F){var R;for((F=F||O.length)>O.length&&(F=O.length),R=F-1;0<=R&&(192&O[R])==128;)R--;return R<0||R===0?F:R+d[O[R]]>F?R:F}(I),j=I;C!==I.length&&(l.uint8array?(j=I.subarray(0,C),this.leftOver=I.subarray(C,I.length)):(j=I.slice(0,C),this.leftOver=I.slice(C,I.length))),this.push({data:h.utf8decode(j),meta:w.meta})},b.prototype.flush=function(){this.leftOver&&this.leftOver.length&&(this.push({data:h.utf8decode(this.leftOver),meta:{}}),this.leftOver=null)},h.Utf8DecodeWorker=b,u.inherits(N,x),N.prototype.processChunk=function(w){this.push({data:h.utf8encode(w.data),meta:w.meta})},h.Utf8EncodeWorker=N},{"./nodejsUtils":14,"./stream/GenericWorker":28,"./support":30,"./utils":32}],32:[function(o,v,h){var u=o("./support"),l=o("./base64"),f=o("./nodejsUtils"),x=o("./external");function d(k){return k}function T(k,C){for(var j=0;j<k.length;++j)C[j]=255&k.charCodeAt(j);return C}o("setimmediate"),h.newBlob=function(k,C){h.checkSupport("blob");try{return new Blob([k],{type:C})}catch{try{var j=new(self.BlobBuilder||self.WebKitBlobBuilder||self.MozBlobBuilder||self.MSBlobBuilder);return j.append(k),j.getBlob(C)}catch{throw new Error("Bug : can't construct the Blob.")}}};var b={stringifyByChunk:function(k,C,j){var O=[],F=0,R=k.length;if(R<=j)return String.fromCharCode.apply(null,k);for(;F<R;)C==="array"||C==="nodebuffer"?O.push(String.fromCharCode.apply(null,k.slice(F,Math.min(F+j,R)))):O.push(String.fromCharCode.apply(null,k.subarray(F,Math.min(F+j,R)))),F+=j;return O.join("")},stringifyByChar:function(k){for(var C="",j=0;j<k.length;j++)C+=String.fromCharCode(k[j]);return C},applyCanBeUsed:{uint8array:function(){try{return u.uint8array&&String.fromCharCode.apply(null,new Uint8Array(1)).length===1}catch{return!1}}(),nodebuffer:function(){try{return u.nodebuffer&&String.fromCharCode.apply(null,f.allocBuffer(1)).length===1}catch{return!1}}()}};function N(k){var C=65536,j=h.getTypeOf(k),O=!0;if(j==="uint8array"?O=b.applyCanBeUsed.uint8array:j==="nodebuffer"&&(O=b.applyCanBeUsed.nodebuffer),O)for(;1<C;)try{return b.stringifyByChunk(k,j,C)}catch{C=Math.floor(C/2)}return b.stringifyByChar(k)}function w(k,C){for(var j=0;j<k.length;j++)C[j]=k[j];return C}h.applyFromCharCode=N;var I={};I.string={string:d,array:function(k){return T(k,new Array(k.length))},arraybuffer:function(k){return I.string.uint8array(k).buffer},uint8array:function(k){return T(k,new Uint8Array(k.length))},nodebuffer:function(k){return T(k,f.allocBuffer(k.length))}},I.array={string:N,array:d,arraybuffer:function(k){return new Uint8Array(k).buffer},uint8array:function(k){return new Uint8Array(k)},nodebuffer:function(k){return f.newBufferFrom(k)}},I.arraybuffer={string:function(k){return N(new Uint8Array(k))},array:function(k){return w(new Uint8Array(k),new Array(k.byteLength))},arraybuffer:d,uint8array:function(k){return new Uint8Array(k)},nodebuffer:function(k){return f.newBufferFrom(new Uint8Array(k))}},I.uint8array={string:N,array:function(k){return w(k,new Array(k.length))},arraybuffer:function(k){return k.buffer},uint8array:d,nodebuffer:function(k){return f.newBufferFrom(k)}},I.nodebuffer={string:N,array:function(k){return w(k,new Array(k.length))},arraybuffer:function(k){return I.nodebuffer.uint8array(k).buffer},uint8array:function(k){return w(k,new Uint8Array(k.length))},nodebuffer:d},h.transformTo=function(k,C){if(C=C||"",!k)return C;h.checkSupport(k);var j=h.getTypeOf(C);return I[j][k](C)},h.resolve=function(k){for(var C=k.split("/"),j=[],O=0;O<C.length;O++){var F=C[O];F==="."||F===""&&O!==0&&O!==C.length-1||(F===".."?j.pop():j.push(F))}return j.join("/")},h.getTypeOf=function(k){return typeof k=="string"?"string":Object.prototype.toString.call(k)==="[object Array]"?"array":u.nodebuffer&&f.isBuffer(k)?"nodebuffer":u.uint8array&&k instanceof Uint8Array?"uint8array":u.arraybuffer&&k instanceof ArrayBuffer?"arraybuffer":void 0},h.checkSupport=function(k){if(!u[k.toLowerCase()])throw new Error(k+" is not supported by this platform")},h.MAX_VALUE_16BITS=65535,h.MAX_VALUE_32BITS=-1,h.pretty=function(k){var C,j,O="";for(j=0;j<(k||"").length;j++)O+="\\x"+((C=k.charCodeAt(j))<16?"0":"")+C.toString(16).toUpperCase();return O},h.delay=function(k,C,j){setImmediate(function(){k.apply(j||null,C||[])})},h.inherits=function(k,C){function j(){}j.prototype=C.prototype,k.prototype=new j},h.extend=function(){var k,C,j={};for(k=0;k<arguments.length;k++)for(C in arguments[k])Object.prototype.hasOwnProperty.call(arguments[k],C)&&j[C]===void 0&&(j[C]=arguments[k][C]);return j},h.prepareContent=function(k,C,j,O,F){return x.Promise.resolve(C).then(function(R){return u.blob&&(R instanceof Blob||["[object File]","[object Blob]"].indexOf(Object.prototype.toString.call(R))!==-1)&&typeof FileReader<"u"?new x.Promise(function(M,H){var V=new FileReader;V.onload=function(oe){M(oe.target.result)},V.onerror=function(oe){H(oe.target.error)},V.readAsArrayBuffer(R)}):R}).then(function(R){var M=h.getTypeOf(R);return M?(M==="arraybuffer"?R=h.transformTo("uint8array",R):M==="string"&&(F?R=l.decode(R):j&&O!==!0&&(R=function(H){return T(H,u.uint8array?new Uint8Array(H.length):new Array(H.length))}(R))),R):x.Promise.reject(new Error("Can't read the data of '"+k+"'. Is it in a supported JavaScript type (String, Blob, ArrayBuffer, etc) ?"))})}},{"./base64":1,"./external":6,"./nodejsUtils":14,"./support":30,setimmediate:54}],33:[function(o,v,h){var u=o("./reader/readerFor"),l=o("./utils"),f=o("./signature"),x=o("./zipEntry"),d=o("./support");function T(b){this.files=[],this.loadOptions=b}T.prototype={checkSignature:function(b){if(!this.reader.readAndCheckSignature(b)){this.reader.index-=4;var N=this.reader.readString(4);throw new Error("Corrupted zip or bug: unexpected signature ("+l.pretty(N)+", expected "+l.pretty(b)+")")}},isSignature:function(b,N){var w=this.reader.index;this.reader.setIndex(b);var I=this.reader.readString(4)===N;return this.reader.setIndex(w),I},readBlockEndOfCentral:function(){this.diskNumber=this.reader.readInt(2),this.diskWithCentralDirStart=this.reader.readInt(2),this.centralDirRecordsOnThisDisk=this.reader.readInt(2),this.centralDirRecords=this.reader.readInt(2),this.centralDirSize=this.reader.readInt(4),this.centralDirOffset=this.reader.readInt(4),this.zipCommentLength=this.reader.readInt(2);var b=this.reader.readData(this.zipCommentLength),N=d.uint8array?"uint8array":"array",w=l.transformTo(N,b);this.zipComment=this.loadOptions.decodeFileName(w)},readBlockZip64EndOfCentral:function(){this.zip64EndOfCentralSize=this.reader.readInt(8),this.reader.skip(4),this.diskNumber=this.reader.readInt(4),this.diskWithCentralDirStart=this.reader.readInt(4),this.centralDirRecordsOnThisDisk=this.reader.readInt(8),this.centralDirRecords=this.reader.readInt(8),this.centralDirSize=this.reader.readInt(8),this.centralDirOffset=this.reader.readInt(8),this.zip64ExtensibleData={};for(var b,N,w,I=this.zip64EndOfCentralSize-44;0<I;)b=this.reader.readInt(2),N=this.reader.readInt(4),w=this.reader.readData(N),this.zip64ExtensibleData[b]={id:b,length:N,value:w}},readBlockZip64EndOfCentralLocator:function(){if(this.diskWithZip64CentralDirStart=this.reader.readInt(4),this.relativeOffsetEndOfZip64CentralDir=this.reader.readInt(8),this.disksCount=this.reader.readInt(4),1<this.disksCount)throw new Error("Multi-volumes zip are not supported")},readLocalFiles:function(){var b,N;for(b=0;b<this.files.length;b++)N=this.files[b],this.reader.setIndex(N.localHeaderOffset),this.checkSignature(f.LOCAL_FILE_HEADER),N.readLocalPart(this.reader),N.handleUTF8(),N.processAttributes()},readCentralDir:function(){var b;for(this.reader.setIndex(this.centralDirOffset);this.reader.readAndCheckSignature(f.CENTRAL_FILE_HEADER);)(b=new x({zip64:this.zip64},this.loadOptions)).readCentralPart(this.reader),this.files.push(b);if(this.centralDirRecords!==this.files.length&&this.centralDirRecords!==0&&this.files.length===0)throw new Error("Corrupted zip or bug: expected "+this.centralDirRecords+" records in central dir, got "+this.files.length)},readEndOfCentral:function(){var b=this.reader.lastIndexOfSignature(f.CENTRAL_DIRECTORY_END);if(b<0)throw this.isSignature(0,f.LOCAL_FILE_HEADER)?new Error("Corrupted zip: can't find end of central directory"):new Error("Can't find end of central directory : is this a zip file ? If it is, see https://stuk.github.io/jszip/documentation/howto/read_zip.html");this.reader.setIndex(b);var N=b;if(this.checkSignature(f.CENTRAL_DIRECTORY_END),this.readBlockEndOfCentral(),this.diskNumber===l.MAX_VALUE_16BITS||this.diskWithCentralDirStart===l.MAX_VALUE_16BITS||this.centralDirRecordsOnThisDisk===l.MAX_VALUE_16BITS||this.centralDirRecords===l.MAX_VALUE_16BITS||this.centralDirSize===l.MAX_VALUE_32BITS||this.centralDirOffset===l.MAX_VALUE_32BITS){if(this.zip64=!0,(b=this.reader.lastIndexOfSignature(f.ZIP64_CENTRAL_DIRECTORY_LOCATOR))<0)throw new Error("Corrupted zip: can't find the ZIP64 end of central directory locator");if(this.reader.setIndex(b),this.checkSignature(f.ZIP64_CENTRAL_DIRECTORY_LOCATOR),this.readBlockZip64EndOfCentralLocator(),!this.isSignature(this.relativeOffsetEndOfZip64CentralDir,f.ZIP64_CENTRAL_DIRECTORY_END)&&(this.relativeOffsetEndOfZip64CentralDir=this.reader.lastIndexOfSignature(f.ZIP64_CENTRAL_DIRECTORY_END),this.relativeOffsetEndOfZip64CentralDir<0))throw new Error("Corrupted zip: can't find the ZIP64 end of central directory");this.reader.setIndex(this.relativeOffsetEndOfZip64CentralDir),this.checkSignature(f.ZIP64_CENTRAL_DIRECTORY_END),this.readBlockZip64EndOfCentral()}var w=this.centralDirOffset+this.centralDirSize;this.zip64&&(w+=20,w+=12+this.zip64EndOfCentralSize);var I=N-w;if(0<I)this.isSignature(N,f.CENTRAL_FILE_HEADER)||(this.reader.zero=I);else if(I<0)throw new Error("Corrupted zip: missing "+Math.abs(I)+" bytes.")},prepareReader:function(b){this.reader=u(b)},load:function(b){this.prepareReader(b),this.readEndOfCentral(),this.readCentralDir(),this.readLocalFiles()}},v.exports=T},{"./reader/readerFor":22,"./signature":23,"./support":30,"./utils":32,"./zipEntry":34}],34:[function(o,v,h){var u=o("./reader/readerFor"),l=o("./utils"),f=o("./compressedObject"),x=o("./crc32"),d=o("./utf8"),T=o("./compressions"),b=o("./support");function N(w,I){this.options=w,this.loadOptions=I}N.prototype={isEncrypted:function(){return(1&this.bitFlag)==1},useUTF8:function(){return(2048&this.bitFlag)==2048},readLocalPart:function(w){var I,k;if(w.skip(22),this.fileNameLength=w.readInt(2),k=w.readInt(2),this.fileName=w.readData(this.fileNameLength),w.skip(k),this.compressedSize===-1||this.uncompressedSize===-1)throw new Error("Bug or corrupted zip : didn't get enough information from the central directory (compressedSize === -1 || uncompressedSize === -1)");if((I=function(C){for(var j in T)if(Object.prototype.hasOwnProperty.call(T,j)&&T[j].magic===C)return T[j];return null}(this.compressionMethod))===null)throw new Error("Corrupted zip : compression "+l.pretty(this.compressionMethod)+" unknown (inner file : "+l.transformTo("string",this.fileName)+")");this.decompressed=new f(this.compressedSize,this.uncompressedSize,this.crc32,I,w.readData(this.compressedSize))},readCentralPart:function(w){this.versionMadeBy=w.readInt(2),w.skip(2),this.bitFlag=w.readInt(2),this.compressionMethod=w.readString(2),this.date=w.readDate(),this.crc32=w.readInt(4),this.compressedSize=w.readInt(4),this.uncompressedSize=w.readInt(4);var I=w.readInt(2);if(this.extraFieldsLength=w.readInt(2),this.fileCommentLength=w.readInt(2),this.diskNumberStart=w.readInt(2),this.internalFileAttributes=w.readInt(2),this.externalFileAttributes=w.readInt(4),this.localHeaderOffset=w.readInt(4),this.isEncrypted())throw new Error("Encrypted zip are not supported");w.skip(I),this.readExtraFields(w),this.parseZIP64ExtraField(w),this.fileComment=w.readData(this.fileCommentLength)},processAttributes:function(){this.unixPermissions=null,this.dosPermissions=null;var w=this.versionMadeBy>>8;this.dir=!!(16&this.externalFileAttributes),w==0&&(this.dosPermissions=63&this.externalFileAttributes),w==3&&(this.unixPermissions=this.externalFileAttributes>>16&65535),this.dir||this.fileNameStr.slice(-1)!=="/"||(this.dir=!0)},parseZIP64ExtraField:function(){if(this.extraFields[1]){var w=u(this.extraFields[1].value);this.uncompressedSize===l.MAX_VALUE_32BITS&&(this.uncompressedSize=w.readInt(8)),this.compressedSize===l.MAX_VALUE_32BITS&&(this.compressedSize=w.readInt(8)),this.localHeaderOffset===l.MAX_VALUE_32BITS&&(this.localHeaderOffset=w.readInt(8)),this.diskNumberStart===l.MAX_VALUE_32BITS&&(this.diskNumberStart=w.readInt(4))}},readExtraFields:function(w){var I,k,C,j=w.index+this.extraFieldsLength;for(this.extraFields||(this.extraFields={});w.index+4<j;)I=w.readInt(2),k=w.readInt(2),C=w.readData(k),this.extraFields[I]={id:I,length:k,value:C};w.setIndex(j)},handleUTF8:function(){var w=b.uint8array?"uint8array":"array";if(this.useUTF8())this.fileNameStr=d.utf8decode(this.fileName),this.fileCommentStr=d.utf8decode(this.fileComment);else{var I=this.findExtraFieldUnicodePath();if(I!==null)this.fileNameStr=I;else{var k=l.transformTo(w,this.fileName);this.fileNameStr=this.loadOptions.decodeFileName(k)}var C=this.findExtraFieldUnicodeComment();if(C!==null)this.fileCommentStr=C;else{var j=l.transformTo(w,this.fileComment);this.fileCommentStr=this.loadOptions.decodeFileName(j)}}},findExtraFieldUnicodePath:function(){var w=this.extraFields[28789];if(w){var I=u(w.value);return I.readInt(1)!==1||x(this.fileName)!==I.readInt(4)?null:d.utf8decode(I.readData(w.length-5))}return null},findExtraFieldUnicodeComment:function(){var w=this.extraFields[25461];if(w){var I=u(w.value);return I.readInt(1)!==1||x(this.fileComment)!==I.readInt(4)?null:d.utf8decode(I.readData(w.length-5))}return null}},v.exports=N},{"./compressedObject":2,"./compressions":3,"./crc32":4,"./reader/readerFor":22,"./support":30,"./utf8":31,"./utils":32}],35:[function(o,v,h){function u(I,k,C){this.name=I,this.dir=C.dir,this.date=C.date,this.comment=C.comment,this.unixPermissions=C.unixPermissions,this.dosPermissions=C.dosPermissions,this._data=k,this._dataBinary=C.binary,this.options={compression:C.compression,compressionOptions:C.compressionOptions}}var l=o("./stream/StreamHelper"),f=o("./stream/DataWorker"),x=o("./utf8"),d=o("./compressedObject"),T=o("./stream/GenericWorker");u.prototype={internalStream:function(I){var k=null,C="string";try{if(!I)throw new Error("No output type specified.");var j=(C=I.toLowerCase())==="string"||C==="text";C!=="binarystring"&&C!=="text"||(C="string"),k=this._decompressWorker();var O=!this._dataBinary;O&&!j&&(k=k.pipe(new x.Utf8EncodeWorker)),!O&&j&&(k=k.pipe(new x.Utf8DecodeWorker))}catch(F){(k=new T("error")).error(F)}return new l(k,C,"")},async:function(I,k){return this.internalStream(I).accumulate(k)},nodeStream:function(I,k){return this.internalStream(I||"nodebuffer").toNodejsStream(k)},_compressWorker:function(I,k){if(this._data instanceof d&&this._data.compression.magic===I.magic)return this._data.getCompressedWorker();var C=this._decompressWorker();return this._dataBinary||(C=C.pipe(new x.Utf8EncodeWorker)),d.createWorkerFrom(C,I,k)},_decompressWorker:function(){return this._data instanceof d?this._data.getContentWorker():this._data instanceof T?this._data:new f(this._data)}};for(var b=["asText","asBinary","asNodeBuffer","asUint8Array","asArrayBuffer"],N=function(){throw new Error("This method has been removed in JSZip 3.0, please check the upgrade guide.")},w=0;w<b.length;w++)u.prototype[b[w]]=N;v.exports=u},{"./compressedObject":2,"./stream/DataWorker":27,"./stream/GenericWorker":28,"./stream/StreamHelper":29,"./utf8":31}],36:[function(o,v,h){(function(u){var l,f,x=u.MutationObserver||u.WebKitMutationObserver;if(x){var d=0,T=new x(I),b=u.document.createTextNode("");T.observe(b,{characterData:!0}),l=function(){b.data=d=++d%2}}else if(u.setImmediate||u.MessageChannel===void 0)l="document"in u&&"onreadystatechange"in u.document.createElement("script")?function(){var k=u.document.createElement("script");k.onreadystatechange=function(){I(),k.onreadystatechange=null,k.parentNode.removeChild(k),k=null},u.document.documentElement.appendChild(k)}:function(){setTimeout(I,0)};else{var N=new u.MessageChannel;N.port1.onmessage=I,l=function(){N.port2.postMessage(0)}}var w=[];function I(){var k,C;f=!0;for(var j=w.length;j;){for(C=w,w=[],k=-1;++k<j;)C[k]();j=w.length}f=!1}v.exports=function(k){w.push(k)!==1||f||l()}}).call(this,typeof fo<"u"?fo:typeof self<"u"?self:typeof window<"u"?window:{})},{}],37:[function(o,v,h){var u=o("immediate");function l(){}var f={},x=["REJECTED"],d=["FULFILLED"],T=["PENDING"];function b(j){if(typeof j!="function")throw new TypeError("resolver must be a function");this.state=T,this.queue=[],this.outcome=void 0,j!==l&&k(this,j)}function N(j,O,F){this.promise=j,typeof O=="function"&&(this.onFulfilled=O,this.callFulfilled=this.otherCallFulfilled),typeof F=="function"&&(this.onRejected=F,this.callRejected=this.otherCallRejected)}function w(j,O,F){u(function(){var R;try{R=O(F)}catch(M){return f.reject(j,M)}R===j?f.reject(j,new TypeError("Cannot resolve promise with itself")):f.resolve(j,R)})}function I(j){var O=j&&j.then;if(j&&(typeof j=="object"||typeof j=="function")&&typeof O=="function")return function(){O.apply(j,arguments)}}function k(j,O){var F=!1;function R(V){F||(F=!0,f.reject(j,V))}function M(V){F||(F=!0,f.resolve(j,V))}var H=C(function(){O(M,R)});H.status==="error"&&R(H.value)}function C(j,O){var F={};try{F.value=j(O),F.status="success"}catch(R){F.status="error",F.value=R}return F}(v.exports=b).prototype.finally=function(j){if(typeof j!="function")return this;var O=this.constructor;return this.then(function(F){return O.resolve(j()).then(function(){return F})},function(F){return O.resolve(j()).then(function(){throw F})})},b.prototype.catch=function(j){return this.then(null,j)},b.prototype.then=function(j,O){if(typeof j!="function"&&this.state===d||typeof O!="function"&&this.state===x)return this;var F=new this.constructor(l);return this.state!==T?w(F,this.state===d?j:O,this.outcome):this.queue.push(new N(F,j,O)),F},N.prototype.callFulfilled=function(j){f.resolve(this.promise,j)},N.prototype.otherCallFulfilled=function(j){w(this.promise,this.onFulfilled,j)},N.prototype.callRejected=function(j){f.reject(this.promise,j)},N.prototype.otherCallRejected=function(j){w(this.promise,this.onRejected,j)},f.resolve=function(j,O){var F=C(I,O);if(F.status==="error")return f.reject(j,F.value);var R=F.value;if(R)k(j,R);else{j.state=d,j.outcome=O;for(var M=-1,H=j.queue.length;++M<H;)j.queue[M].callFulfilled(O)}return j},f.reject=function(j,O){j.state=x,j.outcome=O;for(var F=-1,R=j.queue.length;++F<R;)j.queue[F].callRejected(O);return j},b.resolve=function(j){return j instanceof this?j:f.resolve(new this(l),j)},b.reject=function(j){var O=new this(l);return f.reject(O,j)},b.all=function(j){var O=this;if(Object.prototype.toString.call(j)!=="[object Array]")return this.reject(new TypeError("must be an array"));var F=j.length,R=!1;if(!F)return this.resolve([]);for(var M=new Array(F),H=0,V=-1,oe=new this(l);++V<F;)J(j[V],V);return oe;function J(Z,de){O.resolve(Z).then(function($){M[de]=$,++H!==F||R||(R=!0,f.resolve(oe,M))},function($){R||(R=!0,f.reject(oe,$))})}},b.race=function(j){var O=this;if(Object.prototype.toString.call(j)!=="[object Array]")return this.reject(new TypeError("must be an array"));var F=j.length,R=!1;if(!F)return this.resolve([]);for(var M=-1,H=new this(l);++M<F;)V=j[M],O.resolve(V).then(function(oe){R||(R=!0,f.resolve(H,oe))},function(oe){R||(R=!0,f.reject(H,oe))});var V;return H}},{immediate:36}],38:[function(o,v,h){var u={};(0,o("./lib/utils/common").assign)(u,o("./lib/deflate"),o("./lib/inflate"),o("./lib/zlib/constants")),v.exports=u},{"./lib/deflate":39,"./lib/inflate":40,"./lib/utils/common":41,"./lib/zlib/constants":44}],39:[function(o,v,h){var u=o("./zlib/deflate"),l=o("./utils/common"),f=o("./utils/strings"),x=o("./zlib/messages"),d=o("./zlib/zstream"),T=Object.prototype.toString,b=0,N=-1,w=0,I=8;function k(j){if(!(this instanceof k))return new k(j);this.options=l.assign({level:N,method:I,chunkSize:16384,windowBits:15,memLevel:8,strategy:w,to:""},j||{});var O=this.options;O.raw&&0<O.windowBits?O.windowBits=-O.windowBits:O.gzip&&0<O.windowBits&&O.windowBits<16&&(O.windowBits+=16),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new d,this.strm.avail_out=0;var F=u.deflateInit2(this.strm,O.level,O.method,O.windowBits,O.memLevel,O.strategy);if(F!==b)throw new Error(x[F]);if(O.header&&u.deflateSetHeader(this.strm,O.header),O.dictionary){var R;if(R=typeof O.dictionary=="string"?f.string2buf(O.dictionary):T.call(O.dictionary)==="[object ArrayBuffer]"?new Uint8Array(O.dictionary):O.dictionary,(F=u.deflateSetDictionary(this.strm,R))!==b)throw new Error(x[F]);this._dict_set=!0}}function C(j,O){var F=new k(O);if(F.push(j,!0),F.err)throw F.msg||x[F.err];return F.result}k.prototype.push=function(j,O){var F,R,M=this.strm,H=this.options.chunkSize;if(this.ended)return!1;R=O===~~O?O:O===!0?4:0,typeof j=="string"?M.input=f.string2buf(j):T.call(j)==="[object ArrayBuffer]"?M.input=new Uint8Array(j):M.input=j,M.next_in=0,M.avail_in=M.input.length;do{if(M.avail_out===0&&(M.output=new l.Buf8(H),M.next_out=0,M.avail_out=H),(F=u.deflate(M,R))!==1&&F!==b)return this.onEnd(F),!(this.ended=!0);M.avail_out!==0&&(M.avail_in!==0||R!==4&&R!==2)||(this.options.to==="string"?this.onData(f.buf2binstring(l.shrinkBuf(M.output,M.next_out))):this.onData(l.shrinkBuf(M.output,M.next_out)))}while((0<M.avail_in||M.avail_out===0)&&F!==1);return R===4?(F=u.deflateEnd(this.strm),this.onEnd(F),this.ended=!0,F===b):R!==2||(this.onEnd(b),!(M.avail_out=0))},k.prototype.onData=function(j){this.chunks.push(j)},k.prototype.onEnd=function(j){j===b&&(this.options.to==="string"?this.result=this.chunks.join(""):this.result=l.flattenChunks(this.chunks)),this.chunks=[],this.err=j,this.msg=this.strm.msg},h.Deflate=k,h.deflate=C,h.deflateRaw=function(j,O){return(O=O||{}).raw=!0,C(j,O)},h.gzip=function(j,O){return(O=O||{}).gzip=!0,C(j,O)}},{"./utils/common":41,"./utils/strings":42,"./zlib/deflate":46,"./zlib/messages":51,"./zlib/zstream":53}],40:[function(o,v,h){var u=o("./zlib/inflate"),l=o("./utils/common"),f=o("./utils/strings"),x=o("./zlib/constants"),d=o("./zlib/messages"),T=o("./zlib/zstream"),b=o("./zlib/gzheader"),N=Object.prototype.toString;function w(k){if(!(this instanceof w))return new w(k);this.options=l.assign({chunkSize:16384,windowBits:0,to:""},k||{});var C=this.options;C.raw&&0<=C.windowBits&&C.windowBits<16&&(C.windowBits=-C.windowBits,C.windowBits===0&&(C.windowBits=-15)),!(0<=C.windowBits&&C.windowBits<16)||k&&k.windowBits||(C.windowBits+=32),15<C.windowBits&&C.windowBits<48&&(15&C.windowBits)==0&&(C.windowBits|=15),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new T,this.strm.avail_out=0;var j=u.inflateInit2(this.strm,C.windowBits);if(j!==x.Z_OK)throw new Error(d[j]);this.header=new b,u.inflateGetHeader(this.strm,this.header)}function I(k,C){var j=new w(C);if(j.push(k,!0),j.err)throw j.msg||d[j.err];return j.result}w.prototype.push=function(k,C){var j,O,F,R,M,H,V=this.strm,oe=this.options.chunkSize,J=this.options.dictionary,Z=!1;if(this.ended)return!1;O=C===~~C?C:C===!0?x.Z_FINISH:x.Z_NO_FLUSH,typeof k=="string"?V.input=f.binstring2buf(k):N.call(k)==="[object ArrayBuffer]"?V.input=new Uint8Array(k):V.input=k,V.next_in=0,V.avail_in=V.input.length;do{if(V.avail_out===0&&(V.output=new l.Buf8(oe),V.next_out=0,V.avail_out=oe),(j=u.inflate(V,x.Z_NO_FLUSH))===x.Z_NEED_DICT&&J&&(H=typeof J=="string"?f.string2buf(J):N.call(J)==="[object ArrayBuffer]"?new Uint8Array(J):J,j=u.inflateSetDictionary(this.strm,H)),j===x.Z_BUF_ERROR&&Z===!0&&(j=x.Z_OK,Z=!1),j!==x.Z_STREAM_END&&j!==x.Z_OK)return this.onEnd(j),!(this.ended=!0);V.next_out&&(V.avail_out!==0&&j!==x.Z_STREAM_END&&(V.avail_in!==0||O!==x.Z_FINISH&&O!==x.Z_SYNC_FLUSH)||(this.options.to==="string"?(F=f.utf8border(V.output,V.next_out),R=V.next_out-F,M=f.buf2string(V.output,F),V.next_out=R,V.avail_out=oe-R,R&&l.arraySet(V.output,V.output,F,R,0),this.onData(M)):this.onData(l.shrinkBuf(V.output,V.next_out)))),V.avail_in===0&&V.avail_out===0&&(Z=!0)}while((0<V.avail_in||V.avail_out===0)&&j!==x.Z_STREAM_END);return j===x.Z_STREAM_END&&(O=x.Z_FINISH),O===x.Z_FINISH?(j=u.inflateEnd(this.strm),this.onEnd(j),this.ended=!0,j===x.Z_OK):O!==x.Z_SYNC_FLUSH||(this.onEnd(x.Z_OK),!(V.avail_out=0))},w.prototype.onData=function(k){this.chunks.push(k)},w.prototype.onEnd=function(k){k===x.Z_OK&&(this.options.to==="string"?this.result=this.chunks.join(""):this.result=l.flattenChunks(this.chunks)),this.chunks=[],this.err=k,this.msg=this.strm.msg},h.Inflate=w,h.inflate=I,h.inflateRaw=function(k,C){return(C=C||{}).raw=!0,I(k,C)},h.ungzip=I},{"./utils/common":41,"./utils/strings":42,"./zlib/constants":44,"./zlib/gzheader":47,"./zlib/inflate":49,"./zlib/messages":51,"./zlib/zstream":53}],41:[function(o,v,h){var u=typeof Uint8Array<"u"&&typeof Uint16Array<"u"&&typeof Int32Array<"u";h.assign=function(x){for(var d=Array.prototype.slice.call(arguments,1);d.length;){var T=d.shift();if(T){if(typeof T!="object")throw new TypeError(T+"must be non-object");for(var b in T)T.hasOwnProperty(b)&&(x[b]=T[b])}}return x},h.shrinkBuf=function(x,d){return x.length===d?x:x.subarray?x.subarray(0,d):(x.length=d,x)};var l={arraySet:function(x,d,T,b,N){if(d.subarray&&x.subarray)x.set(d.subarray(T,T+b),N);else for(var w=0;w<b;w++)x[N+w]=d[T+w]},flattenChunks:function(x){var d,T,b,N,w,I;for(d=b=0,T=x.length;d<T;d++)b+=x[d].length;for(I=new Uint8Array(b),d=N=0,T=x.length;d<T;d++)w=x[d],I.set(w,N),N+=w.length;return I}},f={arraySet:function(x,d,T,b,N){for(var w=0;w<b;w++)x[N+w]=d[T+w]},flattenChunks:function(x){return[].concat.apply([],x)}};h.setTyped=function(x){x?(h.Buf8=Uint8Array,h.Buf16=Uint16Array,h.Buf32=Int32Array,h.assign(h,l)):(h.Buf8=Array,h.Buf16=Array,h.Buf32=Array,h.assign(h,f))},h.setTyped(u)},{}],42:[function(o,v,h){var u=o("./common"),l=!0,f=!0;try{String.fromCharCode.apply(null,[0])}catch{l=!1}try{String.fromCharCode.apply(null,new Uint8Array(1))}catch{f=!1}for(var x=new u.Buf8(256),d=0;d<256;d++)x[d]=252<=d?6:248<=d?5:240<=d?4:224<=d?3:192<=d?2:1;function T(b,N){if(N<65537&&(b.subarray&&f||!b.subarray&&l))return String.fromCharCode.apply(null,u.shrinkBuf(b,N));for(var w="",I=0;I<N;I++)w+=String.fromCharCode(b[I]);return w}x[254]=x[254]=1,h.string2buf=function(b){var N,w,I,k,C,j=b.length,O=0;for(k=0;k<j;k++)(64512&(w=b.charCodeAt(k)))==55296&&k+1<j&&(64512&(I=b.charCodeAt(k+1)))==56320&&(w=65536+(w-55296<<10)+(I-56320),k++),O+=w<128?1:w<2048?2:w<65536?3:4;for(N=new u.Buf8(O),k=C=0;C<O;k++)(64512&(w=b.charCodeAt(k)))==55296&&k+1<j&&(64512&(I=b.charCodeAt(k+1)))==56320&&(w=65536+(w-55296<<10)+(I-56320),k++),w<128?N[C++]=w:(w<2048?N[C++]=192|w>>>6:(w<65536?N[C++]=224|w>>>12:(N[C++]=240|w>>>18,N[C++]=128|w>>>12&63),N[C++]=128|w>>>6&63),N[C++]=128|63&w);return N},h.buf2binstring=function(b){return T(b,b.length)},h.binstring2buf=function(b){for(var N=new u.Buf8(b.length),w=0,I=N.length;w<I;w++)N[w]=b.charCodeAt(w);return N},h.buf2string=function(b,N){var w,I,k,C,j=N||b.length,O=new Array(2*j);for(w=I=0;w<j;)if((k=b[w++])<128)O[I++]=k;else if(4<(C=x[k]))O[I++]=65533,w+=C-1;else{for(k&=C===2?31:C===3?15:7;1<C&&w<j;)k=k<<6|63&b[w++],C--;1<C?O[I++]=65533:k<65536?O[I++]=k:(k-=65536,O[I++]=55296|k>>10&1023,O[I++]=56320|1023&k)}return T(O,I)},h.utf8border=function(b,N){var w;for((N=N||b.length)>b.length&&(N=b.length),w=N-1;0<=w&&(192&b[w])==128;)w--;return w<0||w===0?N:w+x[b[w]]>N?w:N}},{"./common":41}],43:[function(o,v,h){v.exports=function(u,l,f,x){for(var d=65535&u|0,T=u>>>16&65535|0,b=0;f!==0;){for(f-=b=2e3<f?2e3:f;T=T+(d=d+l[x++]|0)|0,--b;);d%=65521,T%=65521}return d|T<<16|0}},{}],44:[function(o,v,h){v.exports={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_ERRNO:-1,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_BUF_ERROR:-5,Z_NO_COMPRESSION:0,Z_BEST_SPEED:1,Z_BEST_COMPRESSION:9,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_BINARY:0,Z_TEXT:1,Z_UNKNOWN:2,Z_DEFLATED:8}},{}],45:[function(o,v,h){var u=function(){for(var l,f=[],x=0;x<256;x++){l=x;for(var d=0;d<8;d++)l=1&l?3988292384^l>>>1:l>>>1;f[x]=l}return f}();v.exports=function(l,f,x,d){var T=u,b=d+x;l^=-1;for(var N=d;N<b;N++)l=l>>>8^T[255&(l^f[N])];return-1^l}},{}],46:[function(o,v,h){var u,l=o("../utils/common"),f=o("./trees"),x=o("./adler32"),d=o("./crc32"),T=o("./messages"),b=0,N=4,w=0,I=-2,k=-1,C=4,j=2,O=8,F=9,R=286,M=30,H=19,V=2*R+1,oe=15,J=3,Z=258,de=Z+J+1,$=42,W=113,_=1,ie=2,be=3,ge=4;function je(g,ee){return g.msg=T[ee],ee}function fe(g){return(g<<1)-(4<g?9:0)}function B(g){for(var ee=g.length;0<=--ee;)g[ee]=0}function S(g){var ee=g.state,G=ee.pending;G>g.avail_out&&(G=g.avail_out),G!==0&&(l.arraySet(g.output,ee.pending_buf,ee.pending_out,G,g.next_out),g.next_out+=G,ee.pending_out+=G,g.total_out+=G,g.avail_out-=G,ee.pending-=G,ee.pending===0&&(ee.pending_out=0))}function A(g,ee){f._tr_flush_block(g,0<=g.block_start?g.block_start:-1,g.strstart-g.block_start,ee),g.block_start=g.strstart,S(g.strm)}function ce(g,ee){g.pending_buf[g.pending++]=ee}function pe(g,ee){g.pending_buf[g.pending++]=ee>>>8&255,g.pending_buf[g.pending++]=255&ee}function me(g,ee){var G,P,L=g.max_chain_length,q=g.strstart,X=g.prev_length,se=g.nice_match,Q=g.strstart>g.w_size-de?g.strstart-(g.w_size-de):0,ue=g.window,Ie=g.w_mask,ye=g.prev,Ce=g.strstart+Z,Be=ue[q+X-1],$e=ue[q+X];g.prev_length>=g.good_match&&(L>>=2),se>g.lookahead&&(se=g.lookahead);do if(ue[(G=ee)+X]===$e&&ue[G+X-1]===Be&&ue[G]===ue[q]&&ue[++G]===ue[q+1]){q+=2,G++;do;while(ue[++q]===ue[++G]&&ue[++q]===ue[++G]&&ue[++q]===ue[++G]&&ue[++q]===ue[++G]&&ue[++q]===ue[++G]&&ue[++q]===ue[++G]&&ue[++q]===ue[++G]&&ue[++q]===ue[++G]&&q<Ce);if(P=Z-(Ce-q),q=Ce-Z,X<P){if(g.match_start=ee,se<=(X=P))break;Be=ue[q+X-1],$e=ue[q+X]}}while((ee=ye[ee&Ie])>Q&&--L!=0);return X<=g.lookahead?X:g.lookahead}function Te(g){var ee,G,P,L,q,X,se,Q,ue,Ie,ye=g.w_size;do{if(L=g.window_size-g.lookahead-g.strstart,g.strstart>=ye+(ye-de)){for(l.arraySet(g.window,g.window,ye,ye,0),g.match_start-=ye,g.strstart-=ye,g.block_start-=ye,ee=G=g.hash_size;P=g.head[--ee],g.head[ee]=ye<=P?P-ye:0,--G;);for(ee=G=ye;P=g.prev[--ee],g.prev[ee]=ye<=P?P-ye:0,--G;);L+=ye}if(g.strm.avail_in===0)break;if(X=g.strm,se=g.window,Q=g.strstart+g.lookahead,ue=L,Ie=void 0,Ie=X.avail_in,ue<Ie&&(Ie=ue),G=Ie===0?0:(X.avail_in-=Ie,l.arraySet(se,X.input,X.next_in,Ie,Q),X.state.wrap===1?X.adler=x(X.adler,se,Ie,Q):X.state.wrap===2&&(X.adler=d(X.adler,se,Ie,Q)),X.next_in+=Ie,X.total_in+=Ie,Ie),g.lookahead+=G,g.lookahead+g.insert>=J)for(q=g.strstart-g.insert,g.ins_h=g.window[q],g.ins_h=(g.ins_h<<g.hash_shift^g.window[q+1])&g.hash_mask;g.insert&&(g.ins_h=(g.ins_h<<g.hash_shift^g.window[q+J-1])&g.hash_mask,g.prev[q&g.w_mask]=g.head[g.ins_h],g.head[g.ins_h]=q,q++,g.insert--,!(g.lookahead+g.insert<J)););}while(g.lookahead<de&&g.strm.avail_in!==0)}function he(g,ee){for(var G,P;;){if(g.lookahead<de){if(Te(g),g.lookahead<de&&ee===b)return _;if(g.lookahead===0)break}if(G=0,g.lookahead>=J&&(g.ins_h=(g.ins_h<<g.hash_shift^g.window[g.strstart+J-1])&g.hash_mask,G=g.prev[g.strstart&g.w_mask]=g.head[g.ins_h],g.head[g.ins_h]=g.strstart),G!==0&&g.strstart-G<=g.w_size-de&&(g.match_length=me(g,G)),g.match_length>=J)if(P=f._tr_tally(g,g.strstart-g.match_start,g.match_length-J),g.lookahead-=g.match_length,g.match_length<=g.max_lazy_match&&g.lookahead>=J){for(g.match_length--;g.strstart++,g.ins_h=(g.ins_h<<g.hash_shift^g.window[g.strstart+J-1])&g.hash_mask,G=g.prev[g.strstart&g.w_mask]=g.head[g.ins_h],g.head[g.ins_h]=g.strstart,--g.match_length!=0;);g.strstart++}else g.strstart+=g.match_length,g.match_length=0,g.ins_h=g.window[g.strstart],g.ins_h=(g.ins_h<<g.hash_shift^g.window[g.strstart+1])&g.hash_mask;else P=f._tr_tally(g,0,g.window[g.strstart]),g.lookahead--,g.strstart++;if(P&&(A(g,!1),g.strm.avail_out===0))return _}return g.insert=g.strstart<J-1?g.strstart:J-1,ee===N?(A(g,!0),g.strm.avail_out===0?be:ge):g.last_lit&&(A(g,!1),g.strm.avail_out===0)?_:ie}function Se(g,ee){for(var G,P,L;;){if(g.lookahead<de){if(Te(g),g.lookahead<de&&ee===b)return _;if(g.lookahead===0)break}if(G=0,g.lookahead>=J&&(g.ins_h=(g.ins_h<<g.hash_shift^g.window[g.strstart+J-1])&g.hash_mask,G=g.prev[g.strstart&g.w_mask]=g.head[g.ins_h],g.head[g.ins_h]=g.strstart),g.prev_length=g.match_length,g.prev_match=g.match_start,g.match_length=J-1,G!==0&&g.prev_length<g.max_lazy_match&&g.strstart-G<=g.w_size-de&&(g.match_length=me(g,G),g.match_length<=5&&(g.strategy===1||g.match_length===J&&4096<g.strstart-g.match_start)&&(g.match_length=J-1)),g.prev_length>=J&&g.match_length<=g.prev_length){for(L=g.strstart+g.lookahead-J,P=f._tr_tally(g,g.strstart-1-g.prev_match,g.prev_length-J),g.lookahead-=g.prev_length-1,g.prev_length-=2;++g.strstart<=L&&(g.ins_h=(g.ins_h<<g.hash_shift^g.window[g.strstart+J-1])&g.hash_mask,G=g.prev[g.strstart&g.w_mask]=g.head[g.ins_h],g.head[g.ins_h]=g.strstart),--g.prev_length!=0;);if(g.match_available=0,g.match_length=J-1,g.strstart++,P&&(A(g,!1),g.strm.avail_out===0))return _}else if(g.match_available){if((P=f._tr_tally(g,0,g.window[g.strstart-1]))&&A(g,!1),g.strstart++,g.lookahead--,g.strm.avail_out===0)return _}else g.match_available=1,g.strstart++,g.lookahead--}return g.match_available&&(P=f._tr_tally(g,0,g.window[g.strstart-1]),g.match_available=0),g.insert=g.strstart<J-1?g.strstart:J-1,ee===N?(A(g,!0),g.strm.avail_out===0?be:ge):g.last_lit&&(A(g,!1),g.strm.avail_out===0)?_:ie}function Ee(g,ee,G,P,L){this.good_length=g,this.max_lazy=ee,this.nice_length=G,this.max_chain=P,this.func=L}function Le(){this.strm=null,this.status=0,this.pending_buf=null,this.pending_buf_size=0,this.pending_out=0,this.pending=0,this.wrap=0,this.gzhead=null,this.gzindex=0,this.method=O,this.last_flush=-1,this.w_size=0,this.w_bits=0,this.w_mask=0,this.window=null,this.window_size=0,this.prev=null,this.head=null,this.ins_h=0,this.hash_size=0,this.hash_bits=0,this.hash_mask=0,this.hash_shift=0,this.block_start=0,this.match_length=0,this.prev_match=0,this.match_available=0,this.strstart=0,this.match_start=0,this.lookahead=0,this.prev_length=0,this.max_chain_length=0,this.max_lazy_match=0,this.level=0,this.strategy=0,this.good_match=0,this.nice_match=0,this.dyn_ltree=new l.Buf16(2*V),this.dyn_dtree=new l.Buf16(2*(2*M+1)),this.bl_tree=new l.Buf16(2*(2*H+1)),B(this.dyn_ltree),B(this.dyn_dtree),B(this.bl_tree),this.l_desc=null,this.d_desc=null,this.bl_desc=null,this.bl_count=new l.Buf16(oe+1),this.heap=new l.Buf16(2*R+1),B(this.heap),this.heap_len=0,this.heap_max=0,this.depth=new l.Buf16(2*R+1),B(this.depth),this.l_buf=0,this.lit_bufsize=0,this.last_lit=0,this.d_buf=0,this.opt_len=0,this.static_len=0,this.matches=0,this.insert=0,this.bi_buf=0,this.bi_valid=0}function qe(g){var ee;return g&&g.state?(g.total_in=g.total_out=0,g.data_type=j,(ee=g.state).pending=0,ee.pending_out=0,ee.wrap<0&&(ee.wrap=-ee.wrap),ee.status=ee.wrap?$:W,g.adler=ee.wrap===2?0:1,ee.last_flush=b,f._tr_init(ee),w):je(g,I)}function te(g){var ee=qe(g);return ee===w&&function(G){G.window_size=2*G.w_size,B(G.head),G.max_lazy_match=u[G.level].max_lazy,G.good_match=u[G.level].good_length,G.nice_match=u[G.level].nice_length,G.max_chain_length=u[G.level].max_chain,G.strstart=0,G.block_start=0,G.lookahead=0,G.insert=0,G.match_length=G.prev_length=J-1,G.match_available=0,G.ins_h=0}(g.state),ee}function Y(g,ee,G,P,L,q){if(!g)return I;var X=1;if(ee===k&&(ee=6),P<0?(X=0,P=-P):15<P&&(X=2,P-=16),L<1||F<L||G!==O||P<8||15<P||ee<0||9<ee||q<0||C<q)return je(g,I);P===8&&(P=9);var se=new Le;return(g.state=se).strm=g,se.wrap=X,se.gzhead=null,se.w_bits=P,se.w_size=1<<se.w_bits,se.w_mask=se.w_size-1,se.hash_bits=L+7,se.hash_size=1<<se.hash_bits,se.hash_mask=se.hash_size-1,se.hash_shift=~~((se.hash_bits+J-1)/J),se.window=new l.Buf8(2*se.w_size),se.head=new l.Buf16(se.hash_size),se.prev=new l.Buf16(se.w_size),se.lit_bufsize=1<<L+6,se.pending_buf_size=4*se.lit_bufsize,se.pending_buf=new l.Buf8(se.pending_buf_size),se.d_buf=1*se.lit_bufsize,se.l_buf=3*se.lit_bufsize,se.level=ee,se.strategy=q,se.method=G,te(g)}u=[new Ee(0,0,0,0,function(g,ee){var G=65535;for(G>g.pending_buf_size-5&&(G=g.pending_buf_size-5);;){if(g.lookahead<=1){if(Te(g),g.lookahead===0&&ee===b)return _;if(g.lookahead===0)break}g.strstart+=g.lookahead,g.lookahead=0;var P=g.block_start+G;if((g.strstart===0||g.strstart>=P)&&(g.lookahead=g.strstart-P,g.strstart=P,A(g,!1),g.strm.avail_out===0)||g.strstart-g.block_start>=g.w_size-de&&(A(g,!1),g.strm.avail_out===0))return _}return g.insert=0,ee===N?(A(g,!0),g.strm.avail_out===0?be:ge):(g.strstart>g.block_start&&(A(g,!1),g.strm.avail_out),_)}),new Ee(4,4,8,4,he),new Ee(4,5,16,8,he),new Ee(4,6,32,32,he),new Ee(4,4,16,16,Se),new Ee(8,16,32,32,Se),new Ee(8,16,128,128,Se),new Ee(8,32,128,256,Se),new Ee(32,128,258,1024,Se),new Ee(32,258,258,4096,Se)],h.deflateInit=function(g,ee){return Y(g,ee,O,15,8,0)},h.deflateInit2=Y,h.deflateReset=te,h.deflateResetKeep=qe,h.deflateSetHeader=function(g,ee){return g&&g.state?g.state.wrap!==2?I:(g.state.gzhead=ee,w):I},h.deflate=function(g,ee){var G,P,L,q;if(!g||!g.state||5<ee||ee<0)return g?je(g,I):I;if(P=g.state,!g.output||!g.input&&g.avail_in!==0||P.status===666&&ee!==N)return je(g,g.avail_out===0?-5:I);if(P.strm=g,G=P.last_flush,P.last_flush=ee,P.status===$)if(P.wrap===2)g.adler=0,ce(P,31),ce(P,139),ce(P,8),P.gzhead?(ce(P,(P.gzhead.text?1:0)+(P.gzhead.hcrc?2:0)+(P.gzhead.extra?4:0)+(P.gzhead.name?8:0)+(P.gzhead.comment?16:0)),ce(P,255&P.gzhead.time),ce(P,P.gzhead.time>>8&255),ce(P,P.gzhead.time>>16&255),ce(P,P.gzhead.time>>24&255),ce(P,P.level===9?2:2<=P.strategy||P.level<2?4:0),ce(P,255&P.gzhead.os),P.gzhead.extra&&P.gzhead.extra.length&&(ce(P,255&P.gzhead.extra.length),ce(P,P.gzhead.extra.length>>8&255)),P.gzhead.hcrc&&(g.adler=d(g.adler,P.pending_buf,P.pending,0)),P.gzindex=0,P.status=69):(ce(P,0),ce(P,0),ce(P,0),ce(P,0),ce(P,0),ce(P,P.level===9?2:2<=P.strategy||P.level<2?4:0),ce(P,3),P.status=W);else{var X=O+(P.w_bits-8<<4)<<8;X|=(2<=P.strategy||P.level<2?0:P.level<6?1:P.level===6?2:3)<<6,P.strstart!==0&&(X|=32),X+=31-X%31,P.status=W,pe(P,X),P.strstart!==0&&(pe(P,g.adler>>>16),pe(P,65535&g.adler)),g.adler=1}if(P.status===69)if(P.gzhead.extra){for(L=P.pending;P.gzindex<(65535&P.gzhead.extra.length)&&(P.pending!==P.pending_buf_size||(P.gzhead.hcrc&&P.pending>L&&(g.adler=d(g.adler,P.pending_buf,P.pending-L,L)),S(g),L=P.pending,P.pending!==P.pending_buf_size));)ce(P,255&P.gzhead.extra[P.gzindex]),P.gzindex++;P.gzhead.hcrc&&P.pending>L&&(g.adler=d(g.adler,P.pending_buf,P.pending-L,L)),P.gzindex===P.gzhead.extra.length&&(P.gzindex=0,P.status=73)}else P.status=73;if(P.status===73)if(P.gzhead.name){L=P.pending;do{if(P.pending===P.pending_buf_size&&(P.gzhead.hcrc&&P.pending>L&&(g.adler=d(g.adler,P.pending_buf,P.pending-L,L)),S(g),L=P.pending,P.pending===P.pending_buf_size)){q=1;break}q=P.gzindex<P.gzhead.name.length?255&P.gzhead.name.charCodeAt(P.gzindex++):0,ce(P,q)}while(q!==0);P.gzhead.hcrc&&P.pending>L&&(g.adler=d(g.adler,P.pending_buf,P.pending-L,L)),q===0&&(P.gzindex=0,P.status=91)}else P.status=91;if(P.status===91)if(P.gzhead.comment){L=P.pending;do{if(P.pending===P.pending_buf_size&&(P.gzhead.hcrc&&P.pending>L&&(g.adler=d(g.adler,P.pending_buf,P.pending-L,L)),S(g),L=P.pending,P.pending===P.pending_buf_size)){q=1;break}q=P.gzindex<P.gzhead.comment.length?255&P.gzhead.comment.charCodeAt(P.gzindex++):0,ce(P,q)}while(q!==0);P.gzhead.hcrc&&P.pending>L&&(g.adler=d(g.adler,P.pending_buf,P.pending-L,L)),q===0&&(P.status=103)}else P.status=103;if(P.status===103&&(P.gzhead.hcrc?(P.pending+2>P.pending_buf_size&&S(g),P.pending+2<=P.pending_buf_size&&(ce(P,255&g.adler),ce(P,g.adler>>8&255),g.adler=0,P.status=W)):P.status=W),P.pending!==0){if(S(g),g.avail_out===0)return P.last_flush=-1,w}else if(g.avail_in===0&&fe(ee)<=fe(G)&&ee!==N)return je(g,-5);if(P.status===666&&g.avail_in!==0)return je(g,-5);if(g.avail_in!==0||P.lookahead!==0||ee!==b&&P.status!==666){var se=P.strategy===2?function(Q,ue){for(var Ie;;){if(Q.lookahead===0&&(Te(Q),Q.lookahead===0)){if(ue===b)return _;break}if(Q.match_length=0,Ie=f._tr_tally(Q,0,Q.window[Q.strstart]),Q.lookahead--,Q.strstart++,Ie&&(A(Q,!1),Q.strm.avail_out===0))return _}return Q.insert=0,ue===N?(A(Q,!0),Q.strm.avail_out===0?be:ge):Q.last_lit&&(A(Q,!1),Q.strm.avail_out===0)?_:ie}(P,ee):P.strategy===3?function(Q,ue){for(var Ie,ye,Ce,Be,$e=Q.window;;){if(Q.lookahead<=Z){if(Te(Q),Q.lookahead<=Z&&ue===b)return _;if(Q.lookahead===0)break}if(Q.match_length=0,Q.lookahead>=J&&0<Q.strstart&&(ye=$e[Ce=Q.strstart-1])===$e[++Ce]&&ye===$e[++Ce]&&ye===$e[++Ce]){Be=Q.strstart+Z;do;while(ye===$e[++Ce]&&ye===$e[++Ce]&&ye===$e[++Ce]&&ye===$e[++Ce]&&ye===$e[++Ce]&&ye===$e[++Ce]&&ye===$e[++Ce]&&ye===$e[++Ce]&&Ce<Be);Q.match_length=Z-(Be-Ce),Q.match_length>Q.lookahead&&(Q.match_length=Q.lookahead)}if(Q.match_length>=J?(Ie=f._tr_tally(Q,1,Q.match_length-J),Q.lookahead-=Q.match_length,Q.strstart+=Q.match_length,Q.match_length=0):(Ie=f._tr_tally(Q,0,Q.window[Q.strstart]),Q.lookahead--,Q.strstart++),Ie&&(A(Q,!1),Q.strm.avail_out===0))return _}return Q.insert=0,ue===N?(A(Q,!0),Q.strm.avail_out===0?be:ge):Q.last_lit&&(A(Q,!1),Q.strm.avail_out===0)?_:ie}(P,ee):u[P.level].func(P,ee);if(se!==be&&se!==ge||(P.status=666),se===_||se===be)return g.avail_out===0&&(P.last_flush=-1),w;if(se===ie&&(ee===1?f._tr_align(P):ee!==5&&(f._tr_stored_block(P,0,0,!1),ee===3&&(B(P.head),P.lookahead===0&&(P.strstart=0,P.block_start=0,P.insert=0))),S(g),g.avail_out===0))return P.last_flush=-1,w}return ee!==N?w:P.wrap<=0?1:(P.wrap===2?(ce(P,255&g.adler),ce(P,g.adler>>8&255),ce(P,g.adler>>16&255),ce(P,g.adler>>24&255),ce(P,255&g.total_in),ce(P,g.total_in>>8&255),ce(P,g.total_in>>16&255),ce(P,g.total_in>>24&255)):(pe(P,g.adler>>>16),pe(P,65535&g.adler)),S(g),0<P.wrap&&(P.wrap=-P.wrap),P.pending!==0?w:1)},h.deflateEnd=function(g){var ee;return g&&g.state?(ee=g.state.status)!==$&&ee!==69&&ee!==73&&ee!==91&&ee!==103&&ee!==W&&ee!==666?je(g,I):(g.state=null,ee===W?je(g,-3):w):I},h.deflateSetDictionary=function(g,ee){var G,P,L,q,X,se,Q,ue,Ie=ee.length;if(!g||!g.state||(q=(G=g.state).wrap)===2||q===1&&G.status!==$||G.lookahead)return I;for(q===1&&(g.adler=x(g.adler,ee,Ie,0)),G.wrap=0,Ie>=G.w_size&&(q===0&&(B(G.head),G.strstart=0,G.block_start=0,G.insert=0),ue=new l.Buf8(G.w_size),l.arraySet(ue,ee,Ie-G.w_size,G.w_size,0),ee=ue,Ie=G.w_size),X=g.avail_in,se=g.next_in,Q=g.input,g.avail_in=Ie,g.next_in=0,g.input=ee,Te(G);G.lookahead>=J;){for(P=G.strstart,L=G.lookahead-(J-1);G.ins_h=(G.ins_h<<G.hash_shift^G.window[P+J-1])&G.hash_mask,G.prev[P&G.w_mask]=G.head[G.ins_h],G.head[G.ins_h]=P,P++,--L;);G.strstart=P,G.lookahead=J-1,Te(G)}return G.strstart+=G.lookahead,G.block_start=G.strstart,G.insert=G.lookahead,G.lookahead=0,G.match_length=G.prev_length=J-1,G.match_available=0,g.next_in=se,g.input=Q,g.avail_in=X,G.wrap=q,w},h.deflateInfo="pako deflate (from Nodeca project)"},{"../utils/common":41,"./adler32":43,"./crc32":45,"./messages":51,"./trees":52}],47:[function(o,v,h){v.exports=function(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name="",this.comment="",this.hcrc=0,this.done=!1}},{}],48:[function(o,v,h){v.exports=function(u,l){var f,x,d,T,b,N,w,I,k,C,j,O,F,R,M,H,V,oe,J,Z,de,$,W,_,ie;f=u.state,x=u.next_in,_=u.input,d=x+(u.avail_in-5),T=u.next_out,ie=u.output,b=T-(l-u.avail_out),N=T+(u.avail_out-257),w=f.dmax,I=f.wsize,k=f.whave,C=f.wnext,j=f.window,O=f.hold,F=f.bits,R=f.lencode,M=f.distcode,H=(1<<f.lenbits)-1,V=(1<<f.distbits)-1;e:do{F<15&&(O+=_[x++]<<F,F+=8,O+=_[x++]<<F,F+=8),oe=R[O&H];t:for(;;){if(O>>>=J=oe>>>24,F-=J,(J=oe>>>16&255)===0)ie[T++]=65535&oe;else{if(!(16&J)){if((64&J)==0){oe=R[(65535&oe)+(O&(1<<J)-1)];continue t}if(32&J){f.mode=12;break e}u.msg="invalid literal/length code",f.mode=30;break e}Z=65535&oe,(J&=15)&&(F<J&&(O+=_[x++]<<F,F+=8),Z+=O&(1<<J)-1,O>>>=J,F-=J),F<15&&(O+=_[x++]<<F,F+=8,O+=_[x++]<<F,F+=8),oe=M[O&V];r:for(;;){if(O>>>=J=oe>>>24,F-=J,!(16&(J=oe>>>16&255))){if((64&J)==0){oe=M[(65535&oe)+(O&(1<<J)-1)];continue r}u.msg="invalid distance code",f.mode=30;break e}if(de=65535&oe,F<(J&=15)&&(O+=_[x++]<<F,(F+=8)<J&&(O+=_[x++]<<F,F+=8)),w<(de+=O&(1<<J)-1)){u.msg="invalid distance too far back",f.mode=30;break e}if(O>>>=J,F-=J,(J=T-b)<de){if(k<(J=de-J)&&f.sane){u.msg="invalid distance too far back",f.mode=30;break e}if(W=j,($=0)===C){if($+=I-J,J<Z){for(Z-=J;ie[T++]=j[$++],--J;);$=T-de,W=ie}}else if(C<J){if($+=I+C-J,(J-=C)<Z){for(Z-=J;ie[T++]=j[$++],--J;);if($=0,C<Z){for(Z-=J=C;ie[T++]=j[$++],--J;);$=T-de,W=ie}}}else if($+=C-J,J<Z){for(Z-=J;ie[T++]=j[$++],--J;);$=T-de,W=ie}for(;2<Z;)ie[T++]=W[$++],ie[T++]=W[$++],ie[T++]=W[$++],Z-=3;Z&&(ie[T++]=W[$++],1<Z&&(ie[T++]=W[$++]))}else{for($=T-de;ie[T++]=ie[$++],ie[T++]=ie[$++],ie[T++]=ie[$++],2<(Z-=3););Z&&(ie[T++]=ie[$++],1<Z&&(ie[T++]=ie[$++]))}break}}break}}while(x<d&&T<N);x-=Z=F>>3,O&=(1<<(F-=Z<<3))-1,u.next_in=x,u.next_out=T,u.avail_in=x<d?d-x+5:5-(x-d),u.avail_out=T<N?N-T+257:257-(T-N),f.hold=O,f.bits=F}},{}],49:[function(o,v,h){var u=o("../utils/common"),l=o("./adler32"),f=o("./crc32"),x=o("./inffast"),d=o("./inftrees"),T=1,b=2,N=0,w=-2,I=1,k=852,C=592;function j($){return($>>>24&255)+($>>>8&65280)+((65280&$)<<8)+((255&$)<<24)}function O(){this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new u.Buf16(320),this.work=new u.Buf16(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}function F($){var W;return $&&$.state?(W=$.state,$.total_in=$.total_out=W.total=0,$.msg="",W.wrap&&($.adler=1&W.wrap),W.mode=I,W.last=0,W.havedict=0,W.dmax=32768,W.head=null,W.hold=0,W.bits=0,W.lencode=W.lendyn=new u.Buf32(k),W.distcode=W.distdyn=new u.Buf32(C),W.sane=1,W.back=-1,N):w}function R($){var W;return $&&$.state?((W=$.state).wsize=0,W.whave=0,W.wnext=0,F($)):w}function M($,W){var _,ie;return $&&$.state?(ie=$.state,W<0?(_=0,W=-W):(_=1+(W>>4),W<48&&(W&=15)),W&&(W<8||15<W)?w:(ie.window!==null&&ie.wbits!==W&&(ie.window=null),ie.wrap=_,ie.wbits=W,R($))):w}function H($,W){var _,ie;return $?(ie=new O,($.state=ie).window=null,(_=M($,W))!==N&&($.state=null),_):w}var V,oe,J=!0;function Z($){if(J){var W;for(V=new u.Buf32(512),oe=new u.Buf32(32),W=0;W<144;)$.lens[W++]=8;for(;W<256;)$.lens[W++]=9;for(;W<280;)$.lens[W++]=7;for(;W<288;)$.lens[W++]=8;for(d(T,$.lens,0,288,V,0,$.work,{bits:9}),W=0;W<32;)$.lens[W++]=5;d(b,$.lens,0,32,oe,0,$.work,{bits:5}),J=!1}$.lencode=V,$.lenbits=9,$.distcode=oe,$.distbits=5}function de($,W,_,ie){var be,ge=$.state;return ge.window===null&&(ge.wsize=1<<ge.wbits,ge.wnext=0,ge.whave=0,ge.window=new u.Buf8(ge.wsize)),ie>=ge.wsize?(u.arraySet(ge.window,W,_-ge.wsize,ge.wsize,0),ge.wnext=0,ge.whave=ge.wsize):(ie<(be=ge.wsize-ge.wnext)&&(be=ie),u.arraySet(ge.window,W,_-ie,be,ge.wnext),(ie-=be)?(u.arraySet(ge.window,W,_-ie,ie,0),ge.wnext=ie,ge.whave=ge.wsize):(ge.wnext+=be,ge.wnext===ge.wsize&&(ge.wnext=0),ge.whave<ge.wsize&&(ge.whave+=be))),0}h.inflateReset=R,h.inflateReset2=M,h.inflateResetKeep=F,h.inflateInit=function($){return H($,15)},h.inflateInit2=H,h.inflate=function($,W){var _,ie,be,ge,je,fe,B,S,A,ce,pe,me,Te,he,Se,Ee,Le,qe,te,Y,g,ee,G,P,L=0,q=new u.Buf8(4),X=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15];if(!$||!$.state||!$.output||!$.input&&$.avail_in!==0)return w;(_=$.state).mode===12&&(_.mode=13),je=$.next_out,be=$.output,B=$.avail_out,ge=$.next_in,ie=$.input,fe=$.avail_in,S=_.hold,A=_.bits,ce=fe,pe=B,ee=N;e:for(;;)switch(_.mode){case I:if(_.wrap===0){_.mode=13;break}for(;A<16;){if(fe===0)break e;fe--,S+=ie[ge++]<<A,A+=8}if(2&_.wrap&&S===35615){q[_.check=0]=255&S,q[1]=S>>>8&255,_.check=f(_.check,q,2,0),A=S=0,_.mode=2;break}if(_.flags=0,_.head&&(_.head.done=!1),!(1&_.wrap)||(((255&S)<<8)+(S>>8))%31){$.msg="incorrect header check",_.mode=30;break}if((15&S)!=8){$.msg="unknown compression method",_.mode=30;break}if(A-=4,g=8+(15&(S>>>=4)),_.wbits===0)_.wbits=g;else if(g>_.wbits){$.msg="invalid window size",_.mode=30;break}_.dmax=1<<g,$.adler=_.check=1,_.mode=512&S?10:12,A=S=0;break;case 2:for(;A<16;){if(fe===0)break e;fe--,S+=ie[ge++]<<A,A+=8}if(_.flags=S,(255&_.flags)!=8){$.msg="unknown compression method",_.mode=30;break}if(57344&_.flags){$.msg="unknown header flags set",_.mode=30;break}_.head&&(_.head.text=S>>8&1),512&_.flags&&(q[0]=255&S,q[1]=S>>>8&255,_.check=f(_.check,q,2,0)),A=S=0,_.mode=3;case 3:for(;A<32;){if(fe===0)break e;fe--,S+=ie[ge++]<<A,A+=8}_.head&&(_.head.time=S),512&_.flags&&(q[0]=255&S,q[1]=S>>>8&255,q[2]=S>>>16&255,q[3]=S>>>24&255,_.check=f(_.check,q,4,0)),A=S=0,_.mode=4;case 4:for(;A<16;){if(fe===0)break e;fe--,S+=ie[ge++]<<A,A+=8}_.head&&(_.head.xflags=255&S,_.head.os=S>>8),512&_.flags&&(q[0]=255&S,q[1]=S>>>8&255,_.check=f(_.check,q,2,0)),A=S=0,_.mode=5;case 5:if(1024&_.flags){for(;A<16;){if(fe===0)break e;fe--,S+=ie[ge++]<<A,A+=8}_.length=S,_.head&&(_.head.extra_len=S),512&_.flags&&(q[0]=255&S,q[1]=S>>>8&255,_.check=f(_.check,q,2,0)),A=S=0}else _.head&&(_.head.extra=null);_.mode=6;case 6:if(1024&_.flags&&(fe<(me=_.length)&&(me=fe),me&&(_.head&&(g=_.head.extra_len-_.length,_.head.extra||(_.head.extra=new Array(_.head.extra_len)),u.arraySet(_.head.extra,ie,ge,me,g)),512&_.flags&&(_.check=f(_.check,ie,me,ge)),fe-=me,ge+=me,_.length-=me),_.length))break e;_.length=0,_.mode=7;case 7:if(2048&_.flags){if(fe===0)break e;for(me=0;g=ie[ge+me++],_.head&&g&&_.length<65536&&(_.head.name+=String.fromCharCode(g)),g&&me<fe;);if(512&_.flags&&(_.check=f(_.check,ie,me,ge)),fe-=me,ge+=me,g)break e}else _.head&&(_.head.name=null);_.length=0,_.mode=8;case 8:if(4096&_.flags){if(fe===0)break e;for(me=0;g=ie[ge+me++],_.head&&g&&_.length<65536&&(_.head.comment+=String.fromCharCode(g)),g&&me<fe;);if(512&_.flags&&(_.check=f(_.check,ie,me,ge)),fe-=me,ge+=me,g)break e}else _.head&&(_.head.comment=null);_.mode=9;case 9:if(512&_.flags){for(;A<16;){if(fe===0)break e;fe--,S+=ie[ge++]<<A,A+=8}if(S!==(65535&_.check)){$.msg="header crc mismatch",_.mode=30;break}A=S=0}_.head&&(_.head.hcrc=_.flags>>9&1,_.head.done=!0),$.adler=_.check=0,_.mode=12;break;case 10:for(;A<32;){if(fe===0)break e;fe--,S+=ie[ge++]<<A,A+=8}$.adler=_.check=j(S),A=S=0,_.mode=11;case 11:if(_.havedict===0)return $.next_out=je,$.avail_out=B,$.next_in=ge,$.avail_in=fe,_.hold=S,_.bits=A,2;$.adler=_.check=1,_.mode=12;case 12:if(W===5||W===6)break e;case 13:if(_.last){S>>>=7&A,A-=7&A,_.mode=27;break}for(;A<3;){if(fe===0)break e;fe--,S+=ie[ge++]<<A,A+=8}switch(_.last=1&S,A-=1,3&(S>>>=1)){case 0:_.mode=14;break;case 1:if(Z(_),_.mode=20,W!==6)break;S>>>=2,A-=2;break e;case 2:_.mode=17;break;case 3:$.msg="invalid block type",_.mode=30}S>>>=2,A-=2;break;case 14:for(S>>>=7&A,A-=7&A;A<32;){if(fe===0)break e;fe--,S+=ie[ge++]<<A,A+=8}if((65535&S)!=(S>>>16^65535)){$.msg="invalid stored block lengths",_.mode=30;break}if(_.length=65535&S,A=S=0,_.mode=15,W===6)break e;case 15:_.mode=16;case 16:if(me=_.length){if(fe<me&&(me=fe),B<me&&(me=B),me===0)break e;u.arraySet(be,ie,ge,me,je),fe-=me,ge+=me,B-=me,je+=me,_.length-=me;break}_.mode=12;break;case 17:for(;A<14;){if(fe===0)break e;fe--,S+=ie[ge++]<<A,A+=8}if(_.nlen=257+(31&S),S>>>=5,A-=5,_.ndist=1+(31&S),S>>>=5,A-=5,_.ncode=4+(15&S),S>>>=4,A-=4,286<_.nlen||30<_.ndist){$.msg="too many length or distance symbols",_.mode=30;break}_.have=0,_.mode=18;case 18:for(;_.have<_.ncode;){for(;A<3;){if(fe===0)break e;fe--,S+=ie[ge++]<<A,A+=8}_.lens[X[_.have++]]=7&S,S>>>=3,A-=3}for(;_.have<19;)_.lens[X[_.have++]]=0;if(_.lencode=_.lendyn,_.lenbits=7,G={bits:_.lenbits},ee=d(0,_.lens,0,19,_.lencode,0,_.work,G),_.lenbits=G.bits,ee){$.msg="invalid code lengths set",_.mode=30;break}_.have=0,_.mode=19;case 19:for(;_.have<_.nlen+_.ndist;){for(;Ee=(L=_.lencode[S&(1<<_.lenbits)-1])>>>16&255,Le=65535&L,!((Se=L>>>24)<=A);){if(fe===0)break e;fe--,S+=ie[ge++]<<A,A+=8}if(Le<16)S>>>=Se,A-=Se,_.lens[_.have++]=Le;else{if(Le===16){for(P=Se+2;A<P;){if(fe===0)break e;fe--,S+=ie[ge++]<<A,A+=8}if(S>>>=Se,A-=Se,_.have===0){$.msg="invalid bit length repeat",_.mode=30;break}g=_.lens[_.have-1],me=3+(3&S),S>>>=2,A-=2}else if(Le===17){for(P=Se+3;A<P;){if(fe===0)break e;fe--,S+=ie[ge++]<<A,A+=8}A-=Se,g=0,me=3+(7&(S>>>=Se)),S>>>=3,A-=3}else{for(P=Se+7;A<P;){if(fe===0)break e;fe--,S+=ie[ge++]<<A,A+=8}A-=Se,g=0,me=11+(127&(S>>>=Se)),S>>>=7,A-=7}if(_.have+me>_.nlen+_.ndist){$.msg="invalid bit length repeat",_.mode=30;break}for(;me--;)_.lens[_.have++]=g}}if(_.mode===30)break;if(_.lens[256]===0){$.msg="invalid code -- missing end-of-block",_.mode=30;break}if(_.lenbits=9,G={bits:_.lenbits},ee=d(T,_.lens,0,_.nlen,_.lencode,0,_.work,G),_.lenbits=G.bits,ee){$.msg="invalid literal/lengths set",_.mode=30;break}if(_.distbits=6,_.distcode=_.distdyn,G={bits:_.distbits},ee=d(b,_.lens,_.nlen,_.ndist,_.distcode,0,_.work,G),_.distbits=G.bits,ee){$.msg="invalid distances set",_.mode=30;break}if(_.mode=20,W===6)break e;case 20:_.mode=21;case 21:if(6<=fe&&258<=B){$.next_out=je,$.avail_out=B,$.next_in=ge,$.avail_in=fe,_.hold=S,_.bits=A,x($,pe),je=$.next_out,be=$.output,B=$.avail_out,ge=$.next_in,ie=$.input,fe=$.avail_in,S=_.hold,A=_.bits,_.mode===12&&(_.back=-1);break}for(_.back=0;Ee=(L=_.lencode[S&(1<<_.lenbits)-1])>>>16&255,Le=65535&L,!((Se=L>>>24)<=A);){if(fe===0)break e;fe--,S+=ie[ge++]<<A,A+=8}if(Ee&&(240&Ee)==0){for(qe=Se,te=Ee,Y=Le;Ee=(L=_.lencode[Y+((S&(1<<qe+te)-1)>>qe)])>>>16&255,Le=65535&L,!(qe+(Se=L>>>24)<=A);){if(fe===0)break e;fe--,S+=ie[ge++]<<A,A+=8}S>>>=qe,A-=qe,_.back+=qe}if(S>>>=Se,A-=Se,_.back+=Se,_.length=Le,Ee===0){_.mode=26;break}if(32&Ee){_.back=-1,_.mode=12;break}if(64&Ee){$.msg="invalid literal/length code",_.mode=30;break}_.extra=15&Ee,_.mode=22;case 22:if(_.extra){for(P=_.extra;A<P;){if(fe===0)break e;fe--,S+=ie[ge++]<<A,A+=8}_.length+=S&(1<<_.extra)-1,S>>>=_.extra,A-=_.extra,_.back+=_.extra}_.was=_.length,_.mode=23;case 23:for(;Ee=(L=_.distcode[S&(1<<_.distbits)-1])>>>16&255,Le=65535&L,!((Se=L>>>24)<=A);){if(fe===0)break e;fe--,S+=ie[ge++]<<A,A+=8}if((240&Ee)==0){for(qe=Se,te=Ee,Y=Le;Ee=(L=_.distcode[Y+((S&(1<<qe+te)-1)>>qe)])>>>16&255,Le=65535&L,!(qe+(Se=L>>>24)<=A);){if(fe===0)break e;fe--,S+=ie[ge++]<<A,A+=8}S>>>=qe,A-=qe,_.back+=qe}if(S>>>=Se,A-=Se,_.back+=Se,64&Ee){$.msg="invalid distance code",_.mode=30;break}_.offset=Le,_.extra=15&Ee,_.mode=24;case 24:if(_.extra){for(P=_.extra;A<P;){if(fe===0)break e;fe--,S+=ie[ge++]<<A,A+=8}_.offset+=S&(1<<_.extra)-1,S>>>=_.extra,A-=_.extra,_.back+=_.extra}if(_.offset>_.dmax){$.msg="invalid distance too far back",_.mode=30;break}_.mode=25;case 25:if(B===0)break e;if(me=pe-B,_.offset>me){if((me=_.offset-me)>_.whave&&_.sane){$.msg="invalid distance too far back",_.mode=30;break}Te=me>_.wnext?(me-=_.wnext,_.wsize-me):_.wnext-me,me>_.length&&(me=_.length),he=_.window}else he=be,Te=je-_.offset,me=_.length;for(B<me&&(me=B),B-=me,_.length-=me;be[je++]=he[Te++],--me;);_.length===0&&(_.mode=21);break;case 26:if(B===0)break e;be[je++]=_.length,B--,_.mode=21;break;case 27:if(_.wrap){for(;A<32;){if(fe===0)break e;fe--,S|=ie[ge++]<<A,A+=8}if(pe-=B,$.total_out+=pe,_.total+=pe,pe&&($.adler=_.check=_.flags?f(_.check,be,pe,je-pe):l(_.check,be,pe,je-pe)),pe=B,(_.flags?S:j(S))!==_.check){$.msg="incorrect data check",_.mode=30;break}A=S=0}_.mode=28;case 28:if(_.wrap&&_.flags){for(;A<32;){if(fe===0)break e;fe--,S+=ie[ge++]<<A,A+=8}if(S!==(4294967295&_.total)){$.msg="incorrect length check",_.mode=30;break}A=S=0}_.mode=29;case 29:ee=1;break e;case 30:ee=-3;break e;case 31:return-4;case 32:default:return w}return $.next_out=je,$.avail_out=B,$.next_in=ge,$.avail_in=fe,_.hold=S,_.bits=A,(_.wsize||pe!==$.avail_out&&_.mode<30&&(_.mode<27||W!==4))&&de($,$.output,$.next_out,pe-$.avail_out)?(_.mode=31,-4):(ce-=$.avail_in,pe-=$.avail_out,$.total_in+=ce,$.total_out+=pe,_.total+=pe,_.wrap&&pe&&($.adler=_.check=_.flags?f(_.check,be,pe,$.next_out-pe):l(_.check,be,pe,$.next_out-pe)),$.data_type=_.bits+(_.last?64:0)+(_.mode===12?128:0)+(_.mode===20||_.mode===15?256:0),(ce==0&&pe===0||W===4)&&ee===N&&(ee=-5),ee)},h.inflateEnd=function($){if(!$||!$.state)return w;var W=$.state;return W.window&&(W.window=null),$.state=null,N},h.inflateGetHeader=function($,W){var _;return $&&$.state?(2&(_=$.state).wrap)==0?w:((_.head=W).done=!1,N):w},h.inflateSetDictionary=function($,W){var _,ie=W.length;return $&&$.state?(_=$.state).wrap!==0&&_.mode!==11?w:_.mode===11&&l(1,W,ie,0)!==_.check?-3:de($,W,ie,ie)?(_.mode=31,-4):(_.havedict=1,N):w},h.inflateInfo="pako inflate (from Nodeca project)"},{"../utils/common":41,"./adler32":43,"./crc32":45,"./inffast":48,"./inftrees":50}],50:[function(o,v,h){var u=o("../utils/common"),l=[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0],f=[16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78],x=[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0],d=[16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64];v.exports=function(T,b,N,w,I,k,C,j){var O,F,R,M,H,V,oe,J,Z,de=j.bits,$=0,W=0,_=0,ie=0,be=0,ge=0,je=0,fe=0,B=0,S=0,A=null,ce=0,pe=new u.Buf16(16),me=new u.Buf16(16),Te=null,he=0;for($=0;$<=15;$++)pe[$]=0;for(W=0;W<w;W++)pe[b[N+W]]++;for(be=de,ie=15;1<=ie&&pe[ie]===0;ie--);if(ie<be&&(be=ie),ie===0)return I[k++]=20971520,I[k++]=20971520,j.bits=1,0;for(_=1;_<ie&&pe[_]===0;_++);for(be<_&&(be=_),$=fe=1;$<=15;$++)if(fe<<=1,(fe-=pe[$])<0)return-1;if(0<fe&&(T===0||ie!==1))return-1;for(me[1]=0,$=1;$<15;$++)me[$+1]=me[$]+pe[$];for(W=0;W<w;W++)b[N+W]!==0&&(C[me[b[N+W]]++]=W);if(V=T===0?(A=Te=C,19):T===1?(A=l,ce-=257,Te=f,he-=257,256):(A=x,Te=d,-1),$=_,H=k,je=W=S=0,R=-1,M=(B=1<<(ge=be))-1,T===1&&852<B||T===2&&592<B)return 1;for(;;){for(oe=$-je,Z=C[W]<V?(J=0,C[W]):C[W]>V?(J=Te[he+C[W]],A[ce+C[W]]):(J=96,0),O=1<<$-je,_=F=1<<ge;I[H+(S>>je)+(F-=O)]=oe<<24|J<<16|Z|0,F!==0;);for(O=1<<$-1;S&O;)O>>=1;if(O!==0?(S&=O-1,S+=O):S=0,W++,--pe[$]==0){if($===ie)break;$=b[N+C[W]]}if(be<$&&(S&M)!==R){for(je===0&&(je=be),H+=_,fe=1<<(ge=$-je);ge+je<ie&&!((fe-=pe[ge+je])<=0);)ge++,fe<<=1;if(B+=1<<ge,T===1&&852<B||T===2&&592<B)return 1;I[R=S&M]=be<<24|ge<<16|H-k|0}}return S!==0&&(I[H+S]=$-je<<24|64<<16|0),j.bits=be,0}},{"../utils/common":41}],51:[function(o,v,h){v.exports={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"}},{}],52:[function(o,v,h){var u=o("../utils/common"),l=0,f=1;function x(L){for(var q=L.length;0<=--q;)L[q]=0}var d=0,T=29,b=256,N=b+1+T,w=30,I=19,k=2*N+1,C=15,j=16,O=7,F=256,R=16,M=17,H=18,V=[0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0],oe=[0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13],J=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7],Z=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15],de=new Array(2*(N+2));x(de);var $=new Array(2*w);x($);var W=new Array(512);x(W);var _=new Array(256);x(_);var ie=new Array(T);x(ie);var be,ge,je,fe=new Array(w);function B(L,q,X,se,Q){this.static_tree=L,this.extra_bits=q,this.extra_base=X,this.elems=se,this.max_length=Q,this.has_stree=L&&L.length}function S(L,q){this.dyn_tree=L,this.max_code=0,this.stat_desc=q}function A(L){return L<256?W[L]:W[256+(L>>>7)]}function ce(L,q){L.pending_buf[L.pending++]=255&q,L.pending_buf[L.pending++]=q>>>8&255}function pe(L,q,X){L.bi_valid>j-X?(L.bi_buf|=q<<L.bi_valid&65535,ce(L,L.bi_buf),L.bi_buf=q>>j-L.bi_valid,L.bi_valid+=X-j):(L.bi_buf|=q<<L.bi_valid&65535,L.bi_valid+=X)}function me(L,q,X){pe(L,X[2*q],X[2*q+1])}function Te(L,q){for(var X=0;X|=1&L,L>>>=1,X<<=1,0<--q;);return X>>>1}function he(L,q,X){var se,Q,ue=new Array(C+1),Ie=0;for(se=1;se<=C;se++)ue[se]=Ie=Ie+X[se-1]<<1;for(Q=0;Q<=q;Q++){var ye=L[2*Q+1];ye!==0&&(L[2*Q]=Te(ue[ye]++,ye))}}function Se(L){var q;for(q=0;q<N;q++)L.dyn_ltree[2*q]=0;for(q=0;q<w;q++)L.dyn_dtree[2*q]=0;for(q=0;q<I;q++)L.bl_tree[2*q]=0;L.dyn_ltree[2*F]=1,L.opt_len=L.static_len=0,L.last_lit=L.matches=0}function Ee(L){8<L.bi_valid?ce(L,L.bi_buf):0<L.bi_valid&&(L.pending_buf[L.pending++]=L.bi_buf),L.bi_buf=0,L.bi_valid=0}function Le(L,q,X,se){var Q=2*q,ue=2*X;return L[Q]<L[ue]||L[Q]===L[ue]&&se[q]<=se[X]}function qe(L,q,X){for(var se=L.heap[X],Q=X<<1;Q<=L.heap_len&&(Q<L.heap_len&&Le(q,L.heap[Q+1],L.heap[Q],L.depth)&&Q++,!Le(q,se,L.heap[Q],L.depth));)L.heap[X]=L.heap[Q],X=Q,Q<<=1;L.heap[X]=se}function te(L,q,X){var se,Q,ue,Ie,ye=0;if(L.last_lit!==0)for(;se=L.pending_buf[L.d_buf+2*ye]<<8|L.pending_buf[L.d_buf+2*ye+1],Q=L.pending_buf[L.l_buf+ye],ye++,se===0?me(L,Q,q):(me(L,(ue=_[Q])+b+1,q),(Ie=V[ue])!==0&&pe(L,Q-=ie[ue],Ie),me(L,ue=A(--se),X),(Ie=oe[ue])!==0&&pe(L,se-=fe[ue],Ie)),ye<L.last_lit;);me(L,F,q)}function Y(L,q){var X,se,Q,ue=q.dyn_tree,Ie=q.stat_desc.static_tree,ye=q.stat_desc.has_stree,Ce=q.stat_desc.elems,Be=-1;for(L.heap_len=0,L.heap_max=k,X=0;X<Ce;X++)ue[2*X]!==0?(L.heap[++L.heap_len]=Be=X,L.depth[X]=0):ue[2*X+1]=0;for(;L.heap_len<2;)ue[2*(Q=L.heap[++L.heap_len]=Be<2?++Be:0)]=1,L.depth[Q]=0,L.opt_len--,ye&&(L.static_len-=Ie[2*Q+1]);for(q.max_code=Be,X=L.heap_len>>1;1<=X;X--)qe(L,ue,X);for(Q=Ce;X=L.heap[1],L.heap[1]=L.heap[L.heap_len--],qe(L,ue,1),se=L.heap[1],L.heap[--L.heap_max]=X,L.heap[--L.heap_max]=se,ue[2*Q]=ue[2*X]+ue[2*se],L.depth[Q]=(L.depth[X]>=L.depth[se]?L.depth[X]:L.depth[se])+1,ue[2*X+1]=ue[2*se+1]=Q,L.heap[1]=Q++,qe(L,ue,1),2<=L.heap_len;);L.heap[--L.heap_max]=L.heap[1],function($e,ct){var et,pt,qt,ft,jt,gr,Ct=ct.dyn_tree,Mt=ct.max_code,tt=ct.stat_desc.static_tree,Wt=ct.stat_desc.has_stree,ar=ct.stat_desc.extra_bits,ir=ct.stat_desc.extra_base,ut=ct.stat_desc.max_length,br=0;for(ft=0;ft<=C;ft++)$e.bl_count[ft]=0;for(Ct[2*$e.heap[$e.heap_max]+1]=0,et=$e.heap_max+1;et<k;et++)ut<(ft=Ct[2*Ct[2*(pt=$e.heap[et])+1]+1]+1)&&(ft=ut,br++),Ct[2*pt+1]=ft,Mt<pt||($e.bl_count[ft]++,jt=0,ir<=pt&&(jt=ar[pt-ir]),gr=Ct[2*pt],$e.opt_len+=gr*(ft+jt),Wt&&($e.static_len+=gr*(tt[2*pt+1]+jt)));if(br!==0){do{for(ft=ut-1;$e.bl_count[ft]===0;)ft--;$e.bl_count[ft]--,$e.bl_count[ft+1]+=2,$e.bl_count[ut]--,br-=2}while(0<br);for(ft=ut;ft!==0;ft--)for(pt=$e.bl_count[ft];pt!==0;)Mt<(qt=$e.heap[--et])||(Ct[2*qt+1]!==ft&&($e.opt_len+=(ft-Ct[2*qt+1])*Ct[2*qt],Ct[2*qt+1]=ft),pt--)}}(L,q),he(ue,Be,L.bl_count)}function g(L,q,X){var se,Q,ue=-1,Ie=q[1],ye=0,Ce=7,Be=4;for(Ie===0&&(Ce=138,Be=3),q[2*(X+1)+1]=65535,se=0;se<=X;se++)Q=Ie,Ie=q[2*(se+1)+1],++ye<Ce&&Q===Ie||(ye<Be?L.bl_tree[2*Q]+=ye:Q!==0?(Q!==ue&&L.bl_tree[2*Q]++,L.bl_tree[2*R]++):ye<=10?L.bl_tree[2*M]++:L.bl_tree[2*H]++,ue=Q,Be=(ye=0)===Ie?(Ce=138,3):Q===Ie?(Ce=6,3):(Ce=7,4))}function ee(L,q,X){var se,Q,ue=-1,Ie=q[1],ye=0,Ce=7,Be=4;for(Ie===0&&(Ce=138,Be=3),se=0;se<=X;se++)if(Q=Ie,Ie=q[2*(se+1)+1],!(++ye<Ce&&Q===Ie)){if(ye<Be)for(;me(L,Q,L.bl_tree),--ye!=0;);else Q!==0?(Q!==ue&&(me(L,Q,L.bl_tree),ye--),me(L,R,L.bl_tree),pe(L,ye-3,2)):ye<=10?(me(L,M,L.bl_tree),pe(L,ye-3,3)):(me(L,H,L.bl_tree),pe(L,ye-11,7));ue=Q,Be=(ye=0)===Ie?(Ce=138,3):Q===Ie?(Ce=6,3):(Ce=7,4)}}x(fe);var G=!1;function P(L,q,X,se){pe(L,(d<<1)+(se?1:0),3),function(Q,ue,Ie,ye){Ee(Q),ce(Q,Ie),ce(Q,~Ie),u.arraySet(Q.pending_buf,Q.window,ue,Ie,Q.pending),Q.pending+=Ie}(L,q,X)}h._tr_init=function(L){G||(function(){var q,X,se,Q,ue,Ie=new Array(C+1);for(Q=se=0;Q<T-1;Q++)for(ie[Q]=se,q=0;q<1<<V[Q];q++)_[se++]=Q;for(_[se-1]=Q,Q=ue=0;Q<16;Q++)for(fe[Q]=ue,q=0;q<1<<oe[Q];q++)W[ue++]=Q;for(ue>>=7;Q<w;Q++)for(fe[Q]=ue<<7,q=0;q<1<<oe[Q]-7;q++)W[256+ue++]=Q;for(X=0;X<=C;X++)Ie[X]=0;for(q=0;q<=143;)de[2*q+1]=8,q++,Ie[8]++;for(;q<=255;)de[2*q+1]=9,q++,Ie[9]++;for(;q<=279;)de[2*q+1]=7,q++,Ie[7]++;for(;q<=287;)de[2*q+1]=8,q++,Ie[8]++;for(he(de,N+1,Ie),q=0;q<w;q++)$[2*q+1]=5,$[2*q]=Te(q,5);be=new B(de,V,b+1,N,C),ge=new B($,oe,0,w,C),je=new B(new Array(0),J,0,I,O)}(),G=!0),L.l_desc=new S(L.dyn_ltree,be),L.d_desc=new S(L.dyn_dtree,ge),L.bl_desc=new S(L.bl_tree,je),L.bi_buf=0,L.bi_valid=0,Se(L)},h._tr_stored_block=P,h._tr_flush_block=function(L,q,X,se){var Q,ue,Ie=0;0<L.level?(L.strm.data_type===2&&(L.strm.data_type=function(ye){var Ce,Be=4093624447;for(Ce=0;Ce<=31;Ce++,Be>>>=1)if(1&Be&&ye.dyn_ltree[2*Ce]!==0)return l;if(ye.dyn_ltree[18]!==0||ye.dyn_ltree[20]!==0||ye.dyn_ltree[26]!==0)return f;for(Ce=32;Ce<b;Ce++)if(ye.dyn_ltree[2*Ce]!==0)return f;return l}(L)),Y(L,L.l_desc),Y(L,L.d_desc),Ie=function(ye){var Ce;for(g(ye,ye.dyn_ltree,ye.l_desc.max_code),g(ye,ye.dyn_dtree,ye.d_desc.max_code),Y(ye,ye.bl_desc),Ce=I-1;3<=Ce&&ye.bl_tree[2*Z[Ce]+1]===0;Ce--);return ye.opt_len+=3*(Ce+1)+5+5+4,Ce}(L),Q=L.opt_len+3+7>>>3,(ue=L.static_len+3+7>>>3)<=Q&&(Q=ue)):Q=ue=X+5,X+4<=Q&&q!==-1?P(L,q,X,se):L.strategy===4||ue===Q?(pe(L,2+(se?1:0),3),te(L,de,$)):(pe(L,4+(se?1:0),3),function(ye,Ce,Be,$e){var ct;for(pe(ye,Ce-257,5),pe(ye,Be-1,5),pe(ye,$e-4,4),ct=0;ct<$e;ct++)pe(ye,ye.bl_tree[2*Z[ct]+1],3);ee(ye,ye.dyn_ltree,Ce-1),ee(ye,ye.dyn_dtree,Be-1)}(L,L.l_desc.max_code+1,L.d_desc.max_code+1,Ie+1),te(L,L.dyn_ltree,L.dyn_dtree)),Se(L),se&&Ee(L)},h._tr_tally=function(L,q,X){return L.pending_buf[L.d_buf+2*L.last_lit]=q>>>8&255,L.pending_buf[L.d_buf+2*L.last_lit+1]=255&q,L.pending_buf[L.l_buf+L.last_lit]=255&X,L.last_lit++,q===0?L.dyn_ltree[2*X]++:(L.matches++,q--,L.dyn_ltree[2*(_[X]+b+1)]++,L.dyn_dtree[2*A(q)]++),L.last_lit===L.lit_bufsize-1},h._tr_align=function(L){pe(L,2,3),me(L,F,de),function(q){q.bi_valid===16?(ce(q,q.bi_buf),q.bi_buf=0,q.bi_valid=0):8<=q.bi_valid&&(q.pending_buf[q.pending++]=255&q.bi_buf,q.bi_buf>>=8,q.bi_valid-=8)}(L)}},{"../utils/common":41}],53:[function(o,v,h){v.exports=function(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.msg="",this.state=null,this.data_type=2,this.adler=0}},{}],54:[function(o,v,h){(function(u){(function(l,f){if(!l.setImmediate){var x,d,T,b,N=1,w={},I=!1,k=l.document,C=Object.getPrototypeOf&&Object.getPrototypeOf(l);C=C&&C.setTimeout?C:l,x={}.toString.call(l.process)==="[object process]"?function(R){process.nextTick(function(){O(R)})}:function(){if(l.postMessage&&!l.importScripts){var R=!0,M=l.onmessage;return l.onmessage=function(){R=!1},l.postMessage("","*"),l.onmessage=M,R}}()?(b="setImmediate$"+Math.random()+"$",l.addEventListener?l.addEventListener("message",F,!1):l.attachEvent("onmessage",F),function(R){l.postMessage(b+R,"*")}):l.MessageChannel?((T=new MessageChannel).port1.onmessage=function(R){O(R.data)},function(R){T.port2.postMessage(R)}):k&&"onreadystatechange"in k.createElement("script")?(d=k.documentElement,function(R){var M=k.createElement("script");M.onreadystatechange=function(){O(R),M.onreadystatechange=null,d.removeChild(M),M=null},d.appendChild(M)}):function(R){setTimeout(O,0,R)},C.setImmediate=function(R){typeof R!="function"&&(R=new Function(""+R));for(var M=new Array(arguments.length-1),H=0;H<M.length;H++)M[H]=arguments[H+1];var V={callback:R,args:M};return w[N]=V,x(N),N++},C.clearImmediate=j}function j(R){delete w[R]}function O(R){if(I)setTimeout(O,0,R);else{var M=w[R];if(M){I=!0;try{(function(H){var V=H.callback,oe=H.args;switch(oe.length){case 0:V();break;case 1:V(oe[0]);break;case 2:V(oe[0],oe[1]);break;case 3:V(oe[0],oe[1],oe[2]);break;default:V.apply(f,oe)}})(M)}finally{j(R),I=!1}}}}function F(R){R.source===l&&typeof R.data=="string"&&R.data.indexOf(b)===0&&O(+R.data.slice(b.length))}})(typeof self>"u"?u===void 0?this:u:self)}).call(this,typeof fo<"u"?fo:typeof self<"u"?self:typeof window<"u"?window:{})},{}]},{},[10])(10)})}(uc)),uc.exports}var Ep=Sp();const _p=si(Ep);var dc={exports:{}};const Np={},jp=Object.freeze(Object.defineProperty({__proto__:null,default:Np},Symbol.toStringTag,{value:"Module"})),fc=Nm(jp);var Xd;function Cp(){return Xd||(Xd=1,function(s,p){var o=void 0,v=function(h){return o||(o=new Promise(function(u,l){var f=typeof h<"u"?h:{},x=f.onAbort;f.onAbort=function(i){l(new Error(i)),x&&x(i)},f.postRun=f.postRun||[],f.postRun.push(function(){u(f)}),s=void 0;var d;d||(d=typeof f<"u"?f:{}),d.onRuntimeInitialized=function(){function i(we,Oe){switch(typeof Oe){case"boolean":Fo(we,Oe?1:0);break;case"number":Ro(we,Oe);break;case"string":Mo(we,Oe,-1,-1);break;case"object":if(Oe===null)ea(we);else if(Oe.length!=null){var Ze=Es(Oe,Ss);Lo(we,Ze,Oe.length,-1),un(Ze)}else Ts(we,"Wrong API use : tried to return a value of an unknown type ("+Oe+").",-1);break;default:ea(we)}}function m(we,Oe){for(var Ze=[],ot=0;ot<we;ot+=1){var dt=G(Oe+4*ot,"i32"),kt=To(dt);if(kt===1||kt===2)dt=Oo(dt);else if(kt===3)dt=Do(dt);else if(kt===4){kt=dt,dt=pi(kt),kt=Ao(kt);for(var tr=new Uint8Array(dt),Sr=0;Sr<dt;Sr+=1)tr[Sr]=Z[kt+Sr];dt=tr}else dt=null;Ze.push(dt)}return Ze}function E(we,Oe){this.La=we,this.db=Oe,this.Ja=1,this.fb=[]}function z(we,Oe){if(this.db=Oe,Oe=ct(we)+1,this.Ya=Ns(Oe),this.Ya===null)throw Error("Unable to allocate memory for the SQL string");et(we,de,this.Ya,Oe),this.eb=this.Ya,this.Ua=this.ib=null}function re(we){if(this.filename="dbfile_"+(4294967295*Math.random()>>>0),we!=null){var Oe=this.filename,Ze="/",ot=Oe;if(Ze&&(Ze=typeof Ze=="string"?Ze:cn(Ze),ot=Oe?Q(Ze+"/"+Oe):Ze),Oe=Wt(!0,!0),ot=Ft(ot,(Oe!==void 0?Oe:438)&4095|32768,0),we){if(typeof we=="string"){Ze=Array(we.length);for(var dt=0,kt=we.length;dt<kt;++dt)Ze[dt]=we.charCodeAt(dt);we=Ze}ps(ot,Oe|146),Ze=Un(ot,577),oi(Ze,we,0,we.length,0),Qs(Ze),ps(ot,Oe)}}this.handleError(st(this.filename,Ne)),this.db=G(Ne,"i32"),xi(this.db),this.Za={},this.Na={}}var Ne=Kr(4),De=d.cwrap,st=De("sqlite3_open","number",["string","number"]),gt=De("sqlite3_close_v2","number",["number"]),it=De("sqlite3_exec","number",["number","string","number","number","number"]),Tt=De("sqlite3_changes","number",["number"]),At=De("sqlite3_prepare_v2","number",["number","string","number","number","number"]),Ea=De("sqlite3_sql","string",["number"]),Zs=De("sqlite3_normalized_sql","string",["number"]),js=De("sqlite3_prepare_v2","number",["number","number","number","number","number"]),hi=De("sqlite3_bind_text","number",["number","number","number","number","number"]),cr=De("sqlite3_bind_blob","number",["number","number","number","number","number"]),Wn=De("sqlite3_bind_double","number",["number","number","number"]),_a=De("sqlite3_bind_int","number",["number","number","number"]),Cs=De("sqlite3_bind_parameter_index","number",["number","string"]),So=De("sqlite3_step","number",["number"]),Na=De("sqlite3_errmsg","string",["number"]),ja=De("sqlite3_column_count","number",["number"]),Is=De("sqlite3_data_count","number",["number"]),Xs=De("sqlite3_column_double","number",["number","number"]),Ca=De("sqlite3_column_text","string",["number","number"]),Eo=De("sqlite3_column_blob","number",["number","number"]),_o=De("sqlite3_column_bytes","number",["number","number"]),No=De("sqlite3_column_type","number",["number","number"]),Ia=De("sqlite3_column_name","string",["number","number"]),jo=De("sqlite3_reset","number",["number"]),Co=De("sqlite3_clear_bindings","number",["number"]),Io=De("sqlite3_finalize","number",["number"]),mi=De("sqlite3_create_function_v2","number","number string number number number number number number number".split(" ")),To=De("sqlite3_value_type","number",["number"]),pi=De("sqlite3_value_bytes","number",["number"]),Do=De("sqlite3_value_text","string",["number"]),Ao=De("sqlite3_value_blob","number",["number"]),Oo=De("sqlite3_value_double","number",["number"]),Ro=De("sqlite3_result_double","",["number","number"]),ea=De("sqlite3_result_null","",["number"]),Mo=De("sqlite3_result_text","",["number","string","number","number"]),Lo=De("sqlite3_result_blob","",["number","number","number","number"]),Fo=De("sqlite3_result_int","",["number","number"]),Ts=De("sqlite3_result_error","",["number","string","number"]),gi=De("sqlite3_aggregate_context","number",["number","number"]),xi=De("RegisterExtensionFunctions","number",["number"]);E.prototype.bind=function(we){if(!this.La)throw"Statement closed";return this.reset(),Array.isArray(we)?this.wb(we):we!=null&&typeof we=="object"?this.xb(we):!0},E.prototype.step=function(){if(!this.La)throw"Statement closed";this.Ja=1;var we=So(this.La);switch(we){case 100:return!0;case 101:return!1;default:throw this.db.handleError(we)}},E.prototype.rb=function(we){return we==null&&(we=this.Ja,this.Ja+=1),Xs(this.La,we)},E.prototype.Ab=function(we){if(we==null&&(we=this.Ja,this.Ja+=1),we=Ca(this.La,we),typeof BigInt!="function")throw Error("BigInt is not supported");return BigInt(we)},E.prototype.Bb=function(we){return we==null&&(we=this.Ja,this.Ja+=1),Ca(this.La,we)},E.prototype.getBlob=function(we){we==null&&(we=this.Ja,this.Ja+=1);var Oe=_o(this.La,we);we=Eo(this.La,we);for(var Ze=new Uint8Array(Oe),ot=0;ot<Oe;ot+=1)Ze[ot]=Z[we+ot];return Ze},E.prototype.get=function(we,Oe){Oe=Oe||{},we!=null&&this.bind(we)&&this.step(),we=[];for(var Ze=Is(this.La),ot=0;ot<Ze;ot+=1)switch(No(this.La,ot)){case 1:var dt=Oe.useBigInt?this.Ab(ot):this.rb(ot);we.push(dt);break;case 2:we.push(this.rb(ot));break;case 3:we.push(this.Bb(ot));break;case 4:we.push(this.getBlob(ot));break;default:we.push(null)}return we},E.prototype.getColumnNames=function(){for(var we=[],Oe=ja(this.La),Ze=0;Ze<Oe;Ze+=1)we.push(Ia(this.La,Ze));return we},E.prototype.getAsObject=function(we,Oe){we=this.get(we,Oe),Oe=this.getColumnNames();for(var Ze={},ot=0;ot<Oe.length;ot+=1)Ze[Oe[ot]]=we[ot];return Ze},E.prototype.getSQL=function(){return Ea(this.La)},E.prototype.getNormalizedSQL=function(){return Zs(this.La)},E.prototype.run=function(we){return we!=null&&this.bind(we),this.step(),this.reset()},E.prototype.nb=function(we,Oe){Oe==null&&(Oe=this.Ja,this.Ja+=1),we=pt(we);var Ze=Es(we,Ss);this.fb.push(Ze),this.db.handleError(hi(this.La,Oe,Ze,we.length-1,0))},E.prototype.vb=function(we,Oe){Oe==null&&(Oe=this.Ja,this.Ja+=1);var Ze=Es(we,Ss);this.fb.push(Ze),this.db.handleError(cr(this.La,Oe,Ze,we.length,0))},E.prototype.mb=function(we,Oe){Oe==null&&(Oe=this.Ja,this.Ja+=1),this.db.handleError((we===(we|0)?_a:Wn)(this.La,Oe,we))},E.prototype.yb=function(we){we==null&&(we=this.Ja,this.Ja+=1),cr(this.La,we,0,0,0)},E.prototype.ob=function(we,Oe){switch(Oe==null&&(Oe=this.Ja,this.Ja+=1),typeof we){case"string":this.nb(we,Oe);return;case"number":this.mb(we,Oe);return;case"bigint":this.nb(we.toString(),Oe);return;case"boolean":this.mb(we+0,Oe);return;case"object":if(we===null){this.yb(Oe);return}if(we.length!=null){this.vb(we,Oe);return}}throw"Wrong API use : tried to bind a value of an unknown type ("+we+")."},E.prototype.xb=function(we){var Oe=this;return Object.keys(we).forEach(function(Ze){var ot=Cs(Oe.La,Ze);ot!==0&&Oe.ob(we[Ze],ot)}),!0},E.prototype.wb=function(we){for(var Oe=0;Oe<we.length;Oe+=1)this.ob(we[Oe],Oe+1);return!0},E.prototype.reset=function(){return this.freemem(),Co(this.La)===0&&jo(this.La)===0},E.prototype.freemem=function(){for(var we;(we=this.fb.pop())!==void 0;)un(we)},E.prototype.free=function(){this.freemem();var we=Io(this.La)===0;return delete this.db.Za[this.La],this.La=0,we},z.prototype.next=function(){if(this.Ya===null)return{done:!0};if(this.Ua!==null&&(this.Ua.free(),this.Ua=null),!this.db.db)throw this.gb(),Error("Database closed");var we=$n(),Oe=Kr(4);P(Ne),P(Oe);try{this.db.handleError(js(this.db.db,this.eb,-1,Ne,Oe)),this.eb=G(Oe,"i32");var Ze=G(Ne,"i32");return Ze===0?(this.gb(),{done:!0}):(this.Ua=new E(Ze,this.db),this.db.Za[Ze]=this.Ua,{value:this.Ua,done:!1})}catch(ot){throw this.ib=X(this.eb),this.gb(),ot}finally{dn(we)}},z.prototype.gb=function(){un(this.Ya),this.Ya=null},z.prototype.getRemainingSQL=function(){return this.ib!==null?this.ib:X(this.eb)},typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"&&(z.prototype[Symbol.iterator]=function(){return this}),re.prototype.run=function(we,Oe){if(!this.db)throw"Database closed";if(Oe){we=this.prepare(we,Oe);try{we.step()}finally{we.free()}}else this.handleError(it(this.db,we,0,0,Ne));return this},re.prototype.exec=function(we,Oe,Ze){if(!this.db)throw"Database closed";var ot=$n(),dt=null;try{var kt=ks(we),tr=Kr(4);for(we=[];G(kt,"i8")!==0;){P(Ne),P(tr),this.handleError(js(this.db,kt,-1,Ne,tr));var Sr=G(Ne,"i32");if(kt=G(tr,"i32"),Sr!==0){var ur=null;for(dt=new E(Sr,this),Oe!=null&&dt.bind(Oe);dt.step();)ur===null&&(ur={columns:dt.getColumnNames(),values:[]},we.push(ur)),ur.values.push(dt.get(null,Ze));dt.free()}}return we}catch(Er){throw dt&&dt.free(),Er}finally{dn(ot)}},re.prototype.each=function(we,Oe,Ze,ot,dt){typeof Oe=="function"&&(ot=Ze,Ze=Oe,Oe=void 0),we=this.prepare(we,Oe);try{for(;we.step();)Ze(we.getAsObject(null,dt))}finally{we.free()}if(typeof ot=="function")return ot()},re.prototype.prepare=function(we,Oe){if(P(Ne),this.handleError(At(this.db,we,-1,Ne,0)),we=G(Ne,"i32"),we===0)throw"Nothing to prepare";var Ze=new E(we,this);return Oe!=null&&Ze.bind(Oe),this.Za[we]=Ze},re.prototype.iterateStatements=function(we){return new z(we,this)},re.prototype.export=function(){Object.values(this.Za).forEach(function(Oe){Oe.free()}),Object.values(this.Na).forEach(xr),this.Na={},this.handleError(gt(this.db));var we=Or(this.filename);return this.handleError(st(this.filename,Ne)),this.db=G(Ne,"i32"),xi(this.db),we},re.prototype.close=function(){this.db!==null&&(Object.values(this.Za).forEach(function(we){we.free()}),Object.values(this.Na).forEach(xr),this.Na={},this.handleError(gt(this.db)),ii("/"+this.filename),this.db=null)},re.prototype.handleError=function(we){if(we===0)return null;throw we=Na(this.db),Error(we)},re.prototype.getRowsModified=function(){return Tt(this.db)},re.prototype.create_function=function(we,Oe){Object.prototype.hasOwnProperty.call(this.Na,we)&&(xr(this.Na[we]),delete this.Na[we]);var Ze=Rr(function(ot,dt,kt){dt=m(dt,kt);try{var tr=Oe.apply(null,dt)}catch(Sr){Ts(ot,Sr,-1);return}i(ot,tr)},"viii");return this.Na[we]=Ze,this.handleError(mi(this.db,we,Oe.length,1,0,Ze,0,0,0)),this},re.prototype.create_aggregate=function(we,Oe){var Ze=Oe.init||function(){return null},ot=Oe.finalize||function(ur){return ur},dt=Oe.step;if(!dt)throw"An aggregate function must have a step function in "+we;var kt={};Object.hasOwnProperty.call(this.Na,we)&&(xr(this.Na[we]),delete this.Na[we]),Oe=we+"__finalize",Object.hasOwnProperty.call(this.Na,Oe)&&(xr(this.Na[Oe]),delete this.Na[Oe]);var tr=Rr(function(ur,Er,ta){var fn=gi(ur,1);Object.hasOwnProperty.call(kt,fn)||(kt[fn]=Ze()),Er=m(Er,ta),Er=[kt[fn]].concat(Er);try{kt[fn]=dt.apply(null,Er)}catch(yi){delete kt[fn],Ts(ur,yi,-1)}},"viii"),Sr=Rr(function(ur){var Er=gi(ur,1);try{var ta=ot(kt[Er])}catch(fn){delete kt[Er],Ts(ur,fn,-1);return}i(ur,ta),delete kt[Er]},"vi");return this.Na[we]=tr,this.Na[Oe]=Sr,this.handleError(mi(this.db,we,dt.length-1,1,0,0,tr,Sr,0)),this},d.Database=re};var T=Object.assign({},d),b="./this.program",N=typeof window=="object",w=typeof importScripts=="function",I=typeof process=="object"&&typeof process.versions=="object"&&typeof process.versions.node=="string",k="",C,j,O;if(I){var F=fc,R=fc;k=w?R.dirname(k)+"/":__dirname+"/",C=(i,m)=>(i=Te(i)?new URL(i):R.normalize(i),F.readFileSync(i,m?void 0:"utf8")),O=i=>(i=C(i,!0),i.buffer||(i=new Uint8Array(i)),i),j=(i,m,E,z=!0)=>{i=Te(i)?new URL(i):R.normalize(i),F.readFile(i,z?void 0:"utf8",(re,Ne)=>{re?E(re):m(z?Ne.buffer:Ne)})},!d.thisProgram&&1<process.argv.length&&(b=process.argv[1].replace(/\\/g,"/")),process.argv.slice(2),s.exports=d,d.inspect=()=>"[Emscripten Module object]"}else(N||w)&&(w?k=self.location.href:typeof document<"u"&&document.currentScript&&(k=document.currentScript.src),k=k.indexOf("blob:")!==0?k.substr(0,k.replace(/[?#].*/,"").lastIndexOf("/")+1):"",C=i=>{var m=new XMLHttpRequest;return m.open("GET",i,!1),m.send(null),m.responseText},w&&(O=i=>{var m=new XMLHttpRequest;return m.open("GET",i,!1),m.responseType="arraybuffer",m.send(null),new Uint8Array(m.response)}),j=(i,m,E)=>{var z=new XMLHttpRequest;z.open("GET",i,!0),z.responseType="arraybuffer",z.onload=()=>{z.status==200||z.status==0&&z.response?m(z.response):E()},z.onerror=E,z.send(null)});var M=d.print||console.log.bind(console),H=d.printErr||console.error.bind(console);Object.assign(d,T),T=null,d.thisProgram&&(b=d.thisProgram);var V;d.wasmBinary&&(V=d.wasmBinary),typeof WebAssembly!="object"&&pe("no native wasm support detected");var oe,J=!1,Z,de,$,W,_,ie,be;function ge(){var i=oe.buffer;d.HEAP8=Z=new Int8Array(i),d.HEAP16=$=new Int16Array(i),d.HEAPU8=de=new Uint8Array(i),d.HEAPU16=new Uint16Array(i),d.HEAP32=W=new Int32Array(i),d.HEAPU32=_=new Uint32Array(i),d.HEAPF32=ie=new Float32Array(i),d.HEAPF64=be=new Float64Array(i)}var je=[],fe=[],B=[];function S(){var i=d.preRun.shift();je.unshift(i)}var A=0,ce=null;function pe(i){var m;throw(m=d.onAbort)==null||m.call(d,i),i="Aborted("+i+")",H(i),J=!0,new WebAssembly.RuntimeError(i+". Build with -sASSERTIONS for more info.")}var me=i=>i.startsWith("data:application/octet-stream;base64,"),Te=i=>i.startsWith("file://"),he;if(he="sql-wasm.wasm",!me(he)){var Se=he;he=d.locateFile?d.locateFile(Se,k):k+Se}function Ee(i){if(i==he&&V)return new Uint8Array(V);if(O)return O(i);throw"both async and sync fetching of the wasm failed"}function Le(i){if(!V&&(N||w)){if(typeof fetch=="function"&&!Te(i))return fetch(i,{credentials:"same-origin"}).then(m=>{if(!m.ok)throw"failed to load wasm binary file at '"+i+"'";return m.arrayBuffer()}).catch(()=>Ee(i));if(j)return new Promise((m,E)=>{j(i,z=>m(new Uint8Array(z)),E)})}return Promise.resolve().then(()=>Ee(i))}function qe(i,m,E){return Le(i).then(z=>WebAssembly.instantiate(z,m)).then(z=>z).then(E,z=>{H(`failed to asynchronously prepare wasm: ${z}`),pe(z)})}function te(i,m){var E=he;V||typeof WebAssembly.instantiateStreaming!="function"||me(E)||Te(E)||I||typeof fetch!="function"?qe(E,i,m):fetch(E,{credentials:"same-origin"}).then(z=>WebAssembly.instantiateStreaming(z,i).then(m,function(re){return H(`wasm streaming compile failed: ${re}`),H("falling back to ArrayBuffer instantiation"),qe(E,i,m)}))}var Y,g,ee=i=>{for(;0<i.length;)i.shift()(d)};function G(i,m="i8"){switch(m.endsWith("*")&&(m="*"),m){case"i1":return Z[i>>0];case"i8":return Z[i>>0];case"i16":return $[i>>1];case"i32":return W[i>>2];case"i64":pe("to do getValue(i64) use WASM_BIGINT");case"float":return ie[i>>2];case"double":return be[i>>3];case"*":return _[i>>2];default:pe(`invalid type for getValue: ${m}`)}}function P(i){var m="i32";switch(m.endsWith("*")&&(m="*"),m){case"i1":Z[i>>0]=0;break;case"i8":Z[i>>0]=0;break;case"i16":$[i>>1]=0;break;case"i32":W[i>>2]=0;break;case"i64":pe("to do setValue(i64) use WASM_BIGINT");case"float":ie[i>>2]=0;break;case"double":be[i>>3]=0;break;case"*":_[i>>2]=0;break;default:pe(`invalid type for setValue: ${m}`)}}var L=typeof TextDecoder<"u"?new TextDecoder("utf8"):void 0,q=(i,m,E)=>{var z=m+E;for(E=m;i[E]&&!(E>=z);)++E;if(16<E-m&&i.buffer&&L)return L.decode(i.subarray(m,E));for(z="";m<E;){var re=i[m++];if(re&128){var Ne=i[m++]&63;if((re&224)==192)z+=String.fromCharCode((re&31)<<6|Ne);else{var De=i[m++]&63;re=(re&240)==224?(re&15)<<12|Ne<<6|De:(re&7)<<18|Ne<<12|De<<6|i[m++]&63,65536>re?z+=String.fromCharCode(re):(re-=65536,z+=String.fromCharCode(55296|re>>10,56320|re&1023))}}else z+=String.fromCharCode(re)}return z},X=(i,m)=>i?q(de,i,m):"",se=(i,m)=>{for(var E=0,z=i.length-1;0<=z;z--){var re=i[z];re==="."?i.splice(z,1):re===".."?(i.splice(z,1),E++):E&&(i.splice(z,1),E--)}if(m)for(;E;E--)i.unshift("..");return i},Q=i=>{var m=i.charAt(0)==="/",E=i.substr(-1)==="/";return(i=se(i.split("/").filter(z=>!!z),!m).join("/"))||m||(i="."),i&&E&&(i+="/"),(m?"/":"")+i},ue=i=>{var m=/^(\/?|)([\s\S]*?)((?:\.{1,2}|[^\/]+?|)(\.[^.\/]*|))(?:[\/]*)$/.exec(i).slice(1);return i=m[0],m=m[1],!i&&!m?".":(m&&(m=m.substr(0,m.length-1)),i+m)},Ie=i=>{if(i==="/")return"/";i=Q(i),i=i.replace(/\/$/,"");var m=i.lastIndexOf("/");return m===-1?i:i.substr(m+1)},ye=()=>{if(typeof crypto=="object"&&typeof crypto.getRandomValues=="function")return E=>crypto.getRandomValues(E);if(I)try{var i=fc;if(i.randomFillSync)return E=>i.randomFillSync(E);var m=i.randomBytes;return E=>(E.set(m(E.byteLength)),E)}catch{}pe("initRandomDevice")},Ce=i=>(Ce=ye())(i);function Be(){for(var i="",m=!1,E=arguments.length-1;-1<=E&&!m;E--){if(m=0<=E?arguments[E]:"/",typeof m!="string")throw new TypeError("Arguments to path.resolve must be strings");if(!m)return"";i=m+"/"+i,m=m.charAt(0)==="/"}return i=se(i.split("/").filter(z=>!!z),!m).join("/"),(m?"/":"")+i||"."}var $e=[],ct=i=>{for(var m=0,E=0;E<i.length;++E){var z=i.charCodeAt(E);127>=z?m++:2047>=z?m+=2:55296<=z&&57343>=z?(m+=4,++E):m+=3}return m},et=(i,m,E,z)=>{if(!(0<z))return 0;var re=E;z=E+z-1;for(var Ne=0;Ne<i.length;++Ne){var De=i.charCodeAt(Ne);if(55296<=De&&57343>=De){var st=i.charCodeAt(++Ne);De=65536+((De&1023)<<10)|st&1023}if(127>=De){if(E>=z)break;m[E++]=De}else{if(2047>=De){if(E+1>=z)break;m[E++]=192|De>>6}else{if(65535>=De){if(E+2>=z)break;m[E++]=224|De>>12}else{if(E+3>=z)break;m[E++]=240|De>>18,m[E++]=128|De>>12&63}m[E++]=128|De>>6&63}m[E++]=128|De&63}}return m[E]=0,E-re};function pt(i,m){var E=Array(ct(i)+1);return i=et(i,E,0,E.length),m&&(E.length=i),E}var qt=[];function ft(i,m){qt[i]={input:[],output:[],Xa:m},Vt(i,jt)}var jt={open(i){var m=qt[i.node.rdev];if(!m)throw new Ue(43);i.tty=m,i.seekable=!1},close(i){i.tty.Xa.fsync(i.tty)},fsync(i){i.tty.Xa.fsync(i.tty)},read(i,m,E,z){if(!i.tty||!i.tty.Xa.sb)throw new Ue(60);for(var re=0,Ne=0;Ne<z;Ne++){try{var De=i.tty.Xa.sb(i.tty)}catch{throw new Ue(29)}if(De===void 0&&re===0)throw new Ue(6);if(De==null)break;re++,m[E+Ne]=De}return re&&(i.node.timestamp=Date.now()),re},write(i,m,E,z){if(!i.tty||!i.tty.Xa.jb)throw new Ue(60);try{for(var re=0;re<z;re++)i.tty.Xa.jb(i.tty,m[E+re])}catch{throw new Ue(29)}return z&&(i.node.timestamp=Date.now()),re}},gr={sb(){e:{if(!$e.length){var i=null;if(I){var m=Buffer.alloc(256),E=0,z=process.stdin.fd;try{E=F.readSync(z,m)}catch(re){if(re.toString().includes("EOF"))E=0;else throw re}0<E?i=m.slice(0,E).toString("utf-8"):i=null}else typeof window<"u"&&typeof window.prompt=="function"?(i=window.prompt("Input: "),i!==null&&(i+=`
`)):typeof readline=="function"&&(i=readline(),i!==null&&(i+=`
`));if(!i){i=null;break e}$e=pt(i,!0)}i=$e.shift()}return i},jb(i,m){m===null||m===10?(M(q(i.output,0)),i.output=[]):m!=0&&i.output.push(m)},fsync(i){i.output&&0<i.output.length&&(M(q(i.output,0)),i.output=[])},Mb(){return{Ib:25856,Kb:5,Hb:191,Jb:35387,Gb:[3,28,127,21,4,0,1,0,17,19,26,0,18,15,23,22,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]}},Nb(){return 0},Ob(){return[24,80]}},Ct={jb(i,m){m===null||m===10?(H(q(i.output,0)),i.output=[]):m!=0&&i.output.push(m)},fsync(i){i.output&&0<i.output.length&&(H(q(i.output,0)),i.output=[])}};function Mt(i,m){var E=i.Ia?i.Ia.length:0;E>=m||(m=Math.max(m,E*(1048576>E?2:1.125)>>>0),E!=0&&(m=Math.max(m,256)),E=i.Ia,i.Ia=new Uint8Array(m),0<i.Ma&&i.Ia.set(E.subarray(0,i.Ma),0))}var tt={Qa:null,Ra(){return tt.createNode(null,"/",16895,0)},createNode(i,m,E,z){if((E&61440)===24576||(E&61440)===4096)throw new Ue(63);return tt.Qa||(tt.Qa={dir:{node:{Pa:tt.Ga.Pa,Oa:tt.Ga.Oa,lookup:tt.Ga.lookup,ab:tt.Ga.ab,rename:tt.Ga.rename,unlink:tt.Ga.unlink,rmdir:tt.Ga.rmdir,readdir:tt.Ga.readdir,symlink:tt.Ga.symlink},stream:{Ta:tt.Ha.Ta}},file:{node:{Pa:tt.Ga.Pa,Oa:tt.Ga.Oa},stream:{Ta:tt.Ha.Ta,read:tt.Ha.read,write:tt.Ha.write,lb:tt.Ha.lb,bb:tt.Ha.bb,cb:tt.Ha.cb}},link:{node:{Pa:tt.Ga.Pa,Oa:tt.Ga.Oa,readlink:tt.Ga.readlink},stream:{}},pb:{node:{Pa:tt.Ga.Pa,Oa:tt.Ga.Oa},stream:xt}}),E=hs(i,m,E,z),Bt(E.mode)?(E.Ga=tt.Qa.dir.node,E.Ha=tt.Qa.dir.stream,E.Ia={}):(E.mode&61440)===32768?(E.Ga=tt.Qa.file.node,E.Ha=tt.Qa.file.stream,E.Ma=0,E.Ia=null):(E.mode&61440)===40960?(E.Ga=tt.Qa.link.node,E.Ha=tt.Qa.link.stream):(E.mode&61440)===8192&&(E.Ga=tt.Qa.pb.node,E.Ha=tt.Qa.pb.stream),E.timestamp=Date.now(),i&&(i.Ia[m]=E,i.timestamp=E.timestamp),E},Lb(i){return i.Ia?i.Ia.subarray?i.Ia.subarray(0,i.Ma):new Uint8Array(i.Ia):new Uint8Array(0)},Ga:{Pa(i){var m={};return m.dev=(i.mode&61440)===8192?i.id:1,m.ino=i.id,m.mode=i.mode,m.nlink=1,m.uid=0,m.gid=0,m.rdev=i.rdev,Bt(i.mode)?m.size=4096:(i.mode&61440)===32768?m.size=i.Ma:(i.mode&61440)===40960?m.size=i.link.length:m.size=0,m.atime=new Date(i.timestamp),m.mtime=new Date(i.timestamp),m.ctime=new Date(i.timestamp),m.zb=4096,m.blocks=Math.ceil(m.size/m.zb),m},Oa(i,m){if(m.mode!==void 0&&(i.mode=m.mode),m.timestamp!==void 0&&(i.timestamp=m.timestamp),m.size!==void 0&&(m=m.size,i.Ma!=m))if(m==0)i.Ia=null,i.Ma=0;else{var E=i.Ia;i.Ia=new Uint8Array(m),E&&i.Ia.set(E.subarray(0,Math.min(m,i.Ma))),i.Ma=m}},lookup(){throw Fn[44]},ab(i,m,E,z){return tt.createNode(i,m,E,z)},rename(i,m,E){if(Bt(i.mode)){try{var z=or(m,E)}catch{}if(z)for(var re in z.Ia)throw new Ue(55)}delete i.parent.Ia[i.name],i.parent.timestamp=Date.now(),i.name=E,m.Ia[E]=i,m.timestamp=i.parent.timestamp,i.parent=m},unlink(i,m){delete i.Ia[m],i.timestamp=Date.now()},rmdir(i,m){var E=or(i,m),z;for(z in E.Ia)throw new Ue(55);delete i.Ia[m],i.timestamp=Date.now()},readdir(i){var m=[".",".."],E;for(E of Object.keys(i.Ia))m.push(E);return m},symlink(i,m,E){return i=tt.createNode(i,m,41471,0),i.link=E,i},readlink(i){if((i.mode&61440)!==40960)throw new Ue(28);return i.link}},Ha:{read(i,m,E,z,re){var Ne=i.node.Ia;if(re>=i.node.Ma)return 0;if(i=Math.min(i.node.Ma-re,z),8<i&&Ne.subarray)m.set(Ne.subarray(re,re+i),E);else for(z=0;z<i;z++)m[E+z]=Ne[re+z];return i},write(i,m,E,z,re,Ne){if(m.buffer===Z.buffer&&(Ne=!1),!z)return 0;if(i=i.node,i.timestamp=Date.now(),m.subarray&&(!i.Ia||i.Ia.subarray)){if(Ne)return i.Ia=m.subarray(E,E+z),i.Ma=z;if(i.Ma===0&&re===0)return i.Ia=m.slice(E,E+z),i.Ma=z;if(re+z<=i.Ma)return i.Ia.set(m.subarray(E,E+z),re),z}if(Mt(i,re+z),i.Ia.subarray&&m.subarray)i.Ia.set(m.subarray(E,E+z),re);else for(Ne=0;Ne<z;Ne++)i.Ia[re+Ne]=m[E+Ne];return i.Ma=Math.max(i.Ma,re+z),z},Ta(i,m,E){if(E===1?m+=i.position:E===2&&(i.node.mode&61440)===32768&&(m+=i.node.Ma),0>m)throw new Ue(28);return m},lb(i,m,E){Mt(i.node,m+E),i.node.Ma=Math.max(i.node.Ma,m+E)},bb(i,m,E,z,re){if((i.node.mode&61440)!==32768)throw new Ue(43);if(i=i.node.Ia,re&2||i.buffer!==Z.buffer){if((0<E||E+m<i.length)&&(i.subarray?i=i.subarray(E,E+m):i=Array.prototype.slice.call(i,E,E+m)),E=!0,m=65536*Math.ceil(m/65536),(re=fi(65536,m))?(de.fill(0,re,re+m),m=re):m=0,!m)throw new Ue(48);Z.set(i,m)}else E=!1,m=i.byteOffset;return{Db:m,ub:E}},cb(i,m,E,z){return tt.Ha.write(i,m,0,z,E,!1),0}}},Wt=(i,m)=>{var E=0;return i&&(E|=365),m&&(E|=146),E},ar=null,ir={},ut=[],br=1,kr=null,ln=!0,Ue=null,Fn={};function Lt(i,m={}){if(i=Be(i),!i)return{path:"",node:null};if(m=Object.assign({qb:!0,kb:0},m),8<m.kb)throw new Ue(32);i=i.split("/").filter(De=>!!De);for(var E=ar,z="/",re=0;re<i.length;re++){var Ne=re===i.length-1;if(Ne&&m.parent)break;if(E=or(E,i[re]),z=Q(z+"/"+i[re]),E.Va&&(!Ne||Ne&&m.qb)&&(E=E.Va.root),!Ne||m.Sa){for(Ne=0;(E.mode&61440)===40960;)if(E=It(z),z=Be(ue(z),E),E=Lt(z,{kb:m.kb+1}).node,40<Ne++)throw new Ue(32)}}return{path:z,node:E}}function cn(i){for(var m;;){if(i===i.parent)return i=i.Ra.tb,m?i[i.length-1]!=="/"?`${i}/${m}`:i+m:i;m=m?`${i.name}/${m}`:i.name,i=i.parent}}function Ur(i,m){for(var E=0,z=0;z<m.length;z++)E=(E<<5)-E+m.charCodeAt(z)|0;return(i+E>>>0)%kr.length}function bn(i){var m=Ur(i.parent.id,i.name);if(kr[m]===i)kr[m]=i.Wa;else for(m=kr[m];m;){if(m.Wa===i){m.Wa=i.Wa;break}m=m.Wa}}function or(i,m){var E;if(E=(E=Dr(i,"x"))?E:i.Ga.lookup?0:2)throw new Ue(E,i);for(E=kr[Ur(i.id,m)];E;E=E.Wa){var z=E.name;if(E.parent.id===i.id&&z===m)return E}return i.Ga.lookup(i,m)}function hs(i,m,E,z){return i=new Gn(i,m,E,z),m=Ur(i.parent.id,i.name),i.Wa=kr[m],kr[m]=i}function Bt(i){return(i&61440)===16384}function kn(i){var m=["r","w","rw"][i&3];return i&512&&(m+="w"),m}function Dr(i,m){if(ln)return 0;if(!m.includes("r")||i.mode&292){if(m.includes("w")&&!(i.mode&146)||m.includes("x")&&!(i.mode&73))return 2}else return 2;return 0}function Pn(i,m){try{return or(i,m),20}catch{}return Dr(i,"wx")}function Hs(i,m,E){try{var z=or(i,m)}catch(re){return re.Ka}if(i=Dr(i,"wx"))return i;if(E){if(!Bt(z.mode))return 54;if(z===z.parent||cn(z)==="/")return 10}else if(Bt(z.mode))return 31;return 0}function ze(){for(var i=0;4096>=i;i++)if(!ut[i])return i;throw new Ue(33)}function He(i){if(i=ut[i],!i)throw new Ue(8);return i}function Je(i,m=-1){return Vr||(Vr=function(){this.$a={}},Vr.prototype={},Object.defineProperties(Vr.prototype,{object:{get(){return this.node},set(E){this.node=E}},flags:{get(){return this.$a.flags},set(E){this.$a.flags=E}},position:{get(){return this.$a.position},set(E){this.$a.position=E}}})),i=Object.assign(new Vr,i),m==-1&&(m=ze()),i.fd=m,ut[m]=i}var xt={open(i){var m,E;i.Ha=ir[i.node.rdev].Ha,(E=(m=i.Ha).open)==null||E.call(m,i)},Ta(){throw new Ue(70)}};function Vt(i,m){ir[i]={Ha:m}}function lr(i,m){var E=m==="/",z=!m;if(E&&ar)throw new Ue(10);if(!E&&!z){var re=Lt(m,{qb:!1});if(m=re.path,re=re.node,re.Va)throw new Ue(10);if(!Bt(re.mode))throw new Ue(54)}m={type:i,Pb:{},tb:m,Cb:[]},i=i.Ra(m),i.Ra=m,m.root=i,E?ar=i:re&&(re.Va=m,re.Ra&&re.Ra.Cb.push(m))}function Ft(i,m,E){var z=Lt(i,{parent:!0}).node;if(i=Ie(i),!i||i==="."||i==="..")throw new Ue(28);var re=Pn(z,i);if(re)throw new Ue(re);if(!z.Ga.ab)throw new Ue(63);return z.Ga.ab(z,i,m,E)}function Et(i,m){return Ft(i,(m!==void 0?m:511)&1023|16384,0)}function Gt(i,m,E){typeof E>"u"&&(E=m,m=438),Ft(i,m|8192,E)}function Yr(i,m){if(!Be(i))throw new Ue(44);var E=Lt(m,{parent:!0}).node;if(!E)throw new Ue(44);m=Ie(m);var z=Pn(E,m);if(z)throw new Ue(z);if(!E.Ga.symlink)throw new Ue(63);E.Ga.symlink(E,m,i)}function zr(i){var m=Lt(i,{parent:!0}).node;i=Ie(i);var E=or(m,i),z=Hs(m,i,!0);if(z)throw new Ue(z);if(!m.Ga.rmdir)throw new Ue(63);if(E.Va)throw new Ue(10);m.Ga.rmdir(m,i),bn(E)}function ii(i){var m=Lt(i,{parent:!0}).node;if(!m)throw new Ue(44);i=Ie(i);var E=or(m,i),z=Hs(m,i,!1);if(z)throw new Ue(z);if(!m.Ga.unlink)throw new Ue(63);if(E.Va)throw new Ue(10);m.Ga.unlink(m,i),bn(E)}function It(i){if(i=Lt(i).node,!i)throw new Ue(44);if(!i.Ga.readlink)throw new Ue(28);return Be(cn(i.parent),i.Ga.readlink(i))}function ms(i,m){if(i=Lt(i,{Sa:!m}).node,!i)throw new Ue(44);if(!i.Ga.Pa)throw new Ue(63);return i.Ga.Pa(i)}function Ws(i){return ms(i,!0)}function ps(i,m){if(i=typeof i=="string"?Lt(i,{Sa:!0}).node:i,!i.Ga.Oa)throw new Ue(63);i.Ga.Oa(i,{mode:m&4095|i.mode&-4096,timestamp:Date.now()})}function gs(i,m){if(0>m)throw new Ue(28);if(i=typeof i=="string"?Lt(i,{Sa:!0}).node:i,!i.Ga.Oa)throw new Ue(63);if(Bt(i.mode))throw new Ue(31);if((i.mode&61440)!==32768)throw new Ue(28);var E=Dr(i,"w");if(E)throw new Ue(E);i.Ga.Oa(i,{size:m,timestamp:Date.now()})}function Un(i,m,E){if(i==="")throw new Ue(44);if(typeof m=="string"){var z={r:0,"r+":2,w:577,"w+":578,a:1089,"a+":1090}[m];if(typeof z>"u")throw Error(`Unknown file open mode: ${m}`);m=z}if(E=m&64?(typeof E>"u"?438:E)&4095|32768:0,typeof i=="object")var re=i;else{i=Q(i);try{re=Lt(i,{Sa:!(m&131072)}).node}catch{}}if(z=!1,m&64)if(re){if(m&128)throw new Ue(20)}else re=Ft(i,E,0),z=!0;if(!re)throw new Ue(44);if((re.mode&61440)===8192&&(m&=-513),m&65536&&!Bt(re.mode))throw new Ue(54);if(!z&&(E=re?(re.mode&61440)===40960?32:Bt(re.mode)&&(kn(m)!=="r"||m&512)?31:Dr(re,kn(m)):44))throw new Ue(E);return m&512&&!z&&gs(re,0),m&=-131713,re=Je({node:re,path:cn(re),flags:m,seekable:!0,position:0,Ha:re.Ha,Fb:[],error:!1}),re.Ha.open&&re.Ha.open(re),!d.logReadFiles||m&1||(zn||(zn={}),i in zn||(zn[i]=1)),re}function Qs(i){if(i.fd===null)throw new Ue(8);i.hb&&(i.hb=null);try{i.Ha.close&&i.Ha.close(i)}catch(m){throw m}finally{ut[i.fd]=null}i.fd=null}function xs(i,m,E){if(i.fd===null)throw new Ue(8);if(!i.seekable||!i.Ha.Ta)throw new Ue(70);if(E!=0&&E!=1&&E!=2)throw new Ue(28);i.position=i.Ha.Ta(i,m,E),i.Fb=[]}function Ar(i,m,E,z,re){if(0>z||0>re)throw new Ue(28);if(i.fd===null)throw new Ue(8);if((i.flags&2097155)===1)throw new Ue(8);if(Bt(i.node.mode))throw new Ue(31);if(!i.Ha.read)throw new Ue(28);var Ne=typeof re<"u";if(!Ne)re=i.position;else if(!i.seekable)throw new Ue(70);return m=i.Ha.read(i,m,E,z,re),Ne||(i.position+=m),m}function oi(i,m,E,z,re){if(0>z||0>re)throw new Ue(28);if(i.fd===null)throw new Ue(8);if((i.flags&2097155)===0)throw new Ue(8);if(Bt(i.node.mode))throw new Ue(31);if(!i.Ha.write)throw new Ue(28);i.seekable&&i.flags&1024&&xs(i,0,2);var Ne=typeof re<"u";if(!Ne)re=i.position;else if(!i.seekable)throw new Ue(70);return m=i.Ha.write(i,m,E,z,re,void 0),Ne||(i.position+=m),m}function Or(i){var m,E=Un(i,E||0);i=ms(i).size;var z=new Uint8Array(i);return Ar(E,z,0,i,0),m=z,Qs(E),m}function li(){Ue||(Ue=function(i,m){this.name="ErrnoError",this.node=m,this.Eb=function(E){this.Ka=E},this.Eb(i),this.message="FS error"},Ue.prototype=Error(),Ue.prototype.constructor=Ue,[44].forEach(i=>{Fn[i]=new Ue(i),Fn[i].stack="<generic error, no stack>"}))}var ci;function ys(i,m,E){i=Q("/dev/"+i);var z=Wt(!!m,!!E);vs||(vs=64);var re=vs++<<8|0;Vt(re,{open(Ne){Ne.seekable=!1},close(){var Ne;(Ne=E==null?void 0:E.buffer)!=null&&Ne.length&&E(10)},read(Ne,De,st,gt){for(var it=0,Tt=0;Tt<gt;Tt++){try{var At=m()}catch{throw new Ue(29)}if(At===void 0&&it===0)throw new Ue(6);if(At==null)break;it++,De[st+Tt]=At}return it&&(Ne.node.timestamp=Date.now()),it},write(Ne,De,st,gt){for(var it=0;it<gt;it++)try{E(De[st+it])}catch{throw new Ue(29)}return gt&&(Ne.node.timestamp=Date.now()),it}}),Gt(i,z,re)}var vs,bt={},Vr,zn;function Sn(i,m,E){if(m.charAt(0)==="/")return m;if(i=i===-100?"/":He(i).path,m.length==0){if(!E)throw new Ue(44);return i}return Q(i+"/"+m)}function Ys(i,m,E){try{var z=i(m)}catch(Ne){if(Ne&&Ne.node&&Q(m)!==Q(cn(Ne.node)))return-54;throw Ne}W[E>>2]=z.dev,W[E+4>>2]=z.mode,_[E+8>>2]=z.nlink,W[E+12>>2]=z.uid,W[E+16>>2]=z.gid,W[E+20>>2]=z.rdev,g=[z.size>>>0,(Y=z.size,1<=+Math.abs(Y)?0<Y?+Math.floor(Y/4294967296)>>>0:~~+Math.ceil((Y-+(~~Y>>>0))/4294967296)>>>0:0)],W[E+24>>2]=g[0],W[E+28>>2]=g[1],W[E+32>>2]=4096,W[E+36>>2]=z.blocks,i=z.atime.getTime(),m=z.mtime.getTime();var re=z.ctime.getTime();return g=[Math.floor(i/1e3)>>>0,(Y=Math.floor(i/1e3),1<=+Math.abs(Y)?0<Y?+Math.floor(Y/4294967296)>>>0:~~+Math.ceil((Y-+(~~Y>>>0))/4294967296)>>>0:0)],W[E+40>>2]=g[0],W[E+44>>2]=g[1],_[E+48>>2]=i%1e3*1e3,g=[Math.floor(m/1e3)>>>0,(Y=Math.floor(m/1e3),1<=+Math.abs(Y)?0<Y?+Math.floor(Y/4294967296)>>>0:~~+Math.ceil((Y-+(~~Y>>>0))/4294967296)>>>0:0)],W[E+56>>2]=g[0],W[E+60>>2]=g[1],_[E+64>>2]=m%1e3*1e3,g=[Math.floor(re/1e3)>>>0,(Y=Math.floor(re/1e3),1<=+Math.abs(Y)?0<Y?+Math.floor(Y/4294967296)>>>0:~~+Math.ceil((Y-+(~~Y>>>0))/4294967296)>>>0:0)],W[E+72>>2]=g[0],W[E+76>>2]=g[1],_[E+80>>2]=re%1e3*1e3,g=[z.ino>>>0,(Y=z.ino,1<=+Math.abs(Y)?0<Y?+Math.floor(Y/4294967296)>>>0:~~+Math.ceil((Y-+(~~Y>>>0))/4294967296)>>>0:0)],W[E+88>>2]=g[0],W[E+92>>2]=g[1],0}var qn=void 0;function ws(){var i=W[+qn>>2];return qn+=4,i}var En=(i,m)=>m+2097152>>>0<4194305-!!i?(i>>>0)+4294967296*m:NaN,bs=[0,31,60,91,121,152,182,213,244,274,305,335],ko=[0,31,59,90,120,151,181,212,243,273,304,334],Vs=i=>{var m=ct(i)+1,E=Ns(m);return E&&et(i,de,E,m),E},yt={},Sa=()=>{if(!Js){var i={USER:"web_user",LOGNAME:"web_user",PATH:"/",PWD:"/",HOME:"/home/web_user",LANG:(typeof navigator=="object"&&navigator.languages&&navigator.languages[0]||"C").replace("-","_")+".UTF-8",_:b||"./this.program"},m;for(m in yt)yt[m]===void 0?delete i[m]:i[m]=yt[m];var E=[];for(m in i)E.push(`${m}=${i[m]}`);Js=E}return Js},Js,ks=i=>{var m=ct(i)+1,E=Kr(m);return et(i,de,E,m),E},ui=(i,m,E,z)=>{var re={string:it=>{var Tt=0;return it!=null&&it!==0&&(Tt=ks(it)),Tt},array:it=>{var Tt=Kr(it.length);return Z.set(it,Tt),Tt}};i=d["_"+i];var Ne=[],De=0;if(z)for(var st=0;st<z.length;st++){var gt=re[E[st]];gt?(De===0&&(De=$n()),Ne[st]=gt(z[st])):Ne[st]=z[st]}return E=i.apply(null,Ne),E=function(it){return De!==0&&dn(De),m==="string"?it?q(de,it):"":m==="boolean"?!!it:it}(E)},Ss=0,Es=(i,m)=>(m=m==1?Kr(i.length):Ns(i.length),i.subarray||i.slice||(i=new Uint8Array(i)),de.set(i,m),m),Jr,Bn=[],Jt,xr=i=>{Jr.delete(Jt.get(i)),Jt.set(i,null),Bn.push(i)},Rr=(i,m)=>{if(!Jr){Jr=new WeakMap;var E=Jt.length;if(Jr)for(var z=0;z<0+E;z++){var re=Jt.get(z);re&&Jr.set(re,z)}}if(E=Jr.get(i)||0)return E;if(Bn.length)E=Bn.pop();else{try{Jt.grow(1)}catch(st){throw st instanceof RangeError?"Unable to grow wasm table. Set ALLOW_TABLE_GROWTH.":st}E=Jt.length-1}try{Jt.set(E,i)}catch(st){if(!(st instanceof TypeError))throw st;if(typeof WebAssembly.Function=="function"){z=WebAssembly.Function,re={i:"i32",j:"i64",f:"f32",d:"f64",e:"externref",p:"i32"};for(var Ne={parameters:[],results:m[0]=="v"?[]:[re[m[0]]]},De=1;De<m.length;++De)Ne.parameters.push(re[m[De]]);m=new z(Ne,i)}else{for(z=[1],re=m.slice(0,1),m=m.slice(1),Ne={i:127,p:127,j:126,f:125,d:124,e:111},z.push(96),De=m.length,128>De?z.push(De):z.push(De%128|128,De>>7),De=0;De<m.length;++De)z.push(Ne[m[De]]);re=="v"?z.push(0):z.push(1,Ne[re]),m=[0,97,115,109,1,0,0,0,1],re=z.length,128>re?m.push(re):m.push(re%128|128,re>>7),m.push.apply(m,z),m.push(2,7,1,1,101,1,102,0,0,7,5,1,1,102,0,0),m=new WebAssembly.Module(new Uint8Array(m)),m=new WebAssembly.Instance(m,{e:{f:i}}).exports.f}Jt.set(E,m)}return Jr.set(i,E),E};function Gn(i,m,E,z){i||(i=this),this.parent=i,this.Ra=i.Ra,this.Va=null,this.id=br++,this.name=m,this.mode=E,this.Ga={},this.Ha={},this.rdev=z}Object.defineProperties(Gn.prototype,{read:{get:function(){return(this.mode&365)===365},set:function(i){i?this.mode|=365:this.mode&=-366}},write:{get:function(){return(this.mode&146)===146},set:function(i){i?this.mode|=146:this.mode&=-147}}}),li(),kr=Array(4096),lr(tt,"/"),Et("/tmp"),Et("/home"),Et("/home/web_user"),function(){Et("/dev"),Vt(259,{read:()=>0,write:(z,re,Ne,De)=>De}),Gt("/dev/null",259),ft(1280,gr),ft(1536,Ct),Gt("/dev/tty",1280),Gt("/dev/tty1",1536);var i=new Uint8Array(1024),m=0,E=()=>(m===0&&(m=Ce(i).byteLength),i[--m]);ys("random",E),ys("urandom",E),Et("/dev/shm"),Et("/dev/shm/tmp")}(),function(){Et("/proc");var i=Et("/proc/self");Et("/proc/self/fd"),lr({Ra(){var m=hs(i,"fd",16895,73);return m.Ga={lookup(E,z){var re=He(+z);return E={parent:null,Ra:{tb:"fake"},Ga:{readlink:()=>re.path}},E.parent=E}},m}},"/proc/self/fd")}();var _s={a:(i,m,E,z)=>{pe(`Assertion failed: ${i?q(de,i):""}, at: `+[m?m?q(de,m):"":"unknown filename",E,z?z?q(de,z):"":"unknown function"])},h:function(i,m){try{return i=i?q(de,i):"",ps(i,m),0}catch(E){if(typeof bt>"u"||E.name!=="ErrnoError")throw E;return-E.Ka}},H:function(i,m,E){try{if(m=m?q(de,m):"",m=Sn(i,m),E&-8)return-28;var z=Lt(m,{Sa:!0}).node;return z?(i="",E&4&&(i+="r"),E&2&&(i+="w"),E&1&&(i+="x"),i&&Dr(z,i)?-2:0):-44}catch(re){if(typeof bt>"u"||re.name!=="ErrnoError")throw re;return-re.Ka}},i:function(i,m){try{var E=He(i);return ps(E.node,m),0}catch(z){if(typeof bt>"u"||z.name!=="ErrnoError")throw z;return-z.Ka}},g:function(i){try{var m=He(i).node,E=typeof m=="string"?Lt(m,{Sa:!0}).node:m;if(!E.Ga.Oa)throw new Ue(63);return E.Ga.Oa(E,{timestamp:Date.now()}),0}catch(z){if(typeof bt>"u"||z.name!=="ErrnoError")throw z;return-z.Ka}},b:function(i,m,E){qn=E;try{var z=He(i);switch(m){case 0:var re=ws();if(0>re)return-28;for(;ut[re];)re++;return Je(z,re).fd;case 1:case 2:return 0;case 3:return z.flags;case 4:return re=ws(),z.flags|=re,0;case 5:return re=ws(),$[re+0>>1]=2,0;case 6:case 7:return 0;case 16:case 8:return-28;case 9:return W[di()>>2]=28,-1;default:return-28}}catch(Ne){if(typeof bt>"u"||Ne.name!=="ErrnoError")throw Ne;return-Ne.Ka}},f:function(i,m){try{var E=He(i);return Ys(ms,E.path,m)}catch(z){if(typeof bt>"u"||z.name!=="ErrnoError")throw z;return-z.Ka}},n:function(i,m,E){m=En(m,E);try{if(isNaN(m))return 61;var z=He(i);if((z.flags&2097155)===0)throw new Ue(28);return gs(z.node,m),0}catch(re){if(typeof bt>"u"||re.name!=="ErrnoError")throw re;return-re.Ka}},C:function(i,m){try{if(m===0)return-28;var E=ct("/")+1;return m<E?-68:(et("/",de,i,m),E)}catch(z){if(typeof bt>"u"||z.name!=="ErrnoError")throw z;return-z.Ka}},F:function(i,m){try{return i=i?q(de,i):"",Ys(Ws,i,m)}catch(E){if(typeof bt>"u"||E.name!=="ErrnoError")throw E;return-E.Ka}},z:function(i,m,E){try{return m=m?q(de,m):"",m=Sn(i,m),m=Q(m),m[m.length-1]==="/"&&(m=m.substr(0,m.length-1)),Et(m,E),0}catch(z){if(typeof bt>"u"||z.name!=="ErrnoError")throw z;return-z.Ka}},E:function(i,m,E,z){try{m=m?q(de,m):"";var re=z&256;return m=Sn(i,m,z&4096),Ys(re?Ws:ms,m,E)}catch(Ne){if(typeof bt>"u"||Ne.name!=="ErrnoError")throw Ne;return-Ne.Ka}},y:function(i,m,E,z){qn=z;try{m=m?q(de,m):"",m=Sn(i,m);var re=z?ws():0;return Un(m,E,re).fd}catch(Ne){if(typeof bt>"u"||Ne.name!=="ErrnoError")throw Ne;return-Ne.Ka}},w:function(i,m,E,z){try{if(m=m?q(de,m):"",m=Sn(i,m),0>=z)return-28;var re=It(m),Ne=Math.min(z,ct(re)),De=Z[E+Ne];return et(re,de,E,z+1),Z[E+Ne]=De,Ne}catch(st){if(typeof bt>"u"||st.name!=="ErrnoError")throw st;return-st.Ka}},v:function(i){try{return i=i?q(de,i):"",zr(i),0}catch(m){if(typeof bt>"u"||m.name!=="ErrnoError")throw m;return-m.Ka}},G:function(i,m){try{return i=i?q(de,i):"",Ys(ms,i,m)}catch(E){if(typeof bt>"u"||E.name!=="ErrnoError")throw E;return-E.Ka}},r:function(i,m,E){try{return m=m?q(de,m):"",m=Sn(i,m),E===0?ii(m):E===512?zr(m):pe("Invalid flags passed to unlinkat"),0}catch(z){if(typeof bt>"u"||z.name!=="ErrnoError")throw z;return-z.Ka}},q:function(i,m,E){try{if(m=m?q(de,m):"",m=Sn(i,m,!0),E){var z=_[E>>2]+4294967296*W[E+4>>2],re=W[E+8>>2];Ne=1e3*z+re/1e6,E+=16,z=_[E>>2]+4294967296*W[E+4>>2],re=W[E+8>>2],De=1e3*z+re/1e6}else var Ne=Date.now(),De=Ne;i=Ne;var st=Lt(m,{Sa:!0}).node;return st.Ga.Oa(st,{timestamp:Math.max(i,De)}),0}catch(gt){if(typeof bt>"u"||gt.name!=="ErrnoError")throw gt;return-gt.Ka}},l:function(i,m,E){i=new Date(1e3*En(i,m)),W[E>>2]=i.getSeconds(),W[E+4>>2]=i.getMinutes(),W[E+8>>2]=i.getHours(),W[E+12>>2]=i.getDate(),W[E+16>>2]=i.getMonth(),W[E+20>>2]=i.getFullYear()-1900,W[E+24>>2]=i.getDay(),m=i.getFullYear(),W[E+28>>2]=(m%4!==0||m%100===0&&m%400!==0?ko:bs)[i.getMonth()]+i.getDate()-1|0,W[E+36>>2]=-(60*i.getTimezoneOffset()),m=new Date(i.getFullYear(),6,1).getTimezoneOffset();var z=new Date(i.getFullYear(),0,1).getTimezoneOffset();W[E+32>>2]=(m!=z&&i.getTimezoneOffset()==Math.min(z,m))|0},j:function(i,m,E,z,re,Ne,De,st){re=En(re,Ne);try{if(isNaN(re))return 61;var gt=He(z);if((m&2)!==0&&(E&2)===0&&(gt.flags&2097155)!==2)throw new Ue(2);if((gt.flags&2097155)===1)throw new Ue(2);if(!gt.Ha.bb)throw new Ue(43);var it=gt.Ha.bb(gt,i,re,m,E),Tt=it.Db;return W[De>>2]=it.ub,_[st>>2]=Tt,0}catch(At){if(typeof bt>"u"||At.name!=="ErrnoError")throw At;return-At.Ka}},k:function(i,m,E,z,re,Ne,De){Ne=En(Ne,De);try{if(isNaN(Ne))return 61;var st=He(re);if(E&2){if((st.node.mode&61440)!==32768)throw new Ue(43);if(!(z&2)){var gt=de.slice(i,i+m);st.Ha.cb&&st.Ha.cb(st,gt,Ne,m,z)}}}catch(it){if(typeof bt>"u"||it.name!=="ErrnoError")throw it;return-it.Ka}},s:(i,m,E)=>{function z(gt){return(gt=gt.toTimeString().match(/\(([A-Za-z ]+)\)$/))?gt[1]:"GMT"}var re=new Date().getFullYear(),Ne=new Date(re,0,1),De=new Date(re,6,1);re=Ne.getTimezoneOffset();var st=De.getTimezoneOffset();_[i>>2]=60*Math.max(re,st),W[m>>2]=+(re!=st),i=z(Ne),m=z(De),i=Vs(i),m=Vs(m),st<re?(_[E>>2]=i,_[E+4>>2]=m):(_[E>>2]=m,_[E+4>>2]=i)},d:()=>Date.now(),t:()=>2147483648,c:()=>performance.now(),o:i=>{var m=de.length;if(i>>>=0,2147483648<i)return!1;for(var E=1;4>=E;E*=2){var z=m*(1+.2/E);z=Math.min(z,i+100663296);var re=Math;z=Math.max(i,z);e:{re=(re.min.call(re,2147483648,z+(65536-z%65536)%65536)-oe.buffer.byteLength+65535)/65536;try{oe.grow(re),ge();var Ne=1;break e}catch{}Ne=void 0}if(Ne)return!0}return!1},A:(i,m)=>{var E=0;return Sa().forEach((z,re)=>{var Ne=m+E;for(re=_[i+4*re>>2]=Ne,Ne=0;Ne<z.length;++Ne)Z[re++>>0]=z.charCodeAt(Ne);Z[re>>0]=0,E+=z.length+1}),0},B:(i,m)=>{var E=Sa();_[i>>2]=E.length;var z=0;return E.forEach(re=>z+=re.length+1),_[m>>2]=z,0},e:function(i){try{var m=He(i);return Qs(m),0}catch(E){if(typeof bt>"u"||E.name!=="ErrnoError")throw E;return E.Ka}},p:function(i,m){try{var E=He(i);return Z[m>>0]=E.tty?2:Bt(E.mode)?3:(E.mode&61440)===40960?7:4,$[m+2>>1]=0,g=[0,(Y=0,1<=+Math.abs(Y)?0<Y?+Math.floor(Y/4294967296)>>>0:~~+Math.ceil((Y-+(~~Y>>>0))/4294967296)>>>0:0)],W[m+8>>2]=g[0],W[m+12>>2]=g[1],g=[0,(Y=0,1<=+Math.abs(Y)?0<Y?+Math.floor(Y/4294967296)>>>0:~~+Math.ceil((Y-+(~~Y>>>0))/4294967296)>>>0:0)],W[m+16>>2]=g[0],W[m+20>>2]=g[1],0}catch(z){if(typeof bt>"u"||z.name!=="ErrnoError")throw z;return z.Ka}},x:function(i,m,E,z){try{e:{var re=He(i);i=m;for(var Ne,De=m=0;De<E;De++){var st=_[i>>2],gt=_[i+4>>2];i+=8;var it=Ar(re,Z,st,gt,Ne);if(0>it){var Tt=-1;break e}if(m+=it,it<gt)break;typeof Ne<"u"&&(Ne+=it)}Tt=m}return _[z>>2]=Tt,0}catch(At){if(typeof bt>"u"||At.name!=="ErrnoError")throw At;return At.Ka}},m:function(i,m,E,z,re){m=En(m,E);try{if(isNaN(m))return 61;var Ne=He(i);return xs(Ne,m,z),g=[Ne.position>>>0,(Y=Ne.position,1<=+Math.abs(Y)?0<Y?+Math.floor(Y/4294967296)>>>0:~~+Math.ceil((Y-+(~~Y>>>0))/4294967296)>>>0:0)],W[re>>2]=g[0],W[re+4>>2]=g[1],Ne.hb&&m===0&&z===0&&(Ne.hb=null),0}catch(De){if(typeof bt>"u"||De.name!=="ErrnoError")throw De;return De.Ka}},D:function(i){var E;try{var m=He(i);return(E=m.Ha)!=null&&E.fsync?m.Ha.fsync(m):0}catch(z){if(typeof bt>"u"||z.name!=="ErrnoError")throw z;return z.Ka}},u:function(i,m,E,z){try{e:{var re=He(i);i=m;for(var Ne,De=m=0;De<E;De++){var st=_[i>>2],gt=_[i+4>>2];i+=8;var it=oi(re,Z,st,gt,Ne);if(0>it){var Tt=-1;break e}m+=it,typeof Ne<"u"&&(Ne+=it)}Tt=m}return _[z>>2]=Tt,0}catch(At){if(typeof bt>"u"||At.name!=="ErrnoError")throw At;return At.Ka}}},Ye=function(){var E;function i(z){var re;return Ye=z.exports,oe=Ye.I,ge(),Jt=Ye.Aa,fe.unshift(Ye.J),A--,(re=d.monitorRunDependencies)==null||re.call(d,A),A==0&&ce&&(z=ce,ce=null,z()),Ye}var m={a:_s};if(A++,(E=d.monitorRunDependencies)==null||E.call(d,A),d.instantiateWasm)try{return d.instantiateWasm(m,i)}catch(z){return H(`Module.instantiateWasm callback failed with error: ${z}`),!1}return te(m,function(z){i(z.instance)}),{}}();d._sqlite3_free=i=>(d._sqlite3_free=Ye.K)(i),d._sqlite3_value_text=i=>(d._sqlite3_value_text=Ye.L)(i);var di=()=>(di=Ye.M)();d._sqlite3_prepare_v2=(i,m,E,z,re)=>(d._sqlite3_prepare_v2=Ye.N)(i,m,E,z,re),d._sqlite3_step=i=>(d._sqlite3_step=Ye.O)(i),d._sqlite3_reset=i=>(d._sqlite3_reset=Ye.P)(i),d._sqlite3_exec=(i,m,E,z,re)=>(d._sqlite3_exec=Ye.Q)(i,m,E,z,re),d._sqlite3_finalize=i=>(d._sqlite3_finalize=Ye.R)(i),d._sqlite3_column_name=(i,m)=>(d._sqlite3_column_name=Ye.S)(i,m),d._sqlite3_column_text=(i,m)=>(d._sqlite3_column_text=Ye.T)(i,m),d._sqlite3_column_type=(i,m)=>(d._sqlite3_column_type=Ye.U)(i,m),d._sqlite3_errmsg=i=>(d._sqlite3_errmsg=Ye.V)(i),d._sqlite3_clear_bindings=i=>(d._sqlite3_clear_bindings=Ye.W)(i),d._sqlite3_value_blob=i=>(d._sqlite3_value_blob=Ye.X)(i),d._sqlite3_value_bytes=i=>(d._sqlite3_value_bytes=Ye.Y)(i),d._sqlite3_value_double=i=>(d._sqlite3_value_double=Ye.Z)(i),d._sqlite3_value_int=i=>(d._sqlite3_value_int=Ye._)(i),d._sqlite3_value_type=i=>(d._sqlite3_value_type=Ye.$)(i),d._sqlite3_result_blob=(i,m,E,z)=>(d._sqlite3_result_blob=Ye.aa)(i,m,E,z),d._sqlite3_result_double=(i,m)=>(d._sqlite3_result_double=Ye.ba)(i,m),d._sqlite3_result_error=(i,m,E)=>(d._sqlite3_result_error=Ye.ca)(i,m,E),d._sqlite3_result_int=(i,m)=>(d._sqlite3_result_int=Ye.da)(i,m),d._sqlite3_result_int64=(i,m,E)=>(d._sqlite3_result_int64=Ye.ea)(i,m,E),d._sqlite3_result_null=i=>(d._sqlite3_result_null=Ye.fa)(i),d._sqlite3_result_text=(i,m,E,z)=>(d._sqlite3_result_text=Ye.ga)(i,m,E,z),d._sqlite3_aggregate_context=(i,m)=>(d._sqlite3_aggregate_context=Ye.ha)(i,m),d._sqlite3_column_count=i=>(d._sqlite3_column_count=Ye.ia)(i),d._sqlite3_data_count=i=>(d._sqlite3_data_count=Ye.ja)(i),d._sqlite3_column_blob=(i,m)=>(d._sqlite3_column_blob=Ye.ka)(i,m),d._sqlite3_column_bytes=(i,m)=>(d._sqlite3_column_bytes=Ye.la)(i,m),d._sqlite3_column_double=(i,m)=>(d._sqlite3_column_double=Ye.ma)(i,m),d._sqlite3_bind_blob=(i,m,E,z,re)=>(d._sqlite3_bind_blob=Ye.na)(i,m,E,z,re),d._sqlite3_bind_double=(i,m,E)=>(d._sqlite3_bind_double=Ye.oa)(i,m,E),d._sqlite3_bind_int=(i,m,E)=>(d._sqlite3_bind_int=Ye.pa)(i,m,E),d._sqlite3_bind_text=(i,m,E,z,re)=>(d._sqlite3_bind_text=Ye.qa)(i,m,E,z,re),d._sqlite3_bind_parameter_index=(i,m)=>(d._sqlite3_bind_parameter_index=Ye.ra)(i,m),d._sqlite3_sql=i=>(d._sqlite3_sql=Ye.sa)(i),d._sqlite3_normalized_sql=i=>(d._sqlite3_normalized_sql=Ye.ta)(i),d._sqlite3_changes=i=>(d._sqlite3_changes=Ye.ua)(i),d._sqlite3_close_v2=i=>(d._sqlite3_close_v2=Ye.va)(i),d._sqlite3_create_function_v2=(i,m,E,z,re,Ne,De,st,gt)=>(d._sqlite3_create_function_v2=Ye.wa)(i,m,E,z,re,Ne,De,st,gt),d._sqlite3_open=(i,m)=>(d._sqlite3_open=Ye.xa)(i,m);var Ns=d._malloc=i=>(Ns=d._malloc=Ye.ya)(i),un=d._free=i=>(un=d._free=Ye.za)(i);d._RegisterExtensionFunctions=i=>(d._RegisterExtensionFunctions=Ye.Ba)(i);var fi=(i,m)=>(fi=Ye.Ca)(i,m),$n=()=>($n=Ye.Da)(),dn=i=>(dn=Ye.Ea)(i),Kr=i=>(Kr=Ye.Fa)(i);d.stackAlloc=Kr,d.stackSave=$n,d.stackRestore=dn,d.cwrap=(i,m,E,z)=>{var re=!E||E.every(Ne=>Ne==="number"||Ne==="boolean");return m!=="string"&&re&&!z?d["_"+i]:function(){return ui(i,m,E,arguments)}},d.addFunction=Rr,d.removeFunction=xr,d.UTF8ToString=X,d.ALLOC_NORMAL=Ss,d.allocate=Es,d.allocateUTF8OnStack=ks;var Ks;ce=function i(){Ks||Hn(),Ks||(ce=i)};function Hn(){function i(){if(!Ks&&(Ks=!0,d.calledRun=!0,!J)){if(d.noFSInit||ci||(ci=!0,li(),d.stdin=d.stdin,d.stdout=d.stdout,d.stderr=d.stderr,d.stdin?ys("stdin",d.stdin):Yr("/dev/tty","/dev/stdin"),d.stdout?ys("stdout",null,d.stdout):Yr("/dev/tty","/dev/stdout"),d.stderr?ys("stderr",null,d.stderr):Yr("/dev/tty1","/dev/stderr"),Un("/dev/stdin",0),Un("/dev/stdout",1),Un("/dev/stderr",1)),ln=!1,ee(fe),d.onRuntimeInitialized&&d.onRuntimeInitialized(),d.postRun)for(typeof d.postRun=="function"&&(d.postRun=[d.postRun]);d.postRun.length;){var m=d.postRun.shift();B.unshift(m)}ee(B)}}if(!(0<A)){if(d.preRun)for(typeof d.preRun=="function"&&(d.preRun=[d.preRun]);d.preRun.length;)S();ee(je),0<A||(d.setStatus?(d.setStatus("Running..."),setTimeout(function(){setTimeout(function(){d.setStatus("")},1),i()},1)):i())}}if(d.preInit)for(typeof d.preInit=="function"&&(d.preInit=[d.preInit]);0<d.preInit.length;)d.preInit.pop()();return Hn(),f}),o)};s.exports=v,s.exports.default=v}(dc)),dc.exports}var Ip=Cp();const Tp=si(Ip);function ph(s){return new Promise((p,o)=>{const v=new Worker(new URL("/CogniFlow/assets/ankiImport.worker-iea3fFsE.js",import.meta.url),{type:"module"});v.onmessage=h=>{const{status:u,decks:l,error:f}=h.data;u==="success"?p(l):o(new Error(f)),v.terminate()},v.onerror=h=>{console.error("Worker error:",h);const u=h.message||"The worker script could not be loaded or an unexpected error occurred.";o(new Error(`Anki import worker failed: ${u}`)),v.terminate()},v.postMessage(s,[s])})}let hc=null;async function Dp(){return hc||(hc=await Tp({locateFile:s=>`https://esm.sh/sql.js@1.10.3/dist/${s}`})),hc}function ef(s,p){let o=s;return o=o.replace(/<img\s[^>]*?src=(["'])(.*?)\1[^>]*?>/gi,(v,h,u)=>{const l=decodeURIComponent(u),f=p.get(l);if(f){const x=btoa(new Uint8Array(f.data).reduce((T,b)=>T+String.fromCharCode(b),"")),d=`src="data:${f.type};base64,${x}"`;return v.replace(/src=(["']).*?\1/i,d)}return v}),o=o.replace(/\[sound:(.*?)\]/g,(v,h)=>{const u=decodeURIComponent(h.trim()),l=p.get(u);if(l){const f=btoa(new Uint8Array(l.data).reduce((x,d)=>x+String.fromCharCode(d),""));return l.type.startsWith("video/")?`<video controls playsinline src="data:${l.type};base64,${f}"></video>`:`<audio controls src="data:${l.type};base64,${f}"></audio>`}return""}),o}function tf(s,p,o,v,h){let u=s;const l=/{{c(\d+)::(.*?)(?:::(.*?))?}}/gs;u=u.replace(l,(T,b,N,w)=>{const I=parseInt(b,10);return v?I===o+1?`<span class="cloze">[${w||"..."}]</span>`:`<span class="cloze-inactive">${N}</span>`:I===o+1?`<span class="cloze"><b>${N}</b></span>`:`<span class="cloze-inactive">${N}</span>`}),h&&(u=u.replace(/<hr id=answer>/g,"").replace(/{{FrontSide}}/g,h));const f=/{{#([^}]+?)}}(.*?){{\/\1}}/gs;let x;do x=u,u=u.replace(f,(T,b,N)=>{const w=p.get(b.trim());return w&&w.trim()!==""?N:""});while(u!==x);const d=/{{\^([^}]+?)}}(.*?){{\/\1}}/gs;do x=u,u=u.replace(d,(T,b,N)=>{const w=p.get(b.trim());return!w||w.trim()===""?N:""});while(u!==x);return p.forEach((T,b)=>{const N=new RegExp(`{{${b}}}`,"g");u=u.replace(N,T)}),u=u.replace(/{{(.*?)}}/g,""),u}async function gh(s){var R;const p=await Dp(),o=await _p.loadAsync(s),v=o.file(/collection.anki2[1]?/);if(!v||v.length===0)throw new Error("collection.anki2 or .anki21 file not found.");const h=await v[0].async("uint8array"),u=new p.Database(h),l=o.file("media");let f={};if(l)try{f=JSON.parse(await l.async("string"))}catch(M){console.warn("Could not parse media file.",M)}const x=new Map;for(const M in f){const H=f[M],V=o.file(M);if(V){const oe=await V.async("uint8array"),J=((R=H.split(".").pop())==null?void 0:R.toLowerCase())||"";let Z="application/octet-stream";["jpg","jpeg"].includes(J)?Z="image/jpeg":J==="png"?Z="image/png":J==="gif"?Z="image/gif":J==="svg"?Z="image/svg+xml":J==="mp3"?Z="audio/mpeg":J==="ogg"?Z="audio/ogg":J==="wav"?Z="audio/wav":J==="m4a"?Z="audio/mp4":J==="opus"?Z="audio/opus":J==="mp4"?Z="video/mp4":J==="webm"?Z="video/webm":J==="ogv"&&(Z="video/ogg"),x.set(H,{data:oe,type:Z})}}const d=u.exec("SELECT models, decks, crt FROM col");if(!d[0])throw new Error("Could not read collection data.");const[T,b,N]=d[0].values[0],w=JSON.parse(T),I=JSON.parse(b),k=u.exec("SELECT id, mid, flds FROM notes"),C=new Map(k[0].values.map(M=>[M[0],{mid:M[1],flds:M[2].split("")}])),O=u.exec("SELECT id, nid, did, ord, due, ivl, factor, type, lapses FROM cards")[0].values,F=new Map;for(const M in I){const H=I[M];F.set(M,{id:crypto.randomUUID(),name:H.name,description:H.desc||"Imported Anki deck.",type:Ae.Flashcard,cards:[]})}for(const M of O){const[H,V,oe,J,Z,de,$,W,_]=M,ie=C.get(V);if(!ie)continue;const be=w[ie.mid];if(!(be!=null&&be.tmpls))continue;const ge=F.get(oe.toString());if(!ge)continue;const je=be.tmpls[J];if(!je)continue;const fe=new Map((be.flds||[]).map((me,Te)=>[me.name,ie.flds[Te]||""]));let B=tf(je.qfmt,fe,J,!0),S=tf(je.afmt,fe,J,!1,B);B=ef(B,x),S=ef(S,x);let A,ce;W===2&&de>0?(A=new Date(N*1e3),A.setDate(A.getDate()+Z),ce=new Date(A.getTime()),ce.setDate(ce.getDate()-de)):(A=new Date,A.setHours(0,0,0,0));const pe=Math.min(1,Math.log1p(de)/Math.log1p(90));ge.cards.push({id:H.toString(),front:B,back:S,css:be.css?`<style>${be.css}</style>`:"",dueDate:A.toISOString(),interval:de,easeFactor:$?Math.max($/1e3,bc):us,masteryLevel:pe,lastReviewed:ce==null?void 0:ce.toISOString(),lapses:_||0})}return u.close(),Array.from(F.values()).filter(M=>M.cards.length>0)}const Ap=({isOpen:s,onClose:p,onAddDecks:o,onAddSeriesWithDecks:v})=>{const[h,u]=U.useState("create"),[l,f]=U.useState(""),[x,d]=U.useState(""),[T,b]=U.useState(""),[N,w]=U.useState(!1),I=U.useRef(null),{addToast:k}=er(),C=U.useRef(null);pr(C,s);const j=U.useCallback(()=>{u("create"),f(""),d(""),b(""),w(!1)},[]),O=U.useCallback(()=>{j(),p()},[j,p]),F=U.useCallback(J=>{d(J);try{const Z=kc(J);(Z==null?void 0:Z.type)===Ae.Quiz?f(Z.data.name):(Z==null?void 0:Z.type)==="quiz_series"&&f(Z.data.seriesName)}catch{}},[]),R=U.useCallback(async J=>{if(J){b(J.name),w(!0);try{if(J.name.toLowerCase().endsWith(".apkg")){f("");const Z=await J.arrayBuffer(),de=Z.slice(0);let $=[];try{$=await ph(Z)}catch(W){console.warn("Anki worker failed, trying main thread fallback:",W),k("Import via worker failed. Trying a slower fallback method... this may freeze the app.","info");try{$=await gh(de)}catch(_){throw console.error("Anki main thread fallback also failed:",_),_}}$.length>0?(o($),k(`Successfully imported ${$.length} deck(s) from ${J.name}.`,"success"),O()):(k("No valid decks found in the Anki package.","info"),j())}else if(J.name.toLowerCase().endsWith(".json")){const Z=await J.text();F(Z),w(!1),k("File loaded. Confirm name and import, or paste content directly.","info")}else k("Unsupported file type. Please upload a '.json' or '.apkg' file.","error"),b(""),w(!1)}catch(Z){console.error("Failed to process file:",Z),k(`An error occurred: ${Z instanceof Error?Z.message:"Unknown error"}`,"error"),j()}}},[k,O,F,o,j]),M=U.useCallback(()=>{if(h==="create"){if(!l.trim()){k("Please enter a deck name.","error");return}const J={id:crypto.randomUUID(),name:l.trim(),type:Ae.Flashcard,cards:[],description:`An empty deck created on ${Um()}`};o([J]),k(`Deck "${J.name}" created.`,"success"),O();return}if(!x){k("Please paste or upload content.","error");return}try{const J=kc(x);if(!J)return;if(J.type==="quiz_series"){const{seriesName:de,seriesDescription:$,levels:W}=J.data,_=[],ie=W.map(ge=>{const je=ge.decks.map(fe=>({id:crypto.randomUUID(),name:fe.name,description:fe.description,type:Ae.Quiz,questions:wr(fe.questions)}));return _.push(...je),{title:ge.title,deckIds:je.map(fe=>fe.id)}}),be={id:crypto.randomUUID(),type:"series",name:de,description:$,levels:ie,archived:!1,createdAt:new Date().toISOString()};v(be,_),O();return}if(!l.trim()){k("Please enter a deck name.","error");return}let Z;if(J.type===Ae.Flashcard){const de=Tc(J.data);Z={id:crypto.randomUUID(),name:l.trim(),type:Ae.Flashcard,cards:de,description:`${de.length} imported flashcard${de.length===1?"":"s"}.`}}else{const de=wr(J.data.questions);Z={id:crypto.randomUUID(),name:l.trim(),description:J.data.description,type:Ae.Quiz,questions:de}}o([Z]),k(`Deck "${Z.name}" imported successfully.`,"success"),O()}catch(J){k(J instanceof Error?J.message:"Invalid JSON content.","error")}},[l,h,x,o,O,k,v]),H=J=>{var de;const Z=(de=J.target.files)==null?void 0:de[0];Z&&R(Z),J.target&&(J.target.value="")};if(!s)return null;const V=()=>{const J=T.toLowerCase().endsWith(".apkg");if(h==="upload"&&J)return r.jsx("div",{className:"text-text-muted text-center py-12",children:"Anki file selected. Decks will be imported automatically."});switch(h){case"paste":return r.jsxs("div",{children:[r.jsx("textarea",{className:"w-full h-48 p-2 bg-background border border-border rounded-md focus:ring-2 focus:ring-primary focus:outline-none text-text",placeholder:'Paste JSON here... e.g., [{"front": "Q1", "back": "A1"}] or a Quiz/Series object.',value:x,onChange:Z=>F(Z.target.value)}),r.jsxs(Ut,{href:"/instructions/json",onClick:p,className:"text-sm text-primary hover:underline mt-2 inline-flex items-center gap-1",children:[r.jsx(ae,{name:"help-circle",className:"w-4 h-4"}),"View JSON format guide"]})]});case"upload":return r.jsxs(r.Fragment,{children:[r.jsx("input",{type:"file",ref:I,className:"hidden",accept:".json,application/json,.apkg,application/zip,application/x-zip-compressed,application/octet-stream",onChange:H}),r.jsxs("label",{className:"flex flex-col items-center justify-center w-full h-48 border-2 border-dashed border-border rounded-lg cursor-pointer hover:bg-background transition-colors",children:[r.jsx(ae,{name:"upload-cloud",className:"w-10 h-10 text-text-muted mb-2"}),r.jsxs("p",{className:"text-sm text-text-muted",children:[r.jsx("span",{className:"font-semibold text-primary",onClick:Z=>{var de;Z.preventDefault(),(de=I.current)==null||de.click()},children:"Click to upload"})," or drag and drop anywhere"]}),r.jsx("p",{className:"text-xs text-text-muted/70",children:"JSON or Anki Package (.apkg)"}),T&&r.jsx("p",{className:"text-sm text-green-500 dark:text-green-400 mt-2 truncate",title:T,children:T})]})]});case"create":default:return r.jsx("p",{className:"text-text-muted text-center py-12",children:"Create an empty flashcard deck."})}},oe=!(h==="upload"&&T.toLowerCase().endsWith(".apkg"));return r.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-75 flex items-center justify-center z-50 p-4",children:r.jsxs("div",{ref:C,className:"bg-surface rounded-lg shadow-xl w-full max-w-lg overflow-hidden transform transition-all relative",children:[N&&r.jsxs("div",{className:"absolute inset-0 bg-surface/80 flex flex-col items-center justify-center z-20",children:[r.jsx(sr,{}),r.jsx("p",{className:"text-lg text-text mt-4",children:"Processing file..."})]}),r.jsxs("div",{className:"flex justify-between items-center p-4 border-b border-border",children:[r.jsx("h2",{className:"text-xl font-bold text-text",children:"Create / Import"}),r.jsx(ve,{variant:"ghost",onClick:O,className:"p-1 h-auto",children:r.jsx(ae,{name:"x"})})]}),r.jsxs("div",{className:"p-6 space-y-4",children:[oe&&r.jsxs("div",{children:[r.jsx("label",{htmlFor:"deck-name",className:"block text-sm font-medium text-text-muted mb-1",children:"Deck / Series Name"}),r.jsx("input",{type:"text",id:"deck-name",value:l,onChange:J=>f(J.target.value),className:"w-full p-2 bg-background border border-border rounded-md focus:ring-2 focus:ring-primary focus:outline-none",placeholder:"e.g. Japanese Vocabulary"}),r.jsx("p",{className:"text-xs text-text-muted mt-1",children:"For single deck or new deck creation. This is auto-filled when pasting a Series object."})]}),r.jsx("div",{className:"flex border-b border-border",children:["create","paste","upload"].map(J=>r.jsx("button",{onClick:()=>u(J),className:`capitalize px-4 py-2 text-sm font-medium transition-colors ${h===J?"border-b-2 border-primary text-text":"text-text-muted hover:text-text"}`,children:J==="create"?"Create Empty":J},J))}),r.jsx("div",{className:"mt-4",children:V()})]}),r.jsxs("div",{className:"flex justify-end p-4 bg-background/50 border-t border-border",children:[r.jsx(ve,{variant:"secondary",onClick:O,className:"mr-2",children:"Cancel"}),r.jsx(ve,{variant:"primary",onClick:M,disabled:N||h==="create"&&!l.trim()||h!=="create"&&!x&&!T,children:h==="create"?"Create Deck":"Import"})]})]})})},wo=({isOpen:s,onClose:p,onConfirm:o,title:v,message:h,confirmText:u})=>{const[l,f]=U.useState(""),x=U.useRef(null);pr(x,s),U.useEffect(()=>{s&&f("")},[s]);const d=!u||l===u,T=()=>{d&&(o(),p())};return s?r.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-75 flex items-center justify-center z-50 p-4",children:r.jsxs("div",{ref:x,className:"bg-surface rounded-lg shadow-xl w-full max-w-md transform transition-all relative",role:"alertdialog","aria-modal":"true","aria-labelledby":"confirm-title","aria-describedby":"confirm-message",children:[r.jsxs("div",{className:"flex justify-between items-center p-4 border-b border-border",children:[r.jsx("h2",{id:"confirm-title",className:"text-xl font-bold text-text",children:v}),r.jsx(ve,{type:"button",variant:"ghost",onClick:p,className:"p-1 h-auto","aria-label":"Close",children:r.jsx(ae,{name:"x"})})]}),r.jsxs("div",{className:"p-6 space-y-4",children:[r.jsx("p",{id:"confirm-message",className:"text-text-muted",children:h}),u&&r.jsxs("div",{children:[r.jsxs("label",{htmlFor:"confirm-input",className:"block text-sm font-medium text-text-muted mb-1",children:['To confirm, type "',r.jsx("strong",{className:"text-text",children:u}),'" below:']}),r.jsx("input",{id:"confirm-input",type:"text",value:l,onChange:b=>f(b.target.value),className:"w-full p-2 bg-background border border-border rounded-md focus:ring-2 focus:ring-red-500 focus:outline-none"})]})]}),r.jsxs("div",{className:"flex justify-end p-4 bg-background/50 border-t border-border",children:[r.jsx(ve,{type:"button",variant:"secondary",onClick:p,className:"mr-2",children:"Cancel"}),r.jsx(ve,{type:"button",variant:"danger",onClick:T,disabled:!d,children:"Confirm"})]})]})}):null},Op=({isOpen:s,onClose:p,onRestore:o})=>{const[v,h]=U.useState(""),[u,l]=U.useState(null),[f,x]=U.useState(null),[d,T]=U.useState(!1),b=U.useRef(null),{addToast:N}=er(),w=U.useRef(null);pr(w,s);const I=()=>{h(""),l(null),x(null),p()},k=async R=>{if(R){h(R.name),x(null),l("Processing file...");try{if(R.name.toLowerCase().endsWith(".json")){const M=await R.text(),H=Ic(M);x(H),N(`Backup file "${R.name}" is valid and ready to restore.`,"success")}else N("Unsupported file type. Please upload a '.json' backup file.","error"),h("")}catch(M){console.error("Failed to process file:",M),N(`Restore failed: ${M instanceof Error?M.message:"Unknown error"}`,"error"),h("")}finally{l(null)}}},C=R=>{var H;if(u)return;const M=(H=R.target.files)==null?void 0:H[0];M&&k(M),R.target&&(R.target.value="")},j=R=>{var H;if(R.preventDefault(),u)return;const M=(H=R.dataTransfer.files)==null?void 0:H[0];M&&k(M)},O=R=>R.preventDefault(),F=async()=>{if(f){T(!1),l("Restoring data...");try{await o(f),I()}catch{l(null)}}};return s?r.jsxs(r.Fragment,{children:[r.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-75 flex items-center justify-center z-50 p-4",children:r.jsxs("div",{ref:w,className:"bg-surface rounded-lg shadow-xl w-full max-w-lg overflow-hidden transform transition-all relative",children:[u&&r.jsxs("div",{className:"absolute inset-0 bg-surface/80 flex flex-col items-center justify-center z-20",children:[r.jsx(sr,{}),r.jsx("p",{className:"text-lg text-text mt-4",children:u})]}),r.jsxs("div",{className:"flex justify-between items-center p-4 border-b border-border",children:[r.jsx("h2",{className:"text-xl font-bold",children:"Restore from Backup"}),r.jsx(ve,{variant:"ghost",onClick:I,className:"p-1 h-auto",disabled:!!u,children:r.jsx(ae,{name:"x"})})]}),r.jsxs("div",{className:"p-6 space-y-4",children:[r.jsx("div",{className:"bg-red-900/20 border border-red-500/30 rounded-lg p-4 text-sm text-red-700 dark:text-red-200",children:r.jsxs("p",{children:[r.jsx("strong",{className:"font-bold",children:"Warning:"})," Restoring from a backup will merge and overwrite data. Decks and folders with the same ID will be replaced. This action cannot be undone."]})}),r.jsx("input",{type:"file",ref:b,className:"hidden",accept:".json,application/json",onChange:C,disabled:!!u}),r.jsxs("label",{onDragOver:O,onDrop:j,className:`flex flex-col items-center justify-center w-full h-48 border-2 border-dashed border-border rounded-lg transition-colors ${u?"cursor-not-allowed opacity-70":"cursor-pointer hover:bg-background"}`,children:[r.jsx(ae,{name:"upload-cloud",className:"w-10 h-10 text-text-muted mb-2"}),r.jsxs("p",{className:"text-sm text-text-muted",children:[r.jsx("span",{className:"font-semibold text-primary",onClick:R=>{var M;u||(R.preventDefault(),(M=b.current)==null||M.click())},children:"Click to upload"})," or drag and drop"]}),r.jsx("p",{className:"text-xs text-text-muted/70",children:"CogniFlow Backup JSON file"}),v&&r.jsx("p",{className:`text-sm mt-2 truncate ${f?"text-green-600":"text-red-600"}`,title:v,children:v})]})]}),r.jsxs("div",{className:"flex justify-end p-4 bg-background/50 border-t border-border",children:[r.jsx(ve,{variant:"secondary",onClick:I,className:"mr-2",disabled:!!u,children:"Cancel"}),r.jsx(ve,{variant:"danger",onClick:()=>T(!0),disabled:!f||!!u,children:u?"Please wait...":"Restore"})]})]})}),d&&r.jsx(wo,{isOpen:d,onClose:()=>T(!1),onConfirm:F,title:"Confirm Restore",message:"Restoring from a backup will overwrite existing decks and folders with the same ID. This action cannot be undone. Are you sure you want to continue?"})]}):null},Rp=({isOpen:s,onClose:p,onReset:o,decks:v})=>{const[h,u]=U.useState(""),[l,f]=U.useState(""),{addToast:x}=er(),d=U.useRef(null);pr(d,s);const T=U.useMemo(()=>v.find(I=>I.id===h),[v,h]),b=T?l===T.name:!1,N=()=>{if(!b||!T){x("Confirmation text does not match.","error");return}o(T.id),p()},w=()=>{u(""),f(""),p()};return s?r.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-75 flex items-center justify-center z-50 p-4",children:r.jsxs("div",{ref:d,className:"bg-surface rounded-lg shadow-xl w-full max-w-lg transform transition-all relative",children:[r.jsxs("div",{className:"flex justify-between items-center p-4 border-b border-border",children:[r.jsx("h2",{className:"text-xl font-bold",children:"Reset Deck Progress"}),r.jsx(ve,{type:"button",variant:"ghost",onClick:w,className:"p-1 h-auto",children:r.jsx(ae,{name:"x"})})]}),r.jsxs("div",{className:"p-6 space-y-4",children:[r.jsx("div",{className:"bg-red-900/20 border border-red-500/30 rounded-lg p-4 text-sm text-red-700 dark:text-red-200",children:r.jsxs("p",{children:[r.jsx("strong",{className:"font-bold",children:"Warning:"})," This will reset all spaced repetition data (due dates, intervals) for the selected deck. The cards themselves will not be deleted. This action cannot be undone."]})}),r.jsxs("div",{children:[r.jsx("label",{htmlFor:"deck-select",className:"block text-sm font-medium text-text-muted mb-1",children:"Select Deck"}),r.jsxs("select",{id:"deck-select",value:h,onChange:I=>{u(I.target.value),f("")},className:"w-full p-2 bg-background border border-border rounded-md focus:ring-2 focus:ring-primary focus:outline-none",children:[r.jsx("option",{value:"",disabled:!0,children:"-- Select a deck --"}),v.map(I=>r.jsx("option",{value:I.id,children:I.name},I.id))]})]}),T&&r.jsxs("div",{className:"animate-fade-in",children:[r.jsxs("label",{htmlFor:"confirm-text",className:"block text-sm font-medium text-text-muted mb-1",children:['To confirm, type "',r.jsx("strong",{className:"text-text",children:T.name}),'" below:']}),r.jsx("input",{id:"confirm-text",type:"text",value:l,onChange:I=>f(I.target.value),className:"w-full p-2 bg-background border border-border rounded-md focus:ring-2 focus:ring-primary focus:outline-none"})]})]}),r.jsxs("div",{className:"flex justify-end p-4 bg-background/50 border-t border-border",children:[r.jsx(ve,{type:"button",variant:"secondary",onClick:w,className:"mr-2",children:"Cancel"}),r.jsxs(ve,{type:"button",variant:"danger",onClick:N,disabled:!b,children:[r.jsx(ae,{name:"refresh-ccw",className:"w-5 h-5 mr-2"}),"Reset Progress"]})]})]})}):null},Mp=({folder:s,onClose:p,onSave:o})=>{const[v,h]=U.useState(""),{addToast:u}=er(),l=U.useRef(null);pr(l,!0),U.useEffect(()=>{s&&h(s.name)},[s]);const f=x=>{if(x.preventDefault(),!v.trim()){u("Folder name cannot be empty.","error");return}o({id:(s==null?void 0:s.id)||null,name:v.trim()})};return r.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-75 flex items-center justify-center z-50 p-4",children:r.jsx("div",{ref:l,className:"bg-surface rounded-lg shadow-xl w-full max-w-md transform transition-all relative",children:r.jsxs("form",{onSubmit:f,children:[r.jsxs("div",{className:"flex justify-between items-center p-4 border-b border-border",children:[r.jsx("h2",{className:"text-xl font-bold",children:s?"Edit Folder":"Create New Folder"}),r.jsx(ve,{type:"button",variant:"ghost",onClick:p,className:"p-1 h-auto",children:r.jsx(ae,{name:"x"})})]}),r.jsx("div",{className:"p-6 space-y-4",children:r.jsxs("div",{children:[r.jsx("label",{htmlFor:"folder-name",className:"block text-sm font-medium text-text-muted mb-1",children:"Folder Name"}),r.jsx("input",{id:"folder-name",type:"text",value:v,onChange:x=>h(x.target.value),className:"w-full p-2 bg-background border border-border rounded-md focus:ring-2 focus:ring-primary focus:outline-none",placeholder:"e.g., University Courses"})]})}),r.jsxs("div",{className:"flex justify-end p-4 bg-background/50 border-t border-border",children:[r.jsx(ve,{type:"button",variant:"secondary",onClick:p,className:"mr-2",children:"Cancel"}),r.jsxs(ve,{type:"submit",variant:"primary",children:[r.jsx(ae,{name:"save",className:"w-4 h-4 mr-2"}),s?"Save Changes":"Create Folder"]})]})]})})})},Lp=({series:s,onClose:p,onSave:o})=>{const[v,h]=U.useState(""),[u,l]=U.useState(""),[f,x]=U.useState(null),{addToast:d}=er(),T=U.useRef(null);pr(T,!0);const b=s===null;U.useEffect(()=>{s?(h(s.name),l(s.description),x(null)):(h(""),l(""),x(null))},[s]);const N=I=>{if(!b)return;const k=I.clipboardData.getData("text");if(k.trim().startsWith("{"))try{const C=JSON.parse(k);typeof C.seriesName=="string"&&typeof C.seriesDescription=="string"&&Array.isArray(C.levels)&&(I.preventDefault(),h(C.seriesName),l(C.seriesDescription),x(C),d("Series details and structure populated from JSON scaffold!","success"))}catch{}},w=I=>{if(I.preventDefault(),!v.trim()){d("Series name cannot be empty.","error");return}o({id:b?null:s.id,name:v.trim(),description:u.trim(),scaffold:b?f:null})};return r.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-75 flex items-center justify-center z-50 p-4",children:r.jsx("div",{ref:T,className:"bg-surface rounded-lg shadow-xl w-full max-w-lg transform transition-all relative",children:r.jsxs("form",{onSubmit:w,children:[r.jsxs("div",{className:"flex justify-between items-center p-4 border-b border-border",children:[r.jsx("h2",{className:"text-xl font-bold",children:b?"Create New Series":"Edit Series"}),r.jsx(ve,{type:"button",variant:"ghost",onClick:p,className:"p-1 h-auto",children:r.jsx(ae,{name:"x"})})]}),r.jsxs("div",{className:"p-6 space-y-4",children:[r.jsxs("div",{children:[r.jsx("label",{htmlFor:"series-name",className:"block text-sm font-medium text-text-muted mb-1",children:"Series Name"}),r.jsx("input",{id:"series-name",type:"text",value:v,onChange:I=>h(I.target.value),onPaste:N,className:"w-full p-2 bg-background border border-border rounded-md focus:ring-2 focus:ring-primary focus:outline-none",placeholder:"e.g., Introduction to Algebra"}),b&&r.jsx("p",{className:"text-xs text-text-muted mt-1",children:"You can paste a full JSON scaffold object here to auto-populate."})]}),r.jsxs("div",{children:[r.jsx("label",{htmlFor:"series-description",className:"block text-sm font-medium text-text-muted mb-1",children:"Description"}),r.jsx("textarea",{id:"series-description",value:u,onChange:I=>l(I.target.value),onPaste:N,rows:3,className:"w-full p-2 bg-background border border-border rounded-md focus:ring-2 focus:ring-primary focus:outline-none",placeholder:"A collection of decks covering core concepts."})]}),b&&f&&r.jsxs("div",{className:"space-y-2 animate-fade-in",children:[r.jsx("h4",{className:"text-sm font-semibold text-text-muted",children:"Structure Preview"}),r.jsx("div",{className:"bg-background border border-border rounded-md p-3 max-h-48 overflow-y-auto text-sm",children:r.jsx("ul",{className:"space-y-3",children:f.levels.map((I,k)=>r.jsxs("li",{children:[r.jsxs("div",{className:"flex items-center gap-2 font-medium text-text",children:[r.jsx(ae,{name:"layers",className:"w-4 h-4 text-purple-500 flex-shrink-0"}),r.jsx("span",{className:"font-semibold",children:I.title})]}),r.jsxs("ul",{className:"pl-6 mt-1 space-y-1",children:[(I.decks||[]).map((C,j)=>r.jsxs("li",{className:"flex items-center gap-2 text-text-muted",children:[r.jsx(ae,{name:"help-circle",className:"w-3.5 h-3.5 flex-shrink-0"}),r.jsx("span",{children:C.name})]},j)),(!I.decks||I.decks.length===0)&&r.jsx("li",{className:"flex items-center gap-2 text-xs text-text-muted/70 italic",children:"(No decks in this level)"})]})]},k))})})]})]}),r.jsxs("div",{className:"flex justify-end p-4 bg-background/50 border-t border-border",children:[r.jsx(ve,{type:"button",variant:"secondary",onClick:p,className:"mr-2",children:"Cancel"}),r.jsxs(ve,{type:"submit",variant:"primary",children:[r.jsx(ae,{name:"save",className:"w-4 h-4 mr-2"}),b?"Create Series":"Save Changes"]})]})]})})})},Fp=({pullDistance:s,isRefreshing:p,threshold:o})=>{if(p)return r.jsx("div",{className:"fixed top-0 left-0 right-0 h-20 flex items-center justify-center z-50 transition-all duration-300",children:r.jsx(sr,{size:"md"})});if(s<=0)return null;const v=Math.min(s/o,1),h=v>=1,u=20,l=2*Math.PI*u,f=l-v*l;return r.jsx("div",{className:"fixed top-0 left-0 right-0 h-20 flex items-center justify-center z-10 pointer-events-none",style:{transform:`translateY(${Math.min(s,o*1.5)-80}px)`,opacity:Math.min(s/(o/2),1)},children:r.jsxs("div",{className:"relative w-12 h-12 flex items-center justify-center bg-white dark:bg-gray-800 rounded-full shadow-lg",children:[r.jsxs("svg",{className:"absolute w-full h-full transform -rotate-90",viewBox:"0 0 44 44",children:[r.jsx("circle",{className:"text-gray-300/50 dark:text-gray-600/50",stroke:"currentColor",strokeWidth:"4",fill:"transparent",r:u,cx:"22",cy:"22"}),r.jsx("circle",{className:"text-blue-500",stroke:"currentColor",strokeWidth:"4",strokeLinecap:"round",fill:"transparent",r:u,cx:"22",cy:"22",style:{strokeDasharray:l,strokeDashoffset:f,transition:h?"stroke-dashoffset 0.1s linear":"none"}})]}),r.jsx(ae,{name:h?"refresh-ccw":"arrow-down",className:`w-6 h-6 transition-colors duration-200 ${h?"text-blue-500":"text-gray-500 dark:text-gray-400"}`})]})})},Qr=(s,p,o)=>{const v=new Date;v.setHours(0,0,0,0);const h=p.map(l=>({id:crypto.randomUUID(),text:l.text,explanation:l.explanation})),u=h[p.findIndex(l=>l.correct)];if(!u)throw new Error(`No correct option specified for question: "${s}"`);return{id:crypto.randomUUID(),questionType:"multipleChoice",questionText:s,tags:["nature","sample"],detailedExplanation:o,options:h,correctAnswerId:u.id,dueDate:v.toISOString(),interval:0,easeFactor:us,suspended:!1,masteryLevel:0,lastReviewed:void 0}},Pp=()=>{const s={id:crypto.randomUUID(),name:"Level 1.1: Simple Addition",description:"Practice basic addition problems.",type:Ae.Quiz,questions:[Qr("What is 1 + 1?",[{text:"2",correct:!0},{text:"1"},{text:"3"}],"1 plus 1 equals 2."),Qr("What is 2 + 3?",[{text:"5",correct:!0},{text:"4"},{text:"6"}],"2 plus 3 equals 5."),Qr("What is 5 + 4?",[{text:"9",correct:!0},{text:"8"},{text:"10"}],"5 plus 4 equals 9.")]},p={id:crypto.randomUUID(),name:"Level 1.2: Simple Subtraction",description:"Practice basic subtraction problems.",type:Ae.Quiz,questions:[Qr("What is 5 - 2?",[{text:"3",correct:!0},{text:"2"},{text:"4"}],"5 minus 2 equals 3."),Qr("What is 10 - 4?",[{text:"6",correct:!0},{text:"5"},{text:"7"}],"10 minus 4 equals 6.")]},o={id:crypto.randomUUID(),name:"Level 2.1: Simple Multiplication",description:"Practice basic multiplication problems.",type:Ae.Quiz,questions:[Qr("What is 2 * 3?",[{text:"6",correct:!0},{text:"5"},{text:"8"}],"2 times 3 is 6."),Qr("What is 4 * 5?",[{text:"20",correct:!0},{text:"15"},{text:"25"}],"4 times 5 is 20.")]},v=[s,p,o];return{series:{id:crypto.randomUUID(),type:"series",name:"Sample: Basic Math Series",description:"A sample series to demonstrate the progressive learning path feature. Complete each deck to unlock the next!",levels:[{title:"Level 1: Fundamentals",deckIds:[s.id,p.id]},{title:"Level 2: Next Steps",deckIds:[o.id]}],createdAt:new Date().toISOString()},decks:v}},Up=()=>{const s=[Qr("Which process allows plants to convert light energy into chemical energy?",[{text:"Respiration"},{text:"Photosynthesis",correct:!0},{text:"Transpiration"},{text:"Germination"}],"Photosynthesis is the vital process used by plants, algae, and certain bacteria to harness energy from sunlight and turn it into chemical energy in the form of glucose."),Qr("What is the largest rainforest in the world?",[{text:"The Congo Rainforest"},{text:"The Valdivian Temperate Rainforest"},{text:"The Daintree Rainforest"},{text:"The Amazon Rainforest",correct:!0}],"The Amazon Rainforest is the world's largest tropical rainforest, famed for its biodiversity. It spans across nine countries in South America."),Qr("What type of rock is formed from the cooling and solidification of magma or lava?",[{text:"Igneous Rock",correct:!0},{text:"Sedimentary Rock"},{text:"Metamorphic Rock"},{text:"Sandstone"}],"Igneous rock is formed through the cooling and solidification of magma (molten rock below the surface) or lava (molten rock on the surface). Examples include granite and basalt."),Qr("Which layer of the Earth's atmosphere is closest to the surface?",[{text:"Stratosphere"},{text:"Mesosphere"},{text:"Troposphere",correct:!0},{text:"Thermosphere"}],"The Troposphere is the lowest layer of Earth's atmosphere, and is also where nearly all weather conditions take place. It contains about 75% of the atmosphere's mass."),Qr("What is the name for the process of water movement through a plant and its evaporation from aerial parts, such as leaves, stems and flowers?",[{text:"Condensation"},{text:"Precipitation"},{text:"Transpiration",correct:!0},{text:"Photosynthesis"}],"Transpiration is essentially evaporation of water from plant leaves. It is a key part of the water cycle, and an important process in plant life.")];return{id:crypto.randomUUID(),name:"Sample: Wonders of Nature",description:"A sample quiz deck to introduce you to CogniFlow. Test your knowledge about the natural world!",type:Ae.Quiz,questions:s,lastOpened:new Date().toISOString()}};function zp(s,p){const o=new Date(s);return o.setDate(o.getDate()+p),o}const qp=(s,p)=>{const o=new Date;o.setHours(0,0,0,0);let v=s.lapses||0;p===mt.Again?v++:v>0&&(v=0);let h=ap[p];p===mt.Again&&v>2&&(h-=(v-2)*.05);let u=s.easeFactor+h;u<bc&&(u=bc);let l;if(p===mt.Again)l=rp;else if(s.interval===0)switch(p){case mt.Hard:l=1;break;case mt.Good:l=3;break;case mt.Easy:l=5;break;default:l=1}else{let d=1;p===mt.Hard&&(d=np),p===mt.Easy&&(d=sp),l=Math.ceil(s.interval*u*d)}const f=zp(o,l),x=Math.min(1,Math.log1p(l)/Math.log1p(90));return{...s,interval:l,easeFactor:u,dueDate:f.toISOString(),lastReviewed:o.toISOString(),masteryLevel:x,lapses:v}},rf=s=>{const p=new Date;return p.setHours(0,0,0,0),{...s,dueDate:p.toISOString(),interval:0,easeFactor:us,suspended:!1,masteryLevel:0,lastReviewed:void 0,lapses:0}},wn=s=>{const p=s.masteryLevel||0;if(p===0||!s.lastReviewed||s.suspended)return 0;const o=(s.interval||1)*2,v=new Date(s.lastReviewed),u=Math.max(0,(new Date().getTime()-v.getTime())/(1e3*60*60*24));if(u<=0)return p;const l=Math.pow(.5,u/o);return p*l},Bp={},nf=s=>{let p;const o=new Set,v=(T,b)=>{const N=typeof T=="function"?T(p):T;if(!Object.is(N,p)){const w=p;p=b??(typeof N!="object"||N===null)?N:Object.assign({},p,N),o.forEach(I=>I(p,w))}},h=()=>p,x={setState:v,getState:h,getInitialState:()=>d,subscribe:T=>(o.add(T),()=>o.delete(T)),destroy:()=>{(Bp?"production":void 0)!=="production"&&console.warn("[DEPRECATED] The `destroy` method will be unsupported in a future version. Instead use unsubscribe function returned by subscribe. Everything will be garbage-collected if store is garbage-collected."),o.clear()}},d=p=s(v,h,x);return x},Gp=s=>s?nf(s):nf;var mc={exports:{}},pc={},gc={exports:{}},xc={};/**
 * @license React
 * use-sync-external-store-shim.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var sf;function $p(){if(sf)return xc;sf=1;var s=ai();function p(b,N){return b===N&&(b!==0||1/b===1/N)||b!==b&&N!==N}var o=typeof Object.is=="function"?Object.is:p,v=s.useState,h=s.useEffect,u=s.useLayoutEffect,l=s.useDebugValue;function f(b,N){var w=N(),I=v({inst:{value:w,getSnapshot:N}}),k=I[0].inst,C=I[1];return u(function(){k.value=w,k.getSnapshot=N,x(k)&&C({inst:k})},[b,w,N]),h(function(){return x(k)&&C({inst:k}),b(function(){x(k)&&C({inst:k})})},[b]),l(w),w}function x(b){var N=b.getSnapshot;b=b.value;try{var w=N();return!o(b,w)}catch{return!0}}function d(b,N){return N()}var T=typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"?d:f;return xc.useSyncExternalStore=s.useSyncExternalStore!==void 0?s.useSyncExternalStore:T,xc}var af;function Hp(){return af||(af=1,gc.exports=$p()),gc.exports}/**
 * @license React
 * use-sync-external-store-shim/with-selector.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var of;function Wp(){if(of)return pc;of=1;var s=ai(),p=Hp();function o(d,T){return d===T&&(d!==0||1/d===1/T)||d!==d&&T!==T}var v=typeof Object.is=="function"?Object.is:o,h=p.useSyncExternalStore,u=s.useRef,l=s.useEffect,f=s.useMemo,x=s.useDebugValue;return pc.useSyncExternalStoreWithSelector=function(d,T,b,N,w){var I=u(null);if(I.current===null){var k={hasValue:!1,value:null};I.current=k}else k=I.current;I=f(function(){function j(H){if(!O){if(O=!0,F=H,H=N(H),w!==void 0&&k.hasValue){var V=k.value;if(w(V,H))return R=V}return R=H}if(V=R,v(F,H))return V;var oe=N(H);return w!==void 0&&w(V,oe)?V:(F=H,R=oe)}var O=!1,F,R,M=b===void 0?null:b;return[function(){return j(T())},M===null?void 0:function(){return j(M())}]},[T,b,N,w]);var C=h(d,I[0],I[1]);return l(function(){k.hasValue=!0,k.value=C},[C]),x(C),C},pc}var lf;function Qp(){return lf||(lf=1,mc.exports=Wp()),mc.exports}var Yp=Qp();const Vp=si(Yp),xh={},{useDebugValue:Jp}=ni,{useSyncExternalStoreWithSelector:Kp}=Vp;let cf=!1;const Zp=s=>s;function Xp(s,p=Zp,o){(xh?"production":void 0)!=="production"&&o&&!cf&&(console.warn("[DEPRECATED] Use `createWithEqualityFn` instead of `create` or use `useStoreWithEqualityFn` instead of `useStore`. They can be imported from 'zustand/traditional'. https://github.com/pmndrs/zustand/discussions/1937"),cf=!0);const v=Kp(s.subscribe,s.getState,s.getServerState||s.getInitialState,p,o);return Jp(v),v}const uf=s=>{(xh?"production":void 0)!=="production"&&typeof s!="function"&&console.warn("[DEPRECATED] Passing a vanilla store will be unsupported in a future version. Instead use `import { useStore } from 'zustand'`.");const p=typeof s=="function"?Gp(s):s,o=(v,h)=>Xp(p,v,h);return Object.assign(o,p),o},eg=s=>s?uf(s):uf;function tg(s,p){var v;const o={...s,lastModified:Date.now()};switch(p.type){case"SET_LOADING":return{...s,isLoading:p.payload};case"SET_SERIES_PROGRESS":return{...s,seriesProgress:p.payload};case"LOAD_DATA":return{...s,...p.payload,isLoading:!1,lastModified:null};case"SET_AI_GENERATION_STATUS":return{...s,aiGenerationStatus:{...s.aiGenerationStatus,...p.payload}};case"CANCEL_AI_GENERATION":return(v=s.aiGenerationStatus.abortController)==null||v.abort(),{...s,aiGenerationStatus:{isGenerating:!1,statusText:null,generatingDeckId:null,generatingSeriesId:null,abortController:null}};case"TOGGLE_AI_CHAT":return{...s,isAIChatOpen:p.payload};case"SET_AI_CHAT_HISTORY":return{...s,aiChatHistory:p.payload};case"ADD_DECKS":{const h=new Map(s.decks.map(u=>[u.id,u]));return p.payload.forEach(u=>h.set(u.id,u)),{...o,decks:Array.from(h.values())}}case"RESTORE_DATA":{const{decks:h,folders:u,deckSeries:l}=p.payload,f=new Map(s.decks.map(T=>[T.id,T]));h.forEach(T=>f.set(T.id,T));const x=new Map(s.folders.map(T=>[T.id,T]));u.forEach(T=>x.set(T.id,T));const d=new Map(s.deckSeries.map(T=>[T.id,T]));return l.forEach(T=>d.set(T.id,T)),{...o,decks:Array.from(f.values()),folders:Array.from(x.values()),deckSeries:Array.from(d.values())}}case"DELETE_DECK":return{...o,decks:s.decks.filter(h=>h.id!==p.payload),deckSeries:s.deckSeries.map(h=>h.levels?{...h,levels:h.levels.map(u=>({...u,deckIds:(u.deckIds||[]).filter(l=>l!==p.payload)}))}:h)};case"UPDATE_DECK":return{...o,decks:s.decks.map(h=>h.id===p.payload.id?p.payload:h)};case"BULK_UPDATE_DECKS":{const h=new Map(s.decks.map(u=>[u.id,u]));return p.payload.forEach(u=>h.set(u.id,u)),{...o,decks:Array.from(h.values())}}case"ADD_FOLDER":return{...o,folders:[...s.folders,p.payload]};case"UPDATE_FOLDER":return{...o,folders:s.folders.map(h=>h.id===p.payload.id?p.payload:h)};case"DELETE_FOLDER":return{...o,folders:s.folders.filter(h=>h.id!==p.payload),decks:s.decks.map(h=>h.folderId===p.payload?{...h,folderId:null}:h)};case"ADD_SERIES":return{...o,deckSeries:[...s.deckSeries,p.payload]};case"ADD_SERIES_WITH_DECKS":{const{series:h,decks:u}=p.payload,l=new Map(s.decks.map(f=>[f.id,f]));return u.forEach(f=>l.set(f.id,f)),{...o,decks:Array.from(l.values()),deckSeries:[...s.deckSeries,h]}}case"UPDATE_SERIES":return{...o,deckSeries:s.deckSeries.map(h=>h.id===p.payload.id?p.payload:h)};case"DELETE_SERIES":return{...o,deckSeries:s.deckSeries.filter(h=>h.id!==p.payload)};default:return s}}const rg={decks:[],folders:[],deckSeries:[],seriesProgress:new Map,isLoading:!0,lastModified:null,aiGenerationStatus:{isGenerating:!1,statusText:null,generatingDeckId:null,generatingSeriesId:null,abortController:null},isAIChatOpen:!1,aiChatHistory:[]},Ke=eg(s=>({...rg,dispatch:p=>s(o=>tg(o,p))})),ng=s=>{const p=new Date;p.setHours(23,59,59,999);const o=s.type===Ae.Quiz||s.type===Ae.Learning?s.questions:s.cards;return Array.isArray(o)?o.filter(v=>!v.suspended&&new Date(v.dueDate)<=p).length:0},yh=()=>Ke(s=>{const p=new Set;return s.deckSeries.forEach(o=>{(o.levels||[]).forEach(v=>(v.deckIds||[]).forEach(h=>p.add(h)))}),s.decks.filter(o=>!o.archived&&!o.deletedAt&&!p.has(o.id))}),sg=()=>Ke(s=>s.deckSeries.filter(p=>!p.archived&&!p.deletedAt)),ag=()=>Ke(s=>{const p=new Set;s.deckSeries.forEach(v=>{v.levels.forEach(h=>h.deckIds.forEach(u=>p.add(u)))});const o=new Set;return s.deckSeries.forEach(v=>{var h;if(!v.archived&&!v.deletedAt){const u=((h=s.seriesProgress.get(v.id))==null?void 0:h.size)||0;(v.levels||[]).flatMap(f=>f.deckIds||[]).forEach((f,x)=>{x<=u&&o.add(f)})}}),s.decks.filter(v=>!(v.archived||v.deletedAt||p.has(v.id)&&!o.has(v.id))).reduce((v,h)=>v+ng(h),0)});/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 *//**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */var df;(function(s){s.OUTCOME_UNSPECIFIED="OUTCOME_UNSPECIFIED",s.OUTCOME_OK="OUTCOME_OK",s.OUTCOME_FAILED="OUTCOME_FAILED",s.OUTCOME_DEADLINE_EXCEEDED="OUTCOME_DEADLINE_EXCEEDED"})(df||(df={}));var ff;(function(s){s.LANGUAGE_UNSPECIFIED="LANGUAGE_UNSPECIFIED",s.PYTHON="PYTHON"})(ff||(ff={}));var at;(function(s){s.TYPE_UNSPECIFIED="TYPE_UNSPECIFIED",s.STRING="STRING",s.NUMBER="NUMBER",s.INTEGER="INTEGER",s.BOOLEAN="BOOLEAN",s.ARRAY="ARRAY",s.OBJECT="OBJECT",s.NULL="NULL"})(at||(at={}));var hf;(function(s){s.HARM_CATEGORY_UNSPECIFIED="HARM_CATEGORY_UNSPECIFIED",s.HARM_CATEGORY_HATE_SPEECH="HARM_CATEGORY_HATE_SPEECH",s.HARM_CATEGORY_DANGEROUS_CONTENT="HARM_CATEGORY_DANGEROUS_CONTENT",s.HARM_CATEGORY_HARASSMENT="HARM_CATEGORY_HARASSMENT",s.HARM_CATEGORY_SEXUALLY_EXPLICIT="HARM_CATEGORY_SEXUALLY_EXPLICIT",s.HARM_CATEGORY_CIVIC_INTEGRITY="HARM_CATEGORY_CIVIC_INTEGRITY",s.HARM_CATEGORY_IMAGE_HATE="HARM_CATEGORY_IMAGE_HATE",s.HARM_CATEGORY_IMAGE_DANGEROUS_CONTENT="HARM_CATEGORY_IMAGE_DANGEROUS_CONTENT",s.HARM_CATEGORY_IMAGE_HARASSMENT="HARM_CATEGORY_IMAGE_HARASSMENT",s.HARM_CATEGORY_IMAGE_SEXUALLY_EXPLICIT="HARM_CATEGORY_IMAGE_SEXUALLY_EXPLICIT"})(hf||(hf={}));var mf;(function(s){s.HARM_BLOCK_METHOD_UNSPECIFIED="HARM_BLOCK_METHOD_UNSPECIFIED",s.SEVERITY="SEVERITY",s.PROBABILITY="PROBABILITY"})(mf||(mf={}));var pf;(function(s){s.HARM_BLOCK_THRESHOLD_UNSPECIFIED="HARM_BLOCK_THRESHOLD_UNSPECIFIED",s.BLOCK_LOW_AND_ABOVE="BLOCK_LOW_AND_ABOVE",s.BLOCK_MEDIUM_AND_ABOVE="BLOCK_MEDIUM_AND_ABOVE",s.BLOCK_ONLY_HIGH="BLOCK_ONLY_HIGH",s.BLOCK_NONE="BLOCK_NONE",s.OFF="OFF"})(pf||(pf={}));var gf;(function(s){s.MODE_UNSPECIFIED="MODE_UNSPECIFIED",s.MODE_DYNAMIC="MODE_DYNAMIC"})(gf||(gf={}));var xf;(function(s){s.AUTH_TYPE_UNSPECIFIED="AUTH_TYPE_UNSPECIFIED",s.NO_AUTH="NO_AUTH",s.API_KEY_AUTH="API_KEY_AUTH",s.HTTP_BASIC_AUTH="HTTP_BASIC_AUTH",s.GOOGLE_SERVICE_ACCOUNT_AUTH="GOOGLE_SERVICE_ACCOUNT_AUTH",s.OAUTH="OAUTH",s.OIDC_AUTH="OIDC_AUTH"})(xf||(xf={}));var yf;(function(s){s.API_SPEC_UNSPECIFIED="API_SPEC_UNSPECIFIED",s.SIMPLE_SEARCH="SIMPLE_SEARCH",s.ELASTIC_SEARCH="ELASTIC_SEARCH"})(yf||(yf={}));var vf;(function(s){s.URL_RETRIEVAL_STATUS_UNSPECIFIED="URL_RETRIEVAL_STATUS_UNSPECIFIED",s.URL_RETRIEVAL_STATUS_SUCCESS="URL_RETRIEVAL_STATUS_SUCCESS",s.URL_RETRIEVAL_STATUS_ERROR="URL_RETRIEVAL_STATUS_ERROR",s.URL_RETRIEVAL_STATUS_PAYWALL="URL_RETRIEVAL_STATUS_PAYWALL",s.URL_RETRIEVAL_STATUS_UNSAFE="URL_RETRIEVAL_STATUS_UNSAFE"})(vf||(vf={}));var wf;(function(s){s.FINISH_REASON_UNSPECIFIED="FINISH_REASON_UNSPECIFIED",s.STOP="STOP",s.MAX_TOKENS="MAX_TOKENS",s.SAFETY="SAFETY",s.RECITATION="RECITATION",s.LANGUAGE="LANGUAGE",s.OTHER="OTHER",s.BLOCKLIST="BLOCKLIST",s.PROHIBITED_CONTENT="PROHIBITED_CONTENT",s.SPII="SPII",s.MALFORMED_FUNCTION_CALL="MALFORMED_FUNCTION_CALL",s.IMAGE_SAFETY="IMAGE_SAFETY",s.UNEXPECTED_TOOL_CALL="UNEXPECTED_TOOL_CALL"})(wf||(wf={}));var bf;(function(s){s.HARM_PROBABILITY_UNSPECIFIED="HARM_PROBABILITY_UNSPECIFIED",s.NEGLIGIBLE="NEGLIGIBLE",s.LOW="LOW",s.MEDIUM="MEDIUM",s.HIGH="HIGH"})(bf||(bf={}));var kf;(function(s){s.HARM_SEVERITY_UNSPECIFIED="HARM_SEVERITY_UNSPECIFIED",s.HARM_SEVERITY_NEGLIGIBLE="HARM_SEVERITY_NEGLIGIBLE",s.HARM_SEVERITY_LOW="HARM_SEVERITY_LOW",s.HARM_SEVERITY_MEDIUM="HARM_SEVERITY_MEDIUM",s.HARM_SEVERITY_HIGH="HARM_SEVERITY_HIGH"})(kf||(kf={}));var Sf;(function(s){s.BLOCKED_REASON_UNSPECIFIED="BLOCKED_REASON_UNSPECIFIED",s.SAFETY="SAFETY",s.OTHER="OTHER",s.BLOCKLIST="BLOCKLIST",s.PROHIBITED_CONTENT="PROHIBITED_CONTENT",s.IMAGE_SAFETY="IMAGE_SAFETY"})(Sf||(Sf={}));var Ef;(function(s){s.TRAFFIC_TYPE_UNSPECIFIED="TRAFFIC_TYPE_UNSPECIFIED",s.ON_DEMAND="ON_DEMAND",s.PROVISIONED_THROUGHPUT="PROVISIONED_THROUGHPUT"})(Ef||(Ef={}));var _f;(function(s){s.MODALITY_UNSPECIFIED="MODALITY_UNSPECIFIED",s.TEXT="TEXT",s.IMAGE="IMAGE",s.AUDIO="AUDIO"})(_f||(_f={}));var Nf;(function(s){s.MEDIA_RESOLUTION_UNSPECIFIED="MEDIA_RESOLUTION_UNSPECIFIED",s.MEDIA_RESOLUTION_LOW="MEDIA_RESOLUTION_LOW",s.MEDIA_RESOLUTION_MEDIUM="MEDIA_RESOLUTION_MEDIUM",s.MEDIA_RESOLUTION_HIGH="MEDIA_RESOLUTION_HIGH"})(Nf||(Nf={}));var jf;(function(s){s.JOB_STATE_UNSPECIFIED="JOB_STATE_UNSPECIFIED",s.JOB_STATE_QUEUED="JOB_STATE_QUEUED",s.JOB_STATE_PENDING="JOB_STATE_PENDING",s.JOB_STATE_RUNNING="JOB_STATE_RUNNING",s.JOB_STATE_SUCCEEDED="JOB_STATE_SUCCEEDED",s.JOB_STATE_FAILED="JOB_STATE_FAILED",s.JOB_STATE_CANCELLING="JOB_STATE_CANCELLING",s.JOB_STATE_CANCELLED="JOB_STATE_CANCELLED",s.JOB_STATE_PAUSED="JOB_STATE_PAUSED",s.JOB_STATE_EXPIRED="JOB_STATE_EXPIRED",s.JOB_STATE_UPDATING="JOB_STATE_UPDATING",s.JOB_STATE_PARTIALLY_SUCCEEDED="JOB_STATE_PARTIALLY_SUCCEEDED"})(jf||(jf={}));var Cf;(function(s){s.TUNING_MODE_UNSPECIFIED="TUNING_MODE_UNSPECIFIED",s.TUNING_MODE_FULL="TUNING_MODE_FULL",s.TUNING_MODE_PEFT_ADAPTER="TUNING_MODE_PEFT_ADAPTER"})(Cf||(Cf={}));var If;(function(s){s.ADAPTER_SIZE_UNSPECIFIED="ADAPTER_SIZE_UNSPECIFIED",s.ADAPTER_SIZE_ONE="ADAPTER_SIZE_ONE",s.ADAPTER_SIZE_TWO="ADAPTER_SIZE_TWO",s.ADAPTER_SIZE_FOUR="ADAPTER_SIZE_FOUR",s.ADAPTER_SIZE_EIGHT="ADAPTER_SIZE_EIGHT",s.ADAPTER_SIZE_SIXTEEN="ADAPTER_SIZE_SIXTEEN",s.ADAPTER_SIZE_THIRTY_TWO="ADAPTER_SIZE_THIRTY_TWO"})(If||(If={}));var Tf;(function(s){s.FEATURE_SELECTION_PREFERENCE_UNSPECIFIED="FEATURE_SELECTION_PREFERENCE_UNSPECIFIED",s.PRIORITIZE_QUALITY="PRIORITIZE_QUALITY",s.BALANCED="BALANCED",s.PRIORITIZE_COST="PRIORITIZE_COST"})(Tf||(Tf={}));var Df;(function(s){s.UNSPECIFIED="UNSPECIFIED",s.BLOCKING="BLOCKING",s.NON_BLOCKING="NON_BLOCKING"})(Df||(Df={}));var Af;(function(s){s.MODE_UNSPECIFIED="MODE_UNSPECIFIED",s.MODE_DYNAMIC="MODE_DYNAMIC"})(Af||(Af={}));var Of;(function(s){s.ENVIRONMENT_UNSPECIFIED="ENVIRONMENT_UNSPECIFIED",s.ENVIRONMENT_BROWSER="ENVIRONMENT_BROWSER"})(Of||(Of={}));var Rf;(function(s){s.MODE_UNSPECIFIED="MODE_UNSPECIFIED",s.AUTO="AUTO",s.ANY="ANY",s.NONE="NONE"})(Rf||(Rf={}));var Mf;(function(s){s.BLOCK_LOW_AND_ABOVE="BLOCK_LOW_AND_ABOVE",s.BLOCK_MEDIUM_AND_ABOVE="BLOCK_MEDIUM_AND_ABOVE",s.BLOCK_ONLY_HIGH="BLOCK_ONLY_HIGH",s.BLOCK_NONE="BLOCK_NONE"})(Mf||(Mf={}));var Lf;(function(s){s.DONT_ALLOW="DONT_ALLOW",s.ALLOW_ADULT="ALLOW_ADULT",s.ALLOW_ALL="ALLOW_ALL"})(Lf||(Lf={}));var Ff;(function(s){s.auto="auto",s.en="en",s.ja="ja",s.ko="ko",s.hi="hi",s.zh="zh",s.pt="pt",s.es="es"})(Ff||(Ff={}));var Pf;(function(s){s.MASK_MODE_DEFAULT="MASK_MODE_DEFAULT",s.MASK_MODE_USER_PROVIDED="MASK_MODE_USER_PROVIDED",s.MASK_MODE_BACKGROUND="MASK_MODE_BACKGROUND",s.MASK_MODE_FOREGROUND="MASK_MODE_FOREGROUND",s.MASK_MODE_SEMANTIC="MASK_MODE_SEMANTIC"})(Pf||(Pf={}));var Uf;(function(s){s.CONTROL_TYPE_DEFAULT="CONTROL_TYPE_DEFAULT",s.CONTROL_TYPE_CANNY="CONTROL_TYPE_CANNY",s.CONTROL_TYPE_SCRIBBLE="CONTROL_TYPE_SCRIBBLE",s.CONTROL_TYPE_FACE_MESH="CONTROL_TYPE_FACE_MESH"})(Uf||(Uf={}));var zf;(function(s){s.SUBJECT_TYPE_DEFAULT="SUBJECT_TYPE_DEFAULT",s.SUBJECT_TYPE_PERSON="SUBJECT_TYPE_PERSON",s.SUBJECT_TYPE_ANIMAL="SUBJECT_TYPE_ANIMAL",s.SUBJECT_TYPE_PRODUCT="SUBJECT_TYPE_PRODUCT"})(zf||(zf={}));var qf;(function(s){s.EDIT_MODE_DEFAULT="EDIT_MODE_DEFAULT",s.EDIT_MODE_INPAINT_REMOVAL="EDIT_MODE_INPAINT_REMOVAL",s.EDIT_MODE_INPAINT_INSERTION="EDIT_MODE_INPAINT_INSERTION",s.EDIT_MODE_OUTPAINT="EDIT_MODE_OUTPAINT",s.EDIT_MODE_CONTROLLED_EDITING="EDIT_MODE_CONTROLLED_EDITING",s.EDIT_MODE_STYLE="EDIT_MODE_STYLE",s.EDIT_MODE_BGSWAP="EDIT_MODE_BGSWAP",s.EDIT_MODE_PRODUCT_IMAGE="EDIT_MODE_PRODUCT_IMAGE"})(qf||(qf={}));var Bf;(function(s){s.FOREGROUND="FOREGROUND",s.BACKGROUND="BACKGROUND",s.PROMPT="PROMPT",s.SEMANTIC="SEMANTIC",s.INTERACTIVE="INTERACTIVE"})(Bf||(Bf={}));var Gf;(function(s){s.OPTIMIZED="OPTIMIZED",s.LOSSLESS="LOSSLESS"})(Gf||(Gf={}));var $f;(function(s){s.STATE_UNSPECIFIED="STATE_UNSPECIFIED",s.PROCESSING="PROCESSING",s.ACTIVE="ACTIVE",s.FAILED="FAILED"})($f||($f={}));var Hf;(function(s){s.SOURCE_UNSPECIFIED="SOURCE_UNSPECIFIED",s.UPLOADED="UPLOADED",s.GENERATED="GENERATED"})(Hf||(Hf={}));var Wf;(function(s){s.MODALITY_UNSPECIFIED="MODALITY_UNSPECIFIED",s.TEXT="TEXT",s.IMAGE="IMAGE",s.VIDEO="VIDEO",s.AUDIO="AUDIO",s.DOCUMENT="DOCUMENT"})(Wf||(Wf={}));var Qf;(function(s){s.START_SENSITIVITY_UNSPECIFIED="START_SENSITIVITY_UNSPECIFIED",s.START_SENSITIVITY_HIGH="START_SENSITIVITY_HIGH",s.START_SENSITIVITY_LOW="START_SENSITIVITY_LOW"})(Qf||(Qf={}));var Yf;(function(s){s.END_SENSITIVITY_UNSPECIFIED="END_SENSITIVITY_UNSPECIFIED",s.END_SENSITIVITY_HIGH="END_SENSITIVITY_HIGH",s.END_SENSITIVITY_LOW="END_SENSITIVITY_LOW"})(Yf||(Yf={}));var Vf;(function(s){s.ACTIVITY_HANDLING_UNSPECIFIED="ACTIVITY_HANDLING_UNSPECIFIED",s.START_OF_ACTIVITY_INTERRUPTS="START_OF_ACTIVITY_INTERRUPTS",s.NO_INTERRUPTION="NO_INTERRUPTION"})(Vf||(Vf={}));var Jf;(function(s){s.TURN_COVERAGE_UNSPECIFIED="TURN_COVERAGE_UNSPECIFIED",s.TURN_INCLUDES_ONLY_ACTIVITY="TURN_INCLUDES_ONLY_ACTIVITY",s.TURN_INCLUDES_ALL_INPUT="TURN_INCLUDES_ALL_INPUT"})(Jf||(Jf={}));var Kf;(function(s){s.SCHEDULING_UNSPECIFIED="SCHEDULING_UNSPECIFIED",s.SILENT="SILENT",s.WHEN_IDLE="WHEN_IDLE",s.INTERRUPT="INTERRUPT"})(Kf||(Kf={}));var Zf;(function(s){s.SCALE_UNSPECIFIED="SCALE_UNSPECIFIED",s.C_MAJOR_A_MINOR="C_MAJOR_A_MINOR",s.D_FLAT_MAJOR_B_FLAT_MINOR="D_FLAT_MAJOR_B_FLAT_MINOR",s.D_MAJOR_B_MINOR="D_MAJOR_B_MINOR",s.E_FLAT_MAJOR_C_MINOR="E_FLAT_MAJOR_C_MINOR",s.E_MAJOR_D_FLAT_MINOR="E_MAJOR_D_FLAT_MINOR",s.F_MAJOR_D_MINOR="F_MAJOR_D_MINOR",s.G_FLAT_MAJOR_E_FLAT_MINOR="G_FLAT_MAJOR_E_FLAT_MINOR",s.G_MAJOR_E_MINOR="G_MAJOR_E_MINOR",s.A_FLAT_MAJOR_F_MINOR="A_FLAT_MAJOR_F_MINOR",s.A_MAJOR_G_FLAT_MINOR="A_MAJOR_G_FLAT_MINOR",s.B_FLAT_MAJOR_G_MINOR="B_FLAT_MAJOR_G_MINOR",s.B_MAJOR_A_FLAT_MINOR="B_MAJOR_A_FLAT_MINOR"})(Zf||(Zf={}));var Xf;(function(s){s.MUSIC_GENERATION_MODE_UNSPECIFIED="MUSIC_GENERATION_MODE_UNSPECIFIED",s.QUALITY="QUALITY",s.DIVERSITY="DIVERSITY",s.VOCALIZATION="VOCALIZATION"})(Xf||(Xf={}));var eh;(function(s){s.PLAYBACK_CONTROL_UNSPECIFIED="PLAYBACK_CONTROL_UNSPECIFIED",s.PLAY="PLAY",s.PAUSE="PAUSE",s.STOP="STOP",s.RESET_CONTEXT="RESET_CONTEXT"})(eh||(eh={}));/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */var th;(function(s){s.PAGED_ITEM_BATCH_JOBS="batchJobs",s.PAGED_ITEM_MODELS="models",s.PAGED_ITEM_TUNING_JOBS="tuningJobs",s.PAGED_ITEM_FILES="files",s.PAGED_ITEM_CACHED_CONTENTS="cachedContents"})(th||(th={}));const ds=()=>{throw new Error("AI features are disabled. A Google Gemini API key is required.")},$s=s=>{const{topic:p,level:o,comprehensiveness:v,customInstructions:h,learningGoal:u,learningStyle:l,focusTopics:f,excludeTopics:x,language:d}=s,T=d?`**Language:** All content must be in ${d}.`:"",b=o?`**Target Audience Level:** ${o}`:"",N=v?`**Comprehensiveness:** ${v}`:"",w=u?`**User's Learning Goal:** ${u}`:"",I=l?`**Preferred Learning Style:** ${l}`:"",k=f?`**Specific Topics to Focus On:** ${f}`:"",C=x?`**Topics to Exclude:** ${x}`:"",j=h?`**Additional Instructions:** ${h}`:"";return[`**Main Topic:** ${p}`,T,b,N,w,I,k,C,j].filter(Boolean).join(`
`)},Dc={type:at.OBJECT,properties:{seriesName:{type:at.STRING,description:"A creative and descriptive name for the entire learning series."},seriesDescription:{type:at.STRING,description:"A brief, engaging summary of what the series covers. Can include basic HTML (<b>, <i>)."},levels:{type:at.ARRAY,description:"An array of 2 to 10 learning levels, progressing in difficulty.",items:{type:at.OBJECT,properties:{title:{type:at.STRING,description:"The title for this level (e.g., 'Level 1: Fundamentals')."},decks:{type:at.ARRAY,description:"An array of 1 to 6 quiz decks for this level.",items:{type:at.OBJECT,properties:{name:{type:at.STRING,description:"The name of the quiz deck, including its level number (e.g., 'Level 1.1: Core Concepts')."},description:{type:at.STRING,description:"A brief summary of this specific deck's content. Can include basic HTML (<b>, <i>)."},questions:{type:at.ARRAY,description:"This MUST be an empty array: []. The questions will be generated later.",maxItems:0,items:{type:at.OBJECT,properties:{question:{type:at.STRING}}}},suggestedQuestionCount:{type:at.NUMBER,description:"A suggested number of questions (e.g., 10, 15, 20) for this deck to ensure comprehensive topic coverage."}},required:["name","description","questions","suggestedQuestionCount"]}}},required:["title","decks"]}}},required:["seriesName","seriesDescription","levels"]},bo={type:at.OBJECT,properties:{questions:{type:at.ARRAY,description:"An array of high-quality multiple-choice questions for the deck.",items:{type:at.OBJECT,properties:{questionText:{type:at.STRING,description:"The question text. Can include HTML for formatting (e.g., <b>, <i>, <ruby>)."},detailedExplanation:{type:at.STRING,description:"A thorough explanation of the correct answer, providing context and educational value. Can include HTML for rich formatting."},correctAnswerId:{type:at.STRING},options:{type:at.ARRAY,description:"An array of 3 to 4 answer options.",items:{type:at.OBJECT,properties:{id:{type:at.STRING,description:"A unique identifier for the option (e.g., 'opt1')."},text:{type:at.STRING,description:"The answer option text. Can include HTML for formatting."}},required:["id","text"]}}},required:["questionText","detailedExplanation","correctAnswerId","options"]}}},required:["questions"]},ig={type:at.OBJECT,properties:{name:{type:at.STRING,description:"A creative and descriptive name for the quiz deck."},description:{type:at.STRING,description:"A brief, engaging summary of what the deck covers. Can include basic HTML (<b>, <i>)."},questions:bo.properties.questions},required:["name","description","questions"]},og={type:at.ARRAY,description:"An array of 1 to 2 new, unique learning levels that logically follow the existing ones.",items:Dc.properties.levels.items},lg={type:at.ARRAY,description:"An array of 1 to 2 new, unique quiz decks for this level.",items:Dc.properties.levels.items.properties.decks.items},vh={type:at.OBJECT,properties:{name:{type:at.STRING,description:"A creative and descriptive name for the learning deck."},description:{type:at.STRING,description:"A brief, engaging summary of what the deck covers. Can include basic HTML (<b>, <i>)."},learningContent:{type:at.ARRAY,description:"An array of learning blocks. Each block must contain one informational card and 3-15 questions related to it.",items:{type:at.OBJECT,properties:{infoCardContent:{type:at.STRING,description:"The informational content for this block. Can be a paragraph or a few. Should be rich with HTML formatting for clarity (<b>, <i>, <ul>, <li>)."},questions:{type:at.ARRAY,description:"An array of 3-15 questions related to the info card.",items:bo.properties.questions.items}},required:["infoCardContent","questions"]}}},required:["name","description","learningContent"]},cg={type:at.OBJECT,properties:{learningContent:vh.properties.learningContent},required:["learningContent"]},ug=async s=>{const p=ds(),v=`
        Please act as an expert instructional designer. Your task is to generate a JSON object that acts as a scaffold for a learning path based on the user's request.

        **User Request:**
        ${$s(s)}
        
        **Instructions:**
        1.  Create a progressive learning path with 2-10 distinct levels.
        2.  Each level should contain 1-6 decks. Decide the optimal number of decks to properly cover the material for that level.
        3.  For each deck, provide a \`suggestedQuestionCount\`. Aim for approximately 15-25 questions, but suggest a higher or lower number if it's better for the topic.
        4.  Deck and Series descriptions can use basic HTML like <b> and <i> for formatting.
        5.  **Crucially, for every deck object, include a "questions" key with an empty array: "questions": []**
        6.  All generated content must prefer the metric system (e.g., meters, kilograms, Celsius).
        7.  The entire output must conform to the provided JSON schema. Do not output any text or markdown before or after the JSON object.
    `;try{const u=(await p.models.generateContent({model:"gemini-2.5-flash",contents:v,config:{responseMimeType:"application/json",responseSchema:Dc}})).text.trim(),l=JSON.parse(u);if(!l.seriesName||!Array.isArray(l.levels))throw new Error("AI response is missing required series data.");return l}catch(h){throw console.error("Error generating series scaffold with AI:",h),h instanceof Error&&h.message.includes("SAFETY")?new Error("The request was blocked due to safety settings. Please try a different topic."):h}},dg=async s=>{const p=ds(),o=$s(s),v={"Quick Overview":"10-15",Standard:"15-30",Comprehensive:"30-50",Exhaustive:"50-75"}[s.comprehensiveness||"Standard"]||"15-30",h=`
        You are an expert content creator. Generate a single, complete quiz deck in JSON format based on the user's request.

        **User Request:**
        ${o}

        **Instructions & Quality Requirements:**
        1.  **Generate ${v} high-quality questions.**
        2.  **Factual Accuracy:** All information must be factually correct and verifiable.
        3.  **HTML Formatting:** Use HTML tags like \`<b>\`, \`<i>\`, and \`<ruby>\` for rich text formatting in questions, options, and explanations. This is especially important for language learning.
        4.  **In-Depth Explanations:** The \`detailedExplanation\` is crucial. It must thoroughly explain the correct answer.
        5.  **Plausible Distractors:** Incorrect options should be plausible but clearly wrong.
        6.  **Metric System:** Prefer the metric system for all units.
        7.  The entire output must be a single JSON object conforming to the provided schema.
    `;try{const l=(await p.models.generateContent({model:"gemini-2.5-flash",contents:h,config:{responseMimeType:"application/json",responseSchema:ig}})).text.trim(),f=JSON.parse(l);if(!f.name||!Array.isArray(f.questions))throw new Error("AI response is missing required deck data.");return f}catch(u){throw console.error("Error generating deck with AI:",u),u instanceof Error&&u.message.includes("SAFETY")?new Error("The request was blocked due to safety settings. Please try a different topic."):u}},rh=async s=>{const p=ds(),o=$s(s),v={"Quick Overview":"3-5",Standard:"5-8",Comprehensive:"8-12",Exhaustive:"12-15"}[s.comprehensiveness||"Standard"]||"5-8",h=`
        You are an expert instructional designer. Generate a complete "Learning Deck" in JSON format. A learning deck teaches a topic progressively with informational cards followed by questions.

        **User Request:**
        ${o}

        **Instructions & Quality Requirements:**
        1.  **Structure:** Create ${v} learning blocks. Each block must consist of:
            a. A single \`infoCardContent\` field with well-written, informative text (using HTML for formatting).
            b. An array of 3-5 high-quality \`questions\` that are directly based on the information in the \`infoCardContent\`.
        2.  **Progressive Learning:** The blocks should be ordered logically to guide the user from basic concepts to more complex ones.
        3.  **Content Quality:** All information must be factually correct. Explanations must be thorough. Incorrect options for questions must be plausible.
        4.  **HTML Formatting:** Use HTML tags like \`<b>\`, \`<i>\`, \`<ul>\`, \`<li>\`, and \`<ruby>\` extensively for rich text formatting.
        5.  **Metric System:** Prefer the metric system for all units.
        6.  The entire output must be a single JSON object conforming to the provided schema.
    `;try{const l=(await p.models.generateContent({model:"gemini-2.5-flash",contents:h,config:{responseMimeType:"application/json",responseSchema:vh}})).text.trim(),f=JSON.parse(l);if(!f.name||!Array.isArray(f.learningContent))throw new Error("AI response is missing required learning deck data.");return f}catch(u){throw console.error("Error generating learning deck with AI:",u),u instanceof Error&&u.message.includes("SAFETY")?new Error("The request was blocked due to safety settings. Please try a different topic."):u}},fg=async(s,p)=>{const o=ds(),v=s.levels.map((l,f)=>{const x=l.deckIds.map(d=>{var T;return`- ${(T=p.find(b=>b.id===d))==null?void 0:T.name}`}).join(`
  `);return`Level ${f+1}: ${l.title}
Decks:
  ${x}`}).join(`

`),h=`
        You are an expert instructional designer continuing to build a learning path.
        Here is the existing series structure:
        Series Name: ${s.name}
        Series Description: ${s.description}
        
        Existing Levels:
        ${v}

        Your task is to generate 1-2 NEW levels that logically follow the existing ones. Do not repeat topics.
        The new levels should continue the progression of difficulty and knowledge.
        For each new level, suggest 1-3 new decks with names, descriptions, and a suggested question count. Descriptions can include basic HTML (<b>, <i>).
        All generated content should prefer the metric system (e.g., meters, kilograms, Celsius).
        The entire output must conform to the provided JSON schema, containing only an array of the new levels.
    `,u=o.chats.create({model:"gemini-2.5-flash",history:s.aiChatHistory||[],config:{responseMimeType:"application/json",responseSchema:og}});try{const f=(await u.sendMessage({message:h})).text.trim(),x=JSON.parse(f),d=await u.getHistory();return{newLevels:x,history:d}}catch(l){throw console.error("Error generating more levels with AI:",l),l instanceof Error&&l.message.includes("SAFETY")?new Error("The request was blocked due to safety settings."):l}},hg=async(s,p,o)=>{const v=ds(),h=s.levels[p];if(!h)throw new Error("Invalid level index.");const u=h.deckIds.map(x=>{var d;return`- ${(d=o.find(T=>T.id===x))==null?void 0:d.name}`}).join(`
`),l=`
        You are an expert instructional designer. I need you to expand a specific level within an existing learning series.

        Series Topic: ${s.name}
        Level to expand: "${h.title}"

        This level currently contains the following decks:
        ${u||"(No decks yet)"}

        Please generate 1-2 NEW, unique decks that fit logically within this level and do not repeat the topics already covered.
        For each new deck, provide a name, description, and a suggested question count. Descriptions can include basic HTML (<b>, <i>).
        All generated content should prefer the metric system (e.g., meters, kilograms, Celsius).
        The entire output must conform to the provided JSON schema, containing only an array of the new decks.
    `,f=v.chats.create({model:"gemini-2.5-flash",history:s.aiChatHistory||[],config:{responseMimeType:"application/json",responseSchema:lg}});try{const d=(await f.sendMessage({message:l})).text.trim(),T=JSON.parse(d),b=await f.getHistory();return{newDecks:T,history:b}}catch(x){throw console.error("Error generating more decks with AI:",x),x instanceof Error&&x.message.includes("SAFETY")?new Error("The request was blocked due to safety settings."):x}},Ec=async(s,p,o)=>{const v=ds(),h=20,u=v.chats.create({model:"gemini-2.5-flash",history:s.aiChatHistory||[],config:{responseMimeType:"application/json",responseSchema:bo}});if(!s.aiChatHistory||s.aiChatHistory.length===0){const l=s.aiGenerationParams?$s(s.aiGenerationParams):`You are an expert instructional designer creating a learning series on the topic: "${s.name}".`,f=p.map(d=>`- ${d.name}: ${d.description}`).join(`
`),x=`
            ${l}
            I will ask you to generate questions for the following decks, one by one. Maintain context and avoid creating duplicate questions across the entire series.
            
            **Important Rule:** All generated content must prefer the metric system (e.g., meters, kilograms, Celsius).
            **HTML Formatting:** Use tags like \`<b>\`, \`<i>\`, and \`<ruby>\` for rich text formatting. For example, use <ruby>漢字<rt>かんじ</rt></ruby> for Japanese Kanji. This is highly encouraged for language-learning content.

            The decks we will populate are:
            ${f}
            
            For each request, you must respond with a JSON object containing a "questions" array.
        `;await u.sendMessage({message:x})}for(const l of p){const f=l.suggestedQuestionCount||15;let x=[];const d=Math.ceil(f/h);for(let T=0;T<d;T++){const b=Math.min(h,f-x.length);if(b<=0)break;const N=`
                Now, generate exactly ${b} unique, high-quality questions for the deck: "${l.name}".
                Description: "${l.description}".
                Ensure these are different from any questions you have generated previously in this conversation and align with the series context.
                Remember to prefer the metric system and use HTML formatting where appropriate.
            `;try{const I=(await u.sendMessage({message:N})).text.trim(),k=JSON.parse(I);if(!Array.isArray(k.questions))throw console.error(`AI response for deck "${l.name}" did not contain a valid 'questions' array. Response:`,I),new Error(`The AI returned an invalid data structure for deck "${l.name}".`);x.push(...k.questions)}catch(w){throw console.error(`Error generating questions for deck "${l.name}", batch ${T+1}:`,w),w instanceof Error&&w.message.includes("SAFETY")?new Error(`Request for "${l.name}" was blocked. Please try a different topic.`):new Error(`AI error for deck "${l.name}". Process stopped.`)}}o(l.id,x)}return await u.getHistory()},mg=async(s,p,o)=>{var u;const h=ds().chats.create({model:"gemini-2.5-flash",history:s.aiChatHistory||[],config:{responseMimeType:"application/json",responseSchema:cg}});if(!s.aiChatHistory||s.aiChatHistory.length===0){const l=s.aiGenerationParams?$s(s.aiGenerationParams):`You are an expert instructional designer creating a learning series on the topic: "${s.name}".`,f=p.map(d=>`- ${d.name}: ${d.description}`).join(`
`),x=`
            ${l}
            I will ask you to generate learning content (informational cards and related questions) for the following decks, one by one. Maintain context and ensure a logical progression of topics across the entire series.
            
            **Important Rule:** All generated content must prefer the metric system (e.g., meters, kilograms, Celsius).
            **HTML Formatting:** Use tags like \`<b>\`, \`<i>\`, \`<ul>\`, \`<li>\`, and \`<ruby>\` for rich text formatting.

            The decks we will populate are:
            ${f}
            
            For each request, you must respond with a JSON object containing a "learningContent" array.
        `;await h.sendMessage({message:x})}for(const l of p){const f={"Quick Overview":"3-5",Standard:"5-8",Comprehensive:"8-12",Exhaustive:"12-15"}[((u=l.aiGenerationParams)==null?void 0:u.comprehensiveness)||"Standard"]||"5-8",x=`
            Now, generate the learning content for the deck: "${l.name}".
            Description: "${l.description}".
            Create ${f} learning blocks. Each block should have an 'infoCardContent' and an array of 3-5 'questions' directly related to it.
            Ensure the content is unique and fits logically within the series.
        `;try{const T=(await h.sendMessage({message:x})).text.trim(),b=JSON.parse(T);if(!b.learningContent||!Array.isArray(b.learningContent))throw console.error(`AI response for learning deck "${l.name}" did not contain a valid 'learningContent' array. Response:`,T),new Error(`The AI returned an invalid data structure for learning deck "${l.name}".`);o(l.id,b.learningContent)}catch(d){throw console.error(`Error generating content for learning deck "${l.name}":`,d),d instanceof Error&&d.message.includes("SAFETY")?new Error(`Request for "${l.name}" was blocked. Please try a different topic.`):new Error(`AI error for deck "${l.name}". Process stopped.`)}}return await h.getHistory()},nh=async(s,p,o)=>{const v=ds();let h="This deck is currently empty.";s.questions&&s.questions.length>0&&(h=`This deck already contains the following questions. DO NOT create questions on these specific topics:
`+s.questions.map(x=>`- ${x.questionText}`).slice(0,50).join(`
`));let l=`You are an expert instructional designer. Your task is to generate a JSON object containing high-quality, unique questions for a flashcard deck.

**Deck Context:**
${s.aiGenerationParams?$s(s.aiGenerationParams):`**Main Topic:** ${s.name}`}`;if(o!=null&&o.series){o.series.aiGenerationParams&&(l+=`

**Overall Series Context:**
`+$s(o.series.aiGenerationParams));const x=o.allDecks.filter(d=>d.id!==s.id);x.length>0&&(l+=`
                
This deck is part of a larger series called "${o.series.name}".
                Be aware of the other decks in this series to avoid repetition:
                ${x.map(d=>`- ${d.name}: ${d.description}`).join(`
`)}
            `)}const f=`
        ${l}

        **Number of New Questions to Generate:** ${p}
        
        **Existing Questions in this Deck:**
        ${h}
        
        **Instructions & Quality Requirements:**
        1.  **Generate UNIQUE Content:** Create **${p} NEW and UNIQUE** questions that are not duplicates of the "Existing Questions" listed above.
        2.  **Factual Accuracy:** All information must be factually correct and verifiable.
        3.  **HTML Formatting:** Use HTML tags like \`<b>\`, \`<i>\`, and \`<ruby>\` for rich text formatting. For example, use <ruby>漢字<rt>かんじ</rt></ruby> for Japanese Kanji.
        4.  **In-Depth Explanations:** The \`detailedExplanation\` is crucial and must be thorough.
        5.  **Plausible Distractors:** Incorrect options should be plausible but clearly wrong.
        6.  **Metric System:** Prefer the metric system for all units.
        7.  The entire output must be a single JSON object conforming to the provided schema.
    `;try{const d=(await v.models.generateContent({model:"gemini-2.5-flash",contents:f,config:{responseMimeType:"application/json",responseSchema:bo}})).text.trim(),T=JSON.parse(d);if(!Array.isArray(T.questions))throw new Error("AI response did not contain a valid 'questions' array.");return T}catch(x){throw console.error("Error generating deck questions with AI:",x),x instanceof Error&&x.message.includes("SAFETY")?new Error("The request was blocked due to safety settings. Please try a different topic."):x}},pg=({sessionsToResume:s,setSessionsToResume:p,setGeneralStudyDeck:o,openConfirmModal:v,setFolderToEdit:h,setSeriesToEdit:u})=>{const{addToast:l}=er(),{navigate:f}=Ln(),x=Ke(te=>te.dispatch),d=U.useCallback(async(te,Y)=>{x({type:"UPDATE_DECK",payload:te}),Y!=null&&Y.silent||(Y!=null&&Y.toastMessage?l(Y.toastMessage,"success"):te.archived?l(`Deck "${te.name}" archived.`,"success"):te.archived===!1?l(`Deck "${te.name}" unarchived.`,"success"):l(`Deck "${te.name}" updated.`,"success"));try{await Bm(te)}catch(g){console.error("Failed to update deck:",g),l("There was an error syncing the deck update.","error")}},[l,x]),T=U.useCallback(async te=>{const Y=Ke.getState().decks.find(g=>g.id===te);if(Y){const g={...Y,lastOpened:new Date().toISOString()};await d(g,{silent:!0})}},[d]),b=U.useCallback(async(te,Y)=>{x({type:"UPDATE_SERIES",payload:te}),Y!=null&&Y.silent||(Y!=null&&Y.toastMessage?l(Y.toastMessage,"success"):te.archived?l(`Series "${te.name}" archived.`,"success"):te.archived===!1?l(`Series "${te.name}" unarchived.`,"success"):l(`Series "${te.name}" updated.`,"success"));try{await Vd(te)}catch(g){console.error("Failed to update series:",g),l("There was an error updating the series.","error")}},[l,x]),N=U.useCallback(async te=>{const Y=Ke.getState().deckSeries.find(g=>g.id===te);if(Y){const g={...Y,lastOpened:new Date().toISOString()};await b(g,{silent:!0})}},[b]),w=U.useCallback(async te=>{try{x({type:"ADD_DECKS",payload:te}),await ri(te)}catch(Y){console.error("Failed to add decks:",Y),l("There was an error saving the new deck(s).","error")}},[l,x]),I=U.useCallback(async(te,Y)=>{try{x({type:"ADD_SERIES_WITH_DECKS",payload:{series:te,decks:Y}}),await Promise.all([ri(Y),mo([te])]),l(`Successfully imported series "${te.name}" with ${Y.length} decks.`,"success")}catch(g){console.error("Failed to create series with decks:",g),l("There was an error creating the new series.","error")}},[x,l]),k=U.useCallback(async(te,Y)=>{const g=`session_deck_${te}`;if(s.has(te)){const ee=new Set(s);ee.delete(te),p(ee)}try{await vo(g)}catch(ee){console.error(`Failed to clean up session state for ${g} from DB`,ee)}te==="general-study-deck"&&o(null),f(Y?`/series/${Y}`:"/")},[f,s,p,o]),C=U.useCallback(async(te,Y,g)=>{const ee=`session_deck_${te}`;if(s.has(te)){const G=new Set(s);G.delete(te),p(G)}try{await vo(ee)}catch(G){console.error(`Failed to clean up session state for ${ee} from DB`,G)}te==="general-study-deck"&&o(null),f(`/decks/${g}/study?seriesId=${Y}`)},[f,s,p,o]),j=U.useCallback(async()=>{const te=Up();await w([te]),l(`Sample deck "${te.name}" created!`,"success")},[w,l]),O=U.useCallback(async()=>{const{series:te,decks:Y}=Pp();try{x({type:"ADD_SERIES_WITH_DECKS",payload:{series:te,decks:Y}}),await Promise.all([ri(Y),mo([te])]),l(`Sample series "${te.name}" created!`,"success")}catch(g){console.error("Failed to create sample series:",g),l("There was an error creating the sample series.","error")}},[l,x]),F=U.useCallback(async te=>{try{x({type:"RESTORE_DATA",payload:te}),await Promise.all([ri(te.decks),$m(te.folders),mo(te.deckSeries)]),l("Successfully restored data.","success")}catch(Y){throw console.error("Failed to restore from backup:",Y),l("There was an error restoring from the backup file.","error"),Y}},[l,x]),R=U.useCallback(async te=>{const Y=Ke.getState().decks.find(ee=>ee.id===te);if(!Y)return;const g={...Y,deletedAt:new Date().toISOString(),archived:!1};await d(g,{toastMessage:`Moved "${Y.name}" to Trash.`})},[d]),M=U.useCallback(async(te,Y)=>{const{decks:g,folders:ee}=Ke.getState(),G=g.find(X=>X.id===te),P=ee.find(X=>X.id===Y);if(!G||G.folderId===Y)return;const L={...G,folderId:Y},q=P?`"${P.name}"`:"the ungrouped area";await d(L,{toastMessage:`Moved "${G.name}" to ${q}.`})},[d]),H=U.useCallback(async(te,Y,g,ee)=>{const{decks:G,deckSeries:P,seriesProgress:L}=Ke.getState(),q=G.find(et=>et.id===te);if(!q)return;let X;const{id:se,dueDate:Q,interval:ue,easeFactor:Ie,suspended:ye,masteryLevel:Ce,lastReviewed:Be,lapses:$e}=Y,ct={dueDate:Q,interval:ue,easeFactor:Ie,suspended:ye,masteryLevel:Ce,lastReviewed:Be,lapses:$e};q.type===Ae.Flashcard?X={...q,cards:q.cards.map(et=>et.id===se?{...et,...ct}:et)}:q.type===Ae.Learning?X={...q,questions:q.questions.map(et=>et.id===se?{...et,...ct}:et)}:X={...q,questions:q.questions.map(et=>et.id===se?{...et,...ct}:et)},await d(X,{silent:!0});try{const et={itemId:Y.id,deckId:te,seriesId:ee,timestamp:new Date().toISOString(),rating:g,newInterval:Y.interval,easeFactor:Y.easeFactor,masteryLevel:Y.masteryLevel||0};await Km(et)}catch(et){console.error("Failed to log review:",et)}if(ee){const et=X,pt="cards"in et?et.cards:et.questions,qt=Array.isArray(pt)&&pt.some(jt=>!jt.suspended&&jt.interval===0),ft=(L.get(ee)||new Set).has(te);if(!qt&&!ft&&(pt==null?void 0:pt.length)>0){const jt=new Map(L),gr=jt.get(ee),Ct=new Set(gr instanceof Set?gr:[]);Ct.add(te),jt.set(ee,Ct);try{localStorage.setItem(`series-progress-${ee}`,JSON.stringify(Array.from(Ct)));const Mt=P.find(ar=>ar.id===ee),tt=(Mt==null?void 0:Mt.levels.flatMap(ar=>ar.deckIds))||[];tt.indexOf(te)===tt.length-1&&tt.length>0?l(`Congratulations! You've completed the series: "${Mt==null?void 0:Mt.name}"!`,"success"):l(`Deck "${et.name}" completed! Next chapter unlocked.`,"success"),x({type:"SET_SERIES_PROGRESS",payload:jt})}catch(Mt){console.error("Could not save series progress",Mt)}}}},[d,l,x]),V=U.useCallback(async te=>{const Y=Ke.getState().decks.find(ee=>ee.id===te);if(!Y)return;let g;Y.type===Ae.Flashcard?g={...Y,cards:Y.cards.map(ee=>rf(ee))}:g={...Y,questions:Y.questions.map(ee=>rf(ee))},await d(g,{toastMessage:`Progress for deck "${g.name}" has been reset.`})},[d]),oe=async()=>{try{const te=await ep();te&&l(`Data exported to ${te}`,"success")}catch(te){const Y=te instanceof Error?te.message:"Unknown error";l(`Export failed: ${Y}`,"error")}},J=U.useCallback(()=>{const{decks:te,deckSeries:Y,seriesProgress:g}=Ke.getState(),ee=new Set;Y.forEach(X=>{X.levels.forEach(se=>se.deckIds.forEach(Q=>ee.add(Q)))});const G=new Set;Y.forEach(X=>{var se;if(!X.archived&&!X.deletedAt){const Q=((se=g.get(X.id))==null?void 0:se.size)||0;let ue=0;X.levels.forEach(Ie=>{Ie.deckIds.forEach(ye=>{ue<=Q&&G.add(ye),ue++})})}});const P=new Date;P.setHours(23,59,59,999);const L=te.filter(X=>!(X.type!==Ae.Quiz||X.archived||X.deletedAt||ee.has(X.id)&&!G.has(X.id))).flatMap(X=>X.questions.filter(se=>!se.suspended&&new Date(se.dueDate)<=P).map(se=>({...se,originalDeckId:X.id,originalDeckName:X.name}))).sort(()=>Math.random()-.5),q={id:"general-study-deck",name:"General Study Session",type:Ae.Quiz,questions:L};o(q),f("/study/general")},[f,o]),Z=U.useCallback(async te=>{var Ie;const{decks:Y,deckSeries:g,seriesProgress:ee}=Ke.getState(),G=g.find(ye=>ye.id===te);if(!G)return;const P=new Set,L=((Ie=ee.get(G.id))==null?void 0:Ie.size)||0;let q=0;G.levels.forEach(ye=>{ye.deckIds.forEach(Ce=>{q<=L&&P.add(Ce),q++})});const X=new Date;X.setHours(23,59,59,999);const Q=G.levels.flatMap(ye=>ye.deckIds).map(ye=>Y.find(Ce=>Ce.id===ye)).filter(ye=>!!(ye&&ye.type===Ae.Quiz)).filter(ye=>P.has(ye.id)).flatMap(ye=>ye.questions.filter(Ce=>!Ce.suspended&&new Date(Ce.dueDate)<=X).map(Ce=>({...Ce,originalDeckId:ye.id,originalDeckName:ye.name}))).sort(()=>Math.random()-.5),ue={id:"general-study-deck",name:`${G.name} - Study Session`,type:Ae.Quiz,questions:Q};o(ue),f(`/study/general?seriesId=${te}`)},[f,o]),de=U.useCallback(async te=>{if(te.id){const Y={id:te.id,name:te.name};x({type:"UPDATE_FOLDER",payload:Y}),l(`Folder "${Y.name}" updated.`,"success"),await Hm(Y)}else{const Y={id:crypto.randomUUID(),name:te.name};x({type:"ADD_FOLDER",payload:Y}),l(`Folder "${Y.name}" created.`,"success"),await Gm(Y)}h(null)},[l,x,h]),$=U.useCallback(async te=>{const{folders:Y,decks:g}=Ke.getState(),ee=Y.find(G=>G.id===te);ee&&v({title:"Delete Folder",message:`Are you sure you want to delete folder "${ee.name}"? Decks inside will not be deleted.`,onConfirm:async()=>{x({type:"DELETE_FOLDER",payload:te}),l(`Folder "${ee.name}" deleted.`,"success");const G=g.filter(P=>P.folderId===te).map(P=>({...P,folderId:null}));G.length>0&&await Qd(G),await Wm(te)}})},[l,x,v]),W=U.useCallback(async te=>{if(te.id){const Y=Ke.getState().deckSeries.find(g=>g.id===te.id);if(Y){const g={...Y,name:te.name,description:te.description};await b(g)}}else if(te.scaffold&&Array.isArray(te.scaffold.levels)){const{levels:Y}=te.scaffold,g=[],ee=Y.map(P=>{const L=(P.decks||[]).map(q=>({id:crypto.randomUUID(),name:q.name,description:q.description,type:Ae.Quiz,questions:wr(Array.isArray(q.questions)?q.questions:[])}));return g.push(...L),{title:P.title,deckIds:L.map(q=>q.id)}}),G={id:crypto.randomUUID(),type:"series",name:te.name,description:te.description,levels:ee,archived:!1,createdAt:new Date().toISOString()};await I(G,g),l(`Series "${G.name}" created from scaffold.`,"success"),f(`/series/${G.id}?edit=true`)}else{const Y={id:crypto.randomUUID(),type:"series",name:te.name,description:te.description,levels:[],createdAt:new Date().toISOString()};x({type:"ADD_SERIES",payload:Y}),l(`Series "${Y.name}" created.`,"success"),await mo([Y]),f(`/series/${Y.id}?edit=true`)}u(null)},[l,b,x,u,f,I]),_=U.useCallback(async te=>{const{deckSeries:Y,decks:g}=Ke.getState(),ee=Y.find(q=>q.id===te);if(!ee)return;const G=ee.levels.flatMap(q=>q.deckIds),P=g.filter(q=>G.includes(q.id)).map(q=>({...q,deletedAt:new Date().toISOString(),archived:!1})),L={...ee,deletedAt:new Date().toISOString(),archived:!1};x({type:"BULK_UPDATE_DECKS",payload:P}),x({type:"UPDATE_SERIES",payload:L}),l(`Series "${ee.name}" and its ${P.length} deck(s) moved to Trash.`,"success");try{await Promise.all([Qd(P),Vd(L)])}catch(q){console.error("Failed to move series and its decks to trash:",q),l("Error moving series to trash.","error")}},[x,l]),ie=U.useCallback(async(te,Y)=>{const g=Ke.getState().deckSeries.find(P=>P.id===te);if(!g)return;await w([Y]);const ee={title:Y.name,deckIds:[Y.id]},G={...g,levels:[...g.levels,ee]};await b(G)},[w,b]),be=U.useCallback(async te=>{const Y=Ke.getState().decks.find(G=>G.id===te);if(!Y)return;const{deletedAt:g,...ee}=Y;await d(ee,{toastMessage:`Restored deck "${ee.name}".`})},[d]),ge=U.useCallback(async te=>{const Y=Ke.getState().deckSeries.find(G=>G.id===te);if(!Y)return;const{deletedAt:g,...ee}=Y;await b(ee,{toastMessage:`Restored series "${ee.name}".`})},[b]),je=U.useCallback(async te=>{var Y;try{const g=(Y=Ke.getState().decks.find(ee=>ee.id===te))==null?void 0:Y.name;x({type:"DELETE_DECK",payload:te}),l(`Deck "${g||"Deck"}" permanently deleted.`,"success"),await Yd(te)}catch(g){console.error("Failed to permanently delete deck:",g),l("There was an error permanently deleting the deck.","error")}},[x,l]),fe=U.useCallback(async te=>{const Y=Ke.getState().deckSeries.find(G=>G.id===te);if(!Y)return;const g=Y.levels.flatMap(G=>G.deckIds),ee=Y.name;try{g.forEach(G=>{x({type:"DELETE_DECK",payload:G})}),x({type:"DELETE_SERIES",payload:te}),l(`Series "${ee}" and its ${g.length} deck(s) permanently deleted.`,"success"),await Promise.all([...g.map(G=>Yd(G)),Qm(te)])}catch(G){console.error("Failed to permanently delete series and its decks:",G),l("There was an error permanently deleting the series.","error")}},[x,l]),B=U.useCallback(()=>{v({title:"Factory Reset",message:"Are you sure you want to perform a factory reset? All of your decks, folders, series, and settings will be permanently deleted. This action cannot be undone.",confirmText:"RESET",onConfirm:async()=>{try{l("Resetting application...","info"),navigator.serviceWorker&&navigator.serviceWorker.controller&&(navigator.serviceWorker.controller.postMessage({type:"CLEAR_APP_CACHE"}),navigator.serviceWorker.controller.postMessage({type:"CLEAR_CDN_CACHE"})),await tp();const te=[];for(let Y=0;Y<localStorage.length;Y++){const g=localStorage.key(Y);g&&(g.startsWith("cogniflow-")||g.startsWith("session_deck_")||g.startsWith("series-progress-"))&&te.push(g)}te.forEach(Y=>localStorage.removeItem(Y)),setTimeout(()=>{window.location.reload()},1500)}catch(te){console.error("Factory reset failed:",te);const Y=te instanceof Error?te.message:"Factory reset failed. Please try again.";l(Y,"error")}}})},[l,v]),S=U.useCallback(()=>{const{deckSeries:te,decks:Y,seriesProgress:g}=Ke.getState();if(!te.length||!Y.length)return;let ee=!1;const G=new Map(g);for(const P of te){if(P.archived||P.deletedAt)continue;const L=G.get(P.id),q=new Set(L instanceof Set?L:[]);let X=!1;const se=P.levels.flatMap(Q=>Q.deckIds);for(const Q of se){if(q.has(Q))continue;const ue=Y.find(Ce=>Ce.id===Q);if(!ue)continue;const Ie=ue.type===Ae.Quiz?ue.questions:ue.cards;!Ie.some(Ce=>!Ce.suspended&&Ce.interval===0)&&Ie.length>0&&(q.add(Q),X=!0)}X&&(G.set(P.id,q),ee=!0)}ee&&(G.forEach((P,L)=>{try{P instanceof Set&&localStorage.setItem(`series-progress-${L}`,JSON.stringify(Array.from(P)))}catch(q){console.error(`Could not save reconciled series progress for ${L}`,q)}}),l("Unlocked decks based on your progress.","info"),x({type:"SET_SERIES_PROGRESS",payload:G}))},[l,x]),A=U.useCallback(async te=>{const{aiGenerationStatus:Y}=Ke.getState();if(Y.isGenerating){l("An AI generation task is already in progress. Please wait for it to complete.","info");return}const{generationType:g,generateQuestions:ee,isLearningMode:G,...P}=te,L=`Initializing AI generation for '${te.topic}'...`;x({type:"SET_AI_GENERATION_STATUS",payload:{isGenerating:!0,statusText:L,generatingDeckId:null,generatingSeriesId:null}});try{if(g==="series"){x({type:"SET_AI_GENERATION_STATUS",payload:{isGenerating:!0,statusText:`Generating series outline for '${te.topic}'...`,generatingDeckId:null,generatingSeriesId:null}});const q=await ug(P),X=[],se=q.levels.map(ue=>{const Ie=ue.decks.map(ye=>{const Ce={id:crypto.randomUUID(),name:ye.name,description:ye.description,questions:[],suggestedQuestionCount:ye.suggestedQuestionCount,aiGenerationParams:P};return G?{...Ce,type:Ae.Learning,infoCards:[]}:{...Ce,type:Ae.Quiz}});return X.push(...Ie),{title:ue.title,deckIds:Ie.map(ye=>ye.id)}}),Q={id:crypto.randomUUID(),type:"series",name:q.seriesName,description:q.seriesDescription,levels:se,createdAt:new Date().toISOString(),aiGenerationParams:P};if(await I(Q,X),ee&&X.length>0)if(G){const ue=X.filter(ye=>ye.type===Ae.Learning);x({type:"SET_AI_GENERATION_STATUS",payload:{isGenerating:!0,statusText:"Preparing to generate learning content...",generatingDeckId:null,generatingSeriesId:Q.id}});const Ie=await mg(Q,ue,(ye,Ce)=>{const $e=Ke.getState().decks.find(ct=>ct.id===ye);if($e&&$e.type===Ae.Learning){const ct=[],et=[];(Ce||[]).forEach(jt=>{const gr=crypto.randomUUID(),Ct=[];wr(Array.isArray(jt.questions)?jt.questions:[]).forEach(tt=>{const Wt={...tt,id:crypto.randomUUID(),dueDate:new Date().toISOString(),interval:0,easeFactor:2.5,infoCardIds:[gr]};Ct.push(Wt.id),et.push(Wt)}),ct.push({id:gr,content:jt.infoCardContent,unlocksQuestionIds:Ct})});const pt={...$e,questions:et,infoCards:ct};d(pt,{silent:!0});const qt=ue.findIndex(jt=>jt.id===ye)+1,ft=`Generating content for '${$e.name}' (${qt} of ${ue.length})...`;x({type:"SET_AI_GENERATION_STATUS",payload:{isGenerating:!0,statusText:ft,generatingDeckId:$e.id,generatingSeriesId:Q.id}})}});b({...Q,aiChatHistory:Ie},{silent:!0}),l(`Successfully generated all content for "${Q.name}"!`,"success")}else{const ue=X.filter(ye=>ye.type===Ae.Quiz);x({type:"SET_AI_GENERATION_STATUS",payload:{isGenerating:!0,statusText:"Preparing to generate questions...",generatingDeckId:null,generatingSeriesId:Q.id}});const Ie=await Ec(Q,ue,(ye,Ce)=>{const Be=wr(Ce),ct=Ke.getState().decks.find(et=>et.id===ye);if(ct&&ct.type===Ae.Quiz){const et={...ct,questions:Be};d(et,{silent:!0});const pt=ue.findIndex(ft=>ft.id===ye)+1,qt=`Generating questions for '${ct.name}' (${pt} of ${ue.length})...`;x({type:"SET_AI_GENERATION_STATUS",payload:{isGenerating:!0,statusText:qt,generatingDeckId:ct.id,generatingSeriesId:Q.id}})}});b({...Q,aiChatHistory:Ie},{silent:!0}),l(`Successfully generated all questions for "${Q.name}"!`,"success")}else l(`Successfully created series scaffold "${Q.name}"!`,"success")}else if(g==="deck")if(G){x({type:"SET_AI_GENERATION_STATUS",payload:{isGenerating:!0,statusText:`Generating learning deck: '${te.topic}'...`,generatingDeckId:null,generatingSeriesId:null}});const q=await rh(P),X=[],se=[];(q.learningContent||[]).forEach(ue=>{const Ie=crypto.randomUUID(),ye=[];wr(Array.isArray(ue.questions)?ue.questions:[]).forEach(Be=>{const $e={...Be,id:crypto.randomUUID(),dueDate:new Date().toISOString(),interval:0,easeFactor:2.5,infoCardIds:[Ie]};ye.push($e.id),se.push($e)}),X.push({id:Ie,content:ue.infoCardContent,unlocksQuestionIds:ye})});const Q={id:crypto.randomUUID(),name:q.name,description:q.description,type:Ae.Learning,infoCards:X,questions:se,aiGenerationParams:P};await w([Q]),l(`Successfully generated learning deck "${Q.name}"!`,"success")}else{x({type:"SET_AI_GENERATION_STATUS",payload:{isGenerating:!0,statusText:`Generating deck: '${te.topic}'...`,generatingDeckId:null,generatingSeriesId:null}});const q=await dg(P),X={id:crypto.randomUUID(),name:q.name,description:q.description,type:Ae.Quiz,questions:wr(q.questions),aiGenerationParams:P};await w([X]),l(`Successfully generated deck "${X.name}"!`,"success")}}catch(q){const X=q instanceof Error?q.message:"An unknown error occurred during AI generation.";throw l(X,"error"),q}finally{x({type:"SET_AI_GENERATION_STATUS",payload:{isGenerating:!1,statusText:null,generatingDeckId:null,generatingSeriesId:null}})}},[x,l,I,w,d,b]),ce=U.useCallback(async te=>{const{decks:Y,deckSeries:g,aiGenerationStatus:ee}=Ke.getState();if(ee.isGenerating){l("An AI generation task is already in progress.","info");return}const G=te.suggestedQuestionCount||15,P=`Generating ${G} questions for "${te.name}"...`;x({type:"SET_AI_GENERATION_STATUS",payload:{isGenerating:!0,statusText:P,generatingDeckId:te.id,generatingSeriesId:null}});const L=g.find(X=>X.levels.some(se=>se.deckIds.includes(te.id)));let q;if(L){const X=L.levels.flatMap(se=>se.deckIds).map(se=>Y.find(Q=>Q.id===se)).filter(se=>!!(se&&se.type===Ae.Quiz));q={series:L,allDecks:X}}try{const{questions:X}=await nh(te,G,q);if(!X||X.length===0){l("The AI didn't return any questions. Please try again.","info");return}const se=wr(X),Q=Ke.getState().decks.find(Ie=>Ie.id===te.id);if(!Q||Q.type!==Ae.Quiz)throw new Error("Deck not found or is not a quiz deck.");const ue=[...Q.questions,...se];await d({...Q,questions:ue}),l(`Successfully added ${se.length} AI-generated questions to "${te.name}"!`,"success")}catch(X){const se=X instanceof Error?X.message:"An unknown error occurred during AI generation.";l(se,"error")}finally{Ke.getState().aiGenerationStatus.generatingDeckId===te.id&&x({type:"SET_AI_GENERATION_STATUS",payload:{isGenerating:!1,statusText:null,generatingDeckId:null,generatingSeriesId:null}})}},[l,d,x]),pe=U.useCallback(async te=>{const{aiGenerationStatus:Y}=Ke.getState();if(Y.isGenerating){l("An AI generation task is already in progress.","info");return}const g=te.aiGenerationParams;if(!g){l("Cannot generate content: original generation parameters are missing.","error");return}const ee=`Generating content for "${te.name}"...`;x({type:"SET_AI_GENERATION_STATUS",payload:{isGenerating:!0,statusText:ee,generatingDeckId:te.id,generatingSeriesId:null}});try{const G=await rh(g),P=[],L=[];(G.learningContent||[]).forEach(X=>{const se=crypto.randomUUID(),Q=[];wr(Array.isArray(X.questions)?X.questions:[]).forEach(Ie=>{const ye={...Ie,id:crypto.randomUUID(),dueDate:new Date().toISOString(),interval:0,easeFactor:2.5,infoCardIds:[se]};Q.push(ye.id),L.push(ye)}),P.push({id:se,content:X.infoCardContent,unlocksQuestionIds:Q})});const q={...te,infoCards:P,questions:L};await d(q,{toastMessage:`Successfully generated content for "${te.name}"!`})}catch(G){const P=G instanceof Error?G.message:"An unknown error occurred during AI generation.";l(P,"error")}finally{Ke.getState().aiGenerationStatus.generatingDeckId===te.id&&x({type:"SET_AI_GENERATION_STATUS",payload:{isGenerating:!1,statusText:null,generatingDeckId:null,generatingSeriesId:null}})}},[l,d,x]),me=U.useCallback(async te=>{const{deckSeries:Y,decks:g}=Ke.getState(),ee=Y.find(se=>se.id===te);if(!ee)throw new Error("Series not found");const{newLevels:G,history:P}=await fg(ee,g.filter(se=>se.type==="quiz"));if(!G||G.length===0){l("The AI didn't suggest any new levels.","info");return}const L=[],q=G.map(se=>{const Q=(se.decks||[]).map(ue=>({id:crypto.randomUUID(),name:ue.name,description:ue.description,type:Ae.Quiz,questions:[],suggestedQuestionCount:ue.suggestedQuestionCount}));return L.push(...Q),{title:se.title,deckIds:Q.map(ue=>ue.id)}}),X={...ee,levels:[...ee.levels,...q],aiChatHistory:P};await w(L),await b(X,{toastMessage:`Added ${q.length} new level(s) to "${ee.name}"!`})},[w,b,l]),Te=U.useCallback(async(te,Y)=>{const{deckSeries:g,decks:ee}=Ke.getState(),G=g.find(Q=>Q.id===te);if(!G)throw new Error("Series not found");const{newDecks:P,history:L}=await hg(G,Y,ee.filter(Q=>Q.type==="quiz"));if(!P||P.length===0){l("The AI didn't suggest any new decks for this level.","info");return}const q=P.map(Q=>({id:crypto.randomUUID(),name:Q.name,description:Q.description,type:Ae.Quiz,questions:[],suggestedQuestionCount:Q.suggestedQuestionCount}));await w(q);const X=JSON.parse(JSON.stringify(G)),se=q.map(Q=>Q.id);X.levels[Y].deckIds.push(...se),X.aiChatHistory=L,await b(X,{toastMessage:`Added ${q.length} new deck(s) to "${G.levels[Y].title}"!`})},[w,b,l]),he=U.useCallback(async te=>{const{decks:Y,folders:g,deckSeries:ee}=Ke.getState();switch(te.action){case Pr.CREATE_DECK:{const{name:G,folderId:P}=te.payload,L={id:crypto.randomUUID(),name:G,description:"Generated by AI Assistant",type:Ae.Quiz,questions:[],folderId:P||void 0};await w([L]),l(`Deck "${G}" created!`,"success");break}case Pr.RENAME_DECK:{const{deckId:G,newName:P}=te.payload,L=Y.find(q=>q.id===G);L?await d({...L,name:P},{toastMessage:`Renamed deck to "${P}".`}):l("Could not find deck to rename.","error");break}case Pr.MOVE_DECK_TO_FOLDER:{const{deckId:G,folderId:P}=te.payload;await M(G,P);break}case Pr.DELETE_DECK:{const{deckId:G}=te.payload;await R(G);break}case Pr.CREATE_FOLDER:{const{name:G}=te.payload;await de({id:null,name:G});break}case Pr.RENAME_FOLDER:{const{folderId:G,newName:P}=te.payload;await de({id:G,name:P});break}case Pr.DELETE_FOLDER:{const{folderId:G}=te.payload;g.find(L=>L.id===G)?await $(G):l("Could not find folder to delete.","error");break}case Pr.EXPAND_SERIES_ADD_LEVELS:{const{seriesId:G}=te.payload;await me(G);break}case Pr.EXPAND_SERIES_ADD_DECKS:{const{seriesId:G,levelIndex:P}=te.payload;await Te(G,P);break}case Pr.GENERATE_QUESTIONS_FOR_DECK:{const{deckId:G,count:P}=te.payload,{decks:L,deckSeries:q,aiGenerationStatus:X,dispatch:se}=Ke.getState(),Q=L.find(Ce=>Ce.id===G);if(!Q||Q.type!==Ae.Quiz){l("Could not find a valid quiz deck to add questions to.","error");return}if(X.isGenerating){l("An AI generation task is already in progress.","info");return}const ue=P||Q.suggestedQuestionCount||15;se({type:"SET_AI_GENERATION_STATUS",payload:{isGenerating:!0,statusText:`Generating ${ue} questions...`,generatingDeckId:Q.id,generatingSeriesId:null}});const Ie=q.find(Ce=>Ce.levels.some(Be=>Be.deckIds.includes(Q.id)));let ye;if(Ie){const Ce=Ie.levels.flatMap(Be=>Be.deckIds).map(Be=>L.find($e=>$e.id===Be)).filter(Be=>!!(Be&&Be.type===Ae.Quiz));ye={series:Ie,allDecks:Ce}}try{const{questions:Ce}=await nh(Q,ue,ye);if(!Ce||Ce.length===0){l("The AI didn't return any questions. Please try again.","info"),se({type:"SET_AI_GENERATION_STATUS",payload:{isGenerating:!1,statusText:null,generatingDeckId:null,generatingSeriesId:null}});return}const Be=wr(Ce),$e=[...Q.questions,...Be];await d({...Q,questions:$e}),l(`Successfully added ${Be.length} AI-generated questions to "${Q.name}"!`,"success")}catch(Ce){const Be=Ce instanceof Error?Ce.message:"An unknown error occurred during AI generation.";l(Be,"error")}finally{Ke.getState().aiGenerationStatus.generatingDeckId===Q.id&&se({type:"SET_AI_GENERATION_STATUS",payload:{isGenerating:!1,statusText:null,generatingDeckId:null,generatingSeriesId:null}})}break}case Pr.NO_ACTION:break}},[l,w,R,$,M,de,d,Te,me]),Se=U.useCallback(async te=>{const{aiGenerationStatus:Y,deckSeries:g,decks:ee}=Ke.getState();if(Y.isGenerating){l("An AI generation task is already in progress.","info");return}const G=g.find(q=>q.id===te);if(!G){l("Could not find the series.","error");return}const P=new Set(G.levels.flatMap(q=>q.deckIds)),L=ee.filter(q=>{var X;return P.has(q.id)&&q.type===Ae.Quiz&&(((X=q.questions)==null?void 0:X.length)||0)===0});if(L.length===0){l("All quiz decks in this series already have questions.","info");return}x({type:"SET_AI_GENERATION_STATUS",payload:{isGenerating:!0,generatingDeckId:L[0].id,generatingSeriesId:G.id,statusText:`Generating questions for ${L.length} empty decks...`}}),l(`AI is generating questions for ${L.length} empty decks. This will continue in the background.`,"info"),(async()=>{try{const q=await Ec(G,L,(X,se)=>{const Q=wr(se),ue=Ke.getState().decks.find(Ce=>Ce.id===X);if(ue&&(ue.type===Ae.Quiz||ue.type===Ae.Learning)){const Ce={...ue,questions:Q};d(Ce,{silent:!0})}const Ie=L.findIndex(Ce=>Ce.id===X),ye=L[Ie+1];ye&&x({type:"SET_AI_GENERATION_STATUS",payload:{isGenerating:!0,generatingDeckId:ye.id,generatingSeriesId:G.id,statusText:`Generating questions for "${ye.name}"...`}})});b({...G,aiChatHistory:q},{silent:!0}),l("Successfully generated questions for all empty decks!","success")}catch(q){const X=q instanceof Error?q.message:"An unknown error occurred during AI generation.";l(X,"error")}finally{Ke.getState().aiGenerationStatus.generatingSeriesId===G.id&&x({type:"SET_AI_GENERATION_STATUS",payload:{isGenerating:!1,generatingDeckId:null,generatingSeriesId:null,statusText:null}})}})()},[l,x,d,b]),Ee=U.useCallback(()=>{x({type:"CANCEL_AI_GENERATION"}),l("AI generation cancelled.","info")},[x,l]),Le=U.useCallback(async(te,Y)=>{const g=Ke.getState().decks.find(Q=>Q.id===te);if(!g||g.type!==Ae.Learning){l("Invalid deck type for saving a learning block.","error");return}const{infoCard:ee,questions:G}=Y,L=g.infoCards.some(Q=>Q.id===ee.id)?g.infoCards.map(Q=>Q.id===ee.id?ee:Q):[...g.infoCards,ee],X=[...g.questions.filter(Q=>{var ue;return!((ue=Q.infoCardIds)!=null&&ue.includes(ee.id))}),...G];X.forEach(Q=>{var ue;G.some(Ie=>Ie.id===Q.id)&&((ue=Q.infoCardIds)!=null&&ue.includes(ee.id)||(Q.infoCardIds=[...Q.infoCardIds||[],ee.id]))});const se={...g,infoCards:L,questions:X};await d(se,{toastMessage:"Learning block saved."})},[d,l]),qe=U.useCallback(async(te,Y)=>{const g=Ke.getState().decks.find(ee=>ee.id===te);!g||g.type!==Ae.Learning||v({title:"Delete Learning Block",message:"Are you sure you want to delete this info card and all of its associated questions? This action cannot be undone.",onConfirm:async()=>{const ee={...g,infoCards:g.infoCards.filter(G=>G.id!==Y),questions:g.questions.filter(G=>{var P;return!((P=G.infoCardIds)!=null&&P.includes(Y))})};await d(ee,{toastMessage:"Learning block deleted."})}})},[d,v]);return{updateLastOpened:T,updateLastOpenedSeries:N,handleSessionEnd:k,handleAddDecks:w,handleCreateSampleDeck:j,handleCreateSampleSeries:O,handleRestoreData:F,handleDeleteDeck:R,handleUpdateDeck:d,handleMoveDeck:M,handleItemReviewed:H,handleExportData:oe,handleResetDeckProgress:V,handleFactoryReset:B,handleStartGeneralStudy:J,handleStartSeriesStudy:Z,handleSaveFolder:de,handleDeleteFolder:$,handleUpdateSeries:b,handleSaveSeries:W,handleDeleteSeries:_,handleAddDeckToSeries:ie,handleAddSeriesWithDecks:I,handleRestoreDeck:be,handleRestoreSeries:ge,handleDeleteDeckPermanently:je,handleDeleteSeriesPermanently:fe,reconcileSeriesProgress:S,handleAiAddLevelsToSeries:me,handleAiAddDecksToLevel:Te,handleStudyNextDeckInSeries:C,handleExecuteAIAction:he,handleGenerateWithAI:A,handleGenerateQuestionsForDeck:ce,handleGenerateContentForLearningDeck:pe,handleGenerateQuestionsForEmptyDecksInSeries:Se,handleCancelAIGeneration:Ee,handleSaveLearningBlock:Le,handleDeleteLearningBlock:qe}},go=120,gg=()=>{const[s,p]=U.useState({startY:0,pullDistance:0,isRefreshing:!1,thresholdMet:!1}),{hapticsEnabled:o}=on(),v=U.useCallback(l=>{window.scrollY===0?p(f=>({...f,startY:l.touches[0].clientY,pullDistance:0,isRefreshing:!1,thresholdMet:!1})):p(f=>({...f,startY:0}))},[]),h=U.useCallback(l=>{if(s.startY===0)return;const f=l.touches[0].clientY-s.startY;f>5&&(l.preventDefault(),f>go&&!s.thresholdMet&&o&&"vibrate"in navigator&&navigator.vibrate(50),p(d=>({...d,pullDistance:f,thresholdMet:f>go})))},[s.startY,s.thresholdMet,o]),u=U.useCallback(()=>{s.startY!==0&&(s.pullDistance>go?(p(l=>({...l,isRefreshing:!0})),setTimeout(()=>{window.location.reload()},500)):p({startY:0,pullDistance:0,isRefreshing:!1,thresholdMet:!1}))},[s.startY,s.pullDistance]);return{pullToRefreshState:s,handleTouchStart:v,handleTouchMove:h,handleTouchEnd:u,REFRESH_THRESHOLD:go}},xg=({onOpenMenu:s,onOpenCommandPalette:p,activeDeck:o})=>{const{path:v,navigate:h}=Ln();let u;const[l]=v.split("?"),f=r.jsx("span",{className:"text-xl font-bold text-transparent bg-clip-text bg-gradient-to-r from-blue-400 to-teal-300",children:"CogniFlow"}),x=o==null?void 0:o.id;if(l.startsWith("/decks/")&&l.endsWith("/study")){const d=new URLSearchParams(window.location.hash.split("?")[1]).get("seriesId"),T=x?`/decks/${x}?${d?`seriesId=${d}`:""}`:d?`/series/${d}`:"/decks";u=r.jsxs(ve,{variant:"ghost",onClick:()=>h(T),className:"flex items-center space-x-2 -ml-3 min-w-0",children:[r.jsx(ae,{name:"chevron-left"}),r.jsx("span",{className:"truncate",children:(o==null?void 0:o.name)||"Back"})]})}else if(l.startsWith("/decks/")){const d=new URLSearchParams(window.location.hash.split("?")[1]).get("seriesId");d?u=r.jsxs(ve,{variant:"ghost",onClick:()=>h(`/series/${d}`),className:"flex items-center space-x-2 -ml-3",children:[r.jsx(ae,{name:"chevron-left"}),r.jsx("span",{children:"Back to Series"})]}):u=r.jsxs(ve,{variant:"ghost",onClick:()=>h("/decks"),className:"flex items-center space-x-2 -ml-3",children:[r.jsx(ae,{name:"chevron-left"}),r.jsx("span",{children:"All Decks"})]})}else l.startsWith("/series/")?u=r.jsxs(ve,{variant:"ghost",onClick:()=>h("/series"),className:"flex items-center space-x-2 -ml-3",children:[r.jsx(ae,{name:"chevron-left"}),r.jsx("span",{children:"All Series"})]}):l==="/study/general"||["/settings","/instructions/json","/archive","/trash","/decks","/series","/progress"].includes(l)?u=r.jsxs(ve,{variant:"ghost",onClick:()=>h("/"),className:"flex items-center space-x-2 -ml-3",children:[r.jsx(ae,{name:"chevron-left"}),f]}):u=r.jsx(Ut,{href:"/",className:"no-underline",children:r.jsx("h1",{className:"text-2xl font-bold text-transparent bg-clip-text bg-gradient-to-r from-blue-400 to-teal-300",children:"CogniFlow"})});return r.jsx("header",{className:"bg-surface/80 backdrop-blur-sm sticky top-0 z-20 border-b border-border",children:r.jsxs("nav",{className:"container mx-auto px-4 sm:px-6 lg:px-8 flex items-center justify-between h-16",children:[r.jsx("div",{className:"flex items-center flex-1 min-w-0",children:u}),r.jsxs("div",{className:"flex items-center space-x-1",children:[r.jsx(ve,{variant:"ghost",onClick:p,className:"p-1 h-auto","aria-label":"Open command palette",children:r.jsx(ae,{name:"search"})}),r.jsx(ve,{variant:"ghost",onClick:s,className:"p-1 h-auto","aria-label":"Open menu",children:r.jsx(ae,{name:"menu"})})]})]})})},Gs=({html:s,className:p,as:o="div"})=>{const v=`html-container-${ni.useId()}`;return ni.useEffect(()=>{const h=document.getElementById(v);if(!h)return;const u=Array.from(h.getElementsByTagName("script")),l=[];return u.forEach(f=>{const x=document.createElement("script");Array.from(f.attributes).forEach(d=>{x.setAttribute(d.name,d.value)}),x.text=f.text,document.body.appendChild(x),l.push(x)}),()=>{l.forEach(f=>document.body.removeChild(f))}},[s,v]),r.jsx(o,{id:v,className:p,dangerouslySetInnerHTML:{__html:s}})},fs=({level:s})=>{const p=Math.round(s*100);let o="bg-red-500",v="Novice";return p>85?(o="bg-green-500",v="Mastered"):p>65?(o="bg-teal-500",v="Proficient"):p>40?(o="bg-blue-500",v="Familiar"):p>15&&(o="bg-orange-500",v="Learning"),r.jsxs("div",{className:"w-full",children:[r.jsxs("div",{className:"flex justify-between mb-1 text-xs",children:[r.jsxs("span",{className:"font-semibold text-gray-600 dark:text-gray-300",children:["Mastery: ",v]}),r.jsxs("span",{className:"font-semibold text-gray-500 dark:text-gray-400",children:[p,"%"]})]}),r.jsx("div",{className:"w-full bg-gray-200 dark:bg-gray-700 rounded-full h-2",children:r.jsx("div",{className:`${o} h-2 rounded-full transition-all duration-500`,style:{width:`${p}%`},role:"progressbar","aria-valuenow":p,"aria-valuemin":0,"aria-valuemax":100,"aria-label":`Mastery level: ${v}, ${p}%`})})]})},yg=({card:s,isFlipped:p})=>{const o="text-xl text-left text-text break-words prose dark:prose-invert max-w-none prose-img:mx-auto prose-img:max-h-64 prose-audio:mx-auto",v=wn(s);return r.jsxs("div",{className:"w-full bg-surface rounded-lg shadow-lg border border-border",children:[s.css&&r.jsx("div",{dangerouslySetInnerHTML:{__html:s.css}}),r.jsx("div",{className:"p-6 md:p-8 min-h-[12rem] flex items-center justify-center",children:r.jsx(Gs,{html:s.front,className:o})}),p&&r.jsxs("div",{className:"animate-fade-in",style:{animationDuration:"400ms"},children:[r.jsx("hr",{className:"border-border/50"}),r.jsxs("div",{className:"p-6 md:p-8 bg-background/30 dark:bg-black/10",children:[r.jsx(Gs,{html:s.back,className:o}),r.jsx("div",{className:"mt-6 pt-6 border-t border-border/50",children:r.jsx(fs,{level:v})})]})]})]})},vg=({question:s,selectedAnswerId:p,onSelectAnswer:o,deckName:v,onShowInfo:h})=>{const u=p!==null,l=U.useMemo(()=>{const d=[...s.options];for(let T=d.length-1;T>0;T--){const b=Math.floor(Math.random()*(T+1));[d[T],d[b]]=[d[b],d[T]]}return d},[s.id]),f=d=>{let T="flex items-start text-left w-full p-4 rounded-lg border-2 transition-all duration-200";if(!u)return`${T} bg-surface border-border hover:border-primary cursor-pointer`;const b=d.id===s.correctAnswerId,N=d.id===p;return b?`${T} border-green-500 bg-green-500/10 cursor-not-allowed`:N?`${T} border-red-500 bg-red-500/10 cursor-not-allowed`:`${T} border-border bg-background/50 cursor-not-allowed`},x=wn(s);return r.jsxs("div",{className:"bg-surface rounded-lg shadow-lg border border-border",children:[r.jsxs("div",{className:"p-6 md:p-8",children:[v&&r.jsx("p",{className:"text-xs text-text-muted mb-2 uppercase tracking-wider font-semibold",children:v}),r.jsx(Gs,{html:s.questionText,className:"text-xl font-semibold text-text",as:"h3"})]}),r.jsx("div",{className:"px-6 md:px-8 pb-6 md:pb-8",children:r.jsx("div",{className:"space-y-3",children:l.map(d=>r.jsxs("button",{onClick:()=>o(d.id),disabled:u,className:f(d),"aria-pressed":p===d.id,children:[r.jsxs("div",{className:"flex-1 min-w-0",children:[r.jsx(Gs,{html:d.text,className:"prose dark:prose-invert max-w-none"}),u&&d.explanation&&r.jsx("p",{className:"text-xs mt-1 text-text-muted",children:d.explanation})]}),u&&r.jsx("div",{className:"ml-4 flex-shrink-0",children:d.id===s.correctAnswerId?r.jsx(ae,{name:"check-circle",className:"w-6 h-6 text-green-500"}):d.id===p?r.jsx(ae,{name:"x-circle",className:"w-6 h-6 text-red-500"}):null})]},d.id))})}),u&&r.jsxs("div",{className:"p-6 bg-background/30 dark:bg-black/10 border-t border-border/50 animate-fade-in",children:[r.jsxs("div",{className:"flex justify-between items-start",children:[r.jsx("div",{children:s.detailedExplanation&&r.jsxs(r.Fragment,{children:[r.jsx("h4",{className:"text-sm font-semibold uppercase tracking-wider text-text-muted mb-2",children:"Explanation"}),r.jsx(Gs,{html:s.detailedExplanation,className:"prose dark:prose-invert max-w-none prose-sm"})]})}),h&&r.jsxs(ve,{variant:"ghost",size:"sm",onClick:h,className:"ml-4 flex-shrink-0",children:[r.jsx(ae,{name:"info",className:"w-4 h-4 mr-1"}),"View Related Info"]})]}),r.jsx("div",{className:s.detailedExplanation?"mt-6 pt-6 border-t border-border/50":"",children:r.jsx(fs,{level:x})})]})]})},Ac=({current:s,total:p})=>{const o=p>0?s/p*100:0;return r.jsx("div",{className:"w-full bg-border/30 rounded-full h-2.5",children:r.jsx("div",{className:"bg-primary h-2.5 rounded-full transition-all duration-500",style:{width:`${o}%`}})})};var Oc={};(function s(p,o,v,h){var u=!!(p.Worker&&p.Blob&&p.Promise&&p.OffscreenCanvas&&p.OffscreenCanvasRenderingContext2D&&p.HTMLCanvasElement&&p.HTMLCanvasElement.prototype.transferControlToOffscreen&&p.URL&&p.URL.createObjectURL),l=typeof Path2D=="function"&&typeof DOMMatrix=="function",f=function(){if(!p.OffscreenCanvas)return!1;var B=new OffscreenCanvas(1,1),S=B.getContext("2d");S.fillRect(0,0,1,1);var A=B.transferToImageBitmap();try{S.createPattern(A,"no-repeat")}catch{return!1}return!0}();function x(){}function d(B){var S=o.exports.Promise,A=S!==void 0?S:p.Promise;return typeof A=="function"?new A(B):(B(x,x),null)}var T=function(B,S){return{transform:function(A){if(B)return A;if(S.has(A))return S.get(A);var ce=new OffscreenCanvas(A.width,A.height),pe=ce.getContext("2d");return pe.drawImage(A,0,0),S.set(A,ce),ce},clear:function(){S.clear()}}}(f,new Map),b=function(){var B=Math.floor(16.666666666666668),S,A,ce={},pe=0;return typeof requestAnimationFrame=="function"&&typeof cancelAnimationFrame=="function"?(S=function(me){var Te=Math.random();return ce[Te]=requestAnimationFrame(function he(Se){pe===Se||pe+B-1<Se?(pe=Se,delete ce[Te],me()):ce[Te]=requestAnimationFrame(he)}),Te},A=function(me){ce[me]&&cancelAnimationFrame(ce[me])}):(S=function(me){return setTimeout(me,B)},A=function(me){return clearTimeout(me)}),{frame:S,cancel:A}}(),N=function(){var B,S,A={};function ce(pe){function me(Te,he){pe.postMessage({options:Te||{},callback:he})}pe.init=function(he){var Se=he.transferControlToOffscreen();pe.postMessage({canvas:Se},[Se])},pe.fire=function(he,Se,Ee){if(S)return me(he,null),S;var Le=Math.random().toString(36).slice(2);return S=d(function(qe){function te(Y){Y.data.callback===Le&&(delete A[Le],pe.removeEventListener("message",te),S=null,T.clear(),Ee(),qe())}pe.addEventListener("message",te),me(he,Le),A[Le]=te.bind(null,{data:{callback:Le}})}),S},pe.reset=function(){pe.postMessage({reset:!0});for(var he in A)A[he](),delete A[he]}}return function(){if(B)return B;if(!v&&u){var pe=["var CONFETTI, SIZE = {}, module = {};","("+s.toString()+")(this, module, true, SIZE);","onmessage = function(msg) {","  if (msg.data.options) {","    CONFETTI(msg.data.options).then(function () {","      if (msg.data.callback) {","        postMessage({ callback: msg.data.callback });","      }","    });","  } else if (msg.data.reset) {","    CONFETTI && CONFETTI.reset();","  } else if (msg.data.resize) {","    SIZE.width = msg.data.resize.width;","    SIZE.height = msg.data.resize.height;","  } else if (msg.data.canvas) {","    SIZE.width = msg.data.canvas.width;","    SIZE.height = msg.data.canvas.height;","    CONFETTI = module.exports.create(msg.data.canvas);","  }","}"].join(`
`);try{B=new Worker(URL.createObjectURL(new Blob([pe])))}catch(me){return typeof console!==void 0&&typeof console.warn=="function"&&console.warn("🎊 Could not load worker",me),null}ce(B)}return B}}(),w={particleCount:50,angle:90,spread:45,startVelocity:45,decay:.9,gravity:1,drift:0,ticks:200,x:.5,y:.5,shapes:["square","circle"],zIndex:100,colors:["#26ccff","#a25afd","#ff5e7e","#88ff5a","#fcff42","#ffa62d","#ff36ff"],disableForReducedMotion:!1,scalar:1};function I(B,S){return S?S(B):B}function k(B){return B!=null}function C(B,S,A){return I(B&&k(B[S])?B[S]:w[S],A)}function j(B){return B<0?0:Math.floor(B)}function O(B,S){return Math.floor(Math.random()*(S-B))+B}function F(B){return parseInt(B,16)}function R(B){return B.map(M)}function M(B){var S=String(B).replace(/[^0-9a-f]/gi,"");return S.length<6&&(S=S[0]+S[0]+S[1]+S[1]+S[2]+S[2]),{r:F(S.substring(0,2)),g:F(S.substring(2,4)),b:F(S.substring(4,6))}}function H(B){var S=C(B,"origin",Object);return S.x=C(S,"x",Number),S.y=C(S,"y",Number),S}function V(B){B.width=document.documentElement.clientWidth,B.height=document.documentElement.clientHeight}function oe(B){var S=B.getBoundingClientRect();B.width=S.width,B.height=S.height}function J(B){var S=document.createElement("canvas");return S.style.position="fixed",S.style.top="0px",S.style.left="0px",S.style.pointerEvents="none",S.style.zIndex=B,S}function Z(B,S,A,ce,pe,me,Te,he,Se){B.save(),B.translate(S,A),B.rotate(me),B.scale(ce,pe),B.arc(0,0,1,Te,he,Se),B.restore()}function de(B){var S=B.angle*(Math.PI/180),A=B.spread*(Math.PI/180);return{x:B.x,y:B.y,wobble:Math.random()*10,wobbleSpeed:Math.min(.11,Math.random()*.1+.05),velocity:B.startVelocity*.5+Math.random()*B.startVelocity,angle2D:-S+(.5*A-Math.random()*A),tiltAngle:(Math.random()*(.75-.25)+.25)*Math.PI,color:B.color,shape:B.shape,tick:0,totalTicks:B.ticks,decay:B.decay,drift:B.drift,random:Math.random()+2,tiltSin:0,tiltCos:0,wobbleX:0,wobbleY:0,gravity:B.gravity*3,ovalScalar:.6,scalar:B.scalar,flat:B.flat}}function $(B,S){S.x+=Math.cos(S.angle2D)*S.velocity+S.drift,S.y+=Math.sin(S.angle2D)*S.velocity+S.gravity,S.velocity*=S.decay,S.flat?(S.wobble=0,S.wobbleX=S.x+10*S.scalar,S.wobbleY=S.y+10*S.scalar,S.tiltSin=0,S.tiltCos=0,S.random=1):(S.wobble+=S.wobbleSpeed,S.wobbleX=S.x+10*S.scalar*Math.cos(S.wobble),S.wobbleY=S.y+10*S.scalar*Math.sin(S.wobble),S.tiltAngle+=.1,S.tiltSin=Math.sin(S.tiltAngle),S.tiltCos=Math.cos(S.tiltAngle),S.random=Math.random()+2);var A=S.tick++/S.totalTicks,ce=S.x+S.random*S.tiltCos,pe=S.y+S.random*S.tiltSin,me=S.wobbleX+S.random*S.tiltCos,Te=S.wobbleY+S.random*S.tiltSin;if(B.fillStyle="rgba("+S.color.r+", "+S.color.g+", "+S.color.b+", "+(1-A)+")",B.beginPath(),l&&S.shape.type==="path"&&typeof S.shape.path=="string"&&Array.isArray(S.shape.matrix))B.fill(ge(S.shape.path,S.shape.matrix,S.x,S.y,Math.abs(me-ce)*.1,Math.abs(Te-pe)*.1,Math.PI/10*S.wobble));else if(S.shape.type==="bitmap"){var he=Math.PI/10*S.wobble,Se=Math.abs(me-ce)*.1,Ee=Math.abs(Te-pe)*.1,Le=S.shape.bitmap.width*S.scalar,qe=S.shape.bitmap.height*S.scalar,te=new DOMMatrix([Math.cos(he)*Se,Math.sin(he)*Se,-Math.sin(he)*Ee,Math.cos(he)*Ee,S.x,S.y]);te.multiplySelf(new DOMMatrix(S.shape.matrix));var Y=B.createPattern(T.transform(S.shape.bitmap),"no-repeat");Y.setTransform(te),B.globalAlpha=1-A,B.fillStyle=Y,B.fillRect(S.x-Le/2,S.y-qe/2,Le,qe),B.globalAlpha=1}else if(S.shape==="circle")B.ellipse?B.ellipse(S.x,S.y,Math.abs(me-ce)*S.ovalScalar,Math.abs(Te-pe)*S.ovalScalar,Math.PI/10*S.wobble,0,2*Math.PI):Z(B,S.x,S.y,Math.abs(me-ce)*S.ovalScalar,Math.abs(Te-pe)*S.ovalScalar,Math.PI/10*S.wobble,0,2*Math.PI);else if(S.shape==="star")for(var g=Math.PI/2*3,ee=4*S.scalar,G=8*S.scalar,P=S.x,L=S.y,q=5,X=Math.PI/q;q--;)P=S.x+Math.cos(g)*G,L=S.y+Math.sin(g)*G,B.lineTo(P,L),g+=X,P=S.x+Math.cos(g)*ee,L=S.y+Math.sin(g)*ee,B.lineTo(P,L),g+=X;else B.moveTo(Math.floor(S.x),Math.floor(S.y)),B.lineTo(Math.floor(S.wobbleX),Math.floor(pe)),B.lineTo(Math.floor(me),Math.floor(Te)),B.lineTo(Math.floor(ce),Math.floor(S.wobbleY));return B.closePath(),B.fill(),S.tick<S.totalTicks}function W(B,S,A,ce,pe){var me=S.slice(),Te=B.getContext("2d"),he,Se,Ee=d(function(Le){function qe(){he=Se=null,Te.clearRect(0,0,ce.width,ce.height),T.clear(),pe(),Le()}function te(){v&&!(ce.width===h.width&&ce.height===h.height)&&(ce.width=B.width=h.width,ce.height=B.height=h.height),!ce.width&&!ce.height&&(A(B),ce.width=B.width,ce.height=B.height),Te.clearRect(0,0,ce.width,ce.height),me=me.filter(function(Y){return $(Te,Y)}),me.length?he=b.frame(te):qe()}he=b.frame(te),Se=qe});return{addFettis:function(Le){return me=me.concat(Le),Ee},canvas:B,promise:Ee,reset:function(){he&&b.cancel(he),Se&&Se()}}}function _(B,S){var A=!B,ce=!!C(S||{},"resize"),pe=!1,me=C(S,"disableForReducedMotion",Boolean),Te=u&&!!C(S||{},"useWorker"),he=Te?N():null,Se=A?V:oe,Ee=B&&he?!!B.__confetti_initialized:!1,Le=typeof matchMedia=="function"&&matchMedia("(prefers-reduced-motion)").matches,qe;function te(g,ee,G){for(var P=C(g,"particleCount",j),L=C(g,"angle",Number),q=C(g,"spread",Number),X=C(g,"startVelocity",Number),se=C(g,"decay",Number),Q=C(g,"gravity",Number),ue=C(g,"drift",Number),Ie=C(g,"colors",R),ye=C(g,"ticks",Number),Ce=C(g,"shapes"),Be=C(g,"scalar"),$e=!!C(g,"flat"),ct=H(g),et=P,pt=[],qt=B.width*ct.x,ft=B.height*ct.y;et--;)pt.push(de({x:qt,y:ft,angle:L,spread:q,startVelocity:X,color:Ie[et%Ie.length],shape:Ce[O(0,Ce.length)],ticks:ye,decay:se,gravity:Q,drift:ue,scalar:Be,flat:$e}));return qe?qe.addFettis(pt):(qe=W(B,pt,Se,ee,G),qe.promise)}function Y(g){var ee=me||C(g,"disableForReducedMotion",Boolean),G=C(g,"zIndex",Number);if(ee&&Le)return d(function(X){X()});A&&qe?B=qe.canvas:A&&!B&&(B=J(G),document.body.appendChild(B)),ce&&!Ee&&Se(B);var P={width:B.width,height:B.height};he&&!Ee&&he.init(B),Ee=!0,he&&(B.__confetti_initialized=!0);function L(){if(he){var X={getBoundingClientRect:function(){if(!A)return B.getBoundingClientRect()}};Se(X),he.postMessage({resize:{width:X.width,height:X.height}});return}P.width=P.height=null}function q(){qe=null,ce&&(pe=!1,p.removeEventListener("resize",L)),A&&B&&(document.body.contains(B)&&document.body.removeChild(B),B=null,Ee=!1)}return ce&&!pe&&(pe=!0,p.addEventListener("resize",L,!1)),he?he.fire(g,P,q):te(g,P,q)}return Y.reset=function(){he&&he.reset(),qe&&qe.reset()},Y}var ie;function be(){return ie||(ie=_(null,{useWorker:!0,resize:!0})),ie}function ge(B,S,A,ce,pe,me,Te){var he=new Path2D(B),Se=new Path2D;Se.addPath(he,new DOMMatrix(S));var Ee=new Path2D;return Ee.addPath(Se,new DOMMatrix([Math.cos(Te)*pe,Math.sin(Te)*pe,-Math.sin(Te)*me,Math.cos(Te)*me,A,ce])),Ee}function je(B){if(!l)throw new Error("path confetti are not supported in this browser");var S,A;typeof B=="string"?S=B:(S=B.path,A=B.matrix);var ce=new Path2D(S),pe=document.createElement("canvas"),me=pe.getContext("2d");if(!A){for(var Te=1e3,he=Te,Se=Te,Ee=0,Le=0,qe,te,Y=0;Y<Te;Y+=2)for(var g=0;g<Te;g+=2)me.isPointInPath(ce,Y,g,"nonzero")&&(he=Math.min(he,Y),Se=Math.min(Se,g),Ee=Math.max(Ee,Y),Le=Math.max(Le,g));qe=Ee-he,te=Le-Se;var ee=10,G=Math.min(ee/qe,ee/te);A=[G,0,0,G,-Math.round(qe/2+he)*G,-Math.round(te/2+Se)*G]}return{type:"path",path:S,matrix:A}}function fe(B){var S,A=1,ce="#000000",pe='"Apple Color Emoji", "Segoe UI Emoji", "Segoe UI Symbol", "Noto Color Emoji", "EmojiOne Color", "Android Emoji", "Twemoji Mozilla", "system emoji", sans-serif';typeof B=="string"?S=B:(S=B.text,A="scalar"in B?B.scalar:A,pe="fontFamily"in B?B.fontFamily:pe,ce="color"in B?B.color:ce);var me=10*A,Te=""+me+"px "+pe,he=new OffscreenCanvas(me,me),Se=he.getContext("2d");Se.font=Te;var Ee=Se.measureText(S),Le=Math.ceil(Ee.actualBoundingBoxRight+Ee.actualBoundingBoxLeft),qe=Math.ceil(Ee.actualBoundingBoxAscent+Ee.actualBoundingBoxDescent),te=2,Y=Ee.actualBoundingBoxLeft+te,g=Ee.actualBoundingBoxAscent+te;Le+=te+te,qe+=te+te,he=new OffscreenCanvas(Le,qe),Se=he.getContext("2d"),Se.font=Te,Se.fillStyle=ce,Se.fillText(S,Y,g);var ee=1/A;return{type:"bitmap",bitmap:he.transferToImageBitmap(),matrix:[ee,0,0,ee,-Le*ee/2,-qe*ee/2]}}o.exports=function(){return be().apply(this,arguments)},o.exports.reset=function(){be().reset()},o.exports.create=_,o.exports.shapeFromPath=je,o.exports.shapeFromText=fe})(function(){return typeof window<"u"?window:typeof self<"u"?self:this||{}}(),Oc,!1);const yc=Oc.exports;Oc.exports.create;const wg=()=>(U.useEffect(()=>{const p=Date.now()+1e3,v={startVelocity:30,spread:360,ticks:90,zIndex:99,colors:["#60a5fa","#5eead4","#a78bfa","#fde047","#f9fafb"]};function h(l,f){return Math.random()*(f-l)+l}const u=window.setInterval(()=>{const l=p-Date.now();if(l<=0)return clearInterval(u);const f=50*(l/1e3);yc({...v,particleCount:f,origin:{x:h(.1,.3),y:Math.random()-.2}}),yc({...v,particleCount:f,origin:{x:h(.7,.9),y:Math.random()-.2}})},250);return()=>{clearInterval(u),yc.reset()}},[]),null),bg=({infoCard:s})=>r.jsx("div",{className:"w-full bg-surface rounded-lg shadow-lg border border-border",children:r.jsx("div",{className:"p-6 md:p-8 min-h-[12rem] flex items-center justify-center",children:r.jsx(Gs,{html:s.content,className:"text-lg text-left text-text break-words prose dark:prose-invert max-w-none prose-img:mx-auto prose-img:max-h-64"})})}),kg=({isOpen:s,onClose:p,infoCards:o})=>{const v=U.useRef(null);return pr(v,s),s?r.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-75 flex items-center justify-center z-50 p-4",children:r.jsxs("div",{ref:v,className:"bg-surface rounded-lg shadow-xl w-full max-w-2xl transform transition-all relative max-h-[90vh] flex flex-col",role:"dialog","aria-modal":"true","aria-labelledby":"info-modal-title",children:[r.jsxs("div",{className:"flex-shrink-0 flex justify-between items-center p-4 border-b border-border",children:[r.jsx("h2",{id:"info-modal-title",className:"text-xl font-bold text-text",children:"Related Information"}),r.jsx(ve,{type:"button",variant:"ghost",onClick:p,className:"p-1 h-auto","aria-label":"Close",children:r.jsx(ae,{name:"x"})})]}),r.jsx("div",{className:"p-6 overflow-y-auto space-y-6",children:o.map((h,u)=>r.jsxs("div",{children:[r.jsx(Gs,{html:h.content,className:"prose dark:prose-invert max-w-none"}),u<o.length-1&&r.jsx("hr",{className:"my-6 border-border"})]},h.id))}),r.jsx("div",{className:"flex-shrink-0 flex justify-end p-4 bg-background/50 border-t border-border",children:r.jsx(ve,{type:"button",variant:"primary",onClick:p,children:"Close"})})]})}):null},ei=({deck:s,onSessionEnd:p,onItemReviewed:o,onUpdateLastOpened:v,sessionKeySuffix:h="",seriesId:u,onStudyNextDeck:l})=>{const[f,x]=U.useState([]),[d,T]=U.useState([]),[b,N]=U.useState(0),[w,I]=U.useState(0),[k,C]=U.useState(!1),[j,O]=U.useState(null),[F,R]=U.useState(!1),[M,H]=U.useState(!1),[V,oe]=U.useState(!1),[J,Z]=U.useState([]),[de,$]=U.useState(new Set),[W,_]=U.useState(new Set),{hapticsEnabled:ie}=on(),{addToast:be}=er(),{deckSeries:ge,seriesProgress:je}=Ke(),fe=U.useMemo(()=>s.id==="general-study-deck",[s.id]),B=`session_deck_${s.id}${h}`,S=U.useMemo(()=>({reviewQueue:f,currentIndex:b,readInfoCardIds:Array.from(de),unlockedQuestionIds:Array.from(W)}),[f,b,de,W]);U.useEffect(()=>{v(s.id)},[s.id]);const A=s.type===Ae.Learning;U.useEffect(()=>{(async()=>{if(F)return;if(fe||h==="_cram"||h==="_flip"||h==="_reversed"){const ue=s.type===Ae.Flashcard?s.cards:s.questions;x(ue),N(0),I(0),R(!0);return}let Q=!1;try{const ue=await Vm(B);ue&&ue.reviewQueue&&ue.reviewQueue.length>0&&typeof ue.currentIndex=="number"?(x(ue.reviewQueue),N(ue.currentIndex),I(ue.currentIndex),A&&($(new Set(ue.readInfoCardIds||[])),_(new Set(ue.unlockedQuestionIds||[]))),Q=!0):ue&&await vo(B)}catch(ue){console.error("Failed to load saved session from DB",ue)}if(!Q){const ue=new Date;if(ue.setHours(23,59,59,999),A)x(s.infoCards),$(new Set),_(new Set);else{const ye=(s.type===Ae.Quiz?s.questions:s.cards).filter(Ce=>!Ce.suspended&&new Date(Ce.dueDate)<=ue).sort(()=>Math.random()-.5);x(ye)}N(0),I(0)}R(!0)})()},[s,h,fe,B,F,A]),U.useEffect(()=>{(async()=>{if(!fe&&h===""&&F&&b<f.length)try{await Ym(B,S)}catch(Q){console.error("Could not save session state to DB",Q),be("Could not save session progress. It may be lost on refresh.","error")}})()},[S,fe,F,B,b,f.length,h,be]);const ce=U.useMemo(()=>f[w],[f,w]),pe=w<b,me=w===b,Te=ce&&"questionText"in ce,he=ce&&"content"in ce&&!("front"in ce),Se=j!==null,Ee=ce&&"originalDeckName"in ce?ce.originalDeckName:void 0;U.useMemo(()=>{if(!u||b<f.length)return null;const X=ge.find(ue=>ue.id===u);if(!X)return null;const se=X.levels.flatMap(ue=>ue.deckIds),Q=se.indexOf(s.id);if(Q>-1&&Q<se.length-1){const ue=je.get(u)||new Set,Ie=Q+1;if(Ie<=ue.size)return se[Ie]}return null},[u,s.id,ge,b,f.length,je]);const Le=U.useCallback(()=>{C(!1),O(null);const X=b+1;X<=f.length&&(N(X),I(X)),X>=f.length&&!fe&&h===""&&vo(B).catch(Q=>console.error("Failed to delete session state",Q))},[b,f.length,fe,B,h]),qe=U.useCallback(X=>{me&&!Se&&O(X)},[me,Se]),te=U.useCallback(()=>{if(!A||!he||!me)return;const X=ce,se=new Set(de).add(X.id),Q=new Set(W);X.unlocksQuestionIds.forEach(Ce=>Q.add(Ce)),$(se),_(Q);const ue=new Date;ue.setHours(23,59,59,999);const Ie=s.questions.filter(Ce=>Q.has(Ce.id)&&!Ce.suspended&&new Date(Ce.dueDate)<=ue),ye=f.slice(b+1);if(Ie.length>0){const Ce=Ie.find(Be=>!ye.some($e=>$e.id===Be.id));if(Ce){const Be=[...f.slice(0,b+1),Ce,...ye.filter($e=>$e.id!==Ce.id)];x(Be)}}Le()},[A,he,me,ce,de,W,s,f,b,Le]),Y=U.useCallback(async X=>{if(!ce||!me||M||he)return;if(h==="_cram"){H(!0),Le(),H(!1);return}H(!0),ie&&"vibrate"in navigator&&navigator.vibrate(20);const Q=wn(ce);let ue=qp(ce,X);const Ie=ue.masteryLevel||0;(ue.lapses||0)>=8&&!ce.suspended&&(ue={...ue,suspended:!0},be("This item is proving difficult. It has been automatically suspended to let you focus on other material.","info"));const ye=Math.round(Q*100),Ce=Math.round(Ie*100);ye<=85&&Ce>85&&be("Item Mastered!","success"),T(Be=>[...Be,{oldItem:ce,newItem:ue,rating:X}]);try{const Be=ce.originalDeckId||s.id;await o(Be,ue,X,u)}catch(Be){console.error("Failed to save review:",Be),be("Failed to save review. Your progress for this card may not be saved.","error")}finally{x(Be=>Be.map(($e,ct)=>ct===b?ue:$e)),setTimeout(()=>{Le(),H(!1)},800)}},[ce,me,M,ie,Le,s.id,o,be,u,b,h,he]),g=U.useCallback(async()=>{if(!ce||!me||M||he)return;H(!0);const X={...ce,suspended:!0};T(se=>[...se,{oldItem:ce,newItem:X,rating:null}]);try{const se=ce.originalDeckId||s.id;await o(se,X,null,u),be("Card suspended for future sessions.","info")}catch(se){console.error("Failed to suspend card:",se),be("Failed to save suspended state. Please try again.","error")}finally{setTimeout(()=>{Le(),H(!1)},300)}},[ce,me,M,be,Le,s.id,o,u,he]),ee=U.useCallback(()=>{w>0&&I(X=>X-1)},[w]),G=U.useCallback(()=>{w<b&&I(X=>X+1)},[w,b]),P=U.useCallback(()=>{if(!A||!Te)return;const X=ce,se=s;if(X.infoCardIds&&X.infoCardIds.length>0){const Q=se.infoCards.filter(ue=>{var Ie;return(Ie=X.infoCardIds)==null?void 0:Ie.includes(ue.id)});Z(Q),oe(!0)}},[A,Te,ce,s]);if(U.useEffect(()=>{const X=se=>{if(!(se.target instanceof HTMLInputElement||se.target instanceof HTMLTextAreaElement)){if(se.key==="ArrowLeft"){w>0&&(se.preventDefault(),ee());return}if(se.key==="ArrowRight"){w<b&&(se.preventDefault(),G());return}!me||M||(he?(se.code==="Space"||se.key==="Enter")&&(se.preventDefault(),te()):Te&&Se?(se.key==="1"&&Y(mt.Again),se.key==="2"&&Y(mt.Hard),se.key==="3"&&Y(mt.Good),se.key==="4"&&Y(mt.Easy)):!Te&&!he&&(k?(se.key==="1"&&Y(mt.Again),se.key==="2"&&Y(mt.Hard),se.key==="3"&&Y(mt.Good),se.key==="4"&&Y(mt.Easy)):se.code==="Space"&&(se.preventDefault(),C(!0))))}};return window.addEventListener("keydown",X),()=>window.removeEventListener("keydown",X)},[k,Se,Te,me,M,Y,ee,G,w,b,he,te]),!F)return r.jsx("div",{className:"text-center p-8",children:r.jsx("p",{className:"text-text-muted",children:"Initializing session..."})});if(f.length===0)return r.jsxs("div",{className:"text-center p-8",children:[r.jsx("h2",{className:"text-2xl font-bold",children:"All caught up!"}),r.jsx("p",{className:"text-text-muted mt-2",children:fe?"There are no quiz questions due for review across all your decks.":"There are no items due for review in this deck."}),r.jsx(ve,{onClick:()=>p(s.id,u),className:"mt-6",children:"Back to Decks"})]});if(b>=f.length&&h==="_cram")return r.jsxs("div",{className:"text-center p-8 animate-fade-in relative",children:[r.jsx(wg,{}),r.jsx("h2",{className:"text-2xl font-bold text-green-500",children:"Cram Session Complete!"}),r.jsxs("p",{className:"text-text-muted mt-2",children:["You've reviewed all ",d.length," items in this deck."]}),r.jsx(ve,{onClick:()=>p(s.id,u),className:"mt-8",children:"Finish Session"})]});const L=(k||Te&&Se)&&me,q=f.length>1;return r.jsxs("div",{className:"w-full max-w-3xl mx-auto p-4 flex flex-col h-full overflow-x-hidden",children:[r.jsx(kg,{isOpen:V,onClose:()=>oe(!1),infoCards:J}),r.jsx(Ac,{current:b+1,total:f.length}),r.jsx("div",{className:"flex-grow flex flex-col items-center justify-center my-4 w-full",children:ce&&r.jsx("div",{className:"w-full relative animate-fade-in",children:Te?r.jsx(vg,{question:ce,selectedAnswerId:pe?ce.correctAnswerId:j,onSelectAnswer:qe,deckName:Ee,onShowInfo:A?P:void 0}):he?r.jsx(bg,{infoCard:ce}):r.jsx(yg,{card:ce,isFlipped:k||pe})},w)}),r.jsxs("div",{className:"flex-shrink-0 mt-4 flex flex-col items-center justify-center space-y-4 min-h-[10rem]",children:[r.jsx("div",{className:"w-full flex-grow flex items-center justify-center",children:pe?r.jsxs("div",{className:"text-center animate-fade-in",children:[r.jsx(ve,{onClick:()=>I(b),variant:"primary",className:"text-lg py-3",children:"Return to Current Item"}),r.jsx("div",{className:"text-xs mt-2 font-semibold text-yellow-600 dark:text-yellow-400",children:"(Reviewing Past Item)"})]}):L?r.jsxs("div",{className:"space-y-4 animate-fade-in w-full",children:[r.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[r.jsx(ve,{onClick:()=>Y(mt.Again),className:"bg-red-600 hover:bg-red-700 focus:ring-red-500 py-3 text-base text-white",disabled:M,children:"Again"}),r.jsx(ve,{onClick:()=>Y(mt.Hard),className:"bg-orange-500 hover:bg-orange-600 focus:ring-orange-400 py-3 text-base text-white",disabled:M,children:"Hard"}),r.jsx(ve,{onClick:()=>Y(mt.Good),className:"bg-green-600 hover:bg-green-700 focus:ring-green-500 py-3 text-base text-white",disabled:M,children:"Good"}),r.jsx(ve,{onClick:()=>Y(mt.Easy),className:"bg-blue-600 hover:bg-blue-700 focus:ring-blue-500 py-3 text-base text-white",disabled:M,children:"Easy"})]}),h!=="_cram"&&r.jsx("div",{className:"text-center",children:r.jsxs(ve,{variant:"ghost",onClick:g,className:"text-xs",disabled:M,children:[r.jsx(ae,{name:"eye-off",className:"w-4 h-4 mr-1"})," Suspend this item"]})})]}):he&&me?r.jsx(ve,{onClick:te,variant:"primary",className:"w-full max-w-md text-lg py-3 animate-fade-in mx-auto flex items-center justify-center",children:"Continue"}):!Te&&me&&r.jsx(ve,{onClick:()=>C(!0),variant:"primary",className:"w-full max-w-md text-lg py-3 animate-fade-in mx-auto flex items-center justify-center",children:"Show Answer"})}),q&&r.jsxs("div",{className:"flex justify-center items-center w-full max-w-xs gap-4 animate-fade-in h-12",children:[r.jsx(ve,{variant:"ghost",onClick:ee,disabled:w===0,className:"p-3 rounded-full disabled:opacity-30","aria-label":"Previous item",children:r.jsx(ae,{name:"chevron-left",className:"w-8 h-8"})}),r.jsx("div",{className:"text-center w-28",children:r.jsxs("span",{className:"text-sm text-text-muted",children:["Item ",w+1," of ",f.length]})}),r.jsx(ve,{variant:"ghost",onClick:G,disabled:w>=b,className:"p-3 rounded-full disabled:opacity-30","aria-label":"Next item",children:r.jsx(ae,{name:"chevron-left",className:"w-8 h-8 rotate-180"})})]})]})]})},ka=({label:s,checked:p,onChange:o,description:v})=>{const h=ni.useId();return r.jsxs("div",{className:"flex items-center justify-between",children:[r.jsxs("span",{className:"flex flex-col",children:[r.jsx("label",{htmlFor:h,className:"font-medium text-text cursor-pointer",children:s}),v&&r.jsx("span",{id:`${h}-description`,className:"text-sm text-text-muted",children:v})]}),r.jsx("button",{id:h,type:"button",role:"switch","aria-checked":p,"aria-describedby":v?`${h}-description`:void 0,onClick:()=>o(!p),className:`${p?"bg-primary":"bg-border"} relative inline-flex h-6 w-11 flex-shrink-0 cursor-pointer rounded-full border-2 border-transparent transition-colors duration-200 ease-in-out focus:outline-none focus:ring-2 focus:ring-primary focus:ring-offset-2 dark:focus:ring-offset-surface`,children:r.jsx("span",{"aria-hidden":"true",className:`${p?"translate-x-5":"translate-x-0"} pointer-events-none inline-block h-5 w-5 transform rounded-full bg-white shadow ring-0 transition duration-200 ease-in-out`})})]})},vc="cogniflow-themeId",cs=[{id:"system",name:"System",isDark:!1,metaColor:"#f9fafb",metaColorDark:"#111827",palette:{background:"249 250 251",surface:"255 255 255",primary:"37 99 235",text:"17 24 39"},paletteDark:{background:"17 24 39",surface:"31 41 55",primary:"37 99 235",text:"243 244 246"}},{id:"light",name:"Light",isDark:!1,metaColor:"#f9fafb",palette:{background:"249 250 251",surface:"255 255 255",primary:"37 99 235",text:"17 24 39"}},{id:"rose",name:"Rose",isDark:!1,metaColor:"#fff1f2",palette:{background:"255 241 242",surface:"254 226 226",primary:"225 29 72",text:"136 25 55"}},{id:"matcha",name:"Matcha",isDark:!1,metaColor:"#f0fdf4",palette:{background:"240 253 244",surface:"220 252 231",primary:"22 163 74",text:"21 94 53"}},{id:"latte",name:"Latte",isDark:!1,metaColor:"#fffbeb",palette:{background:"255 251 235",surface:"254 243 199",primary:"217 119 6",text:"113 63 18"}},{id:"sky",name:"Sky",isDark:!1,metaColor:"#f0f9ff",palette:{background:"240 249 255",surface:"224 242 254",primary:"14 165 233",text:"7 89 133"}},{id:"sunrise",name:"Sunrise",isDark:!1,metaColor:"#fffbeb",palette:{background:"255 251 235",surface:"254 243 199",primary:"249 115 22",text:"124 45 18"}},{id:"lavender",name:"Lavender",isDark:!1,metaColor:"#f5f3ff",palette:{background:"245 243 255",surface:"237 233 254",primary:"124 58 237",text:"76 29 149"}},{id:"terracotta",name:"Terracotta",isDark:!1,metaColor:"#faf3e8",palette:{background:"250 243 232",surface:"245 233 218",primary:"226 114 91",text:"93 64 55"}},{id:"alabaster",name:"Alabaster",isDark:!1,metaColor:"#fcfcfc",palette:{background:"252 252 252",surface:"255 255 255",primary:"96 165 250",text:"50 50 50"}},{id:"dark",name:"Dark",isDark:!0,metaColor:"#111827",palette:{background:"17 24 39",surface:"31 41 55",primary:"37 99 235",text:"243 244 246"}},{id:"espresso",name:"Espresso",isDark:!0,metaColor:"#211713",palette:{background:"33 23 19",surface:"58 45 39",primary:"196 154 108",text:"224 213 208"}},{id:"midnight",name:"Midnight",isDark:!0,metaColor:"#0c0d11",palette:{background:"12 13 17",surface:"26 27 38",primary:"133 137 230",text:"200 201 215"}}],wh=U.createContext(void 0),sh=s=>{let p=cs.find(l=>l.id===s);p||(p=cs[0]);const o=window.document.documentElement,v=document.querySelector('meta[name="theme-color"]');let h,u;p.id==="system"?(h=window.matchMedia("(prefers-color-scheme: dark)").matches,u=h?p.metaColorDark:p.metaColor):(h=p.isDark,u=p.metaColor),cs.forEach(l=>{l.id!=="system"&&o.classList.remove(`theme-${l.id}`)}),o.classList.remove("theme-dark","theme-light"),p.id!=="system"&&o.classList.add(`theme-${p.id}`),o.classList.toggle("dark",h),v&&u&&v.setAttribute("content",u)},Sg=({children:s})=>{const[p,o]=U.useState(()=>{try{const u=localStorage.getItem(vc);return cs.some(l=>l.id===u)?u:"system"}catch(u){return console.error("Could not access localStorage. Defaulting to 'system'.",u),"system"}});U.useEffect(()=>{try{localStorage.setItem(vc,p)}catch(u){console.error("Could not set theme in localStorage.",u)}sh(p)},[p]),U.useEffect(()=>{const u=window.matchMedia("(prefers-color-scheme: dark)"),l=()=>{let f="system";try{f=localStorage.getItem(vc)||"system"}catch{}f==="system"&&sh("system")};return u.addEventListener("change",l),()=>u.removeEventListener("change",l)},[]);const v=U.useCallback(u=>{o(u)},[]),h=cs.find(u=>u.id===p)||cs[0];return r.jsx(wh.Provider,{value:{themeId:p,setThemeById:v,currentTheme:h},children:s})},Eg=()=>{const s=U.useContext(wh);if(s===void 0)throw new Error("useTheme must be used within a ThemeProvider");return s},ti=({id:s,title:p,children:o,openSection:v,setOpenSection:h,isDanger:u=!1})=>{const l=v===s,f=u?"bg-red-900/20 text-red-400 dark:text-red-300":"bg-surface",x=u?"bg-red-900/10":"bg-surface",d=u?"border border-red-500/30":"border border-border";return r.jsxs("div",{className:`rounded-lg shadow-sm overflow-hidden ${d}`,children:[r.jsxs("button",{onClick:()=>h(l?null:s),className:`w-full flex justify-between items-center text-left p-4 sm:p-6 ${f}`,"aria-expanded":l,children:[r.jsx("h3",{className:"text-xl font-semibold",children:p}),r.jsx(ae,{name:"chevron-down",className:`w-6 h-6 transition-transform duration-300 ${l?"":"-rotate-90"} text-text-muted`})]}),l&&r.jsx("div",{className:`p-4 sm:p-6 pt-0 animate-fade-in ${x}`,children:r.jsx("div",{className:"pt-4 sm:pt-6 border-t border-border/50",children:o})})]})},_g=({onExport:s,onRestore:p,onResetProgress:o,onFactoryReset:v,onTriggerSync:h,onFetchFromServer:u,isSyncing:l,lastSyncStatus:f})=>{const{disableAnimations:x,setDisableAnimations:d,hapticsEnabled:T,setHapticsEnabled:b,aiFeaturesEnabled:N,setAiFeaturesEnabled:w,backupEnabled:I,setBackupEnabled:k,backupApiKey:C,setBackupApiKey:j}=on(),{addToast:O}=er(),{themeId:F,setThemeById:R}=Eg(),[M,H]=U.useState("data"),[V,oe]=U.useState(C),J=()=>{j(V),O("API Key saved!","success")},Z=()=>{navigator.serviceWorker&&navigator.serviceWorker.controller?(navigator.serviceWorker.controller.postMessage({type:"CLEAR_APP_CACHE"}),navigator.serviceWorker.controller.postMessage({type:"CLEAR_CDN_CACHE"}),O("Caches cleared. Reloading...","info"),setTimeout(()=>window.location.reload(),1e3)):O("Could not clear caches. Service worker not available.","error")},de=cs.filter(W=>!W.isDark),$=cs.filter(W=>W.isDark);return r.jsxs("div",{className:"max-w-4xl mx-auto animate-fade-in space-y-6",children:[r.jsx("h2",{className:"text-3xl font-bold mb-6 text-text border-b border-border pb-4",children:"Settings"}),r.jsx(ti,{id:"data",title:"Data Management",openSection:M,setOpenSection:H,children:r.jsxs("div",{className:"space-y-6",children:[r.jsxs("div",{id:"settings-server-sync",children:[r.jsx("h4",{className:"font-semibold text-text",children:"Server Sync"}),r.jsx("p",{className:"text-text-muted my-2 text-sm",children:'Automatically back up and synchronize your data with a remote server. "Sync Now" uploads your local data, while "Fetch" downloads the server version.'}),r.jsxs("div",{className:"space-y-4 p-4 bg-background rounded-lg border border-border",children:[r.jsx(ka,{label:"Enable Automatic Server Sync",checked:I,onChange:k}),r.jsxs("div",{children:[r.jsx("label",{htmlFor:"api-key-input",className:"block text-sm font-medium text-text-muted mb-1",children:"Backup API Key"}),r.jsxs("div",{className:"flex flex-col sm:flex-row gap-2",children:[r.jsx("input",{id:"api-key-input",type:"password",value:V,onChange:W=>oe(W.target.value),className:"flex-grow p-2 bg-surface border border-border rounded-md focus:ring-2 focus:ring-primary focus:outline-none",placeholder:"Enter your API key"}),r.jsx(ve,{onClick:J,variant:"secondary",children:"Save Key"})]})]}),r.jsxs("div",{className:"flex flex-col sm:flex-row gap-4 items-center pt-2",children:[r.jsxs(ve,{onClick:h,disabled:l||!I,children:[l?r.jsx(sr,{size:"sm"}):r.jsx(ae,{name:"refresh-ccw",className:"w-5 h-5 mr-2"}),l?"Syncing...":"Sync Now"]}),r.jsxs(ve,{onClick:u,variant:"secondary",disabled:l||!I,children:[r.jsx(ae,{name:"download",className:"w-5 h-5 mr-2"}),"Fetch from Server"]}),r.jsx("p",{className:"text-sm text-text-muted",children:f})]})]})]}),r.jsxs("div",{id:"settings-local-backup",className:"border-t border-border pt-6",children:[r.jsx("h4",{className:"font-semibold text-text",children:"Local File Backup"}),r.jsx("p",{className:"text-text-muted my-2 text-sm",children:"Manually backup all your data to a JSON file on your device."}),r.jsxs("div",{className:"flex flex-col sm:flex-row gap-4",children:[r.jsxs(ve,{onClick:s,variant:"secondary",children:[r.jsx(ae,{name:"download",className:"w-5 h-5 mr-2"}),"Backup to File"]}),r.jsxs(ve,{onClick:p,variant:"secondary",children:[r.jsx(ae,{name:"upload-cloud",className:"w-5 h-5 mr-2"}),"Restore from File"]})]})]})]})}),r.jsx(ti,{id:"appearance",title:"Appearance",openSection:M,setOpenSection:H,children:r.jsxs("div",{className:"space-y-6",children:[r.jsxs("div",{children:[r.jsx("h4",{className:"font-semibold text-text mb-3",children:"Color Theme"}),r.jsx("div",{className:"grid grid-cols-2 md:grid-cols-3 gap-4",children:de.map(W=>r.jsxs("button",{onClick:()=>R(W.id),className:`flex items-center space-x-3 p-3 rounded-lg border-2 transition-colors ${F===W.id?"border-primary":"border-border hover:border-text-muted"}`,children:[r.jsx("div",{className:"w-8 h-8 rounded-full flex items-center justify-center",style:{backgroundColor:`rgb(${W.palette.surface})`,border:`2px solid rgb(${W.palette.primary})`},children:r.jsx("div",{className:"w-4 h-4 rounded-full",style:{backgroundColor:`rgb(${W.palette.primary})`}})}),r.jsx("span",{className:"font-medium",children:W.name})]},W.id))})]}),r.jsxs("div",{children:[r.jsx("h4",{className:"font-semibold text-text mb-3",children:"Dark Themes"}),r.jsx("div",{className:"grid grid-cols-2 md:grid-cols-3 gap-4",children:$.map(W=>r.jsxs("button",{onClick:()=>R(W.id),className:`flex items-center space-x-3 p-3 rounded-lg border-2 transition-colors ${F===W.id?"border-primary":"border-border hover:border-text-muted"}`,children:[r.jsx("div",{className:"w-8 h-8 rounded-full flex items-center justify-center",style:{backgroundColor:`rgb(${W.palette.surface})`,border:`2px solid rgb(${W.palette.primary})`},children:r.jsx("div",{className:"w-4 h-4 rounded-full",style:{backgroundColor:`rgb(${W.palette.primary})`}})}),r.jsx("span",{className:"font-medium",children:W.name})]},W.id))})]})]})}),r.jsx(ti,{id:"general",title:"General Preferences",openSection:M,setOpenSection:H,children:r.jsxs("div",{className:"space-y-6 divide-y divide-border",children:[r.jsx(ka,{label:"Enable Haptic Feedback",checked:T,onChange:b,description:"Provides physical feedback on actions (on supported devices)."}),r.jsx("div",{className:"pt-6",children:r.jsx(ka,{label:"Disable UI Animations",checked:x,onChange:d,description:"Reduces motion for a simpler experience."})})]})}),r.jsx(ti,{id:"ai",title:"AI Features",openSection:M,setOpenSection:H,children:r.jsx(ka,{label:"Enable AI Content Generation",checked:N,onChange:w,description:"Allows using AI to generate series and questions."})}),r.jsx(ti,{id:"danger",title:"Danger Zone",openSection:M,setOpenSection:H,isDanger:!0,children:r.jsxs("div",{className:"space-y-6",children:[r.jsxs("div",{children:[r.jsx("h4",{className:"font-semibold text-text",children:"Reset Deck Progress"}),r.jsx("p",{className:"text-text-muted my-2 text-sm",children:"This will reset all spaced repetition data (due dates, intervals) for one or more decks. The cards themselves will not be deleted."}),r.jsxs(ve,{variant:"danger",onClick:o,children:[r.jsx(ae,{name:"refresh-ccw",className:"w-4 h-4 mr-2"}),"Reset Progress..."]})]}),r.jsxs("div",{className:"border-t border-red-500/30 pt-6",children:[r.jsx("h4",{className:"font-semibold text-text",children:"Factory Reset"}),r.jsx("p",{className:"text-text-muted my-2 text-sm",children:"Permanently delete all of your decks, folders, series, and settings. This action cannot be undone."}),r.jsxs(ve,{variant:"danger",onClick:v,children:[r.jsx(ae,{name:"trash-2",className:"w-4 h-4 mr-2"}),"Factory Reset..."]})]}),r.jsxs("div",{className:"border-t border-red-500/30 pt-6",children:[r.jsx("h4",{className:"font-semibold text-text",children:"Hard Reload & Clear Cache"}),r.jsx("p",{className:"text-text-muted my-2 text-sm",children:"Force a full reload of the application and clear all cached data. Use this if you are experiencing display issues or outdated content."}),r.jsxs(ve,{variant:"danger",onClick:Z,children:[r.jsx(ae,{name:"zap",className:"w-4 h-4 mr-2"}),"Clear Cache & Reload"]})]})]})}),r.jsx("div",{className:"text-center text-xs text-text-muted pt-4 pb-2",children:r.jsx("p",{children:"CogniFlow v1.2.0"})})]})},Ng=({card:s,onClose:p,onSave:o})=>{const[v,h]=U.useState(""),[u,l]=U.useState(""),{addToast:f}=er(),x=U.useRef(null);pr(x,!0),U.useEffect(()=>{s&&(h(s.front),l(s.back))},[s]);const d=b=>{if(b.preventDefault(),!v.trim()||!u.trim()){f("Both front and back fields are required.","error");return}o({id:(s==null?void 0:s.id)||"",front:v.trim(),back:u.trim()})},T=b=>{if(b.key==="Tab"){b.preventDefault();const N=b.target,w=N.selectionStart,I=N.selectionEnd;N.value=N.value.substring(0,w)+"	"+N.value.substring(I),N.selectionStart=N.selectionEnd=w+1}};return r.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-75 flex items-center justify-center z-50 p-4",children:r.jsx("div",{ref:x,className:"bg-surface rounded-lg shadow-xl w-full max-w-2xl transform transition-all relative",children:r.jsxs("form",{onSubmit:d,children:[r.jsxs("div",{className:"flex justify-between items-center p-4 border-b border-border",children:[r.jsx("h2",{className:"text-xl font-bold",children:s?"Edit Card":"Add New Card"}),r.jsx(ve,{type:"button",variant:"ghost",onClick:p,className:"p-1 h-auto",children:r.jsx(ae,{name:"x"})})]}),r.jsxs("div",{className:"p-6 space-y-4",children:[r.jsxs("div",{children:[r.jsx("label",{htmlFor:"card-front",className:"block text-sm font-medium text-text-muted mb-1",children:"Front"}),r.jsx("textarea",{id:"card-front",value:v,onChange:b=>h(b.target.value),onKeyDown:T,rows:5,className:"w-full p-2 bg-background border border-border rounded-md focus:ring-2 focus:ring-primary focus:outline-none",placeholder:"Enter front content (question, term, etc.)"})]}),r.jsxs("div",{children:[r.jsx("label",{htmlFor:"card-back",className:"block text-sm font-medium text-text-muted mb-1",children:"Back"}),r.jsx("textarea",{id:"card-back",value:u,onChange:b=>l(b.target.value),onKeyDown:T,rows:5,className:"w-full p-2 bg-background border border-border rounded-md focus:ring-2 focus:ring-primary focus:outline-none",placeholder:"Enter back content (answer, definition, etc.)"})]})]}),r.jsxs("div",{className:"flex justify-end p-4 bg-background/50 border-t border-border",children:[r.jsx(ve,{type:"button",variant:"secondary",onClick:p,className:"mr-2",children:"Cancel"}),r.jsx(ve,{type:"submit",variant:"primary",children:s?"Save Changes":"Add Card"})]})]})})})},jg=s=>{const p=new Date;p.setHours(0,0,0,0);const o=new Date(s);o.setHours(0,0,0,0);const v=o.getTime()-p.getTime(),h=Math.round(v/(1e3*60*60*24)),u=h<=0;let l;return h<0?l="Due":h===0?l="Due today":h===1?l="Due tomorrow":l=`Due in ${h} days`,{text:l,isDue:u}},Cg=({cards:s,onCardsChange:p,onAddCard:o,onBulkAdd:v})=>{const[h,u]=U.useState(null),[l,f]=U.useState(!1),[x,d]=U.useState(null),[T,b]=U.useState(!0),N=U.useRef(null),w=(F,R)=>{u(F),R&&(N.current=R.currentTarget),f(!0)},I=()=>{var F;f(!1),(F=N.current)==null||F.focus(),u(null)},k=(F,R)=>{d(F),R&&(N.current=R.currentTarget)},C=()=>{x&&p(s.filter(F=>F.id!==x.id)),d(null)},j=F=>{h?p(s.map(R=>R.id===F.id?{...R,...F}:R)):o(F),I()},O=F=>{p(s.map(R=>R.id===F?{...R,suspended:!1}:R))};return r.jsxs("div",{children:[r.jsx("div",{className:"border-b border-border",children:r.jsxs("button",{onClick:()=>b(!T),className:"w-full flex justify-between items-center text-left p-6","aria-expanded":T,"aria-controls":"card-list-content",children:[r.jsx("h3",{className:"text-xl font-semibold text-text",children:"Cards"}),r.jsx(ae,{name:"chevron-down",className:`w-6 h-6 transition-transform duration-300 ${T?"":"-rotate-90"} text-text-muted`})]})}),T&&r.jsxs("div",{id:"card-list-content",className:"animate-fade-in",children:[r.jsx("div",{className:"p-6",children:s.length>0?r.jsx("ul",{className:"space-y-4",children:s.map(F=>{const{text:R,isDue:M}=jg(F.dueDate);return r.jsxs("li",{className:`p-4 rounded-lg flex items-start justify-between transition-all ${F.suspended?"bg-yellow-500/10 opacity-70":"bg-background"}`,children:[r.jsxs("div",{className:"flex-1 min-w-0 mr-4",children:[r.jsxs("p",{className:"text-sm font-medium text-text truncate",children:[r.jsx("strong",{children:"Front:"})," ",F.front.replace(/<[^>]+>/g,"")]}),r.jsxs("p",{className:"text-sm text-text-muted truncate",children:[r.jsx("strong",{children:"Back:"})," ",F.back.replace(/<[^>]+>/g,"")]}),r.jsxs("div",{className:"mt-3 space-y-2",children:[r.jsx(fs,{level:wn(F)}),r.jsx("div",{className:"flex items-center gap-4 text-xs text-text-muted",children:r.jsxs("span",{className:`font-semibold ${M?"text-primary":""}`,children:[r.jsx(ae,{name:"zap",className:"w-3 h-3 inline-block mr-1"}),R]})})]})]}),r.jsxs("div",{className:"flex-shrink-0 flex items-center gap-2",children:[F.suspended?r.jsx(ve,{variant:"ghost",className:"p-2 h-auto text-yellow-600 dark:text-yellow-400",onClick:()=>O(F.id),title:"Unsuspend this card",children:r.jsx(ae,{name:"eye",className:"w-4 h-4"})}):r.jsx(ve,{variant:"ghost",className:"p-2 h-auto",onClick:H=>w(F,H),title:"Edit this card",children:r.jsx(ae,{name:"edit",className:"w-4 h-4"})}),r.jsx(ve,{variant:"ghost",className:"p-2 h-auto text-text-muted hover:text-red-500",onClick:H=>k(F,H),title:"Delete this card",children:r.jsx(ae,{name:"trash-2",className:"w-4 h-4"})})]})]},F.id)})}):r.jsxs("div",{className:"text-center text-text-muted py-8",children:[r.jsx(ae,{name:"laptop",className:"w-12 h-12 mx-auto mb-2 opacity-50"}),r.jsx("p",{children:"This deck has no cards yet."})]})}),r.jsxs("div",{className:"px-6 py-4 border-t border-border flex flex-wrap gap-2",children:[r.jsxs(ve,{variant:"secondary",onClick:F=>w(null,F),className:"flex-grow sm:flex-grow-0",children:[r.jsx(ae,{name:"plus",className:"w-5 h-5 mr-2"}),"Add New Card"]}),r.jsxs(ve,{variant:"ghost",onClick:v,className:"flex-grow sm:flex-grow-0",children:[r.jsx(ae,{name:"code",className:"w-5 h-5 mr-2"}),"Bulk Add via JSON"]})]})]}),l&&r.jsx(Ng,{card:h,onClose:I,onSave:j}),x&&r.jsx(wo,{isOpen:!!x,onClose:()=>d(null),onConfirm:C,title:"Delete Card",message:"Are you sure you want to delete this card? This action cannot be undone."})]})},Ig=({question:s,onClose:p,onSave:o})=>{const[v,h]=U.useState(""),[u,l]=U.useState(""),[f,x]=U.useState([]),[d,T]=U.useState(""),{addToast:b}=er(),N=U.useRef(null);pr(N,!0),U.useEffect(()=>{if(s)h(s.questionText),l(s.detailedExplanation),x(s.options.map(j=>({...j}))),T(s.correctAnswerId);else{const j=[{id:crypto.randomUUID(),text:""},{id:crypto.randomUUID(),text:""}];x(j)}},[s]);const w=(j,O)=>{x(f.map(F=>F.id===j?{...F,text:O}:F))},I=()=>{x([...f,{id:crypto.randomUUID(),text:""}])},k=j=>{if(f.length<=2){b("A question must have at least two options.","error");return}x(f.filter(O=>O.id!==j)),d===j&&T("")},C=j=>{if(j.preventDefault(),!v.trim()){b("Question text is required.","error");return}if(f.some(O=>!O.text.trim())){b("All options must have text.","error");return}if(!d){b("You must select a correct answer.","error");return}o({id:s==null?void 0:s.id,questionText:v.trim(),detailedExplanation:u.trim(),options:f,correctAnswerId:d,tags:(s==null?void 0:s.tags)||[]})};return r.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-75 flex items-center justify-center z-50 p-4",children:r.jsx("div",{ref:N,className:"bg-surface rounded-lg shadow-xl w-full max-w-3xl transform transition-all relative max-h-[90vh] flex flex-col",children:r.jsxs("form",{onSubmit:C,className:"flex flex-col h-full",children:[r.jsxs("div",{className:"flex-shrink-0 flex justify-between items-center p-4 border-b border-border",children:[r.jsx("h2",{className:"text-xl font-bold",children:s?"Edit Question":"Add New Question"}),r.jsx(ve,{type:"button",variant:"ghost",onClick:p,className:"p-1 h-auto",children:r.jsx(ae,{name:"x"})})]}),r.jsxs("div",{className:"p-6 space-y-4 overflow-y-auto",children:[r.jsxs("div",{children:[r.jsx("label",{htmlFor:"question-text",className:"block text-sm font-medium text-text-muted mb-1",children:"Question Text"}),r.jsx("textarea",{id:"question-text",value:v,onChange:j=>h(j.target.value),rows:3,className:"w-full p-2 bg-background border border-border rounded-md focus:ring-2 focus:ring-primary focus:outline-none",placeholder:"What is the capital of France?"})]}),r.jsxs("div",{children:[r.jsx("label",{className:"block text-sm font-medium text-text-muted mb-1",children:"Options"}),r.jsx("div",{className:"space-y-2",children:f.map((j,O)=>r.jsxs("div",{className:"flex items-center gap-2",children:[r.jsx("input",{type:"radio",name:"correct-answer",checked:d===j.id,onChange:()=>T(j.id),className:"h-5 w-5 text-primary bg-border/50 border-border focus:ring-primary","aria-label":`Set option ${O+1} as correct`}),r.jsx("input",{type:"text",value:j.text,onChange:F=>w(j.id,F.target.value),className:"flex-grow p-2 bg-background border border-border rounded-md focus:ring-2 focus:ring-primary focus:outline-none",placeholder:`Option ${O+1}`}),r.jsx(ve,{type:"button",variant:"ghost",onClick:()=>k(j.id),className:"p-2 h-auto","aria-label":`Remove option ${O+1}`,children:r.jsx(ae,{name:"trash-2",className:"w-4 h-4"})})]},j.id))}),r.jsxs(ve,{type:"button",variant:"ghost",onClick:I,className:"mt-2 text-primary",children:[r.jsx(ae,{name:"plus",className:"w-4 h-4 mr-2"}),"Add Option"]})]}),r.jsxs("div",{children:[r.jsx("label",{htmlFor:"detailed-explanation",className:"block text-sm font-medium text-text-muted mb-1",children:"Detailed Explanation (Optional)"}),r.jsx("textarea",{id:"detailed-explanation",value:u,onChange:j=>l(j.target.value),rows:4,className:"w-full p-2 bg-background border border-border rounded-md focus:ring-2 focus:ring-primary focus:outline-none",placeholder:"Explain why the correct answer is right and others are wrong."})]})]}),r.jsxs("div",{className:"flex-shrink-0 flex justify-end p-4 bg-background/50 border-t border-border",children:[r.jsx(ve,{type:"button",variant:"secondary",onClick:p,className:"mr-2",children:"Cancel"}),r.jsx(ve,{type:"submit",variant:"primary",children:s?"Save Changes":"Add Question"})]})]})})})},sn=s=>{if(!s)return"";try{return new DOMParser().parseFromString(s,"text/html").body.textContent||""}catch{return String(s).replace(/<[^>]+>/g,"")}},Tg=s=>{const p=new Date;p.setHours(0,0,0,0);const o=new Date(s);o.setHours(0,0,0,0);const v=o.getTime()-p.getTime(),h=Math.round(v/(1e3*60*60*24)),u=h<=0;let l;return h<0?l="Due":h===0?l="Due today":h===1?l="Due tomorrow":l=`Due in ${h} days`,{text:l,isDue:u}},Dg=({questions:s,onQuestionsChange:p,onAddQuestion:o,onBulkAdd:v,onGenerateAI:h,isGeneratingAI:u})=>{const[l,f]=U.useState(null),[x,d]=U.useState(!1),[T,b]=U.useState(null),[N,w]=U.useState(!0),[I,k]=U.useState(null),C=U.useRef(null),j=U.useRef(null),{aiFeaturesEnabled:O}=on();U.useEffect(()=>{const Z=de=>{j.current&&!j.current.contains(de.target)&&k(null)};return I&&document.addEventListener("mousedown",Z),()=>{document.removeEventListener("mousedown",Z)}},[I]);const F=(Z,de)=>{f(Z),de&&(C.current=de.currentTarget),d(!0)},R=()=>{var Z;d(!1),(Z=C.current)==null||Z.focus(),f(null)},M=(Z,de)=>{b(Z),de&&(C.current=de.currentTarget)},H=()=>{T&&p(s.filter(Z=>Z.id!==T.id)),b(null)},V=Z=>{if(l&&Z.id)p(s.map(de=>de.id===Z.id?{...de,...Z}:de));else{const{id:de,...$}=Z,W={...$,questionType:"multipleChoice",suspended:!1};o(W)}R()},oe=Z=>{p(s.map(de=>de.id===Z?{...de,suspended:!0}:de)),k(null)},J=Z=>{p(s.map(de=>de.id===Z?{...de,suspended:!1}:de)),k(null)};return r.jsxs("div",{children:[r.jsx("div",{className:"border-b border-border",children:r.jsxs("button",{onClick:()=>w(!N),className:"w-full flex justify-between items-center text-left p-6","aria-expanded":N,"aria-controls":"question-list-content",children:[r.jsx("h3",{className:"text-xl font-semibold text-text",children:"Questions"}),r.jsx(ae,{name:"chevron-down",className:`w-6 h-6 transition-transform duration-300 ${N?"":"-rotate-90"} text-text-muted`})]})}),N&&r.jsxs("div",{id:"question-list-content",className:"animate-fade-in",children:[r.jsx("div",{className:"p-6",children:s.length>0?r.jsx("ul",{className:"space-y-4",children:s.map(Z=>{const{text:de,isDue:$}=Tg(Z.dueDate),W=sn(Z.questionText);return r.jsxs("li",{className:`p-4 rounded-lg flex items-start justify-between transition-all ${Z.suspended?"bg-yellow-500/10 opacity-70":"bg-background"}`,children:[r.jsxs("div",{className:"flex-1 min-w-0 mr-4",children:[r.jsx("p",{className:"text-base font-medium text-text break-words truncate",title:W,children:W}),r.jsxs("div",{className:"mt-3 space-y-2",children:[r.jsx(fs,{level:wn(Z)}),r.jsxs("div",{className:"flex items-center gap-4 text-xs text-text-muted",children:[r.jsxs("span",{className:`font-semibold ${$?"text-primary":""}`,children:[r.jsx(ae,{name:"zap",className:"w-3 h-3 inline-block mr-1"}),de]}),r.jsxs("span",{children:[r.jsx(ae,{name:"list",className:"w-3 h-3 inline-block mr-1"}),Z.options.length," options"]})]})]})]}),r.jsxs("div",{className:"flex-shrink-0 relative",ref:I===Z.id?j:null,children:[r.jsx(ve,{variant:"ghost",className:"p-2 h-auto",onClick:_=>{_.stopPropagation(),k(ie=>ie===Z.id?null:Z.id)},"aria-label":"More options for question",children:r.jsx(ae,{name:"more-vertical",className:"w-5 h-5"})}),I===Z.id&&r.jsxs("div",{className:"absolute right-0 mt-2 w-48 bg-surface rounded-md shadow-lg py-1 z-10 ring-1 ring-black ring-opacity-5 animate-fade-in",style:{animationDuration:"150ms"},children:[r.jsxs("button",{type:"button",onClick:_=>{F(Z,_),k(null)},className:"flex items-center w-full px-4 py-2 text-sm text-left text-text hover:bg-border/20",children:[r.jsx(ae,{name:"edit",className:"w-4 h-4 mr-3"}),"Edit"]}),Z.suspended?r.jsxs("button",{type:"button",onClick:()=>J(Z.id),className:"flex items-center w-full px-4 py-2 text-sm text-left text-text hover:bg-border/20",children:[r.jsx(ae,{name:"eye",className:"w-4 h-4 mr-3"}),"Unsuspend"]}):r.jsxs("button",{type:"button",onClick:()=>oe(Z.id),className:"flex items-center w-full px-4 py-2 text-sm text-left text-text hover:bg-border/20",children:[r.jsx(ae,{name:"eye-off",className:"w-4 h-4 mr-3"}),"Suspend"]}),r.jsx("div",{className:"border-t border-border my-1"}),r.jsxs("button",{type:"button",onClick:_=>{M(Z,_),k(null)},className:"flex items-center w-full px-4 py-2 text-sm text-left text-red-600 dark:text-red-400 hover:bg-red-50 dark:hover:bg-red-900/20",children:[r.jsx(ae,{name:"trash-2",className:"w-4 h-4 mr-3"}),"Delete"]})]})]})]},Z.id)})}):r.jsxs("div",{className:"text-center text-text-muted py-8",children:[r.jsx(ae,{name:"help-circle",className:"w-12 h-12 mx-auto mb-2 opacity-50"}),r.jsx("p",{children:"This deck has no questions yet."})]})}),r.jsxs("div",{className:"px-6 py-4 border-t border-border flex flex-wrap gap-2",children:[r.jsxs(ve,{variant:"secondary",onClick:Z=>F(null,Z),className:"flex-grow sm:flex-grow-0",children:[r.jsx(ae,{name:"plus",className:"w-5 h-5 mr-2"}),"Add New Question"]}),r.jsxs(ve,{variant:"ghost",onClick:v,className:"flex-grow sm:flex-grow-0",children:[r.jsx(ae,{name:"code",className:"w-5 h-5 mr-2"}),"Bulk Add via JSON"]}),O&&h&&r.jsxs(ve,{variant:"ghost",onClick:h,className:"flex-grow sm:flex-grow-0",disabled:u,children:[u?r.jsx(sr,{size:"sm"}):r.jsx(ae,{name:"zap",className:"w-5 h-5 mr-2"}),u?"Generating...":"Generate with AI"]})]})]}),x&&r.jsx(Ig,{question:l,onClose:R,onSave:V}),T&&r.jsx(wo,{isOpen:!!T,onClose:()=>b(null),onConfirm:H,title:"Delete Question",message:"Are you sure you want to delete this question? This action cannot be undone."})]})},Ag=({isOpen:s,onClose:p,onAddItems:o,deckType:v})=>{const[h,u]=U.useState(""),{addToast:l}=er(),f=U.useRef(null);pr(f,s);const x=U.useMemo(()=>v===Ae.Flashcard?`[
  {
    "front": "What is the capital of Japan?",
    "back": "Tokyo"
  },
  {
    "front": "What is 2 + 2?",
    "back": "4"
  }
]`:`[
  {
    "questionText": "Which planet is known as the Red Planet?",
    "options": [
      { "id": "1", "text": "Earth" },
      { "id": "2", "text": "Mars" }
    ],
    "correctAnswerId": "2",
    "detailedExplanation": "Mars is called the Red Planet because of its reddish appearance."
  }
]`,[v]),d=b=>{if(b.preventDefault(),!h.trim()){l("JSON content cannot be empty.","error");return}try{const N=ip(h,v);if(N.length===0){l("The JSON array is empty. No items were added.","info"),p();return}o(N),l(`Successfully added ${N.length} item(s).`,"success"),p()}catch(N){l(N instanceof Error?N.message:"Invalid JSON format.","error")}},T=b=>{if(b.key==="Tab"){b.preventDefault();const N=b.target,w=N.selectionStart,I=N.selectionEnd;N.value=N.value.substring(0,w)+"  "+N.value.substring(I),N.selectionStart=N.selectionEnd=w+2}};return s?r.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-75 flex items-center justify-center z-50 p-4",children:r.jsx("div",{ref:f,className:"bg-surface rounded-lg shadow-xl w-full max-w-2xl transform transition-all relative",children:r.jsxs("form",{onSubmit:d,children:[r.jsxs("div",{className:"flex justify-between items-center p-4 border-b border-border",children:[r.jsx("h2",{className:"text-xl font-bold",children:"Bulk Add via JSON"}),r.jsx(ve,{type:"button",variant:"ghost",onClick:p,className:"p-1 h-auto",children:r.jsx(ae,{name:"x"})})]}),r.jsxs("div",{className:"p-6",children:[r.jsxs("div",{className:"flex justify-between items-baseline mb-1",children:[r.jsxs("label",{htmlFor:"json-content",className:"block text-sm font-medium text-text-muted",children:["Paste an array of ",v===Ae.Flashcard?"card":"question"," objects"]}),r.jsxs(Ut,{href:"/instructions/json",onClick:p,className:"text-sm text-primary hover:underline inline-flex items-center gap-1",children:[r.jsx(ae,{name:"help-circle",className:"w-4 h-4"}),"Format Guide"]})]}),r.jsx("textarea",{id:"json-content",value:h,onChange:b=>u(b.target.value),onKeyDown:T,rows:15,className:"w-full p-2 bg-background border border-border rounded-md focus:ring-2 focus:ring-primary focus:outline-none font-mono text-sm",placeholder:x})]}),r.jsxs("div",{className:"flex justify-end p-4 bg-background/50 border-t border-border",children:[r.jsx(ve,{type:"button",variant:"secondary",onClick:p,className:"mr-2",children:"Cancel"}),r.jsx(ve,{type:"submit",variant:"primary",children:"Add Items"})]})]})})}):null},Og=({data:s,total:p})=>p===0?r.jsx("div",{className:"w-full bg-gray-200 dark:bg-gray-700 rounded-full h-4"}):r.jsx("div",{className:"flex w-full h-4 bg-gray-200 dark:bg-gray-700 rounded-full overflow-hidden",role:"progressbar","aria-valuenow":s.reduce((o,v)=>o+v.value,0),"aria-valuemin":0,"aria-valuemax":p,children:s.map((o,v)=>{if(o.value===0)return null;const h=o.value/p*100;return r.jsx("div",{className:`${o.color} transition-all duration-500`,style:{width:`${h}%`},title:`${o.label}: ${o.value} item(s)`},v)})}),Rg=({data:s})=>{const p=Math.max(...s.map(d=>d.count),1),o=350,v=120,h={top:25,right:15,bottom:25,left:15},u=o-h.left-h.right,l=v-h.top-h.bottom,f=u/s.length,x=Math.max(6,f*.1);return r.jsxs("div",{className:"w-full",children:[r.jsx("h4",{className:"text-sm font-semibold text-gray-700 dark:text-gray-300 mb-2",children:"Upcoming Due Dates (Next 7 Days)"}),r.jsx("div",{className:"bg-gray-50 dark:bg-gray-900/50 p-2 rounded-lg border border-gray-200 dark:border-gray-700/50",children:r.jsxs("svg",{viewBox:`0 0 ${o} ${v}`,width:"100%",height:"auto","aria-labelledby":"due-date-graph-title",role:"img",className:"overflow-visible",children:[r.jsx("title",{id:"due-date-graph-title",children:"A bar chart showing the number of items due over the next 7 days."}),s.map((d,T)=>{const b=d.count>0?d.count/p*l:0,N=h.left+T*f+(f-x)/2,w=h.top+l-b;return r.jsxs("g",{className:"group",style:{cursor:"pointer"},children:[r.jsxs("title",{children:[d.date,": ",d.count," item",d.count!==1?"s":""," due"]}),r.jsx("rect",{x:N,y:w,width:x,height:b,rx:"2",className:"fill-blue-500 transition-colors group-hover:fill-blue-400"}),r.jsx("text",{x:N+x/2,y:w-6,textAnchor:"middle",className:"fill-gray-600 dark:fill-gray-300 font-semibold text-sm transition-opacity opacity-0 group-hover:opacity-100 pointer-events-none",children:d.count}),r.jsx("text",{x:N+x/2,y:v-h.bottom+15,textAnchor:"middle",className:"fill-gray-400 dark:fill-gray-500 text-xs pointer-events-none",children:d.dayLabel})]},T)})]})})]})},Mg=({reviews:s})=>{const[p,o]=U.useState(null),v=U.useMemo(()=>{if(!s||s.length===0)return[];const k=new Map;s.forEach(j=>{const O=new Date(j.timestamp).toISOString().split("T")[0],F=k.get(O)||{totalMastery:0,count:0};F.totalMastery+=j.masteryLevel,F.count++,k.set(O,F)});const C=Array.from(k.entries()).map(([j,{totalMastery:O,count:F}])=>({date:new Date(j),avgMastery:O/F}));return C.sort((j,O)=>j.date.getTime()-O.date.getTime()),C.slice(-90)},[s]);if(v.length<2)return r.jsx("div",{className:"text-center text-sm text-text-muted py-8",children:"Not enough review history to plot a graph."});const h=350,u=150,l={top:10,right:10,bottom:20,left:30},f=h-l.left-l.right,x=u-l.top-l.bottom,d=v[0].date.getTime(),T=v[v.length-1].date.getTime(),b=k=>(k.getTime()-d)/(T-d)*f+l.left,N=k=>u-l.bottom-k*x,w=v.map(k=>`${b(k.date)},${N(k.avgMastery)}`).join(" L "),I=k=>{const C=k.currentTarget.getBoundingClientRect(),j=k.clientX-C.left;let O=v[0],F=1/0;v.forEach(R=>{const M=b(R.date),H=Math.abs(j-M);H<F&&(F=H,O=R)}),F<20?o({x:b(O.date),y:N(O.avgMastery),data:O}):o(null)};return r.jsx("div",{className:"w-full",children:r.jsxs("svg",{viewBox:`0 0 ${h} ${u}`,width:"100%",height:"auto","aria-labelledby":"mastery-graph-title",role:"img",className:"overflow-visible",onMouseMove:I,onMouseLeave:()=>o(null),children:[r.jsx("title",{id:"mastery-graph-title",children:"A line chart showing average mastery over time."}),[0,.25,.5,.75,1].map(k=>r.jsxs("g",{children:[r.jsx("line",{x1:l.left,y1:N(k),x2:h-l.right,y2:N(k),className:"stroke-current text-border/70",strokeWidth:"0.5"}),r.jsx("text",{x:l.left-8,y:N(k)+4,textAnchor:"end",className:"text-xs fill-text-muted",children:`${k*100}%`})]},k)),r.jsx("text",{x:l.left,y:u-5,textAnchor:"start",className:"text-xs fill-text-muted",children:v[0].date.toLocaleDateString("en-us",{month:"short",day:"numeric"})}),r.jsx("text",{x:h-l.right,y:u-5,textAnchor:"end",className:"text-xs fill-text-muted",children:v[v.length-1].date.toLocaleDateString("en-us",{month:"short",day:"numeric"})}),r.jsx("path",{d:`M ${w}`,className:"stroke-primary",fill:"none",strokeWidth:"2",strokeLinejoin:"round",strokeLinecap:"round"}),p&&r.jsxs("g",{children:[r.jsx("line",{x1:p.x,y1:l.top,x2:p.x,y2:u-l.bottom,className:"stroke-current text-border",strokeDasharray:"2,2"}),r.jsx("circle",{cx:p.x,cy:p.y,r:"4",className:"fill-primary"}),r.jsxs("g",{transform:`translate(${p.x>h/2?p.x-100:p.x+10}, ${l.top})`,children:[r.jsx("rect",{x:"0",y:"0",width:"90",height:"35",rx:"4",className:"fill-surface opacity-90",stroke:"rgb(var(--color-border))"}),r.jsx("text",{x:"5",y:"15",className:"text-xs fill-text font-semibold",children:p.data.date.toLocaleDateString("en-us",{month:"short",day:"numeric"})}),r.jsxs("text",{x:"5",y:"30",className:"text-xs fill-text-muted",children:["Mastery: ",Math.round(p.data.avgMastery*100),"%"]})]})]})]})})},Lg=({block:s,onClose:p,onSave:o})=>{const[v,h]=U.useState(""),[u,l]=U.useState([]),{addToast:f}=er(),x=U.useRef(null);pr(x,!0),U.useEffect(()=>{s?(h(s.infoCard.content),l(s.questions.map(C=>({...C})))):l([{id:crypto.randomUUID(),questionText:"",options:[{id:crypto.randomUUID(),text:""},{id:crypto.randomUUID(),text:""}],correctAnswerId:"",detailedExplanation:""}])},[s]);const d=(C,j,O)=>{const F=[...u];F[C][j]=O,l(F)},T=(C,j,O)=>{const F=[...u];F[C].options&&(F[C].options[j].text=O,l(F))},b=()=>{l([...u,{id:crypto.randomUUID(),questionText:"",options:[{id:crypto.randomUUID(),text:""},{id:crypto.randomUUID(),text:""}],correctAnswerId:"",detailedExplanation:""}])},N=C=>{if(u.length<=1){f("A learning block must have at least one question.","error");return}l(u.filter((j,O)=>O!==C))},w=C=>{var O;const j=[...u];(O=j[C].options)==null||O.push({id:crypto.randomUUID(),text:""}),l(j)},I=(C,j)=>{const O=[...u],F=O[C];if(F.options&&F.options.length>2){const R=F.options.splice(j,1)[0];F.correctAnswerId===R.id&&(F.correctAnswerId=""),l(O)}else f("A question must have at least two options.","error")},k=C=>{var R,M;if(C.preventDefault(),!v.trim()){f("Informational content cannot be empty.","error");return}for(const H of u){if(!((R=H.questionText)!=null&&R.trim())){f("Question text is required.","error");return}if((M=H.options)!=null&&M.some(V=>!V.text.trim())){f("All options must have text.","error");return}if(!H.correctAnswerId){f("You must select a correct answer for each question.","error");return}}const j=new Date().toISOString(),O={id:(s==null?void 0:s.infoCard.id)||crypto.randomUUID(),content:v,unlocksQuestionIds:u.map(H=>H.id)},F=u.map((H,V)=>{const oe=s==null?void 0:s.questions[V];return{...oe,...H,id:H.id,questionType:"multipleChoice",infoCardIds:[O.id],dueDate:(oe==null?void 0:oe.dueDate)||j,interval:(oe==null?void 0:oe.interval)||0,easeFactor:(oe==null?void 0:oe.easeFactor)||us,tags:H.tags||[]}});o({infoCard:O,questions:F})};return r.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-75 flex items-center justify-center z-50 p-4",children:r.jsx("div",{ref:x,className:"bg-surface rounded-lg shadow-xl w-full max-w-4xl transform transition-all relative max-h-[90vh] flex flex-col",children:r.jsxs("form",{onSubmit:k,className:"flex flex-col h-full",children:[r.jsxs("header",{className:"flex-shrink-0 flex justify-between items-center p-4 border-b border-border",children:[r.jsx("h2",{className:"text-xl font-bold",children:s?"Edit Learning Block":"Add New Learning Block"}),r.jsx(ve,{type:"button",variant:"ghost",onClick:p,className:"p-1 h-auto",children:r.jsx(ae,{name:"x"})})]}),r.jsxs("main",{className:"p-6 space-y-6 overflow-y-auto",children:[r.jsxs("div",{children:[r.jsx("label",{htmlFor:"info-content",className:"block text-sm font-bold text-text mb-1",children:"Informational Content (Supports HTML)"}),r.jsx("textarea",{id:"info-content",value:v,onChange:C=>h(C.target.value),rows:8,className:"w-full p-2 bg-background border border-border rounded-md focus:ring-2 focus:ring-primary focus:outline-none",placeholder:"Explain a concept here..."})]}),r.jsxs("div",{className:"border-t border-border pt-4",children:[r.jsx("h3",{className:"text-lg font-bold text-text mb-2",children:"Questions"}),r.jsxs("div",{className:"space-y-6",children:[u.map((C,j)=>{var O;return r.jsxs("div",{className:"p-4 bg-background rounded-lg border border-border space-y-3 relative",children:[r.jsxs("label",{className:"block text-sm font-medium text-text-muted",children:["Question ",j+1]}),r.jsx("textarea",{value:C.questionText,onChange:F=>d(j,"questionText",F.target.value),rows:2,className:"w-full p-2 bg-surface border border-border rounded-md focus:ring-2 focus:ring-primary focus:outline-none",placeholder:"Question related to the info above"}),r.jsx("div",{className:"space-y-2",children:(O=C.options)==null?void 0:O.map((F,R)=>r.jsxs("div",{className:"flex items-center gap-2",children:[r.jsx("input",{type:"radio",name:`correct-answer-${j}`,checked:C.correctAnswerId===F.id,onChange:()=>d(j,"correctAnswerId",F.id),className:"h-5 w-5 text-primary bg-border/50 border-border focus:ring-primary"}),r.jsx("input",{type:"text",value:F.text,onChange:M=>T(j,R,M.target.value),className:"flex-grow p-2 bg-surface border border-border rounded-md focus:ring-2 focus:ring-primary focus:outline-none",placeholder:`Option ${R+1}`}),r.jsx(ve,{type:"button",variant:"ghost",onClick:()=>I(j,R),className:"p-2 h-auto text-text-muted hover:text-red-500",children:r.jsx(ae,{name:"x",className:"w-4 h-4"})})]},F.id||R))}),r.jsxs(ve,{type:"button",variant:"ghost",onClick:()=>w(j),size:"sm",children:[r.jsx(ae,{name:"plus",className:"w-4 h-4 mr-1"}),"Add Option"]}),r.jsx("textarea",{value:C.detailedExplanation,onChange:F=>d(j,"detailedExplanation",F.target.value),rows:2,className:"w-full p-2 bg-surface border border-border rounded-md focus:ring-2 focus:ring-primary focus:outline-none",placeholder:"Detailed explanation for the answer"}),r.jsx(ve,{type:"button",variant:"ghost",onClick:()=>N(j),className:"absolute top-2 right-2 p-2 h-auto text-text-muted hover:text-red-500",children:r.jsx(ae,{name:"trash-2",className:"w-4 h-4"})})]},C.id||j)}),r.jsxs(ve,{type:"button",variant:"secondary",onClick:b,children:[r.jsx(ae,{name:"plus",className:"w-4 h-4 mr-2"}),"Add Question"]})]})]})]}),r.jsxs("footer",{className:"flex-shrink-0 flex justify-end p-4 bg-background/50 border-t border-border",children:[r.jsx(ve,{type:"button",variant:"secondary",onClick:p,className:"mr-2",children:"Cancel"}),r.jsx(ve,{type:"submit",variant:"primary",children:s?"Save Changes":"Add Block"})]})]})})})},Fg=({deck:s,onSaveBlock:p,onDeleteBlock:o})=>{const[v,h]=U.useState(null),[u,l]=U.useState(!1),f=U.useRef(null),x=(N,w)=>{h(N),w&&(f.current=w.currentTarget),l(!0)},d=()=>{var N;l(!1),(N=f.current)==null||N.focus(),h(null)},T=N=>{p(N),d()},b=U.useMemo(()=>s.infoCards.map(N=>({infoCard:N,questions:s.questions.filter(w=>{var I;return(I=w.infoCardIds)==null?void 0:I.includes(N.id)})})),[s.infoCards,s.questions]);return r.jsxs("div",{children:[r.jsxs("div",{className:"border-b border-border p-6",children:[r.jsx("h3",{className:"text-xl font-semibold text-text",children:"Learning Blocks"}),r.jsx("p",{className:"text-sm text-text-muted mt-1",children:"Each block contains an info card and its related questions."})]}),r.jsx("div",{className:"p-6",children:b.length>0?r.jsx("ul",{className:"space-y-4",children:b.map(N=>r.jsx("li",{className:"p-4 rounded-lg bg-background border border-border",children:r.jsxs("div",{className:"flex items-start justify-between",children:[r.jsxs("div",{className:"flex-1 min-w-0 mr-4",children:[r.jsxs("div",{className:"flex items-center gap-2 text-text font-semibold",children:[r.jsx(ae,{name:"book-open",className:"w-5 h-5 text-purple-500 flex-shrink-0"}),r.jsx("p",{className:"truncate",title:sn(N.infoCard.content),children:sn(N.infoCard.content)})]}),N.questions.length>0&&r.jsx("ul",{className:"mt-2 pl-7 space-y-1",children:N.questions.map(w=>r.jsxs("li",{className:"flex items-center gap-2 text-sm text-text-muted",children:[r.jsx(ae,{name:"help-circle",className:"w-4 h-4 flex-shrink-0"}),r.jsx("span",{className:"truncate",title:sn(w.questionText),children:sn(w.questionText)})]},w.id))})]}),r.jsxs("div",{className:"flex-shrink-0 flex items-center gap-1",children:[r.jsx(ve,{variant:"ghost",className:"p-2 h-auto",onClick:w=>x(N,w),title:"Edit this block",children:r.jsx(ae,{name:"edit",className:"w-4 h-4"})}),r.jsx(ve,{variant:"ghost",className:"p-2 h-auto text-text-muted hover:text-red-500",onClick:()=>o(N.infoCard.id),title:"Delete this block",children:r.jsx(ae,{name:"trash-2",className:"w-4 h-4"})})]})]})},N.infoCard.id))}):r.jsxs("div",{className:"text-center text-text-muted py-8",children:[r.jsx(ae,{name:"layers",className:"w-12 h-12 mx-auto mb-2 opacity-50"}),r.jsx("p",{children:"This deck has no learning blocks yet."})]})}),r.jsx("div",{className:"px-6 py-4 border-t border-border flex flex-wrap gap-2",children:r.jsxs(ve,{variant:"secondary",onClick:N=>x(null,N),className:"flex-grow sm:flex-grow-0",children:[r.jsx(ae,{name:"plus",className:"w-5 h-5 mr-2"}),"Add Learning Block"]})}),u&&r.jsx(Lg,{block:v,onClose:d,onSave:T})]})},Pg=s=>{const p=new Date;p.setHours(23,59,59,999);const o=s.type===Ae.Flashcard?s.cards:(s.type===Ae.Learning,s.questions);return Array.isArray(o)?o.filter(v=>!v.suspended&&new Date(v.dueDate)<=p).length:0},Ug=s=>{const p={new:0,learning:0,young:0,mature:0};return s.forEach(o=>{o.interval===0?p.new++:o.interval<7?p.learning++:o.interval<21?p.young++:p.mature++}),p},zg=({deck:s})=>{const[p,o]=U.useState([]),[v,h]=U.useState(!0),u=s.type===Ae.Flashcard?s.cards:(s.type===Ae.Learning,s.questions);U.useEffect(()=>{(async()=>{h(!0);try{const x=await Xm(s.id);o(x)}catch(x){console.error("Failed to fetch review history for deck:",x)}finally{h(!1)}})()},[s.id]);const l=U.useMemo(()=>{if(!p.length)return[];const f=new Map;return p.forEach(x=>{x.rating===mt.Again&&f.set(x.itemId,(f.get(x.itemId)||0)+1)}),Array.from(f.entries()).sort((x,d)=>d[1]-x[1]).slice(0,5).map(([x,d])=>{const T=u.find(b=>b.id===x);return T?{...T,failureCount:d}:null}).filter(x=>!!x)},[p,u]);return v?r.jsx("div",{className:"flex justify-center items-center p-8",children:r.jsx(sr,{})}):p.length===0?r.jsxs("div",{className:"text-center py-10 bg-surface rounded-lg border border-border",children:[r.jsx(ae,{name:"trending-up",className:"w-12 h-12 mx-auto text-text-muted/50"}),r.jsx("h3",{className:"mt-2 text-xl font-medium text-text",children:"No Statistics Yet"}),r.jsx("p",{className:"mt-1 text-sm text-text-muted",children:"Complete a study session for this deck to see your stats."})]}):r.jsx("div",{className:"space-y-8",children:r.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-8",children:[r.jsxs("div",{className:"bg-surface p-6 rounded-lg shadow-md border border-border",children:[r.jsx("h3",{className:"text-xl font-semibold text-text mb-4",children:"Mastery Over Time"}),r.jsx("p",{className:"text-sm text-text-muted mb-4",children:"Average mastery level of reviewed cards per day over the last 90 days of activity."}),r.jsx(Mg,{reviews:p})]}),r.jsxs("div",{className:"bg-surface p-6 rounded-lg shadow-md border border-border",children:[r.jsx("h3",{className:"text-xl font-semibold text-text mb-4",children:"Most Difficult Items"}),r.jsx("p",{className:"text-sm text-text-muted mb-4",children:`Items you've marked "Again" most frequently.`}),l.length>0?r.jsx("ul",{className:"space-y-3",children:l.map(f=>{const d=("questionText"in f?f.questionText:f.front).replace(/<[^>]+>/g,"").trim();return r.jsxs("li",{className:"p-3 bg-background rounded-md border border-border",children:[r.jsx("p",{className:"font-semibold text-sm text-text break-words truncate",title:d,children:d}),r.jsxs("p",{className:"text-xs text-red-500 font-medium",children:['Marked "Again" ',f.failureCount," time",f.failureCount>1?"s":""]})]},f.id)})}):r.jsx("p",{className:"text-sm text-text-muted",children:"No items have been repeatedly marked as difficult. Great job!"})]})]})})},qg=({deck:s,sessionsToResume:p,onUpdateDeck:o,onDeleteDeck:v,onUpdateLastOpened:h,openConfirmModal:u,onGenerateQuestionsForDeck:l,onGenerateContentForLearningDeck:f,onSaveLearningBlock:x,onDeleteLearningBlock:d})=>{var Se;const[T,b]=U.useState(!1),[N,w]=U.useState(s.name),[I,k]=U.useState(s.description||""),[C,j]=U.useState(s.folderId||""),[O,F]=U.useState(!1),[R,M]=U.useState("overview"),{navigate:H}=Ln(),{addToast:V}=er(),{aiFeaturesEnabled:oe}=on(),{folders:J,aiGenerationStatus:Z}=Ke(),de=s.type===Ae.Flashcard?s.cards:(s.type===Ae.Learning,s.questions);U.useEffect(()=>{h(s.id)},[s.id,h]),U.useEffect(()=>{(s.archived||s.deletedAt)&&H("/")},[s.archived,s.deletedAt,H]);const $=()=>{o({...s,name:N,description:I,folderId:C||null}),b(!1)},W=()=>{w(s.name),k(s.description||""),j(s.folderId||""),b(!1)},_=Ee=>{if(s.type===Ae.Flashcard&&Ee.every(Le=>"front"in Le)){const Le=Tc(Ee),qe=[...s.cards,...Le];o({...s,cards:qe})}else if((s.type===Ae.Quiz||s.type===Ae.Learning)&&Ee.every(Le=>"questionText"in Le)){const Le=wr(Ee),te=[...s.questions,...Le];o({...s,questions:te})}},ie=()=>{u({title:"Move Deck to Trash",message:`Are you sure you want to move the deck "${s.name}" to the trash? It will be permanently deleted after 10 days. This will also remove it from any series it belongs to.`,onConfirm:()=>v(s.id)})},be=Z.isGenerating&&Z.generatingDeckId===s.id,ge=de.filter(Ee=>!Ee.suspended),je=de.length-ge.length,fe=Ug(ge),B=Pg(s),S=p.has(s.id),A=U.useMemo(()=>ge.length===0?0:ge.reduce((Le,qe)=>Le+wn(qe),0)/ge.length,[ge]),ce=U.useMemo(()=>{const Ee=new Date;Ee.setHours(0,0,0,0);const Le=Array(7).fill(0),qe=[],te=[];for(let Y=0;Y<7;Y++){const g=new Date(Ee);g.setDate(Ee.getDate()+Y),Y===0?qe.push("Today"):Y===1?qe.push("Tom"):qe.push(g.toLocaleDateString("en-US",{weekday:"short"})),te.push(g.toLocaleDateString("en-US",{month:"short",day:"numeric"}));const ee=g.getTime();de.forEach(G=>{if(G.suspended)return;const P=new Date(G.dueDate);P.setHours(0,0,0,0),P.getTime()===ee&&Le[Y]++})}return qe.map((Y,g)=>({dayLabel:Y,count:Le[g],date:te[g]}))},[de]),pe=U.useMemo(()=>de.length===0?"No Items to Study":s.locked?"Deck is Locked":s.type===Ae.Quiz||s.type===Ae.Learning?S?"Resume Quiz":`Start Quiz (${B} due)`:S?"Resume Study":`Study Cards (${B} due)`,[s.type,S,B,s.locked,de.length]),me=[{value:fe.new,color:"bg-blue-500",label:"New"},{value:fe.learning,color:"bg-orange-500",label:"Learning"},{value:fe.young,color:"bg-teal-500",label:"Young"},{value:fe.mature,color:"bg-green-500",label:"Mature"}],Te=Ee=>`px-4 py-2 text-sm font-medium transition-colors ${R===Ee?"border-b-2 border-primary text-text":"text-text-muted hover:text-text"}`,he=(s.type===Ae.Quiz||s.type===Ae.Learning)&&de.length===0;return r.jsxs("div",{className:"max-w-4xl mx-auto animate-fade-in space-y-6",children:[r.jsx("div",{className:"bg-surface rounded-lg shadow-md p-6 border border-border",children:T?r.jsxs("div",{className:"space-y-4 animate-fade-in",children:[r.jsxs("div",{children:[r.jsx("label",{htmlFor:"deck-name-edit",className:"block text-sm font-medium text-text-muted mb-1",children:"Deck Name"}),r.jsx("input",{id:"deck-name-edit",type:"text",value:N,onChange:Ee=>w(Ee.target.value),className:"w-full p-2 bg-background border border-border rounded-md focus:ring-2 focus:ring-primary focus:outline-none text-2xl font-bold",autoFocus:!0})]}),r.jsxs("div",{children:[r.jsx("label",{htmlFor:"deck-folder",className:"block text-sm font-medium text-text-muted mb-1",children:"Folder"}),r.jsxs("select",{id:"deck-folder",value:C,onChange:Ee=>j(Ee.target.value),className:"w-full p-2 bg-background border border-border rounded-md focus:ring-2 focus:ring-primary focus:outline-none",children:[r.jsx("option",{value:"",children:"No folder"}),J.map(Ee=>r.jsx("option",{value:Ee.id,children:Ee.name},Ee.id))]})]}),r.jsxs("div",{children:[r.jsx("label",{htmlFor:"deck-desc",className:"block text-sm font-medium text-text-muted mb-1",children:"Description"}),r.jsx("textarea",{id:"deck-desc",value:I,onChange:Ee=>k(Ee.target.value),rows:4,className:"w-full p-2 bg-background border border-border rounded-md focus:ring-2 focus:ring-primary focus:outline-none"})]}),r.jsxs("div",{className:"flex justify-start gap-2 pt-2",children:[r.jsxs(ve,{onClick:$,children:[r.jsx(ae,{name:"save",className:"mr-2"})," Save Changes"]}),r.jsx(ve,{variant:"secondary",onClick:W,children:"Cancel"})]})]}):r.jsxs("div",{children:[r.jsxs("div",{className:"min-w-0",children:[r.jsx("h2",{className:"text-3xl font-bold mb-2 text-text break-words",children:s.name}),s.folderId&&r.jsxs("div",{className:"flex items-center text-sm text-text-muted mb-2",children:[r.jsx(ae,{name:"folder",className:"w-4 h-4 mr-2"}),r.jsx("span",{children:((Se=J.find(Ee=>Ee.id===s.folderId))==null?void 0:Se.name)||"..."})]})]}),r.jsxs("div",{className:"flex items-center gap-2 mb-4",children:[r.jsxs(ve,{variant:"ghost",onClick:()=>b(!0),children:[r.jsx(ae,{name:"edit",className:"mr-2"})," Edit"]}),r.jsxs(ve,{variant:"ghost",onClick:()=>o({...s,archived:!0}),children:[r.jsx(ae,{name:"archive",className:"mr-2"})," Archive"]})]}),s.description&&r.jsx("p",{className:"text-text-muted mt-1 mb-4 prose dark:prose-invert max-w-none",dangerouslySetInnerHTML:{__html:s.description}})]})}),r.jsxs("div",{className:"border-b border-border flex space-x-4",children:[r.jsx("button",{className:Te("overview"),onClick:()=>M("overview"),children:"Overview"}),r.jsxs("button",{className:Te("items"),onClick:()=>M("items"),children:["Items (",de.length,")"]}),r.jsx("button",{className:Te("stats"),onClick:()=>M("stats"),children:"Statistics"})]}),r.jsxs("div",{className:"mt-6",children:[R==="overview"&&r.jsxs("div",{className:"space-y-8 animate-fade-in",children:[r.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-8",children:[r.jsxs("div",{className:"space-y-4 bg-surface p-6 rounded-lg shadow-md border border-border",children:[r.jsxs("div",{children:[r.jsx("h4",{className:"text-sm font-semibold text-text mb-2",children:"Deck Statistics"}),r.jsxs("div",{className:"space-y-1",children:[s.type===Ae.Learning&&r.jsxs("p",{className:"text-sm text-text-muted",children:["Info Cards: ",r.jsx("strong",{className:"text-text",children:s.infoCards.length})]}),r.jsxs("p",{className:"text-sm text-text-muted",children:["Active ",s.type===Ae.Learning?"Questions":"Items",": ",r.jsx("strong",{className:"text-text",children:ge.length})]}),r.jsxs("p",{className:"text-sm text-text-muted",children:["Items Due Today: ",r.jsx("strong",{className:B>0?"text-primary":"text-text",children:B})]}),je>0&&r.jsxs("p",{className:"text-sm text-yellow-600 dark:text-yellow-400",children:["Suspended Items: ",r.jsx("strong",{children:je})]})]})]}),r.jsxs("div",{children:[r.jsx("h4",{className:"text-sm font-semibold text-text mb-2",children:"Overall Mastery"}),r.jsx(fs,{level:A})]}),r.jsxs("div",{children:[r.jsx("h4",{className:"text-sm font-semibold text-text mb-2",children:"Progress by Stage"}),r.jsx(Og,{data:me,total:ge.length}),r.jsxs("div",{className:"grid grid-cols-2 gap-x-4 gap-y-1 mt-3 text-xs",children:[r.jsxs("div",{className:"flex items-center",children:[r.jsx("span",{className:"w-2.5 h-2.5 rounded-full bg-blue-500 mr-2"}),r.jsxs("span",{className:"text-text-muted",children:["New: ",r.jsx("strong",{children:fe.new})]})]}),r.jsxs("div",{className:"flex items-center",children:[r.jsx("span",{className:"w-2.5 h-2.5 rounded-full bg-orange-500 mr-2"}),r.jsxs("span",{className:"text-text-muted",children:["Learning: ",r.jsx("strong",{children:fe.learning})]})]}),r.jsxs("div",{className:"flex items-center",children:[r.jsx("span",{className:"w-2.5 h-2.5 rounded-full bg-teal-500 mr-2"}),r.jsxs("span",{className:"text-text-muted",children:["Young: ",r.jsx("strong",{children:fe.young})]})]}),r.jsxs("div",{className:"flex items-center",children:[r.jsx("span",{className:"w-2.5 h-2.5 rounded-full bg-green-500 mr-2"}),r.jsxs("span",{className:"text-text-muted",children:["Mature: ",r.jsx("strong",{children:fe.mature})]})]})]})]})]}),r.jsx("div",{className:"bg-surface p-6 rounded-lg shadow-md border border-border",children:r.jsx(Rg,{data:ce})})]}),r.jsxs("div",{className:"border-t border-border pt-6 flex flex-wrap items-center justify-center gap-4",children:[he&&oe?be?r.jsxs("div",{className:"flex items-center justify-center w-full sm:w-auto text-lg py-3 px-6 font-semibold",children:[r.jsx(sr,{size:"sm"}),r.jsx("span",{className:"ml-3 text-text-muted",children:"Generating..."})]}):r.jsxs(ve,{variant:"primary",size:"lg",className:"font-semibold w-full sm:w-auto",onClick:()=>{s.type===Ae.Quiz?l(s):s.type===Ae.Learning&&f(s)},children:[r.jsx(ae,{name:"zap",className:"w-5 h-5 mr-2"}),s.type===Ae.Quiz?"Generate Questions":"Generate Content"]}):r.jsxs(Ut,{href:`/decks/${s.id}/study`,passAs:ve,variant:"primary",size:"lg",onClick:()=>h(s.id),disabled:B===0&&!S||!!s.locked||de.length===0,className:"font-semibold w-full sm:w-auto",children:[r.jsx(ae,{name:s.locked?"lock":S?"zap":"laptop",className:"w-5 h-5 mr-2"})," ",pe]}),r.jsxs(Ut,{href:`/decks/${s.id}/cram`,passAs:ve,variant:"secondary",size:"lg",onClick:()=>h(s.id),disabled:de.length===0,className:"font-semibold w-full sm:w-auto",title:"Review all cards in random order, without affecting your SRS schedule.",children:[r.jsx(ae,{name:"refresh-ccw",className:"w-5 h-5 mr-2"})," Cram"]}),s.type===Ae.Flashcard&&ge.length>0&&r.jsxs(Ut,{href:`/decks/${s.id}/study-reversed`,passAs:ve,variant:"secondary",size:"lg",onClick:()=>h(s.id),disabled:!!s.locked,className:"font-semibold w-full sm:w-auto",title:"Study cards from back to front.",children:[r.jsx(ae,{name:"repeat",className:"w-5 h-5 mr-2"})," Study Reversed"]}),s.type===Ae.Quiz&&ge.length>0&&r.jsxs(Ut,{href:`/decks/${s.id}/study-flip`,passAs:ve,variant:"secondary",size:"lg",onClick:()=>h(s.id),disabled:!!s.locked,className:"font-semibold w-full sm:w-auto",children:[r.jsx(ae,{name:"refresh-ccw",className:"w-5 h-5 mr-2"})," Review as Flashcards"]})]})]}),R==="items"&&r.jsx("div",{className:"bg-surface rounded-lg shadow-md border border-border animate-fade-in",children:s.type===Ae.Flashcard?r.jsx(Cg,{cards:s.cards,onCardsChange:Ee=>o({...s,cards:Ee},{silent:!0}),onAddCard:Ee=>o({...s,cards:[...s.cards,{...Ee,id:crypto.randomUUID(),dueDate:new Date().toISOString(),interval:0,easeFactor:us}]},{silent:!0}),onBulkAdd:()=>F(!0)}):s.type===Ae.Quiz?r.jsx(Dg,{questions:s.questions,onQuestionsChange:Ee=>o({...s,questions:Ee},{silent:!0}),onAddQuestion:Ee=>o({...s,questions:[...s.questions,{...Ee,id:crypto.randomUUID(),dueDate:new Date().toISOString(),interval:0,easeFactor:us}]},{silent:!0}),onBulkAdd:()=>F(!0),onGenerateAI:()=>l(s),isGeneratingAI:be}):s.type===Ae.Learning?r.jsx(Fg,{deck:s,onSaveBlock:Ee=>x(s.id,Ee),onDeleteBlock:Ee=>d(s.id,Ee)}):r.jsx("div",{className:"p-6 text-center text-text-muted",children:r.jsx("p",{children:"Unsupported deck type."})})}),R==="stats"&&r.jsx("div",{className:"animate-fade-in",children:r.jsx(zg,{deck:s})})]}),r.jsxs("div",{className:"bg-red-900/20 border border-red-500/30 rounded-lg p-6",children:[r.jsx("h3",{className:"text-xl font-semibold text-red-400 dark:text-red-300 mb-2",children:"Danger Zone"}),r.jsx("p",{className:"text-red-500/80 dark:text-red-300/80 mb-4",children:"Moving a deck to the trash will make it unavailable for study. It will be permanently deleted after 10 days."}),r.jsxs(ve,{variant:"danger",onClick:ie,children:[r.jsx(ae,{name:"trash-2",className:"mr-2"})," Move to Trash"]})]}),O&&r.jsx(Ag,{isOpen:O,onClose:()=>F(!1),onAddItems:_,deckType:s.type})]})},os=({children:s})=>r.jsx("pre",{className:"bg-gray-100 dark:bg-gray-900/70 p-4 rounded-lg overflow-x-auto text-sm text-gray-800 dark:text-gray-200 border border-gray-200 dark:border-gray-700",children:r.jsx("code",{children:s})}),On=({title:s,iconName:p,children:o,defaultOpen:v=!1})=>{const[h,u]=U.useState(v);return r.jsxs("div",{className:"border border-gray-200 dark:border-gray-700 rounded-lg overflow-hidden",children:[r.jsxs("button",{onClick:()=>u(!h),className:"w-full flex justify-between items-center text-left p-4 bg-gray-50 dark:bg-gray-800/50 hover:bg-gray-100 dark:hover:bg-gray-700/50 transition-colors","aria-expanded":h,children:[r.jsxs("div",{className:"flex items-center",children:[p&&r.jsx(ae,{name:p,className:"w-6 h-6 mr-3 text-gray-500 dark:text-gray-400"}),r.jsx("h3",{className:"text-xl font-semibold text-gray-800 dark:text-gray-200",children:s})]}),r.jsx(ae,{name:"chevron-down",className:`w-6 h-6 transition-transform duration-300 ${h?"":"-rotate-90"} text-gray-500`})]}),h&&r.jsx("div",{className:"p-6 bg-white dark:bg-gray-800 animate-fade-in",children:o})]})},ah=({fields:s})=>r.jsx("div",{className:"overflow-x-auto",children:r.jsxs("table",{className:"w-full text-left border-collapse mt-4 min-w-[500px]",children:[r.jsx("thead",{children:r.jsxs("tr",{children:[r.jsx("th",{className:"border-b-2 dark:border-gray-600 p-2 text-sm font-semibold text-gray-700 dark:text-gray-300",children:"Field"}),r.jsx("th",{className:"border-b-2 dark:border-gray-600 p-2 text-sm font-semibold text-gray-700 dark:text-gray-300",children:"Type"}),r.jsx("th",{className:"border-b-2 dark:border-gray-600 p-2 text-sm font-semibold text-gray-700 dark:text-gray-300",children:"Required"}),r.jsx("th",{className:"border-b-2 dark:border-gray-600 p-2 text-sm font-semibold text-gray-700 dark:text-gray-300",children:"Description"})]})}),r.jsx("tbody",{children:s.map(({field:p,type:o,description:v,required:h})=>r.jsxs("tr",{className:"border-b dark:border-gray-700/50",children:[r.jsx("td",{className:"p-2 align-top",children:r.jsx("code",{className:"bg-gray-200 dark:bg-gray-700 px-1 py-0.5 rounded-sm",children:p})}),r.jsx("td",{className:"p-2 align-top text-gray-600 dark:text-gray-400",children:o}),r.jsx("td",{className:"p-2 align-top",children:h?r.jsx(ae,{name:"check-circle",className:"text-green-500"}):"No"}),r.jsx("td",{className:"p-2 align-top text-gray-600 dark:text-gray-400",dangerouslySetInnerHTML:{__html:v}})]},p))})]})}),Bg=()=>{const{addToast:s}=er(),[p,o]=U.useState(""),[v,h]=U.useState("Beginner"),[u,l]=U.useState(""),[f,x]=U.useState(""),[d,T]=U.useState("Beginner"),[b,N]=U.useState("Beginner"),[w,I]=U.useState(null),k=["Novice","Beginner","Intermediate","Advanced","Expert","Mastery"],C=`[
  {
    "front": "What is the capital of France?",
    "back": "Paris"
  },
  {
    "front": "What is H2O?",
    "back": "Water"
  }
]`,j=`{
  "name": "Sample Science Quiz",
  "description": "A few questions to test your <b>basic</b> science knowledge.",
  "questions": [
    {
      "questionType": "multipleChoice",
      "questionText": "Which planet is known as the Red Planet?",
      "tags": ["astronomy", "planets"],
      "detailedExplanation": "Mars is often called the Red Planet...",
      "options": [
        { "id": "opt1", "text": "Venus" },
        { "id": "opt2", "text": "Mars" },
        { "id": "opt3", "text": "Jupiter", "explanation": "Jupiter is a gas giant..." }
      ],
      "correctAnswerId": "opt2"
    }
  ]
}`,O=[{field:"name",type:"string",required:!0,description:"The title of the quiz deck."},{field:"description",type:"string",required:!0,description:"A brief summary of the deck's content. Can include basic HTML for formatting (e.g., `<b>`, `<i>`, `<br>`)."},{field:"questions",type:"Array<Question>",required:!0,description:"An array containing all question objects for the deck."},{field:"questionType",type:"string",required:!0,description:'Must be "multipleChoice" for now.'},{field:"questionText",type:"string",required:!0,description:"The question being asked."},{field:"tags",type:"Array<string>",required:!1,description:"An array of keywords for organization."},{field:"detailedExplanation",type:"string",required:!0,description:"The full explanation shown after answering."},{field:"options",type:"Array<Option>",required:!0,description:"An array of possible answers."},{field:"correctAnswerId",type:"string",required:!0,description:"The `id` of the correct option."},{field:"options[].id",type:"string",required:!0,description:"A unique identifier for this option within the question."},{field:"options[].text",type:"string",required:!0,description:"The answer text shown to the user."},{field:"options[].explanation",type:"string",required:!1,description:"A brief explanation for why this specific option is right or wrong."}],F=`{
  "seriesName": "Intro to Web Development",
  "seriesDescription": "A progressive series covering the <b>fundamentals</b> of web development.",
  "levels": [
    {
      "title": "Level 1: The Foundation",
      "decks": [
        {
          "name": "Level 1.1: HTML Basics",
          "description": "The building blocks of the web.",
          "questions": [
            {
              "questionType": "multipleChoice",
              "questionText": "What does HTML stand for?",
              "tags": ["html", "basics"],
              "detailedExplanation": "HTML stands for HyperText Markup Language...",
              "options": [
                { "id": "1", "text": "HyperText Markup Language" },
                { "id": "2", "text": "High-Level Text Machine Language" }
              ],
              "correctAnswerId": "1"
            }
          ]
        },
        { "name": "Level 1.2: CSS Fundamentals", "description": "...", "questions": [] }
      ]
    }
  ]
}`,R=[{field:"seriesName",type:"string",required:!0,description:"The title for the entire series."},{field:"seriesDescription",type:"string",required:!0,description:"A brief summary of what the whole series covers. Can include basic HTML for formatting."},{field:"levels",type:"Array<Level>",required:!0,description:"An array containing all the levels in the series."},{field:"levels[].title",type:"string",required:!0,description:'The heading for a group of decks (e.g., "Level 1: Core Concepts").'},{field:"levels[].decks",type:"Array<QuizDeck>",required:!0,description:"An array of quiz decks for that level. The schema for each deck is the same as the Single Quiz Deck format."}],M=`Please act as a world-class instructional designer and subject matter expert. Your task is to generate a comprehensive, detailed, and world-class TEXT outline for a learning path. The output must be plain text, not a JSON object.

**Topic:** [YOUR TOPIC HERE]
**User's Current Level:** [USER'S LEVEL HERE]

The goal is to create a structured and progressive learning path that guides the user towards deep, comprehensive mastery of the topic, similar in quality and detail to the provided example structure.

**INSTRUCTIONS & REQUIREMENTS:**

1.  **Learning Path Structure:**
    -   Organize the learning path into logical "Levels" (e.g., Level 1, Level 2, up to Level 4 or 5). Each level must have a title and represent a significant step up in knowledge.
    -   Each Level should contain one or more related "Decks".
    -   The name of each deck must reflect this structure, e.g., "Level 1.1: Foundations of X", "Level 1.2: Core Concepts of Y", "Level 2.1: Advanced Techniques in Z".

2.  **High-Quality Content (Crucial):**
    -   **Comprehensive Coverage:** The outline must cover the topic in sufficient depth for the specified user level, ensuring a thorough understanding.
    -   **Series Name & Description:** Create a compelling and descriptive name (e.g., "Topic Mastery Path: The Contextual Approach") and a comprehensive summary for the entire learning path. The description can use basic HTML for formatting (e.g., <b>, <i>, <br>).
    -   **Level Goal & Focus:** For each Level, provide a clear "Goal" and "Focus".
    -   **Deck Topics:** For each Deck, provide a detailed, itemized list of specific "Topics" to be covered.
    -   **Progressive Difficulty:** The path must be logically sequenced, starting with foundational definitions and historical context, moving to practical applications, then to assessment and planning, and finally to interdisciplinary challenges.
    -   **Context-Specific:** If the user's topic has a specific context (e.g., a geographical location, a particular framework), embed that context deeply into the entire outline.
    -   **Clarity with Acronyms:** When using an acronym, write it out fully in parentheses the first time it is used (e.g., "Sustainable Forest Management (SFM)").
    -   **Approximate Question Count:** Suggest an approximate number of questions for each deck.
    -   **Metric System:** All generated content should prefer the metric system (e.g., meters, kilograms, Celsius).

**EXAMPLE STRUCTURE:**
Ecological Sustainable Forestry Mastery Path: The Scanian Approach
This learning path provides a deep understanding of...
Level 1: Core Principles & Historical Context in Skåne
Goal: Define ecological sustainable forestry...
Focus: Shifting from purely extractive forestry...
Level 1.1: Foundations of Sustainable Forest Management (SFM) in Skåne
Topics: Definitional evolution of forestry...
Approx. Questions: 30-40

---

Now, based on all the above requirements, generate the complete text outline.

Finally, at the very end of your response, provide a JSON object with the series name and description you created, like this:
{
  "seriesName": "The full series name you generated above",
  "seriesDescription": "The full series description you generated above"
}
`,H=`You are an expert content creator. I have provided a text outline for a learning path. Your task is to convert this outline into a structured JSON object that will serve as a scaffold.

**PRIMARY INSTRUCTIONS:**

1.  **Source Material:** Use ONLY the text outline I've provided as your source.
2.  **Structure:** Create a single JSON object with \`seriesName\`, \`seriesDescription\`, and a \`levels\` array.
3.  **Levels and Decks:** Inside the \`levels\` array, create objects for each level, including its \`title\`. Each level object should have a \`decks\` array. Populate this with deck objects, each containing its \`name\` and \`description\` from the outline.
4.  **Empty Questions:** For every deck object, include a \`"questions": []\` key-value pair. The questions array MUST be empty.

**JSON OUTPUT FORMAT:**
- The final output MUST be ONLY a single, raw JSON object, starting with \`{\` and ending with \`}\`. Do not include any surrounding text, explanations, or markdown formatting.
- The JSON object must follow this exact schema:
{
  "seriesName": "The full series name from the outline",
  "seriesDescription": "The full series description from the outline",
  "levels": [
    {
      "title": "The title of the first level",
      "decks": [
        {
          "name": "The name of the first deck in this level",
          "description": "The description for this deck",
          "questions": []
        },
        {
          "name": "The name of the second deck in this level",
          "description": "The description for this deck",
          "questions": []
        }
      ]
    }
  ]
}

Now, based on the text outline I provided, please generate the complete JSON scaffold.`,V=`You are an expert content creator. I have provided a text outline for a learning path. Your task is to generate the JSON for the **first deck (e.g., Level 1.1)** from that outline.

**PRIMARY INSTRUCTIONS:**

1.  **Source Material:** Use ONLY the text outline I've provided as your source.
2.  **Question Quantity:** Generate the approximate number of questions specified in the outline for this first deck.
3.  **Content Generation:** Create world-class questions and answers based *only* on the "Topics" listed for this specific deck in the outline.

**CRITICAL CONTENT QUALITY REQUIREMENTS:**
- **Factual Accuracy:** This is paramount. The correct answer and all parts of the explanation must be unequivocally correct and verifiable.
- **In-Depth Coverage:** The questions must cover the deck's topics comprehensively, moving beyond surface-level facts to ensure a deep understanding.
- **Relevance & Practical Application:** Frame questions in real-world scenarios to help a user apply the information. Questions must be relevant to the deck's topics.
- **Clarity & Simplicity:** Questions must be easy to understand, unambiguous, and free of jargon (unless the jargon is the learning objective). Test only one core concept per question.
- **Clarity with Acronyms:** When using an acronym, provide the full term in parentheses upon its first use (e.g., 'Central Processing Unit (CPU)').
- **Problem-Solving Focus:** Design questions that require applying knowledge, not just recalling facts. Avoid trivial pursuit and focus on genuinely useful information. For practical topics, ask skill-based questions that test the ability to perform a task or make a decision.
- **High-Quality Explanations:** The \`detailedExplanation\` is crucial. It must explain the reasoning, principles, or facts behind the correct answer. Provide additional context, examples, or connections to related concepts to deepen understanding. If applicable, cite sources for complex information.
- **Metric System:** Prefer the metric system (e.g., meters, kilograms, Celsius) for all units.
- **Engaging Content:** While factual, make the questions and explanations as engaging as possible to maintain learner interest.

**JSON OUTPUT FORMAT:**
- The final output MUST be ONLY a single, raw JSON object, starting with \`{\` and ending with \`}\`. Do not include any surrounding text, explanations, or markdown formatting.
- The JSON object must follow this exact schema:
{
  "name": "The exact name for the deck from your outline, e.g., 'Level 1.1: Foundations...'",
  "description": "A concise description of this specific deck's content, based on its topics.",
  "questions": [
    {
      "questionType": "multipleChoice",
      "questionText": "The text of the first question...",
      "tags": ["relevant", "tags"],
      "detailedExplanation": "A thorough explanation that meets all quality requirements.",
      "options": [
        { "id": "q1_opt1", "text": "First answer option" },
        { "id": "q1_opt2", "text": "Second answer option" }
      ],
      "correctAnswerId": "q1_opt2"
    }
  ]
}

Now, based on the text outline I provided, please generate the JSON for the **first deck**.`,oe=`Please act as an expert instructional designer and generate a complete, structured Deck Series in a single JSON object.

**Topic:** [YOUR TOPIC HERE]
**User's Current Level:** [USER'S LEVEL HERE]

**CONTENT REQUIREMENTS FOR ALL QUESTIONS:**
-   **Comprehensive Coverage:** The generated series must be comprehensive, covering the topic in-depth to provide a thorough understanding for the specified user level.
-   **Factual Accuracy:** All correct answers and explanations must be verifiable and factually correct.
-   **Practical Application:** Frame questions to enable the user to put the learned information into practice.
-   **Clarity:** Questions must be easy to understand and unambiguous.
-   **Clarity with Acronyms:** When using an acronym, provide the full term in parentheses upon its first use (e.g., 'CPU (Central Processing Unit)').
-   **Metric System:** Prefer the metric system (e.g., meters, kilograms, Celsius) for all units.

**FINAL JSON OUTPUT FORMAT:**
The final output MUST be ONLY a single, raw JSON object without any surrounding text or markdown. The root object must have this exact schema:
{
  "seriesName": "A descriptive name for the whole series",
  "seriesDescription": "A brief description of what the series covers. Can include basic HTML for formatting.",
  "levels": [
    {
      "title": "Level 1: The Basics",
      "decks": [
        {
          "name": "Level 1.1: Deck Name",
          "description": "Description of this deck's content. Can include basic HTML for formatting.",
          "questions": [
            {
              "questionType": "multipleChoice",
              "questionText": "...",
              "tags": ["tag1", "tag2"],
              "detailedExplanation": "...",
              "options": [ { "id": "q1_opt1", "text": "..." }, { "id": "q1_opt2", "text": "..." } ],
              "correctAnswerId": "q1_opt2"
            }
          ]
        }
      ]
    }
  ]
}

Now, generate the complete JSON object based on all the above requirements.`,J="Please generate a JSON object for a single multiple-choice quiz.\n\n**Topic:** [YOUR TOPIC HERE]\n**Designed for Level:** [USER'S LEVEL HERE]\n\n**CONTENT REQUIREMENTS:**\n-   **In-Depth Questions:** The questions should cover the topic comprehensively, moving beyond surface-level facts to ensure a deep understanding.\n-   **Factual Accuracy:** All correct answers and explanations must be verifiable and factually correct.\n-   **Relevance:** Questions must be directly pertinent to the chosen topic and appropriate for the specified level.\n-   **Practical Application:** Frame questions to enable the user to put the learned information into practice.\n-   **Question Quantity:** Generate 10-100 high-quality questions. Do not include multiple questions that are essentially asking the same thing.\n-   **Clarity:** Questions must be easy to understand and unambiguous.\n-   **Clarity with Acronyms:** When using an acronym, provide the full term in parentheses upon its first use (e.g., 'CPU (Central Processing Unit)').\n-   **Problem-Solving Focus:** Prioritize questions that require applying knowledge to solve a problem.\n-   **Explanation Quality:** The `detailedExplanation` must explain the reasoning behind the correct answer and provide additional context.\n-   **Metric System:** Prefer the metric system (e.g., meters, kilograms, Celsius) for all units.\n\n**JSON SCHEMA & RULES:**\n-   The final output must be ONLY the raw JSON object, starting with `{` and ending with `}`.\n-   The root object must contain `name`, `description`, and `questions` (array).\n-   Each question object must contain `questionType` (\"multipleChoice\"), `questionText`, `tags` (array), `detailedExplanation`, `options` (array), and `correctAnswerId`.\n-   Each option object must contain a unique `id` and `text`.\n-   Do NOT include top-level SRS fields like `id` or `dueDate` on the questions.\n\nNow, generate the complete JSON deck based on all the above requirements.",Z=(be,ge)=>{navigator.clipboard.writeText(be).then(()=>{s("Prompt copied to clipboard!","success"),I(ge),setTimeout(()=>I(null),2e3)}).catch(je=>{s("Failed to copy prompt.","error"),console.error("Could not copy text: ",je)})},de=()=>{const be=p.trim()||"[YOUR TOPIC HERE]",ge=M.replace("[YOUR TOPIC HERE]",be).replace("[USER'S LEVEL HERE]",v);Z(ge,"outline-prompt")},$=()=>{Z(H,"scaffold-prompt")},W=()=>{Z(V,"deck-from-outline-prompt")},_=()=>{const be=u.trim()||"[YOUR TOPIC HERE]",ge=oe.replace("[YOUR TOPIC HERE]",be).replace("[USER'S LEVEL HERE]",d);Z(ge,"series-prompt")},ie=()=>{const be=f.trim()||"[YOUR TOPIC HERE]",ge=J.replace("[YOUR TOPIC HERE]",be).replace("[USER'S LEVEL HERE]",b);Z(ge,"quiz-prompt")};return r.jsxs("div",{className:"max-w-4xl mx-auto animate-fade-in space-y-6 pb-10",children:[r.jsxs("div",{children:[r.jsx("h1",{className:"text-4xl font-bold text-gray-900 dark:text-gray-100",children:"AI & JSON Import Guide"}),r.jsx("p",{className:"mt-2 text-lg text-gray-500 dark:text-gray-400",children:"Use this expert-led workflow to generate high-quality learning content with AI, or follow the formats to import your own data."})]}),r.jsx(On,{title:"Step 1: Generate Learning Outline (Text)",iconName:"list",defaultOpen:!0,children:r.jsxs("div",{className:"space-y-4 bg-green-900/10 dark:bg-green-900/20 p-6 rounded-lg border border-green-500/20",children:[r.jsx("p",{className:"text-green-800/90 dark:text-green-200/90",children:"Begin by generating a high-level, human-readable outline for your learning path using an external AI chat service. This allows you to review and approve the structure before generating the full content."}),r.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[r.jsxs("div",{children:[r.jsx("label",{htmlFor:"outline-topic-input",className:"block text-sm font-medium text-green-700 dark:text-green-300",children:"Enter Topic"}),r.jsx("input",{id:"outline-topic-input",type:"text",value:p,onChange:be=>o(be.target.value),className:"w-full p-2 mt-1 bg-green-50 dark:bg-gray-900 border border-green-300 dark:border-green-700 rounded-md focus:ring-2 focus:ring-green-500 focus:outline-none",placeholder:"e.g., The History of Ancient Rome"})]}),r.jsxs("div",{children:[r.jsx("label",{htmlFor:"outline-level-select",className:"block text-sm font-medium text-green-700 dark:text-green-300",children:"My Current Level Is"}),r.jsx("select",{id:"outline-level-select",value:v,onChange:be=>h(be.target.value),className:"w-full p-2 mt-1 bg-green-50 dark:bg-gray-900 border border-green-300 dark:border-green-700 rounded-md focus:ring-2 focus:ring-green-500 focus:outline-none",children:k.map(be=>r.jsx("option",{value:be,children:be},be))})]})]}),r.jsx("p",{className:"text-xs text-green-600/80 dark:text-green-400/80 mt-1",children:"Your topic and level will be inserted into the prompt."}),r.jsxs("div",{className:"relative",children:[r.jsx(os,{children:M}),r.jsx(ve,{variant:"secondary",className:"absolute top-2 right-2 px-2 py-1 text-xs bg-gray-200/50 dark:bg-gray-900/50 border border-gray-300 dark:border-gray-600",onClick:de,children:w==="outline-prompt"?r.jsxs(r.Fragment,{children:[r.jsx(ae,{name:"check-circle",className:"w-4 h-4 mr-1"})," Copied!"]}):r.jsxs(r.Fragment,{children:[r.jsx(ae,{name:"download",className:"w-4 h-4 mr-1"})," Copy Prompt"]})})]})]})}),r.jsx(On,{title:"Step 2: Create the Series Scaffold",iconName:"code",children:r.jsxs("div",{className:"space-y-4 bg-yellow-900/10 dark:bg-yellow-900/20 p-6 rounded-lg border border-yellow-500/20",children:[r.jsx("p",{className:"text-yellow-800/90 dark:text-yellow-200/90",children:'You can now create the series structure in CogniFlow. Use the in-app "Generate with AI" feature with your topic. This will automatically create the series with empty decks, ready for you to populate.'}),r.jsx("p",{className:"text-sm text-yellow-700/90 dark:text-yellow-300/90",children:'Alternatively, you can manually convert your text outline from Step 1 into a JSON "scaffold" using the prompt below and import it via the "Create / Import" modal.'}),r.jsxs("div",{className:"relative",children:[r.jsx(os,{children:H}),r.jsx(ve,{variant:"secondary",className:"absolute top-2 right-2 px-2 py-1 text-xs bg-gray-200/50 dark:bg-gray-900/50 border border-gray-300 dark:border-gray-600",onClick:$,children:w==="scaffold-prompt"?r.jsxs(r.Fragment,{children:[r.jsx(ae,{name:"check-circle",className:"w-4 h-4 mr-1"})," Copied!"]}):r.jsxs(r.Fragment,{children:[r.jsx(ae,{name:"download",className:"w-4 h-4 mr-1"})," Copy Prompt"]})})]})]})}),r.jsx(On,{title:"Step 3: Generate Questions for Each Deck",iconName:"zap",children:r.jsxs("div",{className:"space-y-4 bg-blue-900/10 dark:bg-blue-900/20 p-6 rounded-lg border border-blue-500/20",children:[r.jsx("p",{className:"text-blue-800/90 dark:text-blue-200/90",children:'Navigate to your newly created series page in CogniFlow. Each empty deck will have a "Generate Questions" button. Click it to have the AI populate that specific deck with high-quality, relevant questions automatically.'}),r.jsx("p",{className:"text-sm text-blue-700/90 dark:text-blue-300/90",children:"If you are working with an external AI and your JSON scaffold from Step 2, you can use the prompt below to generate the questions for each deck. Paste your text outline into the chat first, then use the prompt. Copy the generated `questions` array into the correct deck in your scaffold JSON. Repeat for all decks, then import the final JSON file."}),r.jsxs("div",{className:"relative",children:[r.jsx(os,{children:V}),r.jsx(ve,{variant:"secondary",className:"absolute top-2 right-2 px-2 py-1 text-xs bg-gray-200/50 dark:bg-gray-900/50 border border-gray-300 dark:border-gray-600",onClick:W,children:w==="deck-from-outline-prompt"?r.jsxs(r.Fragment,{children:[r.jsx(ae,{name:"check-circle",className:"w-4 h-4 mr-1"})," Copied!"]}):r.jsxs(r.Fragment,{children:[r.jsx(ae,{name:"download",className:"w-4 h-4 mr-1"})," Copy Prompt"]})})]})]})}),r.jsx(On,{title:"Alternative: Generate Full Series at Once (JSON)",iconName:"zap",children:r.jsxs("div",{className:"space-y-4 bg-purple-900/10 dark:bg-purple-900/20 p-6 rounded-lg border border-purple-500/20",children:[r.jsx("p",{className:"text-purple-700/90 dark:text-purple-300/90",children:"For a faster, one-shot approach, use this powerful prompt to generate a complete, structured learning path on any topic. This is less controlled but much quicker."}),r.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[r.jsxs("div",{children:[r.jsx("label",{htmlFor:"series-topic-input",className:"block text-sm font-medium text-purple-700 dark:text-purple-300",children:"Enter Topic"}),r.jsx("input",{id:"series-topic-input",type:"text",value:u,onChange:be=>l(be.target.value),className:"w-full p-2 mt-1 bg-purple-50 dark:bg-gray-900 border border-purple-300 dark:border-purple-700 rounded-md focus:ring-2 focus:ring-purple-500 focus:outline-none",placeholder:"e.g., Quantum Physics"})]}),r.jsxs("div",{children:[r.jsx("label",{htmlFor:"series-level-select",className:"block text-sm font-medium text-purple-700 dark:text-purple-300",children:"My Current Level Is"}),r.jsx("select",{id:"series-level-select",value:d,onChange:be=>T(be.target.value),className:"w-full p-2 mt-1 bg-purple-50 dark:bg-gray-900 border border-purple-300 dark:border-purple-700 rounded-md focus:ring-2 focus:ring-purple-500 focus:outline-none",children:k.map(be=>r.jsx("option",{value:be,children:be},be))})]})]}),r.jsx("p",{className:"text-xs text-purple-600/80 dark:text-purple-400/80 mt-1",children:"Your topic and level will be inserted into the prompt."}),r.jsxs("div",{className:"relative",children:[r.jsx(os,{children:oe}),r.jsx(ve,{variant:"secondary",className:"absolute top-2 right-2 px-2 py-1 text-xs bg-gray-200/50 dark:bg-gray-900/50 border border-gray-300 dark:border-gray-600",onClick:_,children:w==="series-prompt"?r.jsxs(r.Fragment,{children:[r.jsx(ae,{name:"check-circle",className:"w-4 h-4 mr-1"})," Copied!"]}):r.jsxs(r.Fragment,{children:[r.jsx(ae,{name:"download",className:"w-4 h-4 mr-1"})," Copy Prompt"]})})]})]})}),r.jsx(On,{title:"Alternative: Generate a Single Quiz Deck",iconName:"zap",children:r.jsxs("div",{className:"space-y-4 bg-blue-900/10 dark:bg-blue-900/20 p-6 rounded-lg border border-blue-500/20",children:[r.jsx("p",{className:"text-blue-700/90 dark:text-blue-300/90",children:"Use this prompt to generate a single quiz deck on any topic, tailored to a specific difficulty level."}),r.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 mb-4",children:[r.jsxs("div",{children:[r.jsx("label",{htmlFor:"quiz-topic-input",className:"block text-sm font-medium text-blue-700 dark:text-blue-300",children:"Enter Topic"}),r.jsx("input",{id:"quiz-topic-input",type:"text",value:f,onChange:be=>x(be.target.value),className:"w-full p-2 mt-1 bg-blue-50 dark:bg-gray-900 border border-blue-300 dark:border-blue-700 rounded-md focus:ring-2 focus:ring-blue-500 focus:outline-none",placeholder:"e.g., The Roman Empire"})]}),r.jsxs("div",{children:[r.jsx("label",{htmlFor:"quiz-level-select",className:"block text-sm font-medium text-blue-700 dark:text-blue-300",children:"Deck Difficulty Level"}),r.jsx("select",{id:"quiz-level-select",value:b,onChange:be=>N(be.target.value),className:"w-full p-2 mt-1 bg-blue-50 dark:bg-gray-900 border border-blue-300 dark:border-blue-700 rounded-md focus:ring-2 focus:ring-blue-500 focus:outline-none",children:k.map(be=>r.jsx("option",{value:be,children:be},be))})]})]}),r.jsxs("div",{className:"relative",children:[r.jsx(os,{children:J}),r.jsx(ve,{variant:"secondary",className:"absolute top-2 right-2 px-2 py-1 text-xs bg-gray-200/50 dark:bg-gray-900/50 border border-gray-300 dark:border-gray-600",onClick:ie,children:w==="quiz-prompt"?r.jsxs(r.Fragment,{children:[r.jsx(ae,{name:"check-circle",className:"w-4 h-4 mr-1"})," Copied!"]}):r.jsxs(r.Fragment,{children:[r.jsx(ae,{name:"download",className:"w-4 h-4 mr-1"})," Copy Prompt"]})})]})]})}),r.jsxs(On,{title:"Format 1: Full Deck Series (JSON)",iconName:"list",children:[r.jsx("p",{className:"text-gray-600 dark:text-gray-400 mb-4",children:"To import an entire learning path at once, provide a single JSON object containing the series details and a `levels` array. Each level has a title and contains its own array of decks."}),r.jsx(os,{children:F}),r.jsx("h4",{className:"text-lg font-semibold mt-6 mb-2",children:"Field Definitions"}),r.jsx(ah,{fields:R})]}),r.jsxs(On,{title:"Format 2: Single Quiz Deck (JSON)",iconName:"help-circle",children:[r.jsx("p",{className:"text-gray-600 dark:text-gray-400 mb-4",children:"For a single multiple-choice quiz, provide a JSON object with a name, description, and an array of question objects. See the field definitions below for more details."}),r.jsx(os,{children:j}),r.jsx("h4",{className:"text-lg font-semibold mt-6 mb-2",children:"Field Definitions"}),r.jsx(ah,{fields:O})]}),r.jsxs(On,{title:"Format 3: Simple Flashcard Deck (JSON)",iconName:"laptop",children:[r.jsxs("p",{className:"text-gray-600 dark:text-gray-400 mb-4",children:["For basic front-and-back flashcards, provide a JSON array. Each object in the array must have a ",r.jsx("code",{className:"bg-gray-200 dark:bg-gray-700 px-1 py-0.5 rounded-sm",children:"front"})," and a ",r.jsx("code",{className:"bg-gray-200 dark:bg-gray-700 px-1 py-0.5 rounded-sm",children:"back"})," key, both with string values. This format is ideal for quick, manual creation or for exporting from other simple flashcard apps."]}),r.jsx(os,{children:C})]}),r.jsx(On,{title:"General Tips & Troubleshooting",iconName:"settings",children:r.jsxs("ul",{className:"space-y-4 list-disc list-inside text-gray-600 dark:text-gray-400",children:[r.jsxs("li",{children:[r.jsx("strong",{children:"Validate Your JSON:"})," Before importing, it's a good idea to paste your JSON into an online validator to check for syntax errors. A common mistake is a trailing comma after the last item in an array or object.",r.jsx("br",{}),r.jsx("code",{children:'[ { "key": "value" }, ] &larr; Invalid Trailing Comma'})]}),r.jsxs("li",{children:[r.jsx("strong",{children:"Check Your Quotes:"}),` All keys and string values in JSON must be enclosed in double quotes ("). Single quotes (') are not valid.`]}),r.jsxs("li",{children:[r.jsx("strong",{children:"Schema Mismatches:"}),' Ensure your JSON structure matches one of the three formats above. For example, pasting an array of flashcards into the "Bulk Add" modal inside a quiz deck will fail. The main "Import" modal is more flexible and can detect the format automatically.']}),r.jsxs("li",{children:[r.jsx("strong",{children:"Unique IDs:"}),' When creating quiz questions, ensure the `id` for each option within a single question is unique. You can use simple strings like "opt1", "opt2", or a UUID.']}),r.jsxs("li",{children:[r.jsx("strong",{children:"AI-Generated Content:"})," Always review content generated by an AI for factual accuracy before studying it. The prompts are designed to request accuracy, but AI can still make mistakes."]})]})})]})},ih=s=>{if(!s)return 0;const p=new Date;return p.setHours(23,59,59,999),s.questions.filter(o=>!o.suspended&&new Date(o.dueDate)<=p).length},Gg=({series:s,sessionsToResume:p,onUpdateSeries:o,onDeleteSeries:v,onAddDeckToSeries:h,onUpdateDeck:u,onStartSeriesStudy:l,onUpdateLastOpened:f,openConfirmModal:x,onAiAddLevelsToSeries:d,onAiAddDecksToLevel:T,onGenerateQuestionsForEmptyDecksInSeries:b})=>{const{decks:N,seriesProgress:w,aiGenerationStatus:I,dispatch:k}=Ke(),{navigate:C,path:j}=Ln(),{addToast:O}=er(),{aiFeaturesEnabled:F}=on(),[R,M]=U.useState(!1),[H,V]=U.useState(!1),[oe,J]=U.useState(s.name),[Z,de]=U.useState(s.description),[$,W]=U.useState(!1),[_,ie]=U.useState(null);U.useEffect(()=>{new URLSearchParams(j.split("?")[1]).get("edit")==="true"&&(M(!0),C(`/series/${s.id}`,{replace:!0}))},[j,s.id,C]),U.useEffect(()=>{f(s.id)},[s.id,f]),U.useEffect(()=>{(s.archived||s.deletedAt)&&C("/series")},[s.archived,s.deletedAt,C]);const be=U.useMemo(()=>{const he=new Map,Se=new Set(s.levels.flatMap(Ee=>Ee.deckIds));return N.forEach(Ee=>{Se.has(Ee.id)&&(Ee.type===Ae.Quiz||Ee.type===Ae.Learning)&&he.set(Ee.id,Ee)}),he},[s.levels,N]),ge=U.useMemo(()=>w.get(s.id)||new Set,[w,s.id]),je=s.levels.reduce((he,Se)=>he+Se.deckIds.length,0),{totalDueCount:fe,averageMastery:B}=U.useMemo(()=>{let he=0;const Se=[];let Ee=0;for(const qe of s.levels)for(const te of qe.deckIds){const Y=be.get(te);Y&&(Ee<=ge.size&&(he+=ih(Y)),Se.push(...Y.questions.filter(g=>!g.suspended))),Ee++}const Le=Se.length>0?Se.reduce((qe,te)=>qe+wn(te),0)/Se.length:0;return{totalDueCount:he,averageMastery:Le}},[s.levels,be,ge]),S=()=>{o({...s,name:oe,description:Z}),V(!1)},A=()=>{const he=s.levels.reduce((Se,Ee)=>Se+Ee.deckIds.length,0);x({title:"Move Series to Trash",message:`Are you sure you want to move the series "${s.name}" and all of its ${he} deck(s) to the trash?`,onConfirm:()=>v(s.id)})},ce=he=>{if(I.isGenerating){O("An AI generation task is already in progress.","info");return}k({type:"SET_AI_GENERATION_STATUS",payload:{isGenerating:!0,generatingDeckId:he.id,generatingSeriesId:s.id,statusText:`Generating questions for "${he.name}"...`}}),O(`AI is now generating questions for "${he.name}". This will continue in the background.`,"info"),(async()=>{try{const Se=await Ec(s,[he],(Ee,Le)=>{const qe=wr(Le),te=be.get(Ee);if(te){const Y={...te,questions:qe};u(Y)}});o({...s,aiChatHistory:Se},{silent:!0}),O(`Successfully generated questions for "${he.name}"!`,"success")}catch(Se){const Ee=Se instanceof Error?Se.message:"An unknown error occurred during AI generation.";O(Ee,"error")}finally{Ke.getState().aiGenerationStatus.generatingDeckId===he.id&&k({type:"SET_AI_GENERATION_STATUS",payload:{isGenerating:!1,generatingDeckId:null,generatingSeriesId:null,statusText:null}})}})()},pe=async()=>{W(!0);try{await d(s.id)}catch(he){const Se=he instanceof Error?he.message:"Failed to add levels.";O(Se,"error")}finally{W(!1)}},me=async he=>{ie(he);try{await T(s.id,he)}catch(Se){const Ee=Se instanceof Error?Se.message:"Failed to add decks.";O(Ee,"error")}finally{ie(null)}},Te=U.useMemo(()=>Array.from(be.values()).some(he=>{var Se;return(((Se=he.questions)==null?void 0:Se.length)||0)===0}),[be]);return r.jsxs("div",{className:"max-w-4xl mx-auto animate-fade-in space-y-6",children:[r.jsx("div",{className:"bg-surface rounded-lg shadow-md p-6 border border-border",children:H?r.jsxs("div",{className:"space-y-4",children:[r.jsxs("div",{children:[r.jsx("label",{htmlFor:"series-name-edit",className:"block text-sm font-medium text-text-muted mb-1",children:"Series Name"}),r.jsx("input",{id:"series-name-edit",type:"text",value:oe,onChange:he=>J(he.target.value),className:"w-full p-2 bg-background border border-border rounded-md focus:ring-2 focus:ring-primary focus:outline-none text-2xl font-bold",autoFocus:!0})]}),r.jsxs("div",{children:[r.jsx("label",{htmlFor:"series-desc-edit",className:"block text-sm font-medium text-text-muted mb-1",children:"Description"}),r.jsx("textarea",{id:"series-desc-edit",value:Z,onChange:he=>de(he.target.value),rows:3,className:"w-full p-2 bg-background border border-border rounded-md focus:ring-2 focus:ring-primary focus:outline-none"})]}),r.jsxs("div",{className:"flex justify-start gap-2 pt-2",children:[r.jsxs(ve,{onClick:S,children:[r.jsx(ae,{name:"save",className:"mr-2"})," Save Changes"]}),r.jsx(ve,{variant:"secondary",onClick:()=>V(!1),children:"Cancel"})]})]}):r.jsxs("div",{children:[r.jsx("h2",{className:"text-3xl font-bold mb-2 text-text break-words",children:s.name}),r.jsxs("div",{className:"flex items-center gap-2 mb-4",children:[r.jsxs(ve,{variant:"ghost",onClick:()=>V(!0),children:[r.jsx(ae,{name:"edit",className:"mr-2"})," Edit"]}),r.jsxs(ve,{variant:"ghost",onClick:()=>o({...s,archived:!0}),children:[r.jsx(ae,{name:"archive",className:"mr-2"})," Archive"]}),r.jsxs(ve,{variant:"ghost",onClick:()=>M(he=>!he),children:[r.jsx(ae,{name:"list",className:"mr-2"})," ",R?"Done Organizing":"Organize"]})]}),r.jsx("p",{className:"text-text-muted mt-1 prose dark:prose-invert max-w-none",children:s.description})]})}),r.jsxs("div",{className:"bg-surface rounded-lg shadow-md p-6 border border-border space-y-4",children:[r.jsxs("div",{children:[r.jsxs("div",{className:"flex justify-between items-center text-sm mb-1",children:[r.jsx("span",{className:"font-medium text-text-muted",children:"Completion"}),r.jsxs("span",{className:"font-semibold text-text-muted",children:[ge.size," / ",je," Decks"]})]}),r.jsx(Ac,{current:ge.size,total:je})]}),r.jsxs("div",{children:[r.jsx("h4",{className:"text-sm font-medium text-text-muted mb-1",children:"Overall Mastery"}),r.jsx(fs,{level:B})]}),r.jsxs("div",{className:"border-t border-border pt-4 flex flex-wrap items-center justify-center gap-4",children:[r.jsxs(ve,{variant:"primary",size:"lg",onClick:()=>l(s.id),disabled:fe===0,className:"font-semibold w-full sm:w-auto",children:[r.jsx(ae,{name:"zap",className:"w-5 h-5 mr-2"}),"Study Due Items (",fe,")"]}),F&&Te&&r.jsxs(ve,{variant:"secondary",size:"lg",onClick:()=>b(s.id),disabled:I.isGenerating,className:"font-semibold w-full sm:w-auto",children:[I.isGenerating&&I.generatingSeriesId===s.id?r.jsx(sr,{size:"sm"}):r.jsx(ae,{name:"zap",className:"w-5 h-5 mr-2"}),"Generate All Questions"]})]})]}),r.jsxs("div",{className:"space-y-6",children:[s.levels.map((he,Se)=>{let Ee=0;for(let Le=0;Le<Se;Le++)Ee+=s.levels[Le].deckIds.length;return r.jsxs("div",{className:"bg-surface rounded-lg shadow-md border border-border p-6",children:[r.jsx("h3",{className:"text-xl font-bold text-text mb-4",children:he.title}),r.jsx("div",{className:"space-y-4",children:he.deckIds.map((Le,qe)=>{var q;const te=be.get(Le),Y=Ee+qe,g=ge.has(Le),ee=Y>ge.size,G=ih(te);if(!te)return r.jsxs("div",{className:"text-red-500",children:["Deck with ID ",Le," not found."]},Le);const P=I.isGenerating&&I.generatingDeckId===te.id,L=F&&R&&(((q=te.questions)==null?void 0:q.length)||0)===0&&te.type===Ae.Quiz;return r.jsxs("div",{className:`p-4 rounded-lg flex items-center justify-between transition-opacity ${ee?"opacity-50 bg-background":"bg-background"}`,children:[r.jsxs("div",{className:"flex items-center min-w-0",children:[r.jsx("div",{className:`mr-4 flex-shrink-0 ${ee?"text-text-muted":g?"text-green-500":"text-primary"}`,children:ee?r.jsx(ae,{name:"lock"}):g?r.jsx(ae,{name:"check-circle"}):r.jsx(ae,{name:"unlock"})}),r.jsxs("div",{className:"min-w-0",children:[r.jsx(Ut,{href:`/decks/${te.id}?seriesId=${s.id}`,className:`font-bold truncate ${ee?"text-text-muted cursor-not-allowed":"text-text hover:underline hover:text-primary"}`,onClick:X=>{ee&&(X.preventDefault(),O("This deck is locked. Complete the previous deck to unlock it.","info"))},"aria-disabled":ee,children:te.name}),r.jsx("p",{className:"text-sm text-text-muted truncate",children:te.description}),r.jsxs("p",{className:"text-xs text-text-muted mt-1 flex items-center",children:[r.jsx(ae,{name:te.type===Ae.Learning?"book-open":"help-circle",className:"inline-block w-3.5 h-3.5 mr-1.5"}),te.questions.length," questions",!ee&&r.jsx("span",{className:"mx-1.5",children:"•"}),!ee&&`${G} due`]})]})]}),r.jsx("div",{className:"flex-shrink-0 ml-4 flex items-center gap-2",children:P?r.jsx("div",{className:"flex items-center justify-center p-2 h-auto min-w-[6rem]",children:r.jsx(sr,{size:"sm"})}):r.jsxs(r.Fragment,{children:[L&&r.jsxs(ve,{variant:"ghost",size:"sm",onClick:()=>ce(te),disabled:I.isGenerating,children:[r.jsx(ae,{name:"zap",className:"w-4 h-4 mr-1"})," Generate"]}),r.jsx(Ut,{href:`/decks/${te.id}/study?seriesId=${s.id}`,passAs:ve,variant:"secondary",size:"sm",disabled:ee,children:"Study"})]})})]},Le)})}),F&&R&&r.jsx("div",{className:"mt-4 pt-4 border-t border-border/50 flex justify-end",children:r.jsxs(ve,{variant:"ghost",size:"sm",onClick:()=>me(Se),disabled:_===Se||$||I.isGenerating,children:[_===Se?r.jsx(sr,{size:"sm"}):r.jsx(ae,{name:"zap",className:"w-4 h-4 mr-2"}),"Add Decks with AI"]})})]},Se)}),F&&R&&r.jsx("div",{className:"mt-4 pt-4 flex justify-center",children:r.jsxs(ve,{variant:"secondary",onClick:pe,disabled:$||_!==null||I.isGenerating,children:[$?r.jsx(sr,{size:"sm"}):r.jsx(ae,{name:"zap",className:"w-5 h-5 mr-2"}),"Add Levels with AI"]})})]}),r.jsxs("div",{className:"bg-red-900/20 border border-red-500/30 rounded-lg p-6",children:[r.jsx("h3",{className:"text-xl font-semibold text-red-400 dark:text-red-300 mb-2",children:"Danger Zone"}),r.jsx("p",{className:"text-red-500/80 dark:text-red-300/80 mb-4",children:"Moving a series to the trash will also move all of its decks to the trash."}),r.jsxs(ve,{variant:"danger",onClick:A,children:[r.jsx(ae,{name:"trash-2",className:"mr-2"})," Move to Trash"]})]})]})},$g=({onUpdateDeck:s,onUpdateSeries:p,onDeleteDeck:o,onDeleteSeries:v,openConfirmModal:h})=>{const{decks:u,deckSeries:l}=Ke(),f=U.useMemo(()=>u.filter(w=>w.archived&&!w.deletedAt),[u]),x=U.useMemo(()=>l.filter(w=>w.archived&&!w.deletedAt),[l]),d=w=>{s({...w,archived:!1})},T=w=>{p({...w,archived:!1})},b=w=>{h({title:"Move Deck to Trash",message:`Are you sure you want to move the archived deck "${w.name}" to the trash? This will un-archive it and place it in the trash for 10 days, after which it will be permanently deleted.`,onConfirm:()=>o(w.id)})},N=w=>{h({title:"Move Series to Trash",message:`Are you sure you want to move the archived series "${w.name}" to the trash? It will be un-archived and placed in the trash for 10 days. Decks within the series will NOT be deleted.`,onConfirm:()=>v(w.id)})};return r.jsxs("div",{className:"max-w-4xl mx-auto animate-fade-in space-y-8",children:[r.jsx("h1",{className:"text-3xl font-bold mb-6 text-text border-b border-border pb-4",children:"Archive"}),r.jsxs("section",{children:[r.jsx("h2",{className:"text-2xl font-semibold text-text mb-4",children:"Archived Series"}),x.length>0?r.jsx("div",{className:"bg-surface rounded-lg shadow-md divide-y divide-border",children:x.map(w=>r.jsxs("div",{className:"p-4 flex justify-between items-center",children:[r.jsxs("div",{className:"flex items-center min-w-0",children:[r.jsx(ae,{name:"list",className:"w-6 h-6 mr-4 text-purple-500 dark:text-purple-400 flex-shrink-0"}),r.jsxs("div",{className:"min-w-0",children:[r.jsx("p",{className:"font-semibold truncate text-text",children:w.name}),r.jsx("p",{className:"text-sm text-text-muted truncate",children:w.description})]})]}),r.jsxs("div",{className:"flex-shrink-0 flex items-center gap-2",children:[r.jsxs(ve,{variant:"secondary",size:"sm",onClick:()=>T(w),children:[r.jsx(ae,{name:"unarchive",className:"w-4 h-4 mr-2"}),"Unarchive"]}),r.jsxs(ve,{variant:"danger",size:"sm",onClick:()=>N(w),children:[r.jsx(ae,{name:"trash-2",className:"w-4 h-4 mr-2"}),"Move to Trash"]})]})]},w.id))}):r.jsxs("div",{className:"text-center py-10 bg-surface rounded-lg border border-border",children:[r.jsx(ae,{name:"archive",className:"w-12 h-12 mx-auto text-text-muted/50"}),r.jsx("h3",{className:"mt-2 text-xl font-medium text-text",children:"No Archived Series"}),r.jsx("p",{className:"mt-1 text-sm text-text-muted",children:"You can archive series from their page to hide them from the main list."})]})]}),r.jsxs("section",{children:[r.jsx("h2",{className:"text-2xl font-semibold text-text mb-4",children:"Archived Decks"}),f.length>0?r.jsx("div",{className:"bg-surface rounded-lg shadow-md divide-y divide-border",children:f.map(w=>r.jsxs("div",{className:"p-4 flex justify-between items-center",children:[r.jsxs("div",{className:"flex items-center min-w-0",children:[r.jsx(ae,{name:w.type==="quiz"?"help-circle":"laptop",className:"w-6 h-6 mr-4 text-text-muted flex-shrink-0"}),r.jsxs("div",{className:"min-w-0",children:[r.jsx("p",{className:"font-semibold truncate text-text",children:w.name}),r.jsx("p",{className:"text-sm text-text-muted truncate",children:w.description})]})]}),r.jsxs("div",{className:"flex-shrink-0 flex items-center gap-2",children:[r.jsxs(ve,{variant:"secondary",size:"sm",onClick:()=>d(w),children:[r.jsx(ae,{name:"unarchive",className:"w-4 h-4 mr-2"}),"Unarchive"]}),r.jsxs(ve,{variant:"danger",size:"sm",onClick:()=>b(w),children:[r.jsx(ae,{name:"trash-2",className:"w-4 h-4 mr-2"}),"Move to Trash"]})]})]},w.id))}):r.jsxs("div",{className:"text-center py-10 bg-surface rounded-lg border border-border",children:[r.jsx(ae,{name:"archive",className:"w-12 h-12 mx-auto text-text-muted/50"}),r.jsx("h3",{className:"mt-2 text-xl font-medium text-text",children:"No Archived Decks"}),r.jsx("p",{className:"mt-1 text-sm text-text-muted",children:"You can archive decks from their details page to hide them from view."})]})]})]})},yo=10,oh=s=>{const p=new Date(s),h=(new Date().getTime()-p.getTime())/(1e3*60*60*24);return Math.max(0,Math.ceil(yo-h))},Hg=({onRestoreDeck:s,onRestoreSeries:p,onDeleteDeckPermanently:o,onDeleteSeriesPermanently:v,openConfirmModal:h})=>{const{decks:u,deckSeries:l}=Ke(),f=U.useMemo(()=>u.filter(b=>b.deletedAt),[u]),x=U.useMemo(()=>l.filter(b=>b.deletedAt),[l]),d=b=>{h({title:"Permanently Delete Deck",message:`Are you sure you want to permanently delete the deck "${b.name}"? This action cannot be undone.`,onConfirm:()=>o(b.id)})},T=b=>{const N=b.levels.reduce((w,I)=>w+I.deckIds.length,0);h({title:"Permanently Delete Series",message:`Are you sure you want to permanently delete the series "${b.name}"? All ${N} deck(s) inside it will also be permanently deleted. This action cannot be undone.`,onConfirm:()=>v(b.id)})};return r.jsxs("div",{className:"max-w-4xl mx-auto animate-fade-in space-y-8",children:[r.jsxs("div",{className:"border-b border-border pb-4",children:[r.jsx("h1",{className:"text-3xl font-bold text-text",children:"Trash"}),r.jsxs("p",{className:"mt-2 text-text-muted",children:["Items in the trash will be permanently deleted after ",yo," days."]})]}),r.jsxs("section",{children:[r.jsx("h2",{className:"text-2xl font-semibold text-text mb-4",children:"Trashed Series"}),x.length>0?r.jsx("div",{className:"bg-surface rounded-lg shadow-md divide-y divide-border",children:x.map(b=>{const N=oh(b.deletedAt);return r.jsxs("div",{className:"p-4 flex justify-between items-center",children:[r.jsxs("div",{className:"flex items-center min-w-0",children:[r.jsx(ae,{name:"list",className:"w-6 h-6 mr-4 text-purple-500 dark:text-purple-400 flex-shrink-0"}),r.jsxs("div",{className:"min-w-0",children:[r.jsx("p",{className:"font-semibold truncate text-text",children:b.name}),r.jsx("p",{className:`text-sm ${N<=2?"text-red-500":"text-text-muted"}`,children:N>0?`${N} days left`:"Deleting soon..."})]})]}),r.jsxs("div",{className:"flex-shrink-0 flex items-center gap-2",children:[r.jsxs(ve,{variant:"secondary",size:"sm",onClick:()=>p(b.id),children:[r.jsx(ae,{name:"unarchive",className:"w-4 h-4 mr-2"}),"Restore"]}),r.jsxs(ve,{variant:"danger",size:"sm",onClick:()=>T(b),children:[r.jsx(ae,{name:"trash-2",className:"w-4 h-4 mr-2"}),"Delete Now"]})]})]},b.id)})}):r.jsxs("div",{className:"text-center py-10 bg-surface rounded-lg border border-border",children:[r.jsx(ae,{name:"trash-2",className:"w-12 h-12 mx-auto text-text-muted/50"}),r.jsx("h3",{className:"mt-2 text-xl font-medium text-text",children:"Trash is Empty"}),r.jsxs("p",{className:"mt-1 text-sm text-text-muted",children:["Deleted series will appear here for ",yo," days."]})]})]}),r.jsxs("section",{children:[r.jsx("h2",{className:"text-2xl font-semibold text-text mb-4",children:"Trashed Decks"}),f.length>0?r.jsx("div",{className:"bg-surface rounded-lg shadow-md divide-y divide-border",children:f.map(b=>{const N=oh(b.deletedAt);return r.jsxs("div",{className:"p-4 flex justify-between items-center",children:[r.jsxs("div",{className:"flex items-center min-w-0",children:[r.jsx(ae,{name:b.type==="quiz"?"help-circle":"laptop",className:"w-6 h-6 mr-4 text-text-muted flex-shrink-0"}),r.jsxs("div",{className:"min-w-0",children:[r.jsx("p",{className:"font-semibold truncate text-text",children:b.name}),r.jsx("p",{className:`text-sm ${N<=2?"text-red-500":"text-text-muted"}`,children:N>0?`${N} days left`:"Deleting soon..."})]})]}),r.jsxs("div",{className:"flex-shrink-0 flex items-center gap-2",children:[r.jsxs(ve,{variant:"secondary",size:"sm",onClick:()=>s(b.id),children:[r.jsx(ae,{name:"unarchive",className:"w-4 h-4 mr-2"}),"Restore"]}),r.jsxs(ve,{variant:"danger",size:"sm",onClick:()=>d(b),children:[r.jsx(ae,{name:"trash-2",className:"w-4 h-4 mr-2"}),"Delete Now"]})]})]},b.id)})}):r.jsxs("div",{className:"text-center py-10 bg-surface rounded-lg border border-border",children:[r.jsx(ae,{name:"trash-2",className:"w-12 h-12 mx-auto text-text-muted/50"}),r.jsx("h3",{className:"mt-2 text-xl font-medium text-text",children:"Trash is Empty"}),r.jsxs("p",{className:"mt-1 text-sm text-text-muted",children:["Deleted decks will appear here for ",yo," days."]})]})]})]})},bh=({series:s,completedCount:p,dueCount:o,onStartSeriesStudy:v,masteryLevel:h,nextUpDeckId:u,onGenerateAllQuestions:l})=>{const{aiGenerationStatus:f,decks:x}=Ke(),d=s.levels.reduce((w,I)=>w+I.deckIds.length,0),T=p>=d&&d>0,b=f.isGenerating&&f.generatingSeriesId===s.id,N=U.useMemo(()=>{const w=new Set(s.levels.flatMap(k=>k.deckIds));return x.filter(k=>w.has(k.id)).some(k=>{var C;return(k.type===Ae.Quiz||k.type===Ae.Learning)&&(((C=k.questions)==null?void 0:C.length)||0)===0})},[s.levels,x]);return r.jsx(Ut,{href:`/series/${s.id}`,className:"block bg-surface rounded-lg shadow-md hover:shadow-lg transition-all duration-200 border border-transparent hover:border-primary",children:r.jsxs("div",{className:"p-4",children:[r.jsxs("div",{className:"flex items-start justify-between",children:[r.jsxs("div",{className:"flex-1 min-w-0 mr-4",children:[r.jsxs("div",{className:"flex items-center mb-1",children:[r.jsx(ae,{name:"layers",className:"w-5 h-5 mr-2 text-purple-500 dark:text-purple-400"}),r.jsx("h3",{className:"text-xl font-bold text-text break-words",children:s.name})]}),s.description&&r.jsx("p",{className:"text-sm text-text-muted mt-1 truncate",children:s.description})]}),T&&r.jsxs("div",{className:"flex-shrink-0 flex items-center gap-2 text-green-500 dark:text-green-400 bg-green-100 dark:bg-green-900/50 px-3 py-1 rounded-full",children:[r.jsx(ae,{name:"check-circle",className:"w-4 h-4"}),r.jsx("span",{className:"text-sm font-semibold",children:"Completed"})]})]}),d>0&&r.jsxs("div",{className:"mt-3 space-y-3",children:[r.jsxs("div",{children:[r.jsxs("div",{className:"flex justify-between items-center text-sm mb-1",children:[r.jsx("span",{className:"font-medium text-text-muted",children:"Completion"}),r.jsxs("span",{className:"font-semibold text-text-muted",children:[p," / ",d]})]}),r.jsx(Ac,{current:p,total:d})]}),r.jsx("div",{children:r.jsx(fs,{level:h})})]}),r.jsx("div",{className:"mt-4 pt-4 border-t border-border/50 flex justify-end gap-2",children:b?r.jsxs("div",{className:"flex items-center text-text-muted",children:[r.jsx(sr,{size:"sm"}),r.jsx("span",{className:"ml-2 text-sm font-semibold",children:"Generating..."})]}):r.jsxs(r.Fragment,{children:[u&&r.jsxs(Ut,{href:`/decks/${u}/study?seriesId=${s.id}`,passAs:ve,variant:"primary",size:"sm",onClick:w=>{w.stopPropagation()},children:[r.jsx(ae,{name:"laptop",className:"w-4 h-4 mr-2"}),"Continue"]}),N&&o===0&&!u&&l&&r.jsxs(ve,{variant:"secondary",size:"sm",onClick:w=>{w.preventDefault(),w.stopPropagation(),l(s.id)},children:[r.jsx(ae,{name:"zap",className:"w-4 h-4 mr-2"}),"Generate Questions"]}),r.jsxs(ve,{variant:"secondary",size:"sm",onClick:w=>{w.preventDefault(),w.stopPropagation(),v(s.id)},disabled:o===0,children:[r.jsx(ae,{name:"zap",className:"w-4 h-4 mr-2"}),"Study Due (",o,")"]})]})})]})})},Wg=s=>{const p=new Date;p.setHours(23,59,59,999);const o=s.type===Ae.Quiz||s.type===Ae.Learning?s.questions:s.cards;return Array.isArray(o)?o.filter(v=>!v.suspended&&new Date(v.dueDate)<=p).length:0},Rc=({deck:s,sessionsToResume:p,onUpdateLastOpened:o,draggedDeckId:v,onDragStart:h,onDragEnd:u,onUpdateDeck:l,onDeleteDeck:f,openConfirmModal:x,onGenerateQuestionsForDeck:d,onGenerateContentForLearningDeck:T})=>{const{navigate:b}=Ln(),{aiGenerationStatus:N}=Ke(),{aiFeaturesEnabled:w}=on(),I=Wg(s),k=p.has(s.id),C=s.type===Ae.Quiz||s.type===Ae.Learning?s.questions:s.cards,j=(C==null?void 0:C.length)||0;let O,F;s.type===Ae.Quiz||s.type===Ae.Learning?(O=j===1?"question":"questions",F=s.type===Ae.Learning?"layers":"help-circle"):(O=j===1?"card":"cards",F="laptop");const[R,M]=U.useState(!1),H=U.useRef(null),V=N.isGenerating&&N.generatingDeckId===s.id,oe=(s.type===Ae.Quiz||s.type===Ae.Learning)&&j===0;U.useEffect(()=>{const W=_=>{H.current&&!H.current.contains(_.target)&&M(!1)};return R?document.addEventListener("mousedown",W):document.removeEventListener("mousedown",W),()=>document.removeEventListener("mousedown",W)},[R]);const J=W=>{W.target.closest("button, a")||(o(s.id),b(`/decks/${s.id}`))},Z=W=>{l({...s,archived:!0}),M(!1)},de=W=>{x({title:"Move Deck to Trash",message:`Are you sure you want to move the deck "${s.name}" to the trash? It will be permanently deleted after 10 days.`,onConfirm:()=>f(s.id)}),M(!1)},$=U.useMemo(()=>{if(!C)return 0;const W=C.filter(ie=>!ie.suspended);return W.length===0?0:W.reduce((ie,be)=>ie+wn(be),0)/W.length},[C]);return r.jsxs("div",{draggable:"true",onClick:J,onDragStart:W=>{W.dataTransfer.setData("text/plain",s.id),setTimeout(()=>h(s.id),0)},onDragEnd:u,className:`bg-surface rounded-lg shadow-md hover:shadow-lg transition-all duration-200 group relative ${v===s.id?"border-2 border-dashed border-border bg-background/50":"cursor-pointer"}`,children:[r.jsxs("div",{className:`p-4 pr-10 flex flex-col justify-between h-full space-y-3 ${v===s.id?"opacity-0":""}`,children:[r.jsxs("div",{children:[r.jsx("h3",{className:"text-xl font-bold text-text break-words group-hover:text-primary transition-colors",children:s.name}),s.description&&r.jsx("div",{className:"prose prose-sm dark:prose-invert max-w-none text-text-muted mt-1 truncate",title:sn(s.description),dangerouslySetInnerHTML:{__html:s.description}})]}),r.jsx(fs,{level:$}),r.jsxs("div",{className:"flex justify-between items-center",children:[r.jsxs("div",{className:"flex items-center gap-4 text-sm text-text-muted",children:[r.jsxs("span",{className:"flex items-center gap-1.5",children:[r.jsx(ae,{name:F,className:"w-4 h-4"}),j," ",O]}),r.jsxs("span",{className:`flex items-center gap-1.5 font-semibold ${I>0?"text-primary":""}`,children:[r.jsx(ae,{name:"zap",className:"w-4 h-4"}),I," due"]})]}),r.jsx("div",{className:"flex items-center space-x-1",children:V?r.jsxs("div",{className:"flex items-center text-text-muted pr-1",children:[r.jsx(sr,{size:"sm"}),r.jsx("span",{className:"ml-2 text-sm font-semibold",children:"Generating..."})]}):r.jsxs(r.Fragment,{children:[w&&oe?r.jsxs(ve,{variant:"primary",size:"sm",onClick:W=>{W.stopPropagation(),s.type===Ae.Quiz&&d?d(s):s.type===Ae.Learning&&T&&T(s)},className:"font-semibold",children:[r.jsx(ae,{name:"zap",className:"w-4 h-4 mr-1.5"}),"Generate"]}):r.jsx(Ut,{href:`/decks/${s.id}/study`,passAs:ve,variant:"primary",size:"sm",onClick:()=>o(s.id),disabled:j===0||I===0&&!k,className:"font-semibold",children:k?"Resume":"Study"}),r.jsxs("div",{className:"relative",ref:H,children:[r.jsx(ve,{variant:"ghost",size:"sm",className:"p-2 h-auto",onClick:W=>{W.stopPropagation(),M(_=>!_)},"aria-label":`More options for ${s.name}`,disabled:V,children:r.jsx(ae,{name:"more-vertical",className:"w-5 h-5"})}),R&&r.jsxs("div",{className:"absolute right-0 mt-2 w-48 bg-surface rounded-md shadow-lg py-1 z-20 ring-1 ring-black ring-opacity-5 animate-fade-in",style:{animationDuration:"150ms"},children:[r.jsxs("button",{onClick:Z,className:"flex items-center w-full px-4 py-2 text-sm text-left text-text hover:bg-border/20",children:[r.jsx(ae,{name:"archive",className:"w-4 h-4 mr-3"}),"Archive"]}),r.jsx("div",{className:"border-t border-border my-1"}),r.jsxs("button",{onClick:de,className:"flex items-center w-full px-4 py-2 text-sm text-left text-red-600 dark:text-red-400 hover:bg-red-50 dark:hover:bg-red-900/20",children:[r.jsx(ae,{name:"trash-2",className:"w-4 h-4 mr-3"}),"Move to Trash"]})]})]})]})})]})]}),r.jsx("div",{className:"absolute top-0 right-0 h-full flex items-center px-3 text-text-muted/60 cursor-grab","aria-hidden":"true",children:r.jsx(ae,{name:"grip-vertical",className:"w-5 h-5"})})]},s.id)},Qg=s=>{const p=new Date;p.setHours(23,59,59,999);const o=s.type===Ae.Quiz||s.type===Ae.Learning?s.questions:s.cards;return Array.isArray(o)?o.filter(v=>!v.suspended&&new Date(v.dueDate)<=p).length:0},Yg=({totalDueQuestions:s,onStartGeneralStudy:p,sessionsToResume:o,onUpdateLastOpened:v,onUpdateDeck:h,onDeleteDeck:u,openConfirmModal:l,seriesProgress:f,onStartSeriesStudy:x,onGenerateQuestionsForDeck:d,onGenerateContentForLearningDeck:T,onGenerateQuestionsForEmptyDecksInSeries:b})=>{const{decks:N,deckSeries:w}=Ke(),{recentDecks:I,recentSeries:k,seriesData:C}=U.useMemo(()=>{const j=new Set;w.forEach(V=>{(V.levels||[]).forEach(oe=>(oe.deckIds||[]).forEach(J=>j.add(J)))});const O=N.filter(V=>!V.archived&&!V.deletedAt&&!j.has(V.id)),R=[...w.filter(V=>!V.archived&&!V.deletedAt)].sort((V,oe)=>{const J=V.levels.flatMap(W=>W.deckIds).map(W=>N.find(_=>_.id===W)).filter(Boolean),Z=oe.levels.flatMap(W=>W.deckIds).map(W=>N.find(_=>_.id===W)).filter(Boolean),de=Math.max(new Date(V.lastOpened||V.createdAt||0).getTime(),...J.map(W=>new Date(W.lastOpened||0).getTime()));return Math.max(new Date(oe.lastOpened||oe.createdAt||0).getTime(),...Z.map(W=>new Date(W.lastOpened||0).getTime()))-de}).slice(0,2),M=[...O].sort((V,oe)=>(oe.lastOpened||"").localeCompare(V.lastOpened||"")).slice(0,2),H=new Map;return w.forEach(V=>{var ie;const oe=(V.levels||[]).flatMap(be=>be.deckIds||[]).map(be=>N.find(ge=>ge.id===be)).filter(Boolean),J=((ie=f.get(V.id))==null?void 0:ie.size)||0,Z=new Set;(V.levels||[]).flatMap(be=>be.deckIds||[]).forEach((be,ge)=>{ge<=J&&Z.add(be)});const $=oe.reduce((be,ge)=>Z.has(ge.id)?be+Qg(ge):be,0),W=oe.flatMap(be=>be.type===Ae.Flashcard?be.cards:be.questions||[]).filter(be=>!be.suspended),_=W.length>0?W.reduce((be,ge)=>be+wn(ge),0)/W.length:0;H.set(V.id,{dueCount:$,mastery:_})}),{recentDecks:M,recentSeries:R,seriesData:H}},[N,w,f]);return r.jsxs("div",{className:"space-y-12",children:[s>0&&r.jsx("div",{className:"mb-6",children:r.jsxs(ve,{onClick:p,variant:"primary",className:"w-full sm:w-auto text-lg py-3",children:[r.jsx(ae,{name:"zap",className:"w-5 h-5 mr-2"}),"Study All Due Items (",s,")"]})}),k.length>0&&r.jsxs("section",{children:[r.jsxs("div",{className:"flex justify-between items-center mb-4",children:[r.jsx("h2",{className:"text-3xl font-bold text-gray-900 dark:text-gray-100",children:"Recent Series"}),r.jsxs(Ut,{href:"/series",passAs:ve,variant:"ghost",children:["View all ",r.jsx(ae,{name:"chevron-left",className:"w-4 h-4 ml-2 rotate-180"})]})]}),r.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:k.map(j=>{var H;const O=C.get(j.id)||{dueCount:0,mastery:0},F=f.get(j.id)||new Set,M=(j.levels||[]).flatMap(V=>V.deckIds||[]).find(V=>!F.has(V))||null;return r.jsx(bh,{series:j,completedCount:((H=f.get(j.id))==null?void 0:H.size)||0,dueCount:O.dueCount,masteryLevel:O.mastery,onStartSeriesStudy:x,nextUpDeckId:M,onGenerateAllQuestions:b},j.id)})})]}),I.length>0&&r.jsxs("section",{children:[r.jsxs("div",{className:"flex justify-between items-center mb-4",children:[r.jsx("h2",{className:"text-3xl font-bold text-gray-900 dark:text-gray-100",children:"Recent Decks"}),r.jsxs(Ut,{href:"/decks",passAs:ve,variant:"ghost",children:["View all ",r.jsx(ae,{name:"chevron-left",className:"w-4 h-4 ml-2 rotate-180"})]})]}),r.jsx("div",{className:"space-y-4",children:I.map(j=>r.jsx(Rc,{deck:j,sessionsToResume:o,onUpdateLastOpened:v,draggedDeckId:null,onDragStart:()=>{},onDragEnd:()=>{},onUpdateDeck:h,onDeleteDeck:u,openConfirmModal:l,onGenerateQuestionsForDeck:d,onGenerateContentForLearningDeck:T},j.id))})]})]})},Vg=({folder:s,decks:p,isOpen:o,onToggle:v,sessionsToResume:h,onUpdateLastOpened:u,onDeleteFolder:l,draggedDeckId:f,onDragStart:x,onDragEnd:d,onMoveDeck:T,onUpdateDeck:b,onDeleteDeck:N,openConfirmModal:w,onSaveFolder:I,onGenerateQuestionsForDeck:k,onGenerateContentForLearningDeck:C})=>{const[j,O]=U.useState(!1),[F,R]=U.useState(!1),[M,H]=U.useState(s.name),V=U.useRef(null),{addToast:oe}=er();U.useEffect(()=>{F&&V.current&&(V.current.focus(),V.current.select())},[F]);const J=ie=>{ie.stopPropagation(),H(s.name),R(!0)},Z=ie=>{ie.stopPropagation(),R(!1)},de=ie=>{if(ie==null||ie.stopPropagation(),M.trim()===""){oe("Folder name cannot be empty.","error");return}I({id:s.id,name:M.trim()}),R(!1)},$=ie=>{ie.preventDefault(),ie.stopPropagation();const be=ie.dataTransfer.getData("text/plain");be&&be===f&&(T(be,s.id),d()),O(!1)},W=ie=>{ie.preventDefault(),ie.dataTransfer.dropEffect="move",O(!0)},_=()=>{O(!1)};return r.jsxs("div",{className:`rounded-lg transition-all duration-200 ${j?"bg-primary/20 ring-2 ring-primary ring-inset":"bg-surface border border-border"}`,onDrop:$,onDragOver:W,onDragLeave:_,children:[r.jsx("div",{className:"border-b border-border",children:r.jsxs("div",{onClick:F?void 0:v,className:"w-full flex justify-between items-center text-left p-4 cursor-pointer","aria-expanded":o,children:[r.jsxs("div",{className:"flex items-center flex-grow min-w-0",children:[r.jsx(ae,{name:"chevron-down",className:`w-5 h-5 transition-transform duration-300 mr-3 ${o?"":"-rotate-90"} text-text-muted`}),F?r.jsxs("div",{className:"flex items-center flex-grow gap-2 min-w-0",onClick:ie=>ie.stopPropagation(),children:[r.jsx(ae,{name:"folder",className:"w-6 h-6 text-yellow-600 dark:text-yellow-500 flex-shrink-0"}),r.jsx("input",{ref:V,type:"text",value:M,onChange:ie=>H(ie.target.value),onKeyDown:ie=>{ie.key==="Enter"&&de(ie),ie.key==="Escape"&&Z(ie)},className:"text-xl font-bold p-1 bg-background rounded-md w-full"})]}):r.jsxs(r.Fragment,{children:[r.jsx(ae,{name:"folder",className:"w-6 h-6 mr-3 text-yellow-600 dark:text-yellow-500"}),r.jsx("h3",{className:"text-xl font-bold text-text truncate",children:s.name})]})]}),r.jsx("div",{className:"flex items-center gap-1 flex-shrink-0",children:F?r.jsxs(r.Fragment,{children:[r.jsx(ve,{variant:"primary",size:"sm",onClick:de,"aria-label":`Save changes for folder ${s.name}`,children:"Save"}),r.jsx(ve,{variant:"secondary",size:"sm",onClick:Z,"aria-label":"Cancel editing",children:"Cancel"})]}):r.jsxs(r.Fragment,{children:[r.jsx(ve,{variant:"ghost",className:"p-2 h-auto",onClick:J,"aria-label":`Edit folder ${s.name}`,children:r.jsx(ae,{name:"edit",className:"w-4 h-4"})}),r.jsx(ve,{variant:"ghost",className:"p-2 h-auto hover:text-red-500",onClick:ie=>{ie.stopPropagation(),l(s.id)},"aria-label":`Delete folder ${s.name}`,children:r.jsx(ae,{name:"trash-2",className:"w-4 h-4"})})]})})]})}),o&&r.jsx("div",{className:"p-4 space-y-4",children:p.length>0?p.map(ie=>r.jsx(Rc,{deck:ie,sessionsToResume:h,onUpdateLastOpened:u,draggedDeckId:f,onDragStart:x,onDragEnd:d,onUpdateDeck:b,onDeleteDeck:N,openConfirmModal:w,onGenerateQuestionsForDeck:k,onGenerateContentForLearningDeck:C},ie.id)):r.jsxs("div",{className:"flex flex-col items-center justify-center p-6 border-2 border-dashed border-border rounded-md m-4 text-center",children:[r.jsx(ae,{name:"grip-vertical",className:"w-8 h-8 text-text-muted mb-2"}),r.jsx("p",{className:"text-sm font-medium text-text-muted",children:"Drag a deck here to organize it!"})]})})]})},Jg=({decks:s,folders:p,sessionsToResume:o,onUpdateLastOpened:v,onDeleteFolder:h,draggedDeckId:u,onDragStart:l,onDragEnd:f,onMoveDeck:x,openFolderIds:d,onToggleFolder:T,onUpdateDeck:b,onDeleteDeck:N,openConfirmModal:w,onSaveFolder:I,onGenerateQuestionsForDeck:k,onGenerateContentForLearningDeck:C})=>{const{decksByFolder:j,ungroupedDecks:O}=U.useMemo(()=>{const V=new Map,oe=[];return s.forEach(J=>{J.folderId&&p.some(Z=>Z.id===J.folderId)?(V.has(J.folderId)||V.set(J.folderId,[]),V.get(J.folderId).push(J)):oe.push(J)}),{decksByFolder:V,ungroupedDecks:oe}},[s,p]),[F,R]=U.useState(!1),M=V=>{V.preventDefault();const oe=V.dataTransfer.getData("text/plain");oe&&oe===u&&(x(oe,null),f()),R(!1)},H=V=>{V.preventDefault(),V.dataTransfer.dropEffect="move",R(!0)};return r.jsxs("div",{className:"space-y-4",children:[p.map(V=>r.jsx(Vg,{folder:V,decks:j.get(V.id)||[],isOpen:d.has(V.id),onToggle:()=>T(V.id),sessionsToResume:o,onUpdateLastOpened:v,onDeleteFolder:h,draggedDeckId:u,onDragStart:l,onDragEnd:f,onMoveDeck:x,onUpdateDeck:b,onDeleteDeck:N,openConfirmModal:w,onSaveFolder:I,onGenerateQuestionsForDeck:k,onGenerateContentForLearningDeck:C},V.id)),r.jsx("div",{onDrop:M,onDragOver:H,onDragLeave:()=>R(!1),className:`p-2 -m-2 rounded-lg transition-all duration-200 ${F?"bg-primary/20 ring-2 ring-primary ring-inset":""}`,children:r.jsx("div",{className:"space-y-4",children:O.map(V=>r.jsx(Rc,{deck:V,sessionsToResume:o,onUpdateLastOpened:v,draggedDeckId:u,onDragStart:l,onDragEnd:f,onUpdateDeck:b,onDeleteDeck:N,openConfirmModal:w,onGenerateQuestionsForDeck:k,onGenerateContentForLearningDeck:C},V.id))})})]})},Kg=[{key:"lastOpened",label:"Recent"},{key:"name",label:"Name"},{key:"dueCount",label:"Due"}],_c=({currentSort:s,onSortChange:p,sortOptions:o})=>{const v=o??Kg;return r.jsx("div",{className:"inline-flex rounded-md shadow-sm bg-gray-100 dark:bg-gray-800 p-1",role:"group",children:v&&v.map((h,u)=>r.jsx("button",{type:"button",onClick:()=>p(h.key),className:`px-4 py-1.5 text-sm font-medium transition-colors focus:z-10 focus:outline-none focus:ring-2 focus:ring-blue-500
            ${s===h.key?"bg-white dark:bg-gray-700 text-blue-600 dark:text-blue-300 shadow-sm":"text-gray-600 dark:text-gray-400 hover:bg-gray-200/50 dark:hover:bg-gray-700/50"}
            ${u===0?"rounded-l-md":""}
            ${u===v.length-1?"rounded-r-md":""}
          `,"aria-pressed":s===h.key,children:h.label},h.key))})},xo=s=>{const p=new Date;p.setHours(23,59,59,999);const o=s.type==="quiz"||s.type==="learning"?s.questions:s.cards;return Array.isArray(o)?o.filter(v=>!v.suspended&&new Date(v.dueDate)<=p).length:0},Zg=s=>{const[p,o]=U.useState(""),v=Ke(x=>x.folders),h=yh(),u=U.useMemo(()=>{const x=p.toLowerCase().trim();if(!x){const b=[...h];switch(s.sortPreference){case"name":return b.sort((N,w)=>N.name.localeCompare(w.name));case"dueCount":return b.sort((N,w)=>xo(w)-xo(N));case"lastOpened":default:return b.sort((N,w)=>(w.lastOpened||"").localeCompare(N.lastOpened||""))}}const d=x.split(/\s+/).filter(Boolean),T=h.map(b=>{let N=0;const w=b.name.toLowerCase(),I=sn(b.description).toLowerCase();w.startsWith(x)?N+=20:w.includes(x)&&(N+=10),I.includes(x)&&(N+=2);for(const j of d)w.includes(j)&&(N+=5),I.includes(j)&&(N+=1);const k=b.type===Ae.Flashcard?b.cards:(b.type===Ae.Learning,b.questions);let C=0;if(k)for(const j of k){let O;if(b.type===Ae.Flashcard){const F=j;O=sn(`${F.front} ${F.back}`).toLowerCase()}else{const F=j,R=F.options.map(M=>M.text).join(" ");O=sn(`${F.questionText} ${R} ${F.detailedExplanation}`).toLowerCase()}d.some(F=>O.includes(F))&&C++}return N+=Math.min(C,20)*.5,{deck:b,score:N}}).filter(({score:b})=>b>0);return T.sort((b,N)=>{if(b.score!==N.score)return N.score-b.score;switch(s.sortPreference){case"name":return b.deck.name.localeCompare(N.deck.name);case"dueCount":return xo(N.deck)-xo(b.deck);case"lastOpened":default:return(N.deck.lastOpened||"").localeCompare(b.deck.lastOpened||"")}}),T.map(({deck:b})=>b)},[h,p,s.sortPreference]),l=U.useMemo(()=>[...v].sort((x,d)=>x.name.localeCompare(d.name)),[v]);return h.length>0||v.length>0?r.jsxs("div",{className:"space-y-6",children:[r.jsxs("div",{className:"flex flex-col sm:flex-row justify-between items-center gap-4",children:[r.jsx("h1",{className:"text-3xl font-bold text-text",children:"All Decks"}),r.jsxs(ve,{variant:"primary",onClick:s.onImportDecks,children:[r.jsx(ae,{name:"plus",className:"w-5 h-5 mr-2"}),"Create / Import Deck"]})]}),r.jsxs("div",{className:"flex flex-col md:flex-row justify-between items-center gap-4 p-4 bg-surface rounded-lg border border-border",children:[r.jsxs("div",{className:"relative w-full md:max-w-xs",children:[r.jsx(ae,{name:"search",className:"absolute left-3 top-1/2 -translate-y-1/2 w-5 h-5 text-text-muted"}),r.jsx("input",{type:"text",placeholder:"Search decks...",value:p,onChange:x=>o(x.target.value),className:"w-full pl-10 pr-4 py-2 bg-background border border-border rounded-md focus:ring-2 focus:ring-primary focus:outline-none"})]}),r.jsxs("div",{className:"flex flex-wrap items-center justify-center gap-2",children:[r.jsxs(ve,{variant:"ghost",onClick:s.onNewFolder,children:[r.jsx(ae,{name:"folder-plus",className:"w-5 h-5 mr-2"}),r.jsx("span",{className:"hidden sm:inline",children:"New Folder"})]}),r.jsx(_c,{currentSort:s.sortPreference,onSortChange:s.onSortChange})]})]}),u.length===0&&p?r.jsxs("div",{className:"text-center py-20",children:[r.jsx(ae,{name:"search",className:"w-16 h-16 mx-auto text-text-muted/50"}),r.jsx("h2",{className:"mt-4 text-2xl font-bold text-text-muted",children:"No Decks Found"}),r.jsxs("p",{className:"mt-2 text-text-muted",children:['Your search for "',p,'" did not match any decks.']}),r.jsx(ve,{variant:"secondary",onClick:()=>o(""),className:"mt-6",children:"Clear Search"})]}):r.jsx(Jg,{decks:u,folders:l,sessionsToResume:s.sessionsToResume,onUpdateLastOpened:s.onUpdateLastOpened,onDeleteFolder:s.onDeleteFolder,draggedDeckId:s.draggedDeckId,onDragStart:s.onDragStart,onDragEnd:s.onDragEnd,onMoveDeck:s.onMoveDeck,openFolderIds:s.openFolderIds,onToggleFolder:s.onToggleFolder,onUpdateDeck:s.onUpdateDeck,onDeleteDeck:s.onDeleteDeck,openConfirmModal:s.openConfirmModal,onSaveFolder:s.handleSaveFolder,onGenerateQuestionsForDeck:s.onGenerateQuestionsForDeck,onGenerateContentForLearningDeck:s.onGenerateContentForLearningDeck})]}):r.jsxs("div",{className:"text-center py-20",children:[r.jsx(ae,{name:"folder",className:"w-16 h-16 mx-auto text-gray-300 dark:text-gray-600"}),r.jsx("h2",{className:"mt-4 text-2xl font-bold text-text-muted",children:"Your deck collection is empty"}),r.jsx("p",{className:"mt-2 text-text-muted",children:"Create a new deck, import from a file, or try a sample deck to get started."}),r.jsxs("div",{className:"flex flex-col sm:flex-row items-center justify-center gap-4 mt-8",children:[r.jsxs(ve,{onClick:s.onImportDecks,children:[r.jsx(ae,{name:"plus",className:"w-5 h-5 mr-2"}),"Create or Import Deck"]}),r.jsxs(ve,{onClick:s.onCreateSampleDeck,variant:"secondary",children:[r.jsx(ae,{name:"laptop",className:"w-5 h-5 mr-2"}),"Create Sample Deck"]})]})]})},Xg=s=>{const p=new Date;p.setHours(23,59,59,999);const o=s.type==="quiz"||s.type==="learning"?s.questions:s.cards;return Array.isArray(o)?o.filter(v=>!v.suspended&&new Date(v.dueDate)<=p).length:0},ex=({onStartSeriesStudy:s,onCreateNewSeries:p,onCreateSampleSeries:o,onGenerateAI:v,onGenerateQuestionsForEmptyDecksInSeries:h})=>{const{deckSeries:u,decks:l,seriesProgress:f}=Ke(),{aiFeaturesEnabled:x}=on(),[d,T]=U.useState(""),[b,N]=U.useState("recent"),[w,I]=U.useState("all"),k=U.useMemo(()=>u.filter(R=>!R.archived&&!R.deletedAt),[u]),C=U.useMemo(()=>{const R=new Map;return k.forEach(M=>{var W;const H=(M.levels||[]).flatMap(_=>_.deckIds||[]).map(_=>l.find(ie=>ie.id===_)).filter(Boolean),V=((W=f.get(M.id))==null?void 0:W.size)||0,oe=new Set;(M.levels||[]).flatMap(_=>_.deckIds||[]).forEach((_,ie)=>{ie<=V&&oe.add(_)});const Z=H.reduce((_,ie)=>oe.has(ie.id)?_+Xg(ie):_,0),de=H.flatMap(_=>_.type===Ae.Flashcard?_.cards:_.questions).filter(_=>!_.suspended),$=de.length>0?de.reduce((_,ie)=>_+wn(ie),0)/de.length:0;R.set(M.id,{dueCount:Z,mastery:$})}),R},[k,l,f]),j=U.useMemo(()=>{let R=k.filter(M=>M.name.toLowerCase().includes(d.toLowerCase())||M.description.toLowerCase().includes(d.toLowerCase()));switch(w!=="all"&&(R=R.filter(M=>{var J;const H=(M.levels||[]).reduce((Z,de)=>Z+(de.deckIds||[]).length,0);if(H===0)return w==="inProgress";const oe=(((J=f.get(M.id))==null?void 0:J.size)||0)>=H;return w==="completed"?oe:!oe})),b){case"recent":return R.sort((M,H)=>{const V=new Date(M.lastOpened||M.createdAt||0).getTime();return new Date(H.lastOpened||H.createdAt||0).getTime()-V});case"progress":return R.sort((M,H)=>{var J,Z;const V=(((J=f.get(M.id))==null?void 0:J.size)||0)/((M.levels||[]).reduce((de,$)=>de+($.deckIds||[]).length,0)||1);return(((Z=f.get(H.id))==null?void 0:Z.size)||0)/((H.levels||[]).reduce((de,$)=>de+($.deckIds||[]).length,0)||1)-V});case"mastery":return R.sort((M,H)=>{var J,Z;const V=((J=C.get(M.id))==null?void 0:J.mastery)||0;return(((Z=C.get(H.id))==null?void 0:Z.mastery)||0)-V});case"name":default:return R.sort((M,H)=>M.name.localeCompare(H.name))}},[k,d,b,w,f,C]),O=[{key:"recent",label:"Recent"},{key:"name",label:"Name"},{key:"progress",label:"Progress"},{key:"mastery",label:"Mastery"}],F=[{key:"all",label:"All"},{key:"inProgress",label:"In Progress"},{key:"completed",label:"Completed"}];return r.jsxs("div",{className:"space-y-6",children:[r.jsxs("div",{className:"flex flex-col sm:flex-row justify-between items-center gap-4",children:[r.jsx("h1",{className:"text-3xl font-bold text-text",children:"All Series"}),r.jsxs("div",{className:"flex gap-2",children:[x&&r.jsxs(ve,{variant:"primary",onClick:v,children:[r.jsx(ae,{name:"zap",className:"w-5 h-5 mr-2"}),"Generate with AI"]}),r.jsxs(ve,{variant:"secondary",onClick:p,children:[r.jsx(ae,{name:"layers",className:"w-5 h-5 mr-2"}),"Create New Series"]})]})]}),r.jsxs("div",{className:"flex flex-col md:flex-row justify-between items-center gap-4 p-4 bg-surface rounded-lg border border-border",children:[r.jsxs("div",{className:"relative w-full md:max-w-xs",children:[r.jsx(ae,{name:"search",className:"absolute left-3 top-1/2 -translate-y-1/2 w-5 h-5 text-text-muted"}),r.jsx("input",{type:"text",placeholder:"Search series...",value:d,onChange:R=>T(R.target.value),className:"w-full pl-10 pr-4 py-2 bg-background border border-border rounded-md focus:ring-2 focus:ring-primary focus:outline-none"})]}),r.jsxs("div",{className:"flex flex-wrap items-center justify-center gap-4",children:[r.jsxs("div",{className:"flex items-center gap-2",children:[r.jsx(ae,{name:"filter",className:"w-5 h-5 text-text-muted"}),r.jsx(_c,{currentSort:w,onSortChange:R=>I(R),sortOptions:F})]}),r.jsx(_c,{currentSort:b,onSortChange:R=>N(R),sortOptions:O})]})]}),j.length>0?r.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:j.map(R=>{const M=C.get(R.id)||{dueCount:0,mastery:0},H=f.get(R.id)||new Set,oe=(R.levels||[]).flatMap(J=>J.deckIds||[]).find(J=>!H.has(J))||null;return r.jsx(bh,{series:R,completedCount:H.size,dueCount:M.dueCount,masteryLevel:M.mastery,onStartSeriesStudy:s,nextUpDeckId:oe,onGenerateAllQuestions:h},R.id)})}):r.jsxs("div",{className:"text-center py-10",children:[r.jsx(ae,{name:"layers",className:"w-12 h-12 mx-auto text-gray-300 dark:text-gray-600"}),r.jsx("h3",{className:"mt-2 text-xl font-medium text-text",children:d?"No series found":"Your series collection is empty"}),r.jsx("p",{className:"mt-1 text-sm text-text-muted",children:d?"Try adjusting your search or filter.":"Create a new series or try a sample to get started."}),!d&&k.length===0&&r.jsx("div",{className:"mt-6",children:r.jsxs(ve,{onClick:o,variant:"secondary",children:[r.jsx(ae,{name:"zap",className:"w-4 h-4 mr-2"})," Create Sample Series"]})})]})]})},wc=({icon:s,label:p,value:o})=>r.jsxs("div",{className:"bg-surface p-6 rounded-lg shadow-md border border-border flex items-center",children:[r.jsx("div",{className:"flex-shrink-0",children:s}),r.jsxs("div",{className:"ml-5 w-0 flex-1",children:[r.jsx("dt",{className:"text-sm font-medium text-text-muted truncate",children:p}),r.jsx("dd",{className:"text-2xl font-bold text-text",children:o})]})]}),tx=({stats:s})=>r.jsxs("div",{className:"grid grid-cols-1 gap-5 sm:grid-cols-3",children:[r.jsx(wc,{icon:r.jsx(ae,{name:"zap",className:"h-8 w-8 text-orange-400"}),label:"Current Streak",value:`${s.streak} day${s.streak!==1?"s":""}`}),r.jsx(wc,{icon:r.jsx(ae,{name:"check-circle",className:"h-8 w-8 text-blue-400"}),label:"Total Reviews",value:s.totalReviews.toLocaleString()}),r.jsx(wc,{icon:r.jsx(ae,{name:"trending-up",className:"h-8 w-8 text-green-400"}),label:"Mature Items",value:s.matureCount.toLocaleString()})]}),rx=({reviews:s})=>{const{grid:p,maxCount:o}=U.useMemo(()=>{const u=new Date;u.setHours(0,0,0,0);const l=new Date(u);l.setDate(l.getDate()+1);const f=new Date(l);f.setDate(f.getDate()-364-u.getDay());const x=new Map;s.forEach(N=>{const w=new Date(N.timestamp);w.setHours(0,0,0,0);const I=w.toISOString().split("T")[0];x.set(I,(x.get(I)||0)+1)});const d=Math.max(...Array.from(x.values()),1),T=[];let b=new Date(f);for(;T.length<371;){const N=b.toISOString().split("T")[0],w=x.get(N)||0;T.push({date:new Date(b),count:w}),b.setDate(b.getDate()+1)}return{grid:T,maxCount:d}},[s]),v=u=>{if(u===0)return"fill-gray-200 dark:fill-gray-700/50";const l=Math.min(u/(o*.75),1);return l>.8?"fill-green-600":l>.5?"fill-green-500":l>.2?"fill-green-400":"fill-green-300"},h=U.useMemo(()=>{var f;const u=[];let l=-1;for(let x=0;x<53;x++){const d=(f=p[x*7])==null?void 0:f.date;if(d){const T=d.getMonth();T!==l&&u.push({month:d.toLocaleString("default",{month:"short"}),col:x}),l=T}}return u},[p]);return r.jsx("div",{className:"overflow-x-auto",children:r.jsxs("svg",{width:"100%",viewBox:"0 0 848 128",children:[h.map(({month:u,col:l})=>r.jsx("text",{x:16*l+24,y:"15",className:"text-xs fill-text-muted",children:u},l)),r.jsx("text",{x:"0",y:"37",className:"text-xs fill-text-muted",children:"Mon"}),r.jsx("text",{x:"0",y:"69",className:"text-xs fill-text-muted",children:"Wed"}),r.jsx("text",{x:"0",y:"101",className:"text-xs fill-text-muted",children:"Fri"}),p.map((u,l)=>{if(!u)return null;const f=Math.floor(l/7),x=l%7;return r.jsx("rect",{x:16*f+24,y:16*x+24,width:"12",height:"12",rx:"2",ry:"2",className:v(u.count),children:r.jsx("title",{children:`${u.date.toDateString()}: ${u.count} review${u.count!==1?"s":""}`})},l)})]})})},nx=({items:s})=>{const p=U.useMemo(()=>{const d=new Date;d.setHours(0,0,0,0);const T=Array(30).fill(0);s.forEach(N=>{const w=new Date(N.dueDate);w.setHours(0,0,0,0);const I=w.getTime()-d.getTime();if(I>=0){const k=Math.floor(I/864e5);k<30&&T[k]++}});const b=Array.from({length:30},(N,w)=>{const I=new Date(d);return I.setDate(I.getDate()+w),w%7===0||w===0?I.toLocaleDateString("en-US",{month:"short",day:"numeric"}):""});return{counts:T,labels:b}},[s]),o=Math.max(...p.counts,1),v=350,h=180,u={top:25,right:10,bottom:25,left:10},l=v-u.left-u.right,f=h-u.top-u.bottom,x=l/p.counts.length-2;return r.jsx("div",{className:"w-full",children:r.jsxs("svg",{viewBox:`0 0 ${v} ${h}`,width:"100%",height:"auto","aria-labelledby":"forecast-graph-title",role:"img",className:"overflow-visible",children:[r.jsx("title",{id:"forecast-graph-title",children:"A bar chart showing the number of items due each day for the next 30 days."}),p.counts.map((d,T)=>{const b=d>0?d/o*f:0,N=u.left+T*(x+2),w=u.top+f-b;return r.jsxs("g",{className:"group cursor-pointer",children:[r.jsxs("title",{children:[p.labels[T]||new Date(new Date().setDate(new Date().getDate()+T)).toLocaleDateString(),": ",d," items"]}),r.jsx("rect",{x:N,y:w,width:x,height:b,rx:"2",className:"fill-primary/60 transition-colors group-hover:fill-primary"}),r.jsx("text",{x:N+x/2,y:w-6,textAnchor:"middle",className:"text-xs font-semibold fill-text-muted transition-opacity opacity-0 group-hover:opacity-100 pointer-events-none",children:d})]},T)}),p.labels.map((d,T)=>d?r.jsx("text",{x:u.left+T*(x+2)+x/2,y:h-u.bottom+15,textAnchor:"middle",className:"text-xs fill-text-muted",children:d},T):null)]})})},sx=({reviews:s})=>{const p=U.useMemo(()=>{const v=new Date;v.setDate(v.getDate()-30);const h=s.filter(x=>x.rating!==null&&new Date(x.timestamp)>=v),u={[mt.Again]:0,[mt.Hard]:0,[mt.Good]:0,[mt.Easy]:0};let l=0;h.forEach(x=>{x.rating&&u.hasOwnProperty(x.rating)&&(u[x.rating]++,l++)});const f=x=>l>0?(x/l*100).toFixed(1):"0.0";return{total:l,again:{count:u[mt.Again],percent:f(u[mt.Again])},hard:{count:u[mt.Hard],percent:f(u[mt.Hard])},good:{count:u[mt.Good],percent:f(u[mt.Good])},easy:{count:u[mt.Easy],percent:f(u[mt.Easy])},correctPercent:f(u[mt.Hard]+u[mt.Good]+u[mt.Easy])}},[s]);if(p.total===0)return r.jsx("div",{className:"text-center py-10",children:r.jsx("p",{className:"text-text-muted",children:"Not enough data from the last 30 days."})});const o=[{label:"Again",percent:p.again.percent,color:"bg-red-500"},{label:"Hard",percent:p.hard.percent,color:"bg-orange-500"},{label:"Good",percent:p.good.percent,color:"bg-green-500"},{label:"Easy",percent:p.easy.percent,color:"bg-blue-500"}];return r.jsxs("div",{className:"space-y-6",children:[r.jsxs("div",{className:"text-center",children:[r.jsx("p",{className:"text-lg text-text-muted",children:"Reviews Marked Correct"}),r.jsxs("p",{className:"text-4xl font-bold text-green-500",children:[p.correctPercent,"%"]})]}),r.jsx("div",{className:"flex w-full h-4 rounded-full overflow-hidden",role:"progressbar",children:o.map(v=>v.percent!=="0.0"&&r.jsx("div",{className:v.color,style:{width:`${v.percent}%`},title:`${v.label}: ${v.percent}%`},v.label))}),r.jsxs("div",{className:"grid grid-cols-2 gap-x-4 gap-y-2 text-sm",children:[r.jsxs("div",{className:"flex items-center",children:[r.jsx("span",{className:"w-2.5 h-2.5 rounded-full bg-red-500 mr-2"}),r.jsxs("span",{className:"text-text-muted",children:["Again: ",r.jsx("strong",{children:p.again.count})," (",p.again.percent,"%)"]})]}),r.jsxs("div",{className:"flex items-center",children:[r.jsx("span",{className:"w-2.5 h-2.5 rounded-full bg-orange-500 mr-2"}),r.jsxs("span",{className:"text-text-muted",children:["Hard: ",r.jsx("strong",{children:p.hard.count})," (",p.hard.percent,"%)"]})]}),r.jsxs("div",{className:"flex items-center",children:[r.jsx("span",{className:"w-2.5 h-2.5 rounded-full bg-green-500 mr-2"}),r.jsxs("span",{className:"text-text-muted",children:["Good: ",r.jsx("strong",{children:p.good.count})," (",p.good.percent,"%)"]})]}),r.jsxs("div",{className:"flex items-center",children:[r.jsx("span",{className:"w-2.5 h-2.5 rounded-full bg-blue-500 mr-2"}),r.jsxs("span",{className:"text-text-muted",children:["Easy: ",r.jsx("strong",{children:p.easy.count})," (",p.easy.percent,"%)"]})]})]})]})},ax=()=>{const[s,p]=U.useState([]),[o,v]=U.useState(!0),[h,u]=U.useState(null),l=Ke(d=>d.decks);U.useEffect(()=>{(async()=>{try{const T=new Date;T.setFullYear(T.getFullYear()-1);const b=await Zm(T);p(b)}catch(T){console.error("Failed to load review data:",T),u("Could not load your review data. Please try again later.")}finally{v(!1)}})()},[]);const f=U.useMemo(()=>{if(o)return null;let d=0;const T=s.map(I=>new Date(I.timestamp).setHours(0,0,0,0)),b=[...new Set(T)];if(b.sort((I,k)=>k-I),b.length>0){const I=new Date().setHours(0,0,0,0),k=new Date(I).setDate(new Date(I).getDate()-1);if(b[0]===I||b[0]===k){d=1;for(let C=1;C<b.length;C++){const j=b[C-1],O=b[C],F=new Date(j).setDate(new Date(j).getDate()-1);if(O===F)d++;else break}}}const w=l.reduce((I,k)=>k.type==="flashcard"?I.concat(k.cards):I.concat(k.questions),[]).filter(I=>(I.interval||0)>=21&&!I.suspended).length;return{streak:d,totalReviews:s.length,matureCount:w}},[s,l,o]),x=U.useMemo(()=>l.reduce((T,b)=>b.type==="flashcard"?T.concat(b.cards):T.concat(b.questions),[]).filter(T=>!T.suspended),[l]);return o?r.jsxs("div",{className:"flex items-center justify-center h-64",children:[r.jsx(sr,{size:"lg"}),r.jsx("p",{className:"ml-4 text-text-muted",children:"Calculating your progress..."})]}):h?r.jsx("div",{className:"text-center py-10",children:r.jsx("p",{className:"text-red-500",children:h})}):s.length===0?r.jsxs("div",{className:"text-center py-20",children:[r.jsx("h2",{className:"text-2xl font-bold text-text-muted",children:"No review history yet."}),r.jsx("p",{className:"mt-2 text-text-muted",children:"Complete a study session to start tracking your progress!"})]}):r.jsxs("div",{className:"max-w-5xl mx-auto animate-fade-in space-y-8",children:[r.jsx("h1",{className:"text-3xl font-bold text-text border-b border-border pb-4",children:"Your Progress"}),r.jsx(tx,{stats:f}),r.jsxs("div",{className:"bg-surface p-6 rounded-lg shadow-md border border-border",children:[r.jsx("h2",{className:"text-xl font-semibold text-text mb-4",children:"Activity"}),r.jsx(rx,{reviews:s})]}),r.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-8",children:[r.jsxs("div",{className:"bg-surface p-6 rounded-lg shadow-md border border-border",children:[r.jsx("h2",{className:"text-xl font-semibold text-text mb-4",children:"30-Day Forecast"}),r.jsx(nx,{items:x})]}),r.jsxs("div",{className:"bg-surface p-6 rounded-lg shadow-md border border-border",children:[r.jsx("h2",{className:"text-xl font-semibold text-text mb-4",children:"Retention (Last 30 Days)"}),r.jsx(sx,{reviews:s})]})]})]})},ix=s=>{const{path:p}=Ln(),{activeDeck:o,activeSeries:v,generalStudyDeck:h}=s,{aiFeaturesEnabled:u}=on(),[l]=p.split("?"),f=yh(),x=sg(),d=ag(),T=Ke(b=>b.seriesProgress);if(l==="/settings")return r.jsx(_g,{onExport:s.handleExportData,onRestore:()=>s.setRestoreModalOpen(!0),onResetProgress:()=>s.setResetProgressModalOpen(!0),onFactoryReset:s.handleFactoryReset,onTriggerSync:s.onTriggerSync,onFetchFromServer:s.onFetchFromServer,isSyncing:s.isSyncing,lastSyncStatus:s.lastSyncStatus});if(l==="/trash")return r.jsx(Hg,{onRestoreDeck:s.handleRestoreDeck,onRestoreSeries:s.handleRestoreSeries,onDeleteDeckPermanently:s.handleDeleteDeckPermanently,onDeleteSeriesPermanently:s.handleDeleteSeriesPermanently,openConfirmModal:s.openConfirmModal});if(l==="/archive")return r.jsx($g,{onUpdateDeck:s.handleUpdateDeck,onUpdateSeries:s.handleUpdateSeries,onDeleteDeck:s.handleDeleteDeck,onDeleteSeries:s.handleDeleteSeries,openConfirmModal:s.openConfirmModal});if(l==="/progress")return r.jsx(ax,{});if(l.startsWith("/series/")&&v)return r.jsx(Gg,{series:v,sessionsToResume:s.sessionsToResume,onUpdateSeries:s.handleUpdateSeries,onDeleteSeries:s.handleDeleteSeries,onAddDeckToSeries:s.handleAddDeckToSeries,onUpdateDeck:s.handleUpdateDeck,onStartSeriesStudy:s.handleStartSeriesStudy,openConfirmModal:s.openConfirmModal,onUpdateLastOpened:s.updateLastOpenedSeries,onAiAddLevelsToSeries:s.handleAiAddLevelsToSeries,onAiAddDecksToLevel:s.handleAiAddDecksToLevel,onGenerateQuestionsForEmptyDecksInSeries:s.onGenerateQuestionsForEmptyDecksInSeries,onCancelAIGeneration:s.onCancelAIGeneration},v.id);if(l==="/study/general"){const b=new URLSearchParams(window.location.hash.split("?")[1]).get("seriesId")||void 0;return h&&r.jsx(ei,{deck:h,seriesId:b,onSessionEnd:N=>s.handleSessionEnd(N,b),onItemReviewed:s.handleItemReviewed,onUpdateLastOpened:()=>{},onStudyNextDeck:s.handleStudyNextDeckInSeries},"general-study")}if(l.startsWith("/decks/")&&l.endsWith("/cram")&&o){const N=[...(o.type===Ae.Flashcard?o.cards:o.questions).filter(k=>!k.suspended)].sort(()=>Math.random()-.5),w=o.type===Ae.Flashcard?{...o,name:`${o.name} (Cram)`,cards:N}:{...o,name:`${o.name} (Cram)`,questions:N},I=new URLSearchParams(window.location.hash.split("?")[1]).get("seriesId")||void 0;return r.jsx(ei,{deck:w,seriesId:I,onSessionEnd:k=>s.handleSessionEnd(k,I),onItemReviewed:s.handleItemReviewed,onUpdateLastOpened:s.updateLastOpened,sessionKeySuffix:"_cram",onStudyNextDeck:s.handleStudyNextDeckInSeries},`${o.id}-cram`)}if(l.startsWith("/decks/")&&l.endsWith("/study-reversed")&&o&&o.type==="flashcard"){const b={...o,name:`${o.name} (Reversed)`,cards:o.cards.map(w=>({...w,front:w.back,back:w.front}))},N=new URLSearchParams(window.location.hash.split("?")[1]).get("seriesId")||void 0;return r.jsx(ei,{deck:b,seriesId:N,onSessionEnd:w=>s.handleSessionEnd(w,N),onItemReviewed:s.handleItemReviewed,onUpdateLastOpened:s.updateLastOpened,sessionKeySuffix:"_reversed",onStudyNextDeck:s.handleStudyNextDeckInSeries},`${o.id}-reversed`)}if(l.startsWith("/decks/")&&l.endsWith("/study-flip")&&o&&(o.type==="quiz"||o.type==="learning")){const b=o,N=(b.questions||[]).filter(k=>!k.suspended).map(k=>{const C=k.options.find(O=>O.id===k.correctAnswerId),j=`
                        <div class="text-left w-full">
                            <p class="text-xl"><b>Answer:</b> ${(C==null?void 0:C.text)||"N/A"}</p>
                            <hr class="my-4 border-gray-300 dark:border-gray-600"/>
                            <p class="text-sm font-semibold uppercase tracking-wider text-gray-500 dark:text-gray-400">Explanation</p>
                            <div class="prose prose-sm dark:prose-invert max-w-none mt-2">${k.detailedExplanation||"No detailed explanation provided."}</div>
                        </div>
                    `;return{...k,front:k.questionText,back:j}}),w={...b,name:`${b.name} (Review)`,type:Ae.Flashcard,cards:N.sort(()=>Math.random()-.5)},I=new URLSearchParams(window.location.hash.split("?")[1]).get("seriesId")||void 0;return r.jsx(ei,{deck:w,seriesId:I,onSessionEnd:k=>s.handleSessionEnd(k,I),onItemReviewed:s.handleItemReviewed,onUpdateLastOpened:s.updateLastOpened,sessionKeySuffix:"_flip",onStudyNextDeck:s.handleStudyNextDeckInSeries},`${o.id}-flip`)}if(l.startsWith("/decks/")&&l.endsWith("/study")){const b=new URLSearchParams(window.location.hash.split("?")[1]).get("seriesId")||void 0;return o&&r.jsx(ei,{deck:o,seriesId:b,onSessionEnd:N=>s.handleSessionEnd(N,b),onItemReviewed:s.handleItemReviewed,onUpdateLastOpened:s.updateLastOpened,onStudyNextDeck:s.handleStudyNextDeckInSeries},o.id)}return l.startsWith("/decks/")?o&&r.jsx(qg,{deck:o,sessionsToResume:s.sessionsToResume,onUpdateDeck:s.handleUpdateDeck,onDeleteDeck:s.handleDeleteDeck,onUpdateLastOpened:s.updateLastOpened,openConfirmModal:s.openConfirmModal,onGenerateQuestionsForDeck:s.onGenerateQuestionsForDeck,onGenerateContentForLearningDeck:s.onGenerateContentForLearningDeck,onCancelAIGeneration:s.onCancelAIGeneration,onSaveLearningBlock:s.onSaveLearningBlock,onDeleteLearningBlock:s.onDeleteLearningBlock},o.id):l==="/instructions/json"?r.jsx(Bg,{}):l==="/decks"?r.jsx(Zg,{sessionsToResume:s.sessionsToResume,sortPreference:s.sortPreference,onSortChange:s.setSortPreference,onUpdateLastOpened:s.updateLastOpened,onDeleteFolder:s.handleDeleteFolder,draggedDeckId:s.draggedDeckId,onDragStart:s.setDraggedDeckId,onDragEnd:()=>s.setDraggedDeckId(null),onMoveDeck:s.handleMoveDeck,openFolderIds:s.openFolderIds,onToggleFolder:s.onToggleFolder,onUpdateDeck:s.handleUpdateDeck,onDeleteDeck:s.handleDeleteDeck,openConfirmModal:s.openConfirmModal,onNewFolder:()=>s.openFolderModal("new"),onImportDecks:()=>s.setImportModalOpen(!0),onCreateSampleDeck:s.handleCreateSampleDeck,handleSaveFolder:s.handleSaveFolder,onGenerateQuestionsForDeck:s.onGenerateQuestionsForDeck,onGenerateContentForLearningDeck:s.onGenerateContentForLearningDeck,onCancelAIGeneration:s.onCancelAIGeneration}):l==="/series"?r.jsx(ex,{onStartSeriesStudy:s.handleStartSeriesStudy,onCreateNewSeries:s.openCreateSeriesModal,onCreateSampleSeries:s.handleCreateSampleSeries,onGenerateAI:s.openAIGenerationModal,onGenerateQuestionsForEmptyDecksInSeries:s.onGenerateQuestionsForEmptyDecksInSeries,onCancelAIGeneration:s.onCancelAIGeneration}):f.length>0||x.length>0?r.jsx(Yg,{onStartGeneralStudy:s.handleStartGeneralStudy,sessionsToResume:s.sessionsToResume,onUpdateLastOpened:s.updateLastOpened,onUpdateDeck:s.handleUpdateDeck,onDeleteDeck:s.handleDeleteDeck,openConfirmModal:s.openConfirmModal,onStartSeriesStudy:s.handleStartSeriesStudy,totalDueQuestions:d,seriesProgress:T,onGenerateQuestionsForDeck:s.onGenerateQuestionsForDeck,onGenerateContentForLearningDeck:s.onGenerateContentForLearningDeck,onGenerateQuestionsForEmptyDecksInSeries:s.onGenerateQuestionsForEmptyDecksInSeries,onCancelAIGeneration:s.onCancelAIGeneration}):r.jsxs("div",{className:"text-center py-20",children:[r.jsx("h2",{className:"text-3xl font-bold text-gray-600 dark:text-gray-400",children:"Welcome to CogniFlow"}),r.jsx("p",{className:"mt-4 text-gray-500 dark:text-gray-500",children:"Create decks, import content, restore from a backup, or try a sample to get started."}),r.jsxs("div",{className:"flex flex-col sm:flex-row items-center justify-center gap-4 mt-8 flex-wrap",children:[u&&r.jsxs(ve,{onClick:s.openAIGenerationModal,variant:"primary",children:[r.jsx(ae,{name:"zap",className:"w-5 h-5 mr-2"}),"Generate with AI"]}),r.jsxs(ve,{onClick:()=>s.setImportModalOpen(!0),children:[r.jsx(ae,{name:"plus",className:"w-5 h-5 mr-2"}),"Create or Import Deck"]}),r.jsxs(ve,{onClick:()=>s.setRestoreModalOpen(!0),variant:"secondary",children:[r.jsx(ae,{name:"upload-cloud",className:"w-5 h-5 mr-2"}),"Restore from Backup"]}),r.jsxs(ve,{onClick:s.openCreateSeriesModal,variant:"secondary",children:[r.jsx(ae,{name:"layers",className:"w-5 h-5 mr-2"}),"Create New Series"]}),r.jsxs(ve,{onClick:s.handleCreateSampleDeck,variant:"ghost",children:[r.jsx(ae,{name:"laptop",className:"w-5 h-5 mr-2"}),"Create Sample Deck"]}),r.jsxs(ve,{onClick:s.handleCreateSampleSeries,variant:"ghost",children:[r.jsx(ae,{name:"zap",className:"w-5 h-5 mr-2"}),"Create Sample Series"]})]})]})},ox=({isOpen:s,onClose:p,actions:o})=>{const[v,h]=U.useState(""),[u,l]=U.useState(0),f=U.useRef(null),x=U.useRef(null),{navigate:d}=Ln(),{decks:T,deckSeries:b}=Ke();pr(f,s);const N=U.useMemo(()=>{const R=[];return o.forEach(M=>R.push({type:"action",id:M.id,label:M.label,icon:M.icon,run:M.action,keywords:M.keywords,searchableOnly:M.searchableOnly})),T.filter(M=>!M.archived&&!M.deletedAt).forEach(M=>R.push({type:"deck",id:M.id,name:M.name,itemType:M.type})),b.filter(M=>!M.archived&&!M.deletedAt).forEach(M=>R.push({type:"series",id:M.id,name:M.name})),T.filter(M=>!M.archived&&!M.deletedAt).forEach(M=>{M.type==="flashcard"?M.cards.forEach(H=>R.push({type:"card",id:H.id,deckId:M.id,deckName:M.name,front:H.front})):M.questions.forEach(H=>R.push({type:"question",id:H.id,deckId:M.id,deckName:M.name,text:H.questionText}))}),R},[o,T,b]),w=U.useMemo(()=>{if(!v.trim())return N.filter(H=>H.type==="action"&&!H.searchableOnly);const R=v.toLowerCase();return N.filter(H=>{switch(H.type){case"action":{const V=H,oe=V.label.toLowerCase().includes(R),J=(V.keywords||[]).some(Z=>Z.toLowerCase().includes(R));return oe||J}case"deck":return H.name.toLowerCase().includes(R);case"series":return H.name.toLowerCase().includes(R);case"card":return sn(H.front).toLowerCase().includes(R);case"question":return H.text.toLowerCase().includes(R);default:return!1}}).slice(0,50)},[v,N]),I=U.useMemo(()=>{const R={Actions:[],Series:[],Decks:[],Cards:[]};return w.forEach(M=>{M.type==="action"?R.Actions.push(M):M.type==="series"?R.Series.push(M):M.type==="deck"?R.Decks.push(M):(M.type==="card"||M.type==="question")&&R.Cards.push(M)}),Object.entries(R).filter(([,M])=>M.length>0)},[w]),k=U.useMemo(()=>I.flatMap(([,R])=>R),[I]),C=U.useCallback(R=>{switch(R.type){case"action":R.run();break;case"deck":d(`/decks/${R.id}`);break;case"series":d(`/series/${R.id}`);break;case"card":case"question":d(`/decks/${R.deckId}`);break}p()},[d,p]);U.useEffect(()=>{const R=M=>{if(s)if(M.key==="ArrowDown")M.preventDefault(),l(H=>(H+1)%(k.length||1));else if(M.key==="ArrowUp")M.preventDefault(),l(H=>(H-1+(k.length||1))%(k.length||1));else if(M.key==="Enter"){M.preventDefault();const H=k[u];H&&C(H)}else M.key==="Escape"&&p()};return window.addEventListener("keydown",R),()=>window.removeEventListener("keydown",R)},[s,u,k,C,p]),U.useEffect(()=>{s&&(h(""),l(0))},[s]),U.useEffect(()=>{l(0)},[v]),U.useEffect(()=>{var R;(R=document.getElementById(`cmdk-item-${u}`))==null||R.scrollIntoView({block:"nearest"})},[u]);const j=R=>{R.target===R.currentTarget&&p()};if(!s)return null;const O=(R,M)=>{let H,V="",oe;switch(R.type){case"action":H=R.icon,V=R.label;break;case"deck":H="help-circle",R.itemType===Ae.Flashcard?H="laptop":R.itemType===Ae.Learning&&(H="layers"),V=R.name;break;case"series":H="layers",V=R.name;break;case"card":H="laptop",V=sn(R.front),oe=`In: ${R.deckName}`;break;case"question":H="help-circle",V=R.text,oe=`In: ${R.deckName}`;break}return r.jsxs("li",{id:`cmdk-item-${M}`,role:"option","aria-selected":u===M,onClick:()=>C(R),className:`flex items-center gap-4 px-4 py-3 cursor-pointer rounded-md ${u===M?"bg-primary/10":"hover:bg-border/30"}`,children:[r.jsx(ae,{name:H,className:"w-5 h-5 text-text-muted flex-shrink-0"}),r.jsxs("div",{className:"flex-grow min-w-0",children:[r.jsx("p",{className:`font-medium truncate ${u===M?"text-primary":"text-text"}`,children:V}),oe&&r.jsx("p",{className:`text-sm truncate ${u===M?"text-primary/80":"text-text-muted"}`,children:oe})]})]},R.id)};let F=0;return r.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-70 flex justify-center items-start pt-4 sm:pt-[15vh] z-50 p-4",onClick:j,children:r.jsxs("div",{ref:f,role:"dialog","aria-modal":"true",className:"bg-surface rounded-lg shadow-xl w-full max-w-2xl transform transition-all relative max-h-[70vh] flex flex-col",children:[r.jsxs("div",{className:"flex items-center gap-2 p-4 border-b border-border",children:[r.jsx(ae,{name:"search",className:"w-5 h-5 text-text-muted"}),r.jsx("input",{type:"text",value:v,onChange:R=>h(R.target.value),placeholder:"Search for anything or type a command...",className:"w-full bg-transparent focus:outline-none text-lg placeholder:text-text-muted",autoFocus:!0}),r.jsx("div",{className:"hidden sm:block text-xs text-text-muted border border-border rounded px-1.5 py-0.5",children:"ESC"})]}),r.jsx("div",{className:"flex-grow overflow-y-auto p-2",children:k.length>0?r.jsx("ul",{ref:x,role:"listbox",children:I.map(([R,M])=>r.jsxs("li",{children:[r.jsx("p",{className:"px-4 py-2 text-xs font-semibold text-text-muted uppercase tracking-wider",children:R}),r.jsx("ul",{className:"space-y-1",children:M.map(H=>O(H,F++))})]},R))}):r.jsx("div",{className:"text-center py-10 px-4",children:r.jsxs("p",{className:"text-text-muted",children:['No results found for "',v,'".']})})}),r.jsx("div",{className:"hidden sm:flex flex-shrink-0 justify-end items-center p-2 border-t border-border",children:r.jsxs("span",{className:"text-sm text-text-muted",children:[r.jsx(ae,{name:"terminal",className:"inline-block w-4 h-4 mr-2"}),r.jsx("kbd",{className:"font-sans",children:"Cmd+K"})," to toggle"]})})]})})},lx=({isOpen:s,onClose:p,onConfirm:o,analysis:v})=>{const[h,u]=U.useState(""),l=U.useRef(null);pr(l,s),U.useEffect(()=>{v.type==="quiz"&&v.data.name?u(v.data.name):u("")},[v]);const{title:f,message:x,confirmText:d}=U.useMemo(()=>{switch(v.type){case"backup":return{title:"Restore from Backup",message:`You dropped the backup file "${v.fileName}". Restoring will merge its content with your current data. Do you want to continue?`,confirmText:"Restore"};case"quiz_series":return{title:"Import Series",message:`You dropped a file containing the series "${v.data.seriesName}". Would you like to import it?`,confirmText:"Import Series"};case"quiz":return{title:"Import Quiz Deck",message:`You dropped a file for the quiz deck "${v.data.name}". Would you like to import it?`,confirmText:"Import Deck"};case"flashcard":return{title:"Import Flashcard Deck",message:`You dropped a file with ${v.data.length} flashcard(s). Please provide a name for the new deck.`,confirmText:"Import Deck"};default:return{title:"Confirm Import",message:"Unknown file type.",confirmText:"Confirm"}}},[v]),T=v.type==="flashcard"&&!h.trim(),b=()=>{o(v,h.trim())};return s?r.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-75 flex items-center justify-center z-50 p-4",children:r.jsxs("div",{ref:l,className:"bg-surface rounded-lg shadow-xl w-full max-w-lg transform transition-all relative",children:[r.jsxs("div",{className:"flex justify-between items-center p-4 border-b border-border",children:[r.jsx("h2",{className:"text-xl font-bold text-text",children:f}),r.jsx(ve,{type:"button",variant:"ghost",onClick:p,className:"p-1 h-auto","aria-label":"Close",children:r.jsx(ae,{name:"x"})})]}),r.jsxs("div",{className:"p-6 space-y-4",children:[r.jsx("p",{className:"text-text-muted",children:x}),(v.type==="flashcard"||v.type==="quiz")&&r.jsxs("div",{children:[r.jsx("label",{htmlFor:"deck-name-input",className:"block text-sm font-medium text-text-muted mb-1",children:"Deck Name"}),r.jsx("input",{id:"deck-name-input",type:"text",value:h,onChange:N=>u(N.target.value),className:"w-full p-2 bg-background border border-border rounded-md focus:ring-2 focus:ring-primary focus:outline-none",placeholder:"Enter a name for the new deck",autoFocus:!0})]})]}),r.jsxs("div",{className:"flex justify-end p-4 bg-background/50 border-t border-border",children:[r.jsx(ve,{type:"button",variant:"secondary",onClick:p,className:"mr-2",children:"Cancel"}),r.jsx(ve,{type:"button",variant:"primary",onClick:b,disabled:T,children:d})]})]})}):null},cx=({isOpen:s,onClose:p,onGenerate:o})=>{const[v,h]=U.useState(null),[u,l]=U.useState(!1),[f,x]=U.useState(""),[d,T]=U.useState(""),[b,N]=U.useState("Standard"),[w,I]=U.useState(""),[k,C]=U.useState(""),[j,O]=U.useState(""),[F,R]=U.useState(""),[M,H]=U.useState("English"),[V,oe]=U.useState(""),[J,Z]=U.useState(!0),{addToast:de}=er(),$=U.useRef(null);pr($,s);const{aiGenerationStatus:W}=Ke(),_=["Novice","Beginner","Intermediate","Advanced","Expert"],ie=["Quick Overview","Standard","Comprehensive","Exhaustive"],be=["Master a subject","Learn for the sake of curiosity","Explore a new interest","Become more informed","Understand a complex topic","Practically learn the topic"],ge=["Conceptual Understanding (Why & How)","Factual Recall (What, Who, When)","Practical Application & Scenarios"],je=["English","Spanish","French","German","Japanese","Mandarin","Russian"],fe=()=>{h(null),l(!1),x(""),oe(""),T(""),O(""),R(""),I(""),C(""),N("Standard"),H("English"),p()},B=A=>{if(A.preventDefault(),W.isGenerating){de("An AI generation task is already in progress. Please wait for it to complete.","info");return}if(!v)return;if(!f.trim()){de("Please enter a topic.","error");return}const pe={...{topic:f,level:V||void 0,comprehensiveness:b,customInstructions:d||void 0,learningGoal:w||void 0,learningStyle:k||void 0,focusTopics:j||void 0,excludeTopics:F||void 0,language:M||void 0},generationType:v,isLearningMode:u,generateQuestions:v==="series"?J:void 0};o(pe),de("AI generation has started. A status indicator will appear in the corner.","info"),fe()};if(!s)return null;const S=()=>r.jsxs("form",{onSubmit:B,className:"flex-grow overflow-y-auto p-6 space-y-6",children:[r.jsxs("div",{children:[r.jsxs("label",{htmlFor:"ai-topic",className:"block text-sm font-bold text-text mb-1",children:["Main Topic ",r.jsx("span",{className:"text-red-500",children:"*"})]}),r.jsx("input",{id:"ai-topic",type:"text",value:f,onChange:A=>x(A.target.value),className:"w-full p-2 bg-background border border-border rounded-md focus:ring-2 focus:ring-primary focus:outline-none",placeholder:"e.g., The History of Ancient Rome",required:!0,autoFocus:!0})]}),r.jsx("div",{className:"bg-primary/10 p-4 rounded-lg border border-primary/20",children:r.jsx(ka,{label:"Enable Learning Mode",description:"Generates info cards followed by related questions.",checked:u,onChange:l})}),v==="series"&&r.jsx("div",{className:"bg-primary/10 p-4 rounded-lg border border-primary/20",children:r.jsx(ka,{label:"Generate questions for all decks",description:"The AI will create the full series and populate all decks with questions.",checked:J,onChange:Z})}),r.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[r.jsxs("div",{children:[r.jsx("label",{htmlFor:"ai-level",className:"block text-sm font-medium text-text-muted mb-1",children:" My Current Understanding Is... "}),r.jsxs("select",{id:"ai-level",value:V,onChange:A=>oe(A.target.value),className:"w-full p-2 bg-background border border-border rounded-md focus:ring-2 focus:ring-primary focus:outline-none",children:[r.jsx("option",{value:"",children:"(Optional)"}),_.map(A=>r.jsx("option",{value:A,children:A},A))]})]}),r.jsxs("div",{children:[r.jsx("label",{htmlFor:"ai-goal",className:"block text-sm font-medium text-text-muted mb-1",children:" My Primary Goal Is... "}),r.jsxs("select",{id:"ai-goal",value:w,onChange:A=>I(A.target.value),className:"w-full p-2 bg-background border border-border rounded-md focus:ring-2 focus:ring-primary focus:outline-none",children:[r.jsx("option",{value:"",children:"(Optional)"}),be.map(A=>r.jsx("option",{value:A,children:A},A))]})]})]}),r.jsxs("details",{className:"space-y-4",children:[r.jsx("summary",{className:"cursor-pointer text-sm font-medium text-primary hover:underline",children:" Advanced Options "}),r.jsxs("div",{className:"pt-4 space-y-6 animate-fade-in",children:[r.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[r.jsxs("div",{children:[r.jsx("label",{htmlFor:"ai-style",className:"block text-sm font-medium text-text-muted mb-1",children:" Preferred Learning Style "}),r.jsxs("select",{id:"ai-style",value:k,onChange:A=>C(A.target.value),className:"w-full p-2 bg-background border border-border rounded-md focus:ring-2 focus:ring-primary focus:outline-none",children:[r.jsx("option",{value:"",children:"(Optional)"}),ge.map(A=>r.jsx("option",{value:A,children:A},A))]})]}),r.jsxs("div",{children:[r.jsx("label",{htmlFor:"ai-comp",className:"block text-sm font-medium text-text-muted mb-1",children:" Desired Comprehensiveness "}),r.jsx("select",{id:"ai-comp",value:b,onChange:A=>N(A.target.value),className:"w-full p-2 bg-background border border-border rounded-md focus:ring-2 focus:ring-primary focus:outline-none",children:ie.map(A=>r.jsx("option",{value:A,children:A},A))})]})]}),r.jsxs("div",{children:[r.jsx("label",{htmlFor:"ai-focus",className:"block text-sm font-medium text-text-muted mb-1",children:" Specific Topics to Focus On "}),r.jsx("input",{id:"ai-focus",type:"text",value:j,onChange:A=>O(A.target.value),className:"w-full p-2 bg-background border border-border rounded-md focus:ring-2 focus:ring-primary focus:outline-none",placeholder:"e.g., The Roman Republic, not the Empire"})]}),r.jsxs("div",{children:[r.jsx("label",{htmlFor:"ai-exclude",className:"block text-sm font-medium text-text-muted mb-1",children:" Topics to Exclude "}),r.jsx("input",{id:"ai-exclude",type:"text",value:F,onChange:A=>R(A.target.value),className:"w-full p-2 bg-background border border-border rounded-md focus:ring-2 focus:ring-primary focus:outline-none",placeholder:"e.g., military history, specific emperors"})]}),r.jsxs("div",{children:[r.jsx("label",{htmlFor:"ai-instructions",className:"block text-sm font-medium text-text-muted mb-1",children:" Additional Instructions "}),r.jsx("textarea",{id:"ai-instructions",value:d,onChange:A=>T(A.target.value),rows:3,className:"w-full p-2 bg-background border border-border rounded-md focus:ring-2 focus:ring-primary focus:outline-none",placeholder:"e.g., 'Focus on practical examples for a beginner.'"})]}),r.jsxs("div",{children:[r.jsx("label",{htmlFor:"ai-lang",className:"block text-sm font-medium text-text-muted mb-1",children:" Output Language "}),r.jsx("select",{id:"ai-lang",value:M,onChange:A=>H(A.target.value),className:"w-full p-2 bg-background border border-border rounded-md focus:ring-2 focus:ring-primary focus:outline-none",children:je.map(A=>r.jsx("option",{value:A,children:A},A))})]})]})]})]});return r.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-75 flex items-center justify-center z-50 p-4",children:r.jsxs("div",{ref:$,className:"bg-surface rounded-lg shadow-xl w-full max-w-2xl transform transition-all relative max-h-[90vh] flex flex-col",children:[r.jsxs("div",{className:"flex-shrink-0 flex justify-between items-center p-4 border-b border-border",children:[r.jsxs("div",{className:"flex items-center gap-2",children:[v&&r.jsx(ve,{variant:"ghost",size:"sm",className:"p-1",onClick:()=>h(null),disabled:W.isGenerating,children:r.jsx(ae,{name:"chevron-left"})}),r.jsx("h2",{className:"text-xl font-bold",children:"Generate with AI"})]}),r.jsx(ve,{type:"button",variant:"ghost",onClick:fe,className:"p-1 h-auto",disabled:W.isGenerating,children:r.jsx(ae,{name:"x"})})]}),v?S():r.jsxs("div",{className:"p-6 text-center space-y-4",children:[r.jsx("p",{className:"text-text-muted",children:"What would you like to create?"}),r.jsxs("div",{className:"flex flex-col sm:flex-row gap-4 justify-center",children:[r.jsxs(ve,{variant:"secondary",size:"lg",onClick:()=>h("series"),className:"w-full sm:w-auto",children:[r.jsx(ae,{name:"layers",className:"w-5 h-5 mr-2"}),"A Series of Decks"]}),r.jsxs(ve,{variant:"secondary",size:"lg",onClick:()=>h("deck"),className:"w-full sm:w-auto",children:[r.jsx(ae,{name:"help-circle",className:"w-5 h-5 mr-2"}),"A Single Deck"]})]})]}),v&&r.jsxs("div",{className:"flex-shrink-0 flex justify-end p-4 bg-background/50 border-t border-border",children:[r.jsx(ve,{type:"button",variant:"secondary",onClick:fe,className:"mr-2",disabled:W.isGenerating,children:"Cancel"}),r.jsx(ve,{type:"submit",variant:"primary",onClick:B,disabled:W.isGenerating,children:`Generate ${v==="series"?"Series":"Deck"}`})]})]})})},ux=()=>{const s=Ke(v=>v.dispatch),p=Ke(v=>v.isAIChatOpen),o=()=>{s({type:"TOGGLE_AI_CHAT",payload:!0})};return p?null:r.jsx("div",{className:"fixed bottom-6 right-6 z-40",children:r.jsx(ve,{variant:"primary",onClick:o,className:"rounded-full w-16 h-16 shadow-lg flex items-center justify-center","aria-label":"Open AI Assistant",children:r.jsx(ae,{name:"bot",className:"w-8 h-8"})})})},dx=()=>{throw new Error("AI features are disabled. A Google Gemini API key is required.")},fx={type:at.ARRAY,description:"An array of one or more actions the user wants to perform. If the user is just chatting, return an empty array or an array with a single NO_ACTION.",items:{type:at.OBJECT,properties:{action:{type:at.STRING,enum:Object.values(Pr),description:"The specific action the user wants to perform. Use NO_ACTION for conversational replies."},payload:{type:at.OBJECT,description:"The data needed to perform the action. Include only necessary fields.",properties:{deckId:{type:at.STRING,description:"The ID of the target deck."},folderId:{type:at.STRING,description:"The ID of the target folder. Use null to move a deck out of a folder."},name:{type:at.STRING,description:"The name for a new deck or folder."},newName:{type:at.STRING,description:"The new name for a deck or folder being renamed."},seriesId:{type:at.STRING,description:"The ID of the target series for expansion."},levelIndex:{type:at.NUMBER,description:"The 0-based index of the level within the series to add decks to."},count:{type:at.NUMBER,description:"The number of questions to generate for a deck."}}},confirmationMessage:{type:at.STRING,description:"A friendly message to the user asking them to confirm the action. For a NO_ACTION, this should be the AI's conversational reply."}},required:["action","payload","confirmationMessage"]}},hx=async(s,p)=>{const o=dx(),v=p.decks.map(f=>`- Deck: "${f.name}" (id: ${f.id}, folderId: ${f.folderId||"none"})`).join(`
`),h=p.folders.map(f=>`- Folder: "${f.name}" (id: ${f.id})`).join(`
`),u=p.series.map(f=>{const x=f.levels.map((d,T)=>`  - Level ${T}: ${d.title} (${d.deckIds.length} decks)`).join(`
`);return`- Series: "${f.name}" (id: ${f.id})
${x}`}).join(`
`),l=`
        You are an AI assistant for the 'CogniFlow' flashcard app. Your goal is to help users manage their decks and folders by interpreting their natural language requests.

        You MUST respond with a JSON object that is an array of actions, conforming to the provided schema.

        **Your Capabilities:**
        - Create, rename, move, and delete decks.
        - Create, rename, and delete folders.
        - Analyze and expand learning series by adding new levels or decks.
        - Generate new, unique questions for a specific quiz deck, with support for HTML formatting (e.g., \`<b>\`, \`<i>\`, \`<ruby>\`).

        **Instructions:**
        1.  Analyze the user's request.
        2.  Analyze the provided application state to find the relevant IDs for decks and folders mentioned by name.
        3.  If the user's request is ambiguous (e.g., "delete the history deck" when multiple exist), ask for clarification by using the 'NO_ACTION' type and formulating a question in the 'confirmationMessage'.
        4.  If the user is just chatting or asking a question you can't perform an action for, use the 'NO_ACTION' type and provide a helpful response in the 'confirmationMessage'.
        5.  For any action that modifies data, construct a clear and concise 'confirmationMessage' for the user to approve. Example: "Are you sure you want to delete the deck 'Ancient Rome'?" or "Okay, I'll create a new folder named 'Languages'. Correct?"
        6.  For MOVE_DECK_TO_FOLDER, if the user wants to move a deck out of a folder, the 'folderId' in the payload should be \`null\`.
        7.  For EXPAND_SERIES_ADD_DECKS, you must identify the correct series by name to get its ID, and determine the correct 0-based 'levelIndex' from the user's request (e.g., "add a deck to the first level" means levelIndex: 0).
        8.  For GENERATE_QUESTIONS_FOR_DECK, identify the target deck by name to get its ID. If the user specifies a number (e.g., "add 10 questions"), include it in the 'count' payload property. The generated content should leverage HTML formatting where appropriate for clarity (e.g., using <b> for emphasis or <ruby> for annotations in language decks).

        **Current Application State:**
        
        **Folders:**
        ${h||"No folders exist."}
        
        **Decks:**
        ${v||"No decks exist."}

        **Series:**
        ${u||"No series exist."}
    `;try{const x=(await o.models.generateContent({model:"gemini-2.5-flash",contents:s,config:{systemInstruction:l,responseMimeType:"application/json",responseSchema:fx}})).text.trim(),d=JSON.parse(x);if(!Array.isArray(d))throw new Error("AI response was not a valid array of actions.");return d}catch(f){throw console.error("Error getting AI response:",f),f instanceof Error&&f.message.includes("SAFETY")?new Error("The request was blocked due to safety settings. Please try a different request."):new Error("Sorry, I had trouble understanding that. Could you try rephrasing?")}},mx=({onExecuteAction:s})=>{const{dispatch:p,isAIChatOpen:o,aiChatHistory:v,decks:h,folders:u,deckSeries:l}=Ke(),[f,x]=U.useState(""),d=U.useRef(null),T=()=>{p({type:"TOGGLE_AI_CHAT",payload:!1})};U.useEffect(()=>{var w;(w=d.current)==null||w.scrollIntoView({behavior:"smooth"})},[v]);const b=async w=>{var O;w.preventDefault();const I=f.trim();if(!I)return;x("");const k={id:crypto.randomUUID(),role:"user",text:I},C={id:crypto.randomUUID(),role:"model",text:"",isLoading:!0},j=[...v,k,C];p({type:"SET_AI_CHAT_HISTORY",payload:j});try{const F=await hx(I,{decks:h,folders:u,series:l}),R={id:crypto.randomUUID(),role:"model",text:((O=F.find(M=>M.confirmationMessage))==null?void 0:O.confirmationMessage)||"Here are the actions I can perform for you.",actions:F};p({type:"SET_AI_CHAT_HISTORY",payload:[...v,k,R]})}catch(F){const R={id:crypto.randomUUID(),role:"model",text:F instanceof Error?F.message:"An unknown error occurred."};p({type:"SET_AI_CHAT_HISTORY",payload:[...v,k,R]})}},N=w=>{s(w),T()};return o?r.jsxs("div",{className:"fixed inset-0 bg-black/50 z-50 flex flex-col items-center justify-end",onClick:T,children:[r.jsxs("div",{className:"bg-surface w-full max-w-2xl h-[70vh] max-h-[600px] rounded-t-2xl shadow-2xl flex flex-col transform transition-transform duration-300 animate-fade-in",style:{animationName:"slideUp",animationDuration:"0.3s"},onClick:w=>w.stopPropagation(),children:[r.jsxs("header",{className:"flex-shrink-0 flex items-center justify-between p-4 border-b border-border",children:[r.jsxs("div",{className:"flex items-center gap-2",children:[r.jsx(ae,{name:"bot",className:"w-6 h-6 text-primary"}),r.jsx("h2",{className:"text-xl font-bold text-text",children:"AI Assistant"})]}),r.jsx(ve,{variant:"ghost",onClick:T,className:"p-1 h-auto",children:r.jsx(ae,{name:"x"})})]}),r.jsx("main",{className:"flex-grow p-4 overflow-y-auto",children:r.jsxs("div",{className:"space-y-4",children:[v.map(w=>r.jsxs("div",{className:`flex gap-3 ${w.role==="user"?"justify-end":"justify-start"}`,children:[w.role==="model"&&r.jsx(ae,{name:"bot",className:"w-6 h-6 text-primary flex-shrink-0 mt-1"}),r.jsxs("div",{className:`max-w-md p-3 rounded-2xl ${w.role==="user"?"bg-primary text-on-primary rounded-br-lg":"bg-background rounded-bl-lg"}`,children:[w.isLoading?r.jsxs("div",{className:"flex items-center gap-2",children:[r.jsx(sr,{size:"sm"}),r.jsx("span",{className:"text-text-muted",children:"Thinking..."})]}):r.jsx("p",{className:"whitespace-pre-wrap",children:w.text}),w.actions&&w.actions.length>0&&r.jsx("div",{className:"mt-3 pt-3 border-t border-border/50 flex flex-wrap gap-2",children:w.actions.map((I,k)=>I.action!=="NO_ACTION"&&r.jsx(ve,{size:"sm",variant:"secondary",onClick:()=>N(I),children:I.action.replace(/_/g," ").toLowerCase()},k))})]})]},w.id)),r.jsx("div",{ref:d})]})}),r.jsx("footer",{className:"flex-shrink-0 p-4 border-t border-border",children:r.jsxs("form",{onSubmit:b,className:"flex items-center gap-2",children:[r.jsx("input",{type:"text",value:f,onChange:w=>x(w.target.value),placeholder:"e.g., 'Rename my history deck...'",className:"flex-grow p-2 bg-background border border-border rounded-full focus:ring-2 focus:ring-primary focus:outline-none px-4",autoFocus:!0}),r.jsx(ve,{type:"submit",variant:"primary",className:"rounded-full w-10 h-10 p-0","aria-label":"Send message",children:r.jsx(ae,{name:"arrow-down",className:"w-5 h-5 -rotate-90"})})]})})]}),r.jsx("style",{children:`
              @keyframes slideUp {
                from { transform: translateY(100%); }
                to { transform: translateY(0); }
              }
            `})]}):null},px=({onOpen:s,onCancel:p})=>{const{isGenerating:o,statusText:v}=Ke(h=>h.aiGenerationStatus);return o?r.jsxs("div",{className:"fixed bottom-6 left-6 z-40 flex items-center gap-2",children:[r.jsx("button",{onClick:s,className:"bg-surface rounded-full shadow-lg flex items-center justify-center p-2 group","aria-label":"View AI generation status",title:v||"AI task in progress...",children:r.jsxs("div",{className:"relative w-12 h-12 flex items-center justify-center",children:[r.jsx("svg",{className:"absolute w-full h-full animate-spin",style:{animationDuration:"1.5s"},viewBox:"0 0 24 24",children:r.jsx("circle",{cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"2",fill:"none",className:"text-primary/50",strokeDasharray:"40 100"})}),r.jsx(ae,{name:"bot",className:"w-6 h-6 text-primary"})]})}),r.jsx(ve,{variant:"danger",onClick:p,className:"rounded-full w-10 h-10 p-0 shadow-lg","aria-label":"Cancel AI generation",title:"Cancel AI generation",children:r.jsx(ae,{name:"x",className:"w-5 h-5"})})]}):null},gx=({isOpen:s,onClose:p,onCancel:o})=>{const{isGenerating:v,statusText:h}=Ke(f=>f.aiGenerationStatus),u=U.useRef(null);pr(u,s);const l=()=>{o(),p()};return s?r.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-75 flex items-center justify-center z-50 p-4",children:r.jsxs("div",{ref:u,className:"bg-surface rounded-lg shadow-xl w-full max-w-lg transform transition-all relative",role:"dialog","aria-modal":"true","aria-labelledby":"ai-status-title",children:[r.jsxs("div",{className:"flex justify-between items-center p-4 border-b border-border",children:[r.jsx("h2",{id:"ai-status-title",className:"text-xl font-bold text-text",children:"AI Generation Status"}),r.jsx(ve,{type:"button",variant:"ghost",onClick:p,className:"p-1 h-auto","aria-label":"Close",children:r.jsx(ae,{name:"x"})})]}),r.jsx("div",{className:"p-8 text-center",children:v?r.jsxs(r.Fragment,{children:[r.jsx(sr,{size:"lg"}),r.jsx("p",{className:"mt-4 text-text-muted",children:h||"Processing your request..."})]}):r.jsx("p",{className:"text-text-muted",children:"No AI tasks are currently running."})}),r.jsxs("div",{className:"flex justify-between p-4 bg-background/50 border-t border-border",children:[v?r.jsx(ve,{type:"button",variant:"danger",onClick:l,children:"Cancel Generation"}):r.jsx("div",{}),r.jsx(ve,{type:"button",variant:"primary",onClick:p,children:"Close"})]})]})}):null},xx=()=>{const{dispatch:s,...p}=Ke(),[o,v]=U.useState(!1),[h,u]=U.useState(!1),[l,f]=U.useState(!1),[x,d]=U.useState(!1),[T,b]=U.useState(!1),[N,w]=U.useState(!1),[I,k]=U.useState(!1),[C,j]=U.useState(null),[O,F]=U.useState(null),[R,M]=U.useState({title:"",message:"",onConfirm:()=>{}}),[H,V]=U.useState(!1),[oe,J]=U.useState(new Set),[Z,de]=U.useState(null),[$,W]=U.useState("lastOpened"),[_,ie]=U.useState(null),[be,ge]=U.useState(new Set),je=ze=>ze?/^\d+(\.\d+)?$/.test(ze)?new Date(parseFloat(ze)*1e3):new Date(ze.replace(" ","T")):new Date(NaN),fe=U.useCallback(ze=>{ge(He=>{const Je=new Set(He);return Je.has(ze)?Je.delete(ze):Je.add(ze),Je})},[]),[B,S]=U.useState(!1),[A,ce]=U.useState(null),pe=U.useRef(0),[me,Te]=dp(),{addToast:he}=er(),Se=U.useRef(null),{path:Ee,navigate:Le}=Ln(),qe=U.useRef(!1),{aiFeaturesEnabled:te,backupEnabled:Y,backupApiKey:g}=on(),[ee,G]=U.useState(!1),[P,L]=U.useState("Never synced."),q=U.useRef(!1),{pullToRefreshState:X,handleTouchStart:se,handleTouchMove:Q,handleTouchEnd:ue,REFRESH_THRESHOLD:Ie}=gg(),ye=U.useCallback(ze=>{Se.current=document.activeElement,ze(!0)},[]),Ce=U.useCallback(ze=>{ze(!1),setTimeout(()=>{var He;(He=Se.current)==null||He.focus()},300)},[]),Be=U.useCallback(()=>ye(V),[ye]),$e=U.useCallback(()=>Ce(V),[Ce]),ct=U.useCallback(()=>ye(k),[ye]),et=U.useCallback(()=>Ce(k),[Ce]),pt=U.useCallback(()=>ye(v),[ye]),qt=U.useCallback(()=>Ce(v),[Ce]),ft=U.useCallback(()=>ye(u),[ye]),jt=U.useCallback(()=>Ce(u),[Ce]);U.useCallback(()=>ye(d),[ye]);const gr=U.useCallback(()=>Ce(d),[Ce]);U.useCallback(()=>ye(b),[ye]);const Ct=U.useCallback(()=>Ce(b),[Ce]),Mt=U.useCallback(()=>ye(w),[ye]),tt=U.useCallback(()=>Ce(w),[Ce]),Wt=U.useCallback(ze=>{M(ze),Mt()},[Mt]),ar=U.useCallback(ze=>{Se.current=document.activeElement,j(ze)},[]),ir=U.useCallback(ze=>{Se.current=document.activeElement,F(ze)},[]),ut=pg({sessionsToResume:oe,setSessionsToResume:J,setGeneralStudyDeck:de,openConfirmModal:Wt,setFolderToEdit:ar,setSeriesToEdit:ir}),{handleAddDecks:br,handleAddSeriesWithDecks:kr,handleRestoreData:ln,handleExecuteAIAction:Ue}=ut,Fn=(ze,He)=>{ce(null);try{switch(ze.type){case"backup":ln(ze.data);break;case"quiz_series":{const{seriesName:Je,seriesDescription:xt,levels:Vt}=ze.data,lr=[],Ft=Vt.map(Gt=>{const Yr=Gt.decks.map(zr=>({id:crypto.randomUUID(),name:zr.name,description:zr.description,type:Ae.Quiz,questions:wr(zr.questions)}));return lr.push(...Yr),{title:Gt.title,deckIds:Yr.map(zr=>zr.id)}}),Et={id:crypto.randomUUID(),type:"series",name:Je,description:xt,levels:Ft,archived:!1,createdAt:new Date().toISOString()};kr(Et,lr);break}case"quiz":{const Je=wr(ze.data.questions),xt={id:crypto.randomUUID(),name:He||ze.data.name,description:ze.data.description,type:Ae.Quiz,questions:Je};br([xt]),he(`Deck "${xt.name}" imported successfully.`,"success");break}case"flashcard":{if(!He){he("A deck name is required for flashcard imports.","error");return}const Je=Tc(ze.data),xt={id:crypto.randomUUID(),name:He,type:Ae.Flashcard,cards:Je,description:`${Je.length} imported flashcard${Je.length===1?"":"s"}.`};br([xt]),he(`Deck "${xt.name}" imported successfully.`,"success");break}}}catch(Je){const xt=Je instanceof Error?Je.message:"Failed to process the dropped file.";he(xt,"error")}},Lt=U.useCallback(async(ze=!1)=>{if(!Y||!g){ze&&he("Server sync is not enabled or API key is missing.","error");return}if(ee){ze&&he("A sync operation is already in progress.","info");return}G(!0),L("Syncing..."),ze&&he("Manual sync started...","info");try{const{timestamp:He,etag:Je}=await up();q.current=!1;const xt=new Date(He);localStorage.setItem("cogniflow-lastSyncTimestamp",xt.toISOString()),localStorage.setItem("cogniflow-lastSyncEtag",Je),L(`Last synced: ${xt.toLocaleTimeString()}`),he("Data successfully synced to server.","success")}catch(He){const Je=He instanceof Error?He.message:"Unknown error";console.error("Sync failed:",He),L(`Error: ${Je}`),he(`Server sync failed: ${Je}`,"error")}finally{G(!1)}},[Y,g,ee,he]),cn=U.useCallback(async()=>{if(!Y||!g){he("Server sync is not enabled or API key is missing.","error");return}if(ee){he("A sync operation is already in progress.","info");return}Wt({title:"Fetch from Server",message:"This will download the latest backup from the server and overwrite any unsynced local changes. Are you sure you want to continue?",confirmText:"Fetch",onConfirm:async()=>{G(!0),L("Fetching from server...");try{const{metadata:ze}=await Sc();if(!ze)throw new Error("Failed to retrieve backup metadata from server.");const He=await Jd(ze);await ut.handleRestoreData(He);const Je=je(ze.modified);if(isNaN(Je.getTime()))throw new Error("Received an invalid date from the server.");const xt=Je.toISOString();localStorage.setItem("cogniflow-lastSyncTimestamp",xt),localStorage.setItem("cogniflow-lastSyncEtag",ze.etag),L(`Synced from server: ${Je.toLocaleTimeString()}`),he("Successfully fetched and restored data from server.","success")}catch(ze){const He=ze instanceof Error?ze.message:"Unknown error";if(console.error("Fetch failed:",ze),He.includes("404")){const Je="No backup found on the server to fetch from.";L(Je),he(Je,"info")}else L(`Error: ${He}`),he(`Failed to fetch server data: ${He}`,"error")}finally{G(!1)}}})},[Y,g,ee,he,Wt,ut,je]);U.useEffect(()=>Ke.subscribe((ze,He)=>{ze.lastModified&&ze.lastModified!==He.lastModified&&(q.current=!0)}),[]),U.useEffect(()=>{if(!Y||!g)return;const ze=setInterval(()=>{q.current&&Lt(!1)},300*1e3);return()=>clearInterval(ze)},[Y,g,Lt]);const Ur=U.useCallback(async(ze=!1)=>{try{const[He,Je,xt,Vt]=await Promise.all([Nc(),jc(),Cc(),ze?Jm():Promise.resolve([])]);if(s({type:"LOAD_DATA",payload:{decks:He,folders:Je,deckSeries:xt}}),ze){const lr=new Set(Vt.map(Ft=>Ft.replace("session_deck_","")));J(lr)}}catch(He){console.error("Failed to load data:",He),he("Error loading data from the database.","error")}},[he,s]),bn=U.useCallback(async()=>{const ze=new Date(Date.now()-864e6),He=p.decks.filter(xt=>xt.deletedAt&&new Date(xt.deletedAt)<ze),Je=p.deckSeries.filter(xt=>xt.deletedAt&&new Date(xt.deletedAt)<ze);if(!(He.length===0&&Je.length===0)){for(const xt of He)await ut.handleDeleteDeckPermanently(xt.id);for(const xt of Je)await ut.handleDeleteSeriesPermanently(xt.id);he("Permanently deleted old items from trash.","info")}},[p.decks,p.deckSeries,ut,he]),or=U.useCallback(async()=>{try{const ze=localStorage.getItem("cogniflow-sortPreference");ze&&W(ze);const He=localStorage.getItem("cogniflow-openFolderIds");He&&ge(new Set(JSON.parse(He)));const Je=localStorage.getItem("cogniflow-lastSyncTimestamp");Je&&L(`Last synced: ${new Date(Je).toLocaleTimeString()}`)}catch(ze){console.error("Failed to load local settings",ze),he("Could not load some of your settings.","error")}},[he]);U.useEffect(()=>{(async()=>{await Ur(!0),await or()})()},[Ur,or]),U.useEffect(()=>{if(qe.current)return;const ze=async()=>{if(!(!Y||!g))try{L("Checking for updates...");const He=localStorage.getItem("cogniflow-lastSyncEtag"),{metadata:Je,isNotModified:xt}=await Sc(He||void 0);if(xt){const Vt=localStorage.getItem("cogniflow-lastSyncTimestamp");L(Vt?`Last synced: ${new Date(Vt).toLocaleTimeString()}`:"In sync with server.");return}if(Je){const Vt=je(Je.modified);if(isNaN(Vt.getTime()))throw new Error("Invalid date format from server.");const lr=Vt.getTime(),Ft=new Date(localStorage.getItem("cogniflow-lastSyncTimestamp")||0).getTime();if(lr>Ft+6e4)Wt({title:"Update Available",message:"Newer data found on the server. Download and merge now? This will overwrite any unsynced local changes.",onConfirm:async()=>{try{const Et=await Jd(Je);await ln(Et);const Gt=new Date(lr).toISOString();localStorage.setItem("cogniflow-lastSyncTimestamp",Gt),localStorage.setItem("cogniflow-lastSyncEtag",Je.etag),L(`Synced from server: ${new Date(lr).toLocaleTimeString()}`)}catch(Et){const Gt=Et instanceof Error?Et.message:"Unknown error";he(`Failed to download server data: ${Gt}`,"error")}}});else{const Et=localStorage.getItem("cogniflow-lastSyncTimestamp");L(Et?`Last synced: ${new Date(Et).toLocaleTimeString()}`:"Never synced.")}}}catch(He){const Je=He instanceof Error?He.message:"";Je.includes("404")?(L("No backup found on server."),p.decks.length>0&&(q.current=!0)):L(`Error: ${Je}`)}};!p.isLoading&&!qe.current&&(bn(),ut.reconcileSeriesProgress(),ze(),qe.current=!0)},[p.isLoading,Y,g,Wt,ln,he,p.decks.length,bn,ut,je]);const{activeDeck:hs,activeSeries:Bt}=U.useMemo(()=>{const[ze]=Ee.split("?");if(ze.startsWith("/decks/")){const He=ze.split("/")[2];return{activeDeck:p.decks.find(Je=>Je.id===He)||null,activeSeries:null}}if(ze.startsWith("/series/")){const He=ze.split("/")[2];return{activeDeck:null,activeSeries:p.deckSeries.find(Je=>Je.id===He)||null}}return{activeDeck:null,activeSeries:null}},[Ee,p.decks,p.deckSeries]),kn=ze=>{ze.preventDefault(),ze.stopPropagation(),pe.current++,ze.dataTransfer.items&&ze.dataTransfer.items.length>0&&S(!0)},Dr=ze=>{ze.preventDefault(),ze.stopPropagation(),pe.current--,pe.current===0&&S(!1)},Pn=ze=>{ze.preventDefault(),ze.stopPropagation()},Hs=ze=>{ze.preventDefault(),ze.stopPropagation(),S(!1),pe.current=0;const He=ze.dataTransfer.files[0];if(!He)return;const Je=new FileReader;Je.onload=async xt=>{var lr;const Vt=(lr=xt.target)==null?void 0:lr.result;if(He.name.toLowerCase().endsWith(".apkg"))try{const Ft=await He.arrayBuffer(),Et=Ft.slice(0);let Gt=[];try{Gt=await ph(Ft)}catch(Yr){console.warn("Anki worker failed, trying main thread fallback:",Yr),he("Import via worker failed. Trying a slower fallback method... this may freeze the app.","info");try{Gt=await gh(Et)}catch(zr){throw zr}}Gt.length>0?(br(Gt),he(`Successfully imported ${Gt.length} deck(s) from ${He.name}.`,"success")):he("No valid decks found in the Anki package.","info")}catch(Ft){he(`An error occurred processing the Anki package: ${Ft instanceof Error?Ft.message:"Unknown error"}`,"error")}else{const Ft=op(Vt);Ft?ce({...Ft,fileName:He.name}):he("Unsupported or invalid file format.","error")}},Je.readAsText(He)};return r.jsxs("div",{className:"min-h-screen text-text flex flex-col overflow-x-hidden",onDragEnter:kn,onDragLeave:Dr,onDragOver:Pn,onDrop:Hs,onTouchStart:se,onTouchMove:Q,onTouchEnd:ue,children:[r.jsx(Fp,{pullDistance:X.pullDistance,isRefreshing:X.isRefreshing,threshold:Ie}),r.jsx(vp,{isOpen:H,onClose:$e,onImport:pt,onCreateSeries:()=>ir("new"),onGenerateAI:ft,onInstall:me?Te:null}),r.jsxs("div",{className:"flex-1 flex flex-col",children:[r.jsx(xg,{onOpenMenu:Be,onOpenCommandPalette:ct,activeDeck:hs}),r.jsx("main",{className:"flex-1 container mx-auto p-4 sm:p-6 lg:p-8",children:p.isLoading?r.jsx("div",{className:"text-center p-8",children:r.jsx(sr,{})}):r.jsx(ix,{sessionsToResume:oe,sortPreference:$,setSortPreference:W,draggedDeckId:_,setDraggedDeckId:ie,openFolderIds:be,onToggleFolder:fe,generalStudyDeck:Z,activeDeck:hs,activeSeries:Bt,setImportModalOpen:v,setRestoreModalOpen:d,setResetProgressModalOpen:b,openFolderModal:ar,openConfirmModal:Wt,openCreateSeriesModal:()=>ir("new"),openAIGenerationModal:ft,onTriggerSync:()=>Lt(!0),onFetchFromServer:cn,isSyncing:ee,lastSyncStatus:P,onGenerateQuestionsForDeck:ut.handleGenerateQuestionsForDeck,onGenerateContentForLearningDeck:ut.handleGenerateContentForLearningDeck,onGenerateQuestionsForEmptyDecksInSeries:ut.handleGenerateQuestionsForEmptyDecksInSeries,onCancelAIGeneration:ut.handleCancelAIGeneration,onSaveLearningBlock:ut.handleSaveLearningBlock,onDeleteLearningBlock:ut.handleDeleteLearningBlock,...ut})})]}),r.jsx(hp,{}),o&&r.jsx(Ap,{isOpen:o,onClose:qt,onAddDecks:br,onAddSeriesWithDecks:kr}),h&&r.jsx(cx,{isOpen:h,onClose:jt,onGenerate:ut.handleGenerateWithAI}),x&&r.jsx(Op,{isOpen:x,onClose:gr,onRestore:ln}),T&&r.jsx(Rp,{isOpen:T,onClose:Ct,onReset:ut.handleResetDeckProgress,decks:p.decks}),N&&r.jsx(wo,{isOpen:N,onClose:tt,...R}),C&&r.jsx(Mp,{folder:C==="new"?null:C,onClose:()=>{var ze;j(null),(ze=Se.current)==null||ze.focus()},onSave:ut.handleSaveFolder}),O&&r.jsx(Lp,{series:O==="new"?null:O,onClose:()=>{var ze;F(null),(ze=Se.current)==null||ze.focus()},onSave:ut.handleSaveSeries}),r.jsx(ox,{isOpen:I,onClose:et,actions:[{id:"import",label:"Create / Import Deck",icon:"plus",action:pt,keywords:["new","add"]},{id:"settings",label:"Settings",icon:"settings",action:()=>{Le("/settings")}},{id:"trash",label:"View Trash",icon:"trash-2",action:()=>{Le("/trash")}},{id:"archive",label:"View Archive",icon:"archive",action:()=>{Le("/archive")}},{id:"progress",label:"View Progress",icon:"trending-up",action:()=>{Le("/progress")}}]}),B&&r.jsx("div",{className:"fixed inset-0 bg-black/50 z-50 flex items-center justify-center p-4",children:r.jsxs("div",{className:"bg-surface rounded-lg p-8 text-center border-4 border-dashed border-primary",children:[r.jsx(ae,{name:"upload-cloud",className:"w-16 h-16 text-primary mx-auto mb-4"}),r.jsx("p",{className:"text-xl font-semibold",children:"Drop file to import"})]})}),A&&r.jsx(lx,{isOpen:!!A,onClose:()=>ce(null),onConfirm:Fn,analysis:A}),te&&r.jsxs(r.Fragment,{children:[r.jsx(ux,{}),r.jsx(mx,{onExecuteAction:Ue}),r.jsx(px,{onOpen:()=>f(!0),onCancel:ut.handleCancelAIGeneration}),r.jsx(gx,{isOpen:l,onClose:()=>f(!1),onCancel:ut.handleCancelAIGeneration})]})]})};class yx extends U.Component{constructor(){super(...arguments),this.state={hasError:!1},this.handleReload=()=>{window.location.reload()}}static getDerivedStateFromError(p){return{hasError:!0,error:p}}componentDidCatch(p,o){console.error("Uncaught error:",p,o)}render(){return this.state.hasError?r.jsx("div",{className:"min-h-screen flex items-center justify-center p-4",children:r.jsxs("div",{className:"text-center bg-surface p-8 rounded-lg shadow-xl max-w-md w-full",children:[r.jsx("h1",{className:"text-3xl font-bold text-red-600 dark:text-red-500 mb-4",children:"Oops! Something went wrong."}),r.jsx("p",{className:"text-text-muted mb-6",children:"The application encountered an unexpected error. Please try reloading the page to continue."}),this.state.error&&r.jsx("pre",{className:"bg-background text-left text-xs text-red-500 dark:text-red-400 p-4 rounded-md overflow-x-auto mb-6",children:r.jsx("code",{children:this.state.error.toString()})}),r.jsx(ve,{variant:"danger",onClick:this.handleReload,children:"Reload Page"})]})}):this.props.children}}console.log(window.location);const kh=document.getElementById("root");if(!kh)throw new Error("Could not find root element to mount to");const vx=Lm.createRoot(kh);vx.render(r.jsx(ni.StrictMode,{children:r.jsx(Sg,{children:r.jsx(kp,{children:r.jsx(yp,{children:r.jsx(gp,{children:r.jsx(yx,{children:r.jsx(xx,{})})})})})})}));
