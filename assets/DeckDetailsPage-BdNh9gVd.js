import{j as e,B as w,I as a,r as n,a as be,c as me,i as xe,u as ue,S as ie,e as $,d as ye,g as ke,C as Ue,s as pe,L as oe,x as at,y as Se,D as Be,z as W,E as lt,F as ot,G as it,H as dt,J as ct,R as mt,K as xt,M as ut,N as ht}from"./index-D_FLfjBw.js";import{M as Ie}from"./MasteryBar-OxNLaxF2.js";import{T as ft}from"./TruncatedText-D8yP2_dh.js";const ge=({targetId:t,value:l,onChange:u,className:g=""})=>{const r=(i,d)=>{var p;const x=document.getElementById(t);if(!x)return;const h=x.selectionStart,f=x.selectionEnd,N=l.substring(h,f),D=l.substring(0,h),b=l.substring(f);let S="",E=0;if(S=`${D}<${i}>${b}`,E=h+i.length+2,i==="b"||i==="i"||i==="u"||i==="code")S=`${D}<${i}>${N}</${i}>${b}`,N.length===0?E=h+i.length+2:E=h+i.length+2+N.length+i.length+3;else if(i==="br")S=`${D}<br>
${b}`,E=h+5;else if(i==="ul"){const j=N.split(`
`).map(o=>`  <li>${o}</li>`).join(`
`),m=j||"  <li></li>";S=`${D}<ul>
${m}
</ul>${b}`,E=j?h+m.length+11:h+9}const k=(p=Object.getOwnPropertyDescriptor(window.HTMLTextAreaElement.prototype,"value"))==null?void 0:p.set;k&&k.call(x,S);const I=new Event("input",{bubbles:!0});x.dispatchEvent(I),u(S),setTimeout(()=>{x.focus(),x.setSelectionRange(E,E)},0)};return e.jsxs("div",{className:`flex flex-wrap items-center gap-1 p-1 bg-surface border-b border-border rounded-t-md ${g}`,children:[e.jsx(w,{type:"button",variant:"ghost",size:"sm",onClick:()=>r("b"),title:"Bold",className:"px-2 h-8 min-w-[2rem] font-bold",children:"B"}),e.jsx(w,{type:"button",variant:"ghost",size:"sm",onClick:()=>r("i"),title:"Italic",className:"px-2 h-8 min-w-[2rem] italic",children:"I"}),e.jsx(w,{type:"button",variant:"ghost",size:"sm",onClick:()=>r("u"),title:"Underline",className:"px-2 h-8 min-w-[2rem] underline",children:"U"}),e.jsx("div",{className:"w-px h-4 bg-border mx-1"}),e.jsx(w,{type:"button",variant:"ghost",size:"sm",onClick:()=>r("code"),title:"Code",className:"px-2 h-8 min-w-[2rem] font-mono text-xs",children:"</>"}),e.jsx(w,{type:"button",variant:"ghost",size:"sm",onClick:()=>r("br"),title:"Line Break",className:"px-2 h-8 min-w-[2rem] text-xs",children:"BR"}),e.jsx("div",{className:"w-px h-4 bg-border mx-1"}),e.jsx(w,{type:"button",variant:"ghost",size:"sm",onClick:()=>r("ul"),title:"List",className:"px-2 h-8 min-w-[2rem]",children:e.jsx(a,{name:"list",className:"w-4 h-4"})})]})},pt=({card:t,onClose:l,onSave:u,deckName:g})=>{const[r,i]=n.useState(""),[d,x]=n.useState(""),[h,f]=n.useState(""),[N,D]=n.useState(!1),{addToast:b}=be(),S=n.useRef(null);me(S,!0);const E=xe(),{aiFeaturesEnabled:k}=ue();n.useEffect(()=>{t&&(i(t.front),x(t.back),f(t.css||""))},[t]);const I=m=>{if(m.preventDefault(),!r.trim()||!d.trim()){b("Both front and back fields are required.","error");return}u({id:(t==null?void 0:t.id)||"",front:r.trim(),back:d.trim(),css:h.trim()})},p=m=>{if(m.key==="Tab"){m.preventDefault();const o=m.target,L=o.selectionStart,z=o.selectionEnd;o.value=o.value.substring(0,L)+"	"+o.value.substring(z),o.selectionStart=o.selectionEnd=L+1;const C=o.id;C==="card-front"&&i(o.value),C==="card-back"&&x(o.value),C==="card-css"&&f(o.value)}},j=async()=>{if(!r.trim()||!d.trim()){b("Please fill in both front and back fields first.","error");return}D(!0);try{const m=await E.handleGenerateCardExamples(r,d,g);m&&(x(o=>`${o}<br><br><strong>Examples:</strong><br>${m}`),b("Examples added to the back of the card.","success"))}catch{}finally{D(!1)}};return e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-75 flex items-center justify-center z-[60] p-4",children:e.jsx("div",{ref:S,className:"bg-surface rounded-lg shadow-xl w-full max-w-2xl transform transition-all relative",children:e.jsxs("form",{onSubmit:I,children:[e.jsxs("div",{className:"flex justify-between items-center p-4 border-b border-border",children:[e.jsx("h2",{className:"text-xl font-bold",children:t?"Edit Card":"Add New Card"}),e.jsx(w,{type:"button",variant:"ghost",onClick:l,className:"p-1 h-auto",children:e.jsx(a,{name:"x"})})]}),e.jsxs("div",{className:"p-6 space-y-4 max-h-[70vh] overflow-y-auto",children:[e.jsxs("div",{children:[e.jsx("label",{htmlFor:"card-front",className:"block text-sm font-medium text-text-muted mb-1",children:"Front (Supports HTML)"}),e.jsxs("div",{className:"border border-border rounded-md focus-within:ring-2 focus-within:ring-primary overflow-hidden",children:[e.jsx(ge,{targetId:"card-front",value:r,onChange:i}),e.jsx("textarea",{id:"card-front",value:r,onChange:m=>i(m.target.value),onKeyDown:p,rows:5,className:"w-full p-2 bg-background focus:outline-none font-mono text-sm block"})]})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex justify-between items-end mb-1",children:[e.jsx("label",{htmlFor:"card-back",className:"block text-sm font-medium text-text-muted",children:"Back (Supports HTML)"}),k&&e.jsxs(w,{type:"button",variant:"ghost",size:"sm",onClick:j,disabled:N,className:"text-primary hover:text-primary-hover",title:"Use AI to generate real-world examples",children:[N?e.jsx(ie,{size:"sm"}):e.jsx(a,{name:"zap",className:"w-3 h-3 mr-1"}),N?"Generating...":"Generate Examples"]})]}),e.jsxs("div",{className:"border border-border rounded-md focus-within:ring-2 focus-within:ring-primary overflow-hidden",children:[e.jsx(ge,{targetId:"card-back",value:d,onChange:x}),e.jsx("textarea",{id:"card-back",value:d,onChange:m=>x(m.target.value),onKeyDown:p,rows:5,className:"w-full p-2 bg-background focus:outline-none font-mono text-sm block"})]})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"card-css",className:"block text-sm font-medium text-text-muted mb-1",children:"Custom CSS (Optional)"}),e.jsx("textarea",{id:"card-css",value:h,onChange:m=>f(m.target.value),onKeyDown:p,rows:5,className:"w-full p-2 bg-background border border-border rounded-md focus:ring-2 focus:ring-primary focus:outline-none font-mono text-sm",placeholder:".card { font-family: 'Arial'; }"})]})]}),e.jsxs("div",{className:"flex justify-end p-4 bg-background/50 border-t border-border",children:[e.jsx(w,{type:"button",variant:"secondary",onClick:l,className:"mr-2",children:"Cancel"}),e.jsx(w,{type:"submit",variant:"primary",children:t?"Save Changes":"Add Card"})]})]})})})},Ae=({deck:t,onGenerateMore:l,onRework:u,onAnalyze:g,onAutoTag:r,onHardenDistractors:i,onGenerateAudio:d,isGenerating:x})=>{const[h,f]=n.useState(!1),N=n.useRef(null);n.useEffect(()=>{const b=S=>{N.current&&!N.current.contains(S.target)&&f(!1)};return h&&document.addEventListener("mousedown",b),()=>document.removeEventListener("mousedown",b)},[h]);const D=b=>{b(),f(!1)};return e.jsxs("div",{className:"relative inline-block",ref:N,children:[e.jsxs(w,{variant:"primary",onClick:()=>f(!h),disabled:x,className:"bg-gradient-to-r from-blue-600 to-indigo-600 border-none shadow-md hover:shadow-lg transition-all",children:[x?e.jsx(ie,{size:"sm"}):e.jsx(a,{name:"bot",className:"w-5 h-5 mr-2"}),x?"AI Processing...":"âœ¨ AI Actions",e.jsx(a,{name:"chevron-down",className:`ml-2 w-4 h-4 transition-transform duration-200 ${h?"rotate-180":""}`})]}),h&&e.jsxs("div",{className:"absolute bottom-full left-0 mb-2 w-64 bg-surface rounded-xl shadow-2xl border border-border z-50 py-2 animate-fade-in origin-bottom-left overflow-hidden",children:[e.jsx("div",{className:"px-4 py-2 border-b border-border mb-1",children:e.jsx("span",{className:"text-[10px] font-bold text-text-muted uppercase tracking-widest",children:"AI Tools"})}),e.jsxs("button",{onClick:()=>D(l),className:"flex items-center w-full px-4 py-2.5 text-sm text-left text-text hover:bg-primary/10 transition-colors group",children:[e.jsx(a,{name:"zap",className:"w-4 h-4 mr-3 text-primary group-hover:scale-110 transition-transform"}),"Expand Deck with AI"]}),e.jsxs("button",{onClick:()=>D(u),className:"flex items-center w-full px-4 py-2.5 text-sm text-left text-text hover:bg-primary/10 transition-colors group",children:[e.jsx(a,{name:"refresh-ccw",className:"w-4 h-4 mr-3 text-blue-500 group-hover:scale-110 transition-transform"}),"Rework Deck with AI"]}),e.jsxs("button",{onClick:()=>D(g),className:"flex items-center w-full px-4 py-2.5 text-sm text-left text-text hover:bg-primary/10 transition-colors group",children:[e.jsx(a,{name:"save",className:"w-4 h-4 mr-3 text-yellow-500 group-hover:scale-110 transition-transform"}),"Analyze & Improve Deck"]}),(t.type===$.Quiz||t.type===$.Learning)&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"my-1 border-t border-border"}),r&&e.jsxs("button",{onClick:()=>D(r),className:"flex items-center w-full px-4 py-2.5 text-sm text-left text-text hover:bg-primary/10 transition-colors group",children:[e.jsx(a,{name:"filter",className:"w-4 h-4 mr-3 text-indigo-500 group-hover:scale-110 transition-transform"}),"Smart-Tag All Questions"]}),i&&e.jsxs("button",{onClick:()=>D(i),className:"flex items-center w-full px-4 py-2.5 text-sm text-left text-text hover:bg-primary/10 transition-colors group",children:[e.jsx(a,{name:"trending-up",className:"w-4 h-4 mr-3 text-red-500 group-hover:scale-110 transition-transform"}),"Harden All Distractors"]})]}),t.type===$.Flashcard&&d&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"my-1 border-t border-border"}),e.jsxs("button",{onClick:()=>D(d),className:"flex items-center w-full px-4 py-2.5 text-sm text-left text-text hover:bg-primary/10 transition-colors group",children:[e.jsx(a,{name:"mic",className:"w-4 h-4 mr-3 text-green-500 group-hover:scale-110 transition-transform"}),"Generate Audio for All"]})]})]})]})},Qe=50,gt=t=>{const l=new Date;l.setHours(0,0,0,0);const u=new Date(t);u.setHours(0,0,0,0);const g=u.getTime()-l.getTime(),r=Math.round(g/(1e3*60*60*24)),i=r<=0;let d;return r<0?d="Due":r===0?d="Due today":r===1?d="Due tomorrow":d=`Due in ${r} days`,{text:d,isDue:i}},bt=({cards:t,onCardsChange:l,onAddCard:u,onBulkAdd:g,deckName:r,deck:i})=>{const[d,x]=n.useState(null),[h,f]=n.useState(!1),[N,D]=n.useState(null),[b,S]=n.useState(!0),[E,k]=n.useState(Qe),[I,p]=n.useState(null),j=n.useRef(null),{aiFeaturesEnabled:m}=ue(),o=xe(),z=!!ye(n.useCallback(s=>{const{currentTask:y,queue:O}=s.aiGenerationStatus;return(y==null?void 0:y.deckId)===i.id?y:(O||[]).find(P=>P.deckId===i.id)},[i.id])),C=n.useMemo(()=>t.slice(0,E),[t,E]),T=()=>{k(s=>Math.min(s+Qe,t.length))},M=(s,y)=>{x(s),y&&(j.current=y.currentTarget),f(!0)},R=()=>{var s;f(!1),(s=j.current)==null||s.focus(),x(null)},B=(s,y)=>{D(s),y&&(j.current=y.currentTarget)},V=()=>{N&&l(t.filter(s=>s.id!==N.id)),D(null)},te=s=>{d?l(t.map(y=>y.id===s.id?{...y,...s}:y)):u(s),R()},_=s=>{l(t.map(y=>y.id===s?{...y,suspended:!1}:y))},Y=(s,y)=>{p(s),y.dataTransfer.effectAllowed="move"},se=(s,y)=>{y.preventDefault(),y.dataTransfer.dropEffect="move"},H=(s,y)=>{if(y.preventDefault(),I===null||I===s)return;const O=[...t],[P]=O.splice(I,1);O.splice(s,0,P),l(O),p(null)};return e.jsxs("div",{children:[e.jsx("div",{className:"border-b border-border",children:e.jsxs("button",{onClick:()=>S(!b),className:"w-full flex justify-between items-center text-left p-6","aria-expanded":b,"aria-controls":"card-list-content",children:[e.jsxs("h3",{className:"text-xl font-semibold text-text",children:["Cards (",t.length,")"]}),e.jsx(a,{name:"chevron-down",className:`w-6 h-6 transition-transform duration-300 ${b?"":"-rotate-90"} text-text-muted`})]})}),b&&e.jsxs("div",{id:"card-list-content",className:"animate-fade-in",children:[e.jsx("div",{className:"p-6",children:t.length>0?e.jsxs(e.Fragment,{children:[e.jsx("ul",{className:"space-y-4",children:C.map((s,y)=>{const{text:O,isDue:P}=gt(s.dueDate),ae=I===y;return e.jsxs("li",{className:`p-4 rounded-lg flex items-start justify-between transition-all border border-transparent ${s.suspended?"bg-yellow-500/10 opacity-70":"bg-background"} ${ae?"opacity-50 ring-2 ring-primary":"hover:border-border"}`,draggable:!0,onDragStart:Q=>Y(y,Q),onDragOver:Q=>se(y,Q),onDrop:Q=>H(y,Q),children:[e.jsx("div",{className:"mr-3 mt-1 cursor-grab active:cursor-grabbing text-text-muted hover:text-text",children:e.jsx(a,{name:"grip-vertical",className:"w-5 h-5"})}),e.jsxs("div",{className:"flex-1 min-w-0 mr-4",children:[e.jsxs("p",{className:"text-sm font-medium text-text truncate",children:[e.jsx("strong",{children:"Front:"})," ",s.front.replace(/<[^>]+>/g,"")]}),e.jsxs("p",{className:"text-sm text-text-muted truncate",children:[e.jsx("strong",{children:"Back:"})," ",s.back.replace(/<[^>]+>/g,"")]}),e.jsxs("div",{className:"mt-3 space-y-2",children:[e.jsx(Ie,{level:ke(s)}),e.jsx("div",{className:"flex items-center gap-4 text-xs text-text-muted",children:e.jsxs("span",{className:`font-semibold ${P?"text-primary":""}`,children:[e.jsx(a,{name:"zap",className:"w-3 h-3 inline-block mr-1"}),O]})})]})]}),e.jsxs("div",{className:"flex-shrink-0 flex items-center gap-2",children:[s.suspended?e.jsx(w,{variant:"ghost",className:"p-2 h-auto text-yellow-600 dark:text-yellow-400",onClick:()=>_(s.id),title:"Unsuspend this card",children:e.jsx(a,{name:"eye",className:"w-4 h-4"})}):e.jsx(w,{variant:"ghost",className:"p-2 h-auto",onClick:Q=>M(s,Q),title:"Edit this card",children:e.jsx(a,{name:"edit",className:"w-4 h-4"})}),e.jsx(w,{variant:"ghost",className:"p-2 h-auto text-text-muted hover:text-red-500",onClick:Q=>B(s,Q),title:"Delete this card",children:e.jsx(a,{name:"trash-2",className:"w-4 h-4"})})]})]},s.id)})}),E<t.length&&e.jsx("div",{className:"mt-4 text-center",children:e.jsxs(w,{variant:"secondary",onClick:T,children:["Show More (",t.length-E," remaining)"]})})]}):e.jsxs("div",{className:"flex flex-col items-center justify-center p-8 border-2 border-dashed border-border rounded-lg bg-background/50",children:[e.jsx(a,{name:"laptop",className:"w-12 h-12 text-text-muted mb-3"}),e.jsx("p",{className:"text-text font-medium mb-1",children:"No cards yet"}),e.jsx("p",{className:"text-sm text-text-muted text-center max-w-xs",children:"Start building your deck by adding your first flashcard."}),e.jsx("div",{className:"mt-4",children:e.jsxs(w,{variant:"primary",onClick:s=>M(null,s),children:[e.jsx(a,{name:"plus",className:"w-4 h-4 mr-2"}),"Create First Card"]})})]})}),e.jsxs("div",{className:"px-6 py-4 border-t border-border flex flex-wrap gap-2 items-center",children:[e.jsxs(w,{variant:"secondary",onClick:s=>M(null,s),className:"flex-grow sm:flex-grow-0",children:[e.jsx(a,{name:"plus",className:"w-5 h-5 mr-2"}),"Add New Card"]}),e.jsxs(w,{variant:"ghost",onClick:g,className:"flex-grow sm:flex-grow-0",children:[e.jsx(a,{name:"code",className:"w-5 h-5 mr-2"}),"Bulk Add via JSON"]}),e.jsx("div",{className:"flex-grow"}),m&&e.jsx(Ae,{deck:i,isGenerating:z,onGenerateMore:()=>o==null?void 0:o.handleOpenAIGenerationForDeck(i),onRework:()=>o==null?void 0:o.handleOpenAIReworkForDeck(i),onAnalyze:()=>o==null?void 0:o.handleOpenDeckAnalysis(i),onGenerateAudio:()=>o==null?void 0:o.handleGenerateAudioForAllCards(i)})]})]}),h&&e.jsx(pt,{card:d,onClose:R,onSave:te,deckName:r}),N&&e.jsx(Ue,{isOpen:!!N,onClose:()=>D(null),onConfirm:V,title:"Delete Card",message:"Are you sure you want to delete this card? This action cannot be undone."})]})},jt=({question:t,onClose:l,onSave:u,deckName:g})=>{const[r,i]=n.useState(""),[d,x]=n.useState(""),[h,f]=n.useState([]),[N,D]=n.useState(""),[b,S]=n.useState([]),[E,k]=n.useState(""),[I,p]=n.useState(new Set),[j,m]=n.useState(!1),{addToast:o}=be(),L=n.useRef(null);me(L,!0);const z=xe(),{aiFeaturesEnabled:C}=ue();n.useEffect(()=>{if(t)i(t.questionText),x(t.detailedExplanation),f((t.options||[]).map(s=>({...s}))),D(t.correctAnswerId),S(t.tags||[]);else{const s=[{id:crypto.randomUUID(),text:""},{id:crypto.randomUUID(),text:""}];f(s),S([])}},[t]);const T=(s,y,O)=>{f(h.map(P=>P.id===s?{...P,[y]:O}:P))},M=s=>{p(y=>{const O=new Set(y);return O.has(s)?O.delete(s):O.add(s),O})},R=()=>{f([...h,{id:crypto.randomUUID(),text:""}])},B=s=>{if(h.length<=2){o("A question must have at least two options.","error");return}f(h.filter(y=>y.id!==s)),N===s&&D("")},V=s=>{k(s.target.value)},te=s=>{if(s.key===","||s.key==="Enter"){s.preventDefault();const y=E.trim();y&&!b.includes(y)&&S([...b,y]),k("")}else s.key==="Backspace"&&!E&&b.length>0&&S(b.slice(0,-1))},_=s=>{S(b.filter(y=>y!==s))},Y=(s,y)=>{if(s.key==="Tab"){s.preventDefault();const O=s.target,P=O.selectionStart,ae=O.selectionEnd,Q=O.value.substring(0,P)+"	"+O.value.substring(ae);O.value=Q,y(Q),O.selectionStart=O.selectionEnd=P+1}},se=async()=>{if(!r.trim()||!N){o("Please enter a question and select a correct answer first.","error");return}const s=h.find(y=>y.id===N);if(!s||!s.text.trim()){o("The correct answer text must be set.","error");return}m(!0);try{const y={id:"temp",questionText:r,options:h,correctAnswerId:N,detailedExplanation:d,questionType:"multipleChoice",dueDate:"",interval:0,easeFactor:0,lapses:0},O=await z.handleHardenDistractors(y,g);O&&(f(O),o("Distractors updated!","success"))}catch{}finally{m(!1)}},H=s=>{if(s.preventDefault(),!r.trim()){o("Question text is required.","error");return}if(h.some(y=>!y.text.trim())){o("All options must have text.","error");return}if(!N){o("You must select a correct answer.","error");return}u({id:t==null?void 0:t.id,questionText:r.trim(),detailedExplanation:d.trim(),options:h,correctAnswerId:N,tags:b})};return e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-75 flex items-center justify-center z-[60] p-4",children:e.jsx("div",{ref:L,className:"bg-surface rounded-lg shadow-xl w-full max-w-3xl transform transition-all relative max-h-[90vh] flex flex-col",children:e.jsxs("form",{onSubmit:H,className:"flex flex-col h-full",children:[e.jsxs("div",{className:"flex-shrink-0 flex justify-between items-center p-4 border-b border-border",children:[e.jsx("h2",{className:"text-xl font-bold",children:t?"Edit Question":"Add New Question"}),e.jsx(w,{type:"button",variant:"ghost",onClick:l,className:"p-1 h-auto",children:e.jsx(a,{name:"x"})})]}),e.jsxs("div",{className:"p-6 space-y-4 overflow-y-auto",children:[e.jsxs("div",{children:[e.jsx("label",{htmlFor:"question-text",className:"block text-sm font-medium text-text-muted mb-1",children:"Question Text (Supports HTML)"}),e.jsxs("div",{className:"border border-border rounded-md focus-within:ring-2 focus-within:ring-primary overflow-hidden",children:[e.jsx(ge,{targetId:"question-text",value:r,onChange:i}),e.jsx("textarea",{id:"question-text",value:r,onChange:s=>i(s.target.value),onKeyDown:s=>Y(s,i),rows:4,className:"w-full p-2 bg-background focus:outline-none font-mono text-sm block",placeholder:"What is the capital of France?"})]})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex justify-between items-end mb-1",children:[e.jsx("label",{className:"block text-sm font-medium text-text-muted",children:"Options"}),C&&e.jsxs(w,{type:"button",variant:"ghost",size:"sm",onClick:se,disabled:j,className:"text-primary hover:text-primary-hover",title:"Use AI to generate more challenging incorrect answers",children:[j?e.jsx(ie,{size:"sm"}):e.jsx(a,{name:"zap",className:"w-3 h-3 mr-1"}),j?"Hardening...":"Harden Distractors"]})]}),e.jsx("div",{className:"space-y-2",children:h.map((s,y)=>e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"radio",name:"correct-answer",checked:N===s.id,onChange:()=>D(s.id),className:"h-5 w-5 text-primary bg-border/50 border-border focus:ring-primary","aria-label":`Set option ${y+1} as correct`}),e.jsx("input",{type:"text",value:s.text,onChange:O=>T(s.id,"text",O.target.value),className:"flex-grow p-2 bg-background border border-border rounded-md focus:ring-2 focus:ring-primary focus:outline-none",placeholder:`Option ${y+1}`}),e.jsx(w,{type:"button",variant:"ghost",onClick:()=>M(s.id),className:`p-2 h-auto ${I.has(s.id)?"bg-primary/10 text-primary":"text-text-muted"}`,title:"Add/Edit option explanation",children:e.jsx(a,{name:"info",className:"w-4 h-4"})}),e.jsx(w,{type:"button",variant:"ghost",onClick:()=>B(s.id),className:"p-2 h-auto text-text-muted hover:text-red-500",children:e.jsx(a,{name:"x",className:"w-4 h-4"})})]}),I.has(s.id)&&e.jsx("div",{className:"pl-7 mt-1 animate-fade-in",children:e.jsx("input",{type:"text",value:s.explanation||"",onChange:O=>T(s.id,"explanation",O.target.value),className:"w-full p-1 bg-background border border-border rounded-md focus:ring-2 focus:ring-primary focus:outline-none text-sm",placeholder:"Brief explanation for this option..."})})]},s.id))}),e.jsxs(w,{type:"button",variant:"ghost",onClick:R,size:"sm",className:"mt-2",children:[e.jsx(a,{name:"plus",className:"w-4 h-4 mr-2"}),"Add Option"]})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"detailed-explanation",className:"block text-sm font-medium text-text-muted mb-1",children:"Detailed Explanation (Supports HTML)"}),e.jsxs("div",{className:"border border-border rounded-md focus-within:ring-2 focus-within:ring-primary overflow-hidden",children:[e.jsx(ge,{targetId:"detailed-explanation",value:d,onChange:x}),e.jsx("textarea",{id:"detailed-explanation",value:d,onChange:s=>x(s.target.value),onKeyDown:s=>Y(s,x),rows:4,className:"w-full p-2 bg-background focus:outline-none font-mono text-sm block",placeholder:"Explain why the correct answer is right..."})]})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"tags-input",className:"block text-sm font-medium text-text-muted mb-1",children:"Tags"}),e.jsxs("div",{className:"flex flex-wrap items-center gap-2 p-2 bg-background border border-border rounded-md",children:[b.map((s,y)=>e.jsxs("span",{className:"flex items-center gap-1 bg-primary/10 text-primary text-sm px-2 py-1 rounded-md",children:[s,e.jsx("button",{type:"button",onClick:()=>_(s),className:"text-primary hover:text-primary-hover",children:e.jsx(a,{name:"x",className:"w-3 h-3"})})]},y)),e.jsx("input",{id:"tags-input",type:"text",value:E,onChange:V,onKeyDown:te,className:"flex-grow bg-transparent focus:outline-none",placeholder:b.length===0?"Add tags (comma or enter)...":""})]})]})]}),e.jsxs("div",{className:"flex-shrink-0 flex justify-end p-4 bg-background/50 border-t border-border",children:[e.jsx(w,{type:"button",variant:"secondary",onClick:l,className:"mr-2",children:"Cancel"}),e.jsx(w,{type:"submit",variant:"primary",children:t?"Save Changes":"Add Question"})]})]})})})},vt=t=>{const l=new Date;l.setHours(0,0,0,0);const u=new Date(t);u.setHours(0,0,0,0);const g=u.getTime()-l.getTime(),r=Math.round(g/(1e3*60*60*24)),i=r<=0;let d;return r<0?d="Due":r===0?d="Due today":r===1?d="Due tomorrow":d=`Due in ${r} days`,{text:d,isDue:i}},yt=({deck:t,questions:l,onQuestionsChange:u,onAddQuestion:g,onBulkAdd:r,onGenerateAI:i,isGeneratingAI:d,onRegenerateQuestion:x,onAutoTag:h,deckName:f})=>{const[N,D]=n.useState(null),[b,S]=n.useState(!1),[E,k]=n.useState(null),[I,p]=n.useState(!0),[j,m]=n.useState(null),[o,L]=n.useState(null),[z,C]=n.useState(null),T=n.useRef(null),M=n.useRef(null),{aiFeaturesEnabled:R}=ue(),B=xe(),te=!!ye(n.useCallback(v=>{const{currentTask:A,queue:q}=v.aiGenerationStatus;return(A==null?void 0:A.deckId)===t.id?A:(q||[]).find(ee=>ee.deckId===t.id)},[t.id]));n.useEffect(()=>{const v=A=>{M.current&&!M.current.contains(A.target)&&m(null)};return j&&document.addEventListener("mousedown",v),()=>{document.removeEventListener("mousedown",v)}},[j]);const _=(v,A)=>{D(v),A&&(T.current=A.currentTarget),S(!0)},Y=()=>{var v;S(!1),(v=T.current)==null||v.focus(),D(null)},se=(v,A)=>{k(v),A&&(T.current=A.currentTarget)},H=()=>{E&&u(l.filter(v=>v.id!==E.id)),k(null)},s=v=>{if(N&&v.id)u(l.map(A=>A.id===v.id?{...A,...v}:A));else{const{id:A,...q}=v,ee={...q,questionType:"multipleChoice",suspended:!1};g(ee)}Y()},y=v=>{u(l.map(A=>A.id===v?{...A,suspended:!0}:A)),m(null)},O=v=>{u(l.map(A=>A.id===v?{...A,suspended:!1}:A)),m(null)},P=async v=>{m(null),L(v.id);try{await x(t,v)}finally{L(null)}},ae=(v,A)=>{C(v),A.dataTransfer.effectAllowed="move"},Q=(v,A)=>{A.preventDefault(),A.dataTransfer.dropEffect="move"},he=(v,A)=>{if(A.preventDefault(),z===null||z===v)return;const q=[...l],[ee]=q.splice(z,1);q.splice(v,0,ee),u(q),C(null)};return e.jsxs("div",{children:[e.jsx("div",{className:"border-b border-border",children:e.jsxs("button",{onClick:()=>p(!I),className:"w-full flex justify-between items-center text-left p-6","aria-expanded":I,"aria-controls":"question-list-content",children:[e.jsxs("h3",{className:"text-xl font-semibold text-text",children:["Questions (",l.length,")"]}),e.jsx(a,{name:"chevron-down",className:`w-6 h-6 transition-transform duration-300 ${I?"":"-rotate-90"} text-text-muted`})]})}),I&&e.jsxs("div",{id:"question-list-content",className:"animate-fade-in",children:[e.jsx("div",{className:"p-6",children:l.length>0?e.jsx("ul",{className:"space-y-4",children:l.map((v,A)=>{const{text:q,isDue:ee}=vt(v.dueDate),fe=pe(v.questionText),U=z===A;return e.jsxs("li",{className:`p-4 rounded-lg flex items-start justify-between transition-all border border-transparent ${v.suspended?"bg-yellow-500/10 opacity-70":"bg-background"} ${U?"opacity-50 ring-2 ring-primary":"hover:border-border"}`,draggable:!0,onDragStart:G=>ae(A,G),onDragOver:G=>Q(A,G),onDrop:G=>he(A,G),children:[e.jsx("div",{className:"mr-3 mt-1 cursor-grab active:cursor-grabbing text-text-muted hover:text-text",children:e.jsx(a,{name:"grip-vertical",className:"w-5 h-5"})}),e.jsxs("div",{className:"flex-1 min-w-0 mr-4",children:[e.jsx("p",{className:"text-base font-medium text-text break-words truncate",title:fe,children:fe}),e.jsxs("div",{className:"mt-3 space-y-2",children:[e.jsx(Ie,{level:ke(v)}),e.jsxs("div",{className:"flex items-center gap-4 text-xs text-text-muted",children:[e.jsxs("span",{className:`font-semibold ${ee?"text-primary":""}`,children:[e.jsx(a,{name:"zap",className:"w-3 h-3 inline-block mr-1"}),q]}),e.jsxs("span",{children:[e.jsx(a,{name:"list",className:"w-3 h-3 inline-block mr-1"}),(v.options||[]).length," options"]})]}),v.tags&&v.tags.length>0&&e.jsx("div",{className:"flex flex-wrap items-center gap-1 mt-2",children:v.tags.map(G=>e.jsx("span",{className:"bg-border/50 text-text-muted text-xs px-2 py-0.5 rounded-full",children:G},G))})]})]}),e.jsxs("div",{className:"flex-shrink-0 relative",ref:j===v.id?M:null,children:[o===v.id?e.jsx("div",{className:"p-2",children:e.jsx(ie,{size:"sm"})}):e.jsx(w,{variant:"ghost",className:"p-2 h-auto",onClick:G=>{G.stopPropagation(),m(K=>K===v.id?null:v.id)},"aria-label":"More options for question",children:e.jsx(a,{name:"more-vertical",className:"w-5 h-5"})}),j===v.id&&e.jsxs("div",{className:"absolute right-0 mt-2 w-48 bg-surface rounded-md shadow-lg py-1 z-10 ring-1 ring-black ring-opacity-5 animate-fade-in",style:{animationDuration:"150ms"},children:[e.jsxs("button",{type:"button",onClick:G=>{_(v,G),m(null)},className:"flex items-center w-full px-4 py-2 text-sm text-left text-text hover:bg-border/20",children:[e.jsx(a,{name:"edit",className:"w-4 h-4 mr-3"}),"Edit"]}),e.jsxs("button",{type:"button",onClick:()=>P(v),className:"flex items-center w-full px-4 py-2 text-sm text-left text-text hover:bg-border/20",children:[e.jsx(a,{name:"zap",className:"w-4 h-4 mr-3"}),"Regenerate"]}),v.suspended?e.jsxs("button",{type:"button",onClick:()=>O(v.id),className:"flex items-center w-full px-4 py-2 text-sm text-left text-text hover:bg-border/20",children:[e.jsx(a,{name:"eye",className:"w-4 h-4 mr-3"}),"Unsuspend"]}):e.jsxs("button",{type:"button",onClick:()=>y(v.id),className:"flex items-center w-full px-4 py-2 text-sm text-left text-text hover:bg-border/20",children:[e.jsx(a,{name:"eye-off",className:"w-4 h-4 mr-3"}),"Suspend"]}),e.jsx("div",{className:"border-t border-border my-1"}),e.jsxs("button",{type:"button",onClick:G=>{se(v,G),m(null)},className:"flex items-center w-full px-4 py-2 text-sm text-left text-red-600 dark:text-red-400 hover:bg-red-50 dark:hover:bg-red-900/20",children:[e.jsx(a,{name:"trash-2",className:"w-4 h-4 mr-3"}),"Delete"]})]})]})]},v.id)})}):e.jsxs("div",{className:"flex flex-col items-center justify-center p-8 border-2 border-dashed border-border rounded-lg bg-background/50",children:[e.jsx(a,{name:"help-circle",className:"w-12 h-12 text-text-muted mb-3"}),e.jsx("p",{className:"text-text font-medium mb-1",children:"No questions yet"}),e.jsx("p",{className:"text-sm text-text-muted text-center max-w-xs",children:"Start adding questions to build your quiz."}),e.jsx("div",{className:"mt-4 flex flex-col sm:flex-row gap-3",children:e.jsxs(w,{variant:"primary",onClick:v=>_(null,v),children:[e.jsx(a,{name:"plus",className:"w-4 h-4 mr-2"}),"Add Question"]})})]})}),e.jsxs("div",{className:"px-6 py-4 border-t border-border flex flex-wrap gap-2 items-center",children:[e.jsxs(w,{variant:"secondary",onClick:v=>_(null,v),className:"flex-grow sm:flex-grow-0",children:[e.jsx(a,{name:"plus",className:"w-5 h-5 mr-2"}),"Add New Question"]}),e.jsxs(w,{variant:"ghost",onClick:r,className:"flex-grow sm:flex-grow-0",children:[e.jsx(a,{name:"code",className:"w-5 h-5 mr-2"}),"Bulk Add via JSON"]}),e.jsx("div",{className:"flex-grow"}),R&&e.jsx(Ae,{deck:t,isGenerating:te,onGenerateMore:()=>B==null?void 0:B.handleOpenAIGenerationForDeck(t),onRework:()=>B==null?void 0:B.handleOpenAIReworkForDeck(t),onAnalyze:()=>B==null?void 0:B.handleOpenDeckAnalysis(t),onAutoTag:()=>B==null?void 0:B.handleAutoTagQuestions(t),onHardenDistractors:()=>B==null?void 0:B.handleHardenAllDistractors(t)})]})]}),b&&e.jsx(jt,{question:N,onClose:Y,onSave:s,deckName:f}),E&&e.jsx(Ue,{isOpen:!!E,onClose:()=>k(null),onConfirm:H,title:"Delete Question",message:"Are you sure you want to delete this question? This action cannot be undone."})]})},wt=({isOpen:t,onClose:l,onAddItems:u,deckType:g})=>{const[r,i]=n.useState(""),{addToast:d}=be(),x=n.useRef(null);me(x,t);const h=n.useMemo(()=>g===$.Flashcard?`[
  {
    "front": "What is the capital of Japan?",
    "back": "Tokyo"
  },
  {
    "front": "What is 2 + 2?",
    "back": "4"
  }
]`:`[
  {
    "questionText": "Which planet is known as the Red Planet?",
    "options": [
      { "id": "1", "text": "Earth" },
      { "id": "2", "text": "Mars" }
    ],
    "correctAnswerId": "2",
    "detailedExplanation": "Mars is called the Red Planet because of its reddish appearance."
  }
]`,[g]),f=D=>{if(D.preventDefault(),!r.trim()){d("JSON content cannot be empty.","error");return}try{const b=at(r,g);if(b.length===0){d("The JSON array is empty. No items were added.","info"),l();return}u(b),d(`Successfully added ${b.length} item(s).`,"success"),l()}catch(b){d(b instanceof Error?b.message:"Invalid JSON format.","error")}},N=D=>{if(D.key==="Tab"){D.preventDefault();const b=D.target,S=b.selectionStart,E=b.selectionEnd;b.value=b.value.substring(0,S)+"  "+b.value.substring(E),b.selectionStart=b.selectionEnd=S+2}};return t?e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-75 flex items-center justify-center z-[60] p-4",children:e.jsx("div",{ref:x,className:"bg-surface rounded-lg shadow-xl w-full max-w-2xl transform transition-all relative",children:e.jsxs("form",{onSubmit:f,children:[e.jsxs("div",{className:"flex justify-between items-center p-4 border-b border-border",children:[e.jsxs("h2",{className:"text-xl font-bold",children:["Bulk Add ",g===$.Flashcard?"Cards":"Questions"]}),e.jsx(w,{type:"button",variant:"ghost",onClick:l,className:"p-1 h-auto",children:e.jsx(a,{name:"x"})})]}),e.jsxs("div",{className:"p-6",children:[e.jsx("label",{htmlFor:"json-content-bulk",className:"block text-sm font-medium text-text-muted mb-1",children:"Paste an array of items in JSON format."}),e.jsx("textarea",{id:"json-content-bulk",value:r,onChange:D=>i(D.target.value),onKeyDown:N,rows:15,className:"w-full p-2 bg-background border border-border rounded-md focus:ring-2 focus:ring-primary focus:outline-none font-mono text-sm",placeholder:h}),e.jsxs(oe,{href:"/instructions/json",onClick:l,className:"text-sm text-primary hover:underline mt-2 inline-flex items-center gap-1",children:[e.jsx(a,{name:"help-circle",className:"w-4 h-4"}),"View JSON format guide"]})]}),e.jsxs("div",{className:"flex justify-end p-4 bg-background/50 border-t border-border",children:[e.jsx(w,{type:"button",variant:"secondary",onClick:l,className:"mr-2",children:"Cancel"}),e.jsx(w,{type:"submit",variant:"primary",children:"Add Items"})]})]})})}):null},Nt=({data:t,total:l})=>l===0?e.jsx("div",{className:"w-full bg-gray-200 dark:bg-gray-700 rounded-full h-4"}):e.jsx("div",{className:"flex w-full h-4 bg-gray-200 dark:bg-gray-700 rounded-full overflow-hidden",role:"progressbar","aria-valuenow":t.reduce((u,g)=>u+g.value,0),"aria-valuemin":0,"aria-valuemax":l,children:t.map((u,g)=>{if(u.value===0)return null;const r=u.value/l*100;return e.jsx("div",{className:`${u.color} transition-all duration-500`,style:{width:`${r}%`},title:`${u.label}: ${u.value} item(s)`},g)})}),Ct=({data:t})=>{const l=Math.max(...t.map(f=>f.count),1),u=350,g=120,r={top:25,right:15,bottom:25,left:15},i=u-r.left-r.right,d=g-r.top-r.bottom,x=i/t.length,h=Math.max(6,x*.1);return e.jsxs("div",{className:"w-full",children:[e.jsx("h4",{className:"text-sm font-semibold text-gray-700 dark:text-gray-300 mb-2",children:"Upcoming Due Dates (Next 7 Days)"}),e.jsx("div",{className:"bg-gray-50 dark:bg-gray-900/50 p-2 rounded-lg border border-gray-200 dark:border-gray-700/50",children:e.jsxs("svg",{viewBox:`0 0 ${u} ${g}`,width:"100%",height:"auto","aria-labelledby":"due-date-graph-title",role:"img",className:"overflow-visible",children:[e.jsx("title",{id:"due-date-graph-title",children:"A bar chart showing the number of items due over the next 7 days."}),t.map((f,N)=>{const D=f.count>0?f.count/l*d:0,b=r.left+N*x+(x-h)/2,S=r.top+d-D;return e.jsxs("g",{className:"group",style:{cursor:"pointer"},children:[e.jsxs("title",{children:[f.date,": ",f.count," item",f.count!==1?"s":""," due"]}),e.jsx("rect",{x:b,y:S,width:h,height:D,rx:"2",className:"fill-blue-500 transition-colors group-hover:fill-blue-400"}),e.jsx("text",{x:b+h/2,y:S-6,textAnchor:"middle",className:"fill-gray-600 dark:fill-gray-300 font-semibold text-sm transition-opacity opacity-0 group-hover:opacity-100 pointer-events-none",children:f.count}),e.jsx("text",{x:b+h/2,y:g-r.bottom+15,textAnchor:"middle",className:"fill-gray-400 dark:fill-gray-500 text-xs pointer-events-none",children:f.dayLabel})]},N)})]})})]})},Dt=({reviews:t})=>{const[l,u]=n.useState(null),g=n.useMemo(()=>{if(!t||t.length===0)return[];const k=new Map;t.forEach(p=>{const j=new Date(p.timestamp).toISOString().split("T")[0],m=k.get(j)||{totalMastery:0,count:0};m.totalMastery+=p.masteryLevel,m.count++,k.set(j,m)});const I=Array.from(k.entries()).map(([p,{totalMastery:j,count:m}])=>({date:new Date(p),avgMastery:j/m}));return I.sort((p,j)=>p.date.getTime()-j.date.getTime()),I.slice(-90)},[t]);if(g.length<2)return e.jsx("div",{className:"text-center text-sm text-text-muted py-8",children:"Not enough review history to plot a graph."});const r=350,i=150,d={top:10,right:10,bottom:20,left:30},x=r-d.left-d.right,h=i-d.top-d.bottom,f=g[0].date.getTime(),N=g[g.length-1].date.getTime(),D=k=>(k.getTime()-f)/(N-f)*x+d.left,b=k=>i-d.bottom-k*h,S=g.map(k=>`${D(k.date)},${b(k.avgMastery)}`).join(" L "),E=k=>{const I=k.currentTarget.getBoundingClientRect(),p=k.clientX-I.left;let j=g[0],m=1/0;g.forEach(o=>{const L=D(o.date),z=Math.abs(p-L);z<m&&(m=z,j=o)}),m<20?u({x:D(j.date),y:b(j.avgMastery),data:j}):u(null)};return e.jsx("div",{className:"w-full",children:e.jsxs("svg",{viewBox:`0 0 ${r} ${i}`,width:"100%",height:"auto","aria-labelledby":"mastery-graph-title",role:"img",className:"overflow-visible",onMouseMove:E,onMouseLeave:()=>u(null),children:[e.jsx("title",{id:"mastery-graph-title",children:"A line chart showing average mastery over time."}),[0,.25,.5,.75,1].map(k=>e.jsxs("g",{children:[e.jsx("line",{x1:d.left,y1:b(k),x2:r-d.right,y2:b(k),className:"stroke-current text-border/70",strokeWidth:"0.5"}),e.jsx("text",{x:d.left-8,y:b(k)+4,textAnchor:"end",className:"text-xs fill-text-muted",children:`${k*100}%`})]},k)),e.jsx("text",{x:d.left,y:i-5,textAnchor:"start",className:"text-xs fill-text-muted",children:g[0].date.toLocaleDateString("en-us",{month:"short",day:"numeric"})}),e.jsx("text",{x:r-d.right,y:i-5,textAnchor:"end",className:"text-xs fill-text-muted",children:g[g.length-1].date.toLocaleDateString("en-us",{month:"short",day:"numeric"})}),e.jsx("path",{d:`M ${S}`,className:"stroke-primary",fill:"none",strokeWidth:"2",strokeLinejoin:"round",strokeLinecap:"round"}),l&&e.jsxs("g",{children:[e.jsx("line",{x1:l.x,y1:d.top,x2:l.x,y2:i-d.bottom,className:"stroke-current text-border",strokeDasharray:"2,2"}),e.jsx("circle",{cx:l.x,cy:l.y,r:"4",className:"fill-primary"}),e.jsxs("g",{transform:`translate(${l.x>r/2?l.x-100:l.x+10}, ${d.top})`,children:[e.jsx("rect",{x:"0",y:"0",width:"90",height:"35",rx:"4",className:"fill-surface opacity-90",stroke:"rgb(var(--color-border))"}),e.jsx("text",{x:"5",y:"15",className:"text-xs fill-text font-semibold",children:l.data.date.toLocaleDateString("en-us",{month:"short",day:"numeric"})}),e.jsxs("text",{x:"5",y:"30",className:"text-xs fill-text-muted",children:["Mastery: ",Math.round(l.data.avgMastery*100),"%"]})]})]})]})})},St=({block:t,onClose:l,onSave:u})=>{const[g,r]=n.useState(""),[i,d]=n.useState([]),{addToast:x}=be(),h=n.useRef(null);me(h,!0),n.useEffect(()=>{t?(r(t.infoCard.content),d(t.questions.map(p=>({...p})))):d([{id:crypto.randomUUID(),questionText:"",options:[{id:crypto.randomUUID(),text:""},{id:crypto.randomUUID(),text:""}],correctAnswerId:"",detailedExplanation:""}])},[t]);const f=(p,j,m)=>{const o=[...i];o[p][j]=m,d(o)},N=(p,j,m)=>{const o=[...i];o[p].options&&(o[p].options[j].text=m,d(o))},D=()=>{d([...i,{id:crypto.randomUUID(),questionText:"",options:[{id:crypto.randomUUID(),text:""},{id:crypto.randomUUID(),text:""}],correctAnswerId:"",detailedExplanation:""}])},b=p=>{if(i.length<=1){x("A learning block must have at least one question.","error");return}d(i.filter((j,m)=>m!==p))},S=p=>{var m;const j=[...i];(m=j[p].options)==null||m.push({id:crypto.randomUUID(),text:""}),d(j)},E=(p,j)=>{const m=[...i],o=m[p];if(o.options&&o.options.length>2){const L=o.options.splice(j,1)[0];o.correctAnswerId===L.id&&(o.correctAnswerId=""),d(m)}else x("A question must have at least two options.","error")},k=(p,j)=>{if(p.key==="Tab"){p.preventDefault();const m=p.target,o=m.selectionStart,L=m.selectionEnd,z=m.value.substring(0,o)+"	"+m.value.substring(L);m.value=z,j(z),m.selectionStart=m.selectionEnd=o+1}},I=p=>{var L,z;if(p.preventDefault(),!g.trim()){x("Informational content cannot be empty.","error");return}for(const C of i){if(!((L=C.questionText)!=null&&L.trim())){x("Question text is required.","error");return}if((z=C.options)!=null&&z.some(T=>!T.text.trim())){x("All options must have text.","error");return}if(!C.correctAnswerId){x("You must select a correct answer for each question.","error");return}}const j=new Date().toISOString(),m={id:(t==null?void 0:t.infoCard.id)||crypto.randomUUID(),content:g,unlocksQuestionIds:i.map(C=>C.id)},o=i.map((C,T)=>{const M=t==null?void 0:t.questions[T];return{...M,...C,id:C.id,questionType:"multipleChoice",infoCardIds:[m.id],dueDate:(M==null?void 0:M.dueDate)||j,interval:(M==null?void 0:M.interval)||0,easeFactor:(M==null?void 0:M.easeFactor)||Se,tags:C.tags||[]}});u({infoCard:m,questions:o})};return e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-75 flex items-center justify-center z-[60] p-4",children:e.jsx("div",{ref:h,className:"bg-surface rounded-lg shadow-xl w-full max-w-4xl transform transition-all relative max-h-[90vh] flex flex-col",children:e.jsxs("form",{onSubmit:I,className:"flex flex-col h-full",children:[e.jsxs("header",{className:"flex-shrink-0 flex justify-between items-center p-4 border-b border-border",children:[e.jsx("h2",{className:"text-xl font-bold",children:t?"Edit Learning Block":"Add New Learning Block"}),e.jsx(w,{type:"button",variant:"ghost",onClick:l,className:"p-1 h-auto",children:e.jsx(a,{name:"x"})})]}),e.jsxs("main",{className:"p-6 space-y-6 overflow-y-auto",children:[e.jsxs("div",{children:[e.jsx("label",{htmlFor:"info-content",className:"block text-sm font-bold text-text mb-1",children:"Informational Content (Supports HTML)"}),e.jsxs("div",{className:"border border-border rounded-md focus-within:ring-2 focus-within:ring-primary overflow-hidden",children:[e.jsx(ge,{targetId:"info-content",value:g,onChange:r}),e.jsx("textarea",{id:"info-content",value:g,onChange:p=>r(p.target.value),onKeyDown:p=>k(p,r),rows:12,className:"w-full p-2 bg-background focus:outline-none font-mono text-sm block",placeholder:"Explain a concept here..."})]})]}),e.jsxs("div",{className:"border-t border-border pt-4",children:[e.jsx("h3",{className:"text-lg font-bold text-text mb-2",children:"Questions"}),e.jsxs("div",{className:"space-y-6",children:[i.map((p,j)=>{var m;return e.jsxs("div",{className:"p-4 bg-background rounded-lg border border-border space-y-3 relative",children:[e.jsxs("label",{className:"block text-sm font-medium text-text-muted",children:["Question ",j+1]}),e.jsx("textarea",{value:p.questionText,onChange:o=>f(j,"questionText",o.target.value),rows:2,className:"w-full p-2 bg-surface border border-border rounded-md focus:ring-2 focus:ring-primary focus:outline-none",placeholder:"Question related to the info above"}),e.jsx("div",{className:"space-y-2",children:(m=p.options)==null?void 0:m.map((o,L)=>e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"radio",name:`correct-answer-${j}`,checked:p.correctAnswerId===o.id,onChange:()=>f(j,"correctAnswerId",o.id),className:"h-5 w-5 text-primary bg-border/50 border-border focus:ring-primary"}),e.jsx("input",{type:"text",value:o.text,onChange:z=>N(j,L,z.target.value),className:"flex-grow p-2 bg-surface border border-border rounded-md focus:ring-2 focus:ring-primary focus:outline-none",placeholder:`Option ${L+1}`}),e.jsx(w,{type:"button",variant:"ghost",onClick:()=>E(j,L),className:"p-2 h-auto text-text-muted hover:text-red-500",children:e.jsx(a,{name:"x",className:"w-4 h-4"})})]},o.id||L))}),e.jsxs(w,{type:"button",variant:"ghost",onClick:()=>S(j),size:"sm",children:[e.jsx(a,{name:"plus",className:"w-4 h-4 mr-1"}),"Add Option"]}),e.jsx("textarea",{value:p.detailedExplanation,onChange:o=>f(j,"detailedExplanation",o.target.value),rows:2,className:"w-full p-2 bg-surface border border-border rounded-md focus:ring-2 focus:ring-primary focus:outline-none",placeholder:"Detailed explanation for the answer"}),e.jsx(w,{type:"button",variant:"ghost",onClick:()=>b(j),className:"absolute top-2 right-2 p-2 h-auto text-text-muted hover:text-red-500",children:e.jsx(a,{name:"trash-2",className:"w-4 h-4"})})]},p.id||j)}),e.jsxs(w,{type:"button",variant:"secondary",onClick:D,children:[e.jsx(a,{name:"plus",className:"w-4 h-4 mr-2"}),"Add Question"]})]})]})]}),e.jsxs("footer",{className:"flex-shrink-0 flex justify-end p-4 bg-background/50 border-t border-border",children:[e.jsx(w,{type:"button",variant:"secondary",onClick:l,className:"mr-2",children:"Cancel"}),e.jsx(w,{type:"submit",variant:"primary",children:t?"Save Changes":"Add Block"})]})]})})})},kt=({deck:t,onSaveBlock:l,onDeleteBlock:u,onBlockClick:g,onReorderBlocks:r})=>{const[i,d]=n.useState(null),[x,h]=n.useState(!1),[f,N]=n.useState(null),D=n.useRef(null),{aiFeaturesEnabled:b}=ue(),S=xe(),k=!!ye(n.useCallback(C=>{const{currentTask:T,queue:M}=C.aiGenerationStatus;return(T==null?void 0:T.deckId)===t.id?T:(M||[]).find(R=>R.deckId===t.id)},[t.id])),I=(C,T)=>{d(C),T&&(D.current=T.currentTarget),h(!0)},p=()=>{var C;h(!1),(C=D.current)==null||C.focus(),d(null)},j=C=>{l(C),p()},m=n.useMemo(()=>(t.infoCards||[]).map(C=>({infoCard:C,questions:(t.questions||[]).filter(T=>{var M;return(M=T.infoCardIds)==null?void 0:M.includes(C.id)})})),[t.infoCards,t.questions]),o=(C,T)=>{N(C),T.dataTransfer.effectAllowed="move"},L=(C,T)=>{T.preventDefault(),T.dataTransfer.dropEffect="move"},z=(C,T)=>{if(T.preventDefault(),f===null||f===C)return;const M=[...t.infoCards||[]],[R]=M.splice(f,1);M.splice(C,0,R),r(M),N(null)};return e.jsxs("div",{children:[e.jsxs("div",{className:"border-b border-border p-6",children:[e.jsx("h3",{className:"text-xl font-semibold text-text",children:"Learning Blocks"}),e.jsx("p",{className:"text-sm text-text-muted mt-1",children:"Each block contains an info card and its related questions."})]}),e.jsx("div",{className:"p-6",children:m.length>0?e.jsx("ul",{className:"space-y-4",children:m.map((C,T)=>{const M=f===T;return e.jsx("li",{className:`p-4 rounded-lg bg-background border transition-all duration-200 cursor-pointer ${M?"opacity-50 ring-2 ring-primary border-transparent":"border-border hover:border-primary hover:shadow-md"}`,draggable:!0,onDragStart:R=>o(T,R),onDragOver:R=>L(T,R),onDrop:R=>z(T,R),onClick:()=>g(C),onKeyDown:R=>{(R.key==="Enter"||R.key===" ")&&g(C)},tabIndex:0,role:"button",children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsx("div",{className:"mr-3 mt-1 cursor-grab active:cursor-grabbing text-text-muted hover:text-text",onClick:R=>R.stopPropagation(),children:e.jsx(a,{name:"grip-vertical",className:"w-5 h-5"})}),e.jsxs("div",{className:"flex-1 min-w-0 mr-4",children:[e.jsxs("div",{className:"flex items-center gap-2 text-text font-semibold",children:[e.jsx(a,{name:"book-open",className:"w-5 h-5 text-purple-500 flex-shrink-0"}),e.jsx("p",{className:"truncate",title:pe(C.infoCard.content),children:pe(C.infoCard.content)})]}),C.questions.length>0&&e.jsx("ul",{className:"mt-2 pl-7 space-y-1",children:C.questions.map(R=>e.jsxs("li",{className:"flex items-center gap-2 text-sm text-text-muted",children:[e.jsx(a,{name:"help-circle",className:"w-4 h-4 flex-shrink-0"}),e.jsx("span",{className:"truncate",title:pe(R.questionText),children:pe(R.questionText)})]},R.id))})]}),e.jsxs("div",{className:"flex-shrink-0 flex items-center gap-1",children:[e.jsx(w,{variant:"ghost",className:"p-2 h-auto",onClick:R=>{R.stopPropagation(),I(C,R)},title:"Edit this block",children:e.jsx(a,{name:"edit",className:"w-4 h-4"})}),e.jsx(w,{variant:"ghost",className:"p-2 h-auto text-text-muted hover:text-red-500",onClick:R=>{R.stopPropagation(),u(C.infoCard.id)},title:"Delete this block",children:e.jsx(a,{name:"trash-2",className:"w-4 h-4"})})]})]})},C.infoCard.id)})}):e.jsxs("div",{className:"text-center text-text-muted py-8",children:[e.jsx(a,{name:"layers",className:"w-12 h-12 mx-auto mb-2 opacity-50"}),e.jsx("p",{children:"This deck has no learning blocks yet."})]})}),e.jsxs("div",{className:"px-6 py-4 border-t border-border flex flex-wrap gap-2 items-center",children:[e.jsxs(w,{variant:"secondary",onClick:C=>I(null,C),className:"flex-grow sm:flex-grow-0",children:[e.jsx(a,{name:"plus",className:"w-5 h-5 mr-2"}),"Add Learning Block"]}),e.jsx("div",{className:"flex-grow"}),b&&e.jsx(Ae,{deck:t,isGenerating:k,onGenerateMore:()=>S==null?void 0:S.handleOpenAIGenerationForDeck(t),onAnalyze:()=>S==null?void 0:S.handleOpenDeckAnalysis(t),onAutoTag:()=>S==null?void 0:S.handleAutoTagQuestions(t),onHardenDistractors:()=>S==null?void 0:S.handleHardenAllDistractors(t)})]}),x&&e.jsx(St,{block:i,onClose:p,onSave:j})]})},It=({isOpen:t,onClose:l,block:u,deckName:g,onExpandText:r})=>{const i=n.useRef(null),d=n.useRef(null),[x,h]=n.useState(null),[f,N]=n.useState(null);me(i,t);const D=()=>{h(null),N(null),l()},b=()=>{var p;if(f)return;const I=window.getSelection();if(I&&I.toString().trim().length>10){const j=I.toString().trim(),o=I.getRangeAt(0).getBoundingClientRect(),L=(p=i.current)==null?void 0:p.getBoundingClientRect();L&&h({visible:!0,top:o.top-L.top+o.height,left:o.left-L.left+o.width/2,text:j})}else h(null)},S=async()=>{if(!(x!=null&&x.text)||!u)return;const{text:I}=x;h(null),N({isLoading:!0,content:null});const p=await r(g,u.infoCard.content,I);N({isLoading:!1,content:p})},E=()=>e.jsxs(e.Fragment,{children:[e.jsxs("div",{onMouseUp:b,ref:d,children:[e.jsx("h3",{className:"text-sm font-semibold uppercase tracking-wider text-text-muted mb-2",children:"Informational Content"}),e.jsx("div",{className:"p-4 bg-background rounded-lg border border-border",children:e.jsx(Be,{html:u.infoCard.content,className:"prose dark:prose-invert max-w-none"})})]}),e.jsxs("div",{children:[e.jsxs("h3",{className:"text-sm font-semibold uppercase tracking-wider text-text-muted mb-2",children:["Associated Questions (",(u.questions||[]).length,")"]}),e.jsx("ul",{className:"space-y-3",children:(u.questions||[]).map(I=>e.jsxs("li",{className:"p-3 bg-background rounded-lg border border-border",children:[e.jsx("p",{className:"font-semibold text-text",dangerouslySetInnerHTML:{__html:I.questionText}}),e.jsx("ul",{className:"mt-2 pl-4 text-sm space-y-1",children:(I.options||[]).map(p=>e.jsxs("li",{className:`flex items-start gap-2 ${p.id===I.correctAnswerId?"text-green-600 dark:text-green-400 font-medium":"text-text-muted"}`,children:[p.id===I.correctAnswerId?e.jsx(a,{name:"check-circle",className:"w-4 h-4 flex-shrink-0 mt-0.5"}):e.jsx("div",{className:"w-4 h-4 flex-shrink-0"}),e.jsx("span",{dangerouslySetInnerHTML:{__html:p.text}})]},p.id))})]},I.id))})]})]}),k=()=>e.jsxs("div",{className:"space-y-4",children:[e.jsxs(w,{variant:"ghost",size:"sm",onClick:()=>N(null),children:[e.jsx(a,{name:"chevron-left",className:"w-4 h-4 mr-1"}),"Back to Content"]}),f!=null&&f.isLoading?e.jsx("div",{className:"flex justify-center items-center h-48",children:e.jsx(ie,{})}):f!=null&&f.content?e.jsx("div",{className:"p-4 bg-background rounded-lg border border-border",children:e.jsx(Be,{html:f.content,className:"prose dark:prose-invert max-w-none"})}):e.jsx("p",{className:"text-center text-red-500",children:"Failed to generate explanation."})]});return!t||!u?null:e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-75 flex items-center justify-center z-[60] p-4",children:e.jsxs("div",{ref:i,className:"bg-surface rounded-lg shadow-xl w-full max-w-3xl transform transition-all relative max-h-[90vh] flex flex-col",role:"dialog","aria-modal":"true","aria-labelledby":"block-detail-title",children:[(x==null?void 0:x.visible)&&e.jsx("div",{className:"absolute z-10 p-1",style:{top:x.top,left:x.left,transform:"translateX(-50%)"},children:e.jsxs(w,{size:"sm",onClick:S,children:[e.jsx(a,{name:"zap",className:"w-4 h-4 mr-1"})," Expand"]})}),e.jsxs("div",{className:"flex-shrink-0 flex justify-between items-center p-4 border-b border-border",children:[e.jsx("h2",{id:"block-detail-title",className:"text-xl font-bold text-text",children:"Learning Block Details"}),e.jsx(w,{type:"button",variant:"ghost",onClick:D,className:"p-1 h-auto","aria-label":"Close",children:e.jsx(a,{name:"x"})})]}),e.jsx("div",{className:"p-6 overflow-y-auto space-y-6",children:f?k():E()}),e.jsx("div",{className:"flex-shrink-0 flex justify-end p-4 bg-background/50 border-t border-border",children:e.jsx(w,{type:"button",variant:"primary",onClick:D,children:"Close"})})]})})},At=()=>e.jsx("div",{className:"space-y-8",children:e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-8",children:[e.jsxs("div",{className:"bg-surface p-6 rounded-lg shadow-md border border-border h-64 flex flex-col",children:[e.jsxs("div",{className:"mb-4",children:[e.jsx(W,{width:180,height:24}),e.jsx(W,{width:250,height:16,className:"mt-2"})]}),e.jsxs("div",{className:"flex-1 flex items-end gap-2 pb-4 px-2",children:[e.jsx(W,{width:"15%",height:"30%",className:"rounded-t-sm"}),e.jsx(W,{width:"15%",height:"50%",className:"rounded-t-sm"}),e.jsx(W,{width:"15%",height:"40%",className:"rounded-t-sm"}),e.jsx(W,{width:"15%",height:"70%",className:"rounded-t-sm"}),e.jsx(W,{width:"15%",height:"60%",className:"rounded-t-sm"}),e.jsx(W,{width:"15%",height:"80%",className:"rounded-t-sm"})]})]}),e.jsxs("div",{className:"bg-surface p-6 rounded-lg shadow-md border border-border h-64",children:[e.jsxs("div",{className:"mb-4",children:[e.jsx(W,{width:150,height:24}),e.jsx(W,{width:200,height:16,className:"mt-2"})]}),e.jsx("div",{className:"space-y-3",children:[1,2,3].map(t=>e.jsxs("div",{className:"p-3 bg-background rounded-md border border-transparent",children:[e.jsx(W,{width:"80%",height:16}),e.jsx(W,{width:"30%",height:12,className:"mt-2"})]},t))})]})]})}),Tt=({isOpen:t,onClose:l,onStart:u,totalItems:g})=>{const[r,i]=n.useState("random"),[d,x]=n.useState("all"),h=n.useRef(null);me(h,t);const f=()=>{u({sort:r,limit:d}),l()};return t?e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-75 flex items-center justify-center z-[60] p-4",children:e.jsxs("div",{ref:h,className:"bg-surface rounded-lg shadow-xl w-full max-w-sm transform transition-all relative",children:[e.jsxs("div",{className:"flex justify-between items-center p-4 border-b border-border",children:[e.jsx("h2",{className:"text-xl font-bold text-text",children:"Cram Session Options"}),e.jsx(w,{variant:"ghost",onClick:l,className:"p-1 h-auto",children:e.jsx(a,{name:"x"})})]}),e.jsxs("div",{className:"p-6 space-y-6",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-text-muted mb-2",children:"Sort Order"}),e.jsx("div",{className:"grid grid-cols-2 gap-2",children:["random","hardest","newest","oldest"].map(N=>e.jsx("button",{onClick:()=>i(N),className:`p-2 rounded-md text-sm border capitalize transition-colors ${r===N?"bg-primary text-on-primary border-primary":"bg-background border-border text-text hover:border-primary"}`,children:N},N))}),e.jsxs("p",{className:"text-xs text-text-muted mt-2",children:[r==="random"&&"Shuffle cards randomly.",r==="hardest"&&"Focus on cards with high lapse counts and low ease factors.",r==="newest"&&"Review the most recently added cards first.",r==="oldest"&&"Review cards from the beginning of the deck."]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-text-muted mb-2",children:"Card Limit"}),e.jsxs("select",{value:d,onChange:N=>x(N.target.value==="all"?"all":Number(N.target.value)),className:"w-full p-2 bg-background border border-border rounded-md focus:ring-2 focus:ring-primary outline-none",children:[e.jsxs("option",{value:"all",children:["All (",g,")"]}),e.jsx("option",{value:"10",disabled:g<10,children:"10 Items"}),e.jsx("option",{value:"20",disabled:g<20,children:"20 Items"}),e.jsx("option",{value:"50",disabled:g<50,children:"50 Items"}),e.jsx("option",{value:"100",disabled:g<100,children:"100 Items"})]})]})]}),e.jsxs("div",{className:"flex justify-end p-4 bg-background/50 border-t border-border",children:[e.jsx(w,{variant:"secondary",onClick:l,className:"mr-2",children:"Cancel"}),e.jsxs(w,{variant:"primary",onClick:f,children:[e.jsx(a,{name:"zap",className:"w-4 h-4 mr-2"})," Start Cramming"]})]})]})}):null},Et=t=>{const l={new:0,learning:0,young:0,mature:0};return t.forEach(u=>{u.interval===0?l.new++:u.interval<7?l.learning++:u.interval<21?l.young++:l.mature++}),l},Mt=({deck:t})=>{const[l,u]=n.useState([]),[g,r]=n.useState(!0),i=(t.type===$.Flashcard?t.cards:(t.type===$.Learning,t.questions))||[];n.useEffect(()=>{(async()=>{r(!0);try{const h=await ht(t.id);u(h)}catch(h){console.error("Failed to fetch review history for deck:",h)}finally{r(!1)}})()},[t.id]);const d=n.useMemo(()=>{if(!l.length)return[];const x=new Map;return l.forEach(h=>{h.rating===mt.Again&&x.set(h.itemId,(x.get(h.itemId)||0)+1)}),Array.from(x.entries()).sort((h,f)=>f[1]-h[1]).slice(0,5).map(([h,f])=>{const N=i.find(D=>D.id===h);return N?{...N,failureCount:f}:null}).filter(h=>!!h)},[l,i]);return g?e.jsx(At,{}):l.length===0?e.jsxs("div",{className:"text-center py-10 bg-surface rounded-lg border border-border",children:[e.jsx(a,{name:"trending-up",className:"w-12 h-12 mx-auto text-text-muted/50"}),e.jsx("h3",{className:"mt-2 text-xl font-medium text-text",children:"No Statistics Yet"}),e.jsx("p",{className:"mt-1 text-sm text-text-muted",children:"Complete a study session for this deck to see your stats."})]}):e.jsx("div",{className:"space-y-8 animate-fade-in",children:e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-8",children:[e.jsxs("div",{className:"bg-surface p-6 rounded-lg shadow-md border border-border",children:[e.jsx("h3",{className:"text-xl font-semibold text-text mb-4",children:"Mastery Over Time"}),e.jsx("p",{className:"text-sm text-text-muted mb-4",children:"Average mastery level of reviewed cards per day over the last 90 days of activity."}),e.jsx(Dt,{reviews:l})]}),e.jsxs("div",{className:"bg-surface p-6 rounded-lg shadow-md border border-border",children:[e.jsx("h3",{className:"text-xl font-semibold text-text mb-4",children:"Most Difficult Items"}),e.jsx("p",{className:"text-sm text-text-muted mb-4",children:`Items you've marked "Again" most frequently.`}),d.length>0?e.jsx("ul",{className:"space-y-3",children:d.map(x=>{const f=("questionText"in x?x.questionText:x.front).replace(/<[^>]+>/g,"").trim();return e.jsxs("li",{className:"p-3 bg-background rounded-md border border-border",children:[e.jsx("p",{className:"font-semibold text-sm text-text break-words truncate",title:f,children:f}),e.jsxs("p",{className:"text-xs text-red-500 font-medium",children:['Marked "Again" ',x.failureCount," time",x.failureCount>1?"s":""]})]},x.id)})}):e.jsx("p",{className:"text-sm text-text-muted",children:"No items have been repeatedly marked as difficult. Great job!"})]})]})})},Ge=({icon:t,label:l,value:u,subtext:g,color:r="primary"})=>e.jsxs("div",{className:"bg-surface p-4 rounded-lg shadow-sm border border-border flex items-center gap-4",children:[e.jsx("div",{className:`p-3 rounded-full bg-${r}/10 text-${r}`,children:e.jsx(a,{name:t,className:"w-6 h-6"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-text-muted",children:l}),e.jsx("p",{className:"text-2xl font-bold text-text",children:u}),g&&e.jsx("p",{className:"text-xs text-text-muted mt-0.5",children:g})]})]}),$t=({deck:t,sessionsToResume:l,onUpdateDeck:u,onDeleteDeck:g,onUpdateLastOpened:r,openConfirmModal:i,handleGenerateQuestionsForDeck:d,handleGenerateContentForLearningDeck:x,onCancelAIGeneration:h,onSaveLearningBlock:f,onDeleteLearningBlock:N,onExportDeck:D,onRegenerateQuestion:b,onExpandText:S,onGenerateAI:E})=>{var Le,$e,ze;const[k,I]=n.useState(!1),[p,j]=n.useState(t.name),[m,o]=n.useState(t.description||""),[L,z]=n.useState(t.folderId||""),[C,T]=n.useState(t.icon),[M,R]=n.useState(!1),[B,V]=n.useState(!1),[te,_]=n.useState(!1),[Y,se]=n.useState(!1),[H,s]=n.useState("overview"),[y,O]=n.useState(!1),[P,ae]=n.useState(null),{navigate:Q}=lt(),{addToast:he}=be(),{aiFeaturesEnabled:v}=ue(),{folders:A,aiGenerationStatus:q,learningProgress:ee}=ye(),fe=ot(),U=xe(),G=n.useRef(null),K=(t.type===$.Flashcard?t.cards:(t.type===$.Learning,t.questions))||[],Te=n.useMemo(()=>{const{currentTask:c,queue:F}=q;return(c==null?void 0:c.deckId)===t.id?c:(Array.isArray(F)?F:[]).find(Z=>Z.deckId===t.id)},[q,t.id]),Ee=!!Te,we=n.useMemo(()=>fe.find(c=>!c.deletedAt&&(c.levels||[]).some(F=>{var J;return(J=F.deckIds)==null?void 0:J.includes(t.id)})),[fe,t.id]);n.useEffect(()=>{r(t.id)},[t.id,r]),n.useEffect(()=>{(t.archived||t.deletedAt)&&Q("/")},[t.archived,t.deletedAt,Q]),n.useEffect(()=>{k||(j(t.name),o(t.description||""),z(t.folderId||""),T(t.icon))},[t,k]),n.useEffect(()=>{const c=F=>{G.current&&!G.current.contains(F.target)&&V(!1)};return B&&document.addEventListener("mousedown",c),()=>document.removeEventListener("mousedown",c)},[B]);const Pe=()=>{u({...t,name:p,description:m,folderId:L||null,icon:C}),I(!1)},Ke=()=>{I(!1)},Je=async()=>{if(K.length===0){he("Add some cards or questions first so the AI has context.","info");return}R(!0);try{const c=K.slice(0,20).map(Z=>"front"in Z?Z.front:Z.questionText).join(`
`),{name:F,description:J}=await ct(c,"deck");j(F),o(J),he("Details generated!","success")}catch{he("Failed to generate details.","error")}finally{R(!1)}},Ve=c=>{if(t.type===$.Flashcard&&c.every(F=>"front"in F)){const F=xt(c),J=[...t.cards||[],...F];u({...t,cards:J})}else if((t.type===$.Quiz||t.type===$.Learning)&&c.every(F=>"questionText"in F)){const F=ut(c),Z=[...t.questions||[],...F];u({...t,questions:Z})}},qe=()=>{i({title:"Move Deck to Trash",message:`Are you sure you want to move the deck "${t.name}" to the trash? It will be permanently deleted after 10 days. This will also remove it from any series it belongs to.`,onConfirm:()=>g(t.id)})},We=()=>{t.type!==$.Learning&&i({title:"Upgrade to Learning Deck?",message:`This will use AI to analyze your existing ${K.length} items and generate a structured curriculum (InfoCards) for them. You'll be able to read instructional chapters before taking the quiz.`,confirmText:"Upgrade with AI âœ¨",onConfirm:()=>U==null?void 0:U.handleUpgradeDeckToLearning(t)})},_e=c=>{ae(c),O(!0)},Ye=c=>{const F={...t,infoCards:c};u(F,{silent:!0})},He=c=>{r(t.id),Q(`/decks/${t.id}/cram?sort=${c.sort}&limit=${c.limit}`)},X=K.filter(c=>!c.suspended),Me=K.length-X.length,re=Et(X),de=ee[t.id],je=new Set((de==null?void 0:de.unlockedQuestionIds)||[]),ce=t.type===$.Learning?t.questions.filter(c=>je.has(c.id)&&!c.suspended&&new Date(c.dueDate)<=new Date).length:it(t),ve=l.has(t.id),Oe=((Le=de==null?void 0:de.readInfoCardIds)==null?void 0:Le.length)||0,Xe=(($e=t.infoCards)==null?void 0:$e.length)||0,Re=t.type===$.Learning&&Oe<Xe;t.type===$.Learning&&t.questions.filter(c=>je.has(c.id)).length,t.type===$.Learning&&t.questions.length;const Ze=n.useMemo(()=>X.length===0?0:X.reduce((F,J)=>F+ke(J),0)/X.length,[X]),et=n.useMemo(()=>{const c=new Date;c.setHours(0,0,0,0);const F=Array(7).fill(0),J=[],Z=[];for(let ne=0;ne<7;ne++){const le=new Date(c);le.setDate(c.getDate()+ne),ne===0?J.push("Today"):ne===1?J.push("Tom"):J.push(le.toLocaleDateString("en-US",{weekday:"short"})),Z.push(le.toLocaleDateString("en-US",{month:"short",day:"numeric"}));const nt=le.getTime();K.forEach(De=>{if(De.suspended||t.type===$.Learning&&!je.has(De.id))return;const Fe=new Date(De.dueDate);Fe.setHours(0,0,0,0),Fe.getTime()===nt&&F[ne]++})}return J.map((ne,le)=>({dayLabel:ne,count:F[le],date:Z[le]}))},[K,t.type,je]),tt=n.useMemo(()=>K.length===0?"No Items to Study":t.locked?"Deck is Locked":t.type===$.Quiz?ve?"Resume Quiz":"Start Quiz":t.type===$.Learning?t.learningMode==="mixed"?"Start Course":"Practice":ve?"Resume Study":"Study Cards",[t.type,ve,t.locked,K.length,t.learningMode]),st=[{value:re.new,color:"bg-blue-500",label:"New"},{value:re.learning,color:"bg-orange-500",label:"Learning"},{value:re.young,color:"bg-teal-500",label:"Young"},{value:re.mature,color:"bg-green-500",label:"Mature"}],Ne=c=>`px-4 py-2 text-sm font-medium transition-colors border-b-2 ${H===c?"border-primary text-primary":"border-transparent text-text-muted hover:text-text"}`,Ce=K.length===0&&(t.type!==$.Learning||t.infoCards.length===0),rt=t.type===$.Learning&&t.learningMode!=="mixed";return e.jsxs("div",{className:"max-w-5xl mx-auto animate-fade-in space-y-6 pb-20",children:[e.jsx("div",{className:`bg-surface rounded-xl shadow-sm border border-border ${k?"overflow-hidden":""}`,children:k?e.jsxs("div",{className:"p-6 space-y-4 animate-fade-in bg-background/50",children:[e.jsxs("div",{className:"flex justify-between items-center mb-4",children:[e.jsx("h2",{className:"text-xl font-bold text-text",children:"Edit Deck Details"}),v&&e.jsxs(w,{variant:"ghost",size:"sm",onClick:Je,disabled:M,className:"text-primary hover:text-primary-hover",children:[M?e.jsx(ie,{size:"sm"}):e.jsx(a,{name:"bot",className:"w-4 h-4 mr-2"}),"Auto-generate with AI"]})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"deck-name-edit",className:"block text-sm font-medium text-text-muted mb-1",children:"Deck Name"}),e.jsx("input",{id:"deck-name-edit",type:"text",value:p,onChange:c=>j(c.target.value),className:"w-full p-2 bg-background border border-border rounded-md focus:ring-2 focus:ring-primary focus:outline-none text-xl font-bold",autoFocus:!0})]}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-text-muted mb-1",children:"Deck Icon"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs("select",{value:C||"",onChange:c=>T(c.target.value),className:"w-full p-2 bg-background border border-border rounded-md focus:ring-2 focus:ring-primary focus:outline-none",children:[e.jsx("option",{value:"",children:"Default"}),dt.map(c=>e.jsx("option",{value:c,children:c},c))]}),v&&e.jsxs(w,{variant:"secondary",onClick:()=>U==null?void 0:U.handleSuggestDeckIcon(t),title:"Suggest Icon with AI",children:[e.jsx(a,{name:"zap",className:"w-4 h-4 mr-1"})," Auto"]})]})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"deck-folder",className:"block text-sm font-medium text-text-muted mb-1",children:"Folder"}),e.jsxs("select",{id:"deck-folder",value:L,onChange:c=>z(c.target.value),className:"w-full p-2 bg-background border border-border rounded-md focus:ring-2 focus:ring-primary focus:outline-none",children:[e.jsx("option",{value:"",children:"No folder"}),Object.values(A).map(c=>e.jsx("option",{value:c.id,children:c.name},c.id))]})]})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"deck-desc",className:"block text-sm font-medium text-text-muted mb-1",children:"Description"}),e.jsx("textarea",{id:"deck-desc",value:m,onChange:c=>o(c.target.value),rows:4,className:"w-full p-2 bg-background border border-border rounded-md focus:ring-2 focus:ring-primary focus:outline-none"})]}),e.jsxs("div",{className:"flex justify-end gap-2 pt-2 border-t border-border mt-4",children:[e.jsx(w,{variant:"secondary",onClick:Ke,children:"Cancel"}),e.jsxs(w,{onClick:Pe,children:[e.jsx(a,{name:"save",className:"mr-2"})," Save Changes"]})]})]}):e.jsxs("div",{className:"p-6 md:p-8 flex items-start justify-between gap-4 relative",children:[e.jsx("div",{className:"flex-1 min-w-0 pr-10 sm:pr-0",children:e.jsxs("div",{className:"flex items-start gap-4",children:[e.jsx("div",{className:"p-3 bg-primary/10 rounded-xl flex-shrink-0 hidden sm:block",children:e.jsx(a,{name:t.icon||(t.type==="flashcard"?"laptop":t.type==="learning"?"book-open":"help-circle"),className:"w-8 h-8 text-primary"})}),e.jsxs("div",{className:"min-w-0 flex-1",children:[we?e.jsxs("div",{className:"flex flex-wrap items-center gap-x-2 gap-y-1 mb-2",children:[e.jsxs(oe,{href:`/series/${we.id}`,className:"flex items-center text-xs font-bold text-primary uppercase tracking-wider hover:underline whitespace-nowrap",children:[e.jsx(a,{name:"layers",className:"w-3 h-3 mr-1"}),e.jsx("span",{children:we.name})]}),t.folderId&&A[t.folderId]&&e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"text-text-muted/30 text-xs hidden sm:inline",children:"â€¢"}),e.jsxs("div",{className:"flex items-center text-xs font-medium text-text-muted uppercase tracking-wider whitespace-nowrap",children:[e.jsx(a,{name:"folder",className:"w-3 h-3 mr-1"}),e.jsx("span",{children:A[t.folderId].name})]})]})]}):t.folderId&&e.jsxs("div",{className:"flex items-center text-xs font-semibold text-text-muted mb-2 uppercase tracking-wider",children:[e.jsx(a,{name:"folder",className:"w-3 h-3 mr-1"}),e.jsx("span",{children:((ze=A[t.folderId])==null?void 0:ze.name)||"Uncategorized"})]}),e.jsx("h1",{className:"text-2xl sm:text-3xl font-extrabold text-text break-words leading-tight",children:t.name}),t.description&&e.jsx("div",{className:"mt-2 text-text-muted",children:e.jsx(ft,{html:t.description,className:"prose prose-sm dark:prose-invert max-w-none text-text-muted leading-relaxed"})})]})]})}),e.jsxs("div",{className:"absolute top-6 right-6 md:static md:flex-shrink-0 md:self-start",ref:G,children:[e.jsx(w,{variant:"ghost",onClick:()=>V(!B),className:"p-2 rounded-full hover:bg-border/50",children:e.jsx(a,{name:"more-vertical",className:"w-6 h-6 text-text-muted"})}),B&&e.jsxs("div",{className:"absolute right-0 mt-2 w-56 bg-surface rounded-lg shadow-xl border border-border z-30 py-1 animate-fade-in origin-top-right",children:[e.jsxs("button",{onClick:()=>{I(!0),V(!1)},className:"flex items-center w-full px-4 py-2.5 text-sm text-left text-text hover:bg-primary/5 hover:text-primary transition-colors",children:[e.jsx(a,{name:"edit",className:"w-4 h-4 mr-3"})," Edit Details"]}),v&&!Ce&&e.jsxs(e.Fragment,{children:[e.jsxs("button",{onClick:()=>{U==null||U.handleOpenDeckAnalysis(t),V(!1)},className:"flex items-center w-full px-4 py-2.5 text-sm text-left text-text hover:bg-primary/5 hover:text-primary transition-colors",children:[e.jsx(a,{name:"zap",className:"w-4 h-4 mr-3"})," Analyze & Improve"]}),t.type!==$.Learning&&e.jsxs("button",{onClick:()=>{We(),V(!1)},className:"flex items-center w-full px-4 py-2.5 text-sm text-left text-text hover:bg-primary/5 hover:text-primary transition-colors",children:[e.jsx(a,{name:"layers",className:"w-4 h-4 mr-3 text-purple-500"})," Upgrade to Course âœ¨"]})]}),e.jsxs(oe,{href:`/decks/${t.id}/print`,className:"flex items-center w-full px-4 py-2.5 text-sm text-left text-text hover:bg-primary/5 hover:text-primary transition-colors",children:[e.jsx(a,{name:"printer",className:"w-4 h-4 mr-3"})," Print / PDF"]}),e.jsxs("button",{onClick:()=>{D(t),V(!1)},className:"flex items-center w-full px-4 py-2.5 text-sm text-left text-text hover:bg-primary/5 hover:text-primary transition-colors",children:[e.jsx(a,{name:"download",className:"w-4 h-4 mr-3"})," Export JSON"]}),t.type==="flashcard"&&e.jsxs("button",{onClick:()=>{U==null||U.handleExportDeckCSV(t),V(!1)},className:"flex items-center w-full px-4 py-2.5 text-sm text-left text-text hover:bg-primary/5 hover:text-primary transition-colors",children:[e.jsx(a,{name:"file-text",className:"w-4 h-4 mr-3"})," Export CSV"]}),e.jsx("div",{className:"my-1 border-t border-border"}),e.jsxs("button",{onClick:()=>{u({...t,archived:!0},{toastMessage:"Deck archived."}),V(!1)},className:"flex items-center w-full px-4 py-2.5 text-sm text-left text-text hover:bg-primary/5 hover:text-primary transition-colors",children:[e.jsx(a,{name:"archive",className:"w-4 h-4 mr-3"})," Archive"]}),e.jsxs("button",{onClick:()=>{qe(),V(!1)},className:"flex items-center w-full px-4 py-2.5 text-sm text-left text-red-600 dark:text-red-400 hover:bg-red-50 dark:hover:bg-red-900/20 transition-colors",children:[e.jsx(a,{name:"trash-2",className:"w-4 h-4 mr-3"})," Move to Trash"]})]})]})]})}),e.jsxs("div",{className:"flex space-x-1 border-b border-border overflow-x-auto no-scrollbar",children:[e.jsx("button",{className:Ne("overview"),onClick:()=>s("overview"),children:"Overview"}),e.jsxs("button",{className:Ne("items"),onClick:()=>s("items"),children:["Items (",K.length,")"]}),e.jsx("button",{className:Ne("stats"),onClick:()=>s("stats"),children:"Statistics"})]}),e.jsxs("div",{className:"min-h-[300px]",children:[H==="overview"&&e.jsxs("div",{className:"space-y-6 sm:space-y-8 animate-fade-in",children:[e.jsxs("div",{className:"flex flex-col md:flex-row gap-4 items-center justify-between p-6 bg-primary/5 rounded-xl border border-primary/10",children:[e.jsxs("div",{className:"flex-1 text-center md:text-left",children:[e.jsx("h3",{className:"text-lg font-bold text-text mb-1",children:ce>0?`You have ${ce} item${ce!==1?"s":""} due today.`:"All caught up for now!"}),e.jsx("p",{className:"text-sm text-text-muted",children:ce>0?"Keep up your streak and review now.":"Review ahead or add new cards."})]}),e.jsxs("div",{className:"flex flex-wrap gap-3 justify-center md:justify-end w-full md:w-auto",children:[Ce&&v?Ee?e.jsxs("div",{className:"flex items-center justify-center py-3 px-6 bg-surface rounded-md border border-border w-full md:w-auto",children:[e.jsx(ie,{size:"sm"}),e.jsx("span",{className:"ml-3 text-text-muted text-sm font-semibold",children:Te.statusText||"Generating..."})]}):e.jsxs(w,{variant:"primary",size:"lg",onClick:()=>{t.type===$.Quiz?d(t):t.type===$.Learning?x(t):E(t)},className:"w-full md:w-auto",children:[e.jsx(a,{name:"zap",className:"w-5 h-5 mr-2"}),"Generate Content"]}):Ce&&!v?e.jsxs(w,{variant:"primary",size:"lg",onClick:()=>s("items"),className:"w-full md:w-auto",children:[e.jsx(a,{name:"plus",className:"w-5 h-5 mr-2"}),"Create First Item"]}):e.jsxs(e.Fragment,{children:[rt&&e.jsxs(oe,{href:`/decks/${t.id}/read`,passAs:w,variant:"secondary",size:"lg",className:"font-semibold flex-1 md:flex-none",children:[e.jsx(a,{name:"book-open",className:"w-5 h-5 mr-2"}),Oe===0?"Read":Re?"Continue Reading":"Review"]}),e.jsxs(oe,{href:`/decks/${t.id}/study`,passAs:w,variant:t.type!==$.Learning||!Re||t.learningMode==="mixed"?"primary":"secondary",size:"lg",onClick:()=>r(t.id),disabled:ce===0&&!ve||!!t.locked||K.length===0,className:"font-bold px-8 shadow-md flex-1 md:flex-none",children:[e.jsx(a,{name:"refresh-ccw",className:"w-5 h-5 mr-2"})," ",tt]}),e.jsx(w,{variant:"secondary",size:"lg",onClick:()=>se(!0),disabled:K.length===0,title:"Review without affecting stats",className:"w-full md:w-auto",children:"Cram"})]}),e.jsxs("div",{className:"flex gap-2 w-full sm:w-auto justify-center",children:[t.type===$.Flashcard&&X.length>0&&e.jsx(oe,{href:`/decks/${t.id}/study-reversed`,passAs:w,variant:"ghost",size:"lg",onClick:()=>r(t.id),title:"Study Back-to-Front",className:"flex-1 sm:flex-none",children:e.jsx(a,{name:"repeat",className:"w-5 h-5"})}),t.type===$.Quiz&&X.length>0&&e.jsx(oe,{href:`/decks/${t.id}/study-flip`,passAs:w,variant:"ghost",size:"lg",onClick:()=>r(t.id),title:"Review as Flashcards",className:"flex-1 sm:flex-none",children:e.jsx(a,{name:"columns",className:"w-5 h-5"})})]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-4",children:[e.jsx(Ge,{icon:"layers",label:"Total Items",value:X.length,color:"blue"}),e.jsx(Ge,{icon:"zap",label:"Due Today",value:ce,subtext:Me>0?`${Me} suspended`:void 0,color:"orange"}),e.jsx("div",{className:"sm:col-span-2 bg-surface p-4 rounded-lg shadow-sm border border-border flex flex-col justify-center",children:e.jsx(Ie,{level:Ze})})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6 sm:gap-8",children:[e.jsxs("div",{className:"bg-surface p-6 rounded-lg shadow-md border border-border flex flex-col justify-center",children:[e.jsxs("h4",{className:"text-sm font-semibold text-text mb-4 flex items-center gap-2",children:[e.jsx(a,{name:"trending-up",className:"w-4 h-4"})," Retention Breakdown"]}),e.jsx(Nt,{data:st,total:X.length}),e.jsxs("div",{className:"grid grid-cols-2 gap-4 mt-6",children:[e.jsxs("div",{className:"flex items-center gap-2 text-sm text-text-muted",children:[e.jsx("div",{className:"w-3 h-3 rounded-full bg-blue-500"}),e.jsxs("span",{children:["New: ",e.jsx("strong",{children:re.new})]})]}),e.jsxs("div",{className:"flex items-center gap-2 text-sm text-text-muted",children:[e.jsx("div",{className:"w-3 h-3 rounded-full bg-orange-500"}),e.jsxs("span",{children:["Learning: ",e.jsx("strong",{children:re.learning})]})]}),e.jsxs("div",{className:"flex items-center gap-2 text-sm text-text-muted",children:[e.jsx("div",{className:"w-3 h-3 rounded-full bg-teal-500"}),e.jsxs("span",{children:["Young: ",e.jsx("strong",{children:re.young})]})]}),e.jsxs("div",{className:"flex items-center gap-2 text-sm text-text-muted",children:[e.jsx("div",{className:"w-3 h-3 rounded-full bg-green-500"}),e.jsxs("span",{children:["Mature: ",e.jsx("strong",{children:re.mature})]})]})]})]}),e.jsx("div",{className:"bg-surface p-6 rounded-lg shadow-md border border-border",children:e.jsx(Ct,{data:et})})]})]}),H==="items"&&e.jsx("div",{className:"bg-surface rounded-lg shadow-md border border-border animate-fade-in",children:t.type===$.Flashcard?e.jsx(bt,{cards:t.cards||[],onCardsChange:c=>u({...t,cards:c},{silent:!0}),onAddCard:c=>u({...t,cards:[...t.cards||[],{...c,id:crypto.randomUUID(),dueDate:new Date().toISOString(),interval:0,easeFactor:Se}]},{silent:!0}),onBulkAdd:()=>_(!0),deckName:t.name}):t.type===$.Quiz?e.jsx(yt,{deck:t,questions:t.questions||[],onQuestionsChange:c=>u({...t,questions:c},{silent:!0}),onAddQuestion:c=>{const F={questionType:c.questionType,questionText:c.questionText,options:c.options,correctAnswerId:c.correctAnswerId,detailedExplanation:c.detailedExplanation,tags:c.tags,infoCardIds:c.infoCardIds,suspended:c.suspended,id:crypto.randomUUID(),dueDate:new Date().toISOString(),interval:0,easeFactor:Se,lapses:0,masteryLevel:0};u({...t,questions:[...t.questions||[],F]},{silent:!0})},onBulkAdd:()=>_(!0),onGenerateAI:()=>d(t),isGeneratingAI:Ee,onRegenerateQuestion:b,onAutoTag:()=>U==null?void 0:U.handleAutoTagQuestions(t),deckName:t.name}):t.type===$.Learning?e.jsx(kt,{deck:t,onSaveBlock:c=>f(t.id,c),onDeleteBlock:c=>N(t.id,c),onBlockClick:_e,onReorderBlocks:Ye}):e.jsx("div",{className:"p-6 text-center text-text-muted",children:e.jsx("p",{children:"Unsupported deck type."})})}),H==="stats"&&e.jsx("div",{className:"animate-fade-in",children:e.jsx(Mt,{deck:t})})]}),te&&e.jsx(wt,{isOpen:te,onClose:()=>_(!1),onAddItems:Ve,deckType:t.type}),y&&e.jsx(It,{isOpen:y,onClose:()=>O(!1),block:P,deckName:t.name,onExpandText:S}),Y&&e.jsx(Tt,{isOpen:Y,onClose:()=>se(!1),onStart:He,totalItems:K.length})]})};export{$t as default};
