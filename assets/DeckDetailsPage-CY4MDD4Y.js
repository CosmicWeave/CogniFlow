import{j as e,B as g,I as i,r as n,a as he,c as me,i as De,u as je,S as ne,g as Se,C as ze,s as xe,e as $,L as re,x as Ze,y as Ce,D as Oe,z as W,E as et,d as tt,F as st,G as at,H as rt,R as nt,J as lt,K as it,M as ot}from"./index-aMUeowKE.js";import{M as ke}from"./MasteryBar-Dwb4azIA.js";import{T as dt}from"./TruncatedText-D7rtMuLw.js";const ue=({targetId:t,value:l,onChange:x,className:b=""})=>{const a=(c,o)=>{var h;const f=document.getElementById(t);if(!f)return;const u=f.selectionStart,p=f.selectionEnd,N=l.substring(u,p),C=l.substring(0,u),y=l.substring(p);let I="",M=0;if(I=`${C}<${c}>${y}`,M=u+c.length+2,c==="b"||c==="i"||c==="u"||c==="code")I=`${C}<${c}>${N}</${c}>${y}`,N.length===0?M=u+c.length+2:M=u+c.length+2+N.length+c.length+3;else if(c==="br")I=`${C}<br>
${y}`,M=u+5;else if(c==="ul"){const j=N.split(`
`).map(r=>`  <li>${r}</li>`).join(`
`),s=j||"  <li></li>";I=`${C}<ul>
${s}
</ul>${y}`,M=j?u+s.length+11:u+9}const w=(h=Object.getOwnPropertyDescriptor(window.HTMLTextAreaElement.prototype,"value"))==null?void 0:h.set;w&&w.call(f,I);const T=new Event("input",{bubbles:!0});f.dispatchEvent(T),x(I),setTimeout(()=>{f.focus(),f.setSelectionRange(M,M)},0)};return e.jsxs("div",{className:`flex flex-wrap items-center gap-1 p-1 bg-surface border-b border-border rounded-t-md ${b}`,children:[e.jsx(g,{type:"button",variant:"ghost",size:"sm",onClick:()=>a("b"),title:"Bold",className:"px-2 h-8 min-w-[2rem] font-bold",children:"B"}),e.jsx(g,{type:"button",variant:"ghost",size:"sm",onClick:()=>a("i"),title:"Italic",className:"px-2 h-8 min-w-[2rem] italic",children:"I"}),e.jsx(g,{type:"button",variant:"ghost",size:"sm",onClick:()=>a("u"),title:"Underline",className:"px-2 h-8 min-w-[2rem] underline",children:"U"}),e.jsx("div",{className:"w-px h-4 bg-border mx-1"}),e.jsx(g,{type:"button",variant:"ghost",size:"sm",onClick:()=>a("code"),title:"Code",className:"px-2 h-8 min-w-[2rem] font-mono text-xs",children:"</>"}),e.jsx(g,{type:"button",variant:"ghost",size:"sm",onClick:()=>a("br"),title:"Line Break",className:"px-2 h-8 min-w-[2rem] text-xs",children:"BR"}),e.jsx("div",{className:"w-px h-4 bg-border mx-1"}),e.jsx(g,{type:"button",variant:"ghost",size:"sm",onClick:()=>a("ul"),title:"List",className:"px-2 h-8 min-w-[2rem]",children:e.jsx(i,{name:"list",className:"w-4 h-4"})})]})},ct=({card:t,onClose:l,onSave:x,deckName:b})=>{const[a,c]=n.useState(""),[o,f]=n.useState(""),[u,p]=n.useState(""),[N,C]=n.useState(!1),{addToast:y}=he(),I=n.useRef(null);me(I,!0);const M=De(),{aiFeaturesEnabled:w}=je();n.useEffect(()=>{t&&(c(t.front),f(t.back),p(t.css||""))},[t]);const T=s=>{if(s.preventDefault(),!a.trim()||!o.trim()){y("Both front and back fields are required.","error");return}x({id:(t==null?void 0:t.id)||"",front:a.trim(),back:o.trim(),css:u.trim()})},h=s=>{if(s.key==="Tab"){s.preventDefault();const r=s.target,k=r.selectionStart,D=r.selectionEnd;r.value=r.value.substring(0,k)+"	"+r.value.substring(D),r.selectionStart=r.selectionEnd=k+1;const L=r.id;L==="card-front"&&c(r.value),L==="card-back"&&f(r.value),L==="card-css"&&p(r.value)}},j=async()=>{if(!a.trim()||!o.trim()){y("Please fill in both front and back fields first.","error");return}C(!0);try{const s=await M.handleGenerateCardExamples(a,o,b);s&&(f(r=>`${r}<br><br><strong>Examples:</strong><br>${s}`),y("Examples added to the back of the card.","success"))}catch{}finally{C(!1)}};return e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-75 flex items-center justify-center z-[60] p-4",children:e.jsx("div",{ref:I,className:"bg-surface rounded-lg shadow-xl w-full max-w-2xl transform transition-all relative",children:e.jsxs("form",{onSubmit:T,children:[e.jsxs("div",{className:"flex justify-between items-center p-4 border-b border-border",children:[e.jsx("h2",{className:"text-xl font-bold",children:t?"Edit Card":"Add New Card"}),e.jsx(g,{type:"button",variant:"ghost",onClick:l,className:"p-1 h-auto",children:e.jsx(i,{name:"x"})})]}),e.jsxs("div",{className:"p-6 space-y-4 max-h-[70vh] overflow-y-auto",children:[e.jsxs("div",{children:[e.jsx("label",{htmlFor:"card-front",className:"block text-sm font-medium text-text-muted mb-1",children:"Front (Supports HTML)"}),e.jsxs("div",{className:"border border-border rounded-md focus-within:ring-2 focus-within:ring-primary overflow-hidden",children:[e.jsx(ue,{targetId:"card-front",value:a,onChange:c}),e.jsx("textarea",{id:"card-front",value:a,onChange:s=>c(s.target.value),onKeyDown:h,rows:5,className:"w-full p-2 bg-background focus:outline-none font-mono text-sm block"})]})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex justify-between items-end mb-1",children:[e.jsx("label",{htmlFor:"card-back",className:"block text-sm font-medium text-text-muted",children:"Back (Supports HTML)"}),w&&e.jsxs(g,{type:"button",variant:"ghost",size:"sm",onClick:j,disabled:N,className:"text-primary hover:text-primary-hover",title:"Use AI to generate real-world examples",children:[N?e.jsx(ne,{size:"sm"}):e.jsx(i,{name:"zap",className:"w-3 h-3 mr-1"}),N?"Generating...":"Generate Examples"]})]}),e.jsxs("div",{className:"border border-border rounded-md focus-within:ring-2 focus-within:ring-primary overflow-hidden",children:[e.jsx(ue,{targetId:"card-back",value:o,onChange:f}),e.jsx("textarea",{id:"card-back",value:o,onChange:s=>f(s.target.value),onKeyDown:h,rows:5,className:"w-full p-2 bg-background focus:outline-none font-mono text-sm block"})]})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"card-css",className:"block text-sm font-medium text-text-muted mb-1",children:"Custom CSS (Optional)"}),e.jsx("textarea",{id:"card-css",value:u,onChange:s=>p(s.target.value),onKeyDown:h,rows:5,className:"w-full p-2 bg-background border border-border rounded-md focus:ring-2 focus:ring-primary focus:outline-none font-mono text-sm",placeholder:".card { font-family: 'Arial'; }"})]})]}),e.jsxs("div",{className:"flex justify-end p-4 bg-background/50 border-t border-border",children:[e.jsx(g,{type:"button",variant:"secondary",onClick:l,className:"mr-2",children:"Cancel"}),e.jsx(g,{type:"submit",variant:"primary",children:t?"Save Changes":"Add Card"})]})]})})})},Le=50,mt=t=>{const l=new Date;l.setHours(0,0,0,0);const x=new Date(t);x.setHours(0,0,0,0);const b=x.getTime()-l.getTime(),a=Math.round(b/(1e3*60*60*24)),c=a<=0;let o;return a<0?o="Due":a===0?o="Due today":a===1?o="Due tomorrow":o=`Due in ${a} days`,{text:o,isDue:c}},xt=({cards:t,onCardsChange:l,onAddCard:x,onBulkAdd:b,deckName:a})=>{const[c,o]=n.useState(null),[f,u]=n.useState(!1),[p,N]=n.useState(null),[C,y]=n.useState(!0),[I,M]=n.useState(Le),[w,T]=n.useState(null),h=n.useRef(null),j=n.useMemo(()=>t.slice(0,I),[t,I]),s=()=>{M(S=>Math.min(S+Le,t.length))},r=(S,A)=>{o(S),A&&(h.current=A.currentTarget),u(!0)},k=()=>{var S;u(!1),(S=h.current)==null||S.focus(),o(null)},D=(S,A)=>{N(S),A&&(h.current=A.currentTarget)},L=()=>{p&&l(t.filter(S=>S.id!==p.id)),N(null)},H=S=>{c?l(t.map(A=>A.id===S.id?{...A,...S}:A)):x(S),k()},z=S=>{l(t.map(A=>A.id===S?{...A,suspended:!1}:A))},U=(S,A)=>{T(S),A.dataTransfer.effectAllowed="move"},Y=(S,A)=>{A.preventDefault(),A.dataTransfer.dropEffect="move"},_=(S,A)=>{if(A.preventDefault(),w===null||w===S)return;const P=[...t],[J]=P.splice(w,1);P.splice(S,0,J),l(P),T(null)};return e.jsxs("div",{children:[e.jsx("div",{className:"border-b border-border",children:e.jsxs("button",{onClick:()=>y(!C),className:"w-full flex justify-between items-center text-left p-6","aria-expanded":C,"aria-controls":"card-list-content",children:[e.jsxs("h3",{className:"text-xl font-semibold text-text",children:["Cards (",t.length,")"]}),e.jsx(i,{name:"chevron-down",className:`w-6 h-6 transition-transform duration-300 ${C?"":"-rotate-90"} text-text-muted`})]})}),C&&e.jsxs("div",{id:"card-list-content",className:"animate-fade-in",children:[e.jsx("div",{className:"p-6",children:t.length>0?e.jsxs(e.Fragment,{children:[e.jsx("ul",{className:"space-y-4",children:j.map((S,A)=>{const{text:P,isDue:J}=mt(S.dueDate),ee=w===A;return e.jsxs("li",{className:`p-4 rounded-lg flex items-start justify-between transition-all border border-transparent ${S.suspended?"bg-yellow-500/10 opacity-70":"bg-background"} ${ee?"opacity-50 ring-2 ring-primary":"hover:border-border"}`,draggable:!0,onDragStart:m=>U(A,m),onDragOver:m=>Y(A,m),onDrop:m=>_(A,m),children:[e.jsx("div",{className:"mr-3 mt-1 cursor-grab active:cursor-grabbing text-text-muted hover:text-text",children:e.jsx(i,{name:"grip-vertical",className:"w-5 h-5"})}),e.jsxs("div",{className:"flex-1 min-w-0 mr-4",children:[e.jsxs("p",{className:"text-sm font-medium text-text truncate",children:[e.jsx("strong",{children:"Front:"})," ",S.front.replace(/<[^>]+>/g,"")]}),e.jsxs("p",{className:"text-sm text-text-muted truncate",children:[e.jsx("strong",{children:"Back:"})," ",S.back.replace(/<[^>]+>/g,"")]}),e.jsxs("div",{className:"mt-3 space-y-2",children:[e.jsx(ke,{level:Se(S)}),e.jsx("div",{className:"flex items-center gap-4 text-xs text-text-muted",children:e.jsxs("span",{className:`font-semibold ${J?"text-primary":""}`,children:[e.jsx(i,{name:"zap",className:"w-3 h-3 inline-block mr-1"}),P]})})]})]}),e.jsxs("div",{className:"flex-shrink-0 flex items-center gap-2",children:[S.suspended?e.jsx(g,{variant:"ghost",className:"p-2 h-auto text-yellow-600 dark:text-yellow-400",onClick:()=>z(S.id),title:"Unsuspend this card",children:e.jsx(i,{name:"eye",className:"w-4 h-4"})}):e.jsx(g,{variant:"ghost",className:"p-2 h-auto",onClick:m=>r(S,m),title:"Edit this card",children:e.jsx(i,{name:"edit",className:"w-4 h-4"})}),e.jsx(g,{variant:"ghost",className:"p-2 h-auto text-text-muted hover:text-red-500",onClick:m=>D(S,m),title:"Delete this card",children:e.jsx(i,{name:"trash-2",className:"w-4 h-4"})})]})]},S.id)})}),I<t.length&&e.jsx("div",{className:"mt-4 text-center",children:e.jsxs(g,{variant:"secondary",onClick:s,children:["Show More (",t.length-I," remaining)"]})})]}):e.jsxs("div",{className:"flex flex-col items-center justify-center p-8 border-2 border-dashed border-border rounded-lg bg-background/50",children:[e.jsx(i,{name:"laptop",className:"w-12 h-12 text-text-muted mb-3"}),e.jsx("p",{className:"text-text font-medium mb-1",children:"No cards yet"}),e.jsx("p",{className:"text-sm text-text-muted text-center max-w-xs",children:"Start building your deck by adding your first flashcard."}),e.jsx("div",{className:"mt-4",children:e.jsxs(g,{variant:"primary",onClick:S=>r(null,S),children:[e.jsx(i,{name:"plus",className:"w-4 h-4 mr-2"}),"Create First Card"]})})]})}),t.length>0&&e.jsxs("div",{className:"px-6 py-4 border-t border-border flex flex-wrap gap-2",children:[e.jsxs(g,{variant:"secondary",onClick:S=>r(null,S),className:"flex-grow sm:flex-grow-0",children:[e.jsx(i,{name:"plus",className:"w-5 h-5 mr-2"}),"Add New Card"]}),e.jsxs(g,{variant:"ghost",onClick:b,className:"flex-grow sm:flex-grow-0",children:[e.jsx(i,{name:"code",className:"w-5 h-5 mr-2"}),"Bulk Add via JSON"]})]})]}),f&&e.jsx(ct,{card:c,onClose:k,onSave:H,deckName:a}),p&&e.jsx(ze,{isOpen:!!p,onClose:()=>N(null),onConfirm:L,title:"Delete Card",message:"Are you sure you want to delete this card? This action cannot be undone."})]})},ut=({question:t,onClose:l,onSave:x,deckName:b})=>{const[a,c]=n.useState(""),[o,f]=n.useState(""),[u,p]=n.useState([]),[N,C]=n.useState(""),[y,I]=n.useState([]),[M,w]=n.useState(""),[T,h]=n.useState(new Set),[j,s]=n.useState(!1),{addToast:r}=he(),k=n.useRef(null);me(k,!0);const D=De(),{aiFeaturesEnabled:L}=je();n.useEffect(()=>{if(t)c(t.questionText),f(t.detailedExplanation),p((t.options||[]).map(m=>({...m}))),C(t.correctAnswerId),I(t.tags||[]);else{const m=[{id:crypto.randomUUID(),text:""},{id:crypto.randomUUID(),text:""}];p(m),I([])}},[t]);const H=(m,R,O)=>{p(u.map(V=>V.id===m?{...V,[R]:O}:V))},z=m=>{h(R=>{const O=new Set(R);return O.has(m)?O.delete(m):O.add(m),O})},U=()=>{p([...u,{id:crypto.randomUUID(),text:""}])},Y=m=>{if(u.length<=2){r("A question must have at least two options.","error");return}p(u.filter(R=>R.id!==m)),N===m&&C("")},_=m=>{w(m.target.value)},S=m=>{if(m.key===","||m.key==="Enter"){m.preventDefault();const R=M.trim();R&&!y.includes(R)&&I([...y,R]),w("")}else m.key==="Backspace"&&!M&&y.length>0&&I(y.slice(0,-1))},A=m=>{I(y.filter(R=>R!==m))},P=(m,R)=>{if(m.key==="Tab"){m.preventDefault();const O=m.target,V=O.selectionStart,fe=O.selectionEnd,Z=O.value.substring(0,V)+"	"+O.value.substring(fe);O.value=Z,R(Z),O.selectionStart=O.selectionEnd=V+1}},J=async()=>{if(!a.trim()||!N){r("Please enter a question and select a correct answer first.","error");return}const m=u.find(R=>R.id===N);if(!m||!m.text.trim()){r("The correct answer text must be set.","error");return}s(!0);try{const R={id:"temp",questionText:a,options:u,correctAnswerId:N,detailedExplanation:o,questionType:"multipleChoice",dueDate:"",interval:0,easeFactor:0,lapses:0},O=await D.handleHardenDistractors(R,b);O&&(p(O),r("Distractors updated!","success"))}catch{}finally{s(!1)}},ee=m=>{if(m.preventDefault(),!a.trim()){r("Question text is required.","error");return}if(u.some(R=>!R.text.trim())){r("All options must have text.","error");return}if(!N){r("You must select a correct answer.","error");return}x({id:t==null?void 0:t.id,questionText:a.trim(),detailedExplanation:o.trim(),options:u,correctAnswerId:N,tags:y})};return e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-75 flex items-center justify-center z-[60] p-4",children:e.jsx("div",{ref:k,className:"bg-surface rounded-lg shadow-xl w-full max-w-3xl transform transition-all relative max-h-[90vh] flex flex-col",children:e.jsxs("form",{onSubmit:ee,className:"flex flex-col h-full",children:[e.jsxs("div",{className:"flex-shrink-0 flex justify-between items-center p-4 border-b border-border",children:[e.jsx("h2",{className:"text-xl font-bold",children:t?"Edit Question":"Add New Question"}),e.jsx(g,{type:"button",variant:"ghost",onClick:l,className:"p-1 h-auto",children:e.jsx(i,{name:"x"})})]}),e.jsxs("div",{className:"p-6 space-y-4 overflow-y-auto",children:[e.jsxs("div",{children:[e.jsx("label",{htmlFor:"question-text",className:"block text-sm font-medium text-text-muted mb-1",children:"Question Text (Supports HTML)"}),e.jsxs("div",{className:"border border-border rounded-md focus-within:ring-2 focus-within:ring-primary overflow-hidden",children:[e.jsx(ue,{targetId:"question-text",value:a,onChange:c}),e.jsx("textarea",{id:"question-text",value:a,onChange:m=>c(m.target.value),onKeyDown:m=>P(m,c),rows:4,className:"w-full p-2 bg-background focus:outline-none font-mono text-sm block",placeholder:"What is the capital of France?"})]})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex justify-between items-end mb-1",children:[e.jsx("label",{className:"block text-sm font-medium text-text-muted",children:"Options"}),L&&e.jsxs(g,{type:"button",variant:"ghost",size:"sm",onClick:J,disabled:j,className:"text-primary hover:text-primary-hover",title:"Use AI to generate more challenging incorrect answers",children:[j?e.jsx(ne,{size:"sm"}):e.jsx(i,{name:"zap",className:"w-3 h-3 mr-1"}),j?"Hardening...":"Harden Distractors"]})]}),e.jsx("div",{className:"space-y-2",children:u.map((m,R)=>e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"radio",name:"correct-answer",checked:N===m.id,onChange:()=>C(m.id),className:"h-5 w-5 text-primary bg-border/50 border-border focus:ring-primary","aria-label":`Set option ${R+1} as correct`}),e.jsx("input",{type:"text",value:m.text,onChange:O=>H(m.id,"text",O.target.value),className:"flex-grow p-2 bg-background border border-border rounded-md focus:ring-2 focus:ring-primary focus:outline-none",placeholder:`Option ${R+1}`}),e.jsx(g,{type:"button",variant:"ghost",onClick:()=>z(m.id),className:`p-2 h-auto ${T.has(m.id)?"bg-primary/10 text-primary":"text-text-muted"}`,title:"Add/Edit option explanation",children:e.jsx(i,{name:"info",className:"w-4 h-4"})}),e.jsx(g,{type:"button",variant:"ghost",onClick:()=>Y(m.id),className:"p-2 h-auto text-text-muted hover:text-red-500",children:e.jsx(i,{name:"x",className:"w-4 h-4"})})]}),T.has(m.id)&&e.jsx("div",{className:"pl-7 mt-1 animate-fade-in",children:e.jsx("input",{type:"text",value:m.explanation||"",onChange:O=>H(m.id,"explanation",O.target.value),className:"w-full p-1 bg-background border border-border rounded-md focus:ring-2 focus:ring-primary focus:outline-none text-sm",placeholder:"Brief explanation for this option..."})})]},m.id))}),e.jsxs(g,{type:"button",variant:"ghost",onClick:U,size:"sm",className:"mt-2",children:[e.jsx(i,{name:"plus",className:"w-4 h-4 mr-2"}),"Add Option"]})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"detailed-explanation",className:"block text-sm font-medium text-text-muted mb-1",children:"Detailed Explanation (Supports HTML)"}),e.jsxs("div",{className:"border border-border rounded-md focus-within:ring-2 focus-within:ring-primary overflow-hidden",children:[e.jsx(ue,{targetId:"detailed-explanation",value:o,onChange:f}),e.jsx("textarea",{id:"detailed-explanation",value:o,onChange:m=>f(m.target.value),onKeyDown:m=>P(m,f),rows:4,className:"w-full p-2 bg-background focus:outline-none font-mono text-sm block",placeholder:"Explain why the correct answer is right..."})]})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"tags-input",className:"block text-sm font-medium text-text-muted mb-1",children:"Tags"}),e.jsxs("div",{className:"flex flex-wrap items-center gap-2 p-2 bg-background border border-border rounded-md",children:[y.map((m,R)=>e.jsxs("span",{className:"flex items-center gap-1 bg-primary/10 text-primary text-sm px-2 py-1 rounded-md",children:[m,e.jsx("button",{type:"button",onClick:()=>A(m),className:"text-primary hover:text-primary-hover",children:e.jsx(i,{name:"x",className:"w-3 h-3"})})]},R)),e.jsx("input",{id:"tags-input",type:"text",value:M,onChange:_,onKeyDown:S,className:"flex-grow bg-transparent focus:outline-none",placeholder:y.length===0?"Add tags (comma or enter)...":""})]})]})]}),e.jsxs("div",{className:"flex-shrink-0 flex justify-end p-4 bg-background/50 border-t border-border",children:[e.jsx(g,{type:"button",variant:"secondary",onClick:l,className:"mr-2",children:"Cancel"}),e.jsx(g,{type:"submit",variant:"primary",children:t?"Save Changes":"Add Question"})]})]})})})},ht=t=>{const l=new Date;l.setHours(0,0,0,0);const x=new Date(t);x.setHours(0,0,0,0);const b=x.getTime()-l.getTime(),a=Math.round(b/(1e3*60*60*24)),c=a<=0;let o;return a<0?o="Due":a===0?o="Due today":a===1?o="Due tomorrow":o=`Due in ${a} days`,{text:o,isDue:c}},ft=({deck:t,questions:l,onQuestionsChange:x,onAddQuestion:b,onBulkAdd:a,onGenerateAI:c,isGeneratingAI:o,onRegenerateQuestion:f,onAutoTag:u,deckName:p})=>{const[N,C]=n.useState(null),[y,I]=n.useState(!1),[M,w]=n.useState(null),[T,h]=n.useState(!0),[j,s]=n.useState(null),[r,k]=n.useState(null),[D,L]=n.useState(null),[H,z]=n.useState(!1),U=n.useRef(null),Y=n.useRef(null),{aiFeaturesEnabled:_}=je();n.useEffect(()=>{const v=E=>{Y.current&&!Y.current.contains(E.target)&&s(null)};return j&&document.addEventListener("mousedown",v),()=>{document.removeEventListener("mousedown",v)}},[j]);const S=(v,E)=>{C(v),E&&(U.current=E.currentTarget),I(!0)},A=()=>{var v;I(!1),(v=U.current)==null||v.focus(),C(null)},P=(v,E)=>{w(v),E&&(U.current=E.currentTarget)},J=()=>{M&&x(l.filter(v=>v.id!==M.id)),w(null)},ee=v=>{if(N&&v.id)x(l.map(E=>E.id===v.id?{...E,...v}:E));else{const{id:E,...q}=v,Q={...q,questionType:"multipleChoice",suspended:!1};b(Q)}A()},m=v=>{x(l.map(E=>E.id===v?{...E,suspended:!0}:E)),s(null)},R=v=>{x(l.map(E=>E.id===v?{...E,suspended:!1}:E)),s(null)},O=async v=>{s(null),k(v.id);try{await f(t,v)}finally{k(null)}},V=async()=>{if(u){z(!0);try{await u()}finally{z(!1)}}},fe=(v,E)=>{L(v),E.dataTransfer.effectAllowed="move"},Z=(v,E)=>{E.preventDefault(),E.dataTransfer.dropEffect="move"},le=(v,E)=>{if(E.preventDefault(),D===null||D===v)return;const q=[...l],[Q]=q.splice(D,1);q.splice(v,0,Q),x(q),L(null)};return e.jsxs("div",{children:[e.jsx("div",{className:"border-b border-border",children:e.jsxs("button",{onClick:()=>h(!T),className:"w-full flex justify-between items-center text-left p-6","aria-expanded":T,"aria-controls":"question-list-content",children:[e.jsx("h3",{className:"text-xl font-semibold text-text",children:"Questions"}),e.jsx(i,{name:"chevron-down",className:`w-6 h-6 transition-transform duration-300 ${T?"":"-rotate-90"} text-text-muted`})]})}),T&&e.jsxs("div",{id:"question-list-content",className:"animate-fade-in",children:[e.jsx("div",{className:"p-6",children:l.length>0?e.jsx("ul",{className:"space-y-4",children:l.map((v,E)=>{const{text:q,isDue:Q}=ht(v.dueDate),ie=xe(v.questionText),K=D===E;return e.jsxs("li",{className:`p-4 rounded-lg flex items-start justify-between transition-all border border-transparent ${v.suspended?"bg-yellow-500/10 opacity-70":"bg-background"} ${K?"opacity-50 ring-2 ring-primary":"hover:border-border"}`,draggable:!0,onDragStart:F=>fe(E,F),onDragOver:F=>Z(E,F),onDrop:F=>le(E,F),children:[e.jsx("div",{className:"mr-3 mt-1 cursor-grab active:cursor-grabbing text-text-muted hover:text-text",children:e.jsx(i,{name:"grip-vertical",className:"w-5 h-5"})}),e.jsxs("div",{className:"flex-1 min-w-0 mr-4",children:[e.jsx("p",{className:"text-base font-medium text-text break-words truncate",title:ie,children:ie}),e.jsxs("div",{className:"mt-3 space-y-2",children:[e.jsx(ke,{level:Se(v)}),e.jsxs("div",{className:"flex items-center gap-4 text-xs text-text-muted",children:[e.jsxs("span",{className:`font-semibold ${Q?"text-primary":""}`,children:[e.jsx(i,{name:"zap",className:"w-3 h-3 inline-block mr-1"}),q]}),e.jsxs("span",{children:[e.jsx(i,{name:"list",className:"w-3 h-3 inline-block mr-1"}),(v.options||[]).length," options"]})]}),v.tags&&v.tags.length>0&&e.jsx("div",{className:"flex flex-wrap items-center gap-1 mt-2",children:v.tags.map(F=>e.jsx("span",{className:"bg-border/50 text-text-muted text-xs px-2 py-0.5 rounded-full",children:F},F))})]})]}),e.jsxs("div",{className:"flex-shrink-0 relative",ref:j===v.id?Y:null,children:[r===v.id?e.jsx("div",{className:"p-2",children:e.jsx(ne,{size:"sm"})}):e.jsx(g,{variant:"ghost",className:"p-2 h-auto",onClick:F=>{F.stopPropagation(),s(pe=>pe===v.id?null:v.id)},"aria-label":"More options for question",children:e.jsx(i,{name:"more-vertical",className:"w-5 h-5"})}),j===v.id&&e.jsxs("div",{className:"absolute right-0 mt-2 w-48 bg-surface rounded-md shadow-lg py-1 z-10 ring-1 ring-black ring-opacity-5 animate-fade-in",style:{animationDuration:"150ms"},children:[e.jsxs("button",{type:"button",onClick:F=>{S(v,F),s(null)},className:"flex items-center w-full px-4 py-2 text-sm text-left text-text hover:bg-border/20",children:[e.jsx(i,{name:"edit",className:"w-4 h-4 mr-3"}),"Edit"]}),e.jsxs("button",{type:"button",onClick:()=>O(v),className:"flex items-center w-full px-4 py-2 text-sm text-left text-text hover:bg-border/20",children:[e.jsx(i,{name:"zap",className:"w-4 h-4 mr-3"}),"Regenerate"]}),v.suspended?e.jsxs("button",{type:"button",onClick:()=>R(v.id),className:"flex items-center w-full px-4 py-2 text-sm text-left text-text hover:bg-border/20",children:[e.jsx(i,{name:"eye",className:"w-4 h-4 mr-3"}),"Unsuspend"]}):e.jsxs("button",{type:"button",onClick:()=>m(v.id),className:"flex items-center w-full px-4 py-2 text-sm text-left text-text hover:bg-border/20",children:[e.jsx(i,{name:"eye-off",className:"w-4 h-4 mr-3"}),"Suspend"]}),e.jsx("div",{className:"border-t border-border my-1"}),e.jsxs("button",{type:"button",onClick:F=>{P(v,F),s(null)},className:"flex items-center w-full px-4 py-2 text-sm text-left text-red-600 dark:text-red-400 hover:bg-red-50 dark:hover:bg-red-900/20",children:[e.jsx(i,{name:"trash-2",className:"w-4 h-4 mr-3"}),"Delete"]})]})]})]},v.id)})}):e.jsxs("div",{className:"flex flex-col items-center justify-center p-8 border-2 border-dashed border-border rounded-lg bg-background/50",children:[e.jsx(i,{name:"help-circle",className:"w-12 h-12 text-text-muted mb-3"}),e.jsx("p",{className:"text-text font-medium mb-1",children:"No questions yet"}),e.jsx("p",{className:"text-sm text-text-muted text-center max-w-xs",children:"Start adding questions to build your quiz."}),e.jsxs("div",{className:"mt-4 flex flex-col sm:flex-row gap-3",children:[e.jsxs(g,{variant:"primary",onClick:v=>S(null,v),children:[e.jsx(i,{name:"plus",className:"w-4 h-4 mr-2"}),"Add Question"]}),_&&c&&e.jsxs(g,{variant:"ghost",onClick:c,disabled:o,children:[e.jsx(i,{name:"zap",className:"w-4 h-4 mr-2"}),"Generate with AI"]})]})]})}),l.length>0&&e.jsxs("div",{className:"px-6 py-4 border-t border-border flex flex-wrap gap-2",children:[e.jsxs(g,{variant:"secondary",onClick:v=>S(null,v),className:"flex-grow sm:flex-grow-0",children:[e.jsx(i,{name:"plus",className:"w-5 h-5 mr-2"}),"Add New Question"]}),e.jsxs(g,{variant:"ghost",onClick:a,className:"flex-grow sm:flex-grow-0",children:[e.jsx(i,{name:"code",className:"w-5 h-5 mr-2"}),"Bulk Add via JSON"]}),_&&u&&e.jsxs(g,{variant:"ghost",onClick:V,className:"flex-grow sm:flex-grow-0",disabled:H,children:[H?e.jsx(ne,{size:"sm"}):e.jsx(i,{name:"filter",className:"w-5 h-5 mr-2"}),H?"Tagging...":"Auto-Tag"]}),_&&c&&e.jsxs(g,{variant:"ghost",onClick:c,className:"flex-grow sm:flex-grow-0",disabled:o,children:[o?e.jsx(ne,{size:"sm"}):e.jsx(i,{name:"zap",className:"w-5 h-5 mr-2"}),o?"Generating...":"Generate with AI"]})]})]}),y&&e.jsx(ut,{question:N,onClose:A,onSave:ee,deckName:p}),M&&e.jsx(ze,{isOpen:!!M,onClose:()=>w(null),onConfirm:J,title:"Delete Question",message:"Are you sure you want to delete this question? This action cannot be undone."})]})},pt=({isOpen:t,onClose:l,onAddItems:x,deckType:b})=>{const[a,c]=n.useState(""),{addToast:o}=he(),f=n.useRef(null);me(f,t);const u=n.useMemo(()=>b===$.Flashcard?`[
  {
    "front": "What is the capital of Japan?",
    "back": "Tokyo"
  },
  {
    "front": "What is 2 + 2?",
    "back": "4"
  }
]`:`[
  {
    "questionText": "Which planet is known as the Red Planet?",
    "options": [
      { "id": "1", "text": "Earth" },
      { "id": "2", "text": "Mars" }
    ],
    "correctAnswerId": "2",
    "detailedExplanation": "Mars is called the Red Planet because of its reddish appearance."
  }
]`,[b]),p=C=>{if(C.preventDefault(),!a.trim()){o("JSON content cannot be empty.","error");return}try{const y=Ze(a,b);if(y.length===0){o("The JSON array is empty. No items were added.","info"),l();return}x(y),o(`Successfully added ${y.length} item(s).`,"success"),l()}catch(y){o(y instanceof Error?y.message:"Invalid JSON format.","error")}},N=C=>{if(C.key==="Tab"){C.preventDefault();const y=C.target,I=y.selectionStart,M=y.selectionEnd;y.value=y.value.substring(0,I)+"  "+y.value.substring(M),y.selectionStart=y.selectionEnd=I+2}};return t?e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-75 flex items-center justify-center z-[60] p-4",children:e.jsx("div",{ref:f,className:"bg-surface rounded-lg shadow-xl w-full max-w-2xl transform transition-all relative",children:e.jsxs("form",{onSubmit:p,children:[e.jsxs("div",{className:"flex justify-between items-center p-4 border-b border-border",children:[e.jsxs("h2",{className:"text-xl font-bold",children:["Bulk Add ",b===$.Flashcard?"Cards":"Questions"]}),e.jsx(g,{type:"button",variant:"ghost",onClick:l,className:"p-1 h-auto",children:e.jsx(i,{name:"x"})})]}),e.jsxs("div",{className:"p-6",children:[e.jsx("label",{htmlFor:"json-content-bulk",className:"block text-sm font-medium text-text-muted mb-1",children:"Paste an array of items in JSON format."}),e.jsx("textarea",{id:"json-content-bulk",value:a,onChange:C=>c(C.target.value),onKeyDown:N,rows:15,className:"w-full p-2 bg-background border border-border rounded-md focus:ring-2 focus:ring-primary focus:outline-none font-mono text-sm",placeholder:u}),e.jsxs(re,{href:"/instructions/json",onClick:l,className:"text-sm text-primary hover:underline mt-2 inline-flex items-center gap-1",children:[e.jsx(i,{name:"help-circle",className:"w-4 h-4"}),"View JSON format guide"]})]}),e.jsxs("div",{className:"flex justify-end p-4 bg-background/50 border-t border-border",children:[e.jsx(g,{type:"button",variant:"secondary",onClick:l,className:"mr-2",children:"Cancel"}),e.jsx(g,{type:"submit",variant:"primary",children:"Add Items"})]})]})})}):null},gt=({data:t,total:l})=>l===0?e.jsx("div",{className:"w-full bg-gray-200 dark:bg-gray-700 rounded-full h-4"}):e.jsx("div",{className:"flex w-full h-4 bg-gray-200 dark:bg-gray-700 rounded-full overflow-hidden",role:"progressbar","aria-valuenow":t.reduce((x,b)=>x+b.value,0),"aria-valuemin":0,"aria-valuemax":l,children:t.map((x,b)=>{if(x.value===0)return null;const a=x.value/l*100;return e.jsx("div",{className:`${x.color} transition-all duration-500`,style:{width:`${a}%`},title:`${x.label}: ${x.value} item(s)`},b)})}),bt=({data:t})=>{const l=Math.max(...t.map(p=>p.count),1),x=350,b=120,a={top:25,right:15,bottom:25,left:15},c=x-a.left-a.right,o=b-a.top-a.bottom,f=c/t.length,u=Math.max(6,f*.1);return e.jsxs("div",{className:"w-full",children:[e.jsx("h4",{className:"text-sm font-semibold text-gray-700 dark:text-gray-300 mb-2",children:"Upcoming Due Dates (Next 7 Days)"}),e.jsx("div",{className:"bg-gray-50 dark:bg-gray-900/50 p-2 rounded-lg border border-gray-200 dark:border-gray-700/50",children:e.jsxs("svg",{viewBox:`0 0 ${x} ${b}`,width:"100%",height:"auto","aria-labelledby":"due-date-graph-title",role:"img",className:"overflow-visible",children:[e.jsx("title",{id:"due-date-graph-title",children:"A bar chart showing the number of items due over the next 7 days."}),t.map((p,N)=>{const C=p.count>0?p.count/l*o:0,y=a.left+N*f+(f-u)/2,I=a.top+o-C;return e.jsxs("g",{className:"group",style:{cursor:"pointer"},children:[e.jsxs("title",{children:[p.date,": ",p.count," item",p.count!==1?"s":""," due"]}),e.jsx("rect",{x:y,y:I,width:u,height:C,rx:"2",className:"fill-blue-500 transition-colors group-hover:fill-blue-400"}),e.jsx("text",{x:y+u/2,y:I-6,textAnchor:"middle",className:"fill-gray-600 dark:fill-gray-300 font-semibold text-sm transition-opacity opacity-0 group-hover:opacity-100 pointer-events-none",children:p.count}),e.jsx("text",{x:y+u/2,y:b-a.bottom+15,textAnchor:"middle",className:"fill-gray-400 dark:fill-gray-500 text-xs pointer-events-none",children:p.dayLabel})]},N)})]})})]})},jt=({reviews:t})=>{const[l,x]=n.useState(null),b=n.useMemo(()=>{if(!t||t.length===0)return[];const w=new Map;t.forEach(h=>{const j=new Date(h.timestamp).toISOString().split("T")[0],s=w.get(j)||{totalMastery:0,count:0};s.totalMastery+=h.masteryLevel,s.count++,w.set(j,s)});const T=Array.from(w.entries()).map(([h,{totalMastery:j,count:s}])=>({date:new Date(h),avgMastery:j/s}));return T.sort((h,j)=>h.date.getTime()-j.date.getTime()),T.slice(-90)},[t]);if(b.length<2)return e.jsx("div",{className:"text-center text-sm text-text-muted py-8",children:"Not enough review history to plot a graph."});const a=350,c=150,o={top:10,right:10,bottom:20,left:30},f=a-o.left-o.right,u=c-o.top-o.bottom,p=b[0].date.getTime(),N=b[b.length-1].date.getTime(),C=w=>(w.getTime()-p)/(N-p)*f+o.left,y=w=>c-o.bottom-w*u,I=b.map(w=>`${C(w.date)},${y(w.avgMastery)}`).join(" L "),M=w=>{const T=w.currentTarget.getBoundingClientRect(),h=w.clientX-T.left;let j=b[0],s=1/0;b.forEach(r=>{const k=C(r.date),D=Math.abs(h-k);D<s&&(s=D,j=r)}),s<20?x({x:C(j.date),y:y(j.avgMastery),data:j}):x(null)};return e.jsx("div",{className:"w-full",children:e.jsxs("svg",{viewBox:`0 0 ${a} ${c}`,width:"100%",height:"auto","aria-labelledby":"mastery-graph-title",role:"img",className:"overflow-visible",onMouseMove:M,onMouseLeave:()=>x(null),children:[e.jsx("title",{id:"mastery-graph-title",children:"A line chart showing average mastery over time."}),[0,.25,.5,.75,1].map(w=>e.jsxs("g",{children:[e.jsx("line",{x1:o.left,y1:y(w),x2:a-o.right,y2:y(w),className:"stroke-current text-border/70",strokeWidth:"0.5"}),e.jsx("text",{x:o.left-8,y:y(w)+4,textAnchor:"end",className:"text-xs fill-text-muted",children:`${w*100}%`})]},w)),e.jsx("text",{x:o.left,y:c-5,textAnchor:"start",className:"text-xs fill-text-muted",children:b[0].date.toLocaleDateString("en-us",{month:"short",day:"numeric"})}),e.jsx("text",{x:a-o.right,y:c-5,textAnchor:"end",className:"text-xs fill-text-muted",children:b[b.length-1].date.toLocaleDateString("en-us",{month:"short",day:"numeric"})}),e.jsx("path",{d:`M ${I}`,className:"stroke-primary",fill:"none",strokeWidth:"2",strokeLinejoin:"round",strokeLinecap:"round"}),l&&e.jsxs("g",{children:[e.jsx("line",{x1:l.x,y1:o.top,x2:l.x,y2:c-o.bottom,className:"stroke-current text-border",strokeDasharray:"2,2"}),e.jsx("circle",{cx:l.x,cy:l.y,r:"4",className:"fill-primary"}),e.jsxs("g",{transform:`translate(${l.x>a/2?l.x-100:l.x+10}, ${o.top})`,children:[e.jsx("rect",{x:"0",y:"0",width:"90",height:"35",rx:"4",className:"fill-surface opacity-90",stroke:"rgb(var(--color-border))"}),e.jsx("text",{x:"5",y:"15",className:"text-xs fill-text font-semibold",children:l.data.date.toLocaleDateString("en-us",{month:"short",day:"numeric"})}),e.jsxs("text",{x:"5",y:"30",className:"text-xs fill-text-muted",children:["Mastery: ",Math.round(l.data.avgMastery*100),"%"]})]})]})]})})},vt=({block:t,onClose:l,onSave:x})=>{const[b,a]=n.useState(""),[c,o]=n.useState([]),{addToast:f}=he(),u=n.useRef(null);me(u,!0),n.useEffect(()=>{t?(a(t.infoCard.content),o(t.questions.map(h=>({...h})))):o([{id:crypto.randomUUID(),questionText:"",options:[{id:crypto.randomUUID(),text:""},{id:crypto.randomUUID(),text:""}],correctAnswerId:"",detailedExplanation:""}])},[t]);const p=(h,j,s)=>{const r=[...c];r[h][j]=s,o(r)},N=(h,j,s)=>{const r=[...c];r[h].options&&(r[h].options[j].text=s,o(r))},C=()=>{o([...c,{id:crypto.randomUUID(),questionText:"",options:[{id:crypto.randomUUID(),text:""},{id:crypto.randomUUID(),text:""}],correctAnswerId:"",detailedExplanation:""}])},y=h=>{if(c.length<=1){f("A learning block must have at least one question.","error");return}o(c.filter((j,s)=>s!==h))},I=h=>{var s;const j=[...c];(s=j[h].options)==null||s.push({id:crypto.randomUUID(),text:""}),o(j)},M=(h,j)=>{const s=[...c],r=s[h];if(r.options&&r.options.length>2){const k=r.options.splice(j,1)[0];r.correctAnswerId===k.id&&(r.correctAnswerId=""),o(s)}else f("A question must have at least two options.","error")},w=(h,j)=>{if(h.key==="Tab"){h.preventDefault();const s=h.target,r=s.selectionStart,k=s.selectionEnd,D=s.value.substring(0,r)+"	"+s.value.substring(k);s.value=D,j(D),s.selectionStart=s.selectionEnd=r+1}},T=h=>{var k,D;if(h.preventDefault(),!b.trim()){f("Informational content cannot be empty.","error");return}for(const L of c){if(!((k=L.questionText)!=null&&k.trim())){f("Question text is required.","error");return}if((D=L.options)!=null&&D.some(H=>!H.text.trim())){f("All options must have text.","error");return}if(!L.correctAnswerId){f("You must select a correct answer for each question.","error");return}}const j=new Date().toISOString(),s={id:(t==null?void 0:t.infoCard.id)||crypto.randomUUID(),content:b,unlocksQuestionIds:c.map(L=>L.id)},r=c.map((L,H)=>{const z=t==null?void 0:t.questions[H];return{...z,...L,id:L.id,questionType:"multipleChoice",infoCardIds:[s.id],dueDate:(z==null?void 0:z.dueDate)||j,interval:(z==null?void 0:z.interval)||0,easeFactor:(z==null?void 0:z.easeFactor)||Ce,tags:L.tags||[]}});x({infoCard:s,questions:r})};return e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-75 flex items-center justify-center z-[60] p-4",children:e.jsx("div",{ref:u,className:"bg-surface rounded-lg shadow-xl w-full max-w-4xl transform transition-all relative max-h-[90vh] flex flex-col",children:e.jsxs("form",{onSubmit:T,className:"flex flex-col h-full",children:[e.jsxs("header",{className:"flex-shrink-0 flex justify-between items-center p-4 border-b border-border",children:[e.jsx("h2",{className:"text-xl font-bold",children:t?"Edit Learning Block":"Add New Learning Block"}),e.jsx(g,{type:"button",variant:"ghost",onClick:l,className:"p-1 h-auto",children:e.jsx(i,{name:"x"})})]}),e.jsxs("main",{className:"p-6 space-y-6 overflow-y-auto",children:[e.jsxs("div",{children:[e.jsx("label",{htmlFor:"info-content",className:"block text-sm font-bold text-text mb-1",children:"Informational Content (Supports HTML)"}),e.jsxs("div",{className:"border border-border rounded-md focus-within:ring-2 focus-within:ring-primary overflow-hidden",children:[e.jsx(ue,{targetId:"info-content",value:b,onChange:a}),e.jsx("textarea",{id:"info-content",value:b,onChange:h=>a(h.target.value),onKeyDown:h=>w(h,a),rows:12,className:"w-full p-2 bg-background focus:outline-none font-mono text-sm block",placeholder:"Explain a concept here..."})]})]}),e.jsxs("div",{className:"border-t border-border pt-4",children:[e.jsx("h3",{className:"text-lg font-bold text-text mb-2",children:"Questions"}),e.jsxs("div",{className:"space-y-6",children:[c.map((h,j)=>{var s;return e.jsxs("div",{className:"p-4 bg-background rounded-lg border border-border space-y-3 relative",children:[e.jsxs("label",{className:"block text-sm font-medium text-text-muted",children:["Question ",j+1]}),e.jsx("textarea",{value:h.questionText,onChange:r=>p(j,"questionText",r.target.value),rows:2,className:"w-full p-2 bg-surface border border-border rounded-md focus:ring-2 focus:ring-primary focus:outline-none",placeholder:"Question related to the info above"}),e.jsx("div",{className:"space-y-2",children:(s=h.options)==null?void 0:s.map((r,k)=>e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"radio",name:`correct-answer-${j}`,checked:h.correctAnswerId===r.id,onChange:()=>p(j,"correctAnswerId",r.id),className:"h-5 w-5 text-primary bg-border/50 border-border focus:ring-primary"}),e.jsx("input",{type:"text",value:r.text,onChange:D=>N(j,k,D.target.value),className:"flex-grow p-2 bg-surface border border-border rounded-md focus:ring-2 focus:ring-primary focus:outline-none",placeholder:`Option ${k+1}`}),e.jsx(g,{type:"button",variant:"ghost",onClick:()=>M(j,k),className:"p-2 h-auto text-text-muted hover:text-red-500",children:e.jsx(i,{name:"x",className:"w-4 h-4"})})]},r.id||k))}),e.jsxs(g,{type:"button",variant:"ghost",onClick:()=>I(j),size:"sm",children:[e.jsx(i,{name:"plus",className:"w-4 h-4 mr-1"}),"Add Option"]}),e.jsx("textarea",{value:h.detailedExplanation,onChange:r=>p(j,"detailedExplanation",r.target.value),rows:2,className:"w-full p-2 bg-surface border border-border rounded-md focus:ring-2 focus:ring-primary focus:outline-none",placeholder:"Detailed explanation for the answer"}),e.jsx(g,{type:"button",variant:"ghost",onClick:()=>y(j),className:"absolute top-2 right-2 p-2 h-auto text-text-muted hover:text-red-500",children:e.jsx(i,{name:"trash-2",className:"w-4 h-4"})})]},h.id||j)}),e.jsxs(g,{type:"button",variant:"secondary",onClick:C,children:[e.jsx(i,{name:"plus",className:"w-4 h-4 mr-2"}),"Add Question"]})]})]})]}),e.jsxs("footer",{className:"flex-shrink-0 flex justify-end p-4 bg-background/50 border-t border-border",children:[e.jsx(g,{type:"button",variant:"secondary",onClick:l,className:"mr-2",children:"Cancel"}),e.jsx(g,{type:"submit",variant:"primary",children:t?"Save Changes":"Add Block"})]})]})})})},yt=({deck:t,onSaveBlock:l,onDeleteBlock:x,onBlockClick:b,onReorderBlocks:a})=>{const[c,o]=n.useState(null),[f,u]=n.useState(!1),[p,N]=n.useState(null),C=n.useRef(null),y=(s,r)=>{o(s),r&&(C.current=r.currentTarget),u(!0)},I=()=>{var s;u(!1),(s=C.current)==null||s.focus(),o(null)},M=s=>{l(s),I()},w=n.useMemo(()=>(t.infoCards||[]).map(s=>({infoCard:s,questions:(t.questions||[]).filter(r=>{var k;return(k=r.infoCardIds)==null?void 0:k.includes(s.id)})})),[t.infoCards,t.questions]),T=(s,r)=>{N(s),r.dataTransfer.effectAllowed="move"},h=(s,r)=>{r.preventDefault(),r.dataTransfer.dropEffect="move"},j=(s,r)=>{if(r.preventDefault(),p===null||p===s)return;const k=[...t.infoCards||[]],[D]=k.splice(p,1);k.splice(s,0,D),a(k),N(null)};return e.jsxs("div",{children:[e.jsxs("div",{className:"border-b border-border p-6",children:[e.jsx("h3",{className:"text-xl font-semibold text-text",children:"Learning Blocks"}),e.jsx("p",{className:"text-sm text-text-muted mt-1",children:"Each block contains an info card and its related questions."})]}),e.jsx("div",{className:"p-6",children:w.length>0?e.jsx("ul",{className:"space-y-4",children:w.map((s,r)=>{const k=p===r;return e.jsx("li",{className:`p-4 rounded-lg bg-background border transition-all duration-200 cursor-pointer ${k?"opacity-50 ring-2 ring-primary border-transparent":"border-border hover:border-primary hover:shadow-md"}`,draggable:!0,onDragStart:D=>T(r,D),onDragOver:D=>h(r,D),onDrop:D=>j(r,D),onClick:()=>b(s),onKeyDown:D=>{(D.key==="Enter"||D.key===" ")&&b(s)},tabIndex:0,role:"button",children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsx("div",{className:"mr-3 mt-1 cursor-grab active:cursor-grabbing text-text-muted hover:text-text",onClick:D=>D.stopPropagation(),children:e.jsx(i,{name:"grip-vertical",className:"w-5 h-5"})}),e.jsxs("div",{className:"flex-1 min-w-0 mr-4",children:[e.jsxs("div",{className:"flex items-center gap-2 text-text font-semibold",children:[e.jsx(i,{name:"book-open",className:"w-5 h-5 text-purple-500 flex-shrink-0"}),e.jsx("p",{className:"truncate",title:xe(s.infoCard.content),children:xe(s.infoCard.content)})]}),s.questions.length>0&&e.jsx("ul",{className:"mt-2 pl-7 space-y-1",children:s.questions.map(D=>e.jsxs("li",{className:"flex items-center gap-2 text-sm text-text-muted",children:[e.jsx(i,{name:"help-circle",className:"w-4 h-4 flex-shrink-0"}),e.jsx("span",{className:"truncate",title:xe(D.questionText),children:xe(D.questionText)})]},D.id))})]}),e.jsxs("div",{className:"flex-shrink-0 flex items-center gap-1",children:[e.jsx(g,{variant:"ghost",className:"p-2 h-auto",onClick:D=>{D.stopPropagation(),y(s,D)},title:"Edit this block",children:e.jsx(i,{name:"edit",className:"w-4 h-4"})}),e.jsx(g,{variant:"ghost",className:"p-2 h-auto text-text-muted hover:text-red-500",onClick:D=>{D.stopPropagation(),x(s.infoCard.id)},title:"Delete this block",children:e.jsx(i,{name:"trash-2",className:"w-4 h-4"})})]})]})},s.infoCard.id)})}):e.jsxs("div",{className:"text-center text-text-muted py-8",children:[e.jsx(i,{name:"layers",className:"w-12 h-12 mx-auto mb-2 opacity-50"}),e.jsx("p",{children:"This deck has no learning blocks yet."})]})}),e.jsx("div",{className:"px-6 py-4 border-t border-border flex flex-wrap gap-2",children:e.jsxs(g,{variant:"secondary",onClick:s=>y(null,s),className:"flex-grow sm:flex-grow-0",children:[e.jsx(i,{name:"plus",className:"w-5 h-5 mr-2"}),"Add Learning Block"]})}),f&&e.jsx(vt,{block:c,onClose:I,onSave:M})]})},Nt=({isOpen:t,onClose:l,block:x,deckName:b,onExpandText:a})=>{const c=n.useRef(null),o=n.useRef(null),[f,u]=n.useState(null),[p,N]=n.useState(null);me(c,t);const C=()=>{u(null),N(null),l()},y=()=>{var h;if(p)return;const T=window.getSelection();if(T&&T.toString().trim().length>10){const j=T.toString().trim(),r=T.getRangeAt(0).getBoundingClientRect(),k=(h=c.current)==null?void 0:h.getBoundingClientRect();k&&u({visible:!0,top:r.top-k.top+r.height,left:r.left-k.left+r.width/2,text:j})}else u(null)},I=async()=>{if(!(f!=null&&f.text)||!x)return;const{text:T}=f;u(null),N({isLoading:!0,content:null});const h=await a(b,x.infoCard.content,T);N({isLoading:!1,content:h})},M=()=>e.jsxs(e.Fragment,{children:[e.jsxs("div",{onMouseUp:y,ref:o,children:[e.jsx("h3",{className:"text-sm font-semibold uppercase tracking-wider text-text-muted mb-2",children:"Informational Content"}),e.jsx("div",{className:"p-4 bg-background rounded-lg border border-border",children:e.jsx(Oe,{html:x.infoCard.content,className:"prose dark:prose-invert max-w-none"})})]}),e.jsxs("div",{children:[e.jsxs("h3",{className:"text-sm font-semibold uppercase tracking-wider text-text-muted mb-2",children:["Associated Questions (",(x.questions||[]).length,")"]}),e.jsx("ul",{className:"space-y-3",children:(x.questions||[]).map(T=>e.jsxs("li",{className:"p-3 bg-background rounded-lg border border-border",children:[e.jsx("p",{className:"font-semibold text-text",dangerouslySetInnerHTML:{__html:T.questionText}}),e.jsx("ul",{className:"mt-2 pl-4 text-sm space-y-1",children:(T.options||[]).map(h=>e.jsxs("li",{className:`flex items-start gap-2 ${h.id===T.correctAnswerId?"text-green-600 dark:text-green-400 font-medium":"text-text-muted"}`,children:[h.id===T.correctAnswerId?e.jsx(i,{name:"check-circle",className:"w-4 h-4 flex-shrink-0 mt-0.5"}):e.jsx("div",{className:"w-4 h-4 flex-shrink-0"}),e.jsx("span",{dangerouslySetInnerHTML:{__html:h.text}})]},h.id))})]},T.id))})]})]}),w=()=>e.jsxs("div",{className:"space-y-4",children:[e.jsxs(g,{variant:"ghost",size:"sm",onClick:()=>N(null),children:[e.jsx(i,{name:"chevron-left",className:"w-4 h-4 mr-1"}),"Back to Content"]}),p!=null&&p.isLoading?e.jsx("div",{className:"flex justify-center items-center h-48",children:e.jsx(ne,{})}):p!=null&&p.content?e.jsx("div",{className:"p-4 bg-background rounded-lg border border-border",children:e.jsx(Oe,{html:p.content,className:"prose dark:prose-invert max-w-none"})}):e.jsx("p",{className:"text-center text-red-500",children:"Failed to generate explanation."})]});return!t||!x?null:e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-75 flex items-center justify-center z-[60] p-4",children:e.jsxs("div",{ref:c,className:"bg-surface rounded-lg shadow-xl w-full max-w-3xl transform transition-all relative max-h-[90vh] flex flex-col",role:"dialog","aria-modal":"true","aria-labelledby":"block-detail-title",children:[(f==null?void 0:f.visible)&&e.jsx("div",{className:"absolute z-10 p-1",style:{top:f.top,left:f.left,transform:"translateX(-50%)"},children:e.jsxs(g,{size:"sm",onClick:I,children:[e.jsx(i,{name:"zap",className:"w-4 h-4 mr-1"})," Expand"]})}),e.jsxs("div",{className:"flex-shrink-0 flex justify-between items-center p-4 border-b border-border",children:[e.jsx("h2",{id:"block-detail-title",className:"text-xl font-bold text-text",children:"Learning Block Details"}),e.jsx(g,{type:"button",variant:"ghost",onClick:C,className:"p-1 h-auto","aria-label":"Close",children:e.jsx(i,{name:"x"})})]}),e.jsx("div",{className:"p-6 overflow-y-auto space-y-6",children:p?w():M()}),e.jsx("div",{className:"flex-shrink-0 flex justify-end p-4 bg-background/50 border-t border-border",children:e.jsx(g,{type:"button",variant:"primary",onClick:C,children:"Close"})})]})})},wt=()=>e.jsx("div",{className:"space-y-8",children:e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-8",children:[e.jsxs("div",{className:"bg-surface p-6 rounded-lg shadow-md border border-border h-64 flex flex-col",children:[e.jsxs("div",{className:"mb-4",children:[e.jsx(W,{width:180,height:24}),e.jsx(W,{width:250,height:16,className:"mt-2"})]}),e.jsxs("div",{className:"flex-1 flex items-end gap-2 pb-4 px-2",children:[e.jsx(W,{width:"15%",height:"30%",className:"rounded-t-sm"}),e.jsx(W,{width:"15%",height:"50%",className:"rounded-t-sm"}),e.jsx(W,{width:"15%",height:"40%",className:"rounded-t-sm"}),e.jsx(W,{width:"15%",height:"70%",className:"rounded-t-sm"}),e.jsx(W,{width:"15%",height:"60%",className:"rounded-t-sm"}),e.jsx(W,{width:"15%",height:"80%",className:"rounded-t-sm"})]})]}),e.jsxs("div",{className:"bg-surface p-6 rounded-lg shadow-md border border-border h-64",children:[e.jsxs("div",{className:"mb-4",children:[e.jsx(W,{width:150,height:24}),e.jsx(W,{width:200,height:16,className:"mt-2"})]}),e.jsx("div",{className:"space-y-3",children:[1,2,3].map(t=>e.jsxs("div",{className:"p-3 bg-background rounded-md border border-transparent",children:[e.jsx(W,{width:"80%",height:16}),e.jsx(W,{width:"30%",height:12,className:"mt-2"})]},t))})]})]})}),Ct=({isOpen:t,onClose:l,onStart:x,totalItems:b})=>{const[a,c]=n.useState("random"),[o,f]=n.useState("all"),u=n.useRef(null);me(u,t);const p=()=>{x({sort:a,limit:o}),l()};return t?e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-75 flex items-center justify-center z-[60] p-4",children:e.jsxs("div",{ref:u,className:"bg-surface rounded-lg shadow-xl w-full max-w-sm transform transition-all relative",children:[e.jsxs("div",{className:"flex justify-between items-center p-4 border-b border-border",children:[e.jsx("h2",{className:"text-xl font-bold text-text",children:"Cram Session Options"}),e.jsx(g,{variant:"ghost",onClick:l,className:"p-1 h-auto",children:e.jsx(i,{name:"x"})})]}),e.jsxs("div",{className:"p-6 space-y-6",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-text-muted mb-2",children:"Sort Order"}),e.jsx("div",{className:"grid grid-cols-2 gap-2",children:["random","hardest","newest","oldest"].map(N=>e.jsx("button",{onClick:()=>c(N),className:`p-2 rounded-md text-sm border capitalize transition-colors ${a===N?"bg-primary text-on-primary border-primary":"bg-background border-border text-text hover:border-primary"}`,children:N},N))}),e.jsxs("p",{className:"text-xs text-text-muted mt-2",children:[a==="random"&&"Shuffle cards randomly.",a==="hardest"&&"Focus on cards with high lapse counts and low ease factors.",a==="newest"&&"Review the most recently added cards first.",a==="oldest"&&"Review cards from the beginning of the deck."]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-text-muted mb-2",children:"Card Limit"}),e.jsxs("select",{value:o,onChange:N=>f(N.target.value==="all"?"all":Number(N.target.value)),className:"w-full p-2 bg-background border border-border rounded-md focus:ring-2 focus:ring-primary outline-none",children:[e.jsxs("option",{value:"all",children:["All (",b,")"]}),e.jsx("option",{value:"10",disabled:b<10,children:"10 Items"}),e.jsx("option",{value:"20",disabled:b<20,children:"20 Items"}),e.jsx("option",{value:"50",disabled:b<50,children:"50 Items"}),e.jsx("option",{value:"100",disabled:b<100,children:"100 Items"})]})]})]}),e.jsxs("div",{className:"flex justify-end p-4 bg-background/50 border-t border-border",children:[e.jsx(g,{variant:"secondary",onClick:l,className:"mr-2",children:"Cancel"}),e.jsxs(g,{variant:"primary",onClick:p,children:[e.jsx(i,{name:"zap",className:"w-4 h-4 mr-2"})," Start Cramming"]})]})]})}):null},Dt=t=>{const l={new:0,learning:0,young:0,mature:0};return t.forEach(x=>{x.interval===0?l.new++:x.interval<7?l.learning++:x.interval<21?l.young++:l.mature++}),l},St=({deck:t})=>{const[l,x]=n.useState([]),[b,a]=n.useState(!0),c=(t.type===$.Flashcard?t.cards:(t.type===$.Learning,t.questions))||[];n.useEffect(()=>{(async()=>{a(!0);try{const u=await ot(t.id);x(u)}catch(u){console.error("Failed to fetch review history for deck:",u)}finally{a(!1)}})()},[t.id]);const o=n.useMemo(()=>{if(!l.length)return[];const f=new Map;return l.forEach(u=>{u.rating===nt.Again&&f.set(u.itemId,(f.get(u.itemId)||0)+1)}),Array.from(f.entries()).sort((u,p)=>p[1]-u[1]).slice(0,5).map(([u,p])=>{const N=c.find(C=>C.id===u);return N?{...N,failureCount:p}:null}).filter(u=>!!u)},[l,c]);return b?e.jsx(wt,{}):l.length===0?e.jsxs("div",{className:"text-center py-10 bg-surface rounded-lg border border-border",children:[e.jsx(i,{name:"trending-up",className:"w-12 h-12 mx-auto text-text-muted/50"}),e.jsx("h3",{className:"mt-2 text-xl font-medium text-text",children:"No Statistics Yet"}),e.jsx("p",{className:"mt-1 text-sm text-text-muted",children:"Complete a study session for this deck to see your stats."})]}):e.jsx("div",{className:"space-y-8 animate-fade-in",children:e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-8",children:[e.jsxs("div",{className:"bg-surface p-6 rounded-lg shadow-md border border-border",children:[e.jsx("h3",{className:"text-xl font-semibold text-text mb-4",children:"Mastery Over Time"}),e.jsx("p",{className:"text-sm text-text-muted mb-4",children:"Average mastery level of reviewed cards per day over the last 90 days of activity."}),e.jsx(jt,{reviews:l})]}),e.jsxs("div",{className:"bg-surface p-6 rounded-lg shadow-md border border-border",children:[e.jsx("h3",{className:"text-xl font-semibold text-text mb-4",children:"Most Difficult Items"}),e.jsx("p",{className:"text-sm text-text-muted mb-4",children:`Items you've marked "Again" most frequently.`}),o.length>0?e.jsx("ul",{className:"space-y-3",children:o.map(f=>{const p=("questionText"in f?f.questionText:f.front).replace(/<[^>]+>/g,"").trim();return e.jsxs("li",{className:"p-3 bg-background rounded-md border border-border",children:[e.jsx("p",{className:"font-semibold text-sm text-text break-words truncate",title:p,children:p}),e.jsxs("p",{className:"text-xs text-red-500 font-medium",children:['Marked "Again" ',f.failureCount," time",f.failureCount>1?"s":""]})]},f.id)})}):e.jsx("p",{className:"text-sm text-text-muted",children:"No items have been repeatedly marked as difficult. Great job!"})]})]})})},Be=({icon:t,label:l,value:x,subtext:b,color:a="primary"})=>e.jsxs("div",{className:"bg-surface p-4 rounded-lg shadow-sm border border-border flex items-center gap-4",children:[e.jsx("div",{className:`p-3 rounded-full bg-${a}/10 text-${a}`,children:e.jsx(i,{name:t,className:"w-6 h-6"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-text-muted",children:l}),e.jsx("p",{className:"text-2xl font-bold text-text",children:x}),b&&e.jsx("p",{className:"text-xs text-text-muted mt-0.5",children:b})]})]}),Et=({deck:t,sessionsToResume:l,onUpdateDeck:x,onDeleteDeck:b,onUpdateLastOpened:a,openConfirmModal:c,handleGenerateQuestionsForDeck:o,handleGenerateContentForLearningDeck:f,onCancelAIGeneration:u,onSaveLearningBlock:p,onDeleteLearningBlock:N,onExportDeck:C,onRegenerateQuestion:y,onExpandText:I,onGenerateAI:M})=>{var Ae,Me,Re;const[w,T]=n.useState(!1),[h,j]=n.useState(t.name),[s,r]=n.useState(t.description||""),[k,D]=n.useState(t.folderId||""),[L,H]=n.useState(t.icon),[z,U]=n.useState(!1),[Y,_]=n.useState(!1),[S,A]=n.useState(!1),[P,J]=n.useState("overview"),[ee,m]=n.useState(!1),[R,O]=n.useState(null),{navigate:V}=et(),{addToast:fe}=he(),{aiFeaturesEnabled:Z}=je(),{folders:le,aiGenerationStatus:v,learningProgress:E}=tt(),q=st(),Q=De(),ie=n.useRef(null),K=(t.type===$.Flashcard?t.cards:(t.type===$.Learning,t.questions))||[],F=n.useMemo(()=>{const{currentTask:d,queue:B}=v;return(d==null?void 0:d.deckId)===t.id?d:(Array.isArray(B)?B:[]).find(ce=>ce.deckId===t.id)},[v,t.id]),pe=!!F,ve=n.useMemo(()=>q.find(d=>!d.deletedAt&&(d.levels||[]).some(B=>{var G;return(G=B.deckIds)==null?void 0:G.includes(t.id)})),[q,t.id]);n.useEffect(()=>{a(t.id)},[t.id,a]),n.useEffect(()=>{(t.archived||t.deletedAt)&&V("/")},[t.archived,t.deletedAt,V]),n.useEffect(()=>{w||(j(t.name),r(t.description||""),D(t.folderId||""),H(t.icon))},[t,w]),n.useEffect(()=>{const d=B=>{ie.current&&!ie.current.contains(B.target)&&U(!1)};return z&&document.addEventListener("mousedown",d),()=>document.removeEventListener("mousedown",d)},[z]);const Qe=()=>{x({...t,name:h,description:s,folderId:k||null,icon:L}),T(!1)},Fe=()=>{T(!1)},Ue=d=>{if(t.type===$.Flashcard&&d.every(B=>"front"in B)){const B=lt(d),G=[...t.cards||[],...B];x({...t,cards:G})}else if((t.type===$.Quiz||t.type===$.Learning)&&d.every(B=>"questionText"in B)){const B=it(d),ce=[...t.questions||[],...B];x({...t,questions:ce})}},He=()=>{c({title:"Move Deck to Trash",message:`Are you sure you want to move the deck "${t.name}" to the trash? It will be permanently deleted after 10 days. This will also remove it from any series it belongs to.`,onConfirm:()=>b(t.id)})},Pe=d=>{O(d),m(!0)},Ke=d=>{const B={...t,infoCards:d};x(B,{silent:!0})},Ge=d=>{a(t.id),V(`/decks/${t.id}/cram?sort=${d.sort}&limit=${d.limit}`)},X=K.filter(d=>!d.suspended),Ie=K.length-X.length,te=Dt(X),oe=E[t.id],ge=new Set((oe==null?void 0:oe.unlockedQuestionIds)||[]),de=t.type===$.Learning?t.questions.filter(d=>ge.has(d.id)&&!d.suspended&&new Date(d.dueDate)<=new Date).length:at(t),be=l.has(t.id),Te=((Ae=oe==null?void 0:oe.readInfoCardIds)==null?void 0:Ae.length)||0,Je=((Me=t.infoCards)==null?void 0:Me.length)||0,Ee=t.type===$.Learning&&Te<Je;t.type===$.Learning&&t.questions.filter(d=>ge.has(d.id)).length,t.type===$.Learning&&t.questions.length;const Ve=n.useMemo(()=>X.length===0?0:X.reduce((B,G)=>B+Se(G),0)/X.length,[X]),We=n.useMemo(()=>{const d=new Date;d.setHours(0,0,0,0);const B=Array(7).fill(0),G=[],ce=[];for(let se=0;se<7;se++){const ae=new Date(d);ae.setDate(d.getDate()+se),se===0?G.push("Today"):se===1?G.push("Tom"):G.push(ae.toLocaleDateString("en-US",{weekday:"short"})),ce.push(ae.toLocaleDateString("en-US",{month:"short",day:"numeric"}));const Xe=ae.getTime();K.forEach(we=>{if(we.suspended||t.type===$.Learning&&!ge.has(we.id))return;const $e=new Date(we.dueDate);$e.setHours(0,0,0,0),$e.getTime()===Xe&&B[se]++})}return G.map((se,ae)=>({dayLabel:se,count:B[ae],date:ce[ae]}))},[K,t.type,ge]),_e=n.useMemo(()=>K.length===0?"No Items to Study":t.locked?"Deck is Locked":t.type===$.Quiz?be?"Resume Quiz":"Start Quiz":t.type===$.Learning?t.learningMode==="mixed"?"Start Course":"Practice":be?"Resume Study":"Study Cards",[t.type,be,t.locked,K.length,t.learningMode]),Ye=[{value:te.new,color:"bg-blue-500",label:"New"},{value:te.learning,color:"bg-orange-500",label:"Learning"},{value:te.young,color:"bg-teal-500",label:"Young"},{value:te.mature,color:"bg-green-500",label:"Mature"}],ye=d=>`px-4 py-2 text-sm font-medium transition-colors border-b-2 ${P===d?"border-primary text-primary":"border-transparent text-text-muted hover:text-text"}`,Ne=K.length===0&&(t.type!==$.Learning||t.infoCards.length===0),qe=t.type===$.Learning&&t.learningMode!=="mixed";return e.jsxs("div",{className:"max-w-5xl mx-auto animate-fade-in space-y-6 pb-20",children:[e.jsx("div",{className:`bg-surface rounded-xl shadow-sm border border-border ${w?"overflow-hidden":""}`,children:w?e.jsxs("div",{className:"p-6 space-y-4 animate-fade-in bg-background/50",children:[e.jsx("h2",{className:"text-xl font-bold text-text mb-4",children:"Edit Deck Details"}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"deck-name-edit",className:"block text-sm font-medium text-text-muted mb-1",children:"Deck Name"}),e.jsx("input",{id:"deck-name-edit",type:"text",value:h,onChange:d=>j(d.target.value),className:"w-full p-2 bg-background border border-border rounded-md focus:ring-2 focus:ring-primary focus:outline-none text-xl font-bold",autoFocus:!0})]}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-text-muted mb-1",children:"Deck Icon"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs("select",{value:L||"",onChange:d=>H(d.target.value),className:"w-full p-2 bg-background border border-border rounded-md focus:ring-2 focus:ring-primary focus:outline-none",children:[e.jsx("option",{value:"",children:"Default"}),rt.map(d=>e.jsx("option",{value:d,children:d},d))]}),Z&&e.jsxs(g,{variant:"secondary",onClick:()=>Q==null?void 0:Q.handleSuggestDeckIcon(t),title:"Suggest Icon with AI",children:[e.jsx(i,{name:"zap",className:"w-4 h-4 mr-1"})," Auto"]})]})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"deck-folder",className:"block text-sm font-medium text-text-muted mb-1",children:"Folder"}),e.jsxs("select",{id:"deck-folder",value:k,onChange:d=>D(d.target.value),className:"w-full p-2 bg-background border border-border rounded-md focus:ring-2 focus:ring-primary focus:outline-none",children:[e.jsx("option",{value:"",children:"No folder"}),Object.values(le).map(d=>e.jsx("option",{value:d.id,children:d.name},d.id))]})]})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"deck-desc",className:"block text-sm font-medium text-text-muted mb-1",children:"Description"}),e.jsx("textarea",{id:"deck-desc",value:s,onChange:d=>r(d.target.value),rows:4,className:"w-full p-2 bg-background border border-border rounded-md focus:ring-2 focus:ring-primary focus:outline-none"})]}),e.jsxs("div",{className:"flex justify-end gap-2 pt-2 border-t border-border mt-4",children:[e.jsx(g,{variant:"secondary",onClick:Fe,children:"Cancel"}),e.jsxs(g,{onClick:Qe,children:[e.jsx(i,{name:"save",className:"mr-2"})," Save Changes"]})]})]}):e.jsxs("div",{className:"p-6 md:p-8 flex flex-col md:flex-row items-start justify-between gap-4",children:[e.jsx("div",{className:"flex-1 min-w-0",children:e.jsxs("div",{className:"flex items-start gap-4",children:[e.jsx("div",{className:"p-3 bg-primary/10 rounded-xl flex-shrink-0",children:e.jsx(i,{name:t.icon||(t.type==="flashcard"?"laptop":t.type==="learning"?"book-open":"help-circle"),className:"w-8 h-8 text-primary"})}),e.jsxs("div",{className:"min-w-0 flex-1",children:[ve?e.jsxs("div",{className:"flex flex-wrap items-center gap-2 mb-1",children:[e.jsxs(re,{href:`/series/${ve.id}`,className:"flex items-center text-xs font-bold text-primary uppercase tracking-wider hover:underline",children:[e.jsx(i,{name:"layers",className:"w-3 h-3 mr-1"}),e.jsx("span",{children:ve.name})]}),t.folderId&&le[t.folderId]&&e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"text-text-muted/30 text-xs",children:""}),e.jsxs("div",{className:"flex items-center text-xs font-medium text-text-muted uppercase tracking-wider",children:[e.jsx(i,{name:"folder",className:"w-3 h-3 mr-1"}),e.jsx("span",{children:le[t.folderId].name})]})]})]}):t.folderId&&e.jsxs("div",{className:"flex items-center text-xs font-semibold text-text-muted mb-1 uppercase tracking-wider",children:[e.jsx(i,{name:"folder",className:"w-3 h-3 mr-1"}),e.jsx("span",{children:((Re=le[t.folderId])==null?void 0:Re.name)||"Uncategorized"})]}),e.jsx("h1",{className:"text-3xl font-extrabold text-text break-words leading-tight",children:t.name}),t.description&&e.jsx("div",{className:"mt-2 text-text-muted",children:e.jsx(dt,{html:t.description,className:"prose prose-sm dark:prose-invert max-w-none text-text-muted leading-relaxed"})})]})]})}),e.jsxs("div",{className:"relative flex-shrink-0 self-start mt-2 md:mt-0",ref:ie,children:[e.jsx(g,{variant:"ghost",onClick:()=>U(!z),className:"p-2 rounded-full hover:bg-border/50",children:e.jsx(i,{name:"more-vertical",className:"w-6 h-6 text-text-muted"})}),z&&e.jsxs("div",{className:"absolute right-0 mt-2 w-56 bg-surface rounded-lg shadow-xl border border-border z-20 py-1 animate-fade-in origin-top-right",children:[e.jsxs("button",{onClick:()=>{T(!0),U(!1)},className:"flex items-center w-full px-4 py-2.5 text-sm text-left text-text hover:bg-primary/5 hover:text-primary transition-colors",children:[e.jsx(i,{name:"edit",className:"w-4 h-4 mr-3"})," Edit Details"]}),Z&&!Ne&&e.jsxs("button",{onClick:()=>{Q==null||Q.handleOpenDeckAnalysis(t),U(!1)},className:"flex items-center w-full px-4 py-2.5 text-sm text-left text-text hover:bg-primary/5 hover:text-primary transition-colors",children:[e.jsx(i,{name:"zap",className:"w-4 h-4 mr-3"})," Analyze & Improve"]}),e.jsxs(re,{href:`/decks/${t.id}/print`,className:"flex items-center w-full px-4 py-2.5 text-sm text-left text-text hover:bg-primary/5 hover:text-primary transition-colors",children:[e.jsx(i,{name:"printer",className:"w-4 h-4 mr-3"})," Print / PDF"]}),e.jsxs("button",{onClick:()=>{C(t),U(!1)},className:"flex items-center w-full px-4 py-2.5 text-sm text-left text-text hover:bg-primary/5 hover:text-primary transition-colors",children:[e.jsx(i,{name:"download",className:"w-4 h-4 mr-3"})," Export JSON"]}),t.type==="flashcard"&&e.jsxs("button",{onClick:()=>{Q==null||Q.handleExportDeckCSV(t),U(!1)},className:"flex items-center w-full px-4 py-2.5 text-sm text-left text-text hover:bg-primary/5 hover:text-primary transition-colors",children:[e.jsx(i,{name:"file-text",className:"w-4 h-4 mr-3"})," Export CSV"]}),e.jsx("div",{className:"my-1 border-t border-border"}),e.jsxs("button",{onClick:()=>{x({...t,archived:!0},{toastMessage:"Deck archived."}),U(!1)},className:"flex items-center w-full px-4 py-2.5 text-sm text-left text-text hover:bg-primary/5 hover:text-primary transition-colors",children:[e.jsx(i,{name:"archive",className:"w-4 h-4 mr-3"})," Archive"]}),e.jsxs("button",{onClick:()=>{He(),U(!1)},className:"flex items-center w-full px-4 py-2.5 text-sm text-left text-red-600 dark:text-red-400 hover:bg-red-50 dark:hover:bg-red-900/20 transition-colors",children:[e.jsx(i,{name:"trash-2",className:"w-4 h-4 mr-3"})," Move to Trash"]})]})]})]})}),e.jsxs("div",{className:"flex space-x-1 border-b border-border overflow-x-auto",children:[e.jsx("button",{className:ye("overview"),onClick:()=>J("overview"),children:"Overview"}),e.jsxs("button",{className:ye("items"),onClick:()=>J("items"),children:["Items (",K.length,")"]}),e.jsx("button",{className:ye("stats"),onClick:()=>J("stats"),children:"Statistics"})]}),e.jsxs("div",{className:"min-h-[300px]",children:[P==="overview"&&e.jsxs("div",{className:"space-y-8 animate-fade-in",children:[e.jsxs("div",{className:"flex flex-col md:flex-row gap-4 items-center justify-between p-6 bg-primary/5 rounded-xl border border-primary/10",children:[e.jsxs("div",{className:"flex-1 text-center md:text-left",children:[e.jsx("h3",{className:"text-lg font-bold text-text mb-1",children:de>0?`You have ${de} item${de!==1?"s":""} due today.`:"All caught up for now!"}),e.jsx("p",{className:"text-sm text-text-muted",children:de>0?"Keep up your streak and review now.":"Review ahead or add new cards."})]}),e.jsxs("div",{className:"flex flex-wrap gap-3 justify-center md:justify-end",children:[Ne&&Z?pe?e.jsxs("div",{className:"flex items-center justify-center py-3 px-6 bg-surface rounded-md border border-border",children:[e.jsx(ne,{size:"sm"}),e.jsx("span",{className:"ml-3 text-text-muted text-sm font-semibold",children:F.statusText||"Generating..."})]}):e.jsxs(g,{variant:"primary",size:"lg",onClick:()=>{t.type===$.Quiz?o(t):t.type===$.Learning?f(t):M(t)},children:[e.jsx(i,{name:"zap",className:"w-5 h-5 mr-2"}),"Generate Content"]}):Ne&&!Z?e.jsxs(g,{variant:"primary",size:"lg",onClick:()=>J("items"),children:[e.jsx(i,{name:"plus",className:"w-5 h-5 mr-2"}),"Create First Item"]}):e.jsxs(e.Fragment,{children:[qe&&e.jsxs(re,{href:`/decks/${t.id}/read`,passAs:g,variant:"secondary",size:"lg",className:"font-semibold",children:[e.jsx(i,{name:"book-open",className:"w-5 h-5 mr-2"}),Te===0?"Read":Ee?"Continue Reading":"Review"]}),e.jsxs(re,{href:`/decks/${t.id}/study`,passAs:g,variant:t.type!==$.Learning||!Ee||t.learningMode==="mixed"?"primary":"secondary",size:"lg",onClick:()=>a(t.id),disabled:de===0&&!be||!!t.locked||K.length===0,className:"font-bold px-8 shadow-md",children:[e.jsx(i,{name:"refresh-ccw",className:"w-5 h-5 mr-2"})," ",_e]}),e.jsx(g,{variant:"secondary",size:"lg",onClick:()=>A(!0),disabled:K.length===0,title:"Review without affecting stats",children:"Cram"})]}),t.type===$.Flashcard&&X.length>0&&e.jsx(re,{href:`/decks/${t.id}/study-reversed`,passAs:g,variant:"ghost",size:"lg",onClick:()=>a(t.id),title:"Study Back-to-Front",children:e.jsx(i,{name:"repeat",className:"w-5 h-5"})}),t.type===$.Quiz&&X.length>0&&e.jsx(re,{href:`/decks/${t.id}/study-flip`,passAs:g,variant:"ghost",size:"lg",onClick:()=>a(t.id),title:"Review as Flashcards",children:e.jsx(i,{name:"columns",className:"w-5 h-5"})})]})]}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-4",children:[e.jsx(Be,{icon:"layers",label:"Total Items",value:X.length,color:"blue"}),e.jsx(Be,{icon:"zap",label:"Due Today",value:de,subtext:Ie>0?`${Ie} suspended`:void 0,color:"orange"}),e.jsx("div",{className:"sm:col-span-2 bg-surface p-4 rounded-lg shadow-sm border border-border flex flex-col justify-center",children:e.jsx(ke,{level:Ve})})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-8",children:[e.jsxs("div",{className:"bg-surface p-6 rounded-lg shadow-md border border-border flex flex-col justify-center",children:[e.jsxs("h4",{className:"text-sm font-semibold text-text mb-4 flex items-center gap-2",children:[e.jsx(i,{name:"trending-up",className:"w-4 h-4"})," Retention Breakdown"]}),e.jsx(gt,{data:Ye,total:X.length}),e.jsxs("div",{className:"grid grid-cols-2 gap-4 mt-6",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-3 h-3 rounded-full bg-blue-500"}),e.jsxs("span",{className:"text-sm text-text-muted",children:["New: ",e.jsx("strong",{children:te.new})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-3 h-3 rounded-full bg-orange-500"}),e.jsxs("span",{className:"text-sm text-text-muted",children:["Learning: ",e.jsx("strong",{children:te.learning})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-3 h-3 rounded-full bg-teal-500"}),e.jsxs("span",{className:"text-sm text-text-muted",children:["Young: ",e.jsx("strong",{children:te.young})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-3 h-3 rounded-full bg-green-500"}),e.jsxs("span",{className:"text-sm text-text-muted",children:["Mature: ",e.jsx("strong",{children:te.mature})]})]})]})]}),e.jsx("div",{className:"bg-surface p-6 rounded-lg shadow-md border border-border",children:e.jsx(bt,{data:We})})]})]}),P==="items"&&e.jsx("div",{className:"bg-surface rounded-lg shadow-md border border-border animate-fade-in",children:t.type===$.Flashcard?e.jsx(xt,{cards:t.cards||[],onCardsChange:d=>x({...t,cards:d},{silent:!0}),onAddCard:d=>x({...t,cards:[...t.cards||[],{...d,id:crypto.randomUUID(),dueDate:new Date().toISOString(),interval:0,easeFactor:Ce}]},{silent:!0}),onBulkAdd:()=>_(!0),deckName:t.name}):t.type===$.Quiz?e.jsx(ft,{deck:t,questions:t.questions||[],onQuestionsChange:d=>x({...t,questions:d},{silent:!0}),onAddQuestion:d=>{const B={questionType:d.questionType,questionText:d.questionText,options:d.options,correctAnswerId:d.correctAnswerId,detailedExplanation:d.detailedExplanation,tags:d.tags,infoCardIds:d.infoCardIds,suspended:d.suspended,id:crypto.randomUUID(),dueDate:new Date().toISOString(),interval:0,easeFactor:Ce,lapses:0,masteryLevel:0};x({...t,questions:[...t.questions||[],B]},{silent:!0})},onBulkAdd:()=>_(!0),onGenerateAI:()=>o(t),isGeneratingAI:pe,onRegenerateQuestion:y,onAutoTag:()=>Q==null?void 0:Q.handleAutoTagQuestions(t),deckName:t.name}):t.type===$.Learning?e.jsx(yt,{deck:t,onSaveBlock:d=>p(t.id,d),onDeleteBlock:d=>N(t.id,d),onBlockClick:Pe,onReorderBlocks:Ke}):e.jsx("div",{className:"p-6 text-center text-text-muted",children:e.jsx("p",{children:"Unsupported deck type."})})}),P==="stats"&&e.jsx("div",{className:"animate-fade-in",children:e.jsx(St,{deck:t})})]}),Y&&e.jsx(pt,{isOpen:Y,onClose:()=>_(!1),onAddItems:Ue,deckType:t.type}),ee&&e.jsx(Nt,{isOpen:ee,onClose:()=>m(!1),block:R,deckName:t.name,onExpandText:I}),S&&e.jsx(Ct,{isOpen:S,onClose:()=>A(!1),onStart:Ge,totalItems:K.length})]})};export{Et as default};
