import{g as Te,u as Ue,r,j as e,D as xe,R as X,B as L,I as Z,S as Oe,a as We,p as ct,s as Me,b as dt,c as Ze,d as qe,e as Ce,f as ut,h as Le,i as mt,k as xt,l as ht,L as Qe,T as ft,m as gt}from"./index-Db7ZDnWd.js";import{M as He}from"./MasteryBar-DwmeWyCF.js";import{P as pt}from"./ProgressBar-CYETKUCm.js";import{u as bt}from"./useKeyboardShortcuts-BOc8y4wx.js";const _e=({audioData:a,onGenerate:d,canGenerate:p})=>{const[S,l]=r.useState(!1),[y,k]=r.useState(!1),E=async()=>{if(a){k(!0);try{await ct(a)}catch(h){console.error("Audio playback error",h)}finally{k(!1)}}},B=async()=>{if(d){l(!0);try{await d()}finally{l(!1)}}};return a?e.jsx(L,{variant:"ghost",size:"sm",onClick:h=>{h.stopPropagation(),E()},className:`rounded-full p-2 h-auto ${y?"text-primary":"text-text-muted hover:text-primary"}`,title:"Play Audio",children:e.jsx(Z,{name:"volume-2",className:"w-5 h-5"})}):p?e.jsx(L,{variant:"ghost",size:"sm",onClick:h=>{h.stopPropagation(),B()},disabled:S,className:"rounded-full p-2 h-auto text-text-muted hover:text-primary",title:"Generate Audio with AI",children:S?e.jsx(Oe,{size:"sm"}):e.jsx(Z,{name:"mic",className:"w-5 h-5"})}):null},vt=({card:a})=>{const[d,p]=r.useState(!1),[S,l]=r.useState(null),{addToast:y}=We(),k=async()=>{p(!0);try{const E=Me(a.front),B=Me(a.back),h=await dt(E,B);l(h)}catch{y("Failed to generate mnemonic.","error")}finally{p(!1)}};return S?e.jsxs("div",{className:"mt-4 p-3 bg-purple-50 dark:bg-purple-900/20 border border-purple-200 dark:border-purple-800 rounded-lg text-sm",children:[e.jsxs("div",{className:"flex justify-between items-start mb-1",children:[e.jsx("span",{className:"text-xs font-bold text-purple-600 dark:text-purple-400 uppercase tracking-wider",children:"AI Mnemonic"}),e.jsx("button",{onClick:()=>l(null),className:"text-text-muted hover:text-text",children:e.jsx(Z,{name:"x",className:"w-3 h-3"})})]}),e.jsx(xe,{html:S,className:"text-text font-medium"})]}):e.jsx(L,{variant:"ghost",size:"sm",onClick:E=>{E.stopPropagation(),k()},disabled:d,className:"rounded-full p-2 h-auto text-text-muted hover:text-purple-500",title:"Generate Mnemonic with AI",children:d?e.jsx(Oe,{size:"sm"}):e.jsx(Z,{name:"bot",className:"w-5 h-5"})})},yt=({card:a,isFlipped:d,onGenerateAudio:p,deckId:S,onReview:l,textSize:y="text-xl"})=>{const k=`${y} text-left text-text break-words prose dark:prose-invert max-w-none prose-img:mx-auto prose-img:max-h-64 prose-audio:mx-auto transition-all duration-200`,E=Te(a),{aiFeaturesEnabled:B}=Ue(),[h,g]=r.useState(null),[f,D]=r.useState({x:0,y:0}),[O,se]=r.useState(!1),re=r.useRef(null),I=100,Q=async F=>{p&&S&&await p(a,F)},J=F=>{!d||!l||(g({x:F.touches[0].clientX,y:F.touches[0].clientY}),se(!0))},ie=F=>{if(!h||!O)return;const ae=F.touches[0].clientX,he=F.touches[0].clientY,ue=ae-h.x,ge=he-h.y;D({x:ue,y:ge})},le=()=>{!O||!l||(f.x>I?l(X.Good):f.x<-I?l(X.Again):f.y<-I&&l(X.Easy),g(null),D({x:0,y:0}),se(!1))},A=Math.min(Math.max(f.x/(I*1.5),0),.8),ce=Math.min(Math.max(-f.x/(I*1.5),0),.8),_=Math.min(Math.max(-f.y/(I*1.5),0),.8),oe={transform:O?`translate(${f.x}px, ${f.y}px) rotate(${f.x*.05}deg)`:"none",transition:O?"none":"transform 0.3s ease-out",cursor:d&&l?"grab":"default"};return e.jsxs("div",{ref:re,className:"w-full relative touch-none select-none",style:oe,onTouchStart:J,onTouchMove:ie,onTouchEnd:le,children:[O&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"absolute inset-0 bg-green-500/30 rounded-lg pointer-events-none z-10 flex items-center justify-center",style:{opacity:A},children:e.jsx("span",{className:"text-4xl font-bold text-green-800 bg-white/50 px-4 py-2 rounded-lg backdrop-blur-sm",children:"GOOD"})}),e.jsx("div",{className:"absolute inset-0 bg-red-500/30 rounded-lg pointer-events-none z-10 flex items-center justify-center",style:{opacity:ce},children:e.jsx("span",{className:"text-4xl font-bold text-red-800 bg-white/50 px-4 py-2 rounded-lg backdrop-blur-sm",children:"AGAIN"})}),e.jsx("div",{className:"absolute inset-0 bg-blue-500/30 rounded-lg pointer-events-none z-10 flex items-center justify-center",style:{opacity:_},children:e.jsx("span",{className:"text-4xl font-bold text-blue-800 bg-white/50 px-4 py-2 rounded-lg backdrop-blur-sm",children:"EASY"})})]}),e.jsxs("div",{className:"w-full bg-surface rounded-lg shadow-lg border border-border",children:[a.css&&e.jsx("div",{dangerouslySetInnerHTML:{__html:a.css}}),e.jsxs("div",{className:"p-6 md:p-8 min-h-[12rem] lg:min-h-[20rem] flex flex-col items-center justify-center relative",children:[e.jsx("div",{className:"absolute top-4 right-4",children:e.jsx(_e,{audioData:a.frontAudio,onGenerate:()=>Q("front"),canGenerate:B&&!!p})}),e.jsx(xe,{html:a.front,className:k})]}),d&&e.jsxs("div",{className:"animate-fade-in",style:{animationDuration:"400ms"},children:[e.jsx("hr",{className:"border-border/50"}),e.jsxs("div",{className:"p-6 md:p-8 bg-background/30 dark:bg-black/10 relative",children:[e.jsxs("div",{className:"absolute top-4 right-4 flex gap-2",children:[B&&e.jsx(vt,{card:a}),e.jsx(_e,{audioData:a.backAudio,onGenerate:()=>Q("back"),canGenerate:B&&!!p})]}),e.jsx(xe,{html:a.back,className:k}),e.jsx("div",{className:"mt-6 pt-6 border-t border-border/50",children:e.jsx(He,{level:E})})]})]})]})]})},wt=({question:a,selectedAnswerId:d,onSelectAnswer:p,deckName:S,onShowInfo:l,textSize:y="text-xl"})=>{const k=d!==null,E=r.useMemo(()=>{const g=[...a.options||[]];for(let f=g.length-1;f>0;f--){const D=Math.floor(Math.random()*(f+1));[g[f],g[D]]=[g[D],g[f]]}return g},[a.id]),B=g=>{let f="flex items-start text-left w-full p-4 rounded-lg border-2 transition-all duration-200";if(!k)return`${f} bg-surface border-border hover:border-primary cursor-pointer`;const D=g.id===a.correctAnswerId,O=g.id===d;return D?`${f} border-green-500 bg-green-500/10 cursor-not-allowed`:O?`${f} border-red-500 bg-red-500/10 cursor-not-allowed`:`${f} border-border bg-background/50 cursor-not-allowed`},h=Te(a);return e.jsxs("div",{className:"bg-surface rounded-lg shadow-lg border border-border",children:[e.jsxs("div",{className:"p-6 md:p-8",children:[e.jsxs("div",{className:"mb-2",children:[a.tags&&a.tags.length>0&&e.jsx("div",{className:"flex flex-wrap items-center gap-1 mb-1",children:a.tags.map(g=>e.jsx("span",{className:"bg-border/50 text-text-muted text-xs px-2 py-0.5 rounded-full",children:g},g))}),S&&e.jsx("p",{className:"text-xs text-text-muted uppercase tracking-wider font-semibold",children:S})]}),e.jsx(xe,{html:a.questionText,className:`${y} font-semibold text-text transition-all duration-200`,as:"h3"})]}),e.jsx("div",{className:"px-6 md:px-8 pb-6 md:pb-8",children:e.jsx("div",{className:"space-y-3",children:E.map(g=>e.jsxs("button",{onClick:()=>p(g.id),disabled:k,className:B(g),"aria-pressed":d===g.id,children:[e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx(xe,{html:g.text,className:"prose dark:prose-invert max-w-none"}),k&&g.explanation&&e.jsx("p",{className:"text-xs mt-1 text-text-muted",children:g.explanation})]}),k&&e.jsx("div",{className:"ml-4 flex-shrink-0",children:g.id===a.correctAnswerId?e.jsx(Z,{name:"check-circle",className:"w-6 h-6 text-green-500"}):g.id===d?e.jsx(Z,{name:"x-circle",className:"w-6 h-6 text-red-500"}):null})]},g.id))})}),k&&e.jsxs("div",{className:"p-6 bg-background/30 dark:bg-black/10 border-t border-border/50 animate-fade-in",children:[a.detailedExplanation&&e.jsxs("div",{children:[e.jsx("h4",{className:"text-sm font-semibold uppercase tracking-wider text-text-muted mb-2",children:"Explanation"}),e.jsx(xe,{html:a.detailedExplanation,className:"prose dark:prose-invert max-w-none prose-sm"})]}),l&&e.jsx("div",{className:`flex justify-end ${a.detailedExplanation?"mt-4":""}`,children:e.jsxs(L,{variant:"ghost",size:"sm",onClick:l,children:[e.jsx(Z,{name:"info",className:"w-4 h-4 mr-1"}),"View Related Info"]})}),e.jsx("div",{className:a.detailedExplanation||l?"mt-6 pt-6 border-t border-border/50":"",children:e.jsx(He,{level:h})})]})]})},jt=({infoCard:a,textSize:d="text-lg"})=>{const p=`${d} text-left text-text break-words prose dark:prose-invert max-w-none prose-img:mx-auto prose-img:max-h-64 transition-all duration-200`;return e.jsx("div",{className:"w-full bg-surface rounded-lg shadow-lg border border-border",children:e.jsx("div",{className:"p-6 md:p-8 min-h-[12rem] lg:min-h-[20rem] flex items-center justify-center",children:e.jsx(xe,{html:a.content,className:p})})})},Nt=({isOpen:a,onClose:d,infoCards:p})=>{const S=r.useRef(null);return Ze(S,a),a?e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-75 flex items-center justify-center z-[60] p-4",children:e.jsxs("div",{ref:S,className:"bg-surface rounded-lg shadow-xl w-full max-w-2xl transform transition-all relative max-h-[90vh] flex flex-col",role:"dialog","aria-modal":"true","aria-labelledby":"info-modal-title",children:[e.jsxs("div",{className:"flex-shrink-0 flex justify-between items-center p-4 border-b border-border",children:[e.jsx("h2",{id:"info-modal-title",className:"text-xl font-bold text-text",children:"Related Information"}),e.jsx(L,{type:"button",variant:"ghost",onClick:d,className:"p-1 h-auto","aria-label":"Close",children:e.jsx(Z,{name:"x"})})]}),e.jsx("div",{className:"p-6 overflow-y-auto space-y-6",children:p.map((l,y)=>e.jsxs("div",{children:[e.jsx(xe,{html:l.content,className:"prose dark:prose-invert max-w-none"}),y<p.length-1&&e.jsx("hr",{className:"my-6 border-border"})]},l.id))}),e.jsx("div",{className:"flex-shrink-0 flex justify-end p-4 bg-background/50 border-t border-border",children:e.jsx(L,{type:"button",variant:"primary",onClick:d,children:"Close"})})]})}):null},Mt=(a,d,p)=>{const[S,l]=r.useState([]),[y,k]=r.useState(!1),[E,B]=r.useState(new Set),[h,g]=r.useState(new Set),[f,D]=r.useState(0),[O,se]=r.useState(0),{learningProgress:re}=qe();return r.useEffect(()=>{(async()=>{var le;if(y)return;const Q=a.type===Ce.Learning,J=Q?a.learningMode:"separate";if(p){const A=(a.type===Ce.Flashcard?a.cards:a.questions)||[];l(A),D(0),se(0),k(!0);return}let ie=!1;try{const A=await ut(d);((le=A==null?void 0:A.reviewQueue)==null?void 0:le.length)>0&&typeof A.currentIndex=="number"?(l(A.reviewQueue),D(A.currentIndex),se(A.itemsCompleted??A.currentIndex),ie=!0):A&&await Le(d)}catch(A){console.error("Failed to load saved session from DB",A)}if(!ie){const A=new Date;if(A.setHours(23,59,59,999),Q&&J==="mixed"){const ce=a,_=re[a.id],oe=new Set((_==null?void 0:_.readInfoCardIds)||[]),F=[],ae=ce.questions||[];(ce.infoCards||[]).forEach(G=>{F.push(G);const de=ae.filter(fe=>{var pe;return(pe=fe.infoCardIds)==null?void 0:pe.includes(G.id)});F.push(...de)});let he=0;for(let G=0;G<F.length;G++){const de=F[G];if("content"in de&&!oe.has(de.id)){he=G;break}}const ue=F.slice(he),ge=new Set(ue.map(G=>G.id)),we=ae.filter(G=>!ge.has(G.id)&&!G.suspended&&new Date(G.dueDate)<=A&&((_==null?void 0:_.unlockedQuestionIds)||[]).includes(G.id));l([...we,...ue])}else if(Q){const ce=a,_=re[a.id],oe=new Set((_==null?void 0:_.unlockedQuestionIds)||[]),F=(ce.questions||[]).filter(ae=>!ae.suspended&&new Date(ae.dueDate)<=A&&oe.has(ae.id)).sort(()=>Math.random()-.5);l(F)}else{const _=((a.type===Ce.Flashcard?a.cards:a.questions)||[]).filter(oe=>!oe.suspended&&new Date(oe.dueDate)<=A).sort(()=>Math.random()-.5);l(_)}D(0),se(0)}k(!0)})()},[a,d,p,y,re]),{sessionQueue:S,setSessionQueue:l,isSessionInitialized:y,initialIndex:f,initialItemsCompleted:O,readInfoCardIds:E,setReadInfoCardIds:B,unlockedQuestionIds:h,setUnlockedQuestionIds:g}};var Be={};(function a(d,p,S,l){var y=!!(d.Worker&&d.Blob&&d.Promise&&d.OffscreenCanvas&&d.OffscreenCanvasRenderingContext2D&&d.HTMLCanvasElement&&d.HTMLCanvasElement.prototype.transferControlToOffscreen&&d.URL&&d.URL.createObjectURL),k=typeof Path2D=="function"&&typeof DOMMatrix=="function",E=(function(){if(!d.OffscreenCanvas)return!1;var s=new OffscreenCanvas(1,1),t=s.getContext("2d");t.fillRect(0,0,1,1);var o=s.transferToImageBitmap();try{t.createPattern(o,"no-repeat")}catch{return!1}return!0})();function B(){}function h(s){var t=p.exports.Promise,o=t!==void 0?t:d.Promise;return typeof o=="function"?new o(s):(s(B,B),null)}var g=(function(s,t){return{transform:function(o){if(s)return o;if(t.has(o))return t.get(o);var x=new OffscreenCanvas(o.width,o.height),b=x.getContext("2d");return b.drawImage(o,0,0),t.set(o,x),x},clear:function(){t.clear()}}})(E,new Map),f=(function(){var s=Math.floor(16.666666666666668),t,o,x={},b=0;return typeof requestAnimationFrame=="function"&&typeof cancelAnimationFrame=="function"?(t=function(w){var j=Math.random();return x[j]=requestAnimationFrame(function u(m){b===m||b+s-1<m?(b=m,delete x[j],w()):x[j]=requestAnimationFrame(u)}),j},o=function(w){x[w]&&cancelAnimationFrame(x[w])}):(t=function(w){return setTimeout(w,s)},o=function(w){return clearTimeout(w)}),{frame:t,cancel:o}})(),D=(function(){var s,t,o={};function x(b){function w(j,u){b.postMessage({options:j||{},callback:u})}b.init=function(u){var m=u.transferControlToOffscreen();b.postMessage({canvas:m},[m])},b.fire=function(u,m,T){if(t)return w(u,null),t;var z=Math.random().toString(36).slice(2);return t=h(function(R){function N(U){U.data.callback===z&&(delete o[z],b.removeEventListener("message",N),t=null,g.clear(),T(),R())}b.addEventListener("message",N),w(u,z),o[z]=N.bind(null,{data:{callback:z}})}),t},b.reset=function(){b.postMessage({reset:!0});for(var u in o)o[u](),delete o[u]}}return function(){if(s)return s;if(!S&&y){var b=["var CONFETTI, SIZE = {}, module = {};","("+a.toString()+")(this, module, true, SIZE);","onmessage = function(msg) {","  if (msg.data.options) {","    CONFETTI(msg.data.options).then(function () {","      if (msg.data.callback) {","        postMessage({ callback: msg.data.callback });","      }","    });","  } else if (msg.data.reset) {","    CONFETTI && CONFETTI.reset();","  } else if (msg.data.resize) {","    SIZE.width = msg.data.resize.width;","    SIZE.height = msg.data.resize.height;","  } else if (msg.data.canvas) {","    SIZE.width = msg.data.canvas.width;","    SIZE.height = msg.data.canvas.height;","    CONFETTI = module.exports.create(msg.data.canvas);","  }","}"].join(`
`);try{s=new Worker(URL.createObjectURL(new Blob([b])))}catch(w){return typeof console!==void 0&&typeof console.warn=="function"&&console.warn("ðŸŽŠ Could not load worker",w),null}x(s)}return s}})(),O={particleCount:50,angle:90,spread:45,startVelocity:45,decay:.9,gravity:1,drift:0,ticks:200,x:.5,y:.5,shapes:["square","circle"],zIndex:100,colors:["#26ccff","#a25afd","#ff5e7e","#88ff5a","#fcff42","#ffa62d","#ff36ff"],disableForReducedMotion:!1,scalar:1};function se(s,t){return t?t(s):s}function re(s){return s!=null}function I(s,t,o){return se(s&&re(s[t])?s[t]:O[t],o)}function Q(s){return s<0?0:Math.floor(s)}function J(s,t){return Math.floor(Math.random()*(t-s))+s}function ie(s){return parseInt(s,16)}function le(s){return s.map(A)}function A(s){var t=String(s).replace(/[^0-9a-f]/gi,"");return t.length<6&&(t=t[0]+t[0]+t[1]+t[1]+t[2]+t[2]),{r:ie(t.substring(0,2)),g:ie(t.substring(2,4)),b:ie(t.substring(4,6))}}function ce(s){var t=I(s,"origin",Object);return t.x=I(t,"x",Number),t.y=I(t,"y",Number),t}function _(s){s.width=document.documentElement.clientWidth,s.height=document.documentElement.clientHeight}function oe(s){var t=s.getBoundingClientRect();s.width=t.width,s.height=t.height}function F(s){var t=document.createElement("canvas");return t.style.position="fixed",t.style.top="0px",t.style.left="0px",t.style.pointerEvents="none",t.style.zIndex=s,t}function ae(s,t,o,x,b,w,j,u,m){s.save(),s.translate(t,o),s.rotate(w),s.scale(x,b),s.arc(0,0,1,j,u,m),s.restore()}function he(s){var t=s.angle*(Math.PI/180),o=s.spread*(Math.PI/180);return{x:s.x,y:s.y,wobble:Math.random()*10,wobbleSpeed:Math.min(.11,Math.random()*.1+.05),velocity:s.startVelocity*.5+Math.random()*s.startVelocity,angle2D:-t+(.5*o-Math.random()*o),tiltAngle:(Math.random()*(.75-.25)+.25)*Math.PI,color:s.color,shape:s.shape,tick:0,totalTicks:s.ticks,decay:s.decay,drift:s.drift,random:Math.random()+2,tiltSin:0,tiltCos:0,wobbleX:0,wobbleY:0,gravity:s.gravity*3,ovalScalar:.6,scalar:s.scalar,flat:s.flat}}function ue(s,t){t.x+=Math.cos(t.angle2D)*t.velocity+t.drift,t.y+=Math.sin(t.angle2D)*t.velocity+t.gravity,t.velocity*=t.decay,t.flat?(t.wobble=0,t.wobbleX=t.x+10*t.scalar,t.wobbleY=t.y+10*t.scalar,t.tiltSin=0,t.tiltCos=0,t.random=1):(t.wobble+=t.wobbleSpeed,t.wobbleX=t.x+10*t.scalar*Math.cos(t.wobble),t.wobbleY=t.y+10*t.scalar*Math.sin(t.wobble),t.tiltAngle+=.1,t.tiltSin=Math.sin(t.tiltAngle),t.tiltCos=Math.cos(t.tiltAngle),t.random=Math.random()+2);var o=t.tick++/t.totalTicks,x=t.x+t.random*t.tiltCos,b=t.y+t.random*t.tiltSin,w=t.wobbleX+t.random*t.tiltCos,j=t.wobbleY+t.random*t.tiltSin;if(s.fillStyle="rgba("+t.color.r+", "+t.color.g+", "+t.color.b+", "+(1-o)+")",s.beginPath(),k&&t.shape.type==="path"&&typeof t.shape.path=="string"&&Array.isArray(t.shape.matrix))s.fill(fe(t.shape.path,t.shape.matrix,t.x,t.y,Math.abs(w-x)*.1,Math.abs(j-b)*.1,Math.PI/10*t.wobble));else if(t.shape.type==="bitmap"){var u=Math.PI/10*t.wobble,m=Math.abs(w-x)*.1,T=Math.abs(j-b)*.1,z=t.shape.bitmap.width*t.scalar,R=t.shape.bitmap.height*t.scalar,N=new DOMMatrix([Math.cos(u)*m,Math.sin(u)*m,-Math.sin(u)*T,Math.cos(u)*T,t.x,t.y]);N.multiplySelf(new DOMMatrix(t.shape.matrix));var U=s.createPattern(g.transform(t.shape.bitmap),"no-repeat");U.setTransform(N),s.globalAlpha=1-o,s.fillStyle=U,s.fillRect(t.x-z/2,t.y-R/2,z,R),s.globalAlpha=1}else if(t.shape==="circle")s.ellipse?s.ellipse(t.x,t.y,Math.abs(w-x)*t.ovalScalar,Math.abs(j-b)*t.ovalScalar,Math.PI/10*t.wobble,0,2*Math.PI):ae(s,t.x,t.y,Math.abs(w-x)*t.ovalScalar,Math.abs(j-b)*t.ovalScalar,Math.PI/10*t.wobble,0,2*Math.PI);else if(t.shape==="star")for(var v=Math.PI/2*3,$=4*t.scalar,V=8*t.scalar,P=t.x,q=t.y,H=5,K=Math.PI/H;H--;)P=t.x+Math.cos(v)*V,q=t.y+Math.sin(v)*V,s.lineTo(P,q),v+=K,P=t.x+Math.cos(v)*$,q=t.y+Math.sin(v)*$,s.lineTo(P,q),v+=K;else s.moveTo(Math.floor(t.x),Math.floor(t.y)),s.lineTo(Math.floor(t.wobbleX),Math.floor(b)),s.lineTo(Math.floor(w),Math.floor(j)),s.lineTo(Math.floor(x),Math.floor(t.wobbleY));return s.closePath(),s.fill(),t.tick<t.totalTicks}function ge(s,t,o,x,b){var w=t.slice(),j=s.getContext("2d"),u,m,T=h(function(z){function R(){u=m=null,j.clearRect(0,0,x.width,x.height),g.clear(),b(),z()}function N(){S&&!(x.width===l.width&&x.height===l.height)&&(x.width=s.width=l.width,x.height=s.height=l.height),!x.width&&!x.height&&(o(s),x.width=s.width,x.height=s.height),j.clearRect(0,0,x.width,x.height),w=w.filter(function(U){return ue(j,U)}),w.length?u=f.frame(N):R()}u=f.frame(N),m=R});return{addFettis:function(z){return w=w.concat(z),T},canvas:s,promise:T,reset:function(){u&&f.cancel(u),m&&m()}}}function we(s,t){var o=!s,x=!!I(t||{},"resize"),b=!1,w=I(t,"disableForReducedMotion",Boolean),j=y&&!!I(t||{},"useWorker"),u=j?D():null,m=o?_:oe,T=s&&u?!!s.__confetti_initialized:!1,z=typeof matchMedia=="function"&&matchMedia("(prefers-reduced-motion)").matches,R;function N(v,$,V){for(var P=I(v,"particleCount",Q),q=I(v,"angle",Number),H=I(v,"spread",Number),K=I(v,"startVelocity",Number),je=I(v,"decay",Number),Ee=I(v,"gravity",Number),Ne=I(v,"drift",Number),Ie=I(v,"colors",le),Se=I(v,"ticks",Number),i=I(v,"shapes"),De=I(v,"scalar"),W=!!I(v,"flat"),ee=ce(v),me=P,ne=[],Ae=s.width*ee.x,ke=s.height*ee.y;me--;)ne.push(he({x:Ae,y:ke,angle:q,spread:H,startVelocity:K,color:Ie[me%Ie.length],shape:i[J(0,i.length)],ticks:Se,decay:je,gravity:Ee,drift:Ne,scalar:De,flat:W}));return R?R.addFettis(ne):(R=ge(s,ne,m,$,V),R.promise)}function U(v){var $=w||I(v,"disableForReducedMotion",Boolean),V=I(v,"zIndex",Number);if($&&z)return h(function(K){K()});o&&R?s=R.canvas:o&&!s&&(s=F(V),document.body.appendChild(s)),x&&!T&&m(s);var P={width:s.width,height:s.height};u&&!T&&u.init(s),T=!0,u&&(s.__confetti_initialized=!0);function q(){if(u){var K={getBoundingClientRect:function(){if(!o)return s.getBoundingClientRect()}};m(K),u.postMessage({resize:{width:K.width,height:K.height}});return}P.width=P.height=null}function H(){R=null,x&&(b=!1,d.removeEventListener("resize",q)),o&&s&&(document.body.contains(s)&&document.body.removeChild(s),s=null,T=!1)}return x&&!b&&(b=!0,d.addEventListener("resize",q,!1)),u?u.fire(v,P,H):N(v,P,H)}return U.reset=function(){u&&u.reset(),R&&R.reset()},U}var G;function de(){return G||(G=we(null,{useWorker:!0,resize:!0})),G}function fe(s,t,o,x,b,w,j){var u=new Path2D(s),m=new Path2D;m.addPath(u,new DOMMatrix(t));var T=new Path2D;return T.addPath(m,new DOMMatrix([Math.cos(j)*b,Math.sin(j)*b,-Math.sin(j)*w,Math.cos(j)*w,o,x])),T}function pe(s){if(!k)throw new Error("path confetti are not supported in this browser");var t,o;typeof s=="string"?t=s:(t=s.path,o=s.matrix);var x=new Path2D(t),b=document.createElement("canvas"),w=b.getContext("2d");if(!o){for(var j=1e3,u=j,m=j,T=0,z=0,R,N,U=0;U<j;U+=2)for(var v=0;v<j;v+=2)w.isPointInPath(x,U,v,"nonzero")&&(u=Math.min(u,U),m=Math.min(m,v),T=Math.max(T,U),z=Math.max(z,v));R=T-u,N=z-m;var $=10,V=Math.min($/R,$/N);o=[V,0,0,V,-Math.round(R/2+u)*V,-Math.round(N/2+m)*V]}return{type:"path",path:t,matrix:o}}function be(s){var t,o=1,x="#000000",b='"Apple Color Emoji", "Segoe UI Emoji", "Segoe UI Symbol", "Noto Color Emoji", "EmojiOne Color", "Android Emoji", "Twemoji Mozilla", "system emoji", sans-serif';typeof s=="string"?t=s:(t=s.text,o="scalar"in s?s.scalar:o,b="fontFamily"in s?s.fontFamily:b,x="color"in s?s.color:x);var w=10*o,j=""+w+"px "+b,u=new OffscreenCanvas(w,w),m=u.getContext("2d");m.font=j;var T=m.measureText(t),z=Math.ceil(T.actualBoundingBoxRight+T.actualBoundingBoxLeft),R=Math.ceil(T.actualBoundingBoxAscent+T.actualBoundingBoxDescent),N=2,U=T.actualBoundingBoxLeft+N,v=T.actualBoundingBoxAscent+N;z+=N+N,R+=N+N,u=new OffscreenCanvas(z,R),m=u.getContext("2d"),m.font=j,m.fillStyle=x,m.fillText(t,U,v);var $=1/o;return{type:"bitmap",bitmap:u.transferToImageBitmap(),matrix:[$,0,0,$,-z*$/2,-R*$/2]}}p.exports=function(){return de().apply(this,arguments)},p.exports.reset=function(){de().reset()},p.exports.create=we,p.exports.shapeFromPath=pe,p.exports.shapeFromText=be})((function(){return typeof window<"u"?window:typeof self<"u"?self:this||{}})(),Be,!1);const ze=Be.exports;Be.exports.create;const Ge=()=>(r.useEffect(()=>{const d=Date.now()+1e3,S={startVelocity:30,spread:360,ticks:90,zIndex:99,colors:["#60a5fa","#5eead4","#a78bfa","#fde047","#f9fafb"]};function l(k,E){return Math.random()*(E-k)+k}const y=window.setInterval(()=>{const k=d-Date.now();if(k<=0)return clearInterval(y);const E=50*(k/1e3);ze({...S,particleCount:E,origin:{x:l(.1,.3),y:Math.random()-.2}}),ze({...S,particleCount:E,origin:{x:l(.7,.9),y:Math.random()-.2}})},250);return()=>{clearInterval(y),ze.reset()}},[]),null),Ct=({deckId:a,seriesId:d,reviewedItems:p,nextDeckId:S,onSessionEnd:l,onStudyNextDeck:y,isCramSession:k})=>{if(k)return e.jsxs("div",{className:"text-center p-8 animate-fade-in relative",children:[e.jsx(Ge,{}),e.jsx("h2",{className:"text-2xl font-bold text-green-500",children:"Cram Session Complete!"}),e.jsxs("p",{className:"text-text-muted mt-2",children:["You've reviewed all ",p.length," items in this deck."]}),e.jsx(L,{onClick:()=>l(a,d),className:"mt-8",children:"Finish Session"})]});const E=p.reduce((g,{rating:f})=>(f&&(g[f]=(g[f]||0)+1),g),{}),B=p.map(({oldItem:g,newItem:f})=>{const D=Te(g);return(f.masteryLevel||0)-D}),h=B.length>0?B.reduce((g,f)=>g+f,0)/B.length*100:0;return e.jsxs("div",{className:"text-center p-8 animate-fade-in relative",children:[e.jsx(Ge,{}),e.jsx("h2",{className:"text-2xl font-bold text-green-500",children:"Session Complete!"}),e.jsxs("p",{className:"text-text-muted mt-2",children:["You reviewed ",p.length," item",p.length!==1?"s":"","."]}),e.jsxs("div",{className:"mt-8 max-w-sm mx-auto bg-surface p-4 rounded-lg border border-border",children:[e.jsx("h3",{className:"font-semibold text-lg mb-3",children:"Session Summary"}),e.jsxs("div",{className:"flex justify-around text-center",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-2xl font-bold text-red-500",children:E[X.Again]||0}),e.jsx("p",{className:"text-xs text-text-muted",children:"Forgot"})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-2xl font-bold text-orange-500",children:E[X.Hard]||0}),e.jsx("p",{className:"text-xs text-text-muted",children:"Struggled"})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-2xl font-bold text-green-500",children:E[X.Good]||0}),e.jsx("p",{className:"text-xs text-text-muted",children:"Knew It"})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-2xl font-bold text-blue-500",children:E[X.Easy]||0}),e.jsx("p",{className:"text-xs text-text-muted",children:"Mastered"})]})]}),e.jsx("div",{className:"mt-4 text-sm",children:e.jsxs("p",{children:["Average Mastery Change: ",e.jsxs("strong",{className:h>=0?"text-green-500":"text-red-500",children:[h>=0?"+":"",h.toFixed(1),"%"]})]})})]}),e.jsxs("div",{className:"flex flex-col sm:flex-row justify-center items-center gap-4 mt-8",children:[S&&y&&d&&e.jsxs(L,{onClick:()=>y(a,d,S),variant:"primary",size:"lg",children:[e.jsx(Z,{name:"zap",className:"w-5 h-5 mr-2"}),"Start Next Deck"]}),e.jsx(L,{onClick:()=>l(a,d),variant:S?"secondary":"primary",size:"lg",children:"Finish Session"})]})]})},It=({isCurrent:a,isHistorical:d,isFlipped:p,isAnswered:S,isReviewing:l,isQuiz:y,isInfoCard:k,isCramSession:E,showNavArrows:B,displayIndex:h,currentIndex:g,queueLength:f,onReview:D,onSuspend:O,onReadInfoCard:se,onFlip:re,onReturnToCurrent:I,onNavigatePrevious:Q,onNavigateNext:J,itemsCompleted:ie,totalSessionItems:le})=>{const A=(p||y&&S)&&a;return e.jsxs("div",{className:"flex-shrink-0 mt-4 flex flex-col items-center justify-center space-y-4 min-h-[10rem]",children:[e.jsx("div",{className:"w-full flex-grow flex items-center justify-center",children:d?e.jsxs("div",{className:"text-center animate-fade-in",children:[e.jsx(L,{onClick:I,variant:"primary",className:"text-lg py-3",children:"Return to Current Item"}),e.jsx("div",{className:"text-xs mt-2 font-semibold text-yellow-600 dark:text-yellow-400",children:"(Reviewing Past Item)"})]}):A?e.jsxs("div",{className:"space-y-4 animate-fade-in w-full",children:[e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[e.jsx(L,{onClick:()=>D(X.Again),className:"bg-red-600 hover:bg-red-700 focus:ring-red-500 py-3 text-base text-white",disabled:l,children:"Forgot"}),e.jsx(L,{onClick:()=>D(X.Hard),className:"bg-orange-500 hover:bg-orange-600 focus:ring-orange-400 py-3 text-base text-white",disabled:l,children:"Struggled"}),e.jsx(L,{onClick:()=>D(X.Good),className:"bg-green-600 hover:bg-green-700 focus:ring-green-500 py-3 text-base text-white",disabled:l,children:"Knew It"}),e.jsx(L,{onClick:()=>D(X.Easy),className:"bg-blue-600 hover:bg-blue-700 focus:ring-blue-500 py-3 text-base text-white",disabled:l,children:"Mastered"})]}),!E&&e.jsx("div",{className:"text-center",children:e.jsxs(L,{variant:"ghost",onClick:O,className:"text-xs",disabled:l,children:[e.jsx(Z,{name:"eye-off",className:"w-4 h-4 mr-1"})," Suspend this item"]})})]}):k&&a?e.jsx(L,{onClick:se,variant:"primary",className:"w-full max-w-md text-lg py-3 animate-fade-in mx-auto flex items-center justify-center",children:"Continue"}):!y&&a&&e.jsx(L,{onClick:re,variant:"primary",className:"w-full max-w-md text-lg py-3 animate-fade-in mx-auto flex items-center justify-center",children:"Show Answer"})}),B&&e.jsxs("div",{className:"flex justify-center items-center w-full max-w-xs gap-4 animate-fade-in h-12",children:[e.jsx(L,{variant:"ghost",onClick:Q,disabled:h===0,className:"p-3 rounded-full disabled:opacity-30","aria-label":"Previous item",children:e.jsx(Z,{name:"chevron-left",className:"w-8 h-8"})}),e.jsx("div",{className:"text-center w-28",children:e.jsxs("span",{className:"text-sm text-text-muted",children:["Item ",Math.min(ie+1,le)," of ",le]})}),e.jsx(L,{variant:"ghost",onClick:J,disabled:h>=g,className:"p-3 rounded-full disabled:opacity-30","aria-label":"Next item",children:e.jsx(Z,{name:"chevron-left",className:"w-8 h-8 rotate-180"})})]})]})},St=({isOpen:a,onClose:d,title:p,explanation:S})=>{const l=r.useRef(null);return Ze(l,a),a?e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-75 flex items-center justify-center z-[60] p-4 animate-fade-in",children:e.jsxs("div",{ref:l,className:"bg-surface rounded-lg shadow-xl w-full max-w-lg transform transition-all relative flex flex-col max-h-[80vh]",role:"dialog","aria-modal":"true","aria-labelledby":"explanation-title",children:[e.jsxs("div",{className:"flex-shrink-0 flex justify-between items-center p-4 border-b border-border",children:[e.jsxs("h2",{id:"explanation-title",className:"text-xl font-bold text-text flex items-center gap-2",children:[e.jsx(Z,{name:"bot",className:"w-6 h-6 text-primary"}),"Explain Like I'm 5"]}),e.jsx(L,{type:"button",variant:"ghost",onClick:d,className:"p-1 h-auto","aria-label":"Close",children:e.jsx(Z,{name:"x"})})]}),e.jsxs("div",{className:"p-6 overflow-y-auto",children:[e.jsxs("div",{className:"mb-4",children:[e.jsx("h3",{className:"text-sm font-semibold text-text-muted uppercase tracking-wider mb-1",children:"Concept"}),e.jsx("p",{className:"text-text font-medium",children:p})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-sm font-semibold text-text-muted uppercase tracking-wider mb-2",children:"Explanation"}),e.jsx("div",{className:"bg-primary/5 p-4 rounded-lg border border-primary/20",children:e.jsx(xe,{html:S,className:"prose dark:prose-invert max-w-none text-text"})})]})]}),e.jsx("div",{className:"flex-shrink-0 flex justify-end p-4 bg-background/50 border-t border-border",children:e.jsx(L,{type:"button",variant:"primary",onClick:d,children:"Got it!"})})]})}):null},At=({deck:a,onSessionEnd:d,onItemReviewed:p,onUpdateLastOpened:S,sessionKeySuffix:l="",seriesId:y,onStudyNextDeck:k})=>{const[E,B]=r.useState([]),[h,g]=r.useState(0),[f,D]=r.useState(0),[O,se]=r.useState(!1),[re,I]=r.useState(null),[Q,J]=r.useState(!1),[ie,le]=r.useState(!1),[A,ce]=r.useState([]),[_,oe]=r.useState(0),[F,ae]=r.useState(0),[he,ue]=r.useState(!1),[ge,we]=r.useState(""),[G,de]=r.useState(!1),[fe,pe]=r.useState(!1),[be,s]=r.useState("normal"),[t,o]=r.useState(!1),x=r.useRef(null),{hapticsEnabled:b,aiFeaturesEnabled:w,leechThreshold:j,leechAction:u}=Ue(),{addToast:m}=We(),{deckSeries:T,seriesProgress:z,learningProgress:R}=qe(),N=mt(),U=y?T[y]:null,v=r.useMemo(()=>a.id==="general-study-deck"||["_cram","_flip","_reversed"].includes(l),[a.id,l]),$=`session_deck_${a.id}${l}`,V=a.type==="learning",{sessionQueue:P,setSessionQueue:q,isSessionInitialized:H,initialIndex:K,readInfoCardIds:je,setReadInfoCardIds:Ee,unlockedQuestionIds:Ne,setUnlockedQuestionIds:Ie,initialItemsCompleted:Se}=Mt(a,$,v);r.useEffect(()=>{H&&window.scrollTo({top:0,left:0,behavior:"instant"})},[h,H]),r.useEffect(()=>{var c,M;if(!H)return;let n=0;v?n=(a.type===Ce.Flashcard?(c=a.cards)==null?void 0:c.length:(M=a.questions)==null?void 0:M.length)||0:a.type===Ce.Learning&&a.learningMode==="mixed"?n=P.length+F:n=P.length,oe(C=>Math.max(C,n))},[H,a,v,P,F]),r.useEffect(()=>{H&&(g(K),D(K),ae(Se))},[H,K,Se]),r.useEffect(()=>{S(a.id)},[a.id,S]),r.useEffect(()=>{if(!v&&H&&h<P.length){const n={id:$,reviewQueue:P,currentIndex:h,readInfoCardIds:Array.from(je),unlockedQuestionIds:Array.from(Ne),itemsCompleted:F};xt($,n).catch(c=>{console.error("Could not save session state to DB",c),m("Could not save session progress.","error")})}},[P,h,je,Ne,$,v,H,m,F]),r.useEffect(()=>{const n=c=>{x.current&&!x.current.contains(c.target)&&pe(!1)};return fe&&document.addEventListener("mousedown",n),()=>{document.removeEventListener("mousedown",n)}},[fe]);const i=r.useMemo(()=>P[f],[P,f]),De=f<h,W=f===h,ee=i&&"questionText"in i,me=i&&"content"in i&&!("front"in i),ne=re!==null,{title:Ae,subtitle:ke,titleLink:Ve}=r.useMemo(()=>{const n=i&&"originalDeckName"in i?i.originalDeckName:void 0,c=i&&"originalDeckId"in i?i.originalDeckId:a.id,M=i&&"originalSeriesName"in i?i.originalSeriesName:void 0,C=i&&"originalSeriesId"in i?i.originalSeriesId:void 0;if(a.id==="general-study-deck"){const te=M||n||"General Study",Y=C?`/series/${C}`:`/decks/${c}`;return{title:te,subtitle:M?n:void 0,titleLink:Y}}else{const te=a.name,Y=`/decks/${a.id}${y?`?seriesId=${y}`:""}`;return{title:te,subtitle:void 0,titleLink:Y}}},[i,a.id,a.name,y,U]),Ye=r.useMemo(()=>{if(!y||F<_)return null;const n=T[y];if(!n)return null;const c=(n.levels||[]).flatMap(C=>C.deckIds||[]),M=c.indexOf(a.id);if(M>-1&&M<c.length-1){const C=z.get(y)||new Set,te=M+1;if(te<=C.size)return c[te]}return null},[y,a.id,T,F,_,z]),ve=r.useCallback(()=>{se(!1),I(null),ae(c=>c+1);const n=h+1;g(n),D(n),n>=P.length&&!v&&Le($).catch(c=>console.error("Failed to delete session state",c))},[h,P.length,v,$]),ye=r.useCallback(async n=>{if(!i||!W||Q||!("interval"in i))return;if(l==="_cram"){J(!0),ve(),J(!1);return}J(!0),b&&"vibrate"in navigator&&navigator.vibrate(20);let c=ht(i,n);const M=j||8;if((c.lapses||0)>=M&&!i.suspended)if(u==="suspend")c={...c,suspended:!0},m("Item suspended (Leech).","info");else if(u==="tag"){const C=c.tags||c.tags||[];C.includes("leech")||(c.tags=[...C,"leech"],m("Item tagged as Leech.","info"))}else u==="warn"&&m("Warning: You are struggling with this item.","warning");Te(i)<=.85&&(c.masteryLevel||0)>.85&&m("Item Mastered!","success"),B(C=>[...C,{oldItem:i,newItem:c,rating:n}]);try{const C=i.originalDeckId||a.id;await p(C,c,n,y)}catch(C){console.error("Failed to save review:",C),m("Failed to save review progress for this card.","error")}finally{q(C=>C.map((te,Y)=>Y===h?c:te)),setTimeout(()=>{ve(),J(!1)},800)}},[i,W,Q,l,ve,b,m,a.id,p,y,h,q,j,u]),Xe=r.useCallback(async()=>{if(!i||!W||Q||!("interval"in i))return;const n=i;J(!0);const c={...n,suspended:!0};B(M=>[...M,{oldItem:n,newItem:c,rating:null}]);try{const M=n.originalDeckId||a.id;await p(M,c,null,y),m("Item suspended.","info")}catch(M){console.error("Failed to suspend item:",M),m("Failed to suspend item.","error")}finally{q(M=>M.map((C,te)=>te===h?c:C)),setTimeout(()=>{ve(),J(!1)},500)}},[i,W,Q,ve,m,a.id,p,y,h,q]),Fe=r.useCallback(()=>{W&&se(!0)},[W]),Je=r.useCallback(n=>{W&&!ne&&(I(n),q(c=>{const M=[...c],C=M[h];return C&&"questionText"in C&&(M[h]={...C,userSelectedAnswerId:n}),M}))},[W,ne,h,q]),Re=r.useCallback(async()=>{if(W&&me){const n=i,c=Array.from(new Set([...Array.from(je),n.id])),M=Array.from(new Set([...Array.from(Ne),...n.unlocksQuestionIds]));Ee(new Set(c)),Ie(new Set(M)),N!=null&&N.handleUpdateLearningProgress&&await N.handleUpdateLearningProgress({deckId:a.id,readInfoCardIds:c,unlockedQuestionIds:M,lastReadCardId:n.id}),ve()}},[W,me,i,je,Ne,a.id,N,ve]),Ke=r.useCallback(()=>{f>0&&D(n=>n-1)},[f]),et=r.useCallback(()=>{f<h&&D(n=>n+1)},[f,h]),tt=r.useCallback(()=>D(h),[h]),st=r.useCallback(()=>{if(ee){const c=i.infoCardIds||[];if(c.length>0){const M=a.infoCards.filter(C=>c.includes(C.id));ce(M),le(!0)}}},[ee,i,a]),at=r.useCallback(async(n,c)=>{const M=n.originalDeckId||a.id,C=await(N==null?void 0:N.handleGenerateAudioForCard(M,n,c));return C&&q(te=>te.map(Y=>Y.id===n.id?{...Y,[c==="front"?"frontAudio":"backAudio"]:C}:Y)),C},[a.id,N,q]),nt=async()=>{var n;if(i){de(!0);try{let c="",M="";if("questionText"in i){const Y=i,$e=((n=Y.options.find(ot=>ot.id===Y.correctAnswerId))==null?void 0:n.text)||"";c=`${Y.questionText} Answer: ${$e}`,M=`The user is studying a quiz about "${a.name}".`}else if("front"in i){const Y=i;c=`${Y.front} = ${Y.back}`,M=`The user is studying flashcards about "${a.name}".`}const C=Me(c),te=await gt(C,M);we(te),ue(!0)}catch{m("Failed to generate explanation.","error")}finally{de(!1)}}},rt=r.useCallback(async()=>{if(V){const n=a,c=n.learningMode==="mixed"?"separate":"mixed";await Le($),await(N==null?void 0:N.handleUpdateDeck({...n,learningMode:c},{silent:!0})),m(`Switched to ${c==="mixed"?"Mixed Course":"Review Only"} mode.`,"success"),window.location.reload()}},[a,V,$,N,m]),it=r.useMemo(()=>({Space:n=>{!W||Q||(n.preventDefault(),!ee&&!O?Fe():me&&Re())},Digit1:n=>{if(!W||Q)return;(O||ee&&ne)&&(n.preventDefault(),ye(X.Again))},Digit2:n=>{if(!W||Q)return;(O||ee&&ne)&&(n.preventDefault(),ye(X.Hard))},Digit3:n=>{if(!W||Q)return;(O||ee&&ne)&&(n.preventDefault(),ye(X.Good))},Digit4:n=>{if(!W||Q)return;(O||ee&&ne)&&(n.preventDefault(),ye(X.Easy))}}),[W,Q,O,ee,me,ne,Fe,Re,ye]);bt(it);const Pe=r.useMemo(()=>{switch(be){case"large":return"text-lg md:text-xl";case"huge":return"text-xl md:text-2xl";case"normal":default:return"text-base md:text-lg"}},[be]);if(!H)return e.jsx("div",{className:"text-center p-8",children:"Loading session..."});if(H&&P.length===0&&!v)return e.jsxs("div",{className:"text-center p-8 animate-fade-in",children:[e.jsx("h2",{className:"text-2xl font-bold text-green-500",children:"All Done!"}),e.jsx("p",{className:"text-text-muted mt-2",children:"There are no items due for study in this deck right now."}),e.jsx(L,{onClick:()=>d(a.id,y),className:"mt-8",children:"Back to Deck"})]});if(h>=P.length)return e.jsx(Ct,{deckId:a.id,seriesId:y,reviewedItems:E,nextDeckId:Ye,onSessionEnd:d,onStudyNextDeck:k,isCramSession:l==="_cram"});const lt=t?"fixed inset-0 z-[100] bg-background flex flex-col p-4 overflow-y-auto":"flex flex-col h-full animate-fade-in pb-20 relative mx-auto max-w-3xl px-4 lg:pb-12 lg:h-auto";return e.jsxs("div",{className:lt,children:[e.jsxs("div",{className:"flex-grow w-full flex flex-col relative z-10",children:[!t&&e.jsx("div",{className:"w-full relative flex items-start justify-between min-h-[1rem] mb-2 lg:mb-6",children:e.jsx("div",{className:"w-full mt-1",children:e.jsx(pt,{current:F,total:_})})}),!t&&e.jsxs("div",{className:"text-center mt-2 mb-2 px-4 relative lg:mb-6",children:[a.id!=="general-study-deck"&&U&&e.jsxs("div",{className:"mb-1",children:[e.jsx("span",{className:"text-xs text-text-muted mr-1",children:"in"}),e.jsx(Qe,{href:`/series/${U.id}`,className:"text-xs font-semibold text-text-muted hover:underline break-words",children:U.name})]}),e.jsx(Qe,{href:Ve,className:"text-lg font-bold text-text hover:underline break-words",children:Ae})]}),e.jsxs("div",{className:`flex-grow flex flex-col items-center justify-center pb-4 ${t?"w-full max-w-4xl mx-auto":""}`,children:[e.jsxs("div",{className:"w-full relative",children:[!t&&ke&&e.jsx("p",{className:"text-center text-xs mb-2 text-text-muted uppercase tracking-wider font-semibold",children:ke}),me?e.jsx(jt,{infoCard:i,textSize:Pe}):ee?e.jsx(wt,{question:i,selectedAnswerId:W?re:i.userSelectedAnswerId||null,onSelectAnswer:Je,onShowInfo:V?st:void 0,textSize:Pe},i.id):e.jsx(yt,{card:i,isFlipped:O,onGenerateAudio:at,deckId:i.originalDeckId||a.id,onReview:ye,textSize:Pe},i.id)]}),w&&W&&(O||ee&&ne)&&e.jsx("div",{className:"mt-4 animate-fade-in",children:e.jsxs(L,{variant:"secondary",size:"sm",onClick:nt,disabled:G,className:"bg-purple-100 text-purple-700 dark:bg-purple-900/30 dark:text-purple-300 hover:bg-purple-200 dark:hover:bg-purple-900/50 border-transparent",children:[G?e.jsx(Oe,{size:"sm"}):e.jsx(Z,{name:"bot",className:"w-4 h-4 mr-2"}),G?"Thinking...":"Explain Like I'm 5"]})})]})]}),e.jsxs("div",{className:t?"w-full max-w-2xl mx-auto pb-4":"mt-6 w-full max-w-2xl mx-auto pb-4",children:[e.jsx(It,{isCurrent:W,isHistorical:De,isFlipped:O,isAnswered:ne,isReviewing:Q,isQuiz:ee,isInfoCard:me,isCramSession:l==="_cram",showNavArrows:_>1,displayIndex:f,currentIndex:h,queueLength:P.length,onReview:ye,onSuspend:Xe,onReadInfoCard:Re,onFlip:Fe,onReturnToCurrent:tt,onNavigatePrevious:Ke,onNavigateNext:et,itemsCompleted:F,totalSessionItems:_}),e.jsxs("div",{className:"mt-6 flex justify-center items-center gap-4 relative z-20",ref:x,children:[e.jsx(L,{variant:"ghost",size:"sm",onClick:()=>o(!t),className:"text-text-muted hover:text-primary rounded-full p-2",title:t?"Exit Zen Mode":"Enter Zen Mode",children:e.jsx(Z,{name:t?"minimize":"maximize",className:"w-5 h-5"})}),e.jsxs("div",{className:"relative",children:[e.jsx(L,{variant:"ghost",size:"sm",onClick:()=>pe(!fe),className:"text-text-muted hover:text-primary rounded-full p-2","aria-label":"Session Settings",children:e.jsx(Z,{name:"settings",className:"w-5 h-5"})}),fe&&e.jsxs("div",{className:"absolute bottom-full left-1/2 -translate-x-1/2 mb-2 w-64 bg-surface shadow-xl border border-border rounded-lg p-4 animate-fade-in text-left z-50",children:[e.jsx("h4",{className:"text-sm font-semibold text-text mb-3 border-b border-border pb-1",children:"Session Settings"}),V&&e.jsx("div",{className:"mb-4",children:e.jsx(ft,{label:"Mixed Mode",checked:a.learningMode==="mixed",onChange:rt,description:"Combine reading and questions."})}),e.jsxs("div",{className:"mb-4",children:[e.jsxs("label",{className:"flex items-center text-xs font-semibold text-text-muted mb-2",children:[e.jsx(Z,{name:"type",className:"w-3 h-3 mr-1"})," Text Size"]}),e.jsxs("div",{className:"flex bg-background rounded-md p-1 border border-border",children:[e.jsx("button",{onClick:()=>s("normal"),className:`flex-1 py-1 px-2 text-xs rounded transition-colors ${be==="normal"?"bg-primary text-on-primary shadow-sm":"text-text hover:bg-border/50"}`,children:"A"}),e.jsx("button",{onClick:()=>s("large"),className:`flex-1 py-1 px-2 text-sm font-medium rounded transition-colors ${be==="large"?"bg-primary text-on-primary shadow-sm":"text-text hover:bg-border/50"}`,children:"A+"}),e.jsx("button",{onClick:()=>s("huge"),className:`flex-1 py-1 px-2 text-base font-bold rounded transition-colors ${be==="huge"?"bg-primary text-on-primary shadow-sm":"text-text hover:bg-border/50"}`,children:"A++"})]})]}),e.jsxs("div",{className:"mb-4",children:[e.jsxs("label",{className:"flex items-center text-xs font-semibold text-text-muted mb-2",children:[e.jsx(Z,{name:"keyboard",className:"w-3 h-3 mr-1"})," Shortcuts"]}),e.jsxs("ul",{className:"text-xs text-text space-y-1 bg-background p-2 rounded-md border border-border",children:[e.jsxs("li",{className:"flex justify-between",children:[e.jsx("span",{children:"Flip / Next"})," ",e.jsx("kbd",{className:"font-mono bg-border px-1 rounded",children:"Space"})]}),e.jsxs("li",{className:"flex justify-between",children:[e.jsx("span",{children:"Rate Answer"})," ",e.jsx("kbd",{className:"font-mono bg-border px-1 rounded",children:"1 - 4"})]})]})]})]})]})]})]}),e.jsx(Nt,{isOpen:ie,onClose:()=>le(!1),infoCards:A}),e.jsx(St,{isOpen:he,onClose:()=>ue(!1),title:i&&"questionText"in i?Me(i.questionText):i&&"front"in i?Me(i.front):"Concept",explanation:ge})]})};export{At as default};
