import{r as m,a as q,j as e,I as i,B as j,P as Q,Q as R,G as O,s as P,e as $}from"./index-Bo0ygskk.js";import{D as G}from"./DeckListItem-ml176hCm.js";import{D as z}from"./DeckSortControl-HPdlLN2X.js";import"./MasteryBar-B0y49n4C.js";const Y=({folder:t,decks:d,isOpen:x,onToggle:v,sessionsToResume:D,onUpdateLastOpened:k,onDeleteFolder:F,draggedDeckId:w,onDragStart:l,onDragEnd:u,onMoveDeck:S,onUpdateDeck:a,onDeleteDeck:r,openConfirmModal:c,onSaveFolder:I,onGenerateQuestionsForDeck:y,onGenerateContentForLearningDeck:C})=>{const[h,f]=m.useState(!1),[o,g]=m.useState(!1),[b,T]=m.useState(t.name),n=m.useRef(null),{addToast:N}=q();m.useEffect(()=>{o&&n.current&&(n.current.focus(),n.current.select())},[o]);const p=s=>{s.stopPropagation(),T(t.name),g(!0)},L=s=>{s.stopPropagation(),g(!1)},M=s=>{if(s==null||s.stopPropagation(),b.trim()===""){N("Folder name cannot be empty.","error");return}I({id:t.id,name:b.trim()}),g(!1)},B=s=>{s.preventDefault(),s.stopPropagation();const E=s.dataTransfer.getData("text/plain");E&&E===w&&(S(E,t.id),u()),f(!1)},U=s=>{s.preventDefault(),s.dataTransfer.dropEffect="move",f(!0)},A=()=>{f(!1)};return e.jsxs("div",{className:`rounded-lg transition-all duration-200 ${h?"bg-primary/20 ring-2 ring-primary ring-inset":"bg-surface border border-border"}`,onDrop:B,onDragOver:U,onDragLeave:A,children:[e.jsx("div",{className:"border-b border-border",children:e.jsxs("div",{onClick:o?void 0:v,className:"w-full flex justify-between items-center text-left p-4 cursor-pointer","aria-expanded":x,children:[e.jsxs("div",{className:"flex items-center flex-grow min-w-0",children:[e.jsx(i,{name:"chevron-down",className:`w-5 h-5 transition-transform duration-300 mr-3 ${x?"":"-rotate-90"} text-text-muted`}),o?e.jsxs("div",{className:"flex items-center flex-grow gap-2 min-w-0",onClick:s=>s.stopPropagation(),children:[e.jsx(i,{name:"folder",className:"w-6 h-6 text-yellow-600 dark:text-yellow-500 flex-shrink-0"}),e.jsx("input",{ref:n,type:"text",value:b,onChange:s=>T(s.target.value),onKeyDown:s=>{s.key==="Enter"&&M(s),s.key==="Escape"&&L(s)},className:"text-xl font-bold p-1 bg-background rounded-md w-full"})]}):e.jsxs(e.Fragment,{children:[e.jsx(i,{name:"folder",className:"w-6 h-6 mr-3 text-yellow-600 dark:text-yellow-500"}),e.jsx("h3",{className:"text-xl font-bold text-text truncate",children:t.name})]})]}),e.jsx("div",{className:"flex items-center gap-1 flex-shrink-0",children:o?e.jsxs(e.Fragment,{children:[e.jsx(j,{variant:"primary",size:"sm",onClick:M,"aria-label":`Save changes for folder ${t.name}`,children:"Save"}),e.jsx(j,{variant:"secondary",size:"sm",onClick:L,"aria-label":"Cancel editing",children:"Cancel"})]}):e.jsxs(e.Fragment,{children:[e.jsx(j,{variant:"ghost",className:"p-2 h-auto",onClick:p,"aria-label":`Edit folder ${t.name}`,children:e.jsx(i,{name:"edit",className:"w-4 h-4"})}),e.jsx(j,{variant:"ghost",className:"p-2 h-auto hover:text-red-500",onClick:s=>{s.stopPropagation(),F(t.id)},"aria-label":`Delete folder ${t.name}`,children:e.jsx(i,{name:"trash-2",className:"w-4 h-4"})})]})})]})}),x&&e.jsx("div",{className:"p-4 space-y-4",children:d.length>0?d.map(s=>e.jsx(G,{deck:s,sessionsToResume:D,onUpdateLastOpened:k,draggedDeckId:w,onDragStart:l,onDragEnd:u,onUpdateDeck:a,onDeleteDeck:r,openConfirmModal:c,handleGenerateQuestionsForDeck:y,handleGenerateContentForLearningDeck:C},s.id)):e.jsxs("div",{className:"flex flex-col items-center justify-center p-6 border-2 border-dashed border-border rounded-md m-4 text-center",children:[e.jsx(i,{name:"grip-vertical",className:"w-8 h-8 text-text-muted mb-2"}),e.jsx("p",{className:"text-sm font-medium text-text-muted",children:"Drag a deck here to organize it!"})]})})]})},H=({decks:t,folders:d,sessionsToResume:x,onUpdateLastOpened:v,onDeleteFolder:D,draggedDeckId:k,onDragStart:F,onDragEnd:w,onMoveDeck:l,openFolderIds:u,onToggleFolder:S,onUpdateDeck:a,onDeleteDeck:r,openConfirmModal:c,onSaveFolder:I,onGenerateQuestionsForDeck:y,onGenerateContentForLearningDeck:C})=>{const{decksByFolder:h,ungroupedDecks:f}=m.useMemo(()=>{const n=new Map,N=[];return t.forEach(p=>{p.folderId&&d.some(L=>L.id===p.folderId)?(n.has(p.folderId)||n.set(p.folderId,[]),n.get(p.folderId).push(p)):N.push(p)}),{decksByFolder:n,ungroupedDecks:N}},[t,d]),[o,g]=m.useState(!1),b=n=>{n.preventDefault();const N=n.dataTransfer.getData("text/plain");N&&N===k&&(l(N,null),w()),g(!1)},T=n=>{n.preventDefault(),n.dataTransfer.dropEffect="move",g(!0)};return e.jsxs("div",{className:"space-y-4",children:[d.map(n=>e.jsx(Y,{folder:n,decks:h.get(n.id)||[],isOpen:u.has(n.id),onToggle:()=>S(n.id),sessionsToResume:x,onUpdateLastOpened:v,onDeleteFolder:D,draggedDeckId:k,onDragStart:F,onDragEnd:w,onMoveDeck:l,onUpdateDeck:a,onDeleteDeck:r,openConfirmModal:c,onSaveFolder:I,onGenerateQuestionsForDeck:y,onGenerateContentForLearningDeck:C},n.id)),e.jsx("div",{onDrop:b,onDragOver:T,onDragLeave:()=>g(!1),className:`p-2 -m-2 rounded-lg transition-all duration-200 ${o?"bg-primary/20 ring-2 ring-primary ring-inset":""}`,children:e.jsx("div",{className:"space-y-4",children:f.map(n=>e.jsx(G,{deck:n,sessionsToResume:x,onUpdateLastOpened:v,draggedDeckId:k,onDragStart:F,onDragEnd:w,onUpdateDeck:a,onDeleteDeck:r,openConfirmModal:c,handleGenerateQuestionsForDeck:y,handleGenerateContentForLearningDeck:C},n.id))})})]})},X=t=>{const[d,x]=m.useState(""),v=Q(),D=R(),k=m.useMemo(()=>{const l=d.toLowerCase().trim();if(!l){const a=[...D];switch(t.sortPreference){case"name":return a.sort((r,c)=>(r.name||"").localeCompare(c.name||""));case"dueCount":return a.sort((r,c)=>O(c)-O(r));case"lastOpened":default:return a.sort((r,c)=>(c.lastOpened||"").localeCompare(r.lastOpened||""))}}const u=l.split(/\s+/).filter(Boolean),S=D.map(a=>{let r=0;const c=(a.name||"").toLowerCase(),I=P(a.description).toLowerCase();c.startsWith(l)?r+=20:c.includes(l)&&(r+=10),I.includes(l)&&(r+=2);for(const h of u)c.includes(h)&&(r+=5),I.includes(h)&&(r+=1);const y=(a.type===$.Flashcard?a.cards:(a.type===$.Learning,a.questions))||[];let C=0;if(y)for(const h of y){let f;if(a.type===$.Flashcard){const o=h;f=P(`${o.front} ${o.back}`).toLowerCase()}else{const o=h,g=(o.options||[]).map(b=>b.text).join(" ");f=P(`${o.questionText} ${g} ${o.detailedExplanation}`).toLowerCase()}u.some(o=>f.includes(o))&&C++}return r+=Math.min(C,20)*.5,{deck:a,score:r}}).filter(({score:a})=>a>0);return S.sort((a,r)=>{if(a.score!==r.score)return r.score-a.score;switch(t.sortPreference){case"name":return(a.deck.name||"").localeCompare(r.deck.name||"");case"dueCount":return O(r.deck)-O(a.deck);case"lastOpened":default:return(r.deck.lastOpened||"").localeCompare(a.deck.lastOpened||"")}}),S.map(({deck:a})=>a)},[D,d,t.sortPreference]),F=m.useMemo(()=>[...v].sort((l,u)=>l.name.localeCompare(u.name)),[v]);return D.length>0||v.length>0?e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row justify-between items-center gap-4",children:[e.jsx("h1",{className:"text-3xl font-bold text-text",children:"All Decks"}),e.jsxs(j,{variant:"primary",onClick:t.onImportDecks,children:[e.jsx(i,{name:"plus",className:"w-5 h-5 mr-2"}),"Create / Import Deck"]})]}),e.jsxs("div",{className:"flex flex-col md:flex-row justify-between items-center gap-4 p-4 bg-surface rounded-lg border border-border",children:[e.jsxs("div",{className:"relative w-full md:max-w-xs",children:[e.jsx(i,{name:"search",className:"absolute left-3 top-1/2 -translate-y-1/2 w-5 h-5 text-text-muted"}),e.jsx("input",{type:"text",placeholder:"Search decks...",value:d,onChange:l=>x(l.target.value),className:"w-full pl-10 pr-4 py-2 bg-background border border-border rounded-md focus:ring-2 focus:ring-primary focus:outline-none"})]}),e.jsxs("div",{className:"flex flex-wrap items-center justify-center gap-2",children:[e.jsxs(j,{variant:"ghost",onClick:t.onNewFolder,children:[e.jsx(i,{name:"folder-plus",className:"w-5 h-5 mr-2"}),e.jsx("span",{className:"hidden sm:inline",children:"New Folder"})]}),e.jsx(z,{currentSort:t.sortPreference,onSortChange:t.onSortChange})]})]}),k.length===0&&d?e.jsxs("div",{className:"text-center py-20",children:[e.jsx(i,{name:"search",className:"w-16 h-16 mx-auto text-text-muted/50"}),e.jsx("h2",{className:"mt-4 text-2xl font-bold text-text-muted",children:"No Decks Found"}),e.jsxs("p",{className:"mt-2 text-text-muted",children:['Your search for "',d,'" did not match any decks.']}),e.jsx(j,{variant:"secondary",onClick:()=>x(""),className:"mt-6",children:"Clear Search"})]}):e.jsx(H,{decks:k,folders:F,sessionsToResume:t.sessionsToResume,onUpdateLastOpened:t.onUpdateLastOpened,onDeleteFolder:t.onDeleteFolder,draggedDeckId:t.draggedDeckId,onDragStart:t.onDragStart,onDragEnd:t.onDragEnd,onMoveDeck:t.onMoveDeck,openFolderIds:t.openFolderIds,onToggleFolder:t.onToggleFolder,onUpdateDeck:t.onUpdateDeck,onDeleteDeck:t.onDeleteDeck,openConfirmModal:t.openConfirmModal,onSaveFolder:t.handleSaveFolder,onGenerateQuestionsForDeck:t.handleGenerateQuestionsForDeck,onGenerateContentForLearningDeck:t.handleGenerateContentForLearningDeck})]}):e.jsxs("div",{className:"text-center py-20",children:[e.jsx(i,{name:"folder",className:"w-16 h-16 mx-auto text-gray-300 dark:text-gray-600"}),e.jsx("h2",{className:"mt-4 text-2xl font-bold text-text-muted",children:"Your deck collection is empty"}),e.jsx("p",{className:"mt-2 text-text-muted",children:"Create a new deck, import from a file, or try a sample deck to get started."}),e.jsxs("div",{className:"flex flex-col sm:flex-row items-center justify-center gap-4 mt-8",children:[e.jsxs(j,{onClick:t.onImportDecks,children:[e.jsx(i,{name:"plus",className:"w-5 h-5 mr-2"}),"Create or Import Deck"]}),e.jsxs(j,{onClick:t.onCreateSampleDeck,variant:"secondary",children:[e.jsx(i,{name:"laptop",className:"w-5 h-5 mr-2"}),"Create Sample Deck"]})]})]})};export{X as default};
