import{d as Q,i as T,r,j as e,B as d,I as l,D as B}from"./index-Bo0ygskk.js";import{u as D}from"./useKeyboardShortcuts-lS_9HBad.js";const M=({deck:a,onExit:p,onPractice:z})=>{var C,I,S;const{learningProgress:R}=Q(),m=T(),i=R[a.id]||{deckId:a.id,readInfoCardIds:[],unlockedQuestionIds:[]},f=r.useMemo(()=>new Set(i.readInfoCardIds),[i]),j=(C=a.infoCards)==null?void 0:C.findIndex(t=>!f.has(t.id)),P=j!==-1?j:0,[s,v]=r.useState(P),[q,k]=r.useState(!1),[c,u]=r.useState("normal"),[x,y]=r.useState(!1),h=r.useRef(null),o=(I=a.infoCards)==null?void 0:I[s],n=((S=a.infoCards)==null?void 0:S.length)||0,A=s/n*100;r.useEffect(()=>{const t=g=>{h.current&&!h.current.contains(g.target)&&y(!1)};return x&&document.addEventListener("mousedown",t),()=>{document.removeEventListener("mousedown",t)}},[x]),r.useEffect(()=>{window.scrollTo({top:0,behavior:"smooth"})},[s]);const w=r.useCallback(async()=>{if(!o)return;const t=Array.from(new Set([...i.readInfoCardIds,o.id])),g=Array.from(new Set([...i.unlockedQuestionIds,...o.unlocksQuestionIds]));await(m==null?void 0:m.handleUpdateLearningProgress({deckId:a.id,readInfoCardIds:t,unlockedQuestionIds:g,lastReadCardId:o.id}))},[o,i,a.id,m]),b=r.useCallback(async()=>{await w(),s<n-1?v(t=>t+1):k(!0)},[s,n,w]),N=()=>{s>0&&(v(t=>t-1),k(!1))};D({ArrowRight:b,ArrowLeft:N,Space:b});const $=`
    flex-grow prose dark:prose-invert max-w-none ${r.useMemo(()=>{switch(c){case"large":return"text-xl leading-loose";case"huge":return"text-2xl leading-loose";case"normal":default:return"text-lg leading-relaxed"}},[c])}
    prose-p:mb-6 prose-p:mt-2
    prose-headings:font-bold prose-headings:tracking-tight prose-headings:mt-8 prose-headings:mb-4
    prose-a:text-primary hover:prose-a:text-primary-hover
    prose-img:rounded-xl prose-img:shadow-md prose-img:mx-auto prose-img:my-6
    prose-blockquote:border-l-4 prose-blockquote:border-primary prose-blockquote:bg-background/50 prose-blockquote:py-2 prose-blockquote:px-4 prose-blockquote:rounded-r prose-blockquote:my-6
    prose-ul:list-disc prose-ul:pl-6 prose-ul:my-6
    prose-ol:list-decimal prose-ol:pl-6 prose-ol:my-6
    prose-li:my-4
    prose-table:w-full prose-table:my-6 prose-table:border-collapse
    prose-th:bg-background/50 prose-th:p-3 prose-th:text-left prose-th:border prose-th:border-border prose-th:font-bold
    prose-td:p-3 prose-td:border prose-td:border-border
    prose-hr:my-8 prose-hr:border-border
    prose-code:bg-background/50 prose-code:px-1.5 prose-code:py-0.5 prose-code:rounded prose-code:text-sm prose-code:font-mono prose-code:text-primary
    prose-pre:bg-surface-dark prose-pre:p-4 prose-pre:rounded-lg prose-pre:overflow-x-auto
  `;return o?q?e.jsxs("div",{className:"max-w-2xl mx-auto py-20 text-center animate-fade-in",children:[e.jsx("div",{className:"mb-6 inline-flex p-4 bg-green-100 dark:bg-green-900/30 rounded-full text-green-600 dark:text-green-400",children:e.jsx(l,{name:"check-circle",className:"w-16 h-16"})}),e.jsx("h2",{className:"text-3xl font-bold text-text mb-4",children:"Reading Complete!"}),e.jsx("p",{className:"text-text-muted mb-8 text-lg",children:"You've finished all the material in this section."}),e.jsxs("div",{className:"flex flex-col sm:flex-row gap-4 justify-center",children:[e.jsxs(d,{variant:"primary",size:"lg",onClick:z,children:[e.jsx(l,{name:"refresh-ccw",className:"w-5 h-5 mr-2"}),"Practice Now"]}),e.jsx(d,{variant:"secondary",size:"lg",onClick:p,children:"Back to Deck"})]})]}):e.jsxs("div",{className:"max-w-3xl mx-auto pb-20 animate-fade-in",children:[e.jsxs("div",{className:"mb-6 sticky top-16 bg-background/95 backdrop-blur-sm py-4 z-10 border-b border-border/50 transition-all",children:[e.jsxs("div",{className:"flex justify-between items-center mb-2",children:[e.jsxs("span",{className:"text-sm font-semibold text-text-muted uppercase tracking-wider",children:["Page ",s+1," of ",n]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsxs("div",{className:"relative",ref:h,children:[e.jsx(d,{variant:"ghost",size:"sm",onClick:()=>y(!x),className:"p-1 h-auto",title:"Text Size",children:e.jsx(l,{name:"type",className:"w-5 h-5 text-text-muted hover:text-text"})}),x&&e.jsxs("div",{className:"absolute top-8 right-0 bg-surface shadow-xl border border-border rounded-lg p-2 animate-fade-in z-50 flex gap-1",children:[e.jsx("button",{onClick:()=>u("normal"),className:`py-1 px-3 text-xs rounded transition-colors ${c==="normal"?"bg-primary text-on-primary":"text-text hover:bg-border/50"}`,children:"A"}),e.jsx("button",{onClick:()=>u("large"),className:`py-1 px-3 text-sm font-medium rounded transition-colors ${c==="large"?"bg-primary text-on-primary":"text-text hover:bg-border/50"}`,children:"A+"}),e.jsx("button",{onClick:()=>u("huge"),className:`py-1 px-3 text-base font-bold rounded transition-colors ${c==="huge"?"bg-primary text-on-primary":"text-text hover:bg-border/50"}`,children:"A++"})]})]}),e.jsx(d,{variant:"ghost",size:"sm",onClick:p,children:e.jsx(l,{name:"x",className:"w-5 h-5"})})]})]}),e.jsx("div",{className:"w-full bg-border/30 rounded-full h-1.5",children:e.jsx("div",{className:"bg-primary h-1.5 rounded-full transition-all duration-300",style:{width:`${A}%`}})})]}),e.jsx("div",{className:"bg-surface shadow-sm border border-border rounded-xl p-8 md:p-12 min-h-[60vh] flex flex-col",children:e.jsx("div",{className:$,children:e.jsx(B,{html:o.content})})}),e.jsxs("div",{className:"fixed bottom-0 left-0 right-0 p-4 bg-surface border-t border-border flex justify-between items-center md:static md:bg-transparent md:border-0 md:mt-8 z-20",children:[e.jsxs(d,{variant:"ghost",onClick:N,disabled:s===0,className:"text-text-muted hover:text-text",children:[e.jsx(l,{name:"chevron-left",className:"w-5 h-5 mr-1"})," Previous"]}),e.jsx("span",{className:"text-sm text-text-muted hidden md:inline",children:f.has(o.id)?"Read":"Unread"}),e.jsxs(d,{variant:"primary",size:"lg",onClick:b,className:"px-8 shadow-md",children:[s===n-1?"Finish":"Next Page",e.jsx(l,{name:s===n-1?"check-circle":"chevron-left",className:`w-5 h-5 ml-2 ${s!==n-1?"rotate-180":""}`})]})]})]}):e.jsxs("div",{className:"text-center py-20",children:[e.jsx("p",{className:"text-text-muted",children:"No content available to read."}),e.jsx(d,{onClick:p,className:"mt-4",children:"Go Back"})]})};export{M as default};
