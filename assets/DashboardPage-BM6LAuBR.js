import{r as D,j as e,I as o,B as c,P as Y,G as Z,u as _,H as $,e as ee,g as se,L as O}from"./index-BCY9tn3S.js";import{S as te}from"./SeriesListItem-DII6wwxb.js";import{D as ae}from"./DeckListItem-23PzCa10.js";import"./MasteryBar-DeT_xrwj.js";import"./ProgressBar-0NsASibu.js";const le=()=>{const[n,d]=D.useState(null),[y,g]=D.useState(!1);return D.useEffect(()=>{const m=w=>{w.preventDefault(),d(w),localStorage.getItem("cogniflow-install-dismissed")||setTimeout(()=>g(!0),1e4)};return window.addEventListener("beforeinstallprompt",m),()=>{window.removeEventListener("beforeinstallprompt",m)}},[]),[n,()=>{n&&(n.prompt(),n.userChoice.then(m=>{m.outcome==="accepted"?console.log("User accepted the install prompt"):(console.log("User dismissed the install prompt"),localStorage.setItem("cogniflow-install-dismissed","true")),g(!1),d(null)}))},y]},ne=({onInstall:n,onDismiss:d})=>e.jsx("div",{className:"fixed bottom-0 left-0 right-0 z-50 p-4 animate-fade-in-up",children:e.jsxs("div",{className:"bg-primary text-on-primary rounded-lg shadow-xl p-4 flex flex-col sm:flex-row items-center justify-between gap-4 max-w-2xl mx-auto",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"bg-white/20 p-2 rounded-lg",children:e.jsx(o,{name:"download",className:"w-6 h-6"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-bold",children:"Install CogniFlow"}),e.jsx("p",{className:"text-sm opacity-90",children:"Add to your home screen for the best experience."})]})]}),e.jsxs("div",{className:"flex gap-2 w-full sm:w-auto",children:[e.jsx(c,{variant:"secondary",onClick:d,className:"flex-1 sm:flex-none border-transparent text-primary hover:bg-white",children:"Not Now"}),e.jsx(c,{variant:"secondary",onClick:n,className:"flex-1 sm:flex-none bg-white text-primary hover:bg-white/90 font-bold border-transparent",children:"Install"})]})]})}),me=({totalDueQuestions:n,onStartGeneralStudy:d,sessionsToResume:y,onUpdateLastOpened:g,onUpdateDeck:b,onDeleteDeck:m,openConfirmModal:w,seriesProgress:h,onStartSeriesStudy:T,handleGenerateQuestionsForDeck:P,handleGenerateContentForLearningDeck:F,handleGenerateQuestionsForEmptyDecksInSeries:R,onGenerateAI:I,onCreateSampleQuizDeck:U,onCreateSampleFlashcardDeck:V,onCreateSampleLearningDeck:q,onCreateSampleSeries:G})=>{const p=Y(),j=Z(),{aiFeaturesEnabled:S}=_(),[H,Q,J]=le(),K=()=>{localStorage.setItem("cogniflow-install-dismissed","true"),window.location.reload()},{recentDecks:B,recentSeries:C,seriesData:W}=D.useMemo(()=>{const l=new Set;j.forEach(s=>{(s.levels||[]).filter(Boolean).forEach(r=>(r.deckIds||[]).forEach(f=>l.add(f)))});const v=p.filter(s=>!s.archived&&!s.deletedAt&&!l.has(s.id)),L=[...j.filter(s=>!s.archived&&!s.deletedAt)].sort((s,r)=>{const f=(s.levels||[]).filter(Boolean).flatMap(a=>a.deckIds||[]).map(a=>p.find(u=>u.id===a)).filter(Boolean),k=(r.levels||[]).filter(Boolean).flatMap(a=>a.deckIds||[]).map(a=>p.find(u=>u.id===a)).filter(Boolean),M=Math.max(new Date(s.lastOpened||s.createdAt||0).getTime(),...f.map(a=>new Date(a.lastOpened||0).getTime()));return Math.max(new Date(r.lastOpened||r.createdAt||0).getTime(),...k.map(a=>new Date(a.lastOpened||0).getTime()))-M}).slice(0,2),N=[...v].sort((s,r)=>(r.lastOpened||"").localeCompare(s.lastOpened||"")).slice(0,2),x=new Map;return j.forEach(s=>{var z;const r=(s.levels||[]).filter(Boolean).flatMap(t=>t.deckIds||[]).map(t=>p.find(i=>i.id===t)).filter(Boolean),f=((z=h.get(s.id))==null?void 0:z.size)||0,k=new Set;(s.levels||[]).filter(Boolean).flatMap(t=>t.deckIds||[]).forEach((t,i)=>{i<=f&&k.add(t)});const A=r.reduce((t,i)=>k.has(i.id)?t+$(i):t,0),a=r.flatMap(t=>t.type===ee.Flashcard?t.cards||[]:t.questions||[]).filter(t=>!t.suspended),u=a.length>0?a.reduce((t,i)=>t+se(i),0)/a.length:0;x.set(s.id,{dueCount:A,mastery:u})}),{recentDecks:N,recentSeries:L,seriesData:x}},[p,j,h]),X=n>0||S&&I;return e.jsxs("div",{className:"space-y-12",children:[X&&e.jsxs("div",{className:"mb-6 flex flex-wrap items-center gap-4",children:[n>0&&e.jsxs(c,{onClick:d,variant:"primary",className:"w-full sm:w-auto text-lg py-3",children:[e.jsx(o,{name:"zap",className:"w-5 h-5 mr-2"}),"Study All Due Items (",n,")"]}),S&&I&&e.jsxs(c,{onClick:I,variant:"secondary",className:"w-full sm:w-auto text-lg py-3",children:[e.jsx(o,{name:"bot",className:"w-5 h-5 mr-2"}),"Generate with AI"]})]}),C.length>0&&e.jsxs("section",{children:[e.jsxs("div",{className:"flex justify-between items-center mb-4",children:[e.jsx("h2",{className:"text-3xl font-bold text-gray-900 dark:text-gray-100",children:"Recent Series"}),e.jsxs(O,{href:"/series",passAs:c,variant:"ghost",children:["View all ",e.jsx(o,{name:"chevron-left",className:"w-4 h-4 ml-2 rotate-180"})]})]}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:C.map(l=>{var x;const v=W.get(l.id)||{dueCount:0,mastery:0},E=h.get(l.id)||new Set,N=(l.levels||[]).filter(Boolean).flatMap(s=>s.deckIds||[]).find(s=>!E.has(s))||null;return e.jsx(te,{series:l,completedCount:((x=h.get(l.id))==null?void 0:x.size)||0,dueCount:v.dueCount,masteryLevel:v.mastery,onStartSeriesStudy:T,nextUpDeckId:N,onGenerateAllQuestions:R},l.id)})})]}),B.length>0&&e.jsxs("section",{children:[e.jsxs("div",{className:"flex justify-between items-center mb-4",children:[e.jsx("h2",{className:"text-3xl font-bold text-gray-900 dark:text-gray-100",children:"Recent Decks"}),e.jsxs(O,{href:"/decks",passAs:c,variant:"ghost",children:["View all ",e.jsx(o,{name:"chevron-left",className:"w-4 h-4 ml-2 rotate-180"})]})]}),e.jsx("div",{className:"space-y-4",children:B.map(l=>e.jsx(ae,{deck:l,sessionsToResume:y,onUpdateLastOpened:g,draggedDeckId:null,onDragStart:()=>{},onDragEnd:()=>{},onUpdateDeck:b,onDeleteDeck:m,openConfirmModal:w,handleGenerateQuestionsForDeck:P,handleGenerateContentForLearningDeck:F},l.id))})]}),e.jsxs("section",{className:"pt-8 border-t border-border",children:[e.jsx("h2",{className:"text-xl font-bold text-gray-900 dark:text-gray-100 mb-4",children:"Quick Start Samples"}),e.jsxs("div",{className:"flex flex-wrap gap-3",children:[e.jsxs(c,{onClick:U,variant:"secondary",size:"sm",children:[e.jsx(o,{name:"help-circle",className:"w-4 h-4 mr-2"})," Quiz Deck"]}),e.jsxs(c,{onClick:V,variant:"secondary",size:"sm",children:[e.jsx(o,{name:"laptop",className:"w-4 h-4 mr-2"})," Flashcard Deck"]}),e.jsxs(c,{onClick:q,variant:"secondary",size:"sm",children:[e.jsx(o,{name:"book-open",className:"w-4 h-4 mr-2"})," Learning Deck"]}),e.jsxs(c,{onClick:G,variant:"secondary",size:"sm",children:[e.jsx(o,{name:"layers",className:"w-4 h-4 mr-2"})," Series"]})]})]}),J&&H&&e.jsx(ne,{onInstall:Q,onDismiss:K})]})};export{me as default};
