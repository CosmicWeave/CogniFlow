import{d as G,i as Y,r as o,j as e,B as m,I as i,D as _}from"./index-BCY9tn3S.js";import{u as H}from"./useKeyboardShortcuts-D9PlQdSg.js";const J=({deck:n,onExit:b,onPractice:E})=>{var z,q,T,R,P,L;const{learningProgress:B,aiGenerationStatus:$}=G(),h=Y(),p=B[n.id]||{deckId:n.id,readInfoCardIds:[],unlockedQuestionIds:[]},x=o.useMemo(()=>new Set(p.readInfoCardIds),[p]),l=((z=$.currentTask)==null?void 0:z.deckId)===n.id||n.generationStatus==="generating",N=(q=n.infoCards)==null?void 0:q.findIndex(t=>!x.has(t.id)),M=N!==-1?N:0,[r,w]=o.useState(M),[Q,k]=o.useState(!1),[u,g]=o.useState("normal"),[f,C]=o.useState(!1),j=o.useRef(null),s=(T=n.infoCards)==null?void 0:T[r],d=((R=n.infoCards)==null?void 0:R.length)||0,I=((L=(P=n.curriculum)==null?void 0:P.chapters)==null?void 0:L.length)||d,D=r/(I||1)*100,c=o.useMemo(()=>s?(s.prerequisiteIds||[]).some(a=>!x.has(a)):!1,[s,x]),O=o.useMemo(()=>!s||!c?[]:(s.prerequisiteIds||[]).filter(a=>!x.has(a)).map(a=>{var A;return((A=n.infoCards.find(F=>F.id===a))==null?void 0:A.content)||"Foundational Topic"}).map(a=>a.replace(/<[^>]+>/g,"").substring(0,50)+"..."),[s,c,x,n.infoCards]);o.useEffect(()=>{const t=a=>{j.current&&!j.current.contains(a.target)&&C(!1)};return f&&document.addEventListener("mousedown",t),()=>{document.removeEventListener("mousedown",t)}},[f]),o.useEffect(()=>{window.scrollTo({top:0,behavior:"smooth"})},[r]);const S=o.useCallback(async()=>{if(!s||c)return;const t=Array.from(new Set([...p.readInfoCardIds,s.id])),a=Array.from(new Set([...p.unlockedQuestionIds,...s.unlocksQuestionIds]));await(h==null?void 0:h.handleUpdateLearningProgress({deckId:n.id,readInfoCardIds:t,unlockedQuestionIds:a,lastReadCardId:s.id}))},[s,p,n.id,h,c]),v=o.useCallback(async()=>{c||await S(),r<d-1?w(t=>t+1):k(!0)},[r,d,S,c]),y=()=>{r>0&&(w(t=>t-1),k(!1))};H({ArrowRight:v,ArrowLeft:y,Space:v});const U=`
    flex-grow prose dark:prose-invert max-w-none ${o.useMemo(()=>{switch(u){case"large":return"text-xl leading-loose";case"huge":return"text-2xl leading-loose";case"normal":default:return"text-lg leading-relaxed"}},[u])}
    prose-p:mb-6 prose-p:mt-2
    prose-headings:font-bold prose-headings:tracking-tight prose-headings:mt-8 prose-headings:mb-4
    prose-a:text-primary hover:prose-a:text-primary-hover
    prose-img:rounded-xl prose-img:shadow-md prose-img:mx-auto prose-img:my-6
    prose-blockquote:border-l-4 prose-blockquote:border-primary prose-blockquote:bg-background/50 prose-blockquote:py-2 prose-blockquote:px-4 prose-blockquote:rounded-r prose-blockquote:my-6
    prose-ul:list-disc prose-ul:pl-6 prose-ul:my-6
    prose-ol:list-decimal prose-ol:pl-6 prose-ol:my-6
    prose-li:my-4
    prose-table:w-full prose-table:my-6 prose-table:border-collapse
    prose-th:bg-background/50 prose-th:p-3 prose-th:text-left prose-th:border prose-th:border-border prose-th:font-bold
    prose-td:p-3 prose-td:border prose-td:border-border
    prose-hr:my-8 prose-hr:border-border
    prose-code:bg-background/50 prose-code:px-1.5 prose-code:py-0.5 prose-code:rounded prose-code:text-sm prose-code:font-mono prose-code:text-primary
    prose-pre:bg-surface-dark prose-pre:p-4 prose-pre:rounded-lg prose-pre:overflow-x-auto
    prose-video:rounded-xl prose-video:shadow-2xl prose-video:my-10
  `;return!s&&!l?e.jsxs("div",{className:"text-center py-20",children:[e.jsx("p",{className:"text-text-muted",children:"No content available to read."}),e.jsx(m,{onClick:b,className:"mt-4",children:"Go Back"})]}):Q&&!l?e.jsxs("div",{className:"max-w-2xl mx-auto py-20 text-center animate-fade-in",children:[e.jsx("div",{className:"mb-6 inline-flex p-4 bg-green-100 dark:bg-green-900/30 rounded-full text-green-600 dark:text-green-400",children:e.jsx(i,{name:"check-circle",className:"w-16 h-16"})}),e.jsx("h2",{className:"text-3xl font-bold text-text mb-4",children:"Reading Complete!"}),e.jsx("p",{className:"text-text-muted mb-8 text-lg",children:"You've finished all the material in this section."}),e.jsxs("div",{className:"flex flex-col sm:flex-row gap-4 justify-center",children:[e.jsxs(m,{variant:"primary",size:"lg",onClick:E,children:[e.jsx(i,{name:"refresh-ccw",className:"w-5 h-5 mr-2"}),"Practice Now"]}),e.jsx(m,{variant:"secondary",size:"lg",onClick:b,children:"Back to Deck"})]})]}):e.jsxs("div",{className:"max-w-3xl mx-auto pb-20 animate-fade-in",children:[e.jsxs("div",{className:"mb-6 sticky top-16 bg-background/95 backdrop-blur-sm py-4 z-10 border-b border-border/50 transition-all",children:[e.jsxs("div",{className:"flex justify-between items-center mb-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("span",{className:"text-sm font-semibold text-text-muted uppercase tracking-wider",children:["Page ",r+1," of ",I]}),l&&e.jsx("span",{className:"flex items-center text-[10px] bg-primary/10 text-primary px-2 py-0.5 rounded-full font-bold animate-pulse",children:"LIVE SYNTHESIS"})]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsxs("div",{className:"relative",ref:j,children:[e.jsx(m,{variant:"ghost",size:"sm",onClick:()=>C(!f),className:"p-1 h-auto",title:"Text Size",children:e.jsx(i,{name:"type",className:"w-5 h-5 text-text-muted hover:text-text"})}),f&&e.jsxs("div",{className:"absolute top-8 right-0 bg-surface shadow-xl border border-border rounded-lg p-2 animate-fade-in z-50 flex gap-1",children:[e.jsx("button",{onClick:()=>g("normal"),className:`py-1 px-3 text-xs rounded transition-colors ${u==="normal"?"bg-primary text-on-primary":"text-text hover:bg-border/50"}`,children:"A"}),e.jsx("button",{onClick:()=>g("large"),className:`py-1 px-3 text-sm font-medium rounded transition-colors ${u==="large"?"bg-primary text-on-primary":"text-text hover:bg-border/50"}`,children:"A+"}),e.jsx("button",{onClick:()=>g("huge"),className:`py-1 px-3 text-base font-bold rounded transition-colors ${u==="huge"?"bg-primary text-on-primary":"text-text hover:bg-border/50"}`,children:"A++"})]})]}),e.jsx(m,{variant:"ghost",size:"sm",onClick:b,children:e.jsx(i,{name:"x",className:"w-5 h-5"})})]})]}),e.jsx("div",{className:"w-full bg-border/30 rounded-full h-1.5 overflow-hidden",children:e.jsx("div",{className:"bg-primary h-1.5 rounded-full transition-all duration-300",style:{width:`${D}%`}})})]}),e.jsxs("div",{className:"bg-surface shadow-sm border border-border rounded-xl p-8 md:p-12 min-h-[60vh] flex flex-col relative overflow-hidden",children:[c?e.jsxs("div",{className:"flex-grow flex flex-col items-center justify-center text-center p-8 animate-fade-in",children:[e.jsx("div",{className:"p-6 bg-red-100 dark:bg-red-900/20 rounded-full text-red-500 mb-6",children:e.jsx(i,{name:"lock",className:"w-12 h-12"})}),e.jsx("h3",{className:"text-2xl font-bold text-text mb-4",children:"Chapter Locked"}),e.jsx("p",{className:"text-text-muted mb-6",children:"You need to complete the prerequisite chapters first:"}),e.jsx("div",{className:"space-y-2 w-full max-w-sm",children:O.map((t,a)=>e.jsxs("div",{className:"p-3 bg-background border border-border rounded-lg text-sm text-text font-medium flex items-center gap-2",children:[e.jsx(i,{name:"book-open",className:"w-4 h-4 text-primary"}),e.jsx("span",{className:"truncate",children:t})]},a))}),e.jsxs(m,{variant:"secondary",onClick:y,className:"mt-8",children:[e.jsx(i,{name:"chevron-left",className:"w-4 h-4 mr-2"})," Back to foundational material"]})]}):s?e.jsx("div",{className:U,children:e.jsx(_,{html:s.content})}):l?e.jsxs("div",{className:"flex-grow flex flex-col items-center justify-center text-center p-8 animate-fade-in",children:[e.jsxs("div",{className:"mb-6 relative",children:[e.jsx("div",{className:"absolute inset-0 bg-primary rounded-full blur-2xl opacity-20 animate-pulse"}),e.jsx("div",{className:"relative bg-surface p-6 rounded-full shadow-lg border border-border",children:e.jsx(i,{name:"bot",className:"w-16 h-16 text-primary"})})]}),e.jsxs("h3",{className:"text-3xl font-extrabold text-text mb-4",children:["Architecting Chapter ",r+1,"..."]}),e.jsx("p",{className:"text-lg text-text-muted max-w-md mb-8",children:"The Hyper-Course engine is currently synthesizing and auditing the next part of your curriculum. This will appear here in moments."}),e.jsx("div",{className:"w-full max-w-xs bg-border/30 rounded-full h-2 overflow-hidden",children:e.jsx("div",{className:"bg-primary h-full w-1/2 animate-[progress-indefinite_2s_ease-in-out_infinite]"})})]}):null,l&&s&&r===d-1&&e.jsxs("div",{className:"mt-16 p-8 bg-primary/5 border-2 border-dashed border-primary/20 rounded-2xl flex flex-col items-center text-center animate-pulse",children:[e.jsx("div",{className:"p-3 bg-surface rounded-full shadow-sm mb-4",children:e.jsx(i,{name:"bot",className:"w-10 h-10 text-primary"})}),e.jsx("h4",{className:"text-xl font-bold text-text mb-2",children:"Synthesizing Next Chapters"}),e.jsx("p",{className:"text-sm text-text-muted max-w-md",children:"Our Epistemic Integrity Layer is currently verifying claims and generating visualizations for the upcoming chapters. Feel free to re-read or practice what you've learned so far."})]})]}),e.jsxs("div",{className:"fixed bottom-0 left-0 right-0 p-4 bg-surface border-t border-border flex justify-between items-center md:static md:bg-transparent md:border-0 md:mt-8 z-20",children:[e.jsxs(m,{variant:"ghost",onClick:y,disabled:r===0,className:"text-text-muted hover:text-text",children:[e.jsx(i,{name:"chevron-left",className:"w-5 h-5 mr-1"})," Previous"]}),e.jsx("span",{className:"text-sm text-text-muted hidden md:inline",children:s?x.has(s.id)?"Read":c?"Locked":"Unread":"Preparing..."}),e.jsxs(m,{variant:"primary",size:"lg",onClick:v,disabled:!s||l&&r===d-1,className:"px-8 shadow-md",children:[r===d-1&&!l?"Finish":"Next Page",e.jsx(i,{name:r===d-1&&!l?"check-circle":"chevron-left",className:`w-5 h-5 ml-2 ${r!==d-1||l?"rotate-180":""}`})]})]}),e.jsx("style",{children:`
          @keyframes progress-indefinite {
              0% { transform: translateX(-100%); }
              100% { transform: translateX(200%); }
          }
      `})]})};export{J as default};
