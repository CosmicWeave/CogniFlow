(function(){const i=document.createElement("link").relList;if(i&&i.supports&&i.supports("modulepreload"))return;for(const d of document.querySelectorAll('link[rel="modulepreload"]'))p(d);new MutationObserver(d=>{for(const c of d)if(c.type==="childList")for(const l of c.addedNodes)l.tagName==="LINK"&&l.rel==="modulepreload"&&p(l)}).observe(document,{childList:!0,subtree:!0});function o(d){const c={};return d.integrity&&(c.integrity=d.integrity),d.referrerPolicy&&(c.referrerPolicy=d.referrerPolicy),d.crossOrigin==="use-credentials"?c.credentials="include":d.crossOrigin==="anonymous"?c.credentials="omit":c.credentials="same-origin",c}function p(d){if(d.ep)return;d.ep=!0;const c=o(d);fetch(d.href,c)}})();var vi=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function oo(n){return n&&n.__esModule&&Object.prototype.hasOwnProperty.call(n,"default")?n.default:n}function bp(n){if(Object.prototype.hasOwnProperty.call(n,"__esModule"))return n;var i=n.default;if(typeof i=="function"){var o=function p(){return this instanceof p?Reflect.construct(i,arguments,this.constructor):i.apply(this,arguments)};o.prototype=i.prototype}else o={};return Object.defineProperty(o,"__esModule",{value:!0}),Object.keys(n).forEach(function(p){var d=Object.getOwnPropertyDescriptor(n,p);Object.defineProperty(o,p,d.get?d:{enumerable:!0,get:function(){return n[p]}})}),o}var xc={exports:{}},Xa={},yc={exports:{}},dt={};/**
 * @license React
 * react.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var af;function kp(){if(af)return dt;af=1;var n=Symbol.for("react.element"),i=Symbol.for("react.portal"),o=Symbol.for("react.fragment"),p=Symbol.for("react.strict_mode"),d=Symbol.for("react.profiler"),c=Symbol.for("react.provider"),l=Symbol.for("react.context"),f=Symbol.for("react.forward_ref"),v=Symbol.for("react.suspense"),h=Symbol.for("react.memo"),C=Symbol.for("react.lazy"),k=Symbol.iterator;function I(_){return _===null||typeof _!="object"?null:(_=k&&_[k]||_["@@iterator"],typeof _=="function"?_:null)}var x={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},S=Object.assign,g={};function b(_,F,de){this.props=_,this.context=F,this.refs=g,this.updater=de||x}b.prototype.isReactComponent={},b.prototype.setState=function(_,F){if(typeof _!="object"&&typeof _!="function"&&_!=null)throw Error("setState(...): takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,_,F,"setState")},b.prototype.forceUpdate=function(_){this.updater.enqueueForceUpdate(this,_,"forceUpdate")};function j(){}j.prototype=b.prototype;function O(_,F,de){this.props=_,this.context=F,this.refs=g,this.updater=de||x}var R=O.prototype=new j;R.constructor=O,S(R,b.prototype),R.isPureReactComponent=!0;var A=Array.isArray,T=Object.prototype.hasOwnProperty,P={current:null},H={key:!0,ref:!0,__self:!0,__source:!0};function K(_,F,de){var he,ie={},be=null,Ne=null;if(F!=null)for(he in F.ref!==void 0&&(Ne=F.ref),F.key!==void 0&&(be=""+F.key),F)T.call(F,he)&&!H.hasOwnProperty(he)&&(ie[he]=F[he]);var Se=arguments.length-2;if(Se===1)ie.children=de;else if(1<Se){for(var ke=Array(Se),Ae=0;Ae<Se;Ae++)ke[Ae]=arguments[Ae+2];ie.children=ke}if(_&&_.defaultProps)for(he in Se=_.defaultProps,Se)ie[he]===void 0&&(ie[he]=Se[he]);return{$$typeof:n,type:_,key:be,ref:Ne,props:ie,_owner:P.current}}function W(_,F){return{$$typeof:n,type:_.type,key:F,ref:_.ref,props:_.props,_owner:_._owner}}function B(_){return typeof _=="object"&&_!==null&&_.$$typeof===n}function Y(_){var F={"=":"=0",":":"=2"};return"$"+_.replace(/[=:]/g,function(de){return F[de]})}var q=/\/+/g;function Q(_,F){return typeof _=="object"&&_!==null&&_.key!=null?Y(""+_.key):F.toString(36)}function N(_,F,de,he,ie){var be=typeof _;(be==="undefined"||be==="boolean")&&(_=null);var Ne=!1;if(_===null)Ne=!0;else switch(be){case"string":case"number":Ne=!0;break;case"object":switch(_.$$typeof){case n:case i:Ne=!0}}if(Ne)return Ne=_,ie=ie(Ne),_=he===""?"."+Q(Ne,0):he,A(ie)?(de="",_!=null&&(de=_.replace(q,"$&/")+"/"),N(ie,F,de,"",function(Ae){return Ae})):ie!=null&&(B(ie)&&(ie=W(ie,de+(!ie.key||Ne&&Ne.key===ie.key?"":(""+ie.key).replace(q,"$&/")+"/")+_)),F.push(ie)),1;if(Ne=0,he=he===""?".":he+":",A(_))for(var Se=0;Se<_.length;Se++){be=_[Se];var ke=he+Q(be,Se);Ne+=N(be,F,de,ke,ie)}else if(ke=I(_),typeof ke=="function")for(_=ke.call(_),Se=0;!(be=_.next()).done;)be=be.value,ke=he+Q(be,Se++),Ne+=N(be,F,de,ke,ie);else if(be==="object")throw F=String(_),Error("Objects are not valid as a React child (found: "+(F==="[object Object]"?"object with keys {"+Object.keys(_).join(", ")+"}":F)+"). If you meant to render a collection of children, use an array instead.");return Ne}function Z(_,F,de){if(_==null)return _;var he=[],ie=0;return N(_,he,"","",function(be){return F.call(de,be,ie++)}),he}function oe(_){if(_._status===-1){var F=_._result;F=F(),F.then(function(de){(_._status===0||_._status===-1)&&(_._status=1,_._result=de)},function(de){(_._status===0||_._status===-1)&&(_._status=2,_._result=de)}),_._status===-1&&(_._status=0,_._result=F)}if(_._status===1)return _._result.default;throw _._result}var fe={current:null},ye={transition:null},ue={ReactCurrentDispatcher:fe,ReactCurrentBatchConfig:ye,ReactCurrentOwner:P};function z(){throw Error("act(...) is not supported in production builds of React.")}return dt.Children={map:Z,forEach:function(_,F,de){Z(_,function(){F.apply(this,arguments)},de)},count:function(_){var F=0;return Z(_,function(){F++}),F},toArray:function(_){return Z(_,function(F){return F})||[]},only:function(_){if(!B(_))throw Error("React.Children.only expected to receive a single React element child.");return _}},dt.Component=b,dt.Fragment=o,dt.Profiler=d,dt.PureComponent=O,dt.StrictMode=p,dt.Suspense=v,dt.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=ue,dt.act=z,dt.cloneElement=function(_,F,de){if(_==null)throw Error("React.cloneElement(...): The argument must be a React element, but you passed "+_+".");var he=S({},_.props),ie=_.key,be=_.ref,Ne=_._owner;if(F!=null){if(F.ref!==void 0&&(be=F.ref,Ne=P.current),F.key!==void 0&&(ie=""+F.key),_.type&&_.type.defaultProps)var Se=_.type.defaultProps;for(ke in F)T.call(F,ke)&&!H.hasOwnProperty(ke)&&(he[ke]=F[ke]===void 0&&Se!==void 0?Se[ke]:F[ke])}var ke=arguments.length-2;if(ke===1)he.children=de;else if(1<ke){Se=Array(ke);for(var Ae=0;Ae<ke;Ae++)Se[Ae]=arguments[Ae+2];he.children=Se}return{$$typeof:n,type:_.type,key:ie,ref:be,props:he,_owner:Ne}},dt.createContext=function(_){return _={$$typeof:l,_currentValue:_,_currentValue2:_,_threadCount:0,Provider:null,Consumer:null,_defaultValue:null,_globalName:null},_.Provider={$$typeof:c,_context:_},_.Consumer=_},dt.createElement=K,dt.createFactory=function(_){var F=K.bind(null,_);return F.type=_,F},dt.createRef=function(){return{current:null}},dt.forwardRef=function(_){return{$$typeof:f,render:_}},dt.isValidElement=B,dt.lazy=function(_){return{$$typeof:C,_payload:{_status:-1,_result:_},_init:oe}},dt.memo=function(_,F){return{$$typeof:h,type:_,compare:F===void 0?null:F}},dt.startTransition=function(_){var F=ye.transition;ye.transition={};try{_()}finally{ye.transition=F}},dt.unstable_act=z,dt.useCallback=function(_,F){return fe.current.useCallback(_,F)},dt.useContext=function(_){return fe.current.useContext(_)},dt.useDebugValue=function(){},dt.useDeferredValue=function(_){return fe.current.useDeferredValue(_)},dt.useEffect=function(_,F){return fe.current.useEffect(_,F)},dt.useId=function(){return fe.current.useId()},dt.useImperativeHandle=function(_,F,de){return fe.current.useImperativeHandle(_,F,de)},dt.useInsertionEffect=function(_,F){return fe.current.useInsertionEffect(_,F)},dt.useLayoutEffect=function(_,F){return fe.current.useLayoutEffect(_,F)},dt.useMemo=function(_,F){return fe.current.useMemo(_,F)},dt.useReducer=function(_,F,de){return fe.current.useReducer(_,F,de)},dt.useRef=function(_){return fe.current.useRef(_)},dt.useState=function(_){return fe.current.useState(_)},dt.useSyncExternalStore=function(_,F,de){return fe.current.useSyncExternalStore(_,F,de)},dt.useTransition=function(){return fe.current.useTransition()},dt.version="18.3.1",dt}var of;function io(){return of||(of=1,yc.exports=kp()),yc.exports}/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var lf;function Sp(){if(lf)return Xa;lf=1;var n=io(),i=Symbol.for("react.element"),o=Symbol.for("react.fragment"),p=Object.prototype.hasOwnProperty,d=n.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,c={key:!0,ref:!0,__self:!0,__source:!0};function l(f,v,h){var C,k={},I=null,x=null;h!==void 0&&(I=""+h),v.key!==void 0&&(I=""+v.key),v.ref!==void 0&&(x=v.ref);for(C in v)p.call(v,C)&&!c.hasOwnProperty(C)&&(k[C]=v[C]);if(f&&f.defaultProps)for(C in v=f.defaultProps,v)k[C]===void 0&&(k[C]=v[C]);return{$$typeof:i,type:f,key:I,ref:x,props:k,_owner:d.current}}return Xa.Fragment=o,Xa.jsx=l,Xa.jsxs=l,Xa}var cf;function jp(){return cf||(cf=1,xc.exports=Sp()),xc.exports}var r=jp(),M=io();const so=oo(M);var wi={},vc={exports:{}},kr={},wc={exports:{}},bc={};/**
 * @license React
 * scheduler.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var uf;function Ep(){return uf||(uf=1,function(n){function i(ye,ue){var z=ye.length;ye.push(ue);e:for(;0<z;){var _=z-1>>>1,F=ye[_];if(0<d(F,ue))ye[_]=ue,ye[z]=F,z=_;else break e}}function o(ye){return ye.length===0?null:ye[0]}function p(ye){if(ye.length===0)return null;var ue=ye[0],z=ye.pop();if(z!==ue){ye[0]=z;e:for(var _=0,F=ye.length,de=F>>>1;_<de;){var he=2*(_+1)-1,ie=ye[he],be=he+1,Ne=ye[be];if(0>d(ie,z))be<F&&0>d(Ne,ie)?(ye[_]=Ne,ye[be]=z,_=be):(ye[_]=ie,ye[he]=z,_=he);else if(be<F&&0>d(Ne,z))ye[_]=Ne,ye[be]=z,_=be;else break e}}return ue}function d(ye,ue){var z=ye.sortIndex-ue.sortIndex;return z!==0?z:ye.id-ue.id}if(typeof performance=="object"&&typeof performance.now=="function"){var c=performance;n.unstable_now=function(){return c.now()}}else{var l=Date,f=l.now();n.unstable_now=function(){return l.now()-f}}var v=[],h=[],C=1,k=null,I=3,x=!1,S=!1,g=!1,b=typeof setTimeout=="function"?setTimeout:null,j=typeof clearTimeout=="function"?clearTimeout:null,O=typeof setImmediate<"u"?setImmediate:null;typeof navigator<"u"&&navigator.scheduling!==void 0&&navigator.scheduling.isInputPending!==void 0&&navigator.scheduling.isInputPending.bind(navigator.scheduling);function R(ye){for(var ue=o(h);ue!==null;){if(ue.callback===null)p(h);else if(ue.startTime<=ye)p(h),ue.sortIndex=ue.expirationTime,i(v,ue);else break;ue=o(h)}}function A(ye){if(g=!1,R(ye),!S)if(o(v)!==null)S=!0,oe(T);else{var ue=o(h);ue!==null&&fe(A,ue.startTime-ye)}}function T(ye,ue){S=!1,g&&(g=!1,j(K),K=-1),x=!0;var z=I;try{for(R(ue),k=o(v);k!==null&&(!(k.expirationTime>ue)||ye&&!Y());){var _=k.callback;if(typeof _=="function"){k.callback=null,I=k.priorityLevel;var F=_(k.expirationTime<=ue);ue=n.unstable_now(),typeof F=="function"?k.callback=F:k===o(v)&&p(v),R(ue)}else p(v);k=o(v)}if(k!==null)var de=!0;else{var he=o(h);he!==null&&fe(A,he.startTime-ue),de=!1}return de}finally{k=null,I=z,x=!1}}var P=!1,H=null,K=-1,W=5,B=-1;function Y(){return!(n.unstable_now()-B<W)}function q(){if(H!==null){var ye=n.unstable_now();B=ye;var ue=!0;try{ue=H(!0,ye)}finally{ue?Q():(P=!1,H=null)}}else P=!1}var Q;if(typeof O=="function")Q=function(){O(q)};else if(typeof MessageChannel<"u"){var N=new MessageChannel,Z=N.port2;N.port1.onmessage=q,Q=function(){Z.postMessage(null)}}else Q=function(){b(q,0)};function oe(ye){H=ye,P||(P=!0,Q())}function fe(ye,ue){K=b(function(){ye(n.unstable_now())},ue)}n.unstable_IdlePriority=5,n.unstable_ImmediatePriority=1,n.unstable_LowPriority=4,n.unstable_NormalPriority=3,n.unstable_Profiling=null,n.unstable_UserBlockingPriority=2,n.unstable_cancelCallback=function(ye){ye.callback=null},n.unstable_continueExecution=function(){S||x||(S=!0,oe(T))},n.unstable_forceFrameRate=function(ye){0>ye||125<ye?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):W=0<ye?Math.floor(1e3/ye):5},n.unstable_getCurrentPriorityLevel=function(){return I},n.unstable_getFirstCallbackNode=function(){return o(v)},n.unstable_next=function(ye){switch(I){case 1:case 2:case 3:var ue=3;break;default:ue=I}var z=I;I=ue;try{return ye()}finally{I=z}},n.unstable_pauseExecution=function(){},n.unstable_requestPaint=function(){},n.unstable_runWithPriority=function(ye,ue){switch(ye){case 1:case 2:case 3:case 4:case 5:break;default:ye=3}var z=I;I=ye;try{return ue()}finally{I=z}},n.unstable_scheduleCallback=function(ye,ue,z){var _=n.unstable_now();switch(typeof z=="object"&&z!==null?(z=z.delay,z=typeof z=="number"&&0<z?_+z:_):z=_,ye){case 1:var F=-1;break;case 2:F=250;break;case 5:F=1073741823;break;case 4:F=1e4;break;default:F=5e3}return F=z+F,ye={id:C++,callback:ue,priorityLevel:ye,startTime:z,expirationTime:F,sortIndex:-1},z>_?(ye.sortIndex=z,i(h,ye),o(v)===null&&ye===o(h)&&(g?(j(K),K=-1):g=!0,fe(A,z-_))):(ye.sortIndex=F,i(v,ye),S||x||(S=!0,oe(T))),ye},n.unstable_shouldYield=Y,n.unstable_wrapCallback=function(ye){var ue=I;return function(){var z=I;I=ue;try{return ye.apply(this,arguments)}finally{I=z}}}}(bc)),bc}var df;function Np(){return df||(df=1,wc.exports=Ep()),wc.exports}/**
 * @license React
 * react-dom.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var ff;function _p(){if(ff)return kr;ff=1;var n=io(),i=Np();function o(e){for(var t="https://reactjs.org/docs/error-decoder.html?invariant="+e,s=1;s<arguments.length;s++)t+="&args[]="+encodeURIComponent(arguments[s]);return"Minified React error #"+e+"; visit "+t+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}var p=new Set,d={};function c(e,t){l(e,t),l(e+"Capture",t)}function l(e,t){for(d[e]=t,e=0;e<t.length;e++)p.add(t[e])}var f=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),v=Object.prototype.hasOwnProperty,h=/^[:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD][:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\-.0-9\u00B7\u0300-\u036F\u203F-\u2040]*$/,C={},k={};function I(e){return v.call(k,e)?!0:v.call(C,e)?!1:h.test(e)?k[e]=!0:(C[e]=!0,!1)}function x(e,t,s,a){if(s!==null&&s.type===0)return!1;switch(typeof t){case"function":case"symbol":return!0;case"boolean":return a?!1:s!==null?!s.acceptsBooleans:(e=e.toLowerCase().slice(0,5),e!=="data-"&&e!=="aria-");default:return!1}}function S(e,t,s,a){if(t===null||typeof t>"u"||x(e,t,s,a))return!0;if(a)return!1;if(s!==null)switch(s.type){case 3:return!t;case 4:return t===!1;case 5:return isNaN(t);case 6:return isNaN(t)||1>t}return!1}function g(e,t,s,a,m,w,L){this.acceptsBooleans=t===2||t===3||t===4,this.attributeName=a,this.attributeNamespace=m,this.mustUseProperty=s,this.propertyName=e,this.type=t,this.sanitizeURL=w,this.removeEmptyString=L}var b={};"children dangerouslySetInnerHTML defaultValue defaultChecked innerHTML suppressContentEditableWarning suppressHydrationWarning style".split(" ").forEach(function(e){b[e]=new g(e,0,!1,e,null,!1,!1)}),[["acceptCharset","accept-charset"],["className","class"],["htmlFor","for"],["httpEquiv","http-equiv"]].forEach(function(e){var t=e[0];b[t]=new g(t,1,!1,e[1],null,!1,!1)}),["contentEditable","draggable","spellCheck","value"].forEach(function(e){b[e]=new g(e,2,!1,e.toLowerCase(),null,!1,!1)}),["autoReverse","externalResourcesRequired","focusable","preserveAlpha"].forEach(function(e){b[e]=new g(e,2,!1,e,null,!1,!1)}),"allowFullScreen async autoFocus autoPlay controls default defer disabled disablePictureInPicture disableRemotePlayback formNoValidate hidden loop noModule noValidate open playsInline readOnly required reversed scoped seamless itemScope".split(" ").forEach(function(e){b[e]=new g(e,3,!1,e.toLowerCase(),null,!1,!1)}),["checked","multiple","muted","selected"].forEach(function(e){b[e]=new g(e,3,!0,e,null,!1,!1)}),["capture","download"].forEach(function(e){b[e]=new g(e,4,!1,e,null,!1,!1)}),["cols","rows","size","span"].forEach(function(e){b[e]=new g(e,6,!1,e,null,!1,!1)}),["rowSpan","start"].forEach(function(e){b[e]=new g(e,5,!1,e.toLowerCase(),null,!1,!1)});var j=/[\-:]([a-z])/g;function O(e){return e[1].toUpperCase()}"accent-height alignment-baseline arabic-form baseline-shift cap-height clip-path clip-rule color-interpolation color-interpolation-filters color-profile color-rendering dominant-baseline enable-background fill-opacity fill-rule flood-color flood-opacity font-family font-size font-size-adjust font-stretch font-style font-variant font-weight glyph-name glyph-orientation-horizontal glyph-orientation-vertical horiz-adv-x horiz-origin-x image-rendering letter-spacing lighting-color marker-end marker-mid marker-start overline-position overline-thickness paint-order panose-1 pointer-events rendering-intent shape-rendering stop-color stop-opacity strikethrough-position strikethrough-thickness stroke-dasharray stroke-dashoffset stroke-linecap stroke-linejoin stroke-miterlimit stroke-opacity stroke-width text-anchor text-decoration text-rendering underline-position underline-thickness unicode-bidi unicode-range units-per-em v-alphabetic v-hanging v-ideographic v-mathematical vector-effect vert-adv-y vert-origin-x vert-origin-y word-spacing writing-mode xmlns:xlink x-height".split(" ").forEach(function(e){var t=e.replace(j,O);b[t]=new g(t,1,!1,e,null,!1,!1)}),"xlink:actuate xlink:arcrole xlink:role xlink:show xlink:title xlink:type".split(" ").forEach(function(e){var t=e.replace(j,O);b[t]=new g(t,1,!1,e,"http://www.w3.org/1999/xlink",!1,!1)}),["xml:base","xml:lang","xml:space"].forEach(function(e){var t=e.replace(j,O);b[t]=new g(t,1,!1,e,"http://www.w3.org/XML/1998/namespace",!1,!1)}),["tabIndex","crossOrigin"].forEach(function(e){b[e]=new g(e,1,!1,e.toLowerCase(),null,!1,!1)}),b.xlinkHref=new g("xlinkHref",1,!1,"xlink:href","http://www.w3.org/1999/xlink",!0,!1),["src","href","action","formAction"].forEach(function(e){b[e]=new g(e,1,!1,e.toLowerCase(),null,!0,!0)});function R(e,t,s,a){var m=b.hasOwnProperty(t)?b[t]:null;(m!==null?m.type!==0:a||!(2<t.length)||t[0]!=="o"&&t[0]!=="O"||t[1]!=="n"&&t[1]!=="N")&&(S(t,s,m,a)&&(s=null),a||m===null?I(t)&&(s===null?e.removeAttribute(t):e.setAttribute(t,""+s)):m.mustUseProperty?e[m.propertyName]=s===null?m.type===3?!1:"":s:(t=m.attributeName,a=m.attributeNamespace,s===null?e.removeAttribute(t):(m=m.type,s=m===3||m===4&&s===!0?"":""+s,a?e.setAttributeNS(a,t,s):e.setAttribute(t,s))))}var A=n.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED,T=Symbol.for("react.element"),P=Symbol.for("react.portal"),H=Symbol.for("react.fragment"),K=Symbol.for("react.strict_mode"),W=Symbol.for("react.profiler"),B=Symbol.for("react.provider"),Y=Symbol.for("react.context"),q=Symbol.for("react.forward_ref"),Q=Symbol.for("react.suspense"),N=Symbol.for("react.suspense_list"),Z=Symbol.for("react.memo"),oe=Symbol.for("react.lazy"),fe=Symbol.for("react.offscreen"),ye=Symbol.iterator;function ue(e){return e===null||typeof e!="object"?null:(e=ye&&e[ye]||e["@@iterator"],typeof e=="function"?e:null)}var z=Object.assign,_;function F(e){if(_===void 0)try{throw Error()}catch(s){var t=s.stack.trim().match(/\n( *(at )?)/);_=t&&t[1]||""}return`
`+_+e}var de=!1;function he(e,t){if(!e||de)return"";de=!0;var s=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{if(t)if(t=function(){throw Error()},Object.defineProperty(t.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(t,[])}catch(ve){var a=ve}Reflect.construct(e,[],t)}else{try{t.call()}catch(ve){a=ve}e.call(t.prototype)}else{try{throw Error()}catch(ve){a=ve}e()}}catch(ve){if(ve&&a&&typeof ve.stack=="string"){for(var m=ve.stack.split(`
`),w=a.stack.split(`
`),L=m.length-1,V=w.length-1;1<=L&&0<=V&&m[L]!==w[V];)V--;for(;1<=L&&0<=V;L--,V--)if(m[L]!==w[V]){if(L!==1||V!==1)do if(L--,V--,0>V||m[L]!==w[V]){var te=`
`+m[L].replace(" at new "," at ");return e.displayName&&te.includes("<anonymous>")&&(te=te.replace("<anonymous>",e.displayName)),te}while(1<=L&&0<=V);break}}}finally{de=!1,Error.prepareStackTrace=s}return(e=e?e.displayName||e.name:"")?F(e):""}function ie(e){switch(e.tag){case 5:return F(e.type);case 16:return F("Lazy");case 13:return F("Suspense");case 19:return F("SuspenseList");case 0:case 2:case 15:return e=he(e.type,!1),e;case 11:return e=he(e.type.render,!1),e;case 1:return e=he(e.type,!0),e;default:return""}}function be(e){if(e==null)return null;if(typeof e=="function")return e.displayName||e.name||null;if(typeof e=="string")return e;switch(e){case H:return"Fragment";case P:return"Portal";case W:return"Profiler";case K:return"StrictMode";case Q:return"Suspense";case N:return"SuspenseList"}if(typeof e=="object")switch(e.$$typeof){case Y:return(e.displayName||"Context")+".Consumer";case B:return(e._context.displayName||"Context")+".Provider";case q:var t=e.render;return e=e.displayName,e||(e=t.displayName||t.name||"",e=e!==""?"ForwardRef("+e+")":"ForwardRef"),e;case Z:return t=e.displayName||null,t!==null?t:be(e.type)||"Memo";case oe:t=e._payload,e=e._init;try{return be(e(t))}catch{}}return null}function Ne(e){var t=e.type;switch(e.tag){case 24:return"Cache";case 9:return(t.displayName||"Context")+".Consumer";case 10:return(t._context.displayName||"Context")+".Provider";case 18:return"DehydratedFragment";case 11:return e=t.render,e=e.displayName||e.name||"",t.displayName||(e!==""?"ForwardRef("+e+")":"ForwardRef");case 7:return"Fragment";case 5:return t;case 4:return"Portal";case 3:return"Root";case 6:return"Text";case 16:return be(t);case 8:return t===K?"StrictMode":"Mode";case 22:return"Offscreen";case 12:return"Profiler";case 21:return"Scope";case 13:return"Suspense";case 19:return"SuspenseList";case 25:return"TracingMarker";case 1:case 0:case 17:case 2:case 14:case 15:if(typeof t=="function")return t.displayName||t.name||null;if(typeof t=="string")return t}return null}function Se(e){switch(typeof e){case"boolean":case"number":case"string":case"undefined":return e;case"object":return e;default:return""}}function ke(e){var t=e.type;return(e=e.nodeName)&&e.toLowerCase()==="input"&&(t==="checkbox"||t==="radio")}function Ae(e){var t=ke(e)?"checked":"value",s=Object.getOwnPropertyDescriptor(e.constructor.prototype,t),a=""+e[t];if(!e.hasOwnProperty(t)&&typeof s<"u"&&typeof s.get=="function"&&typeof s.set=="function"){var m=s.get,w=s.set;return Object.defineProperty(e,t,{configurable:!0,get:function(){return m.call(this)},set:function(L){a=""+L,w.call(this,L)}}),Object.defineProperty(e,t,{enumerable:s.enumerable}),{getValue:function(){return a},setValue:function(L){a=""+L},stopTracking:function(){e._valueTracker=null,delete e[t]}}}}function Pe(e){e._valueTracker||(e._valueTracker=Ae(e))}function Ye(e){if(!e)return!1;var t=e._valueTracker;if(!t)return!0;var s=t.getValue(),a="";return e&&(a=ke(e)?e.checked?"true":"false":e.value),e=a,e!==s?(t.setValue(e),!0):!1}function Re(e){if(e=e||(typeof document<"u"?document:void 0),typeof e>"u")return null;try{return e.activeElement||e.body}catch{return e.body}}function E(e,t){var s=t.checked;return z({},t,{defaultChecked:void 0,defaultValue:void 0,value:void 0,checked:s??e._wrapperState.initialChecked})}function ge(e,t){var s=t.defaultValue==null?"":t.defaultValue,a=t.checked!=null?t.checked:t.defaultChecked;s=Se(t.value!=null?t.value:s),e._wrapperState={initialChecked:a,initialValue:s,controlled:t.type==="checkbox"||t.type==="radio"?t.checked!=null:t.value!=null}}function re(e,t){t=t.checked,t!=null&&R(e,"checked",t,!1)}function $(e,t){re(e,t);var s=Se(t.value),a=t.type;if(s!=null)a==="number"?(s===0&&e.value===""||e.value!=s)&&(e.value=""+s):e.value!==""+s&&(e.value=""+s);else if(a==="submit"||a==="reset"){e.removeAttribute("value");return}t.hasOwnProperty("value")?ee(e,t.type,s):t.hasOwnProperty("defaultValue")&&ee(e,t.type,Se(t.defaultValue)),t.checked==null&&t.defaultChecked!=null&&(e.defaultChecked=!!t.defaultChecked)}function G(e,t,s){if(t.hasOwnProperty("value")||t.hasOwnProperty("defaultValue")){var a=t.type;if(!(a!=="submit"&&a!=="reset"||t.value!==void 0&&t.value!==null))return;t=""+e._wrapperState.initialValue,s||t===e.value||(e.value=t),e.defaultValue=t}s=e.name,s!==""&&(e.name=""),e.defaultChecked=!!e._wrapperState.initialChecked,s!==""&&(e.name=s)}function ee(e,t,s){(t!=="number"||Re(e.ownerDocument)!==e)&&(s==null?e.defaultValue=""+e._wrapperState.initialValue:e.defaultValue!==""+s&&(e.defaultValue=""+s))}var ce=Array.isArray;function le(e,t,s,a){if(e=e.options,t){t={};for(var m=0;m<s.length;m++)t["$"+s[m]]=!0;for(s=0;s<e.length;s++)m=t.hasOwnProperty("$"+e[s].value),e[s].selected!==m&&(e[s].selected=m),m&&a&&(e[s].defaultSelected=!0)}else{for(s=""+Se(s),t=null,m=0;m<e.length;m++){if(e[m].value===s){e[m].selected=!0,a&&(e[m].defaultSelected=!0);return}t!==null||e[m].disabled||(t=e[m])}t!==null&&(t.selected=!0)}}function ne(e,t){if(t.dangerouslySetInnerHTML!=null)throw Error(o(91));return z({},t,{value:void 0,defaultValue:void 0,children:""+e._wrapperState.initialValue})}function je(e,t){var s=t.value;if(s==null){if(s=t.children,t=t.defaultValue,s!=null){if(t!=null)throw Error(o(92));if(ce(s)){if(1<s.length)throw Error(o(93));s=s[0]}t=s}t==null&&(t=""),s=t}e._wrapperState={initialValue:Se(s)}}function Me(e,t){var s=Se(t.value),a=Se(t.defaultValue);s!=null&&(s=""+s,s!==e.value&&(e.value=s),t.defaultValue==null&&e.defaultValue!==s&&(e.defaultValue=s)),a!=null&&(e.defaultValue=""+a)}function Te(e){var t=e.textContent;t===e._wrapperState.initialValue&&t!==""&&t!==null&&(e.value=t)}function ze(e){switch(e){case"svg":return"http://www.w3.org/2000/svg";case"math":return"http://www.w3.org/1998/Math/MathML";default:return"http://www.w3.org/1999/xhtml"}}function ut(e,t){return e==null||e==="http://www.w3.org/1999/xhtml"?ze(t):e==="http://www.w3.org/2000/svg"&&t==="foreignObject"?"http://www.w3.org/1999/xhtml":e}var rt,bt=function(e){return typeof MSApp<"u"&&MSApp.execUnsafeLocalFunction?function(t,s,a,m){MSApp.execUnsafeLocalFunction(function(){return e(t,s,a,m)})}:e}(function(e,t){if(e.namespaceURI!=="http://www.w3.org/2000/svg"||"innerHTML"in e)e.innerHTML=t;else{for(rt=rt||document.createElement("div"),rt.innerHTML="<svg>"+t.valueOf().toString()+"</svg>",t=rt.firstChild;e.firstChild;)e.removeChild(e.firstChild);for(;t.firstChild;)e.appendChild(t.firstChild)}});function Ue(e,t){if(t){var s=e.firstChild;if(s&&s===e.lastChild&&s.nodeType===3){s.nodeValue=t;return}}e.textContent=t}var Ke={animationIterationCount:!0,aspectRatio:!0,borderImageOutset:!0,borderImageSlice:!0,borderImageWidth:!0,boxFlex:!0,boxFlexGroup:!0,boxOrdinalGroup:!0,columnCount:!0,columns:!0,flex:!0,flexGrow:!0,flexPositive:!0,flexShrink:!0,flexNegative:!0,flexOrder:!0,gridArea:!0,gridRow:!0,gridRowEnd:!0,gridRowSpan:!0,gridRowStart:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnSpan:!0,gridColumnStart:!0,fontWeight:!0,lineClamp:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,tabSize:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,strokeDasharray:!0,strokeDashoffset:!0,strokeMiterlimit:!0,strokeOpacity:!0,strokeWidth:!0},ot=["Webkit","ms","Moz","O"];Object.keys(Ke).forEach(function(e){ot.forEach(function(t){t=t+e.charAt(0).toUpperCase()+e.substring(1),Ke[t]=Ke[e]})});function it(e,t,s){return t==null||typeof t=="boolean"||t===""?"":s||typeof t!="number"||t===0||Ke.hasOwnProperty(e)&&Ke[e]?(""+t).trim():t+"px"}function Ot(e,t){e=e.style;for(var s in t)if(t.hasOwnProperty(s)){var a=s.indexOf("--")===0,m=it(s,t[s],a);s==="float"&&(s="cssFloat"),a?e.setProperty(s,m):e[s]=m}}var Ht=z({menuitem:!0},{area:!0,base:!0,br:!0,col:!0,embed:!0,hr:!0,img:!0,input:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0});function ft(e,t){if(t){if(Ht[e]&&(t.children!=null||t.dangerouslySetInnerHTML!=null))throw Error(o(137,e));if(t.dangerouslySetInnerHTML!=null){if(t.children!=null)throw Error(o(60));if(typeof t.dangerouslySetInnerHTML!="object"||!("__html"in t.dangerouslySetInnerHTML))throw Error(o(61))}if(t.style!=null&&typeof t.style!="object")throw Error(o(62))}}function pt(e,t){if(e.indexOf("-")===-1)return typeof t.is=="string";switch(e){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var Ve=null;function jr(e){return e=e.target||e.srcElement||window,e.correspondingUseElement&&(e=e.correspondingUseElement),e.nodeType===3?e.parentNode:e}var cr=null,Rr=null,qt=null;function pn(e){if(e=Pa(e)){if(typeof cr!="function")throw Error(o(280));var t=e.stateNode;t&&(t=Ro(t),cr(e.stateNode,e.type,t))}}function qr(e){Rr?qt?qt.push(e):qt=[e]:Rr=e}function ka(){if(Rr){var e=Rr,t=qt;if(qt=Rr=null,pn(e),t)for(e=0;e<t.length;e++)pn(t[e])}}function Fe(e,t){return e(t)}function Fs(){}var $t=!1;function In(e,t,s){if($t)return e(t,s);$t=!0;try{return Fe(e,t,s)}finally{$t=!1,(Rr!==null||qt!==null)&&(Fs(),ka())}}function gn(e,t){var s=e.stateNode;if(s===null)return null;var a=Ro(s);if(a===null)return null;s=a[t];e:switch(t){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(a=!a.disabled)||(e=e.type,a=!(e==="button"||e==="input"||e==="select"||e==="textarea")),e=!a;break e;default:e=!1}if(e)return null;if(s&&typeof s!="function")throw Error(o(231,t,typeof s));return s}var Ps=!1;if(f)try{var Er={};Object.defineProperty(Er,"passive",{get:function(){Ps=!0}}),window.addEventListener("test",Er,Er),window.removeEventListener("test",Er,Er)}catch{Ps=!1}function lo(e,t,s,a,m,w,L,V,te){var ve=Array.prototype.slice.call(arguments,3);try{t.apply(s,ve)}catch(Ie){this.onError(Ie)}}var Gt=!1,ss=null,$r=!1,Us=null,co={onError:function(e){Gt=!0,ss=e}};function Mi(e,t,s,a,m,w,L,V,te){Gt=!1,ss=null,lo.apply(co,arguments)}function Jt(e,t,s,a,m,w,L,V,te){if(Mi.apply(this,arguments),Gt){if(Gt){var ve=ss;Gt=!1,ss=null}else throw Error(o(198));$r||($r=!0,Us=ve)}}function sn(e){var t=e,s=e;if(e.alternate)for(;t.return;)t=t.return;else{e=t;do t=e,(t.flags&4098)!==0&&(s=t.return),e=t.return;while(e)}return t.tag===3?s:null}function uo(e){if(e.tag===13){var t=e.memoizedState;if(t===null&&(e=e.alternate,e!==null&&(t=e.memoizedState)),t!==null)return t.dehydrated}return null}function zs(e){if(sn(e)!==e)throw Error(o(188))}function fo(e){var t=e.alternate;if(!t){if(t=sn(e),t===null)throw Error(o(188));return t!==e?null:e}for(var s=e,a=t;;){var m=s.return;if(m===null)break;var w=m.alternate;if(w===null){if(a=m.return,a!==null){s=a;continue}break}if(m.child===w.child){for(w=m.child;w;){if(w===s)return zs(m),e;if(w===a)return zs(m),t;w=w.sibling}throw Error(o(188))}if(s.return!==a.return)s=m,a=w;else{for(var L=!1,V=m.child;V;){if(V===s){L=!0,s=m,a=w;break}if(V===a){L=!0,a=m,s=w;break}V=V.sibling}if(!L){for(V=w.child;V;){if(V===s){L=!0,s=w,a=m;break}if(V===a){L=!0,a=w,s=m;break}V=V.sibling}if(!L)throw Error(o(189))}}if(s.alternate!==a)throw Error(o(190))}if(s.tag!==3)throw Error(o(188));return s.stateNode.current===s?e:t}function as(e){return e=fo(e),e!==null?Nr(e):null}function Nr(e){if(e.tag===5||e.tag===6)return e;for(e=e.child;e!==null;){var t=Nr(e);if(t!==null)return t;e=e.sibling}return null}var os=i.unstable_scheduleCallback,Bs=i.unstable_cancelCallback,ho=i.unstable_shouldYield,mo=i.unstable_requestPaint,Et=i.unstable_now,is=i.unstable_getCurrentPriorityLevel,Hs=i.unstable_ImmediatePriority,ls=i.unstable_UserBlockingPriority,cs=i.unstable_NormalPriority,Dn=i.unstable_LowPriority,qs=i.unstable_IdlePriority,us=null,_r=null;function po(e){if(_r&&typeof _r.onCommitFiberRoot=="function")try{_r.onCommitFiberRoot(us,e,void 0,(e.current.flags&128)===128)}catch{}}var Cr=Math.clz32?Math.clz32:ds,go=Math.log,xo=Math.LN2;function ds(e){return e>>>=0,e===0?32:31-(go(e)/xo|0)|0}var fs=64,vt=4194304;function Gr(e){switch(e&-e){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return e&4194240;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return e&130023424;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 1073741824;default:return e}}function Tn(e,t){var s=e.pendingLanes;if(s===0)return 0;var a=0,m=e.suspendedLanes,w=e.pingedLanes,L=s&268435455;if(L!==0){var V=L&~m;V!==0?a=Gr(V):(w&=L,w!==0&&(a=Gr(w)))}else L=s&~m,L!==0?a=Gr(L):w!==0&&(a=Gr(w));if(a===0)return 0;if(t!==0&&t!==a&&(t&m)===0&&(m=a&-a,w=t&-t,m>=w||m===16&&(w&4194240)!==0))return t;if((a&4)!==0&&(a|=s&16),t=e.entangledLanes,t!==0)for(e=e.entanglements,t&=a;0<t;)s=31-Cr(t),m=1<<s,a|=e[s],t&=~m;return a}function xn(e,t){switch(e){case 1:case 2:case 4:return t+250;case 8:case 16:case 32:case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return t+5e3;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return-1;case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function $s(e,t){for(var s=e.suspendedLanes,a=e.pingedLanes,m=e.expirationTimes,w=e.pendingLanes;0<w;){var L=31-Cr(w),V=1<<L,te=m[L];te===-1?((V&s)===0||(V&a)!==0)&&(m[L]=xn(V,t)):te<=t&&(e.expiredLanes|=V),w&=~V}}function An(e){return e=e.pendingLanes&-1073741825,e!==0?e:e&1073741824?1073741824:0}function hs(){var e=fs;return fs<<=1,(fs&4194240)===0&&(fs=64),e}function yn(e){for(var t=[],s=0;31>s;s++)t.push(e);return t}function ms(e,t,s){e.pendingLanes|=t,t!==536870912&&(e.suspendedLanes=0,e.pingedLanes=0),e=e.eventTimes,t=31-Cr(t),e[t]=s}function Li(e,t){var s=e.pendingLanes&~t;e.pendingLanes=t,e.suspendedLanes=0,e.pingedLanes=0,e.expiredLanes&=t,e.mutableReadLanes&=t,e.entangledLanes&=t,t=e.entanglements;var a=e.eventTimes;for(e=e.expirationTimes;0<s;){var m=31-Cr(s),w=1<<m;t[m]=0,a[m]=-1,e[m]=-1,s&=~w}}function Gs(e,t){var s=e.entangledLanes|=t;for(e=e.entanglements;s;){var a=31-Cr(s),m=1<<a;m&t|e[a]&t&&(e[a]|=t),s&=~m}}var gt=0;function Sa(e){return e&=-e,1<e?4<e?(e&268435455)!==0?16:536870912:4:1}var Ws,ps,yo,gs,xs,Wr=!1,On=[],Wt=null,ur=null,Ir=null,Rn=new Map,ys=new Map,$e=[],vo="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset submit".split(" ");function vs(e,t){switch(e){case"focusin":case"focusout":Wt=null;break;case"dragenter":case"dragleave":ur=null;break;case"mouseover":case"mouseout":Ir=null;break;case"pointerover":case"pointerout":Rn.delete(t.pointerId);break;case"gotpointercapture":case"lostpointercapture":ys.delete(t.pointerId)}}function an(e,t,s,a,m,w){return e===null||e.nativeEvent!==w?(e={blockedOn:t,domEventName:s,eventSystemFlags:a,nativeEvent:w,targetContainers:[m]},t!==null&&(t=Pa(t),t!==null&&ps(t)),e):(e.eventSystemFlags|=a,t=e.targetContainers,m!==null&&t.indexOf(m)===-1&&t.push(m),e)}function wo(e,t,s,a,m){switch(t){case"focusin":return Wt=an(Wt,e,t,s,a,m),!0;case"dragenter":return ur=an(ur,e,t,s,a,m),!0;case"mouseover":return Ir=an(Ir,e,t,s,a,m),!0;case"pointerover":var w=m.pointerId;return Rn.set(w,an(Rn.get(w)||null,e,t,s,a,m)),!0;case"gotpointercapture":return w=m.pointerId,ys.set(w,an(ys.get(w)||null,e,t,s,a,m)),!0}return!1}function Mn(e){var t=js(e.target);if(t!==null){var s=sn(t);if(s!==null){if(t=s.tag,t===13){if(t=uo(s),t!==null){e.blockedOn=t,xs(e.priority,function(){yo(s)});return}}else if(t===3&&s.stateNode.current.memoizedState.isDehydrated){e.blockedOn=s.tag===3?s.stateNode.containerInfo:null;return}}}e.blockedOn=null}function on(e){if(e.blockedOn!==null)return!1;for(var t=e.targetContainers;0<t.length;){var s=Xe(e.domEventName,e.eventSystemFlags,t[0],e.nativeEvent);if(s===null){s=e.nativeEvent;var a=new s.constructor(s.type,s);Ve=a,s.target.dispatchEvent(a),Ve=null}else return t=Pa(s),t!==null&&ps(t),e.blockedOn=s,!1;t.shift()}return!0}function Qr(e,t,s){on(e)&&s.delete(t)}function Qs(){Wr=!1,Wt!==null&&on(Wt)&&(Wt=null),ur!==null&&on(ur)&&(ur=null),Ir!==null&&on(Ir)&&(Ir=null),Rn.forEach(Qr),ys.forEach(Qr)}function Ln(e,t){e.blockedOn===t&&(e.blockedOn=null,Wr||(Wr=!0,i.unstable_scheduleCallback(i.unstable_NormalPriority,Qs)))}function u(e){function t(m){return Ln(m,e)}if(0<On.length){Ln(On[0],e);for(var s=1;s<On.length;s++){var a=On[s];a.blockedOn===e&&(a.blockedOn=null)}}for(Wt!==null&&Ln(Wt,e),ur!==null&&Ln(ur,e),Ir!==null&&Ln(Ir,e),Rn.forEach(t),ys.forEach(t),s=0;s<$e.length;s++)a=$e[s],a.blockedOn===e&&(a.blockedOn=null);for(;0<$e.length&&(s=$e[0],s.blockedOn===null);)Mn(s),s.blockedOn===null&&$e.shift()}var y=A.ReactCurrentBatchConfig,D=!0;function U(e,t,s,a){var m=gt,w=y.transition;y.transition=null;try{gt=1,we(e,t,s,a)}finally{gt=m,y.transition=w}}function X(e,t,s,a){var m=gt,w=y.transition;y.transition=null;try{gt=4,we(e,t,s,a)}finally{gt=m,y.transition=w}}function we(e,t,s,a){if(D){var m=Xe(e,t,s,a);if(m===null)il(e,t,a,Ee,s),vs(e,a);else if(wo(m,e,t,s,a))a.stopPropagation();else if(vs(e,a),t&4&&-1<vo.indexOf(e)){for(;m!==null;){var w=Pa(m);if(w!==null&&Ws(w),w=Xe(e,t,s,a),w===null&&il(e,t,a,Ee,s),w===m)break;m=w}m!==null&&a.stopPropagation()}else il(e,t,a,null,s)}}var Ee=null;function Xe(e,t,s,a){if(Ee=null,e=jr(a),e=js(e),e!==null)if(t=sn(e),t===null)e=null;else if(s=t.tag,s===13){if(e=uo(t),e!==null)return e;e=null}else if(s===3){if(t.stateNode.current.memoizedState.isDehydrated)return t.tag===3?t.stateNode.containerInfo:null;e=null}else t!==e&&(e=null);return Ee=e,null}function ht(e){switch(e){case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 1;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"toggle":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 4;case"message":switch(is()){case Hs:return 1;case ls:return 4;case cs:case Dn:return 16;case qs:return 536870912;default:return 16}default:return 16}}var tt=null,Nt=null,Ct=null;function ja(){if(Ct)return Ct;var e,t=Nt,s=t.length,a,m="value"in tt?tt.value:tt.textContent,w=m.length;for(e=0;e<s&&t[e]===m[e];e++);var L=s-e;for(a=1;a<=L&&t[s-a]===m[w-a];a++);return Ct=m.slice(e,1<a?1-a:void 0)}function Ys(e){var t=e.keyCode;return"charCode"in e?(e=e.charCode,e===0&&t===13&&(e=13)):e=t,e===10&&(e=13),32<=e||e===13?e:0}function ws(){return!0}function bo(){return!1}function tr(e){function t(s,a,m,w,L){this._reactName=s,this._targetInst=m,this.type=a,this.nativeEvent=w,this.target=L,this.currentTarget=null;for(var V in e)e.hasOwnProperty(V)&&(s=e[V],this[V]=s?s(w):w[V]);return this.isDefaultPrevented=(w.defaultPrevented!=null?w.defaultPrevented:w.returnValue===!1)?ws:bo,this.isPropagationStopped=bo,this}return z(t.prototype,{preventDefault:function(){this.defaultPrevented=!0;var s=this.nativeEvent;s&&(s.preventDefault?s.preventDefault():typeof s.returnValue!="unknown"&&(s.returnValue=!1),this.isDefaultPrevented=ws)},stopPropagation:function(){var s=this.nativeEvent;s&&(s.stopPropagation?s.stopPropagation():typeof s.cancelBubble!="unknown"&&(s.cancelBubble=!0),this.isPropagationStopped=ws)},persist:function(){},isPersistent:ws}),t}var Fn={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(e){return e.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},Ea=tr(Fn),bs=z({},Fn,{view:0,detail:0}),Fi=tr(bs),Na,_a,ks,Vs=z({},bs,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:Ks,button:0,buttons:0,relatedTarget:function(e){return e.relatedTarget===void 0?e.fromElement===e.srcElement?e.toElement:e.fromElement:e.relatedTarget},movementX:function(e){return"movementX"in e?e.movementX:(e!==ks&&(ks&&e.type==="mousemove"?(Na=e.screenX-ks.screenX,_a=e.screenY-ks.screenY):_a=Na=0,ks=e),Na)},movementY:function(e){return"movementY"in e?e.movementY:_a}}),Ca=tr(Vs),Pi=z({},Vs,{dataTransfer:0}),Ui=tr(Pi),zi=z({},bs,{relatedTarget:0}),Ia=tr(zi),Bi=z({},Fn,{animationName:0,elapsedTime:0,pseudoElement:0}),Hi=tr(Bi),qi=z({},Fn,{clipboardData:function(e){return"clipboardData"in e?e.clipboardData:window.clipboardData}}),ko=tr(qi),$i=z({},Fn,{data:0}),So=tr($i),Gi={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},Wi={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},Qi={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function Yi(e){var t=this.nativeEvent;return t.getModifierState?t.getModifierState(e):(e=Qi[e])?!!t[e]:!1}function Ks(){return Yi}var Vi=z({},bs,{key:function(e){if(e.key){var t=Gi[e.key]||e.key;if(t!=="Unidentified")return t}return e.type==="keypress"?(e=Ys(e),e===13?"Enter":String.fromCharCode(e)):e.type==="keydown"||e.type==="keyup"?Wi[e.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:Ks,charCode:function(e){return e.type==="keypress"?Ys(e):0},keyCode:function(e){return e.type==="keydown"||e.type==="keyup"?e.keyCode:0},which:function(e){return e.type==="keypress"?Ys(e):e.type==="keydown"||e.type==="keyup"?e.keyCode:0}}),Ki=tr(Vi),Ji=z({},Vs,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),Ss=tr(Ji),jo=z({},bs,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:Ks}),Eo=tr(jo),pe=z({},Fn,{propertyName:0,elapsedTime:0,pseudoElement:0}),_e=tr(pe),We=z({},Vs,{deltaX:function(e){return"deltaX"in e?e.deltaX:"wheelDeltaX"in e?-e.wheelDeltaX:0},deltaY:function(e){return"deltaY"in e?e.deltaY:"wheelDeltaY"in e?-e.wheelDeltaY:"wheelDelta"in e?-e.wheelDelta:0},deltaZ:0,deltaMode:0}),nt=tr(We),ct=[9,13,27,32],wt=f&&"CompositionEvent"in window,Zt=null;f&&"documentMode"in document&&(Zt=document.documentMode);var pr=f&&"TextEvent"in window&&!Zt,rr=f&&(!wt||Zt&&8<Zt&&11>=Zt),gr=" ",Js=!1;function ln(e,t){switch(e){case"keyup":return ct.indexOf(t.keyCode)!==-1;case"keydown":return t.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function No(e){return e=e.detail,typeof e=="object"&&"data"in e?e.data:null}var Zs=!1;function ym(e,t){switch(e){case"compositionend":return No(t);case"keypress":return t.which!==32?null:(Js=!0,gr);case"textInput":return e=t.data,e===gr&&Js?null:e;default:return null}}function vm(e,t){if(Zs)return e==="compositionend"||!wt&&ln(e,t)?(e=ja(),Ct=Nt=tt=null,Zs=!1,e):null;switch(e){case"paste":return null;case"keypress":if(!(t.ctrlKey||t.altKey||t.metaKey)||t.ctrlKey&&t.altKey){if(t.char&&1<t.char.length)return t.char;if(t.which)return String.fromCharCode(t.which)}return null;case"compositionend":return rr&&t.locale!=="ko"?null:t.data;default:return null}}var wm={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function ru(e){var t=e&&e.nodeName&&e.nodeName.toLowerCase();return t==="input"?!!wm[e.type]:t==="textarea"}function nu(e,t,s,a){qr(a),t=To(t,"onChange"),0<t.length&&(s=new Ea("onChange","change",null,s,a),e.push({event:s,listeners:t}))}var Da=null,Ta=null;function bm(e){bu(e,0)}function _o(e){var t=na(e);if(Ye(t))return e}function km(e,t){if(e==="change")return t}var su=!1;if(f){var Zi;if(f){var Xi="oninput"in document;if(!Xi){var au=document.createElement("div");au.setAttribute("oninput","return;"),Xi=typeof au.oninput=="function"}Zi=Xi}else Zi=!1;su=Zi&&(!document.documentMode||9<document.documentMode)}function ou(){Da&&(Da.detachEvent("onpropertychange",iu),Ta=Da=null)}function iu(e){if(e.propertyName==="value"&&_o(Ta)){var t=[];nu(t,Ta,e,jr(e)),In(bm,t)}}function Sm(e,t,s){e==="focusin"?(ou(),Da=t,Ta=s,Da.attachEvent("onpropertychange",iu)):e==="focusout"&&ou()}function jm(e){if(e==="selectionchange"||e==="keyup"||e==="keydown")return _o(Ta)}function Em(e,t){if(e==="click")return _o(t)}function Nm(e,t){if(e==="input"||e==="change")return _o(t)}function _m(e,t){return e===t&&(e!==0||1/e===1/t)||e!==e&&t!==t}var Yr=typeof Object.is=="function"?Object.is:_m;function Aa(e,t){if(Yr(e,t))return!0;if(typeof e!="object"||e===null||typeof t!="object"||t===null)return!1;var s=Object.keys(e),a=Object.keys(t);if(s.length!==a.length)return!1;for(a=0;a<s.length;a++){var m=s[a];if(!v.call(t,m)||!Yr(e[m],t[m]))return!1}return!0}function lu(e){for(;e&&e.firstChild;)e=e.firstChild;return e}function cu(e,t){var s=lu(e);e=0;for(var a;s;){if(s.nodeType===3){if(a=e+s.textContent.length,e<=t&&a>=t)return{node:s,offset:t-e};e=a}e:{for(;s;){if(s.nextSibling){s=s.nextSibling;break e}s=s.parentNode}s=void 0}s=lu(s)}}function uu(e,t){return e&&t?e===t?!0:e&&e.nodeType===3?!1:t&&t.nodeType===3?uu(e,t.parentNode):"contains"in e?e.contains(t):e.compareDocumentPosition?!!(e.compareDocumentPosition(t)&16):!1:!1}function du(){for(var e=window,t=Re();t instanceof e.HTMLIFrameElement;){try{var s=typeof t.contentWindow.location.href=="string"}catch{s=!1}if(s)e=t.contentWindow;else break;t=Re(e.document)}return t}function el(e){var t=e&&e.nodeName&&e.nodeName.toLowerCase();return t&&(t==="input"&&(e.type==="text"||e.type==="search"||e.type==="tel"||e.type==="url"||e.type==="password")||t==="textarea"||e.contentEditable==="true")}function Cm(e){var t=du(),s=e.focusedElem,a=e.selectionRange;if(t!==s&&s&&s.ownerDocument&&uu(s.ownerDocument.documentElement,s)){if(a!==null&&el(s)){if(t=a.start,e=a.end,e===void 0&&(e=t),"selectionStart"in s)s.selectionStart=t,s.selectionEnd=Math.min(e,s.value.length);else if(e=(t=s.ownerDocument||document)&&t.defaultView||window,e.getSelection){e=e.getSelection();var m=s.textContent.length,w=Math.min(a.start,m);a=a.end===void 0?w:Math.min(a.end,m),!e.extend&&w>a&&(m=a,a=w,w=m),m=cu(s,w);var L=cu(s,a);m&&L&&(e.rangeCount!==1||e.anchorNode!==m.node||e.anchorOffset!==m.offset||e.focusNode!==L.node||e.focusOffset!==L.offset)&&(t=t.createRange(),t.setStart(m.node,m.offset),e.removeAllRanges(),w>a?(e.addRange(t),e.extend(L.node,L.offset)):(t.setEnd(L.node,L.offset),e.addRange(t)))}}for(t=[],e=s;e=e.parentNode;)e.nodeType===1&&t.push({element:e,left:e.scrollLeft,top:e.scrollTop});for(typeof s.focus=="function"&&s.focus(),s=0;s<t.length;s++)e=t[s],e.element.scrollLeft=e.left,e.element.scrollTop=e.top}}var Im=f&&"documentMode"in document&&11>=document.documentMode,Xs=null,tl=null,Oa=null,rl=!1;function fu(e,t,s){var a=s.window===s?s.document:s.nodeType===9?s:s.ownerDocument;rl||Xs==null||Xs!==Re(a)||(a=Xs,"selectionStart"in a&&el(a)?a={start:a.selectionStart,end:a.selectionEnd}:(a=(a.ownerDocument&&a.ownerDocument.defaultView||window).getSelection(),a={anchorNode:a.anchorNode,anchorOffset:a.anchorOffset,focusNode:a.focusNode,focusOffset:a.focusOffset}),Oa&&Aa(Oa,a)||(Oa=a,a=To(tl,"onSelect"),0<a.length&&(t=new Ea("onSelect","select",null,t,s),e.push({event:t,listeners:a}),t.target=Xs)))}function Co(e,t){var s={};return s[e.toLowerCase()]=t.toLowerCase(),s["Webkit"+e]="webkit"+t,s["Moz"+e]="moz"+t,s}var ea={animationend:Co("Animation","AnimationEnd"),animationiteration:Co("Animation","AnimationIteration"),animationstart:Co("Animation","AnimationStart"),transitionend:Co("Transition","TransitionEnd")},nl={},hu={};f&&(hu=document.createElement("div").style,"AnimationEvent"in window||(delete ea.animationend.animation,delete ea.animationiteration.animation,delete ea.animationstart.animation),"TransitionEvent"in window||delete ea.transitionend.transition);function Io(e){if(nl[e])return nl[e];if(!ea[e])return e;var t=ea[e],s;for(s in t)if(t.hasOwnProperty(s)&&s in hu)return nl[e]=t[s];return e}var mu=Io("animationend"),pu=Io("animationiteration"),gu=Io("animationstart"),xu=Io("transitionend"),yu=new Map,vu="abort auxClick cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");function Pn(e,t){yu.set(e,t),c(t,[e])}for(var sl=0;sl<vu.length;sl++){var al=vu[sl],Dm=al.toLowerCase(),Tm=al[0].toUpperCase()+al.slice(1);Pn(Dm,"on"+Tm)}Pn(mu,"onAnimationEnd"),Pn(pu,"onAnimationIteration"),Pn(gu,"onAnimationStart"),Pn("dblclick","onDoubleClick"),Pn("focusin","onFocus"),Pn("focusout","onBlur"),Pn(xu,"onTransitionEnd"),l("onMouseEnter",["mouseout","mouseover"]),l("onMouseLeave",["mouseout","mouseover"]),l("onPointerEnter",["pointerout","pointerover"]),l("onPointerLeave",["pointerout","pointerover"]),c("onChange","change click focusin focusout input keydown keyup selectionchange".split(" ")),c("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" ")),c("onBeforeInput",["compositionend","keypress","textInput","paste"]),c("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" ")),c("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" ")),c("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var Ra="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),Am=new Set("cancel close invalid load scroll toggle".split(" ").concat(Ra));function wu(e,t,s){var a=e.type||"unknown-event";e.currentTarget=s,Jt(a,t,void 0,e),e.currentTarget=null}function bu(e,t){t=(t&4)!==0;for(var s=0;s<e.length;s++){var a=e[s],m=a.event;a=a.listeners;e:{var w=void 0;if(t)for(var L=a.length-1;0<=L;L--){var V=a[L],te=V.instance,ve=V.currentTarget;if(V=V.listener,te!==w&&m.isPropagationStopped())break e;wu(m,V,ve),w=te}else for(L=0;L<a.length;L++){if(V=a[L],te=V.instance,ve=V.currentTarget,V=V.listener,te!==w&&m.isPropagationStopped())break e;wu(m,V,ve),w=te}}}if($r)throw e=Us,$r=!1,Us=null,e}function St(e,t){var s=t[hl];s===void 0&&(s=t[hl]=new Set);var a=e+"__bubble";s.has(a)||(ku(t,e,2,!1),s.add(a))}function ol(e,t,s){var a=0;t&&(a|=4),ku(s,e,a,t)}var Do="_reactListening"+Math.random().toString(36).slice(2);function Ma(e){if(!e[Do]){e[Do]=!0,p.forEach(function(s){s!=="selectionchange"&&(Am.has(s)||ol(s,!1,e),ol(s,!0,e))});var t=e.nodeType===9?e:e.ownerDocument;t===null||t[Do]||(t[Do]=!0,ol("selectionchange",!1,t))}}function ku(e,t,s,a){switch(ht(t)){case 1:var m=U;break;case 4:m=X;break;default:m=we}s=m.bind(null,t,s,e),m=void 0,!Ps||t!=="touchstart"&&t!=="touchmove"&&t!=="wheel"||(m=!0),a?m!==void 0?e.addEventListener(t,s,{capture:!0,passive:m}):e.addEventListener(t,s,!0):m!==void 0?e.addEventListener(t,s,{passive:m}):e.addEventListener(t,s,!1)}function il(e,t,s,a,m){var w=a;if((t&1)===0&&(t&2)===0&&a!==null)e:for(;;){if(a===null)return;var L=a.tag;if(L===3||L===4){var V=a.stateNode.containerInfo;if(V===m||V.nodeType===8&&V.parentNode===m)break;if(L===4)for(L=a.return;L!==null;){var te=L.tag;if((te===3||te===4)&&(te=L.stateNode.containerInfo,te===m||te.nodeType===8&&te.parentNode===m))return;L=L.return}for(;V!==null;){if(L=js(V),L===null)return;if(te=L.tag,te===5||te===6){a=w=L;continue e}V=V.parentNode}}a=a.return}In(function(){var ve=w,Ie=jr(s),Oe=[];e:{var Ce=yu.get(e);if(Ce!==void 0){var Be=Ea,qe=e;switch(e){case"keypress":if(Ys(s)===0)break e;case"keydown":case"keyup":Be=Ki;break;case"focusin":qe="focus",Be=Ia;break;case"focusout":qe="blur",Be=Ia;break;case"beforeblur":case"afterblur":Be=Ia;break;case"click":if(s.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":Be=Ca;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":Be=Ui;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":Be=Eo;break;case mu:case pu:case gu:Be=Hi;break;case xu:Be=_e;break;case"scroll":Be=Fi;break;case"wheel":Be=nt;break;case"copy":case"cut":case"paste":Be=ko;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":Be=Ss}var Ge=(t&4)!==0,Rt=!Ge&&e==="scroll",me=Ge?Ce!==null?Ce+"Capture":null:Ce;Ge=[];for(var ae=ve,xe;ae!==null;){xe=ae;var Le=xe.stateNode;if(xe.tag===5&&Le!==null&&(xe=Le,me!==null&&(Le=gn(ae,me),Le!=null&&Ge.push(La(ae,Le,xe)))),Rt)break;ae=ae.return}0<Ge.length&&(Ce=new Be(Ce,qe,null,s,Ie),Oe.push({event:Ce,listeners:Ge}))}}if((t&7)===0){e:{if(Ce=e==="mouseover"||e==="pointerover",Be=e==="mouseout"||e==="pointerout",Ce&&s!==Ve&&(qe=s.relatedTarget||s.fromElement)&&(js(qe)||qe[vn]))break e;if((Be||Ce)&&(Ce=Ie.window===Ie?Ie:(Ce=Ie.ownerDocument)?Ce.defaultView||Ce.parentWindow:window,Be?(qe=s.relatedTarget||s.toElement,Be=ve,qe=qe?js(qe):null,qe!==null&&(Rt=sn(qe),qe!==Rt||qe.tag!==5&&qe.tag!==6)&&(qe=null)):(Be=null,qe=ve),Be!==qe)){if(Ge=Ca,Le="onMouseLeave",me="onMouseEnter",ae="mouse",(e==="pointerout"||e==="pointerover")&&(Ge=Ss,Le="onPointerLeave",me="onPointerEnter",ae="pointer"),Rt=Be==null?Ce:na(Be),xe=qe==null?Ce:na(qe),Ce=new Ge(Le,ae+"leave",Be,s,Ie),Ce.target=Rt,Ce.relatedTarget=xe,Le=null,js(Ie)===ve&&(Ge=new Ge(me,ae+"enter",qe,s,Ie),Ge.target=xe,Ge.relatedTarget=Rt,Le=Ge),Rt=Le,Be&&qe)t:{for(Ge=Be,me=qe,ae=0,xe=Ge;xe;xe=ta(xe))ae++;for(xe=0,Le=me;Le;Le=ta(Le))xe++;for(;0<ae-xe;)Ge=ta(Ge),ae--;for(;0<xe-ae;)me=ta(me),xe--;for(;ae--;){if(Ge===me||me!==null&&Ge===me.alternate)break t;Ge=ta(Ge),me=ta(me)}Ge=null}else Ge=null;Be!==null&&Su(Oe,Ce,Be,Ge,!1),qe!==null&&Rt!==null&&Su(Oe,Rt,qe,Ge,!0)}}e:{if(Ce=ve?na(ve):window,Be=Ce.nodeName&&Ce.nodeName.toLowerCase(),Be==="select"||Be==="input"&&Ce.type==="file")var Qe=km;else if(ru(Ce))if(su)Qe=Nm;else{Qe=jm;var Je=Sm}else(Be=Ce.nodeName)&&Be.toLowerCase()==="input"&&(Ce.type==="checkbox"||Ce.type==="radio")&&(Qe=Em);if(Qe&&(Qe=Qe(e,ve))){nu(Oe,Qe,s,Ie);break e}Je&&Je(e,Ce,ve),e==="focusout"&&(Je=Ce._wrapperState)&&Je.controlled&&Ce.type==="number"&&ee(Ce,"number",Ce.value)}switch(Je=ve?na(ve):window,e){case"focusin":(ru(Je)||Je.contentEditable==="true")&&(Xs=Je,tl=ve,Oa=null);break;case"focusout":Oa=tl=Xs=null;break;case"mousedown":rl=!0;break;case"contextmenu":case"mouseup":case"dragend":rl=!1,fu(Oe,s,Ie);break;case"selectionchange":if(Im)break;case"keydown":case"keyup":fu(Oe,s,Ie)}var Ze;if(wt)e:{switch(e){case"compositionstart":var st="onCompositionStart";break e;case"compositionend":st="onCompositionEnd";break e;case"compositionupdate":st="onCompositionUpdate";break e}st=void 0}else Zs?ln(e,s)&&(st="onCompositionEnd"):e==="keydown"&&s.keyCode===229&&(st="onCompositionStart");st&&(rr&&s.locale!=="ko"&&(Zs||st!=="onCompositionStart"?st==="onCompositionEnd"&&Zs&&(Ze=ja()):(tt=Ie,Nt="value"in tt?tt.value:tt.textContent,Zs=!0)),Je=To(ve,st),0<Je.length&&(st=new So(st,e,null,s,Ie),Oe.push({event:st,listeners:Je}),Ze?st.data=Ze:(Ze=No(s),Ze!==null&&(st.data=Ze)))),(Ze=pr?ym(e,s):vm(e,s))&&(ve=To(ve,"onBeforeInput"),0<ve.length&&(Ie=new So("onBeforeInput","beforeinput",null,s,Ie),Oe.push({event:Ie,listeners:ve}),Ie.data=Ze))}bu(Oe,t)})}function La(e,t,s){return{instance:e,listener:t,currentTarget:s}}function To(e,t){for(var s=t+"Capture",a=[];e!==null;){var m=e,w=m.stateNode;m.tag===5&&w!==null&&(m=w,w=gn(e,s),w!=null&&a.unshift(La(e,w,m)),w=gn(e,t),w!=null&&a.push(La(e,w,m))),e=e.return}return a}function ta(e){if(e===null)return null;do e=e.return;while(e&&e.tag!==5);return e||null}function Su(e,t,s,a,m){for(var w=t._reactName,L=[];s!==null&&s!==a;){var V=s,te=V.alternate,ve=V.stateNode;if(te!==null&&te===a)break;V.tag===5&&ve!==null&&(V=ve,m?(te=gn(s,w),te!=null&&L.unshift(La(s,te,V))):m||(te=gn(s,w),te!=null&&L.push(La(s,te,V)))),s=s.return}L.length!==0&&e.push({event:t,listeners:L})}var Om=/\r\n?/g,Rm=/\u0000|\uFFFD/g;function ju(e){return(typeof e=="string"?e:""+e).replace(Om,`
`).replace(Rm,"")}function Ao(e,t,s){if(t=ju(t),ju(e)!==t&&s)throw Error(o(425))}function Oo(){}var ll=null,cl=null;function ul(e,t){return e==="textarea"||e==="noscript"||typeof t.children=="string"||typeof t.children=="number"||typeof t.dangerouslySetInnerHTML=="object"&&t.dangerouslySetInnerHTML!==null&&t.dangerouslySetInnerHTML.__html!=null}var dl=typeof setTimeout=="function"?setTimeout:void 0,Mm=typeof clearTimeout=="function"?clearTimeout:void 0,Eu=typeof Promise=="function"?Promise:void 0,Lm=typeof queueMicrotask=="function"?queueMicrotask:typeof Eu<"u"?function(e){return Eu.resolve(null).then(e).catch(Fm)}:dl;function Fm(e){setTimeout(function(){throw e})}function fl(e,t){var s=t,a=0;do{var m=s.nextSibling;if(e.removeChild(s),m&&m.nodeType===8)if(s=m.data,s==="/$"){if(a===0){e.removeChild(m),u(t);return}a--}else s!=="$"&&s!=="$?"&&s!=="$!"||a++;s=m}while(s);u(t)}function Un(e){for(;e!=null;e=e.nextSibling){var t=e.nodeType;if(t===1||t===3)break;if(t===8){if(t=e.data,t==="$"||t==="$!"||t==="$?")break;if(t==="/$")return null}}return e}function Nu(e){e=e.previousSibling;for(var t=0;e;){if(e.nodeType===8){var s=e.data;if(s==="$"||s==="$!"||s==="$?"){if(t===0)return e;t--}else s==="/$"&&t++}e=e.previousSibling}return null}var ra=Math.random().toString(36).slice(2),cn="__reactFiber$"+ra,Fa="__reactProps$"+ra,vn="__reactContainer$"+ra,hl="__reactEvents$"+ra,Pm="__reactListeners$"+ra,Um="__reactHandles$"+ra;function js(e){var t=e[cn];if(t)return t;for(var s=e.parentNode;s;){if(t=s[vn]||s[cn]){if(s=t.alternate,t.child!==null||s!==null&&s.child!==null)for(e=Nu(e);e!==null;){if(s=e[cn])return s;e=Nu(e)}return t}e=s,s=e.parentNode}return null}function Pa(e){return e=e[cn]||e[vn],!e||e.tag!==5&&e.tag!==6&&e.tag!==13&&e.tag!==3?null:e}function na(e){if(e.tag===5||e.tag===6)return e.stateNode;throw Error(o(33))}function Ro(e){return e[Fa]||null}var ml=[],sa=-1;function zn(e){return{current:e}}function jt(e){0>sa||(e.current=ml[sa],ml[sa]=null,sa--)}function kt(e,t){sa++,ml[sa]=e.current,e.current=t}var Bn={},nr=zn(Bn),xr=zn(!1),Es=Bn;function aa(e,t){var s=e.type.contextTypes;if(!s)return Bn;var a=e.stateNode;if(a&&a.__reactInternalMemoizedUnmaskedChildContext===t)return a.__reactInternalMemoizedMaskedChildContext;var m={},w;for(w in s)m[w]=t[w];return a&&(e=e.stateNode,e.__reactInternalMemoizedUnmaskedChildContext=t,e.__reactInternalMemoizedMaskedChildContext=m),m}function yr(e){return e=e.childContextTypes,e!=null}function Mo(){jt(xr),jt(nr)}function _u(e,t,s){if(nr.current!==Bn)throw Error(o(168));kt(nr,t),kt(xr,s)}function Cu(e,t,s){var a=e.stateNode;if(t=t.childContextTypes,typeof a.getChildContext!="function")return s;a=a.getChildContext();for(var m in a)if(!(m in t))throw Error(o(108,Ne(e)||"Unknown",m));return z({},s,a)}function Lo(e){return e=(e=e.stateNode)&&e.__reactInternalMemoizedMergedChildContext||Bn,Es=nr.current,kt(nr,e),kt(xr,xr.current),!0}function Iu(e,t,s){var a=e.stateNode;if(!a)throw Error(o(169));s?(e=Cu(e,t,Es),a.__reactInternalMemoizedMergedChildContext=e,jt(xr),jt(nr),kt(nr,e)):jt(xr),kt(xr,s)}var wn=null,Fo=!1,pl=!1;function Du(e){wn===null?wn=[e]:wn.push(e)}function zm(e){Fo=!0,Du(e)}function Hn(){if(!pl&&wn!==null){pl=!0;var e=0,t=gt;try{var s=wn;for(gt=1;e<s.length;e++){var a=s[e];do a=a(!0);while(a!==null)}wn=null,Fo=!1}catch(m){throw wn!==null&&(wn=wn.slice(e+1)),os(Hs,Hn),m}finally{gt=t,pl=!1}}return null}var oa=[],ia=0,Po=null,Uo=0,Mr=[],Lr=0,Ns=null,bn=1,kn="";function _s(e,t){oa[ia++]=Uo,oa[ia++]=Po,Po=e,Uo=t}function Tu(e,t,s){Mr[Lr++]=bn,Mr[Lr++]=kn,Mr[Lr++]=Ns,Ns=e;var a=bn;e=kn;var m=32-Cr(a)-1;a&=~(1<<m),s+=1;var w=32-Cr(t)+m;if(30<w){var L=m-m%5;w=(a&(1<<L)-1).toString(32),a>>=L,m-=L,bn=1<<32-Cr(t)+m|s<<m|a,kn=w+e}else bn=1<<w|s<<m|a,kn=e}function gl(e){e.return!==null&&(_s(e,1),Tu(e,1,0))}function xl(e){for(;e===Po;)Po=oa[--ia],oa[ia]=null,Uo=oa[--ia],oa[ia]=null;for(;e===Ns;)Ns=Mr[--Lr],Mr[Lr]=null,kn=Mr[--Lr],Mr[Lr]=null,bn=Mr[--Lr],Mr[Lr]=null}var Dr=null,Tr=null,_t=!1,Vr=null;function Au(e,t){var s=zr(5,null,null,0);s.elementType="DELETED",s.stateNode=t,s.return=e,t=e.deletions,t===null?(e.deletions=[s],e.flags|=16):t.push(s)}function Ou(e,t){switch(e.tag){case 5:var s=e.type;return t=t.nodeType!==1||s.toLowerCase()!==t.nodeName.toLowerCase()?null:t,t!==null?(e.stateNode=t,Dr=e,Tr=Un(t.firstChild),!0):!1;case 6:return t=e.pendingProps===""||t.nodeType!==3?null:t,t!==null?(e.stateNode=t,Dr=e,Tr=null,!0):!1;case 13:return t=t.nodeType!==8?null:t,t!==null?(s=Ns!==null?{id:bn,overflow:kn}:null,e.memoizedState={dehydrated:t,treeContext:s,retryLane:1073741824},s=zr(18,null,null,0),s.stateNode=t,s.return=e,e.child=s,Dr=e,Tr=null,!0):!1;default:return!1}}function yl(e){return(e.mode&1)!==0&&(e.flags&128)===0}function vl(e){if(_t){var t=Tr;if(t){var s=t;if(!Ou(e,t)){if(yl(e))throw Error(o(418));t=Un(s.nextSibling);var a=Dr;t&&Ou(e,t)?Au(a,s):(e.flags=e.flags&-4097|2,_t=!1,Dr=e)}}else{if(yl(e))throw Error(o(418));e.flags=e.flags&-4097|2,_t=!1,Dr=e}}}function Ru(e){for(e=e.return;e!==null&&e.tag!==5&&e.tag!==3&&e.tag!==13;)e=e.return;Dr=e}function zo(e){if(e!==Dr)return!1;if(!_t)return Ru(e),_t=!0,!1;var t;if((t=e.tag!==3)&&!(t=e.tag!==5)&&(t=e.type,t=t!=="head"&&t!=="body"&&!ul(e.type,e.memoizedProps)),t&&(t=Tr)){if(yl(e))throw Mu(),Error(o(418));for(;t;)Au(e,t),t=Un(t.nextSibling)}if(Ru(e),e.tag===13){if(e=e.memoizedState,e=e!==null?e.dehydrated:null,!e)throw Error(o(317));e:{for(e=e.nextSibling,t=0;e;){if(e.nodeType===8){var s=e.data;if(s==="/$"){if(t===0){Tr=Un(e.nextSibling);break e}t--}else s!=="$"&&s!=="$!"&&s!=="$?"||t++}e=e.nextSibling}Tr=null}}else Tr=Dr?Un(e.stateNode.nextSibling):null;return!0}function Mu(){for(var e=Tr;e;)e=Un(e.nextSibling)}function la(){Tr=Dr=null,_t=!1}function wl(e){Vr===null?Vr=[e]:Vr.push(e)}var Bm=A.ReactCurrentBatchConfig;function Ua(e,t,s){if(e=s.ref,e!==null&&typeof e!="function"&&typeof e!="object"){if(s._owner){if(s=s._owner,s){if(s.tag!==1)throw Error(o(309));var a=s.stateNode}if(!a)throw Error(o(147,e));var m=a,w=""+e;return t!==null&&t.ref!==null&&typeof t.ref=="function"&&t.ref._stringRef===w?t.ref:(t=function(L){var V=m.refs;L===null?delete V[w]:V[w]=L},t._stringRef=w,t)}if(typeof e!="string")throw Error(o(284));if(!s._owner)throw Error(o(290,e))}return e}function Bo(e,t){throw e=Object.prototype.toString.call(t),Error(o(31,e==="[object Object]"?"object with keys {"+Object.keys(t).join(", ")+"}":e))}function Lu(e){var t=e._init;return t(e._payload)}function Fu(e){function t(me,ae){if(e){var xe=me.deletions;xe===null?(me.deletions=[ae],me.flags|=16):xe.push(ae)}}function s(me,ae){if(!e)return null;for(;ae!==null;)t(me,ae),ae=ae.sibling;return null}function a(me,ae){for(me=new Map;ae!==null;)ae.key!==null?me.set(ae.key,ae):me.set(ae.index,ae),ae=ae.sibling;return me}function m(me,ae){return me=Kn(me,ae),me.index=0,me.sibling=null,me}function w(me,ae,xe){return me.index=xe,e?(xe=me.alternate,xe!==null?(xe=xe.index,xe<ae?(me.flags|=2,ae):xe):(me.flags|=2,ae)):(me.flags|=1048576,ae)}function L(me){return e&&me.alternate===null&&(me.flags|=2),me}function V(me,ae,xe,Le){return ae===null||ae.tag!==6?(ae=dc(xe,me.mode,Le),ae.return=me,ae):(ae=m(ae,xe),ae.return=me,ae)}function te(me,ae,xe,Le){var Qe=xe.type;return Qe===H?Ie(me,ae,xe.props.children,Le,xe.key):ae!==null&&(ae.elementType===Qe||typeof Qe=="object"&&Qe!==null&&Qe.$$typeof===oe&&Lu(Qe)===ae.type)?(Le=m(ae,xe.props),Le.ref=Ua(me,ae,xe),Le.return=me,Le):(Le=di(xe.type,xe.key,xe.props,null,me.mode,Le),Le.ref=Ua(me,ae,xe),Le.return=me,Le)}function ve(me,ae,xe,Le){return ae===null||ae.tag!==4||ae.stateNode.containerInfo!==xe.containerInfo||ae.stateNode.implementation!==xe.implementation?(ae=fc(xe,me.mode,Le),ae.return=me,ae):(ae=m(ae,xe.children||[]),ae.return=me,ae)}function Ie(me,ae,xe,Le,Qe){return ae===null||ae.tag!==7?(ae=Ms(xe,me.mode,Le,Qe),ae.return=me,ae):(ae=m(ae,xe),ae.return=me,ae)}function Oe(me,ae,xe){if(typeof ae=="string"&&ae!==""||typeof ae=="number")return ae=dc(""+ae,me.mode,xe),ae.return=me,ae;if(typeof ae=="object"&&ae!==null){switch(ae.$$typeof){case T:return xe=di(ae.type,ae.key,ae.props,null,me.mode,xe),xe.ref=Ua(me,null,ae),xe.return=me,xe;case P:return ae=fc(ae,me.mode,xe),ae.return=me,ae;case oe:var Le=ae._init;return Oe(me,Le(ae._payload),xe)}if(ce(ae)||ue(ae))return ae=Ms(ae,me.mode,xe,null),ae.return=me,ae;Bo(me,ae)}return null}function Ce(me,ae,xe,Le){var Qe=ae!==null?ae.key:null;if(typeof xe=="string"&&xe!==""||typeof xe=="number")return Qe!==null?null:V(me,ae,""+xe,Le);if(typeof xe=="object"&&xe!==null){switch(xe.$$typeof){case T:return xe.key===Qe?te(me,ae,xe,Le):null;case P:return xe.key===Qe?ve(me,ae,xe,Le):null;case oe:return Qe=xe._init,Ce(me,ae,Qe(xe._payload),Le)}if(ce(xe)||ue(xe))return Qe!==null?null:Ie(me,ae,xe,Le,null);Bo(me,xe)}return null}function Be(me,ae,xe,Le,Qe){if(typeof Le=="string"&&Le!==""||typeof Le=="number")return me=me.get(xe)||null,V(ae,me,""+Le,Qe);if(typeof Le=="object"&&Le!==null){switch(Le.$$typeof){case T:return me=me.get(Le.key===null?xe:Le.key)||null,te(ae,me,Le,Qe);case P:return me=me.get(Le.key===null?xe:Le.key)||null,ve(ae,me,Le,Qe);case oe:var Je=Le._init;return Be(me,ae,xe,Je(Le._payload),Qe)}if(ce(Le)||ue(Le))return me=me.get(xe)||null,Ie(ae,me,Le,Qe,null);Bo(ae,Le)}return null}function qe(me,ae,xe,Le){for(var Qe=null,Je=null,Ze=ae,st=ae=0,Vt=null;Ze!==null&&st<xe.length;st++){Ze.index>st?(Vt=Ze,Ze=null):Vt=Ze.sibling;var yt=Ce(me,Ze,xe[st],Le);if(yt===null){Ze===null&&(Ze=Vt);break}e&&Ze&&yt.alternate===null&&t(me,Ze),ae=w(yt,ae,st),Je===null?Qe=yt:Je.sibling=yt,Je=yt,Ze=Vt}if(st===xe.length)return s(me,Ze),_t&&_s(me,st),Qe;if(Ze===null){for(;st<xe.length;st++)Ze=Oe(me,xe[st],Le),Ze!==null&&(ae=w(Ze,ae,st),Je===null?Qe=Ze:Je.sibling=Ze,Je=Ze);return _t&&_s(me,st),Qe}for(Ze=a(me,Ze);st<xe.length;st++)Vt=Be(Ze,me,st,xe[st],Le),Vt!==null&&(e&&Vt.alternate!==null&&Ze.delete(Vt.key===null?st:Vt.key),ae=w(Vt,ae,st),Je===null?Qe=Vt:Je.sibling=Vt,Je=Vt);return e&&Ze.forEach(function(Jn){return t(me,Jn)}),_t&&_s(me,st),Qe}function Ge(me,ae,xe,Le){var Qe=ue(xe);if(typeof Qe!="function")throw Error(o(150));if(xe=Qe.call(xe),xe==null)throw Error(o(151));for(var Je=Qe=null,Ze=ae,st=ae=0,Vt=null,yt=xe.next();Ze!==null&&!yt.done;st++,yt=xe.next()){Ze.index>st?(Vt=Ze,Ze=null):Vt=Ze.sibling;var Jn=Ce(me,Ze,yt.value,Le);if(Jn===null){Ze===null&&(Ze=Vt);break}e&&Ze&&Jn.alternate===null&&t(me,Ze),ae=w(Jn,ae,st),Je===null?Qe=Jn:Je.sibling=Jn,Je=Jn,Ze=Vt}if(yt.done)return s(me,Ze),_t&&_s(me,st),Qe;if(Ze===null){for(;!yt.done;st++,yt=xe.next())yt=Oe(me,yt.value,Le),yt!==null&&(ae=w(yt,ae,st),Je===null?Qe=yt:Je.sibling=yt,Je=yt);return _t&&_s(me,st),Qe}for(Ze=a(me,Ze);!yt.done;st++,yt=xe.next())yt=Be(Ze,me,st,yt.value,Le),yt!==null&&(e&&yt.alternate!==null&&Ze.delete(yt.key===null?st:yt.key),ae=w(yt,ae,st),Je===null?Qe=yt:Je.sibling=yt,Je=yt);return e&&Ze.forEach(function(wp){return t(me,wp)}),_t&&_s(me,st),Qe}function Rt(me,ae,xe,Le){if(typeof xe=="object"&&xe!==null&&xe.type===H&&xe.key===null&&(xe=xe.props.children),typeof xe=="object"&&xe!==null){switch(xe.$$typeof){case T:e:{for(var Qe=xe.key,Je=ae;Je!==null;){if(Je.key===Qe){if(Qe=xe.type,Qe===H){if(Je.tag===7){s(me,Je.sibling),ae=m(Je,xe.props.children),ae.return=me,me=ae;break e}}else if(Je.elementType===Qe||typeof Qe=="object"&&Qe!==null&&Qe.$$typeof===oe&&Lu(Qe)===Je.type){s(me,Je.sibling),ae=m(Je,xe.props),ae.ref=Ua(me,Je,xe),ae.return=me,me=ae;break e}s(me,Je);break}else t(me,Je);Je=Je.sibling}xe.type===H?(ae=Ms(xe.props.children,me.mode,Le,xe.key),ae.return=me,me=ae):(Le=di(xe.type,xe.key,xe.props,null,me.mode,Le),Le.ref=Ua(me,ae,xe),Le.return=me,me=Le)}return L(me);case P:e:{for(Je=xe.key;ae!==null;){if(ae.key===Je)if(ae.tag===4&&ae.stateNode.containerInfo===xe.containerInfo&&ae.stateNode.implementation===xe.implementation){s(me,ae.sibling),ae=m(ae,xe.children||[]),ae.return=me,me=ae;break e}else{s(me,ae);break}else t(me,ae);ae=ae.sibling}ae=fc(xe,me.mode,Le),ae.return=me,me=ae}return L(me);case oe:return Je=xe._init,Rt(me,ae,Je(xe._payload),Le)}if(ce(xe))return qe(me,ae,xe,Le);if(ue(xe))return Ge(me,ae,xe,Le);Bo(me,xe)}return typeof xe=="string"&&xe!==""||typeof xe=="number"?(xe=""+xe,ae!==null&&ae.tag===6?(s(me,ae.sibling),ae=m(ae,xe),ae.return=me,me=ae):(s(me,ae),ae=dc(xe,me.mode,Le),ae.return=me,me=ae),L(me)):s(me,ae)}return Rt}var ca=Fu(!0),Pu=Fu(!1),Ho=zn(null),qo=null,ua=null,bl=null;function kl(){bl=ua=qo=null}function Sl(e){var t=Ho.current;jt(Ho),e._currentValue=t}function jl(e,t,s){for(;e!==null;){var a=e.alternate;if((e.childLanes&t)!==t?(e.childLanes|=t,a!==null&&(a.childLanes|=t)):a!==null&&(a.childLanes&t)!==t&&(a.childLanes|=t),e===s)break;e=e.return}}function da(e,t){qo=e,bl=ua=null,e=e.dependencies,e!==null&&e.firstContext!==null&&((e.lanes&t)!==0&&(vr=!0),e.firstContext=null)}function Fr(e){var t=e._currentValue;if(bl!==e)if(e={context:e,memoizedValue:t,next:null},ua===null){if(qo===null)throw Error(o(308));ua=e,qo.dependencies={lanes:0,firstContext:e}}else ua=ua.next=e;return t}var Cs=null;function El(e){Cs===null?Cs=[e]:Cs.push(e)}function Uu(e,t,s,a){var m=t.interleaved;return m===null?(s.next=s,El(t)):(s.next=m.next,m.next=s),t.interleaved=s,Sn(e,a)}function Sn(e,t){e.lanes|=t;var s=e.alternate;for(s!==null&&(s.lanes|=t),s=e,e=e.return;e!==null;)e.childLanes|=t,s=e.alternate,s!==null&&(s.childLanes|=t),s=e,e=e.return;return s.tag===3?s.stateNode:null}var qn=!1;function Nl(e){e.updateQueue={baseState:e.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,interleaved:null,lanes:0},effects:null}}function zu(e,t){e=e.updateQueue,t.updateQueue===e&&(t.updateQueue={baseState:e.baseState,firstBaseUpdate:e.firstBaseUpdate,lastBaseUpdate:e.lastBaseUpdate,shared:e.shared,effects:e.effects})}function jn(e,t){return{eventTime:e,lane:t,tag:0,payload:null,callback:null,next:null}}function $n(e,t,s){var a=e.updateQueue;if(a===null)return null;if(a=a.shared,(xt&2)!==0){var m=a.pending;return m===null?t.next=t:(t.next=m.next,m.next=t),a.pending=t,Sn(e,s)}return m=a.interleaved,m===null?(t.next=t,El(a)):(t.next=m.next,m.next=t),a.interleaved=t,Sn(e,s)}function $o(e,t,s){if(t=t.updateQueue,t!==null&&(t=t.shared,(s&4194240)!==0)){var a=t.lanes;a&=e.pendingLanes,s|=a,t.lanes=s,Gs(e,s)}}function Bu(e,t){var s=e.updateQueue,a=e.alternate;if(a!==null&&(a=a.updateQueue,s===a)){var m=null,w=null;if(s=s.firstBaseUpdate,s!==null){do{var L={eventTime:s.eventTime,lane:s.lane,tag:s.tag,payload:s.payload,callback:s.callback,next:null};w===null?m=w=L:w=w.next=L,s=s.next}while(s!==null);w===null?m=w=t:w=w.next=t}else m=w=t;s={baseState:a.baseState,firstBaseUpdate:m,lastBaseUpdate:w,shared:a.shared,effects:a.effects},e.updateQueue=s;return}e=s.lastBaseUpdate,e===null?s.firstBaseUpdate=t:e.next=t,s.lastBaseUpdate=t}function Go(e,t,s,a){var m=e.updateQueue;qn=!1;var w=m.firstBaseUpdate,L=m.lastBaseUpdate,V=m.shared.pending;if(V!==null){m.shared.pending=null;var te=V,ve=te.next;te.next=null,L===null?w=ve:L.next=ve,L=te;var Ie=e.alternate;Ie!==null&&(Ie=Ie.updateQueue,V=Ie.lastBaseUpdate,V!==L&&(V===null?Ie.firstBaseUpdate=ve:V.next=ve,Ie.lastBaseUpdate=te))}if(w!==null){var Oe=m.baseState;L=0,Ie=ve=te=null,V=w;do{var Ce=V.lane,Be=V.eventTime;if((a&Ce)===Ce){Ie!==null&&(Ie=Ie.next={eventTime:Be,lane:0,tag:V.tag,payload:V.payload,callback:V.callback,next:null});e:{var qe=e,Ge=V;switch(Ce=t,Be=s,Ge.tag){case 1:if(qe=Ge.payload,typeof qe=="function"){Oe=qe.call(Be,Oe,Ce);break e}Oe=qe;break e;case 3:qe.flags=qe.flags&-65537|128;case 0:if(qe=Ge.payload,Ce=typeof qe=="function"?qe.call(Be,Oe,Ce):qe,Ce==null)break e;Oe=z({},Oe,Ce);break e;case 2:qn=!0}}V.callback!==null&&V.lane!==0&&(e.flags|=64,Ce=m.effects,Ce===null?m.effects=[V]:Ce.push(V))}else Be={eventTime:Be,lane:Ce,tag:V.tag,payload:V.payload,callback:V.callback,next:null},Ie===null?(ve=Ie=Be,te=Oe):Ie=Ie.next=Be,L|=Ce;if(V=V.next,V===null){if(V=m.shared.pending,V===null)break;Ce=V,V=Ce.next,Ce.next=null,m.lastBaseUpdate=Ce,m.shared.pending=null}}while(!0);if(Ie===null&&(te=Oe),m.baseState=te,m.firstBaseUpdate=ve,m.lastBaseUpdate=Ie,t=m.shared.interleaved,t!==null){m=t;do L|=m.lane,m=m.next;while(m!==t)}else w===null&&(m.shared.lanes=0);Ts|=L,e.lanes=L,e.memoizedState=Oe}}function Hu(e,t,s){if(e=t.effects,t.effects=null,e!==null)for(t=0;t<e.length;t++){var a=e[t],m=a.callback;if(m!==null){if(a.callback=null,a=s,typeof m!="function")throw Error(o(191,m));m.call(a)}}}var za={},un=zn(za),Ba=zn(za),Ha=zn(za);function Is(e){if(e===za)throw Error(o(174));return e}function _l(e,t){switch(kt(Ha,t),kt(Ba,e),kt(un,za),e=t.nodeType,e){case 9:case 11:t=(t=t.documentElement)?t.namespaceURI:ut(null,"");break;default:e=e===8?t.parentNode:t,t=e.namespaceURI||null,e=e.tagName,t=ut(t,e)}jt(un),kt(un,t)}function fa(){jt(un),jt(Ba),jt(Ha)}function qu(e){Is(Ha.current);var t=Is(un.current),s=ut(t,e.type);t!==s&&(kt(Ba,e),kt(un,s))}function Cl(e){Ba.current===e&&(jt(un),jt(Ba))}var It=zn(0);function Wo(e){for(var t=e;t!==null;){if(t.tag===13){var s=t.memoizedState;if(s!==null&&(s=s.dehydrated,s===null||s.data==="$?"||s.data==="$!"))return t}else if(t.tag===19&&t.memoizedProps.revealOrder!==void 0){if((t.flags&128)!==0)return t}else if(t.child!==null){t.child.return=t,t=t.child;continue}if(t===e)break;for(;t.sibling===null;){if(t.return===null||t.return===e)return null;t=t.return}t.sibling.return=t.return,t=t.sibling}return null}var Il=[];function Dl(){for(var e=0;e<Il.length;e++)Il[e]._workInProgressVersionPrimary=null;Il.length=0}var Qo=A.ReactCurrentDispatcher,Tl=A.ReactCurrentBatchConfig,Ds=0,Dt=null,Ut=null,Qt=null,Yo=!1,qa=!1,$a=0,Hm=0;function sr(){throw Error(o(321))}function Al(e,t){if(t===null)return!1;for(var s=0;s<t.length&&s<e.length;s++)if(!Yr(e[s],t[s]))return!1;return!0}function Ol(e,t,s,a,m,w){if(Ds=w,Dt=t,t.memoizedState=null,t.updateQueue=null,t.lanes=0,Qo.current=e===null||e.memoizedState===null?Wm:Qm,e=s(a,m),qa){w=0;do{if(qa=!1,$a=0,25<=w)throw Error(o(301));w+=1,Qt=Ut=null,t.updateQueue=null,Qo.current=Ym,e=s(a,m)}while(qa)}if(Qo.current=Jo,t=Ut!==null&&Ut.next!==null,Ds=0,Qt=Ut=Dt=null,Yo=!1,t)throw Error(o(300));return e}function Rl(){var e=$a!==0;return $a=0,e}function dn(){var e={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return Qt===null?Dt.memoizedState=Qt=e:Qt=Qt.next=e,Qt}function Pr(){if(Ut===null){var e=Dt.alternate;e=e!==null?e.memoizedState:null}else e=Ut.next;var t=Qt===null?Dt.memoizedState:Qt.next;if(t!==null)Qt=t,Ut=e;else{if(e===null)throw Error(o(310));Ut=e,e={memoizedState:Ut.memoizedState,baseState:Ut.baseState,baseQueue:Ut.baseQueue,queue:Ut.queue,next:null},Qt===null?Dt.memoizedState=Qt=e:Qt=Qt.next=e}return Qt}function Ga(e,t){return typeof t=="function"?t(e):t}function Ml(e){var t=Pr(),s=t.queue;if(s===null)throw Error(o(311));s.lastRenderedReducer=e;var a=Ut,m=a.baseQueue,w=s.pending;if(w!==null){if(m!==null){var L=m.next;m.next=w.next,w.next=L}a.baseQueue=m=w,s.pending=null}if(m!==null){w=m.next,a=a.baseState;var V=L=null,te=null,ve=w;do{var Ie=ve.lane;if((Ds&Ie)===Ie)te!==null&&(te=te.next={lane:0,action:ve.action,hasEagerState:ve.hasEagerState,eagerState:ve.eagerState,next:null}),a=ve.hasEagerState?ve.eagerState:e(a,ve.action);else{var Oe={lane:Ie,action:ve.action,hasEagerState:ve.hasEagerState,eagerState:ve.eagerState,next:null};te===null?(V=te=Oe,L=a):te=te.next=Oe,Dt.lanes|=Ie,Ts|=Ie}ve=ve.next}while(ve!==null&&ve!==w);te===null?L=a:te.next=V,Yr(a,t.memoizedState)||(vr=!0),t.memoizedState=a,t.baseState=L,t.baseQueue=te,s.lastRenderedState=a}if(e=s.interleaved,e!==null){m=e;do w=m.lane,Dt.lanes|=w,Ts|=w,m=m.next;while(m!==e)}else m===null&&(s.lanes=0);return[t.memoizedState,s.dispatch]}function Ll(e){var t=Pr(),s=t.queue;if(s===null)throw Error(o(311));s.lastRenderedReducer=e;var a=s.dispatch,m=s.pending,w=t.memoizedState;if(m!==null){s.pending=null;var L=m=m.next;do w=e(w,L.action),L=L.next;while(L!==m);Yr(w,t.memoizedState)||(vr=!0),t.memoizedState=w,t.baseQueue===null&&(t.baseState=w),s.lastRenderedState=w}return[w,a]}function $u(){}function Gu(e,t){var s=Dt,a=Pr(),m=t(),w=!Yr(a.memoizedState,m);if(w&&(a.memoizedState=m,vr=!0),a=a.queue,Fl(Yu.bind(null,s,a,e),[e]),a.getSnapshot!==t||w||Qt!==null&&Qt.memoizedState.tag&1){if(s.flags|=2048,Wa(9,Qu.bind(null,s,a,m,t),void 0,null),Yt===null)throw Error(o(349));(Ds&30)!==0||Wu(s,t,m)}return m}function Wu(e,t,s){e.flags|=16384,e={getSnapshot:t,value:s},t=Dt.updateQueue,t===null?(t={lastEffect:null,stores:null},Dt.updateQueue=t,t.stores=[e]):(s=t.stores,s===null?t.stores=[e]:s.push(e))}function Qu(e,t,s,a){t.value=s,t.getSnapshot=a,Vu(t)&&Ku(e)}function Yu(e,t,s){return s(function(){Vu(t)&&Ku(e)})}function Vu(e){var t=e.getSnapshot;e=e.value;try{var s=t();return!Yr(e,s)}catch{return!0}}function Ku(e){var t=Sn(e,1);t!==null&&Xr(t,e,1,-1)}function Ju(e){var t=dn();return typeof e=="function"&&(e=e()),t.memoizedState=t.baseState=e,e={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:Ga,lastRenderedState:e},t.queue=e,e=e.dispatch=Gm.bind(null,Dt,e),[t.memoizedState,e]}function Wa(e,t,s,a){return e={tag:e,create:t,destroy:s,deps:a,next:null},t=Dt.updateQueue,t===null?(t={lastEffect:null,stores:null},Dt.updateQueue=t,t.lastEffect=e.next=e):(s=t.lastEffect,s===null?t.lastEffect=e.next=e:(a=s.next,s.next=e,e.next=a,t.lastEffect=e)),e}function Zu(){return Pr().memoizedState}function Vo(e,t,s,a){var m=dn();Dt.flags|=e,m.memoizedState=Wa(1|t,s,void 0,a===void 0?null:a)}function Ko(e,t,s,a){var m=Pr();a=a===void 0?null:a;var w=void 0;if(Ut!==null){var L=Ut.memoizedState;if(w=L.destroy,a!==null&&Al(a,L.deps)){m.memoizedState=Wa(t,s,w,a);return}}Dt.flags|=e,m.memoizedState=Wa(1|t,s,w,a)}function Xu(e,t){return Vo(8390656,8,e,t)}function Fl(e,t){return Ko(2048,8,e,t)}function ed(e,t){return Ko(4,2,e,t)}function td(e,t){return Ko(4,4,e,t)}function rd(e,t){if(typeof t=="function")return e=e(),t(e),function(){t(null)};if(t!=null)return e=e(),t.current=e,function(){t.current=null}}function nd(e,t,s){return s=s!=null?s.concat([e]):null,Ko(4,4,rd.bind(null,t,e),s)}function Pl(){}function sd(e,t){var s=Pr();t=t===void 0?null:t;var a=s.memoizedState;return a!==null&&t!==null&&Al(t,a[1])?a[0]:(s.memoizedState=[e,t],e)}function ad(e,t){var s=Pr();t=t===void 0?null:t;var a=s.memoizedState;return a!==null&&t!==null&&Al(t,a[1])?a[0]:(e=e(),s.memoizedState=[e,t],e)}function od(e,t,s){return(Ds&21)===0?(e.baseState&&(e.baseState=!1,vr=!0),e.memoizedState=s):(Yr(s,t)||(s=hs(),Dt.lanes|=s,Ts|=s,e.baseState=!0),t)}function qm(e,t){var s=gt;gt=s!==0&&4>s?s:4,e(!0);var a=Tl.transition;Tl.transition={};try{e(!1),t()}finally{gt=s,Tl.transition=a}}function id(){return Pr().memoizedState}function $m(e,t,s){var a=Yn(e);if(s={lane:a,action:s,hasEagerState:!1,eagerState:null,next:null},ld(e))cd(t,s);else if(s=Uu(e,t,s,a),s!==null){var m=fr();Xr(s,e,a,m),ud(s,t,a)}}function Gm(e,t,s){var a=Yn(e),m={lane:a,action:s,hasEagerState:!1,eagerState:null,next:null};if(ld(e))cd(t,m);else{var w=e.alternate;if(e.lanes===0&&(w===null||w.lanes===0)&&(w=t.lastRenderedReducer,w!==null))try{var L=t.lastRenderedState,V=w(L,s);if(m.hasEagerState=!0,m.eagerState=V,Yr(V,L)){var te=t.interleaved;te===null?(m.next=m,El(t)):(m.next=te.next,te.next=m),t.interleaved=m;return}}catch{}finally{}s=Uu(e,t,m,a),s!==null&&(m=fr(),Xr(s,e,a,m),ud(s,t,a))}}function ld(e){var t=e.alternate;return e===Dt||t!==null&&t===Dt}function cd(e,t){qa=Yo=!0;var s=e.pending;s===null?t.next=t:(t.next=s.next,s.next=t),e.pending=t}function ud(e,t,s){if((s&4194240)!==0){var a=t.lanes;a&=e.pendingLanes,s|=a,t.lanes=s,Gs(e,s)}}var Jo={readContext:Fr,useCallback:sr,useContext:sr,useEffect:sr,useImperativeHandle:sr,useInsertionEffect:sr,useLayoutEffect:sr,useMemo:sr,useReducer:sr,useRef:sr,useState:sr,useDebugValue:sr,useDeferredValue:sr,useTransition:sr,useMutableSource:sr,useSyncExternalStore:sr,useId:sr,unstable_isNewReconciler:!1},Wm={readContext:Fr,useCallback:function(e,t){return dn().memoizedState=[e,t===void 0?null:t],e},useContext:Fr,useEffect:Xu,useImperativeHandle:function(e,t,s){return s=s!=null?s.concat([e]):null,Vo(4194308,4,rd.bind(null,t,e),s)},useLayoutEffect:function(e,t){return Vo(4194308,4,e,t)},useInsertionEffect:function(e,t){return Vo(4,2,e,t)},useMemo:function(e,t){var s=dn();return t=t===void 0?null:t,e=e(),s.memoizedState=[e,t],e},useReducer:function(e,t,s){var a=dn();return t=s!==void 0?s(t):t,a.memoizedState=a.baseState=t,e={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:e,lastRenderedState:t},a.queue=e,e=e.dispatch=$m.bind(null,Dt,e),[a.memoizedState,e]},useRef:function(e){var t=dn();return e={current:e},t.memoizedState=e},useState:Ju,useDebugValue:Pl,useDeferredValue:function(e){return dn().memoizedState=e},useTransition:function(){var e=Ju(!1),t=e[0];return e=qm.bind(null,e[1]),dn().memoizedState=e,[t,e]},useMutableSource:function(){},useSyncExternalStore:function(e,t,s){var a=Dt,m=dn();if(_t){if(s===void 0)throw Error(o(407));s=s()}else{if(s=t(),Yt===null)throw Error(o(349));(Ds&30)!==0||Wu(a,t,s)}m.memoizedState=s;var w={value:s,getSnapshot:t};return m.queue=w,Xu(Yu.bind(null,a,w,e),[e]),a.flags|=2048,Wa(9,Qu.bind(null,a,w,s,t),void 0,null),s},useId:function(){var e=dn(),t=Yt.identifierPrefix;if(_t){var s=kn,a=bn;s=(a&~(1<<32-Cr(a)-1)).toString(32)+s,t=":"+t+"R"+s,s=$a++,0<s&&(t+="H"+s.toString(32)),t+=":"}else s=Hm++,t=":"+t+"r"+s.toString(32)+":";return e.memoizedState=t},unstable_isNewReconciler:!1},Qm={readContext:Fr,useCallback:sd,useContext:Fr,useEffect:Fl,useImperativeHandle:nd,useInsertionEffect:ed,useLayoutEffect:td,useMemo:ad,useReducer:Ml,useRef:Zu,useState:function(){return Ml(Ga)},useDebugValue:Pl,useDeferredValue:function(e){var t=Pr();return od(t,Ut.memoizedState,e)},useTransition:function(){var e=Ml(Ga)[0],t=Pr().memoizedState;return[e,t]},useMutableSource:$u,useSyncExternalStore:Gu,useId:id,unstable_isNewReconciler:!1},Ym={readContext:Fr,useCallback:sd,useContext:Fr,useEffect:Fl,useImperativeHandle:nd,useInsertionEffect:ed,useLayoutEffect:td,useMemo:ad,useReducer:Ll,useRef:Zu,useState:function(){return Ll(Ga)},useDebugValue:Pl,useDeferredValue:function(e){var t=Pr();return Ut===null?t.memoizedState=e:od(t,Ut.memoizedState,e)},useTransition:function(){var e=Ll(Ga)[0],t=Pr().memoizedState;return[e,t]},useMutableSource:$u,useSyncExternalStore:Gu,useId:id,unstable_isNewReconciler:!1};function Kr(e,t){if(e&&e.defaultProps){t=z({},t),e=e.defaultProps;for(var s in e)t[s]===void 0&&(t[s]=e[s]);return t}return t}function Ul(e,t,s,a){t=e.memoizedState,s=s(a,t),s=s==null?t:z({},t,s),e.memoizedState=s,e.lanes===0&&(e.updateQueue.baseState=s)}var Zo={isMounted:function(e){return(e=e._reactInternals)?sn(e)===e:!1},enqueueSetState:function(e,t,s){e=e._reactInternals;var a=fr(),m=Yn(e),w=jn(a,m);w.payload=t,s!=null&&(w.callback=s),t=$n(e,w,m),t!==null&&(Xr(t,e,m,a),$o(t,e,m))},enqueueReplaceState:function(e,t,s){e=e._reactInternals;var a=fr(),m=Yn(e),w=jn(a,m);w.tag=1,w.payload=t,s!=null&&(w.callback=s),t=$n(e,w,m),t!==null&&(Xr(t,e,m,a),$o(t,e,m))},enqueueForceUpdate:function(e,t){e=e._reactInternals;var s=fr(),a=Yn(e),m=jn(s,a);m.tag=2,t!=null&&(m.callback=t),t=$n(e,m,a),t!==null&&(Xr(t,e,a,s),$o(t,e,a))}};function dd(e,t,s,a,m,w,L){return e=e.stateNode,typeof e.shouldComponentUpdate=="function"?e.shouldComponentUpdate(a,w,L):t.prototype&&t.prototype.isPureReactComponent?!Aa(s,a)||!Aa(m,w):!0}function fd(e,t,s){var a=!1,m=Bn,w=t.contextType;return typeof w=="object"&&w!==null?w=Fr(w):(m=yr(t)?Es:nr.current,a=t.contextTypes,w=(a=a!=null)?aa(e,m):Bn),t=new t(s,w),e.memoizedState=t.state!==null&&t.state!==void 0?t.state:null,t.updater=Zo,e.stateNode=t,t._reactInternals=e,a&&(e=e.stateNode,e.__reactInternalMemoizedUnmaskedChildContext=m,e.__reactInternalMemoizedMaskedChildContext=w),t}function hd(e,t,s,a){e=t.state,typeof t.componentWillReceiveProps=="function"&&t.componentWillReceiveProps(s,a),typeof t.UNSAFE_componentWillReceiveProps=="function"&&t.UNSAFE_componentWillReceiveProps(s,a),t.state!==e&&Zo.enqueueReplaceState(t,t.state,null)}function zl(e,t,s,a){var m=e.stateNode;m.props=s,m.state=e.memoizedState,m.refs={},Nl(e);var w=t.contextType;typeof w=="object"&&w!==null?m.context=Fr(w):(w=yr(t)?Es:nr.current,m.context=aa(e,w)),m.state=e.memoizedState,w=t.getDerivedStateFromProps,typeof w=="function"&&(Ul(e,t,w,s),m.state=e.memoizedState),typeof t.getDerivedStateFromProps=="function"||typeof m.getSnapshotBeforeUpdate=="function"||typeof m.UNSAFE_componentWillMount!="function"&&typeof m.componentWillMount!="function"||(t=m.state,typeof m.componentWillMount=="function"&&m.componentWillMount(),typeof m.UNSAFE_componentWillMount=="function"&&m.UNSAFE_componentWillMount(),t!==m.state&&Zo.enqueueReplaceState(m,m.state,null),Go(e,s,m,a),m.state=e.memoizedState),typeof m.componentDidMount=="function"&&(e.flags|=4194308)}function ha(e,t){try{var s="",a=t;do s+=ie(a),a=a.return;while(a);var m=s}catch(w){m=`
Error generating stack: `+w.message+`
`+w.stack}return{value:e,source:t,stack:m,digest:null}}function Bl(e,t,s){return{value:e,source:null,stack:s??null,digest:t??null}}function Hl(e,t){try{console.error(t.value)}catch(s){setTimeout(function(){throw s})}}var Vm=typeof WeakMap=="function"?WeakMap:Map;function md(e,t,s){s=jn(-1,s),s.tag=3,s.payload={element:null};var a=t.value;return s.callback=function(){ai||(ai=!0,nc=a),Hl(e,t)},s}function pd(e,t,s){s=jn(-1,s),s.tag=3;var a=e.type.getDerivedStateFromError;if(typeof a=="function"){var m=t.value;s.payload=function(){return a(m)},s.callback=function(){Hl(e,t)}}var w=e.stateNode;return w!==null&&typeof w.componentDidCatch=="function"&&(s.callback=function(){Hl(e,t),typeof a!="function"&&(Wn===null?Wn=new Set([this]):Wn.add(this));var L=t.stack;this.componentDidCatch(t.value,{componentStack:L!==null?L:""})}),s}function gd(e,t,s){var a=e.pingCache;if(a===null){a=e.pingCache=new Vm;var m=new Set;a.set(t,m)}else m=a.get(t),m===void 0&&(m=new Set,a.set(t,m));m.has(s)||(m.add(s),e=cp.bind(null,e,t,s),t.then(e,e))}function xd(e){do{var t;if((t=e.tag===13)&&(t=e.memoizedState,t=t!==null?t.dehydrated!==null:!0),t)return e;e=e.return}while(e!==null);return null}function yd(e,t,s,a,m){return(e.mode&1)===0?(e===t?e.flags|=65536:(e.flags|=128,s.flags|=131072,s.flags&=-52805,s.tag===1&&(s.alternate===null?s.tag=17:(t=jn(-1,1),t.tag=2,$n(s,t,1))),s.lanes|=1),e):(e.flags|=65536,e.lanes=m,e)}var Km=A.ReactCurrentOwner,vr=!1;function dr(e,t,s,a){t.child=e===null?Pu(t,null,s,a):ca(t,e.child,s,a)}function vd(e,t,s,a,m){s=s.render;var w=t.ref;return da(t,m),a=Ol(e,t,s,a,w,m),s=Rl(),e!==null&&!vr?(t.updateQueue=e.updateQueue,t.flags&=-2053,e.lanes&=~m,En(e,t,m)):(_t&&s&&gl(t),t.flags|=1,dr(e,t,a,m),t.child)}function wd(e,t,s,a,m){if(e===null){var w=s.type;return typeof w=="function"&&!uc(w)&&w.defaultProps===void 0&&s.compare===null&&s.defaultProps===void 0?(t.tag=15,t.type=w,bd(e,t,w,a,m)):(e=di(s.type,null,a,t,t.mode,m),e.ref=t.ref,e.return=t,t.child=e)}if(w=e.child,(e.lanes&m)===0){var L=w.memoizedProps;if(s=s.compare,s=s!==null?s:Aa,s(L,a)&&e.ref===t.ref)return En(e,t,m)}return t.flags|=1,e=Kn(w,a),e.ref=t.ref,e.return=t,t.child=e}function bd(e,t,s,a,m){if(e!==null){var w=e.memoizedProps;if(Aa(w,a)&&e.ref===t.ref)if(vr=!1,t.pendingProps=a=w,(e.lanes&m)!==0)(e.flags&131072)!==0&&(vr=!0);else return t.lanes=e.lanes,En(e,t,m)}return ql(e,t,s,a,m)}function kd(e,t,s){var a=t.pendingProps,m=a.children,w=e!==null?e.memoizedState:null;if(a.mode==="hidden")if((t.mode&1)===0)t.memoizedState={baseLanes:0,cachePool:null,transitions:null},kt(pa,Ar),Ar|=s;else{if((s&1073741824)===0)return e=w!==null?w.baseLanes|s:s,t.lanes=t.childLanes=1073741824,t.memoizedState={baseLanes:e,cachePool:null,transitions:null},t.updateQueue=null,kt(pa,Ar),Ar|=e,null;t.memoizedState={baseLanes:0,cachePool:null,transitions:null},a=w!==null?w.baseLanes:s,kt(pa,Ar),Ar|=a}else w!==null?(a=w.baseLanes|s,t.memoizedState=null):a=s,kt(pa,Ar),Ar|=a;return dr(e,t,m,s),t.child}function Sd(e,t){var s=t.ref;(e===null&&s!==null||e!==null&&e.ref!==s)&&(t.flags|=512,t.flags|=2097152)}function ql(e,t,s,a,m){var w=yr(s)?Es:nr.current;return w=aa(t,w),da(t,m),s=Ol(e,t,s,a,w,m),a=Rl(),e!==null&&!vr?(t.updateQueue=e.updateQueue,t.flags&=-2053,e.lanes&=~m,En(e,t,m)):(_t&&a&&gl(t),t.flags|=1,dr(e,t,s,m),t.child)}function jd(e,t,s,a,m){if(yr(s)){var w=!0;Lo(t)}else w=!1;if(da(t,m),t.stateNode===null)ei(e,t),fd(t,s,a),zl(t,s,a,m),a=!0;else if(e===null){var L=t.stateNode,V=t.memoizedProps;L.props=V;var te=L.context,ve=s.contextType;typeof ve=="object"&&ve!==null?ve=Fr(ve):(ve=yr(s)?Es:nr.current,ve=aa(t,ve));var Ie=s.getDerivedStateFromProps,Oe=typeof Ie=="function"||typeof L.getSnapshotBeforeUpdate=="function";Oe||typeof L.UNSAFE_componentWillReceiveProps!="function"&&typeof L.componentWillReceiveProps!="function"||(V!==a||te!==ve)&&hd(t,L,a,ve),qn=!1;var Ce=t.memoizedState;L.state=Ce,Go(t,a,L,m),te=t.memoizedState,V!==a||Ce!==te||xr.current||qn?(typeof Ie=="function"&&(Ul(t,s,Ie,a),te=t.memoizedState),(V=qn||dd(t,s,V,a,Ce,te,ve))?(Oe||typeof L.UNSAFE_componentWillMount!="function"&&typeof L.componentWillMount!="function"||(typeof L.componentWillMount=="function"&&L.componentWillMount(),typeof L.UNSAFE_componentWillMount=="function"&&L.UNSAFE_componentWillMount()),typeof L.componentDidMount=="function"&&(t.flags|=4194308)):(typeof L.componentDidMount=="function"&&(t.flags|=4194308),t.memoizedProps=a,t.memoizedState=te),L.props=a,L.state=te,L.context=ve,a=V):(typeof L.componentDidMount=="function"&&(t.flags|=4194308),a=!1)}else{L=t.stateNode,zu(e,t),V=t.memoizedProps,ve=t.type===t.elementType?V:Kr(t.type,V),L.props=ve,Oe=t.pendingProps,Ce=L.context,te=s.contextType,typeof te=="object"&&te!==null?te=Fr(te):(te=yr(s)?Es:nr.current,te=aa(t,te));var Be=s.getDerivedStateFromProps;(Ie=typeof Be=="function"||typeof L.getSnapshotBeforeUpdate=="function")||typeof L.UNSAFE_componentWillReceiveProps!="function"&&typeof L.componentWillReceiveProps!="function"||(V!==Oe||Ce!==te)&&hd(t,L,a,te),qn=!1,Ce=t.memoizedState,L.state=Ce,Go(t,a,L,m);var qe=t.memoizedState;V!==Oe||Ce!==qe||xr.current||qn?(typeof Be=="function"&&(Ul(t,s,Be,a),qe=t.memoizedState),(ve=qn||dd(t,s,ve,a,Ce,qe,te)||!1)?(Ie||typeof L.UNSAFE_componentWillUpdate!="function"&&typeof L.componentWillUpdate!="function"||(typeof L.componentWillUpdate=="function"&&L.componentWillUpdate(a,qe,te),typeof L.UNSAFE_componentWillUpdate=="function"&&L.UNSAFE_componentWillUpdate(a,qe,te)),typeof L.componentDidUpdate=="function"&&(t.flags|=4),typeof L.getSnapshotBeforeUpdate=="function"&&(t.flags|=1024)):(typeof L.componentDidUpdate!="function"||V===e.memoizedProps&&Ce===e.memoizedState||(t.flags|=4),typeof L.getSnapshotBeforeUpdate!="function"||V===e.memoizedProps&&Ce===e.memoizedState||(t.flags|=1024),t.memoizedProps=a,t.memoizedState=qe),L.props=a,L.state=qe,L.context=te,a=ve):(typeof L.componentDidUpdate!="function"||V===e.memoizedProps&&Ce===e.memoizedState||(t.flags|=4),typeof L.getSnapshotBeforeUpdate!="function"||V===e.memoizedProps&&Ce===e.memoizedState||(t.flags|=1024),a=!1)}return $l(e,t,s,a,w,m)}function $l(e,t,s,a,m,w){Sd(e,t);var L=(t.flags&128)!==0;if(!a&&!L)return m&&Iu(t,s,!1),En(e,t,w);a=t.stateNode,Km.current=t;var V=L&&typeof s.getDerivedStateFromError!="function"?null:a.render();return t.flags|=1,e!==null&&L?(t.child=ca(t,e.child,null,w),t.child=ca(t,null,V,w)):dr(e,t,V,w),t.memoizedState=a.state,m&&Iu(t,s,!0),t.child}function Ed(e){var t=e.stateNode;t.pendingContext?_u(e,t.pendingContext,t.pendingContext!==t.context):t.context&&_u(e,t.context,!1),_l(e,t.containerInfo)}function Nd(e,t,s,a,m){return la(),wl(m),t.flags|=256,dr(e,t,s,a),t.child}var Gl={dehydrated:null,treeContext:null,retryLane:0};function Wl(e){return{baseLanes:e,cachePool:null,transitions:null}}function _d(e,t,s){var a=t.pendingProps,m=It.current,w=!1,L=(t.flags&128)!==0,V;if((V=L)||(V=e!==null&&e.memoizedState===null?!1:(m&2)!==0),V?(w=!0,t.flags&=-129):(e===null||e.memoizedState!==null)&&(m|=1),kt(It,m&1),e===null)return vl(t),e=t.memoizedState,e!==null&&(e=e.dehydrated,e!==null)?((t.mode&1)===0?t.lanes=1:e.data==="$!"?t.lanes=8:t.lanes=1073741824,null):(L=a.children,e=a.fallback,w?(a=t.mode,w=t.child,L={mode:"hidden",children:L},(a&1)===0&&w!==null?(w.childLanes=0,w.pendingProps=L):w=fi(L,a,0,null),e=Ms(e,a,s,null),w.return=t,e.return=t,w.sibling=e,t.child=w,t.child.memoizedState=Wl(s),t.memoizedState=Gl,e):Ql(t,L));if(m=e.memoizedState,m!==null&&(V=m.dehydrated,V!==null))return Jm(e,t,L,a,V,m,s);if(w){w=a.fallback,L=t.mode,m=e.child,V=m.sibling;var te={mode:"hidden",children:a.children};return(L&1)===0&&t.child!==m?(a=t.child,a.childLanes=0,a.pendingProps=te,t.deletions=null):(a=Kn(m,te),a.subtreeFlags=m.subtreeFlags&14680064),V!==null?w=Kn(V,w):(w=Ms(w,L,s,null),w.flags|=2),w.return=t,a.return=t,a.sibling=w,t.child=a,a=w,w=t.child,L=e.child.memoizedState,L=L===null?Wl(s):{baseLanes:L.baseLanes|s,cachePool:null,transitions:L.transitions},w.memoizedState=L,w.childLanes=e.childLanes&~s,t.memoizedState=Gl,a}return w=e.child,e=w.sibling,a=Kn(w,{mode:"visible",children:a.children}),(t.mode&1)===0&&(a.lanes=s),a.return=t,a.sibling=null,e!==null&&(s=t.deletions,s===null?(t.deletions=[e],t.flags|=16):s.push(e)),t.child=a,t.memoizedState=null,a}function Ql(e,t){return t=fi({mode:"visible",children:t},e.mode,0,null),t.return=e,e.child=t}function Xo(e,t,s,a){return a!==null&&wl(a),ca(t,e.child,null,s),e=Ql(t,t.pendingProps.children),e.flags|=2,t.memoizedState=null,e}function Jm(e,t,s,a,m,w,L){if(s)return t.flags&256?(t.flags&=-257,a=Bl(Error(o(422))),Xo(e,t,L,a)):t.memoizedState!==null?(t.child=e.child,t.flags|=128,null):(w=a.fallback,m=t.mode,a=fi({mode:"visible",children:a.children},m,0,null),w=Ms(w,m,L,null),w.flags|=2,a.return=t,w.return=t,a.sibling=w,t.child=a,(t.mode&1)!==0&&ca(t,e.child,null,L),t.child.memoizedState=Wl(L),t.memoizedState=Gl,w);if((t.mode&1)===0)return Xo(e,t,L,null);if(m.data==="$!"){if(a=m.nextSibling&&m.nextSibling.dataset,a)var V=a.dgst;return a=V,w=Error(o(419)),a=Bl(w,a,void 0),Xo(e,t,L,a)}if(V=(L&e.childLanes)!==0,vr||V){if(a=Yt,a!==null){switch(L&-L){case 4:m=2;break;case 16:m=8;break;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:m=32;break;case 536870912:m=268435456;break;default:m=0}m=(m&(a.suspendedLanes|L))!==0?0:m,m!==0&&m!==w.retryLane&&(w.retryLane=m,Sn(e,m),Xr(a,e,m,-1))}return cc(),a=Bl(Error(o(421))),Xo(e,t,L,a)}return m.data==="$?"?(t.flags|=128,t.child=e.child,t=up.bind(null,e),m._reactRetry=t,null):(e=w.treeContext,Tr=Un(m.nextSibling),Dr=t,_t=!0,Vr=null,e!==null&&(Mr[Lr++]=bn,Mr[Lr++]=kn,Mr[Lr++]=Ns,bn=e.id,kn=e.overflow,Ns=t),t=Ql(t,a.children),t.flags|=4096,t)}function Cd(e,t,s){e.lanes|=t;var a=e.alternate;a!==null&&(a.lanes|=t),jl(e.return,t,s)}function Yl(e,t,s,a,m){var w=e.memoizedState;w===null?e.memoizedState={isBackwards:t,rendering:null,renderingStartTime:0,last:a,tail:s,tailMode:m}:(w.isBackwards=t,w.rendering=null,w.renderingStartTime=0,w.last=a,w.tail=s,w.tailMode=m)}function Id(e,t,s){var a=t.pendingProps,m=a.revealOrder,w=a.tail;if(dr(e,t,a.children,s),a=It.current,(a&2)!==0)a=a&1|2,t.flags|=128;else{if(e!==null&&(e.flags&128)!==0)e:for(e=t.child;e!==null;){if(e.tag===13)e.memoizedState!==null&&Cd(e,s,t);else if(e.tag===19)Cd(e,s,t);else if(e.child!==null){e.child.return=e,e=e.child;continue}if(e===t)break e;for(;e.sibling===null;){if(e.return===null||e.return===t)break e;e=e.return}e.sibling.return=e.return,e=e.sibling}a&=1}if(kt(It,a),(t.mode&1)===0)t.memoizedState=null;else switch(m){case"forwards":for(s=t.child,m=null;s!==null;)e=s.alternate,e!==null&&Wo(e)===null&&(m=s),s=s.sibling;s=m,s===null?(m=t.child,t.child=null):(m=s.sibling,s.sibling=null),Yl(t,!1,m,s,w);break;case"backwards":for(s=null,m=t.child,t.child=null;m!==null;){if(e=m.alternate,e!==null&&Wo(e)===null){t.child=m;break}e=m.sibling,m.sibling=s,s=m,m=e}Yl(t,!0,s,null,w);break;case"together":Yl(t,!1,null,null,void 0);break;default:t.memoizedState=null}return t.child}function ei(e,t){(t.mode&1)===0&&e!==null&&(e.alternate=null,t.alternate=null,t.flags|=2)}function En(e,t,s){if(e!==null&&(t.dependencies=e.dependencies),Ts|=t.lanes,(s&t.childLanes)===0)return null;if(e!==null&&t.child!==e.child)throw Error(o(153));if(t.child!==null){for(e=t.child,s=Kn(e,e.pendingProps),t.child=s,s.return=t;e.sibling!==null;)e=e.sibling,s=s.sibling=Kn(e,e.pendingProps),s.return=t;s.sibling=null}return t.child}function Zm(e,t,s){switch(t.tag){case 3:Ed(t),la();break;case 5:qu(t);break;case 1:yr(t.type)&&Lo(t);break;case 4:_l(t,t.stateNode.containerInfo);break;case 10:var a=t.type._context,m=t.memoizedProps.value;kt(Ho,a._currentValue),a._currentValue=m;break;case 13:if(a=t.memoizedState,a!==null)return a.dehydrated!==null?(kt(It,It.current&1),t.flags|=128,null):(s&t.child.childLanes)!==0?_d(e,t,s):(kt(It,It.current&1),e=En(e,t,s),e!==null?e.sibling:null);kt(It,It.current&1);break;case 19:if(a=(s&t.childLanes)!==0,(e.flags&128)!==0){if(a)return Id(e,t,s);t.flags|=128}if(m=t.memoizedState,m!==null&&(m.rendering=null,m.tail=null,m.lastEffect=null),kt(It,It.current),a)break;return null;case 22:case 23:return t.lanes=0,kd(e,t,s)}return En(e,t,s)}var Dd,Vl,Td,Ad;Dd=function(e,t){for(var s=t.child;s!==null;){if(s.tag===5||s.tag===6)e.appendChild(s.stateNode);else if(s.tag!==4&&s.child!==null){s.child.return=s,s=s.child;continue}if(s===t)break;for(;s.sibling===null;){if(s.return===null||s.return===t)return;s=s.return}s.sibling.return=s.return,s=s.sibling}},Vl=function(){},Td=function(e,t,s,a){var m=e.memoizedProps;if(m!==a){e=t.stateNode,Is(un.current);var w=null;switch(s){case"input":m=E(e,m),a=E(e,a),w=[];break;case"select":m=z({},m,{value:void 0}),a=z({},a,{value:void 0}),w=[];break;case"textarea":m=ne(e,m),a=ne(e,a),w=[];break;default:typeof m.onClick!="function"&&typeof a.onClick=="function"&&(e.onclick=Oo)}ft(s,a);var L;s=null;for(ve in m)if(!a.hasOwnProperty(ve)&&m.hasOwnProperty(ve)&&m[ve]!=null)if(ve==="style"){var V=m[ve];for(L in V)V.hasOwnProperty(L)&&(s||(s={}),s[L]="")}else ve!=="dangerouslySetInnerHTML"&&ve!=="children"&&ve!=="suppressContentEditableWarning"&&ve!=="suppressHydrationWarning"&&ve!=="autoFocus"&&(d.hasOwnProperty(ve)?w||(w=[]):(w=w||[]).push(ve,null));for(ve in a){var te=a[ve];if(V=m!=null?m[ve]:void 0,a.hasOwnProperty(ve)&&te!==V&&(te!=null||V!=null))if(ve==="style")if(V){for(L in V)!V.hasOwnProperty(L)||te&&te.hasOwnProperty(L)||(s||(s={}),s[L]="");for(L in te)te.hasOwnProperty(L)&&V[L]!==te[L]&&(s||(s={}),s[L]=te[L])}else s||(w||(w=[]),w.push(ve,s)),s=te;else ve==="dangerouslySetInnerHTML"?(te=te?te.__html:void 0,V=V?V.__html:void 0,te!=null&&V!==te&&(w=w||[]).push(ve,te)):ve==="children"?typeof te!="string"&&typeof te!="number"||(w=w||[]).push(ve,""+te):ve!=="suppressContentEditableWarning"&&ve!=="suppressHydrationWarning"&&(d.hasOwnProperty(ve)?(te!=null&&ve==="onScroll"&&St("scroll",e),w||V===te||(w=[])):(w=w||[]).push(ve,te))}s&&(w=w||[]).push("style",s);var ve=w;(t.updateQueue=ve)&&(t.flags|=4)}},Ad=function(e,t,s,a){s!==a&&(t.flags|=4)};function Qa(e,t){if(!_t)switch(e.tailMode){case"hidden":t=e.tail;for(var s=null;t!==null;)t.alternate!==null&&(s=t),t=t.sibling;s===null?e.tail=null:s.sibling=null;break;case"collapsed":s=e.tail;for(var a=null;s!==null;)s.alternate!==null&&(a=s),s=s.sibling;a===null?t||e.tail===null?e.tail=null:e.tail.sibling=null:a.sibling=null}}function ar(e){var t=e.alternate!==null&&e.alternate.child===e.child,s=0,a=0;if(t)for(var m=e.child;m!==null;)s|=m.lanes|m.childLanes,a|=m.subtreeFlags&14680064,a|=m.flags&14680064,m.return=e,m=m.sibling;else for(m=e.child;m!==null;)s|=m.lanes|m.childLanes,a|=m.subtreeFlags,a|=m.flags,m.return=e,m=m.sibling;return e.subtreeFlags|=a,e.childLanes=s,t}function Xm(e,t,s){var a=t.pendingProps;switch(xl(t),t.tag){case 2:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return ar(t),null;case 1:return yr(t.type)&&Mo(),ar(t),null;case 3:return a=t.stateNode,fa(),jt(xr),jt(nr),Dl(),a.pendingContext&&(a.context=a.pendingContext,a.pendingContext=null),(e===null||e.child===null)&&(zo(t)?t.flags|=4:e===null||e.memoizedState.isDehydrated&&(t.flags&256)===0||(t.flags|=1024,Vr!==null&&(oc(Vr),Vr=null))),Vl(e,t),ar(t),null;case 5:Cl(t);var m=Is(Ha.current);if(s=t.type,e!==null&&t.stateNode!=null)Td(e,t,s,a,m),e.ref!==t.ref&&(t.flags|=512,t.flags|=2097152);else{if(!a){if(t.stateNode===null)throw Error(o(166));return ar(t),null}if(e=Is(un.current),zo(t)){a=t.stateNode,s=t.type;var w=t.memoizedProps;switch(a[cn]=t,a[Fa]=w,e=(t.mode&1)!==0,s){case"dialog":St("cancel",a),St("close",a);break;case"iframe":case"object":case"embed":St("load",a);break;case"video":case"audio":for(m=0;m<Ra.length;m++)St(Ra[m],a);break;case"source":St("error",a);break;case"img":case"image":case"link":St("error",a),St("load",a);break;case"details":St("toggle",a);break;case"input":ge(a,w),St("invalid",a);break;case"select":a._wrapperState={wasMultiple:!!w.multiple},St("invalid",a);break;case"textarea":je(a,w),St("invalid",a)}ft(s,w),m=null;for(var L in w)if(w.hasOwnProperty(L)){var V=w[L];L==="children"?typeof V=="string"?a.textContent!==V&&(w.suppressHydrationWarning!==!0&&Ao(a.textContent,V,e),m=["children",V]):typeof V=="number"&&a.textContent!==""+V&&(w.suppressHydrationWarning!==!0&&Ao(a.textContent,V,e),m=["children",""+V]):d.hasOwnProperty(L)&&V!=null&&L==="onScroll"&&St("scroll",a)}switch(s){case"input":Pe(a),G(a,w,!0);break;case"textarea":Pe(a),Te(a);break;case"select":case"option":break;default:typeof w.onClick=="function"&&(a.onclick=Oo)}a=m,t.updateQueue=a,a!==null&&(t.flags|=4)}else{L=m.nodeType===9?m:m.ownerDocument,e==="http://www.w3.org/1999/xhtml"&&(e=ze(s)),e==="http://www.w3.org/1999/xhtml"?s==="script"?(e=L.createElement("div"),e.innerHTML="<script><\/script>",e=e.removeChild(e.firstChild)):typeof a.is=="string"?e=L.createElement(s,{is:a.is}):(e=L.createElement(s),s==="select"&&(L=e,a.multiple?L.multiple=!0:a.size&&(L.size=a.size))):e=L.createElementNS(e,s),e[cn]=t,e[Fa]=a,Dd(e,t,!1,!1),t.stateNode=e;e:{switch(L=pt(s,a),s){case"dialog":St("cancel",e),St("close",e),m=a;break;case"iframe":case"object":case"embed":St("load",e),m=a;break;case"video":case"audio":for(m=0;m<Ra.length;m++)St(Ra[m],e);m=a;break;case"source":St("error",e),m=a;break;case"img":case"image":case"link":St("error",e),St("load",e),m=a;break;case"details":St("toggle",e),m=a;break;case"input":ge(e,a),m=E(e,a),St("invalid",e);break;case"option":m=a;break;case"select":e._wrapperState={wasMultiple:!!a.multiple},m=z({},a,{value:void 0}),St("invalid",e);break;case"textarea":je(e,a),m=ne(e,a),St("invalid",e);break;default:m=a}ft(s,m),V=m;for(w in V)if(V.hasOwnProperty(w)){var te=V[w];w==="style"?Ot(e,te):w==="dangerouslySetInnerHTML"?(te=te?te.__html:void 0,te!=null&&bt(e,te)):w==="children"?typeof te=="string"?(s!=="textarea"||te!=="")&&Ue(e,te):typeof te=="number"&&Ue(e,""+te):w!=="suppressContentEditableWarning"&&w!=="suppressHydrationWarning"&&w!=="autoFocus"&&(d.hasOwnProperty(w)?te!=null&&w==="onScroll"&&St("scroll",e):te!=null&&R(e,w,te,L))}switch(s){case"input":Pe(e),G(e,a,!1);break;case"textarea":Pe(e),Te(e);break;case"option":a.value!=null&&e.setAttribute("value",""+Se(a.value));break;case"select":e.multiple=!!a.multiple,w=a.value,w!=null?le(e,!!a.multiple,w,!1):a.defaultValue!=null&&le(e,!!a.multiple,a.defaultValue,!0);break;default:typeof m.onClick=="function"&&(e.onclick=Oo)}switch(s){case"button":case"input":case"select":case"textarea":a=!!a.autoFocus;break e;case"img":a=!0;break e;default:a=!1}}a&&(t.flags|=4)}t.ref!==null&&(t.flags|=512,t.flags|=2097152)}return ar(t),null;case 6:if(e&&t.stateNode!=null)Ad(e,t,e.memoizedProps,a);else{if(typeof a!="string"&&t.stateNode===null)throw Error(o(166));if(s=Is(Ha.current),Is(un.current),zo(t)){if(a=t.stateNode,s=t.memoizedProps,a[cn]=t,(w=a.nodeValue!==s)&&(e=Dr,e!==null))switch(e.tag){case 3:Ao(a.nodeValue,s,(e.mode&1)!==0);break;case 5:e.memoizedProps.suppressHydrationWarning!==!0&&Ao(a.nodeValue,s,(e.mode&1)!==0)}w&&(t.flags|=4)}else a=(s.nodeType===9?s:s.ownerDocument).createTextNode(a),a[cn]=t,t.stateNode=a}return ar(t),null;case 13:if(jt(It),a=t.memoizedState,e===null||e.memoizedState!==null&&e.memoizedState.dehydrated!==null){if(_t&&Tr!==null&&(t.mode&1)!==0&&(t.flags&128)===0)Mu(),la(),t.flags|=98560,w=!1;else if(w=zo(t),a!==null&&a.dehydrated!==null){if(e===null){if(!w)throw Error(o(318));if(w=t.memoizedState,w=w!==null?w.dehydrated:null,!w)throw Error(o(317));w[cn]=t}else la(),(t.flags&128)===0&&(t.memoizedState=null),t.flags|=4;ar(t),w=!1}else Vr!==null&&(oc(Vr),Vr=null),w=!0;if(!w)return t.flags&65536?t:null}return(t.flags&128)!==0?(t.lanes=s,t):(a=a!==null,a!==(e!==null&&e.memoizedState!==null)&&a&&(t.child.flags|=8192,(t.mode&1)!==0&&(e===null||(It.current&1)!==0?zt===0&&(zt=3):cc())),t.updateQueue!==null&&(t.flags|=4),ar(t),null);case 4:return fa(),Vl(e,t),e===null&&Ma(t.stateNode.containerInfo),ar(t),null;case 10:return Sl(t.type._context),ar(t),null;case 17:return yr(t.type)&&Mo(),ar(t),null;case 19:if(jt(It),w=t.memoizedState,w===null)return ar(t),null;if(a=(t.flags&128)!==0,L=w.rendering,L===null)if(a)Qa(w,!1);else{if(zt!==0||e!==null&&(e.flags&128)!==0)for(e=t.child;e!==null;){if(L=Wo(e),L!==null){for(t.flags|=128,Qa(w,!1),a=L.updateQueue,a!==null&&(t.updateQueue=a,t.flags|=4),t.subtreeFlags=0,a=s,s=t.child;s!==null;)w=s,e=a,w.flags&=14680066,L=w.alternate,L===null?(w.childLanes=0,w.lanes=e,w.child=null,w.subtreeFlags=0,w.memoizedProps=null,w.memoizedState=null,w.updateQueue=null,w.dependencies=null,w.stateNode=null):(w.childLanes=L.childLanes,w.lanes=L.lanes,w.child=L.child,w.subtreeFlags=0,w.deletions=null,w.memoizedProps=L.memoizedProps,w.memoizedState=L.memoizedState,w.updateQueue=L.updateQueue,w.type=L.type,e=L.dependencies,w.dependencies=e===null?null:{lanes:e.lanes,firstContext:e.firstContext}),s=s.sibling;return kt(It,It.current&1|2),t.child}e=e.sibling}w.tail!==null&&Et()>ga&&(t.flags|=128,a=!0,Qa(w,!1),t.lanes=4194304)}else{if(!a)if(e=Wo(L),e!==null){if(t.flags|=128,a=!0,s=e.updateQueue,s!==null&&(t.updateQueue=s,t.flags|=4),Qa(w,!0),w.tail===null&&w.tailMode==="hidden"&&!L.alternate&&!_t)return ar(t),null}else 2*Et()-w.renderingStartTime>ga&&s!==1073741824&&(t.flags|=128,a=!0,Qa(w,!1),t.lanes=4194304);w.isBackwards?(L.sibling=t.child,t.child=L):(s=w.last,s!==null?s.sibling=L:t.child=L,w.last=L)}return w.tail!==null?(t=w.tail,w.rendering=t,w.tail=t.sibling,w.renderingStartTime=Et(),t.sibling=null,s=It.current,kt(It,a?s&1|2:s&1),t):(ar(t),null);case 22:case 23:return lc(),a=t.memoizedState!==null,e!==null&&e.memoizedState!==null!==a&&(t.flags|=8192),a&&(t.mode&1)!==0?(Ar&1073741824)!==0&&(ar(t),t.subtreeFlags&6&&(t.flags|=8192)):ar(t),null;case 24:return null;case 25:return null}throw Error(o(156,t.tag))}function ep(e,t){switch(xl(t),t.tag){case 1:return yr(t.type)&&Mo(),e=t.flags,e&65536?(t.flags=e&-65537|128,t):null;case 3:return fa(),jt(xr),jt(nr),Dl(),e=t.flags,(e&65536)!==0&&(e&128)===0?(t.flags=e&-65537|128,t):null;case 5:return Cl(t),null;case 13:if(jt(It),e=t.memoizedState,e!==null&&e.dehydrated!==null){if(t.alternate===null)throw Error(o(340));la()}return e=t.flags,e&65536?(t.flags=e&-65537|128,t):null;case 19:return jt(It),null;case 4:return fa(),null;case 10:return Sl(t.type._context),null;case 22:case 23:return lc(),null;case 24:return null;default:return null}}var ti=!1,or=!1,tp=typeof WeakSet=="function"?WeakSet:Set,He=null;function ma(e,t){var s=e.ref;if(s!==null)if(typeof s=="function")try{s(null)}catch(a){At(e,t,a)}else s.current=null}function Kl(e,t,s){try{s()}catch(a){At(e,t,a)}}var Od=!1;function rp(e,t){if(ll=D,e=du(),el(e)){if("selectionStart"in e)var s={start:e.selectionStart,end:e.selectionEnd};else e:{s=(s=e.ownerDocument)&&s.defaultView||window;var a=s.getSelection&&s.getSelection();if(a&&a.rangeCount!==0){s=a.anchorNode;var m=a.anchorOffset,w=a.focusNode;a=a.focusOffset;try{s.nodeType,w.nodeType}catch{s=null;break e}var L=0,V=-1,te=-1,ve=0,Ie=0,Oe=e,Ce=null;t:for(;;){for(var Be;Oe!==s||m!==0&&Oe.nodeType!==3||(V=L+m),Oe!==w||a!==0&&Oe.nodeType!==3||(te=L+a),Oe.nodeType===3&&(L+=Oe.nodeValue.length),(Be=Oe.firstChild)!==null;)Ce=Oe,Oe=Be;for(;;){if(Oe===e)break t;if(Ce===s&&++ve===m&&(V=L),Ce===w&&++Ie===a&&(te=L),(Be=Oe.nextSibling)!==null)break;Oe=Ce,Ce=Oe.parentNode}Oe=Be}s=V===-1||te===-1?null:{start:V,end:te}}else s=null}s=s||{start:0,end:0}}else s=null;for(cl={focusedElem:e,selectionRange:s},D=!1,He=t;He!==null;)if(t=He,e=t.child,(t.subtreeFlags&1028)!==0&&e!==null)e.return=t,He=e;else for(;He!==null;){t=He;try{var qe=t.alternate;if((t.flags&1024)!==0)switch(t.tag){case 0:case 11:case 15:break;case 1:if(qe!==null){var Ge=qe.memoizedProps,Rt=qe.memoizedState,me=t.stateNode,ae=me.getSnapshotBeforeUpdate(t.elementType===t.type?Ge:Kr(t.type,Ge),Rt);me.__reactInternalSnapshotBeforeUpdate=ae}break;case 3:var xe=t.stateNode.containerInfo;xe.nodeType===1?xe.textContent="":xe.nodeType===9&&xe.documentElement&&xe.removeChild(xe.documentElement);break;case 5:case 6:case 4:case 17:break;default:throw Error(o(163))}}catch(Le){At(t,t.return,Le)}if(e=t.sibling,e!==null){e.return=t.return,He=e;break}He=t.return}return qe=Od,Od=!1,qe}function Ya(e,t,s){var a=t.updateQueue;if(a=a!==null?a.lastEffect:null,a!==null){var m=a=a.next;do{if((m.tag&e)===e){var w=m.destroy;m.destroy=void 0,w!==void 0&&Kl(t,s,w)}m=m.next}while(m!==a)}}function ri(e,t){if(t=t.updateQueue,t=t!==null?t.lastEffect:null,t!==null){var s=t=t.next;do{if((s.tag&e)===e){var a=s.create;s.destroy=a()}s=s.next}while(s!==t)}}function Jl(e){var t=e.ref;if(t!==null){var s=e.stateNode;switch(e.tag){case 5:e=s;break;default:e=s}typeof t=="function"?t(e):t.current=e}}function Rd(e){var t=e.alternate;t!==null&&(e.alternate=null,Rd(t)),e.child=null,e.deletions=null,e.sibling=null,e.tag===5&&(t=e.stateNode,t!==null&&(delete t[cn],delete t[Fa],delete t[hl],delete t[Pm],delete t[Um])),e.stateNode=null,e.return=null,e.dependencies=null,e.memoizedProps=null,e.memoizedState=null,e.pendingProps=null,e.stateNode=null,e.updateQueue=null}function Md(e){return e.tag===5||e.tag===3||e.tag===4}function Ld(e){e:for(;;){for(;e.sibling===null;){if(e.return===null||Md(e.return))return null;e=e.return}for(e.sibling.return=e.return,e=e.sibling;e.tag!==5&&e.tag!==6&&e.tag!==18;){if(e.flags&2||e.child===null||e.tag===4)continue e;e.child.return=e,e=e.child}if(!(e.flags&2))return e.stateNode}}function Zl(e,t,s){var a=e.tag;if(a===5||a===6)e=e.stateNode,t?s.nodeType===8?s.parentNode.insertBefore(e,t):s.insertBefore(e,t):(s.nodeType===8?(t=s.parentNode,t.insertBefore(e,s)):(t=s,t.appendChild(e)),s=s._reactRootContainer,s!=null||t.onclick!==null||(t.onclick=Oo));else if(a!==4&&(e=e.child,e!==null))for(Zl(e,t,s),e=e.sibling;e!==null;)Zl(e,t,s),e=e.sibling}function Xl(e,t,s){var a=e.tag;if(a===5||a===6)e=e.stateNode,t?s.insertBefore(e,t):s.appendChild(e);else if(a!==4&&(e=e.child,e!==null))for(Xl(e,t,s),e=e.sibling;e!==null;)Xl(e,t,s),e=e.sibling}var Xt=null,Jr=!1;function Gn(e,t,s){for(s=s.child;s!==null;)Fd(e,t,s),s=s.sibling}function Fd(e,t,s){if(_r&&typeof _r.onCommitFiberUnmount=="function")try{_r.onCommitFiberUnmount(us,s)}catch{}switch(s.tag){case 5:or||ma(s,t);case 6:var a=Xt,m=Jr;Xt=null,Gn(e,t,s),Xt=a,Jr=m,Xt!==null&&(Jr?(e=Xt,s=s.stateNode,e.nodeType===8?e.parentNode.removeChild(s):e.removeChild(s)):Xt.removeChild(s.stateNode));break;case 18:Xt!==null&&(Jr?(e=Xt,s=s.stateNode,e.nodeType===8?fl(e.parentNode,s):e.nodeType===1&&fl(e,s),u(e)):fl(Xt,s.stateNode));break;case 4:a=Xt,m=Jr,Xt=s.stateNode.containerInfo,Jr=!0,Gn(e,t,s),Xt=a,Jr=m;break;case 0:case 11:case 14:case 15:if(!or&&(a=s.updateQueue,a!==null&&(a=a.lastEffect,a!==null))){m=a=a.next;do{var w=m,L=w.destroy;w=w.tag,L!==void 0&&((w&2)!==0||(w&4)!==0)&&Kl(s,t,L),m=m.next}while(m!==a)}Gn(e,t,s);break;case 1:if(!or&&(ma(s,t),a=s.stateNode,typeof a.componentWillUnmount=="function"))try{a.props=s.memoizedProps,a.state=s.memoizedState,a.componentWillUnmount()}catch(V){At(s,t,V)}Gn(e,t,s);break;case 21:Gn(e,t,s);break;case 22:s.mode&1?(or=(a=or)||s.memoizedState!==null,Gn(e,t,s),or=a):Gn(e,t,s);break;default:Gn(e,t,s)}}function Pd(e){var t=e.updateQueue;if(t!==null){e.updateQueue=null;var s=e.stateNode;s===null&&(s=e.stateNode=new tp),t.forEach(function(a){var m=dp.bind(null,e,a);s.has(a)||(s.add(a),a.then(m,m))})}}function Zr(e,t){var s=t.deletions;if(s!==null)for(var a=0;a<s.length;a++){var m=s[a];try{var w=e,L=t,V=L;e:for(;V!==null;){switch(V.tag){case 5:Xt=V.stateNode,Jr=!1;break e;case 3:Xt=V.stateNode.containerInfo,Jr=!0;break e;case 4:Xt=V.stateNode.containerInfo,Jr=!0;break e}V=V.return}if(Xt===null)throw Error(o(160));Fd(w,L,m),Xt=null,Jr=!1;var te=m.alternate;te!==null&&(te.return=null),m.return=null}catch(ve){At(m,t,ve)}}if(t.subtreeFlags&12854)for(t=t.child;t!==null;)Ud(t,e),t=t.sibling}function Ud(e,t){var s=e.alternate,a=e.flags;switch(e.tag){case 0:case 11:case 14:case 15:if(Zr(t,e),fn(e),a&4){try{Ya(3,e,e.return),ri(3,e)}catch(Ge){At(e,e.return,Ge)}try{Ya(5,e,e.return)}catch(Ge){At(e,e.return,Ge)}}break;case 1:Zr(t,e),fn(e),a&512&&s!==null&&ma(s,s.return);break;case 5:if(Zr(t,e),fn(e),a&512&&s!==null&&ma(s,s.return),e.flags&32){var m=e.stateNode;try{Ue(m,"")}catch(Ge){At(e,e.return,Ge)}}if(a&4&&(m=e.stateNode,m!=null)){var w=e.memoizedProps,L=s!==null?s.memoizedProps:w,V=e.type,te=e.updateQueue;if(e.updateQueue=null,te!==null)try{V==="input"&&w.type==="radio"&&w.name!=null&&re(m,w),pt(V,L);var ve=pt(V,w);for(L=0;L<te.length;L+=2){var Ie=te[L],Oe=te[L+1];Ie==="style"?Ot(m,Oe):Ie==="dangerouslySetInnerHTML"?bt(m,Oe):Ie==="children"?Ue(m,Oe):R(m,Ie,Oe,ve)}switch(V){case"input":$(m,w);break;case"textarea":Me(m,w);break;case"select":var Ce=m._wrapperState.wasMultiple;m._wrapperState.wasMultiple=!!w.multiple;var Be=w.value;Be!=null?le(m,!!w.multiple,Be,!1):Ce!==!!w.multiple&&(w.defaultValue!=null?le(m,!!w.multiple,w.defaultValue,!0):le(m,!!w.multiple,w.multiple?[]:"",!1))}m[Fa]=w}catch(Ge){At(e,e.return,Ge)}}break;case 6:if(Zr(t,e),fn(e),a&4){if(e.stateNode===null)throw Error(o(162));m=e.stateNode,w=e.memoizedProps;try{m.nodeValue=w}catch(Ge){At(e,e.return,Ge)}}break;case 3:if(Zr(t,e),fn(e),a&4&&s!==null&&s.memoizedState.isDehydrated)try{u(t.containerInfo)}catch(Ge){At(e,e.return,Ge)}break;case 4:Zr(t,e),fn(e);break;case 13:Zr(t,e),fn(e),m=e.child,m.flags&8192&&(w=m.memoizedState!==null,m.stateNode.isHidden=w,!w||m.alternate!==null&&m.alternate.memoizedState!==null||(rc=Et())),a&4&&Pd(e);break;case 22:if(Ie=s!==null&&s.memoizedState!==null,e.mode&1?(or=(ve=or)||Ie,Zr(t,e),or=ve):Zr(t,e),fn(e),a&8192){if(ve=e.memoizedState!==null,(e.stateNode.isHidden=ve)&&!Ie&&(e.mode&1)!==0)for(He=e,Ie=e.child;Ie!==null;){for(Oe=He=Ie;He!==null;){switch(Ce=He,Be=Ce.child,Ce.tag){case 0:case 11:case 14:case 15:Ya(4,Ce,Ce.return);break;case 1:ma(Ce,Ce.return);var qe=Ce.stateNode;if(typeof qe.componentWillUnmount=="function"){a=Ce,s=Ce.return;try{t=a,qe.props=t.memoizedProps,qe.state=t.memoizedState,qe.componentWillUnmount()}catch(Ge){At(a,s,Ge)}}break;case 5:ma(Ce,Ce.return);break;case 22:if(Ce.memoizedState!==null){Hd(Oe);continue}}Be!==null?(Be.return=Ce,He=Be):Hd(Oe)}Ie=Ie.sibling}e:for(Ie=null,Oe=e;;){if(Oe.tag===5){if(Ie===null){Ie=Oe;try{m=Oe.stateNode,ve?(w=m.style,typeof w.setProperty=="function"?w.setProperty("display","none","important"):w.display="none"):(V=Oe.stateNode,te=Oe.memoizedProps.style,L=te!=null&&te.hasOwnProperty("display")?te.display:null,V.style.display=it("display",L))}catch(Ge){At(e,e.return,Ge)}}}else if(Oe.tag===6){if(Ie===null)try{Oe.stateNode.nodeValue=ve?"":Oe.memoizedProps}catch(Ge){At(e,e.return,Ge)}}else if((Oe.tag!==22&&Oe.tag!==23||Oe.memoizedState===null||Oe===e)&&Oe.child!==null){Oe.child.return=Oe,Oe=Oe.child;continue}if(Oe===e)break e;for(;Oe.sibling===null;){if(Oe.return===null||Oe.return===e)break e;Ie===Oe&&(Ie=null),Oe=Oe.return}Ie===Oe&&(Ie=null),Oe.sibling.return=Oe.return,Oe=Oe.sibling}}break;case 19:Zr(t,e),fn(e),a&4&&Pd(e);break;case 21:break;default:Zr(t,e),fn(e)}}function fn(e){var t=e.flags;if(t&2){try{e:{for(var s=e.return;s!==null;){if(Md(s)){var a=s;break e}s=s.return}throw Error(o(160))}switch(a.tag){case 5:var m=a.stateNode;a.flags&32&&(Ue(m,""),a.flags&=-33);var w=Ld(e);Xl(e,w,m);break;case 3:case 4:var L=a.stateNode.containerInfo,V=Ld(e);Zl(e,V,L);break;default:throw Error(o(161))}}catch(te){At(e,e.return,te)}e.flags&=-3}t&4096&&(e.flags&=-4097)}function np(e,t,s){He=e,zd(e)}function zd(e,t,s){for(var a=(e.mode&1)!==0;He!==null;){var m=He,w=m.child;if(m.tag===22&&a){var L=m.memoizedState!==null||ti;if(!L){var V=m.alternate,te=V!==null&&V.memoizedState!==null||or;V=ti;var ve=or;if(ti=L,(or=te)&&!ve)for(He=m;He!==null;)L=He,te=L.child,L.tag===22&&L.memoizedState!==null?qd(m):te!==null?(te.return=L,He=te):qd(m);for(;w!==null;)He=w,zd(w),w=w.sibling;He=m,ti=V,or=ve}Bd(e)}else(m.subtreeFlags&8772)!==0&&w!==null?(w.return=m,He=w):Bd(e)}}function Bd(e){for(;He!==null;){var t=He;if((t.flags&8772)!==0){var s=t.alternate;try{if((t.flags&8772)!==0)switch(t.tag){case 0:case 11:case 15:or||ri(5,t);break;case 1:var a=t.stateNode;if(t.flags&4&&!or)if(s===null)a.componentDidMount();else{var m=t.elementType===t.type?s.memoizedProps:Kr(t.type,s.memoizedProps);a.componentDidUpdate(m,s.memoizedState,a.__reactInternalSnapshotBeforeUpdate)}var w=t.updateQueue;w!==null&&Hu(t,w,a);break;case 3:var L=t.updateQueue;if(L!==null){if(s=null,t.child!==null)switch(t.child.tag){case 5:s=t.child.stateNode;break;case 1:s=t.child.stateNode}Hu(t,L,s)}break;case 5:var V=t.stateNode;if(s===null&&t.flags&4){s=V;var te=t.memoizedProps;switch(t.type){case"button":case"input":case"select":case"textarea":te.autoFocus&&s.focus();break;case"img":te.src&&(s.src=te.src)}}break;case 6:break;case 4:break;case 12:break;case 13:if(t.memoizedState===null){var ve=t.alternate;if(ve!==null){var Ie=ve.memoizedState;if(Ie!==null){var Oe=Ie.dehydrated;Oe!==null&&u(Oe)}}}break;case 19:case 17:case 21:case 22:case 23:case 25:break;default:throw Error(o(163))}or||t.flags&512&&Jl(t)}catch(Ce){At(t,t.return,Ce)}}if(t===e){He=null;break}if(s=t.sibling,s!==null){s.return=t.return,He=s;break}He=t.return}}function Hd(e){for(;He!==null;){var t=He;if(t===e){He=null;break}var s=t.sibling;if(s!==null){s.return=t.return,He=s;break}He=t.return}}function qd(e){for(;He!==null;){var t=He;try{switch(t.tag){case 0:case 11:case 15:var s=t.return;try{ri(4,t)}catch(te){At(t,s,te)}break;case 1:var a=t.stateNode;if(typeof a.componentDidMount=="function"){var m=t.return;try{a.componentDidMount()}catch(te){At(t,m,te)}}var w=t.return;try{Jl(t)}catch(te){At(t,w,te)}break;case 5:var L=t.return;try{Jl(t)}catch(te){At(t,L,te)}}}catch(te){At(t,t.return,te)}if(t===e){He=null;break}var V=t.sibling;if(V!==null){V.return=t.return,He=V;break}He=t.return}}var sp=Math.ceil,ni=A.ReactCurrentDispatcher,ec=A.ReactCurrentOwner,Ur=A.ReactCurrentBatchConfig,xt=0,Yt=null,Lt=null,er=0,Ar=0,pa=zn(0),zt=0,Va=null,Ts=0,si=0,tc=0,Ka=null,wr=null,rc=0,ga=1/0,Nn=null,ai=!1,nc=null,Wn=null,oi=!1,Qn=null,ii=0,Ja=0,sc=null,li=-1,ci=0;function fr(){return(xt&6)!==0?Et():li!==-1?li:li=Et()}function Yn(e){return(e.mode&1)===0?1:(xt&2)!==0&&er!==0?er&-er:Bm.transition!==null?(ci===0&&(ci=hs()),ci):(e=gt,e!==0||(e=window.event,e=e===void 0?16:ht(e.type)),e)}function Xr(e,t,s,a){if(50<Ja)throw Ja=0,sc=null,Error(o(185));ms(e,s,a),((xt&2)===0||e!==Yt)&&(e===Yt&&((xt&2)===0&&(si|=s),zt===4&&Vn(e,er)),br(e,a),s===1&&xt===0&&(t.mode&1)===0&&(ga=Et()+500,Fo&&Hn()))}function br(e,t){var s=e.callbackNode;$s(e,t);var a=Tn(e,e===Yt?er:0);if(a===0)s!==null&&Bs(s),e.callbackNode=null,e.callbackPriority=0;else if(t=a&-a,e.callbackPriority!==t){if(s!=null&&Bs(s),t===1)e.tag===0?zm(Gd.bind(null,e)):Du(Gd.bind(null,e)),Lm(function(){(xt&6)===0&&Hn()}),s=null;else{switch(Sa(a)){case 1:s=Hs;break;case 4:s=ls;break;case 16:s=cs;break;case 536870912:s=qs;break;default:s=cs}s=Xd(s,$d.bind(null,e))}e.callbackPriority=t,e.callbackNode=s}}function $d(e,t){if(li=-1,ci=0,(xt&6)!==0)throw Error(o(327));var s=e.callbackNode;if(xa()&&e.callbackNode!==s)return null;var a=Tn(e,e===Yt?er:0);if(a===0)return null;if((a&30)!==0||(a&e.expiredLanes)!==0||t)t=ui(e,a);else{t=a;var m=xt;xt|=2;var w=Qd();(Yt!==e||er!==t)&&(Nn=null,ga=Et()+500,Os(e,t));do try{ip();break}catch(V){Wd(e,V)}while(!0);kl(),ni.current=w,xt=m,Lt!==null?t=0:(Yt=null,er=0,t=zt)}if(t!==0){if(t===2&&(m=An(e),m!==0&&(a=m,t=ac(e,m))),t===1)throw s=Va,Os(e,0),Vn(e,a),br(e,Et()),s;if(t===6)Vn(e,a);else{if(m=e.current.alternate,(a&30)===0&&!ap(m)&&(t=ui(e,a),t===2&&(w=An(e),w!==0&&(a=w,t=ac(e,w))),t===1))throw s=Va,Os(e,0),Vn(e,a),br(e,Et()),s;switch(e.finishedWork=m,e.finishedLanes=a,t){case 0:case 1:throw Error(o(345));case 2:Rs(e,wr,Nn);break;case 3:if(Vn(e,a),(a&130023424)===a&&(t=rc+500-Et(),10<t)){if(Tn(e,0)!==0)break;if(m=e.suspendedLanes,(m&a)!==a){fr(),e.pingedLanes|=e.suspendedLanes&m;break}e.timeoutHandle=dl(Rs.bind(null,e,wr,Nn),t);break}Rs(e,wr,Nn);break;case 4:if(Vn(e,a),(a&4194240)===a)break;for(t=e.eventTimes,m=-1;0<a;){var L=31-Cr(a);w=1<<L,L=t[L],L>m&&(m=L),a&=~w}if(a=m,a=Et()-a,a=(120>a?120:480>a?480:1080>a?1080:1920>a?1920:3e3>a?3e3:4320>a?4320:1960*sp(a/1960))-a,10<a){e.timeoutHandle=dl(Rs.bind(null,e,wr,Nn),a);break}Rs(e,wr,Nn);break;case 5:Rs(e,wr,Nn);break;default:throw Error(o(329))}}}return br(e,Et()),e.callbackNode===s?$d.bind(null,e):null}function ac(e,t){var s=Ka;return e.current.memoizedState.isDehydrated&&(Os(e,t).flags|=256),e=ui(e,t),e!==2&&(t=wr,wr=s,t!==null&&oc(t)),e}function oc(e){wr===null?wr=e:wr.push.apply(wr,e)}function ap(e){for(var t=e;;){if(t.flags&16384){var s=t.updateQueue;if(s!==null&&(s=s.stores,s!==null))for(var a=0;a<s.length;a++){var m=s[a],w=m.getSnapshot;m=m.value;try{if(!Yr(w(),m))return!1}catch{return!1}}}if(s=t.child,t.subtreeFlags&16384&&s!==null)s.return=t,t=s;else{if(t===e)break;for(;t.sibling===null;){if(t.return===null||t.return===e)return!0;t=t.return}t.sibling.return=t.return,t=t.sibling}}return!0}function Vn(e,t){for(t&=~tc,t&=~si,e.suspendedLanes|=t,e.pingedLanes&=~t,e=e.expirationTimes;0<t;){var s=31-Cr(t),a=1<<s;e[s]=-1,t&=~a}}function Gd(e){if((xt&6)!==0)throw Error(o(327));xa();var t=Tn(e,0);if((t&1)===0)return br(e,Et()),null;var s=ui(e,t);if(e.tag!==0&&s===2){var a=An(e);a!==0&&(t=a,s=ac(e,a))}if(s===1)throw s=Va,Os(e,0),Vn(e,t),br(e,Et()),s;if(s===6)throw Error(o(345));return e.finishedWork=e.current.alternate,e.finishedLanes=t,Rs(e,wr,Nn),br(e,Et()),null}function ic(e,t){var s=xt;xt|=1;try{return e(t)}finally{xt=s,xt===0&&(ga=Et()+500,Fo&&Hn())}}function As(e){Qn!==null&&Qn.tag===0&&(xt&6)===0&&xa();var t=xt;xt|=1;var s=Ur.transition,a=gt;try{if(Ur.transition=null,gt=1,e)return e()}finally{gt=a,Ur.transition=s,xt=t,(xt&6)===0&&Hn()}}function lc(){Ar=pa.current,jt(pa)}function Os(e,t){e.finishedWork=null,e.finishedLanes=0;var s=e.timeoutHandle;if(s!==-1&&(e.timeoutHandle=-1,Mm(s)),Lt!==null)for(s=Lt.return;s!==null;){var a=s;switch(xl(a),a.tag){case 1:a=a.type.childContextTypes,a!=null&&Mo();break;case 3:fa(),jt(xr),jt(nr),Dl();break;case 5:Cl(a);break;case 4:fa();break;case 13:jt(It);break;case 19:jt(It);break;case 10:Sl(a.type._context);break;case 22:case 23:lc()}s=s.return}if(Yt=e,Lt=e=Kn(e.current,null),er=Ar=t,zt=0,Va=null,tc=si=Ts=0,wr=Ka=null,Cs!==null){for(t=0;t<Cs.length;t++)if(s=Cs[t],a=s.interleaved,a!==null){s.interleaved=null;var m=a.next,w=s.pending;if(w!==null){var L=w.next;w.next=m,a.next=L}s.pending=a}Cs=null}return e}function Wd(e,t){do{var s=Lt;try{if(kl(),Qo.current=Jo,Yo){for(var a=Dt.memoizedState;a!==null;){var m=a.queue;m!==null&&(m.pending=null),a=a.next}Yo=!1}if(Ds=0,Qt=Ut=Dt=null,qa=!1,$a=0,ec.current=null,s===null||s.return===null){zt=1,Va=t,Lt=null;break}e:{var w=e,L=s.return,V=s,te=t;if(t=er,V.flags|=32768,te!==null&&typeof te=="object"&&typeof te.then=="function"){var ve=te,Ie=V,Oe=Ie.tag;if((Ie.mode&1)===0&&(Oe===0||Oe===11||Oe===15)){var Ce=Ie.alternate;Ce?(Ie.updateQueue=Ce.updateQueue,Ie.memoizedState=Ce.memoizedState,Ie.lanes=Ce.lanes):(Ie.updateQueue=null,Ie.memoizedState=null)}var Be=xd(L);if(Be!==null){Be.flags&=-257,yd(Be,L,V,w,t),Be.mode&1&&gd(w,ve,t),t=Be,te=ve;var qe=t.updateQueue;if(qe===null){var Ge=new Set;Ge.add(te),t.updateQueue=Ge}else qe.add(te);break e}else{if((t&1)===0){gd(w,ve,t),cc();break e}te=Error(o(426))}}else if(_t&&V.mode&1){var Rt=xd(L);if(Rt!==null){(Rt.flags&65536)===0&&(Rt.flags|=256),yd(Rt,L,V,w,t),wl(ha(te,V));break e}}w=te=ha(te,V),zt!==4&&(zt=2),Ka===null?Ka=[w]:Ka.push(w),w=L;do{switch(w.tag){case 3:w.flags|=65536,t&=-t,w.lanes|=t;var me=md(w,te,t);Bu(w,me);break e;case 1:V=te;var ae=w.type,xe=w.stateNode;if((w.flags&128)===0&&(typeof ae.getDerivedStateFromError=="function"||xe!==null&&typeof xe.componentDidCatch=="function"&&(Wn===null||!Wn.has(xe)))){w.flags|=65536,t&=-t,w.lanes|=t;var Le=pd(w,V,t);Bu(w,Le);break e}}w=w.return}while(w!==null)}Vd(s)}catch(Qe){t=Qe,Lt===s&&s!==null&&(Lt=s=s.return);continue}break}while(!0)}function Qd(){var e=ni.current;return ni.current=Jo,e===null?Jo:e}function cc(){(zt===0||zt===3||zt===2)&&(zt=4),Yt===null||(Ts&268435455)===0&&(si&268435455)===0||Vn(Yt,er)}function ui(e,t){var s=xt;xt|=2;var a=Qd();(Yt!==e||er!==t)&&(Nn=null,Os(e,t));do try{op();break}catch(m){Wd(e,m)}while(!0);if(kl(),xt=s,ni.current=a,Lt!==null)throw Error(o(261));return Yt=null,er=0,zt}function op(){for(;Lt!==null;)Yd(Lt)}function ip(){for(;Lt!==null&&!ho();)Yd(Lt)}function Yd(e){var t=Zd(e.alternate,e,Ar);e.memoizedProps=e.pendingProps,t===null?Vd(e):Lt=t,ec.current=null}function Vd(e){var t=e;do{var s=t.alternate;if(e=t.return,(t.flags&32768)===0){if(s=Xm(s,t,Ar),s!==null){Lt=s;return}}else{if(s=ep(s,t),s!==null){s.flags&=32767,Lt=s;return}if(e!==null)e.flags|=32768,e.subtreeFlags=0,e.deletions=null;else{zt=6,Lt=null;return}}if(t=t.sibling,t!==null){Lt=t;return}Lt=t=e}while(t!==null);zt===0&&(zt=5)}function Rs(e,t,s){var a=gt,m=Ur.transition;try{Ur.transition=null,gt=1,lp(e,t,s,a)}finally{Ur.transition=m,gt=a}return null}function lp(e,t,s,a){do xa();while(Qn!==null);if((xt&6)!==0)throw Error(o(327));s=e.finishedWork;var m=e.finishedLanes;if(s===null)return null;if(e.finishedWork=null,e.finishedLanes=0,s===e.current)throw Error(o(177));e.callbackNode=null,e.callbackPriority=0;var w=s.lanes|s.childLanes;if(Li(e,w),e===Yt&&(Lt=Yt=null,er=0),(s.subtreeFlags&2064)===0&&(s.flags&2064)===0||oi||(oi=!0,Xd(cs,function(){return xa(),null})),w=(s.flags&15990)!==0,(s.subtreeFlags&15990)!==0||w){w=Ur.transition,Ur.transition=null;var L=gt;gt=1;var V=xt;xt|=4,ec.current=null,rp(e,s),Ud(s,e),Cm(cl),D=!!ll,cl=ll=null,e.current=s,np(s),mo(),xt=V,gt=L,Ur.transition=w}else e.current=s;if(oi&&(oi=!1,Qn=e,ii=m),w=e.pendingLanes,w===0&&(Wn=null),po(s.stateNode),br(e,Et()),t!==null)for(a=e.onRecoverableError,s=0;s<t.length;s++)m=t[s],a(m.value,{componentStack:m.stack,digest:m.digest});if(ai)throw ai=!1,e=nc,nc=null,e;return(ii&1)!==0&&e.tag!==0&&xa(),w=e.pendingLanes,(w&1)!==0?e===sc?Ja++:(Ja=0,sc=e):Ja=0,Hn(),null}function xa(){if(Qn!==null){var e=Sa(ii),t=Ur.transition,s=gt;try{if(Ur.transition=null,gt=16>e?16:e,Qn===null)var a=!1;else{if(e=Qn,Qn=null,ii=0,(xt&6)!==0)throw Error(o(331));var m=xt;for(xt|=4,He=e.current;He!==null;){var w=He,L=w.child;if((He.flags&16)!==0){var V=w.deletions;if(V!==null){for(var te=0;te<V.length;te++){var ve=V[te];for(He=ve;He!==null;){var Ie=He;switch(Ie.tag){case 0:case 11:case 15:Ya(8,Ie,w)}var Oe=Ie.child;if(Oe!==null)Oe.return=Ie,He=Oe;else for(;He!==null;){Ie=He;var Ce=Ie.sibling,Be=Ie.return;if(Rd(Ie),Ie===ve){He=null;break}if(Ce!==null){Ce.return=Be,He=Ce;break}He=Be}}}var qe=w.alternate;if(qe!==null){var Ge=qe.child;if(Ge!==null){qe.child=null;do{var Rt=Ge.sibling;Ge.sibling=null,Ge=Rt}while(Ge!==null)}}He=w}}if((w.subtreeFlags&2064)!==0&&L!==null)L.return=w,He=L;else e:for(;He!==null;){if(w=He,(w.flags&2048)!==0)switch(w.tag){case 0:case 11:case 15:Ya(9,w,w.return)}var me=w.sibling;if(me!==null){me.return=w.return,He=me;break e}He=w.return}}var ae=e.current;for(He=ae;He!==null;){L=He;var xe=L.child;if((L.subtreeFlags&2064)!==0&&xe!==null)xe.return=L,He=xe;else e:for(L=ae;He!==null;){if(V=He,(V.flags&2048)!==0)try{switch(V.tag){case 0:case 11:case 15:ri(9,V)}}catch(Qe){At(V,V.return,Qe)}if(V===L){He=null;break e}var Le=V.sibling;if(Le!==null){Le.return=V.return,He=Le;break e}He=V.return}}if(xt=m,Hn(),_r&&typeof _r.onPostCommitFiberRoot=="function")try{_r.onPostCommitFiberRoot(us,e)}catch{}a=!0}return a}finally{gt=s,Ur.transition=t}}return!1}function Kd(e,t,s){t=ha(s,t),t=md(e,t,1),e=$n(e,t,1),t=fr(),e!==null&&(ms(e,1,t),br(e,t))}function At(e,t,s){if(e.tag===3)Kd(e,e,s);else for(;t!==null;){if(t.tag===3){Kd(t,e,s);break}else if(t.tag===1){var a=t.stateNode;if(typeof t.type.getDerivedStateFromError=="function"||typeof a.componentDidCatch=="function"&&(Wn===null||!Wn.has(a))){e=ha(s,e),e=pd(t,e,1),t=$n(t,e,1),e=fr(),t!==null&&(ms(t,1,e),br(t,e));break}}t=t.return}}function cp(e,t,s){var a=e.pingCache;a!==null&&a.delete(t),t=fr(),e.pingedLanes|=e.suspendedLanes&s,Yt===e&&(er&s)===s&&(zt===4||zt===3&&(er&130023424)===er&&500>Et()-rc?Os(e,0):tc|=s),br(e,t)}function Jd(e,t){t===0&&((e.mode&1)===0?t=1:(t=vt,vt<<=1,(vt&130023424)===0&&(vt=4194304)));var s=fr();e=Sn(e,t),e!==null&&(ms(e,t,s),br(e,s))}function up(e){var t=e.memoizedState,s=0;t!==null&&(s=t.retryLane),Jd(e,s)}function dp(e,t){var s=0;switch(e.tag){case 13:var a=e.stateNode,m=e.memoizedState;m!==null&&(s=m.retryLane);break;case 19:a=e.stateNode;break;default:throw Error(o(314))}a!==null&&a.delete(t),Jd(e,s)}var Zd;Zd=function(e,t,s){if(e!==null)if(e.memoizedProps!==t.pendingProps||xr.current)vr=!0;else{if((e.lanes&s)===0&&(t.flags&128)===0)return vr=!1,Zm(e,t,s);vr=(e.flags&131072)!==0}else vr=!1,_t&&(t.flags&1048576)!==0&&Tu(t,Uo,t.index);switch(t.lanes=0,t.tag){case 2:var a=t.type;ei(e,t),e=t.pendingProps;var m=aa(t,nr.current);da(t,s),m=Ol(null,t,a,e,m,s);var w=Rl();return t.flags|=1,typeof m=="object"&&m!==null&&typeof m.render=="function"&&m.$$typeof===void 0?(t.tag=1,t.memoizedState=null,t.updateQueue=null,yr(a)?(w=!0,Lo(t)):w=!1,t.memoizedState=m.state!==null&&m.state!==void 0?m.state:null,Nl(t),m.updater=Zo,t.stateNode=m,m._reactInternals=t,zl(t,a,e,s),t=$l(null,t,a,!0,w,s)):(t.tag=0,_t&&w&&gl(t),dr(null,t,m,s),t=t.child),t;case 16:a=t.elementType;e:{switch(ei(e,t),e=t.pendingProps,m=a._init,a=m(a._payload),t.type=a,m=t.tag=hp(a),e=Kr(a,e),m){case 0:t=ql(null,t,a,e,s);break e;case 1:t=jd(null,t,a,e,s);break e;case 11:t=vd(null,t,a,e,s);break e;case 14:t=wd(null,t,a,Kr(a.type,e),s);break e}throw Error(o(306,a,""))}return t;case 0:return a=t.type,m=t.pendingProps,m=t.elementType===a?m:Kr(a,m),ql(e,t,a,m,s);case 1:return a=t.type,m=t.pendingProps,m=t.elementType===a?m:Kr(a,m),jd(e,t,a,m,s);case 3:e:{if(Ed(t),e===null)throw Error(o(387));a=t.pendingProps,w=t.memoizedState,m=w.element,zu(e,t),Go(t,a,null,s);var L=t.memoizedState;if(a=L.element,w.isDehydrated)if(w={element:a,isDehydrated:!1,cache:L.cache,pendingSuspenseBoundaries:L.pendingSuspenseBoundaries,transitions:L.transitions},t.updateQueue.baseState=w,t.memoizedState=w,t.flags&256){m=ha(Error(o(423)),t),t=Nd(e,t,a,s,m);break e}else if(a!==m){m=ha(Error(o(424)),t),t=Nd(e,t,a,s,m);break e}else for(Tr=Un(t.stateNode.containerInfo.firstChild),Dr=t,_t=!0,Vr=null,s=Pu(t,null,a,s),t.child=s;s;)s.flags=s.flags&-3|4096,s=s.sibling;else{if(la(),a===m){t=En(e,t,s);break e}dr(e,t,a,s)}t=t.child}return t;case 5:return qu(t),e===null&&vl(t),a=t.type,m=t.pendingProps,w=e!==null?e.memoizedProps:null,L=m.children,ul(a,m)?L=null:w!==null&&ul(a,w)&&(t.flags|=32),Sd(e,t),dr(e,t,L,s),t.child;case 6:return e===null&&vl(t),null;case 13:return _d(e,t,s);case 4:return _l(t,t.stateNode.containerInfo),a=t.pendingProps,e===null?t.child=ca(t,null,a,s):dr(e,t,a,s),t.child;case 11:return a=t.type,m=t.pendingProps,m=t.elementType===a?m:Kr(a,m),vd(e,t,a,m,s);case 7:return dr(e,t,t.pendingProps,s),t.child;case 8:return dr(e,t,t.pendingProps.children,s),t.child;case 12:return dr(e,t,t.pendingProps.children,s),t.child;case 10:e:{if(a=t.type._context,m=t.pendingProps,w=t.memoizedProps,L=m.value,kt(Ho,a._currentValue),a._currentValue=L,w!==null)if(Yr(w.value,L)){if(w.children===m.children&&!xr.current){t=En(e,t,s);break e}}else for(w=t.child,w!==null&&(w.return=t);w!==null;){var V=w.dependencies;if(V!==null){L=w.child;for(var te=V.firstContext;te!==null;){if(te.context===a){if(w.tag===1){te=jn(-1,s&-s),te.tag=2;var ve=w.updateQueue;if(ve!==null){ve=ve.shared;var Ie=ve.pending;Ie===null?te.next=te:(te.next=Ie.next,Ie.next=te),ve.pending=te}}w.lanes|=s,te=w.alternate,te!==null&&(te.lanes|=s),jl(w.return,s,t),V.lanes|=s;break}te=te.next}}else if(w.tag===10)L=w.type===t.type?null:w.child;else if(w.tag===18){if(L=w.return,L===null)throw Error(o(341));L.lanes|=s,V=L.alternate,V!==null&&(V.lanes|=s),jl(L,s,t),L=w.sibling}else L=w.child;if(L!==null)L.return=w;else for(L=w;L!==null;){if(L===t){L=null;break}if(w=L.sibling,w!==null){w.return=L.return,L=w;break}L=L.return}w=L}dr(e,t,m.children,s),t=t.child}return t;case 9:return m=t.type,a=t.pendingProps.children,da(t,s),m=Fr(m),a=a(m),t.flags|=1,dr(e,t,a,s),t.child;case 14:return a=t.type,m=Kr(a,t.pendingProps),m=Kr(a.type,m),wd(e,t,a,m,s);case 15:return bd(e,t,t.type,t.pendingProps,s);case 17:return a=t.type,m=t.pendingProps,m=t.elementType===a?m:Kr(a,m),ei(e,t),t.tag=1,yr(a)?(e=!0,Lo(t)):e=!1,da(t,s),fd(t,a,m),zl(t,a,m,s),$l(null,t,a,!0,e,s);case 19:return Id(e,t,s);case 22:return kd(e,t,s)}throw Error(o(156,t.tag))};function Xd(e,t){return os(e,t)}function fp(e,t,s,a){this.tag=e,this.key=s,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.ref=null,this.pendingProps=t,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=a,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function zr(e,t,s,a){return new fp(e,t,s,a)}function uc(e){return e=e.prototype,!(!e||!e.isReactComponent)}function hp(e){if(typeof e=="function")return uc(e)?1:0;if(e!=null){if(e=e.$$typeof,e===q)return 11;if(e===Z)return 14}return 2}function Kn(e,t){var s=e.alternate;return s===null?(s=zr(e.tag,t,e.key,e.mode),s.elementType=e.elementType,s.type=e.type,s.stateNode=e.stateNode,s.alternate=e,e.alternate=s):(s.pendingProps=t,s.type=e.type,s.flags=0,s.subtreeFlags=0,s.deletions=null),s.flags=e.flags&14680064,s.childLanes=e.childLanes,s.lanes=e.lanes,s.child=e.child,s.memoizedProps=e.memoizedProps,s.memoizedState=e.memoizedState,s.updateQueue=e.updateQueue,t=e.dependencies,s.dependencies=t===null?null:{lanes:t.lanes,firstContext:t.firstContext},s.sibling=e.sibling,s.index=e.index,s.ref=e.ref,s}function di(e,t,s,a,m,w){var L=2;if(a=e,typeof e=="function")uc(e)&&(L=1);else if(typeof e=="string")L=5;else e:switch(e){case H:return Ms(s.children,m,w,t);case K:L=8,m|=8;break;case W:return e=zr(12,s,t,m|2),e.elementType=W,e.lanes=w,e;case Q:return e=zr(13,s,t,m),e.elementType=Q,e.lanes=w,e;case N:return e=zr(19,s,t,m),e.elementType=N,e.lanes=w,e;case fe:return fi(s,m,w,t);default:if(typeof e=="object"&&e!==null)switch(e.$$typeof){case B:L=10;break e;case Y:L=9;break e;case q:L=11;break e;case Z:L=14;break e;case oe:L=16,a=null;break e}throw Error(o(130,e==null?e:typeof e,""))}return t=zr(L,s,t,m),t.elementType=e,t.type=a,t.lanes=w,t}function Ms(e,t,s,a){return e=zr(7,e,a,t),e.lanes=s,e}function fi(e,t,s,a){return e=zr(22,e,a,t),e.elementType=fe,e.lanes=s,e.stateNode={isHidden:!1},e}function dc(e,t,s){return e=zr(6,e,null,t),e.lanes=s,e}function fc(e,t,s){return t=zr(4,e.children!==null?e.children:[],e.key,t),t.lanes=s,t.stateNode={containerInfo:e.containerInfo,pendingChildren:null,implementation:e.implementation},t}function mp(e,t,s,a,m){this.tag=t,this.containerInfo=e,this.finishedWork=this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.pendingContext=this.context=null,this.callbackPriority=0,this.eventTimes=yn(0),this.expirationTimes=yn(-1),this.entangledLanes=this.finishedLanes=this.mutableReadLanes=this.expiredLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=yn(0),this.identifierPrefix=a,this.onRecoverableError=m,this.mutableSourceEagerHydrationData=null}function hc(e,t,s,a,m,w,L,V,te){return e=new mp(e,t,s,V,te),t===1?(t=1,w===!0&&(t|=8)):t=0,w=zr(3,null,null,t),e.current=w,w.stateNode=e,w.memoizedState={element:a,isDehydrated:s,cache:null,transitions:null,pendingSuspenseBoundaries:null},Nl(w),e}function pp(e,t,s){var a=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:P,key:a==null?null:""+a,children:e,containerInfo:t,implementation:s}}function ef(e){if(!e)return Bn;e=e._reactInternals;e:{if(sn(e)!==e||e.tag!==1)throw Error(o(170));var t=e;do{switch(t.tag){case 3:t=t.stateNode.context;break e;case 1:if(yr(t.type)){t=t.stateNode.__reactInternalMemoizedMergedChildContext;break e}}t=t.return}while(t!==null);throw Error(o(171))}if(e.tag===1){var s=e.type;if(yr(s))return Cu(e,s,t)}return t}function tf(e,t,s,a,m,w,L,V,te){return e=hc(s,a,!0,e,m,w,L,V,te),e.context=ef(null),s=e.current,a=fr(),m=Yn(s),w=jn(a,m),w.callback=t??null,$n(s,w,m),e.current.lanes=m,ms(e,m,a),br(e,a),e}function hi(e,t,s,a){var m=t.current,w=fr(),L=Yn(m);return s=ef(s),t.context===null?t.context=s:t.pendingContext=s,t=jn(w,L),t.payload={element:e},a=a===void 0?null:a,a!==null&&(t.callback=a),e=$n(m,t,L),e!==null&&(Xr(e,m,L,w),$o(e,m,L)),L}function mi(e){if(e=e.current,!e.child)return null;switch(e.child.tag){case 5:return e.child.stateNode;default:return e.child.stateNode}}function rf(e,t){if(e=e.memoizedState,e!==null&&e.dehydrated!==null){var s=e.retryLane;e.retryLane=s!==0&&s<t?s:t}}function mc(e,t){rf(e,t),(e=e.alternate)&&rf(e,t)}function gp(){return null}var nf=typeof reportError=="function"?reportError:function(e){console.error(e)};function pc(e){this._internalRoot=e}pi.prototype.render=pc.prototype.render=function(e){var t=this._internalRoot;if(t===null)throw Error(o(409));hi(e,t,null,null)},pi.prototype.unmount=pc.prototype.unmount=function(){var e=this._internalRoot;if(e!==null){this._internalRoot=null;var t=e.containerInfo;As(function(){hi(null,e,null,null)}),t[vn]=null}};function pi(e){this._internalRoot=e}pi.prototype.unstable_scheduleHydration=function(e){if(e){var t=gs();e={blockedOn:null,target:e,priority:t};for(var s=0;s<$e.length&&t!==0&&t<$e[s].priority;s++);$e.splice(s,0,e),s===0&&Mn(e)}};function gc(e){return!(!e||e.nodeType!==1&&e.nodeType!==9&&e.nodeType!==11)}function gi(e){return!(!e||e.nodeType!==1&&e.nodeType!==9&&e.nodeType!==11&&(e.nodeType!==8||e.nodeValue!==" react-mount-point-unstable "))}function sf(){}function xp(e,t,s,a,m){if(m){if(typeof a=="function"){var w=a;a=function(){var ve=mi(L);w.call(ve)}}var L=tf(t,a,e,0,null,!1,!1,"",sf);return e._reactRootContainer=L,e[vn]=L.current,Ma(e.nodeType===8?e.parentNode:e),As(),L}for(;m=e.lastChild;)e.removeChild(m);if(typeof a=="function"){var V=a;a=function(){var ve=mi(te);V.call(ve)}}var te=hc(e,0,!1,null,null,!1,!1,"",sf);return e._reactRootContainer=te,e[vn]=te.current,Ma(e.nodeType===8?e.parentNode:e),As(function(){hi(t,te,s,a)}),te}function xi(e,t,s,a,m){var w=s._reactRootContainer;if(w){var L=w;if(typeof m=="function"){var V=m;m=function(){var te=mi(L);V.call(te)}}hi(t,L,e,m)}else L=xp(s,t,e,m,a);return mi(L)}Ws=function(e){switch(e.tag){case 3:var t=e.stateNode;if(t.current.memoizedState.isDehydrated){var s=Gr(t.pendingLanes);s!==0&&(Gs(t,s|1),br(t,Et()),(xt&6)===0&&(ga=Et()+500,Hn()))}break;case 13:As(function(){var a=Sn(e,1);if(a!==null){var m=fr();Xr(a,e,1,m)}}),mc(e,1)}},ps=function(e){if(e.tag===13){var t=Sn(e,134217728);if(t!==null){var s=fr();Xr(t,e,134217728,s)}mc(e,134217728)}},yo=function(e){if(e.tag===13){var t=Yn(e),s=Sn(e,t);if(s!==null){var a=fr();Xr(s,e,t,a)}mc(e,t)}},gs=function(){return gt},xs=function(e,t){var s=gt;try{return gt=e,t()}finally{gt=s}},cr=function(e,t,s){switch(t){case"input":if($(e,s),t=s.name,s.type==="radio"&&t!=null){for(s=e;s.parentNode;)s=s.parentNode;for(s=s.querySelectorAll("input[name="+JSON.stringify(""+t)+'][type="radio"]'),t=0;t<s.length;t++){var a=s[t];if(a!==e&&a.form===e.form){var m=Ro(a);if(!m)throw Error(o(90));Ye(a),$(a,m)}}}break;case"textarea":Me(e,s);break;case"select":t=s.value,t!=null&&le(e,!!s.multiple,t,!1)}},Fe=ic,Fs=As;var yp={usingClientEntryPoint:!1,Events:[Pa,na,Ro,qr,ka,ic]},Za={findFiberByHostInstance:js,bundleType:0,version:"18.3.1",rendererPackageName:"react-dom"},vp={bundleType:Za.bundleType,version:Za.version,rendererPackageName:Za.rendererPackageName,rendererConfig:Za.rendererConfig,overrideHookState:null,overrideHookStateDeletePath:null,overrideHookStateRenamePath:null,overrideProps:null,overridePropsDeletePath:null,overridePropsRenamePath:null,setErrorHandler:null,setSuspenseHandler:null,scheduleUpdate:null,currentDispatcherRef:A.ReactCurrentDispatcher,findHostInstanceByFiber:function(e){return e=as(e),e===null?null:e.stateNode},findFiberByHostInstance:Za.findFiberByHostInstance||gp,findHostInstancesForRefresh:null,scheduleRefresh:null,scheduleRoot:null,setRefreshHandler:null,getCurrentFiber:null,reconcilerVersion:"18.3.1-next-f1338f8080-20240426"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var yi=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!yi.isDisabled&&yi.supportsFiber)try{us=yi.inject(vp),_r=yi}catch{}}return kr.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=yp,kr.createPortal=function(e,t){var s=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!gc(t))throw Error(o(200));return pp(e,t,null,s)},kr.createRoot=function(e,t){if(!gc(e))throw Error(o(299));var s=!1,a="",m=nf;return t!=null&&(t.unstable_strictMode===!0&&(s=!0),t.identifierPrefix!==void 0&&(a=t.identifierPrefix),t.onRecoverableError!==void 0&&(m=t.onRecoverableError)),t=hc(e,1,!1,null,null,s,!1,a,m),e[vn]=t.current,Ma(e.nodeType===8?e.parentNode:e),new pc(t)},kr.findDOMNode=function(e){if(e==null)return null;if(e.nodeType===1)return e;var t=e._reactInternals;if(t===void 0)throw typeof e.render=="function"?Error(o(188)):(e=Object.keys(e).join(","),Error(o(268,e)));return e=as(t),e=e===null?null:e.stateNode,e},kr.flushSync=function(e){return As(e)},kr.hydrate=function(e,t,s){if(!gi(t))throw Error(o(200));return xi(null,e,t,!0,s)},kr.hydrateRoot=function(e,t,s){if(!gc(e))throw Error(o(405));var a=s!=null&&s.hydratedSources||null,m=!1,w="",L=nf;if(s!=null&&(s.unstable_strictMode===!0&&(m=!0),s.identifierPrefix!==void 0&&(w=s.identifierPrefix),s.onRecoverableError!==void 0&&(L=s.onRecoverableError)),t=tf(t,null,e,1,s??null,m,!1,w,L),e[vn]=t.current,Ma(e),a)for(e=0;e<a.length;e++)s=a[e],m=s._getVersion,m=m(s._source),t.mutableSourceEagerHydrationData==null?t.mutableSourceEagerHydrationData=[s,m]:t.mutableSourceEagerHydrationData.push(s,m);return new pi(t)},kr.render=function(e,t,s){if(!gi(t))throw Error(o(200));return xi(null,e,t,!1,s)},kr.unmountComponentAtNode=function(e){if(!gi(e))throw Error(o(40));return e._reactRootContainer?(As(function(){xi(null,null,e,!1,function(){e._reactRootContainer=null,e[vn]=null})}),!0):!1},kr.unstable_batchedUpdates=ic,kr.unstable_renderSubtreeIntoContainer=function(e,t,s,a){if(!gi(s))throw Error(o(200));if(e==null||e._reactInternals===void 0)throw Error(o(38));return xi(e,t,s,!1,a)},kr.version="18.3.1-next-f1338f8080-20240426",kr}var hf;function Cp(){if(hf)return vc.exports;hf=1;function n(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(n)}catch(i){console.error(i)}}return n(),vc.exports=_p(),vc.exports}var mf;function Ip(){if(mf)return wi;mf=1;var n=Cp();return wi.createRoot=n.createRoot,wi.hydrateRoot=n.hydrateRoot,wi}var Dp=Ip();const Tp=oo(Dp);var De=(n=>(n.Flashcard="flashcard",n.Quiz="quiz",n.Learning="learning",n))(De||{}),lt=(n=>(n[n.Again=1]="Again",n[n.Hard=2]="Hard",n[n.Good=3]="Good",n[n.Easy=4]="Easy",n))(lt||{}),Or=(n=>(n.CREATE_DECK="CREATE_DECK",n.RENAME_DECK="RENAME_DECK",n.MOVE_DECK_TO_FOLDER="MOVE_DECK_TO_FOLDER",n.DELETE_DECK="DELETE_DECK",n.CREATE_FOLDER="CREATE_FOLDER",n.RENAME_FOLDER="RENAME_FOLDER",n.DELETE_FOLDER="DELETE_FOLDER",n.EXPAND_SERIES_ADD_LEVELS="EXPAND_SERIES_ADD_LEVELS",n.EXPAND_SERIES_ADD_DECKS="EXPAND_SERIES_ADD_DECKS",n.GENERATE_QUESTIONS_FOR_DECK="GENERATE_QUESTIONS_FOR_DECK",n.NO_ACTION="NO_ACTION",n))(Or||{});const Ap="cogniflow-sync";let kc=null;const Nh=()=>(kc||(kc=new BroadcastChannel(Ap)),kc),tn=()=>{Nh().postMessage({type:"data-changed"})},Op=n=>{const i=Nh(),o=()=>{n()};return i.addEventListener("message",o),()=>{i.removeEventListener("message",o)}},_h="Europe/Stockholm",Rp=()=>new Date().toLocaleDateString("sv-SE",{timeZone:_h}),$c=()=>new Date().toLocaleString("sv-SE",{timeZone:_h,year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit",second:"2-digit",hour12:!1}).replace(/ /g,"_").replace(/:/g,"-"),Mp=n=>n?typeof n=="number"?new Date(n*1e3):/^\d+(\.\d+)?$/.test(n)?new Date(parseFloat(n)*1e3):new Date(String(n).replace(" ","T")):new Date(NaN),ro="CogniFlowDB",Sc=8,Sr="decks",lr="folders",ir="deckSeries",Mt="sessions",Ft="reviews",en="ai_chat",mr="seriesProgress";let Br=null,bi=!1,jc=!1;function mt(){return bi?Promise.reject(new Error("Catastrophic error: Could not open or delete the database. Please clear your site data manually.")):Br||(Br=new Promise((n,i)=>{if(console.log(`[DB] Initializing IndexedDB: ${ro} v${Sc}...`),!window.indexedDB){const p="IndexedDB is not supported by this browser.";return console.error(`[DB] ${p}`),i(new Error(p))}const o=indexedDB.open(ro,Sc);o.onblocked=p=>{const d="Database upgrade is required, but it is blocked by another open tab of this application. Please close all other tabs and reload.";console.error("[DB] IndexedDB open request blocked. Please close other tabs with this app open.",p),i(new Error(d))},o.onerror=()=>{console.error("[DB] IndexedDB error during open:",o.error);const p="Catastrophic error: Could not open or delete the database. Please clear your site data manually.";if(jc)return console.error("[DB] Self-heal already attempted. Failing permanently."),bi=!0,Br=null,i(new Error(p));jc=!0,console.warn("[DB] Attempting to self-heal by deleting the database and reloading."),Br=null;const d=indexedDB.deleteDatabase(ro);d.onsuccess=()=>{console.log("[DB] Database deleted successfully. Reloading the page to re-initialize."),window.location.reload()},d.onerror=c=>{console.error(`[DB] ${p}`,c),bi=!0,Br=null,i(new Error(p))},d.onblocked=c=>{const l="Database deletion is blocked. Please close all other tabs of this app and try again.";console.error(`[DB] ${l}`,c),bi=!0,Br=null,i(new Error(l))}},o.onsuccess=()=>{const p=o.result;console.log("[DB] IndexedDB connection successful."),jc=!1,p.onclose=()=>{Br=null,console.warn("[DB] Database connection closed.")},n(p)},o.onupgradeneeded=p=>{var l;const d=p.target.result,c=p.target.transaction;if(console.log(`[DB] Upgrading database from version ${p.oldVersion} to ${Sc}`),!c){console.error("[DB] Upgrade transaction is not available, aborting upgrade."),p.target&&((l=p.target.transaction)==null||l.abort());return}switch(p.oldVersion){case 0:console.log("[DB] v1: Creating initial object stores (decks, folders)."),d.createObjectStore(Sr,{keyPath:"id"}),d.createObjectStore(lr,{keyPath:"id"});case 1:case 2:console.log(`[DB] v3: Creating object store: ${ir}`),d.objectStoreNames.contains(ir)||d.createObjectStore(ir,{keyPath:"id"});case 3:console.log(`[DB] v4: Creating object store: ${Mt}`),d.objectStoreNames.contains(Mt)||d.createObjectStore(Mt,{keyPath:"id"});case 4:console.log(`[DB] v5: Creating object store: ${Ft}`),d.objectStoreNames.contains(Ft)||d.createObjectStore(Ft,{keyPath:"id",autoIncrement:!0}).createIndex("timestamp","timestamp",{unique:!1});case 5:console.log("[DB] v6: Adding deckId index to reviews store.");const f=c.objectStore(Ft);f.indexNames.contains("deckId")||f.createIndex("deckId","deckId",{unique:!1});case 6:console.log(`[DB] v7: Creating object store: ${en}`),d.objectStoreNames.contains(en)||d.createObjectStore(en,{keyPath:"id"});case 7:console.log(`[DB] v8: Creating object store: ${mr}`),d.objectStoreNames.contains(mr)||d.createObjectStore(mr,{keyPath:"id"});default:console.log("[DB] Database upgrade sequence complete.")}}}),Br)}async function Ch(){const n=await mt();return new Promise((i,o)=>{const c=n.transaction(Sr,"readonly").objectStore(Sr).getAll();c.onerror=()=>{console.error("DB Error fetching all decks:",c.error),o(new Error("Error fetching decks from the database."))},c.onsuccess=()=>i(c.result)})}async function Di(n){if(n.length===0)return;const i=await mt();return new Promise((o,p)=>{const d=i.transaction(Sr,"readwrite"),c=d.objectStore(Sr);d.oncomplete=()=>{tn(),o()},d.onerror=()=>{console.error("Transaction error adding/updating decks",d.error),p(new Error("Transaction error adding/updating decks."))},n.forEach(l=>{const f=c.put(l);f.onerror=()=>{console.error(`Error putting deck ${l.name}`,f.error)}})})}async function Gc(n){await Di(n)}async function Wc(n){const i=await mt();return new Promise((o,p)=>{const d=i.transaction(Sr,"readwrite");d.oncomplete=()=>{tn(),o()},d.onerror=()=>{console.error("Transaction error deleting deck",d.error),p(new Error("Transaction error deleting deck."))},d.objectStore(Sr).delete(n)})}async function Ih(n){const i=await mt();return new Promise((o,p)=>{const d=i.transaction(Sr,"readwrite");d.oncomplete=()=>{tn(),o()},d.onerror=()=>{console.error("Transaction error updating deck",d.error),p(new Error("Transaction error updating deck."))},d.objectStore(Sr).put(n)})}async function Dh(){const n=await mt();return new Promise((i,o)=>{const c=n.transaction(lr,"readonly").objectStore(lr).getAll();c.onerror=()=>{console.error("DB Error fetching all folders:",c.error),o(new Error("Error fetching folders from the database."))},c.onsuccess=()=>i(c.result)})}async function Th(n){const i=await mt();return new Promise((o,p)=>{const d=i.transaction(lr,"readwrite");d.oncomplete=()=>{tn(),o()},d.onerror=()=>{console.error("Transaction error adding folder",d.error),p(new Error("Transaction error adding folder."))},d.objectStore(lr).add(n)})}async function Lp(n){if(n.length===0)return;const i=await mt();return new Promise((o,p)=>{const d=i.transaction(lr,"readwrite");d.oncomplete=()=>{tn(),o()},d.onerror=()=>{console.error("Transaction error adding/updating folders",d.error),p(new Error("Transaction error adding/updating folders."))};const c=d.objectStore(lr);n.forEach(l=>{const f=c.put(l);f.onerror=()=>{console.error(`Error putting folder ${l.name}`,f.error)}})})}async function Ah(n){const i=await mt();return new Promise((o,p)=>{const d=i.transaction(lr,"readwrite");d.oncomplete=()=>{tn(),o()},d.onerror=()=>{console.error("Transaction error updating folder",d.error),p(new Error("Transaction error updating folder."))},d.objectStore(lr).put(n)})}async function Oh(n){const i=await mt();return new Promise((o,p)=>{const d=i.transaction(lr,"readwrite");d.oncomplete=()=>{tn(),o()},d.onerror=()=>{console.error("Transaction error deleting folder",d.error),p(new Error("Transaction error deleting folder."))},d.objectStore(lr).delete(n)})}async function Rh(){const n=await mt();return new Promise((i,o)=>{const c=n.transaction(ir,"readonly").objectStore(ir).getAll();c.onerror=()=>{console.error("DB Error fetching all series:",c.error),o(new Error("Error fetching deck series from the database."))},c.onsuccess=()=>i(c.result)})}async function Fc(n){if(n.length===0)return;const i=await mt();return new Promise((o,p)=>{const d=i.transaction(ir,"readwrite");d.oncomplete=()=>{tn(),o()},d.onerror=()=>{console.error("Transaction error adding deck series",d.error),p(new Error("Transaction error adding deck series."))};const c=d.objectStore(ir);n.forEach(l=>c.put(l))})}async function Pc(n){const i=await mt();return new Promise((o,p)=>{const d=i.transaction(ir,"readwrite");d.oncomplete=()=>{tn(),o()},d.onerror=()=>{console.error("Transaction error updating deck series",d.error),p(new Error("Error updating deck series."))},d.objectStore(ir).put(n)})}async function Mh(n){const i=await mt();return new Promise((o,p)=>{const d=i.transaction(ir,"readwrite");d.oncomplete=()=>{tn(),o()},d.onerror=()=>{console.error("Transaction error deleting deck series",d.error),p(new Error("Error deleting deck series."))},d.objectStore(ir).delete(n)})}async function Lh(n,i){const o=await mt();return new Promise((p,d)=>{const c=o.transaction(Mt,"readwrite");c.oncomplete=()=>p(),c.onerror=()=>{console.error("Transaction error saving session state",c.error),d(new Error("Transaction error saving session state."))},c.objectStore(Mt).put({id:n,...i})})}async function Fh(n){const i=await mt();return new Promise((o,p)=>{const l=i.transaction(Mt,"readonly").objectStore(Mt).get(n);l.onerror=()=>{console.error("DB Error fetching session state",l.error),p(new Error("Error fetching session state."))},l.onsuccess=()=>o(l.result||null)})}async function Fp(){const n=await mt();return new Promise((i,o)=>{const c=n.transaction(Mt,"readonly").objectStore(Mt).getAll();c.onsuccess=()=>i(c.result),c.onerror=()=>o(new Error("Failed to get all sessions."))})}async function Pp(){const n=await mt();return new Promise((i,o)=>{const c=n.transaction(Mt,"readwrite").objectStore(Mt).clear();c.onsuccess=()=>i(),c.onerror=()=>o(new Error("Failed to clear sessions."))})}async function Up(n){if(n.length===0)return;const i=await mt();return new Promise((o,p)=>{const d=i.transaction(Mt,"readwrite"),c=d.objectStore(Mt);d.oncomplete=()=>o(),d.onerror=()=>p(new Error("Transaction error adding sessions.")),n.forEach(l=>c.put(l))})}async function ao(n){const i=await mt();return new Promise((o,p)=>{const d=i.transaction(Mt,"readwrite");d.oncomplete=()=>o(),d.onerror=()=>{console.error("Transaction error deleting session state",d.error),p(new Error("Transaction error deleting session state."))},d.objectStore(Mt).delete(n)})}async function Ph(){const n=await mt();return new Promise((i,o)=>{const c=n.transaction(Mt,"readonly").objectStore(Mt).getAllKeys();c.onerror=()=>{console.error("DB Error fetching session keys",c.error),o(new Error("Error fetching session keys."))},c.onsuccess=()=>i(c.result)})}async function Qc(n){const i=await mt();return new Promise((o,p)=>{const l=i.transaction(n,"readwrite").objectStore(n).clear();l.onsuccess=()=>o(),l.onerror=()=>{console.error(`Failed to clear object store: ${n}`,l.error),p(new Error(`Failed to clear object store: ${n}.`))}})}const zp=()=>Qc(Sr),Bp=()=>Qc(lr),Hp=()=>Qc(ir);async function Ti(){const n=await mt();return new Promise((i,o)=>{const p=[Sr,lr,ir,Ft,Mt,mr],d=n.transaction(p,"readonly"),c={decks:d.objectStore(Sr).getAll(),folders:d.objectStore(lr).getAll(),deckSeries:d.objectStore(ir).getAll(),reviews:d.objectStore(Ft).getAll(),sessions:d.objectStore(Mt).getAll(),seriesProgress:d.objectStore(mr).getAll()};d.oncomplete=()=>{const l={};c.seriesProgress.result.forEach(f=>{l[f.id]=f.completedDeckIds}),i({decks:c.decks.result,folders:c.folders.result,deckSeries:c.deckSeries.result,reviews:c.reviews.result,sessions:c.sessions.result,seriesProgress:l})},d.onerror=()=>{console.error("Transaction error in getAllDataForBackup",d.error),o(new Error("Database transaction failed while gathering backup data."))}})}async function Uh(n){const i=await mt();return new Promise((o,p)=>{const d=i.transaction(Ft,"readwrite");d.oncomplete=()=>o(),d.onerror=()=>{console.error("Transaction error adding review log",d.error),p(new Error("Transaction error adding review log."))},d.objectStore(Ft).add(n)})}async function zh(n){const i=await mt();return new Promise((o,p)=>{const l=i.transaction(Ft,"readonly").objectStore(Ft).index("timestamp"),f=IDBKeyRange.lowerBound(n.toISOString()),v=l.getAll(f);v.onerror=()=>{console.error("DB Error fetching review logs",v.error),p(new Error("Error fetching review logs."))},v.onsuccess=()=>o(v.result)})}async function qp(){const n=await mt();return new Promise((i,o)=>{const c=n.transaction(Ft,"readonly").objectStore(Ft).getAll();c.onerror=()=>{console.error("DB Error fetching all reviews:",c.error),o(new Error("Error fetching all reviews from the database."))},c.onsuccess=()=>i(c.result)})}async function $p(){const n=await mt();return new Promise((i,o)=>{const c=n.transaction(Ft,"readwrite").objectStore(Ft).clear();c.onsuccess=()=>i(),c.onerror=l=>{console.error("Failed to clear review logs",c.error),o(new Error("Failed to clear review logs."))}})}async function Gp(n){if(n.length===0)return;const i=await mt();return new Promise((o,p)=>{const d=i.transaction(Ft,"readwrite"),c=d.objectStore(Ft);d.oncomplete=()=>o(),d.onerror=()=>{console.error("Transaction error adding review logs",d.error),p(new Error("Transaction error adding review logs."))},n.forEach(l=>{const{id:f,...v}=l;c.add(v)})})}async function Bh(n){const i=await mt();return new Promise((o,p)=>{const f=i.transaction(Ft,"readonly").objectStore(Ft).index("deckId").getAll(n);f.onerror=()=>{console.error(`DB Error fetching reviews for deck ${n}`,f.error),p(new Error(`Error fetching reviews for deck ${n}.`))},f.onsuccess=()=>o(f.result)})}async function Hh(n){const i=await mt();return new Promise((o,p)=>{const l=i.transaction(en,"readwrite").objectStore(en).put({id:"global_history",history:n});l.onsuccess=()=>o(),l.onerror=()=>p(new Error("Failed to save AI chat history."))})}async function Yc(){const n=await mt();return new Promise((i,o)=>{const c=n.transaction(en,"readonly").objectStore(en).get("global_history");c.onsuccess=()=>{var l;return i(((l=c.result)==null?void 0:l.history)||[])},c.onerror=()=>o(new Error("Failed to get AI chat history."))})}async function Wp(){const n=await mt();return new Promise((i,o)=>{const c=n.transaction(en,"readwrite").objectStore(en).clear();c.onsuccess=()=>i(),c.onerror=()=>o(new Error("Failed to clear AI chat history."))})}async function Vc(n,i){const o=await mt();return new Promise((p,d)=>{const f=o.transaction(mr,"readwrite").objectStore(mr).put({id:n,completedDeckIds:Array.from(i)});f.onsuccess=()=>p(),f.onerror=()=>d(new Error("Failed to save series progress."))})}async function qh(){const n=await mt();return new Promise((i,o)=>{const c=n.transaction(mr,"readonly").objectStore(mr).getAll();c.onsuccess=()=>{const l={};c.result.forEach(f=>{l[f.id]=f.completedDeckIds}),i(l)},c.onerror=()=>o(new Error("Failed to get all series progress."))})}async function Qp(){const n=await mt();return new Promise((i,o)=>{const c=n.transaction(mr,"readwrite").objectStore(mr).clear();c.onsuccess=()=>i(),c.onerror=()=>o(new Error("Failed to clear series progress."))})}async function Yp(n){if(Object.keys(n).length===0)return;const i=await mt();return new Promise((o,p)=>{const d=i.transaction(mr,"readwrite"),c=d.objectStore(mr);d.oncomplete=()=>o(),d.onerror=()=>p(new Error("Transaction error adding series progress.")),Object.entries(n).forEach(([l,f])=>{c.put({id:l,completedDeckIds:f})})})}async function $h(){const{decks:n,folders:i,deckSeries:o,reviews:p,sessions:d,seriesProgress:c}=await Ti();if(n.length===0&&i.length===0&&o.length===0)throw new Error("There is no data to export.");const l=localStorage.getItem("cogniflow-ai-options"),f=l?JSON.parse(l):void 0,v=await Yc(),h={version:6,decks:n,folders:i,deckSeries:o,reviews:p,sessions:d,aiChatHistory:v,seriesProgress:c};f&&(h.aiOptions=f);const C=JSON.stringify(h,null,2),k=new Blob([C],{type:"application/json"}),I=URL.createObjectURL(k),x=document.createElement("a");x.style.display="none",x.href=I;const S=$c();return x.download=`cogniflow-backup-${S}.json`,document.body.appendChild(x),x.click(),window.URL.revokeObjectURL(I),document.body.removeChild(x),x.download}async function Gh(n){const i=await mt();return new Promise((o,p)=>{const d=[Sr,lr,ir,Ft,Mt,en,mr],c=i.transaction(d,"readwrite");c.oncomplete=()=>{tn(),o()},c.onerror=l=>{console.error("Atomic restore transaction failed:",c.error),p(new Error("Database transaction failed during data restore."))};try{const l=c.objectStore(Sr);l.clear();const f=c.objectStore(lr);f.clear();const v=c.objectStore(ir);v.clear();const h=c.objectStore(Ft);h.clear();const C=c.objectStore(Mt);C.clear();const k=c.objectStore(en);k.clear();const I=c.objectStore(mr);I.clear(),(n.decks||[]).forEach(x=>l.put(x)),(n.folders||[]).forEach(x=>f.put(x)),(n.deckSeries||[]).forEach(x=>v.put(x)),(n.reviews||[]).forEach(x=>{const{id:S,...g}=x;h.add(g)}),(n.sessions||[]).forEach(x=>C.put(x)),n.aiChatHistory&&n.aiChatHistory.length>0&&k.put({id:"global_history",history:n.aiChatHistory}),Object.entries(n.seriesProgress||{}).forEach(([x,S])=>{I.put({id:x,completedDeckIds:S})})}catch(l){console.error("Error queueing operations for atomic restore:",l),c.abort(),p(l)}})}async function Wh(){return Br&&((await Br).close(),Br=null),new Promise((n,i)=>{console.log(`[DB] Attempting to delete database: ${ro}`);const o=indexedDB.deleteDatabase(ro);o.onerror=p=>{console.error("Error deleting database.",p.target.error),i(new Error("Error deleting database."))},o.onsuccess=()=>{console.log("Database deleted successfully."),n()},o.onblocked=()=>{console.error("Database deletion blocked. Please close other tabs of this app and try again."),i(new Error("Deletion blocked. Please close other tabs of this app."))}})}const Vp=Object.freeze(Object.defineProperty({__proto__:null,addDeckSeries:Fc,addDecks:Di,addFolder:Th,addFolders:Lp,addReviewLog:Uh,bulkAddReviews:Gp,bulkAddSeriesProgress:Yp,bulkAddSessions:Up,bulkUpdateDecks:Gc,clearAIChatHistory:Wp,clearDecks:zp,clearFolders:Bp,clearReviews:$p,clearSeries:Hp,clearSeriesProgress:Qp,clearSessions:Pp,deleteDeck:Wc,deleteDeckSeries:Mh,deleteFolder:Oh,deleteSessionState:ao,exportAllData:$h,factoryReset:Wh,getAIChatHistory:Yc,getAllDataForBackup:Ti,getAllDeckSeries:Rh,getAllDecks:Ch,getAllFolders:Dh,getAllReviews:qp,getAllSeriesProgress:qh,getAllSessionKeys:Ph,getAllSessions:Fp,getReviewsForDeck:Bh,getReviewsSince:zh,getSessionState:Fh,performAtomicRestore:Gh,saveAIChatHistory:Hh,saveSeriesProgress:Vc,saveSessionState:Lh,updateDeck:Ih,updateDeckSeries:Pc,updateFolder:Ah},Symbol.toStringTag,{value:"Module"})),ts=2.5,Uc=1.3,Kp=1,Jp=1.2,Zp=1.3,Xp={1:-.2,2:-.15,3:0,4:.15},Ai=n=>{try{if(!n.trim())throw new Error("File content is empty.");let i=JSON.parse(n);if(typeof i=="string")try{i=JSON.parse(i)}catch{}if(typeof i=="object"&&i!==null&&!("version"in i)&&!Array.isArray(i)&&("data"in i&&typeof i.data=="object"?i=i.data:"content"in i&&typeof i.content=="object"&&(i=i.content)),typeof i=="object"&&i!==null&&"version"in i&&Array.isArray(i.decks)){if(i.version>6)throw new Error(`Unsupported backup version: ${i.version}`);const o=i.decks,p=i.folders||[],d=i.aiOptions||void 0,c=Array.isArray(i.reviews)?i.reviews:[],l=Array.isArray(i.sessions)?i.sessions:[],v=typeof i.seriesProgress=="object"&&i.seriesProgress!==null&&!Array.isArray(i.seriesProgress)&&Object.values(i.seriesProgress).every(k=>Array.isArray(k)&&k.every(I=>typeof I=="string"))?i.seriesProgress:{},h=Array.isArray(i.aiChatHistory)?i.aiChatHistory:[],C=(Array.isArray(i.deckSeries)?i.deckSeries:[]).filter(k=>k&&typeof k.id=="string"&&typeof k.name=="string").map(k=>Array.isArray(k.levels)?(k.levels.forEach(I=>{Array.isArray(I.deckIds)||(I.deckIds=[])}),k):Array.isArray(k.deckIds)?{...k,levels:[{title:"Decks",deckIds:k.deckIds}],deckIds:void 0}:{...k,levels:[]});for(const k of o)if(typeof k.id!="string"||typeof k.name!="string"||!k.type)throw new Error("Invalid deck structure in backup file.");for(const k of p)if(typeof k.id!="string"||typeof k.name!="string")throw new Error("Invalid folder structure in backup file.");return{version:i.version,decks:o,folders:p,deckSeries:C,reviews:c,sessions:l,seriesProgress:v,aiChatHistory:h,aiOptions:d}}if(Array.isArray(i)){const o=i.map(p=>(p.type||(p.type=Array.isArray(p.cards)?De.Flashcard:De.Quiz),p));for(const p of o)if(typeof p.id!="string"||typeof p.name!="string"||!p.type)throw new Error("Invalid legacy backup file format.");return{version:1,decks:o,folders:[],deckSeries:[],reviews:[],sessions:[],seriesProgress:{},aiChatHistory:[]}}throw new Error("The file is not a valid CogniFlow backup file.")}catch(i){throw console.error("Failed to parse backup file:",i),i instanceof SyntaxError?new Error("Invalid JSON format in the backup file."):new Error(i instanceof Error?i.message:"Invalid JSON format")}},zc=n=>{try{if(!n.trim())throw new Error("Pasted content is empty.");const i=JSON.parse(n);if(typeof i=="object"&&i!==null&&"seriesName"in i&&"levels"in i){if(typeof i.seriesName!="string"||typeof i.seriesDescription!="string"||!Array.isArray(i.levels))throw new Error("Invalid series format. Must have 'seriesName' (string), 'seriesDescription' (string), and a 'levels' (array).");for(const o of i.levels){if(typeof o.title!="string"||!Array.isArray(o.decks))throw new Error("Each level in the series must have a 'title' (string) and a 'decks' (array).");for(const p of o.decks)if(typeof p.name!="string"||typeof p.description!="string"||!Array.isArray(p.questions))throw new Error("Each deck in a level must be a valid quiz deck object with 'name', 'description', and 'questions' properties.")}return{type:"quiz_series",data:i}}if(Array.isArray(i)){const o=[];for(const p of i){if(typeof p.front!="string"||typeof p.back!="string")throw new Error("Each item in the array must be an object with 'front' and 'back' string properties.");o.push({front:p.front,back:p.back})}return{type:De.Flashcard,data:o}}if(typeof i=="object"&&i!==null&&"questions"in i){if(typeof i.name!="string"||typeof i.description!="string"||!Array.isArray(i.questions))throw new Error("Quiz JSON must be an object with 'name' (string), 'description' (string), and 'questions' (array) properties.");for(const o of i.questions)if(typeof o.questionText!="string"||!Array.isArray(o.options)||typeof o.correctAnswerId!="string")throw new Error("Each question in a quiz must have 'questionText', an 'options' array, and a 'correctAnswerId'.");return{type:De.Quiz,data:i}}throw new Error("Unsupported JSON structure. Expected an array of flashcards, a single quiz object, or a series object.")}catch(i){throw console.error("Failed to parse JSON:",i),new Error(i instanceof Error?i.message:"Invalid JSON format")}},eg=(n,i)=>{try{if(!n.trim())throw new Error("Pasted content is empty.");const o=JSON.parse(n);if(!Array.isArray(o))throw new Error("JSON must be an array of items.");if(o.length===0)return[];if(i===De.Flashcard){const p=[];for(const d of o){if(typeof d.front!="string"||typeof d.back!="string")throw new Error("Each item in the array must be an object with 'front' and 'back' string properties.");p.push({front:d.front,back:d.back})}return p}else{const p=[];for(const d of o){if(typeof d.questionText!="string"||!Array.isArray(d.options)||typeof d.correctAnswerId!="string")throw new Error("Each question must have 'questionText', an 'options' array, and a 'correctAnswerId'.");p.push(d)}return p}}catch(o){throw console.error("Failed to parse items JSON:",o),new Error(o instanceof Error?o.message:"Invalid JSON format")}},Kc=n=>{const i=new Date;return i.setHours(0,0,0,0),n.map(o=>({id:crypto.randomUUID(),front:o.front,back:o.back,dueDate:i.toISOString(),interval:0,easeFactor:ts,masteryLevel:0,lapses:0}))},ba=n=>{const i=new Date;return i.setHours(0,0,0,0),n.map(o=>({...o,id:crypto.randomUUID(),questionType:"multipleChoice",dueDate:i.toISOString(),interval:0,easeFactor:ts,masteryLevel:0,lapses:0}))},tg=n=>{try{return{type:"backup",data:Ai(n)}}catch{}try{const i=zc(n);return{type:i.type,data:i.data}}catch{}return null},hn={...Vp},Jc="https://www.greenyogafestival.org/backup-api/api/v1",mn="cogniflow-data",Ci="cogniflow-data.json",Bc="cogniflow-ai-chat.json",rg="test-api-key",Zc=()=>localStorage.getItem("cogniflow-backupApiKey")||"qRt+gU/57GHKhxTZeRnRi+dfT274iSkKKq2UnTr9Bxs=",Qh=n=>localStorage.setItem("cogniflow-lastSyncEtag",n),no=()=>localStorage.getItem("cogniflow-lastSyncEtag"),Yh=n=>localStorage.setItem("cogniflow-aiChat-lastSyncEtag",n),ng=()=>localStorage.getItem("cogniflow-aiChat-lastSyncEtag");async function rs(n,i={}){const o=`${Jc}/${n}`,p=Zc(),d=new Headers(i.headers||{});d.set("X-API-Key",p),i.body instanceof FormData&&d.delete("Content-Type");const c={...i,headers:d};console.log(`[BackupService] Requesting: ${i.method||"GET"} ${o}`,{headers:Object.fromEntries(d.entries())});const l=await fetch(o,c);if(console.log(`[BackupService] Response from ${i.method||"GET"} ${o}: ${l.status}`),!l.ok&&![304,404].includes(l.status)){let f;try{f=await l.json()}catch{f={error:`HTTP error! status: ${l.status}`}}console.error("[BackupService] API request failed:",f);const v=(f==null?void 0:f.error)||(f==null?void 0:f.message)||`Request failed with status ${l.status}`,h=new Error(v);throw h.status=l.status,h}return l}async function Ni(n,i=!1){console.log("[BackupService] Starting syncDataToServer...");let o;if(n)o=n;else{const{decks:h,folders:C,deckSeries:k,reviews:I,sessions:x,seriesProgress:S}=await hn.getAllDataForBackup(),g=localStorage.getItem("cogniflow-ai-options"),b=g?JSON.parse(g):void 0;o={version:6,decks:h,folders:C,deckSeries:k,reviews:I,sessions:x,seriesProgress:S,aiOptions:b}}const p=JSON.stringify(o),d={"Content-Type":"application/json"},c=no();c&&!i&&(d["If-Match"]=c),console.log(`[BackupService] PUT ${Ci}`,{headers:d,body:`(JSON body of size ${p.length})`});const l=await fetch(`${Jc}/apps/${mn}/backups/${Ci}`,{method:"PUT",headers:{...d,"X-API-Key":Zc()},body:p});if(console.log(`[BackupService] syncDataToServer response status: ${l.status}`),!l.ok){let h;try{h=await l.json()}catch{h={error:`HTTP error! status: ${l.status}`}}const C=(h==null?void 0:h.error)||(h==null?void 0:h.message)||`Request failed with status ${l.status}`,k=new Error(C);throw k.status=l.status,k}const f=l.headers.get("ETag");f&&Qh(f);const v=await l.json();return console.log("[BackupService] syncDataToServer successful:",v),{timestamp:v.modified,etag:f||""}}async function Hc(){console.log("[BackupService] Starting syncDataFromServer...");const n=await rs(`apps/${mn}/backups/${Ci}`);if(n.status===404)throw new Error("No sync file found on the server.");const i=n.headers.get("ETag");i&&Qh(i);const o=await n.text(),p=Ai(o);return console.log("[BackupService] syncDataFromServer successful."),p}async function Ii(){console.log("[BackupService] Starting getSyncDataMetadata...");const n={},i=no();i&&(n["If-None-Match"]=i);const o=await rs(`apps/${mn}/backups/${Ci}/meta`,{headers:n});if(o.status===304||o.status===404)return console.log(`[BackupService] getSyncDataMetadata finished with status: ${o.status}`),{metadata:null,isNotModified:o.status===304};const p=await o.json();return console.log("[BackupService] getSyncDataMetadata successful:",p),{metadata:p,isNotModified:!1}}async function sg(){console.log("[BackupService] Starting syncAIChatHistoryToServer...");const n=await hn.getAIChatHistory(),i=JSON.stringify({version:1,history:n||[]}),o={"Content-Type":"application/json"};let p=!1;try{(await rs(`apps/${mn}/backups/${Bc}/meta`)).status!==404&&(p=!0)}catch(f){if(f.status!==404)throw f}const d=ng();p&&d&&(o["If-Match"]=d);const c=await fetch(`${Jc}/apps/${mn}/backups/${Bc}`,{method:"PUT",headers:{...o,"X-API-Key":Zc()},body:i});if(console.log(`[BackupService] syncAIChatHistoryToServer response status: ${c.status}`),!c.ok){let f;try{f=await c.json()}catch{f={error:`HTTP error! status: ${c.status}`}}const v=(f==null?void 0:f.error)||(f==null?void 0:f.message)||`Request failed with status ${c.status}`,h=new Error(v);throw h.status=c.status,h}const l=c.headers.get("ETag");l&&Yh(l),console.log("[BackupService] syncAIChatHistoryToServer successful.")}async function ag(){console.log("[BackupService] Starting syncAIChatHistoryFromServer...");const n=await rs(`apps/${mn}/backups/${Bc}`);if(n.status===404)throw n;const i=n.headers.get("ETag");i&&Yh(i);const o=await n.json();return console.log("[BackupService] syncAIChatHistoryFromServer successful."),o.history||[]}async function og(){var o;console.log("[BackupService] Starting listServerBackups...");const i=await(await rs(`apps/${mn}/backups/list`)).json();return console.log(`[BackupService] Found ${((o=i.backups)==null?void 0:o.length)||0} backups.`),i.backups||[]}async function Vh(){console.log("[BackupService] Starting createServerBackup...");const{decks:n,folders:i,deckSeries:o,reviews:p,sessions:d,seriesProgress:c}=await hn.getAllDataForBackup(),l=localStorage.getItem("cogniflow-ai-options"),f=l?JSON.parse(l):void 0,v=await hn.getAIChatHistory(),C=JSON.stringify({version:6,decks:n,folders:i,deckSeries:o,reviews:p,sessions:d,seriesProgress:c,aiOptions:f,aiChatHistory:v}),k=new Blob([C],{type:"application/json"}),I=`backup-${$c()}.json`,x=new FormData;x.append("file",k,I);const g=await(await rs(`apps/${mn}/backups`,{method:"POST",body:x})).json();return console.log("[BackupService] createServerBackup successful:",g),g}async function ig(n){console.log(`[BackupService] Restoring live sync from manual backup: ${n}...`);const o=await(await rs(`apps/${mn}/backups/${n}/restore`,{method:"POST"})).json();return console.log(`[BackupService] Restore from ${n} successful:`,o),o}async function lg(n){console.log(`[BackupService] Deleting manual backup: ${n}...`),await rs(`apps/${mn}/backups/${n}`,{method:"DELETE"}),console.log(`[BackupService] Deleted ${n} successfully.`)}async function cg(){console.log("%c--- Running Backup Service Unit Tests ---","color: blue; font-weight: bold;");const n=window.fetch,i=localStorage.getItem,o=localStorage.setItem,p=hn.getAllDataForBackup,d=hn.getAIChatHistory;let c=0,l=0,f="initial-etag";const v={"cogniflow-backupApiKey":rg},h=async(g,b)=>{c++,console.log(`
Running test: ${g}`);try{f="initial-etag",v["cogniflow-lastSyncEtag"]=f,await b(),console.log(`%c PASS: ${g}`,"color: green;"),l++}catch(j){console.error(`%c FAIL: ${g}`,"color: red;"),console.error(j)}},C=(g,b,j)=>{const O=JSON.stringify(g),R=JSON.stringify(b);if(O!==R)throw new Error(`${j}
Expected: ${R}
Actual:   ${O}`)},k=(g,b)=>{if(!g)throw new Error(b)},I=async(g,b,j)=>{try{throw await g(),new Error(`Expected function to throw, but it did not. ${j}`)}catch(O){if(!O.message.includes(b))throw new Error(`${j}
Expected error message to include: "${b}"
Actual error message: "${O.message}"`)}},x={decks:[{id:"d1",name:"Deck 1"}],folders:[],deckSeries:[],reviews:[],sessions:[],seriesProgress:{}},S=[{id:"m1",role:"user",text:"hello"}];localStorage.getItem=g=>v[g]||null,localStorage.setItem=(g,b)=>{v[g]=b},hn.getAllDataForBackup=async()=>Promise.resolve(x),hn.getAIChatHistory=async()=>Promise.resolve(S),await h("syncDataToServer should succeed and update ETag",async()=>{window.fetch=async(b,j)=>{const O=new Headers(j==null?void 0:j.headers);return k(O.get("If-Match")==="initial-etag","If-Match header should be sent"),new Response(JSON.stringify({modified:"2023-01-01T12:00:00Z"}),{status:200,headers:{ETag:"new-etag"}})};const g=await Ni();C(g.etag,"new-etag","Should return the new ETag"),C(no(),"new-etag","Should store the new ETag in localStorage")}),await h("syncDataToServer should use force option to ignore ETag",async()=>{window.fetch=async(g,b)=>{const j=new Headers(b==null?void 0:b.headers);return k(!j.has("If-Match"),"If-Match header should NOT be sent when force=true"),new Response(JSON.stringify({modified:"2023-01-01T12:00:00Z"}),{status:201,headers:{ETag:"forced-etag"}})},await Ni(void 0,!0),C(no(),"forced-etag","ETag should be updated even on force sync")}),await h("syncDataToServer should handle 412 Precondition Failed",async()=>{window.fetch=async()=>new Response(JSON.stringify({error:"ETag mismatch"}),{status:412}),await I(()=>Ni(),"ETag mismatch","Should throw on 412 error")}),await h("syncDataFromServer should succeed and parse data",async()=>{const g={...x,version:6};window.fetch=async()=>new Response(JSON.stringify(g),{status:200,headers:{ETag:"server-etag"}});const b=await Hc();C(b.decks,x.decks,"Parsed decks should match mock data"),C(no(),"server-etag","Should update ETag on successful fetch")}),await h("syncDataFromServer should handle 404 Not Found",async()=>{window.fetch=async()=>new Response(null,{status:404}),await I(()=>Hc(),"No sync file found on the server","Should throw a specific message on 404")}),await h("getSyncDataMetadata should send If-None-Match header",async()=>{window.fetch=async(g,b)=>{const j=new Headers(b==null?void 0:b.headers);return k(j.get("If-None-Match")==="initial-etag","If-None-Match header should be sent"),new Response(JSON.stringify({filename:"test.json"}),{status:200})},await Ii()}),await h("getSyncDataMetadata should handle 304 Not Modified",async()=>{window.fetch=async()=>new Response(null,{status:304});const{metadata:g,isNotModified:b}=await Ii();k(b,"isNotModified should be true on 304"),C(g,null,"Metadata should be null on 304")}),await h("createServerBackup should send multipart/form-data",async()=>{window.fetch=async(b,j)=>{k((j==null?void 0:j.body)instanceof FormData,"Body should be FormData");const R=j.body.get("file");return k(R.name.startsWith("backup-"),"File should have correct name format"),new Response(JSON.stringify({message:"Backup successful",filename:R.name}),{status:201})};const g=await Vh();k(g.message==="Backup successful","Success message should be returned")}),console.log(`
%c--- Test Summary ---`,"color: blue; font-weight: bold;"),console.log(`Total tests: ${c}`),console.log(`%cPassed: ${l}`,"color: green;"),c>l&&console.log(`%cFailed: ${c-l}`,"color: red;"),window.fetch=n,localStorage.getItem=i,localStorage.setItem=o,hn.getAllDataForBackup=p,hn.getAIChatHistory=d}window.runBackupServiceTests=cg;const ug=()=>{const[n,i]=M.useState(null);return M.useEffect(()=>{const p=d=>{d.preventDefault(),i(d)};return window.addEventListener("beforeinstallprompt",p),()=>{window.removeEventListener("beforeinstallprompt",p)}},[]),[n,()=>{n&&(n.prompt(),n.userChoice.then(p=>{p.outcome==="accepted"?console.log("User accepted the install prompt"):console.log("User dismissed the install prompt"),i(null)}))}]},Kh=()=>{const n=()=>{const p=navigator,d=p.connection;return{isOnline:p.onLine,isMetered:d?d.type==="cellular"||d.saveData===!0:!1}},[i,o]=M.useState(n);return M.useEffect(()=>{const p=()=>o(n()),c=navigator.connection;return window.addEventListener("online",p),window.addEventListener("offline",p),c==null||c.addEventListener("change",p),()=>{window.removeEventListener("online",p),window.removeEventListener("offline",p),c==null||c.removeEventListener("change",p)}},[]),i},dg=()=>{const{isOnline:n}=Kh();return n?null:r.jsx("div",{role:"status","aria-live":"assertive",className:"fixed bottom-0 left-0 right-0 bg-red-600 text-white text-center p-3 z-50 animate-fade-in",children:r.jsx("p",{className:"text-sm font-semibold",children:"You are currently offline. Some features may be unavailable."})})},fg={plus:r.jsxs(r.Fragment,{children:[r.jsx("line",{x1:"12",y1:"5",x2:"12",y2:"19"}),r.jsx("line",{x1:"5",y1:"12",x2:"19",y2:"12"})]}),"upload-cloud":r.jsxs(r.Fragment,{children:[r.jsx("path",{d:"M20 16.58A5 5 0 0 0 18 7h-1.26A8 8 0 1 0 4 15.25"}),r.jsx("polyline",{points:"16 16 12 12 8 16"}),r.jsx("line",{x1:"12",y1:"12",x2:"12",y2:"21"})]}),x:r.jsxs(r.Fragment,{children:[r.jsx("line",{x1:"18",y1:"6",x2:"6",y2:"18"}),r.jsx("line",{x1:"6",y1:"6",x2:"18",y2:"18"})]}),"chevron-left":r.jsx(r.Fragment,{children:r.jsx("polyline",{points:"15 18 9 12 15 6"})}),"trash-2":r.jsxs(r.Fragment,{children:[r.jsx("polyline",{points:"3 6 5 6 21 6"}),r.jsx("path",{d:"M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"}),r.jsx("line",{x1:"10",y1:"11",x2:"10",y2:"17"}),r.jsx("line",{x1:"14",y1:"11",x2:"14",y2:"17"})]}),"check-circle":r.jsxs(r.Fragment,{children:[r.jsx("path",{d:"M22 11.08V12a10 10 0 1 1-5.93-9.14"}),r.jsx("polyline",{points:"22 4 12 14.01 9 11.01"})]}),"x-circle":r.jsxs(r.Fragment,{children:[r.jsx("circle",{cx:"12",cy:"12",r:"10"}),r.jsx("line",{x1:"15",y1:"9",x2:"9",y2:"15"}),r.jsx("line",{x1:"9",y1:"9",x2:"15",y2:"15"})]}),download:r.jsxs(r.Fragment,{children:[r.jsx("path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"}),r.jsx("polyline",{points:"7 10 12 15 17 10"}),r.jsx("line",{x1:"12",y1:"15",x2:"12",y2:"3"})]}),laptop:r.jsxs(r.Fragment,{children:[r.jsx("path",{d:"M20 16V7a2 2 0 0 0-2-2H6a2 2 0 0 0-2 2v9h16z"}),r.jsx("rect",{x:"2",y:"17",width:"20",height:"4",rx:"1"})]}),menu:r.jsxs(r.Fragment,{children:[r.jsx("line",{x1:"3",y1:"12",x2:"21",y2:"12"}),r.jsx("line",{x1:"3",y1:"6",x2:"21",y2:"6"}),r.jsx("line",{x1:"3",y1:"18",x2:"21",y2:"18"})]}),edit:r.jsxs(r.Fragment,{children:[r.jsx("path",{d:"M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"}),r.jsx("path",{d:"M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"})]}),save:r.jsxs(r.Fragment,{children:[r.jsx("path",{d:"M19 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11l5 5v11a2 2 0 0 1-2 2z"}),r.jsx("polyline",{points:"17 21 17 13 7 13 7 21"}),r.jsx("polyline",{points:"7 3 7 8 15 8"})]}),sun:r.jsxs(r.Fragment,{children:[r.jsx("circle",{cx:"12",cy:"12",r:"5"}),r.jsx("line",{x1:"12",y1:"1",x2:"12",y2:"3"}),r.jsx("line",{x1:"12",y1:"21",x2:"12",y2:"23"}),r.jsx("line",{x1:"4.22",y1:"4.22",x2:"5.64",y2:"5.64"}),r.jsx("line",{x1:"18.36",y1:"18.36",x2:"19.78",y2:"19.78"}),r.jsx("line",{x1:"1",y1:"12",x2:"3",y2:"12"}),r.jsx("line",{x1:"21",y1:"12",x2:"23",y2:"12"}),r.jsx("line",{x1:"4.22",y1:"19.78",x2:"5.64",y2:"18.36"}),r.jsx("line",{x1:"18.36",y1:"5.64",x2:"19.78",y2:"4.22"})]}),moon:r.jsx(r.Fragment,{children:r.jsx("path",{d:"M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"})}),code:r.jsxs(r.Fragment,{children:[r.jsx("polyline",{points:"16 18 22 12 16 6"}),r.jsx("polyline",{points:"8 6 2 12 8 18"})]}),"refresh-ccw":r.jsxs(r.Fragment,{children:[r.jsx("polyline",{points:"1 4 1 10 7 10"}),r.jsx("polyline",{points:"23 20 23 14 17 14"}),r.jsx("path",{d:"M20.49 9A9 9 0 0 0 7.2 6.51"}),r.jsx("path",{d:"M3.51 15A9 9 0 0 0 16.8 17.49"})]}),broom:r.jsx(r.Fragment,{children:r.jsx("path",{d:"M9.59 4.59A2 2 0 1 1 11 8H2m10.59 11.41A2 2 0 1 0 14 16H2m15.73-8.27A2.5 2.5 0 1 1 19.5 12H2"})}),settings:r.jsxs(r.Fragment,{children:[r.jsx("circle",{cx:"12",cy:"12",r:"3"}),r.jsx("path",{d:"M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 0 1 0 2.83 2 2 0 0 1-2.83 0l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-2 2 2 2 0 0 1-2-2v-.09A1.65 1.65 0 0 0 9 19.4a1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 0 1-2.83 0 2 2 0 0 1 0-2.83l.06-.06a1.65 1.65 0 0 0 .33-1.82 1.65 1.65 0 0 0-1.51-1H3a2 2 0 0 1-2-2 2 2 0 0 1 2-2h.09A1.65 1.65 0 0 0 4.6 9a1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 0 1 0-2.83 2 2 0 0 1 2.83 0l.06.06a1.65 1.65 0 0 0 1.82.33H9a1.65 1.65 0 0 0 1-1.51V3a2 2 0 0 1 2-2 2 2 0 0 1 2 2v.09a1.65 1.65 0 0 0 1 1.51 1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 0 1 2.83 0 2 2 0 0 1 0 2.83l-.06.06a1.65 1.65 0 0 0-.33 1.82V9a1.65 1.65 0 0 0 1.51 1H21a2 2 0 0 1 2 2 2 2 0 0 1-2 2h-.09a1.65 1.65 0 0 0-1.51 1z"})]}),info:r.jsxs(r.Fragment,{children:[r.jsx("circle",{cx:"12",cy:"12",r:"10"}),r.jsx("line",{x1:"12",y1:"16",x2:"12",y2:"12"}),r.jsx("line",{x1:"12",y1:"8",x2:"12.01",y2:"8"})]}),"chevron-down":r.jsx(r.Fragment,{children:r.jsx("polyline",{points:"6 9 12 15 18 9"})}),eye:r.jsxs(r.Fragment,{children:[r.jsx("path",{d:"M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"}),r.jsx("circle",{cx:"12",cy:"12",r:"3"})]}),"eye-off":r.jsxs(r.Fragment,{children:[r.jsx("path",{d:"M17.94 17.94A10.07 10.07 0 0 1 12 20c-7 0-11-8-11-8a18.45 18.45 0 0 1 5.06-5.94M9.9 4.24A9.12 9.12 0 0 1 12 4c7 0 11 8 11 8a18.5 18.5 0 0 1-2.16 3.19m-6.72-1.07a3 3 0 1 1-4.24-4.24"}),r.jsx("line",{x1:"1",y1:"1",x2:"23",y2:"23"})]}),zap:r.jsx(r.Fragment,{children:r.jsx("polygon",{points:"13 2 3 14 12 14 11 22 21 10 12 10 13 2"})}),"help-circle":r.jsxs(r.Fragment,{children:[r.jsx("circle",{cx:"12",cy:"12",r:"10"}),r.jsx("path",{d:"M9.09 9a3 3 0 0 1 5.83 1c0 2-3 3-3 3"}),r.jsx("line",{x1:"12",y1:"17",x2:"12.01",y2:"17"})]}),google:r.jsxs(r.Fragment,{children:[r.jsx("path",{d:"M17.64 9.2c0-.63-.06-1.25-.16-1.84H9v3.48h4.84c-.2 1.12-.84 2.08-1.74 2.71v2.26h2.92c1.7-1.56 2.68-3.88 2.68-6.61z"}),r.jsx("path",{d:"M9 18c2.43 0 4.47-.8 5.96-2.18l-2.92-2.26c-.8.54-1.82.86-3.04.86-2.34 0-4.32-1.58-5.04-3.7H1v2.34C2.64 16.32 5.57 18 9 18z"}),r.jsx("path",{d:"M3.96 10.71c-.18-.54-.28-1.12-.28-1.71s.1-1.17.28-1.71V4.96H1c-.64 1.28-1 2.74-1 4.34s.36 3.06 1 4.34l2.96-2.34z"}),r.jsx("path",{d:"M9 3.6c1.32 0 2.52.45 3.44 1.34l2.6-2.6C13.46.8 11.43 0 9 0 5.57 0 2.64 1.68 1 4.34l2.96 2.34C4.68 4.54 6.66 3.6 9 3.6z"})]}),folder:r.jsx(r.Fragment,{children:r.jsx("path",{d:"M22 19a2 2 0 0 1-2 2H4a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h5l2 3h9a2 2 0 0 1 2 2z"})}),"folder-plus":r.jsxs(r.Fragment,{children:[r.jsx("path",{d:"M22 19a2 2 0 0 1-2 2H4a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h5l2 3h9a2 2 0 0 1 2 2z"}),r.jsx("line",{x1:"12",y1:"11",x2:"12",y2:"17"}),r.jsx("line",{x1:"9",y1:"14",x2:"15",y2:"14"})]}),"folder-edit":r.jsxs(r.Fragment,{children:[r.jsx("path",{d:"M22 19a2 2 0 0 1-2 2H4a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h5l2 3h9a2 2 0 0 1 2 2z"}),r.jsx("path",{d:"M14 13.5l2 2-4 4-2-2 4-4zm-1.5 2.5l2-2"})]}),list:r.jsxs(r.Fragment,{children:[r.jsx("line",{x1:"8",y1:"6",x2:"21",y2:"6"}),r.jsx("line",{x1:"8",y1:"12",x2:"21",y2:"12"}),r.jsx("line",{x1:"8",y1:"18",x2:"21",y2:"18"}),r.jsx("line",{x1:"3",y1:"6",x2:"3.01",y2:"6"}),r.jsx("line",{x1:"3",y1:"12",x2:"3.01",y2:"12"}),r.jsx("line",{x1:"3",y1:"18",x2:"3.01",y2:"18"})]}),lock:r.jsxs(r.Fragment,{children:[r.jsx("rect",{x:"3",y:"11",width:"18",height:"11",rx:"2",ry:"2"}),r.jsx("path",{d:"M7 11V7a5 5 0 0 1 10 0v4"})]}),unlock:r.jsxs(r.Fragment,{children:[r.jsx("rect",{x:"3",y:"11",width:"18",height:"11",rx:"2",ry:"2"}),r.jsx("path",{d:"M7 11V7a5 5 0 0 1 9.9-1"})]}),archive:r.jsxs(r.Fragment,{children:[r.jsx("polyline",{points:"21 8 21 21 3 21 3 8"}),r.jsx("rect",{x:"1",y:"3",width:"22",height:"5"}),r.jsx("line",{x1:"10",y1:"12",x2:"14",y2:"12"})]}),unarchive:r.jsxs(r.Fragment,{children:[r.jsx("polyline",{points:"21 8 21 21 3 21 3 8"}),r.jsx("rect",{x:"1",y:"3",width:"22",height:"5"}),r.jsx("polyline",{points:"10 13 12 11 14 13"}),r.jsx("line",{x1:"12",y1:"11",x2:"12",y2:"17"})]}),"arrow-down":r.jsxs(r.Fragment,{children:[r.jsx("line",{x1:"12",y1:"5",x2:"12",y2:"19"}),r.jsx("polyline",{points:"19 12 12 19 5 12"})]}),monitor:r.jsxs(r.Fragment,{children:[r.jsx("rect",{x:"2",y:"3",width:"20",height:"14",rx:"2",ry:"2"}),r.jsx("line",{x1:"8",y1:"21",x2:"16",y2:"21"}),r.jsx("line",{x1:"12",y1:"17",x2:"12",y2:"21"})]}),"more-vertical":r.jsxs(r.Fragment,{children:[r.jsx("circle",{cx:"12",cy:"12",r:"1"}),r.jsx("circle",{cx:"12",cy:"5",r:"1"}),r.jsx("circle",{cx:"12",cy:"19",r:"1"})]}),search:r.jsxs(r.Fragment,{children:[r.jsx("circle",{cx:"11",cy:"11",r:"8"}),r.jsx("line",{x1:"21",y1:"21",x2:"16.65",y2:"16.65"})]}),filter:r.jsx(r.Fragment,{children:r.jsx("polygon",{points:"22 3 2 3 10 12.46 10 19 14 21 14 12.46 22 3"})}),layers:r.jsxs(r.Fragment,{children:[r.jsx("polygon",{points:"12 2 2 7 12 12 22 7 12 2"}),r.jsx("polyline",{points:"2 17 12 22 22 17"}),r.jsx("polyline",{points:"2 12 12 17 22 12"})]}),terminal:r.jsxs(r.Fragment,{children:[r.jsx("polyline",{points:"4 17 10 11 4 5"}),r.jsx("line",{x1:"12",y1:"19",x2:"20",y2:"19"})]}),"trending-up":r.jsxs(r.Fragment,{children:[r.jsx("polyline",{points:"23 6 13.5 15.5 8.5 10.5 1 18"}),r.jsx("polyline",{points:"17 6 23 6 23 12"})]}),"grip-vertical":r.jsxs(r.Fragment,{children:[r.jsx("circle",{cx:"9",cy:"12",r:"1"}),r.jsx("circle",{cx:"9",cy:"5",r:"1"}),r.jsx("circle",{cx:"9",cy:"19",r:"1"}),r.jsx("circle",{cx:"15",cy:"12",r:"1"}),r.jsx("circle",{cx:"15",cy:"5",r:"1"}),r.jsx("circle",{cx:"15",cy:"19",r:"1"})]}),repeat:r.jsxs(r.Fragment,{children:[r.jsx("polyline",{points:"17 1 21 5 17 9"}),r.jsx("path",{d:"M3 11V9a4 4 0 0 1 4-4h14"}),r.jsx("polyline",{points:"7 23 3 19 7 15"}),r.jsx("path",{d:"M21 13v2a4 4 0 0 1-4 4H3"})]}),bot:r.jsxs(r.Fragment,{children:[r.jsx("rect",{x:"5",y:"10",width:"14",height:"10",rx:"2"}),r.jsx("circle",{cx:"8.5",cy:"15",r:"1"}),r.jsx("circle",{cx:"15.5",cy:"15",r:"1"}),r.jsx("path",{d:"M9 10V4m6 6V4"}),r.jsx("line",{x1:"9",y1:"4",x2:"15",y2:"4"})]}),"book-open":r.jsxs(r.Fragment,{children:[r.jsx("path",{d:"M2 3h6a4 4 0 0 1 4 4v14a3 3 0 0 0-3-3H2z"}),r.jsx("path",{d:"M22 3h-6a4 4 0 0 0-4 4v14a3 3 0 0 1 3-3h7z"})]})},J=({name:n,className:i="w-6 h-6",...o})=>r.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",className:`${i} pointer-events-none`,...o,children:fg[n]}),se=({children:n,variant:i="primary",size:o="md",className:p="",...d})=>{const c="inline-flex items-center justify-center rounded-md font-medium transition-colors focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-offset-background disabled:opacity-50 disabled:pointer-events-none",l={primary:"bg-primary text-on-primary hover:bg-primary-hover focus:ring-primary",secondary:"bg-surface text-text border border-border hover:bg-border/20 focus:ring-primary",danger:"bg-red-600 text-white hover:bg-red-700 focus:ring-red-500",ghost:"text-text-muted hover:bg-border/50 hover:text-text focus:ring-primary"},f={sm:"px-2 py-1 text-xs",md:"px-4 py-2 text-sm",lg:"px-6 py-3 text-base"};return r.jsx("button",{className:`${c} ${l[i]} ${f[o]} ${p}`,...d,children:n})},hg='a[href], button:not([disabled]), textarea, input, select, [tabindex]:not([tabindex="-1"])',Pt=(n,i)=>{const o=M.useRef([]);M.useEffect(()=>{if(i&&n.current){o.current=Array.from(n.current.querySelectorAll(hg));const p=o.current[0];p&&setTimeout(()=>p.focus(),100);const d=c=>{var v;if(c.key!=="Tab"||!((v=n.current)!=null&&v.contains(document.activeElement)))return;const l=o.current[0],f=o.current[o.current.length-1];c.shiftKey?document.activeElement===l&&(c.preventDefault(),f==null||f.focus()):document.activeElement===f&&(c.preventDefault(),l==null||l.focus())};return document.addEventListener("keydown",d),()=>{document.removeEventListener("keydown",d)}}},[i,n])},Jh=M.createContext(void 0),pf=()=>window.location.hash.startsWith("#/")?window.location.hash.substring(1):"/",mg=({children:n})=>{const[i,o]=M.useState(pf()),p=M.useCallback(()=>{o(pf())},[]);M.useEffect(()=>(window.addEventListener("hashchange",p),()=>{window.removeEventListener("hashchange",p)}),[p]);const d=M.useCallback((l,f)=>{const v=`#${l}`;if(f!=null&&f.replace){const h=new URL(window.location.href);h.hash=v,window.location.replace(h.toString())}else window.location.hash=v},[]),c={path:i,navigate:d};return r.jsx(Jh.Provider,{value:c,children:n})},Cn=()=>{const n=M.useContext(Jh);if(n===void 0)throw new Error("useRouter must be used within a RouterProvider");return n},Tt=({href:n,children:i,passAs:o,...p})=>{const{navigate:d}=Cn(),c=f=>{f.currentTarget.tagName==="A"&&(f.metaKey||f.ctrlKey)||(f.preventDefault(),p.onClick&&p.onClick(f),d(n))},l=`#${n}`;return o?r.jsx(o,{...p,onClick:c,children:i}):r.jsx("a",{...p,href:l,onClick:c,children:i})},Zh=M.createContext(void 0),ki=(n,i)=>{if(typeof window>"u")return i;try{const o=window.localStorage.getItem(n);return o?JSON.parse(o)===!0:i}catch(o){return console.error(`Error reading ${n} from localStorage`,o),i}},pg=()=>{if(typeof window>"u")return!1;try{const n=window.localStorage.getItem("cogniflow-aiFeaturesEnabled");return n!==null?JSON.parse(n)===!0:!!(window.location.origin.endsWith("aistudio.google.com")||window.location.origin.endsWith("scf.usercontent.goog"))}catch(n){return console.error("Error reading cogniflow-aiFeaturesEnabled from localStorage",n),!1}},gg=({children:n})=>{const[i,o]=M.useState(()=>ki("cogniflow-disableAnimations",!1)),[p,d]=M.useState(()=>ki("cogniflow-hapticsEnabled",!0)),[c,l]=M.useState(pg),[f,v]=M.useState(()=>ki("cogniflow-backupEnabled",!0)),[h,C]=M.useState(()=>{try{return window.localStorage.getItem("cogniflow-backupApiKey")||"qRt+gU/57GHKhxTZeRnRi+dfT274iSkKKq2UnTr9Bxs="}catch{return"qRt+gU/57GHKhxTZeRnRi+dfT274iSkKKq2UnTr9Bxs="}}),[k,I]=M.useState(()=>ki("cogniflow-syncOnCellular",!0)),x=M.useCallback(A=>{o(A);try{window.localStorage.setItem("cogniflow-disableAnimations",JSON.stringify(A))}catch(T){console.error("Error writing animation setting to localStorage",T)}},[]),S=M.useCallback(A=>{d(A);try{window.localStorage.setItem("cogniflow-hapticsEnabled",JSON.stringify(A))}catch(T){console.error("Error writing haptics setting to localStorage",T)}},[]),g=M.useCallback(A=>{l(A);try{window.localStorage.setItem("cogniflow-aiFeaturesEnabled",JSON.stringify(A))}catch(T){console.error("Error writing AI features setting to localStorage",T)}},[]),b=M.useCallback(A=>{v(A);try{window.localStorage.setItem("cogniflow-backupEnabled",JSON.stringify(A))}catch(T){console.error("Error writing backup enabled setting to localStorage",T)}},[]),j=M.useCallback(A=>{C(A);try{window.localStorage.setItem("cogniflow-backupApiKey",A)}catch(T){console.error("Error writing backup API key to localStorage",T)}},[]),O=M.useCallback(A=>{I(A);try{window.localStorage.setItem("cogniflow-syncOnCellular",JSON.stringify(A))}catch(T){console.error("Error writing syncOnCellular setting to localStorage",T)}},[]),R={disableAnimations:i,setDisableAnimations:x,hapticsEnabled:p,setHapticsEnabled:S,aiFeaturesEnabled:c,setAiFeaturesEnabled:g,backupEnabled:f,setBackupEnabled:b,backupApiKey:h,setBackupApiKey:j,syncOnCellular:k,setSyncOnCellular:O};return r.jsx(Zh.Provider,{value:R,children:n})},rn=()=>{const n=M.useContext(Zh);if(n===void 0)throw new Error("useSettings must be used within a SettingsProvider");return n},xg=({isOpen:n,onClose:i,onImport:o,onCreateSeries:p,onGenerateAI:d,onInstall:c})=>{const l=M.useRef(null),{aiFeaturesEnabled:f}=rn();return Pt(l,n),M.useEffect(()=>{const v=h=>{h.key==="Escape"&&i()};return n&&document.addEventListener("keydown",v),()=>{document.removeEventListener("keydown",v)}},[n,i]),r.jsxs(r.Fragment,{children:[r.jsx("div",{className:`fixed inset-0 bg-black bg-opacity-60 z-50 transition-opacity duration-300 ${n?"opacity-100":"opacity-0 pointer-events-none"}`,onClick:i,"aria-hidden":"true"}),r.jsx("div",{ref:l,className:`fixed top-0 right-0 h-full w-full max-w-xs z-[51] transform transition-transform duration-300 ease-in-out ${n?"translate-x-0":"translate-x-full"}`,role:"dialog","aria-modal":"true","aria-labelledby":"sidebar-title",children:r.jsxs("div",{className:"bg-surface shadow-xl h-full flex flex-col",children:[r.jsxs("div",{className:"flex items-center justify-between p-4 border-b border-border",children:[r.jsx("h2",{id:"sidebar-title",className:"text-xl font-bold text-transparent bg-clip-text bg-gradient-to-r from-blue-400 to-teal-300",children:"Menu"}),r.jsx(se,{variant:"ghost",onClick:i,className:"p-1 h-auto","aria-label":"Close menu",children:r.jsx(J,{name:"x"})})]}),r.jsxs("nav",{className:"flex-grow p-4 space-y-2",children:[r.jsxs(Tt,{href:"/",onClick:i,className:"flex items-center px-3 py-2 text-text rounded-md hover:bg-border/30 text-lg",children:[r.jsx(J,{name:"laptop",className:"w-6 h-6 mr-3"})," Home"]}),r.jsxs(Tt,{href:"/series",onClick:i,className:"flex items-center px-3 py-2 text-text rounded-md hover:bg-border/30 text-lg",children:[r.jsx(J,{name:"layers",className:"w-6 h-6 mr-3"})," Series"]}),r.jsxs(Tt,{href:"/decks",onClick:i,className:"flex items-center px-3 py-2 text-text rounded-md hover:bg-border/30 text-lg",children:[r.jsx(J,{name:"folder",className:"w-6 h-6 mr-3"})," Decks"]}),r.jsxs(Tt,{href:"/progress",onClick:i,className:"flex items-center px-3 py-2 text-text rounded-md hover:bg-border/30 text-lg",children:[r.jsx(J,{name:"trending-up",className:"w-6 h-6 mr-3"}),"Progress"]}),r.jsxs(Tt,{href:"/archive",onClick:i,className:"flex items-center px-3 py-2 text-text rounded-md hover:bg-border/30 text-lg",children:[r.jsx(J,{name:"archive",className:"w-6 h-6 mr-3"}),"Archive"]}),r.jsxs(Tt,{href:"/trash",onClick:i,className:"flex items-center px-3 py-2 text-text rounded-md hover:bg-border/30 text-lg",children:[r.jsx(J,{name:"trash-2",className:"w-6 h-6 mr-3"}),"Trash"]}),r.jsxs(Tt,{href:"/settings",onClick:i,className:"flex items-center px-3 py-2 text-text rounded-md hover:bg-border/30 text-lg",children:[r.jsx(J,{name:"settings",className:"w-6 h-6 mr-3"}),"Settings"]}),r.jsxs(Tt,{href:"/instructions/json",onClick:i,className:"flex items-center px-3 py-2 text-text rounded-md hover:bg-border/30 text-lg",children:[r.jsx(J,{name:"help-circle",className:"w-6 h-6 mr-3"}),"JSON Guide"]})]}),r.jsxs("div",{className:"p-4 border-t border-border space-y-2",children:[f&&r.jsxs(se,{variant:"primary",onClick:d,className:"w-full",children:[r.jsx(J,{name:"zap",className:"w-5 h-5 mr-2"}),"Generate with AI"]}),r.jsxs(se,{variant:"secondary",onClick:p,className:"w-full",children:[r.jsx(J,{name:"layers",className:"w-5 h-5 mr-2"}),"Create New Series"]}),r.jsxs(se,{variant:"secondary",onClick:o,className:"w-full",children:[r.jsx(J,{name:"plus",className:"w-5 h-5 mr-2"}),"Create / Import Deck"]}),c&&r.jsxs(se,{variant:"secondary",onClick:c,className:"w-full",children:[r.jsx(J,{name:"download",className:"w-5 h-5 mr-2"}),"Install App"]})]})]})})]})},yg={success:r.jsx(J,{name:"check-circle",className:"w-6 h-6 text-green-500"}),error:r.jsx(J,{name:"x-circle",className:"w-6 h-6 text-red-500"}),info:r.jsx(J,{name:"info",className:"w-6 h-6 text-blue-500"})},vg=({message:n,onDismiss:i})=>(M.useEffect(()=>{const o=setTimeout(()=>{i(n.id)},5e3);return()=>{clearTimeout(o)}},[n.id,i]),r.jsx("div",{className:"bg-surface shadow-lg rounded-lg pointer-events-auto ring-1 ring-black ring-opacity-5 overflow-hidden animate-fade-in-right",children:r.jsx("div",{className:"p-4",children:r.jsxs("div",{className:"flex items-start",children:[r.jsx("div",{className:"flex-shrink-0",children:yg[n.type]}),r.jsx("div",{className:"ml-3 w-0 flex-1 pt-0.5",children:r.jsx("p",{className:"text-sm font-medium text-text break-words",children:n.message})}),r.jsx("div",{className:"ml-4 flex-shrink-0 flex",children:r.jsxs("button",{onClick:()=>i(n.id),className:"bg-surface rounded-md inline-flex text-text-muted hover:text-text focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-offset-surface focus:ring-primary",children:[r.jsx("span",{className:"sr-only",children:"Close"}),r.jsx(J,{name:"x",className:"h-5 w-5"})]})})]})})})),Xh=M.createContext(void 0),wg=({children:n})=>{const[i,o]=M.useState([]),p=M.useCallback((c,l)=>{const f=crypto.randomUUID();o(v=>[...v,{id:f,message:c,type:l}])},[]),d=M.useCallback(c=>{o(l=>l.filter(f=>f.id!==c))},[]);return r.jsxs(Xh.Provider,{value:{addToast:p},children:[n,r.jsx("div",{className:"fixed top-5 right-5 z-[100] w-full max-w-xs space-y-3",children:i.map(c=>r.jsx(vg,{message:c,onDismiss:d},c.id))})]})},Kt=()=>{const n=M.useContext(Xh);if(n===void 0)throw new Error("useToast must be used within a ToastProvider");return n},Bt=({size:n="md"})=>{const i={sm:"h-6 w-6",md:"h-10 w-10",lg:"h-16 w-16"};return r.jsx("div",{className:"flex justify-center items-center",role:"status","aria-label":"Loading",children:r.jsxs("svg",{className:`animate-spin text-blue-500 dark:text-blue-400 ${i[n]}`,xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",children:[r.jsx("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),r.jsx("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]})})},bg=({pullDistance:n,isRefreshing:i,threshold:o})=>{if(i)return r.jsx("div",{className:"fixed top-0 left-0 right-0 h-20 flex items-center justify-center z-50 transition-all duration-300",children:r.jsx(Bt,{size:"md"})});if(n<=0)return null;const p=Math.min(n/o,1),d=p>=1,c=20,l=2*Math.PI*c,f=l-p*l;return r.jsx("div",{className:"fixed top-0 left-0 right-0 h-20 flex items-center justify-center z-10 pointer-events-none",style:{transform:`translateY(${Math.min(n,o*1.5)-80}px)`,opacity:Math.min(n/(o/2),1)},children:r.jsxs("div",{className:"relative w-12 h-12 flex items-center justify-center bg-white dark:bg-gray-800 rounded-full shadow-lg",children:[r.jsxs("svg",{className:"absolute w-full h-full transform -rotate-90",viewBox:"0 0 44 44",children:[r.jsx("circle",{className:"text-gray-300/50 dark:text-gray-600/50",stroke:"currentColor",strokeWidth:"4",fill:"transparent",r:c,cx:"22",cy:"22"}),r.jsx("circle",{className:"text-blue-500",stroke:"currentColor",strokeWidth:"4",strokeLinecap:"round",fill:"transparent",r:c,cx:"22",cy:"22",style:{strokeDasharray:l,strokeDashoffset:f,transition:d?"stroke-dashoffset 0.1s linear":"none"}})]}),r.jsx(J,{name:d?"refresh-ccw":"arrow-down",className:`w-6 h-6 transition-colors duration-200 ${d?"text-blue-500":"text-gray-500 dark:text-gray-400"}`})]})})};function Si(n){throw new Error('Could not dynamically require "'+n+'". Please configure the dynamicRequireTargets or/and ignoreDynamicRequires option of @rollup/plugin-commonjs appropriately for this require call to work.')}var Ec={exports:{}};/*!

JSZip v3.10.1 - A JavaScript class for generating and reading zip files
<http://stuartk.com/jszip>

(c) 2009-2016 Stuart Knightley <stuart [at] stuartk.com>
Dual licenced under the MIT license or GPLv3. See https://raw.github.com/Stuk/jszip/main/LICENSE.markdown.

JSZip uses the library pako released under the MIT license :
https://github.com/nodeca/pako/blob/main/LICENSE
*/var gf;function kg(){return gf||(gf=1,function(n,i){(function(o){n.exports=o()})(function(){return function o(p,d,c){function l(h,C){if(!d[h]){if(!p[h]){var k=typeof Si=="function"&&Si;if(!C&&k)return k(h,!0);if(f)return f(h,!0);var I=new Error("Cannot find module '"+h+"'");throw I.code="MODULE_NOT_FOUND",I}var x=d[h]={exports:{}};p[h][0].call(x.exports,function(S){var g=p[h][1][S];return l(g||S)},x,x.exports,o,p,d,c)}return d[h].exports}for(var f=typeof Si=="function"&&Si,v=0;v<c.length;v++)l(c[v]);return l}({1:[function(o,p,d){var c=o("./utils"),l=o("./support"),f="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";d.encode=function(v){for(var h,C,k,I,x,S,g,b=[],j=0,O=v.length,R=O,A=c.getTypeOf(v)!=="string";j<v.length;)R=O-j,k=A?(h=v[j++],C=j<O?v[j++]:0,j<O?v[j++]:0):(h=v.charCodeAt(j++),C=j<O?v.charCodeAt(j++):0,j<O?v.charCodeAt(j++):0),I=h>>2,x=(3&h)<<4|C>>4,S=1<R?(15&C)<<2|k>>6:64,g=2<R?63&k:64,b.push(f.charAt(I)+f.charAt(x)+f.charAt(S)+f.charAt(g));return b.join("")},d.decode=function(v){var h,C,k,I,x,S,g=0,b=0,j="data:";if(v.substr(0,j.length)===j)throw new Error("Invalid base64 input, it looks like a data url.");var O,R=3*(v=v.replace(/[^A-Za-z0-9+/=]/g,"")).length/4;if(v.charAt(v.length-1)===f.charAt(64)&&R--,v.charAt(v.length-2)===f.charAt(64)&&R--,R%1!=0)throw new Error("Invalid base64 input, bad content length.");for(O=l.uint8array?new Uint8Array(0|R):new Array(0|R);g<v.length;)h=f.indexOf(v.charAt(g++))<<2|(I=f.indexOf(v.charAt(g++)))>>4,C=(15&I)<<4|(x=f.indexOf(v.charAt(g++)))>>2,k=(3&x)<<6|(S=f.indexOf(v.charAt(g++))),O[b++]=h,x!==64&&(O[b++]=C),S!==64&&(O[b++]=k);return O}},{"./support":30,"./utils":32}],2:[function(o,p,d){var c=o("./external"),l=o("./stream/DataWorker"),f=o("./stream/Crc32Probe"),v=o("./stream/DataLengthProbe");function h(C,k,I,x,S){this.compressedSize=C,this.uncompressedSize=k,this.crc32=I,this.compression=x,this.compressedContent=S}h.prototype={getContentWorker:function(){var C=new l(c.Promise.resolve(this.compressedContent)).pipe(this.compression.uncompressWorker()).pipe(new v("data_length")),k=this;return C.on("end",function(){if(this.streamInfo.data_length!==k.uncompressedSize)throw new Error("Bug : uncompressed data size mismatch")}),C},getCompressedWorker:function(){return new l(c.Promise.resolve(this.compressedContent)).withStreamInfo("compressedSize",this.compressedSize).withStreamInfo("uncompressedSize",this.uncompressedSize).withStreamInfo("crc32",this.crc32).withStreamInfo("compression",this.compression)}},h.createWorkerFrom=function(C,k,I){return C.pipe(new f).pipe(new v("uncompressedSize")).pipe(k.compressWorker(I)).pipe(new v("compressedSize")).withStreamInfo("compression",k)},p.exports=h},{"./external":6,"./stream/Crc32Probe":25,"./stream/DataLengthProbe":26,"./stream/DataWorker":27}],3:[function(o,p,d){var c=o("./stream/GenericWorker");d.STORE={magic:"\0\0",compressWorker:function(){return new c("STORE compression")},uncompressWorker:function(){return new c("STORE decompression")}},d.DEFLATE=o("./flate")},{"./flate":7,"./stream/GenericWorker":28}],4:[function(o,p,d){var c=o("./utils"),l=function(){for(var f,v=[],h=0;h<256;h++){f=h;for(var C=0;C<8;C++)f=1&f?3988292384^f>>>1:f>>>1;v[h]=f}return v}();p.exports=function(f,v){return f!==void 0&&f.length?c.getTypeOf(f)!=="string"?function(h,C,k,I){var x=l,S=I+k;h^=-1;for(var g=I;g<S;g++)h=h>>>8^x[255&(h^C[g])];return-1^h}(0|v,f,f.length,0):function(h,C,k,I){var x=l,S=I+k;h^=-1;for(var g=I;g<S;g++)h=h>>>8^x[255&(h^C.charCodeAt(g))];return-1^h}(0|v,f,f.length,0):0}},{"./utils":32}],5:[function(o,p,d){d.base64=!1,d.binary=!1,d.dir=!1,d.createFolders=!0,d.date=null,d.compression=null,d.compressionOptions=null,d.comment=null,d.unixPermissions=null,d.dosPermissions=null},{}],6:[function(o,p,d){var c=null;c=typeof Promise<"u"?Promise:o("lie"),p.exports={Promise:c}},{lie:37}],7:[function(o,p,d){var c=typeof Uint8Array<"u"&&typeof Uint16Array<"u"&&typeof Uint32Array<"u",l=o("pako"),f=o("./utils"),v=o("./stream/GenericWorker"),h=c?"uint8array":"array";function C(k,I){v.call(this,"FlateWorker/"+k),this._pako=null,this._pakoAction=k,this._pakoOptions=I,this.meta={}}d.magic="\b\0",f.inherits(C,v),C.prototype.processChunk=function(k){this.meta=k.meta,this._pako===null&&this._createPako(),this._pako.push(f.transformTo(h,k.data),!1)},C.prototype.flush=function(){v.prototype.flush.call(this),this._pako===null&&this._createPako(),this._pako.push([],!0)},C.prototype.cleanUp=function(){v.prototype.cleanUp.call(this),this._pako=null},C.prototype._createPako=function(){this._pako=new l[this._pakoAction]({raw:!0,level:this._pakoOptions.level||-1});var k=this;this._pako.onData=function(I){k.push({data:I,meta:k.meta})}},d.compressWorker=function(k){return new C("Deflate",k)},d.uncompressWorker=function(){return new C("Inflate",{})}},{"./stream/GenericWorker":28,"./utils":32,pako:38}],8:[function(o,p,d){function c(x,S){var g,b="";for(g=0;g<S;g++)b+=String.fromCharCode(255&x),x>>>=8;return b}function l(x,S,g,b,j,O){var R,A,T=x.file,P=x.compression,H=O!==h.utf8encode,K=f.transformTo("string",O(T.name)),W=f.transformTo("string",h.utf8encode(T.name)),B=T.comment,Y=f.transformTo("string",O(B)),q=f.transformTo("string",h.utf8encode(B)),Q=W.length!==T.name.length,N=q.length!==B.length,Z="",oe="",fe="",ye=T.dir,ue=T.date,z={crc32:0,compressedSize:0,uncompressedSize:0};S&&!g||(z.crc32=x.crc32,z.compressedSize=x.compressedSize,z.uncompressedSize=x.uncompressedSize);var _=0;S&&(_|=8),H||!Q&&!N||(_|=2048);var F=0,de=0;ye&&(F|=16),j==="UNIX"?(de=798,F|=function(ie,be){var Ne=ie;return ie||(Ne=be?16893:33204),(65535&Ne)<<16}(T.unixPermissions,ye)):(de=20,F|=function(ie){return 63&(ie||0)}(T.dosPermissions)),R=ue.getUTCHours(),R<<=6,R|=ue.getUTCMinutes(),R<<=5,R|=ue.getUTCSeconds()/2,A=ue.getUTCFullYear()-1980,A<<=4,A|=ue.getUTCMonth()+1,A<<=5,A|=ue.getUTCDate(),Q&&(oe=c(1,1)+c(C(K),4)+W,Z+="up"+c(oe.length,2)+oe),N&&(fe=c(1,1)+c(C(Y),4)+q,Z+="uc"+c(fe.length,2)+fe);var he="";return he+=`
\0`,he+=c(_,2),he+=P.magic,he+=c(R,2),he+=c(A,2),he+=c(z.crc32,4),he+=c(z.compressedSize,4),he+=c(z.uncompressedSize,4),he+=c(K.length,2),he+=c(Z.length,2),{fileRecord:k.LOCAL_FILE_HEADER+he+K+Z,dirRecord:k.CENTRAL_FILE_HEADER+c(de,2)+he+c(Y.length,2)+"\0\0\0\0"+c(F,4)+c(b,4)+K+Z+Y}}var f=o("../utils"),v=o("../stream/GenericWorker"),h=o("../utf8"),C=o("../crc32"),k=o("../signature");function I(x,S,g,b){v.call(this,"ZipFileWorker"),this.bytesWritten=0,this.zipComment=S,this.zipPlatform=g,this.encodeFileName=b,this.streamFiles=x,this.accumulate=!1,this.contentBuffer=[],this.dirRecords=[],this.currentSourceOffset=0,this.entriesCount=0,this.currentFile=null,this._sources=[]}f.inherits(I,v),I.prototype.push=function(x){var S=x.meta.percent||0,g=this.entriesCount,b=this._sources.length;this.accumulate?this.contentBuffer.push(x):(this.bytesWritten+=x.data.length,v.prototype.push.call(this,{data:x.data,meta:{currentFile:this.currentFile,percent:g?(S+100*(g-b-1))/g:100}}))},I.prototype.openedSource=function(x){this.currentSourceOffset=this.bytesWritten,this.currentFile=x.file.name;var S=this.streamFiles&&!x.file.dir;if(S){var g=l(x,S,!1,this.currentSourceOffset,this.zipPlatform,this.encodeFileName);this.push({data:g.fileRecord,meta:{percent:0}})}else this.accumulate=!0},I.prototype.closedSource=function(x){this.accumulate=!1;var S=this.streamFiles&&!x.file.dir,g=l(x,S,!0,this.currentSourceOffset,this.zipPlatform,this.encodeFileName);if(this.dirRecords.push(g.dirRecord),S)this.push({data:function(b){return k.DATA_DESCRIPTOR+c(b.crc32,4)+c(b.compressedSize,4)+c(b.uncompressedSize,4)}(x),meta:{percent:100}});else for(this.push({data:g.fileRecord,meta:{percent:0}});this.contentBuffer.length;)this.push(this.contentBuffer.shift());this.currentFile=null},I.prototype.flush=function(){for(var x=this.bytesWritten,S=0;S<this.dirRecords.length;S++)this.push({data:this.dirRecords[S],meta:{percent:100}});var g=this.bytesWritten-x,b=function(j,O,R,A,T){var P=f.transformTo("string",T(A));return k.CENTRAL_DIRECTORY_END+"\0\0\0\0"+c(j,2)+c(j,2)+c(O,4)+c(R,4)+c(P.length,2)+P}(this.dirRecords.length,g,x,this.zipComment,this.encodeFileName);this.push({data:b,meta:{percent:100}})},I.prototype.prepareNextSource=function(){this.previous=this._sources.shift(),this.openedSource(this.previous.streamInfo),this.isPaused?this.previous.pause():this.previous.resume()},I.prototype.registerPrevious=function(x){this._sources.push(x);var S=this;return x.on("data",function(g){S.processChunk(g)}),x.on("end",function(){S.closedSource(S.previous.streamInfo),S._sources.length?S.prepareNextSource():S.end()}),x.on("error",function(g){S.error(g)}),this},I.prototype.resume=function(){return!!v.prototype.resume.call(this)&&(!this.previous&&this._sources.length?(this.prepareNextSource(),!0):this.previous||this._sources.length||this.generatedError?void 0:(this.end(),!0))},I.prototype.error=function(x){var S=this._sources;if(!v.prototype.error.call(this,x))return!1;for(var g=0;g<S.length;g++)try{S[g].error(x)}catch{}return!0},I.prototype.lock=function(){v.prototype.lock.call(this);for(var x=this._sources,S=0;S<x.length;S++)x[S].lock()},p.exports=I},{"../crc32":4,"../signature":23,"../stream/GenericWorker":28,"../utf8":31,"../utils":32}],9:[function(o,p,d){var c=o("../compressions"),l=o("./ZipFileWorker");d.generateWorker=function(f,v,h){var C=new l(v.streamFiles,h,v.platform,v.encodeFileName),k=0;try{f.forEach(function(I,x){k++;var S=function(O,R){var A=O||R,T=c[A];if(!T)throw new Error(A+" is not a valid compression method !");return T}(x.options.compression,v.compression),g=x.options.compressionOptions||v.compressionOptions||{},b=x.dir,j=x.date;x._compressWorker(S,g).withStreamInfo("file",{name:I,dir:b,date:j,comment:x.comment||"",unixPermissions:x.unixPermissions,dosPermissions:x.dosPermissions}).pipe(C)}),C.entriesCount=k}catch(I){C.error(I)}return C}},{"../compressions":3,"./ZipFileWorker":8}],10:[function(o,p,d){function c(){if(!(this instanceof c))return new c;if(arguments.length)throw new Error("The constructor with parameters has been removed in JSZip 3.0, please check the upgrade guide.");this.files=Object.create(null),this.comment=null,this.root="",this.clone=function(){var l=new c;for(var f in this)typeof this[f]!="function"&&(l[f]=this[f]);return l}}(c.prototype=o("./object")).loadAsync=o("./load"),c.support=o("./support"),c.defaults=o("./defaults"),c.version="3.10.1",c.loadAsync=function(l,f){return new c().loadAsync(l,f)},c.external=o("./external"),p.exports=c},{"./defaults":5,"./external":6,"./load":11,"./object":15,"./support":30}],11:[function(o,p,d){var c=o("./utils"),l=o("./external"),f=o("./utf8"),v=o("./zipEntries"),h=o("./stream/Crc32Probe"),C=o("./nodejsUtils");function k(I){return new l.Promise(function(x,S){var g=I.decompressed.getContentWorker().pipe(new h);g.on("error",function(b){S(b)}).on("end",function(){g.streamInfo.crc32!==I.decompressed.crc32?S(new Error("Corrupted zip : CRC32 mismatch")):x()}).resume()})}p.exports=function(I,x){var S=this;return x=c.extend(x||{},{base64:!1,checkCRC32:!1,optimizedBinaryString:!1,createFolders:!1,decodeFileName:f.utf8decode}),C.isNode&&C.isStream(I)?l.Promise.reject(new Error("JSZip can't accept a stream when loading a zip file.")):c.prepareContent("the loaded zip file",I,!0,x.optimizedBinaryString,x.base64).then(function(g){var b=new v(x);return b.load(g),b}).then(function(g){var b=[l.Promise.resolve(g)],j=g.files;if(x.checkCRC32)for(var O=0;O<j.length;O++)b.push(k(j[O]));return l.Promise.all(b)}).then(function(g){for(var b=g.shift(),j=b.files,O=0;O<j.length;O++){var R=j[O],A=R.fileNameStr,T=c.resolve(R.fileNameStr);S.file(T,R.decompressed,{binary:!0,optimizedBinaryString:!0,date:R.date,dir:R.dir,comment:R.fileCommentStr.length?R.fileCommentStr:null,unixPermissions:R.unixPermissions,dosPermissions:R.dosPermissions,createFolders:x.createFolders}),R.dir||(S.file(T).unsafeOriginalName=A)}return b.zipComment.length&&(S.comment=b.zipComment),S})}},{"./external":6,"./nodejsUtils":14,"./stream/Crc32Probe":25,"./utf8":31,"./utils":32,"./zipEntries":33}],12:[function(o,p,d){var c=o("../utils"),l=o("../stream/GenericWorker");function f(v,h){l.call(this,"Nodejs stream input adapter for "+v),this._upstreamEnded=!1,this._bindStream(h)}c.inherits(f,l),f.prototype._bindStream=function(v){var h=this;(this._stream=v).pause(),v.on("data",function(C){h.push({data:C,meta:{percent:0}})}).on("error",function(C){h.isPaused?this.generatedError=C:h.error(C)}).on("end",function(){h.isPaused?h._upstreamEnded=!0:h.end()})},f.prototype.pause=function(){return!!l.prototype.pause.call(this)&&(this._stream.pause(),!0)},f.prototype.resume=function(){return!!l.prototype.resume.call(this)&&(this._upstreamEnded?this.end():this._stream.resume(),!0)},p.exports=f},{"../stream/GenericWorker":28,"../utils":32}],13:[function(o,p,d){var c=o("readable-stream").Readable;function l(f,v,h){c.call(this,v),this._helper=f;var C=this;f.on("data",function(k,I){C.push(k)||C._helper.pause(),h&&h(I)}).on("error",function(k){C.emit("error",k)}).on("end",function(){C.push(null)})}o("../utils").inherits(l,c),l.prototype._read=function(){this._helper.resume()},p.exports=l},{"../utils":32,"readable-stream":16}],14:[function(o,p,d){p.exports={isNode:typeof Buffer<"u",newBufferFrom:function(c,l){if(Buffer.from&&Buffer.from!==Uint8Array.from)return Buffer.from(c,l);if(typeof c=="number")throw new Error('The "data" argument must not be a number');return new Buffer(c,l)},allocBuffer:function(c){if(Buffer.alloc)return Buffer.alloc(c);var l=new Buffer(c);return l.fill(0),l},isBuffer:function(c){return Buffer.isBuffer(c)},isStream:function(c){return c&&typeof c.on=="function"&&typeof c.pause=="function"&&typeof c.resume=="function"}}},{}],15:[function(o,p,d){function c(T,P,H){var K,W=f.getTypeOf(P),B=f.extend(H||{},C);B.date=B.date||new Date,B.compression!==null&&(B.compression=B.compression.toUpperCase()),typeof B.unixPermissions=="string"&&(B.unixPermissions=parseInt(B.unixPermissions,8)),B.unixPermissions&&16384&B.unixPermissions&&(B.dir=!0),B.dosPermissions&&16&B.dosPermissions&&(B.dir=!0),B.dir&&(T=j(T)),B.createFolders&&(K=b(T))&&O.call(this,K,!0);var Y=W==="string"&&B.binary===!1&&B.base64===!1;H&&H.binary!==void 0||(B.binary=!Y),(P instanceof k&&P.uncompressedSize===0||B.dir||!P||P.length===0)&&(B.base64=!1,B.binary=!0,P="",B.compression="STORE",W="string");var q=null;q=P instanceof k||P instanceof v?P:S.isNode&&S.isStream(P)?new g(T,P):f.prepareContent(T,P,B.binary,B.optimizedBinaryString,B.base64);var Q=new I(T,q,B);this.files[T]=Q}var l=o("./utf8"),f=o("./utils"),v=o("./stream/GenericWorker"),h=o("./stream/StreamHelper"),C=o("./defaults"),k=o("./compressedObject"),I=o("./zipObject"),x=o("./generate"),S=o("./nodejsUtils"),g=o("./nodejs/NodejsStreamInputAdapter"),b=function(T){T.slice(-1)==="/"&&(T=T.substring(0,T.length-1));var P=T.lastIndexOf("/");return 0<P?T.substring(0,P):""},j=function(T){return T.slice(-1)!=="/"&&(T+="/"),T},O=function(T,P){return P=P!==void 0?P:C.createFolders,T=j(T),this.files[T]||c.call(this,T,null,{dir:!0,createFolders:P}),this.files[T]};function R(T){return Object.prototype.toString.call(T)==="[object RegExp]"}var A={load:function(){throw new Error("This method has been removed in JSZip 3.0, please check the upgrade guide.")},forEach:function(T){var P,H,K;for(P in this.files)K=this.files[P],(H=P.slice(this.root.length,P.length))&&P.slice(0,this.root.length)===this.root&&T(H,K)},filter:function(T){var P=[];return this.forEach(function(H,K){T(H,K)&&P.push(K)}),P},file:function(T,P,H){if(arguments.length!==1)return T=this.root+T,c.call(this,T,P,H),this;if(R(T)){var K=T;return this.filter(function(B,Y){return!Y.dir&&K.test(B)})}var W=this.files[this.root+T];return W&&!W.dir?W:null},folder:function(T){if(!T)return this;if(R(T))return this.filter(function(W,B){return B.dir&&T.test(W)});var P=this.root+T,H=O.call(this,P),K=this.clone();return K.root=H.name,K},remove:function(T){T=this.root+T;var P=this.files[T];if(P||(T.slice(-1)!=="/"&&(T+="/"),P=this.files[T]),P&&!P.dir)delete this.files[T];else for(var H=this.filter(function(W,B){return B.name.slice(0,T.length)===T}),K=0;K<H.length;K++)delete this.files[H[K].name];return this},generate:function(){throw new Error("This method has been removed in JSZip 3.0, please check the upgrade guide.")},generateInternalStream:function(T){var P,H={};try{if((H=f.extend(T||{},{streamFiles:!1,compression:"STORE",compressionOptions:null,type:"",platform:"DOS",comment:null,mimeType:"application/zip",encodeFileName:l.utf8encode})).type=H.type.toLowerCase(),H.compression=H.compression.toUpperCase(),H.type==="binarystring"&&(H.type="string"),!H.type)throw new Error("No output type specified.");f.checkSupport(H.type),H.platform!=="darwin"&&H.platform!=="freebsd"&&H.platform!=="linux"&&H.platform!=="sunos"||(H.platform="UNIX"),H.platform==="win32"&&(H.platform="DOS");var K=H.comment||this.comment||"";P=x.generateWorker(this,H,K)}catch(W){(P=new v("error")).error(W)}return new h(P,H.type||"string",H.mimeType)},generateAsync:function(T,P){return this.generateInternalStream(T).accumulate(P)},generateNodeStream:function(T,P){return(T=T||{}).type||(T.type="nodebuffer"),this.generateInternalStream(T).toNodejsStream(P)}};p.exports=A},{"./compressedObject":2,"./defaults":5,"./generate":9,"./nodejs/NodejsStreamInputAdapter":12,"./nodejsUtils":14,"./stream/GenericWorker":28,"./stream/StreamHelper":29,"./utf8":31,"./utils":32,"./zipObject":35}],16:[function(o,p,d){p.exports=o("stream")},{stream:void 0}],17:[function(o,p,d){var c=o("./DataReader");function l(f){c.call(this,f);for(var v=0;v<this.data.length;v++)f[v]=255&f[v]}o("../utils").inherits(l,c),l.prototype.byteAt=function(f){return this.data[this.zero+f]},l.prototype.lastIndexOfSignature=function(f){for(var v=f.charCodeAt(0),h=f.charCodeAt(1),C=f.charCodeAt(2),k=f.charCodeAt(3),I=this.length-4;0<=I;--I)if(this.data[I]===v&&this.data[I+1]===h&&this.data[I+2]===C&&this.data[I+3]===k)return I-this.zero;return-1},l.prototype.readAndCheckSignature=function(f){var v=f.charCodeAt(0),h=f.charCodeAt(1),C=f.charCodeAt(2),k=f.charCodeAt(3),I=this.readData(4);return v===I[0]&&h===I[1]&&C===I[2]&&k===I[3]},l.prototype.readData=function(f){if(this.checkOffset(f),f===0)return[];var v=this.data.slice(this.zero+this.index,this.zero+this.index+f);return this.index+=f,v},p.exports=l},{"../utils":32,"./DataReader":18}],18:[function(o,p,d){var c=o("../utils");function l(f){this.data=f,this.length=f.length,this.index=0,this.zero=0}l.prototype={checkOffset:function(f){this.checkIndex(this.index+f)},checkIndex:function(f){if(this.length<this.zero+f||f<0)throw new Error("End of data reached (data length = "+this.length+", asked index = "+f+"). Corrupted zip ?")},setIndex:function(f){this.checkIndex(f),this.index=f},skip:function(f){this.setIndex(this.index+f)},byteAt:function(){},readInt:function(f){var v,h=0;for(this.checkOffset(f),v=this.index+f-1;v>=this.index;v--)h=(h<<8)+this.byteAt(v);return this.index+=f,h},readString:function(f){return c.transformTo("string",this.readData(f))},readData:function(){},lastIndexOfSignature:function(){},readAndCheckSignature:function(){},readDate:function(){var f=this.readInt(4);return new Date(Date.UTC(1980+(f>>25&127),(f>>21&15)-1,f>>16&31,f>>11&31,f>>5&63,(31&f)<<1))}},p.exports=l},{"../utils":32}],19:[function(o,p,d){var c=o("./Uint8ArrayReader");function l(f){c.call(this,f)}o("../utils").inherits(l,c),l.prototype.readData=function(f){this.checkOffset(f);var v=this.data.slice(this.zero+this.index,this.zero+this.index+f);return this.index+=f,v},p.exports=l},{"../utils":32,"./Uint8ArrayReader":21}],20:[function(o,p,d){var c=o("./DataReader");function l(f){c.call(this,f)}o("../utils").inherits(l,c),l.prototype.byteAt=function(f){return this.data.charCodeAt(this.zero+f)},l.prototype.lastIndexOfSignature=function(f){return this.data.lastIndexOf(f)-this.zero},l.prototype.readAndCheckSignature=function(f){return f===this.readData(4)},l.prototype.readData=function(f){this.checkOffset(f);var v=this.data.slice(this.zero+this.index,this.zero+this.index+f);return this.index+=f,v},p.exports=l},{"../utils":32,"./DataReader":18}],21:[function(o,p,d){var c=o("./ArrayReader");function l(f){c.call(this,f)}o("../utils").inherits(l,c),l.prototype.readData=function(f){if(this.checkOffset(f),f===0)return new Uint8Array(0);var v=this.data.subarray(this.zero+this.index,this.zero+this.index+f);return this.index+=f,v},p.exports=l},{"../utils":32,"./ArrayReader":17}],22:[function(o,p,d){var c=o("../utils"),l=o("../support"),f=o("./ArrayReader"),v=o("./StringReader"),h=o("./NodeBufferReader"),C=o("./Uint8ArrayReader");p.exports=function(k){var I=c.getTypeOf(k);return c.checkSupport(I),I!=="string"||l.uint8array?I==="nodebuffer"?new h(k):l.uint8array?new C(c.transformTo("uint8array",k)):new f(c.transformTo("array",k)):new v(k)}},{"../support":30,"../utils":32,"./ArrayReader":17,"./NodeBufferReader":19,"./StringReader":20,"./Uint8ArrayReader":21}],23:[function(o,p,d){d.LOCAL_FILE_HEADER="PK",d.CENTRAL_FILE_HEADER="PK",d.CENTRAL_DIRECTORY_END="PK",d.ZIP64_CENTRAL_DIRECTORY_LOCATOR="PK\x07",d.ZIP64_CENTRAL_DIRECTORY_END="PK",d.DATA_DESCRIPTOR="PK\x07\b"},{}],24:[function(o,p,d){var c=o("./GenericWorker"),l=o("../utils");function f(v){c.call(this,"ConvertWorker to "+v),this.destType=v}l.inherits(f,c),f.prototype.processChunk=function(v){this.push({data:l.transformTo(this.destType,v.data),meta:v.meta})},p.exports=f},{"../utils":32,"./GenericWorker":28}],25:[function(o,p,d){var c=o("./GenericWorker"),l=o("../crc32");function f(){c.call(this,"Crc32Probe"),this.withStreamInfo("crc32",0)}o("../utils").inherits(f,c),f.prototype.processChunk=function(v){this.streamInfo.crc32=l(v.data,this.streamInfo.crc32||0),this.push(v)},p.exports=f},{"../crc32":4,"../utils":32,"./GenericWorker":28}],26:[function(o,p,d){var c=o("../utils"),l=o("./GenericWorker");function f(v){l.call(this,"DataLengthProbe for "+v),this.propName=v,this.withStreamInfo(v,0)}c.inherits(f,l),f.prototype.processChunk=function(v){if(v){var h=this.streamInfo[this.propName]||0;this.streamInfo[this.propName]=h+v.data.length}l.prototype.processChunk.call(this,v)},p.exports=f},{"../utils":32,"./GenericWorker":28}],27:[function(o,p,d){var c=o("../utils"),l=o("./GenericWorker");function f(v){l.call(this,"DataWorker");var h=this;this.dataIsReady=!1,this.index=0,this.max=0,this.data=null,this.type="",this._tickScheduled=!1,v.then(function(C){h.dataIsReady=!0,h.data=C,h.max=C&&C.length||0,h.type=c.getTypeOf(C),h.isPaused||h._tickAndRepeat()},function(C){h.error(C)})}c.inherits(f,l),f.prototype.cleanUp=function(){l.prototype.cleanUp.call(this),this.data=null},f.prototype.resume=function(){return!!l.prototype.resume.call(this)&&(!this._tickScheduled&&this.dataIsReady&&(this._tickScheduled=!0,c.delay(this._tickAndRepeat,[],this)),!0)},f.prototype._tickAndRepeat=function(){this._tickScheduled=!1,this.isPaused||this.isFinished||(this._tick(),this.isFinished||(c.delay(this._tickAndRepeat,[],this),this._tickScheduled=!0))},f.prototype._tick=function(){if(this.isPaused||this.isFinished)return!1;var v=null,h=Math.min(this.max,this.index+16384);if(this.index>=this.max)return this.end();switch(this.type){case"string":v=this.data.substring(this.index,h);break;case"uint8array":v=this.data.subarray(this.index,h);break;case"array":case"nodebuffer":v=this.data.slice(this.index,h)}return this.index=h,this.push({data:v,meta:{percent:this.max?this.index/this.max*100:0}})},p.exports=f},{"../utils":32,"./GenericWorker":28}],28:[function(o,p,d){function c(l){this.name=l||"default",this.streamInfo={},this.generatedError=null,this.extraStreamInfo={},this.isPaused=!0,this.isFinished=!1,this.isLocked=!1,this._listeners={data:[],end:[],error:[]},this.previous=null}c.prototype={push:function(l){this.emit("data",l)},end:function(){if(this.isFinished)return!1;this.flush();try{this.emit("end"),this.cleanUp(),this.isFinished=!0}catch(l){this.emit("error",l)}return!0},error:function(l){return!this.isFinished&&(this.isPaused?this.generatedError=l:(this.isFinished=!0,this.emit("error",l),this.previous&&this.previous.error(l),this.cleanUp()),!0)},on:function(l,f){return this._listeners[l].push(f),this},cleanUp:function(){this.streamInfo=this.generatedError=this.extraStreamInfo=null,this._listeners=[]},emit:function(l,f){if(this._listeners[l])for(var v=0;v<this._listeners[l].length;v++)this._listeners[l][v].call(this,f)},pipe:function(l){return l.registerPrevious(this)},registerPrevious:function(l){if(this.isLocked)throw new Error("The stream '"+this+"' has already been used.");this.streamInfo=l.streamInfo,this.mergeStreamInfo(),this.previous=l;var f=this;return l.on("data",function(v){f.processChunk(v)}),l.on("end",function(){f.end()}),l.on("error",function(v){f.error(v)}),this},pause:function(){return!this.isPaused&&!this.isFinished&&(this.isPaused=!0,this.previous&&this.previous.pause(),!0)},resume:function(){if(!this.isPaused||this.isFinished)return!1;var l=this.isPaused=!1;return this.generatedError&&(this.error(this.generatedError),l=!0),this.previous&&this.previous.resume(),!l},flush:function(){},processChunk:function(l){this.push(l)},withStreamInfo:function(l,f){return this.extraStreamInfo[l]=f,this.mergeStreamInfo(),this},mergeStreamInfo:function(){for(var l in this.extraStreamInfo)Object.prototype.hasOwnProperty.call(this.extraStreamInfo,l)&&(this.streamInfo[l]=this.extraStreamInfo[l])},lock:function(){if(this.isLocked)throw new Error("The stream '"+this+"' has already been used.");this.isLocked=!0,this.previous&&this.previous.lock()},toString:function(){var l="Worker "+this.name;return this.previous?this.previous+" -> "+l:l}},p.exports=c},{}],29:[function(o,p,d){var c=o("../utils"),l=o("./ConvertWorker"),f=o("./GenericWorker"),v=o("../base64"),h=o("../support"),C=o("../external"),k=null;if(h.nodestream)try{k=o("../nodejs/NodejsStreamOutputAdapter")}catch{}function I(S,g){return new C.Promise(function(b,j){var O=[],R=S._internalType,A=S._outputType,T=S._mimeType;S.on("data",function(P,H){O.push(P),g&&g(H)}).on("error",function(P){O=[],j(P)}).on("end",function(){try{var P=function(H,K,W){switch(H){case"blob":return c.newBlob(c.transformTo("arraybuffer",K),W);case"base64":return v.encode(K);default:return c.transformTo(H,K)}}(A,function(H,K){var W,B=0,Y=null,q=0;for(W=0;W<K.length;W++)q+=K[W].length;switch(H){case"string":return K.join("");case"array":return Array.prototype.concat.apply([],K);case"uint8array":for(Y=new Uint8Array(q),W=0;W<K.length;W++)Y.set(K[W],B),B+=K[W].length;return Y;case"nodebuffer":return Buffer.concat(K);default:throw new Error("concat : unsupported type '"+H+"'")}}(R,O),T);b(P)}catch(H){j(H)}O=[]}).resume()})}function x(S,g,b){var j=g;switch(g){case"blob":case"arraybuffer":j="uint8array";break;case"base64":j="string"}try{this._internalType=j,this._outputType=g,this._mimeType=b,c.checkSupport(j),this._worker=S.pipe(new l(j)),S.lock()}catch(O){this._worker=new f("error"),this._worker.error(O)}}x.prototype={accumulate:function(S){return I(this,S)},on:function(S,g){var b=this;return S==="data"?this._worker.on(S,function(j){g.call(b,j.data,j.meta)}):this._worker.on(S,function(){c.delay(g,arguments,b)}),this},resume:function(){return c.delay(this._worker.resume,[],this._worker),this},pause:function(){return this._worker.pause(),this},toNodejsStream:function(S){if(c.checkSupport("nodestream"),this._outputType!=="nodebuffer")throw new Error(this._outputType+" is not supported by this method");return new k(this,{objectMode:this._outputType!=="nodebuffer"},S)}},p.exports=x},{"../base64":1,"../external":6,"../nodejs/NodejsStreamOutputAdapter":13,"../support":30,"../utils":32,"./ConvertWorker":24,"./GenericWorker":28}],30:[function(o,p,d){if(d.base64=!0,d.array=!0,d.string=!0,d.arraybuffer=typeof ArrayBuffer<"u"&&typeof Uint8Array<"u",d.nodebuffer=typeof Buffer<"u",d.uint8array=typeof Uint8Array<"u",typeof ArrayBuffer>"u")d.blob=!1;else{var c=new ArrayBuffer(0);try{d.blob=new Blob([c],{type:"application/zip"}).size===0}catch{try{var l=new(self.BlobBuilder||self.WebKitBlobBuilder||self.MozBlobBuilder||self.MSBlobBuilder);l.append(c),d.blob=l.getBlob("application/zip").size===0}catch{d.blob=!1}}}try{d.nodestream=!!o("readable-stream").Readable}catch{d.nodestream=!1}},{"readable-stream":16}],31:[function(o,p,d){for(var c=o("./utils"),l=o("./support"),f=o("./nodejsUtils"),v=o("./stream/GenericWorker"),h=new Array(256),C=0;C<256;C++)h[C]=252<=C?6:248<=C?5:240<=C?4:224<=C?3:192<=C?2:1;h[254]=h[254]=1;function k(){v.call(this,"utf-8 decode"),this.leftOver=null}function I(){v.call(this,"utf-8 encode")}d.utf8encode=function(x){return l.nodebuffer?f.newBufferFrom(x,"utf-8"):function(S){var g,b,j,O,R,A=S.length,T=0;for(O=0;O<A;O++)(64512&(b=S.charCodeAt(O)))==55296&&O+1<A&&(64512&(j=S.charCodeAt(O+1)))==56320&&(b=65536+(b-55296<<10)+(j-56320),O++),T+=b<128?1:b<2048?2:b<65536?3:4;for(g=l.uint8array?new Uint8Array(T):new Array(T),O=R=0;R<T;O++)(64512&(b=S.charCodeAt(O)))==55296&&O+1<A&&(64512&(j=S.charCodeAt(O+1)))==56320&&(b=65536+(b-55296<<10)+(j-56320),O++),b<128?g[R++]=b:(b<2048?g[R++]=192|b>>>6:(b<65536?g[R++]=224|b>>>12:(g[R++]=240|b>>>18,g[R++]=128|b>>>12&63),g[R++]=128|b>>>6&63),g[R++]=128|63&b);return g}(x)},d.utf8decode=function(x){return l.nodebuffer?c.transformTo("nodebuffer",x).toString("utf-8"):function(S){var g,b,j,O,R=S.length,A=new Array(2*R);for(g=b=0;g<R;)if((j=S[g++])<128)A[b++]=j;else if(4<(O=h[j]))A[b++]=65533,g+=O-1;else{for(j&=O===2?31:O===3?15:7;1<O&&g<R;)j=j<<6|63&S[g++],O--;1<O?A[b++]=65533:j<65536?A[b++]=j:(j-=65536,A[b++]=55296|j>>10&1023,A[b++]=56320|1023&j)}return A.length!==b&&(A.subarray?A=A.subarray(0,b):A.length=b),c.applyFromCharCode(A)}(x=c.transformTo(l.uint8array?"uint8array":"array",x))},c.inherits(k,v),k.prototype.processChunk=function(x){var S=c.transformTo(l.uint8array?"uint8array":"array",x.data);if(this.leftOver&&this.leftOver.length){if(l.uint8array){var g=S;(S=new Uint8Array(g.length+this.leftOver.length)).set(this.leftOver,0),S.set(g,this.leftOver.length)}else S=this.leftOver.concat(S);this.leftOver=null}var b=function(O,R){var A;for((R=R||O.length)>O.length&&(R=O.length),A=R-1;0<=A&&(192&O[A])==128;)A--;return A<0||A===0?R:A+h[O[A]]>R?A:R}(S),j=S;b!==S.length&&(l.uint8array?(j=S.subarray(0,b),this.leftOver=S.subarray(b,S.length)):(j=S.slice(0,b),this.leftOver=S.slice(b,S.length))),this.push({data:d.utf8decode(j),meta:x.meta})},k.prototype.flush=function(){this.leftOver&&this.leftOver.length&&(this.push({data:d.utf8decode(this.leftOver),meta:{}}),this.leftOver=null)},d.Utf8DecodeWorker=k,c.inherits(I,v),I.prototype.processChunk=function(x){this.push({data:d.utf8encode(x.data),meta:x.meta})},d.Utf8EncodeWorker=I},{"./nodejsUtils":14,"./stream/GenericWorker":28,"./support":30,"./utils":32}],32:[function(o,p,d){var c=o("./support"),l=o("./base64"),f=o("./nodejsUtils"),v=o("./external");function h(g){return g}function C(g,b){for(var j=0;j<g.length;++j)b[j]=255&g.charCodeAt(j);return b}o("setimmediate"),d.newBlob=function(g,b){d.checkSupport("blob");try{return new Blob([g],{type:b})}catch{try{var j=new(self.BlobBuilder||self.WebKitBlobBuilder||self.MozBlobBuilder||self.MSBlobBuilder);return j.append(g),j.getBlob(b)}catch{throw new Error("Bug : can't construct the Blob.")}}};var k={stringifyByChunk:function(g,b,j){var O=[],R=0,A=g.length;if(A<=j)return String.fromCharCode.apply(null,g);for(;R<A;)b==="array"||b==="nodebuffer"?O.push(String.fromCharCode.apply(null,g.slice(R,Math.min(R+j,A)))):O.push(String.fromCharCode.apply(null,g.subarray(R,Math.min(R+j,A)))),R+=j;return O.join("")},stringifyByChar:function(g){for(var b="",j=0;j<g.length;j++)b+=String.fromCharCode(g[j]);return b},applyCanBeUsed:{uint8array:function(){try{return c.uint8array&&String.fromCharCode.apply(null,new Uint8Array(1)).length===1}catch{return!1}}(),nodebuffer:function(){try{return c.nodebuffer&&String.fromCharCode.apply(null,f.allocBuffer(1)).length===1}catch{return!1}}()}};function I(g){var b=65536,j=d.getTypeOf(g),O=!0;if(j==="uint8array"?O=k.applyCanBeUsed.uint8array:j==="nodebuffer"&&(O=k.applyCanBeUsed.nodebuffer),O)for(;1<b;)try{return k.stringifyByChunk(g,j,b)}catch{b=Math.floor(b/2)}return k.stringifyByChar(g)}function x(g,b){for(var j=0;j<g.length;j++)b[j]=g[j];return b}d.applyFromCharCode=I;var S={};S.string={string:h,array:function(g){return C(g,new Array(g.length))},arraybuffer:function(g){return S.string.uint8array(g).buffer},uint8array:function(g){return C(g,new Uint8Array(g.length))},nodebuffer:function(g){return C(g,f.allocBuffer(g.length))}},S.array={string:I,array:h,arraybuffer:function(g){return new Uint8Array(g).buffer},uint8array:function(g){return new Uint8Array(g)},nodebuffer:function(g){return f.newBufferFrom(g)}},S.arraybuffer={string:function(g){return I(new Uint8Array(g))},array:function(g){return x(new Uint8Array(g),new Array(g.byteLength))},arraybuffer:h,uint8array:function(g){return new Uint8Array(g)},nodebuffer:function(g){return f.newBufferFrom(new Uint8Array(g))}},S.uint8array={string:I,array:function(g){return x(g,new Array(g.length))},arraybuffer:function(g){return g.buffer},uint8array:h,nodebuffer:function(g){return f.newBufferFrom(g)}},S.nodebuffer={string:I,array:function(g){return x(g,new Array(g.length))},arraybuffer:function(g){return S.nodebuffer.uint8array(g).buffer},uint8array:function(g){return x(g,new Uint8Array(g.length))},nodebuffer:h},d.transformTo=function(g,b){if(b=b||"",!g)return b;d.checkSupport(g);var j=d.getTypeOf(b);return S[j][g](b)},d.resolve=function(g){for(var b=g.split("/"),j=[],O=0;O<b.length;O++){var R=b[O];R==="."||R===""&&O!==0&&O!==b.length-1||(R===".."?j.pop():j.push(R))}return j.join("/")},d.getTypeOf=function(g){return typeof g=="string"?"string":Object.prototype.toString.call(g)==="[object Array]"?"array":c.nodebuffer&&f.isBuffer(g)?"nodebuffer":c.uint8array&&g instanceof Uint8Array?"uint8array":c.arraybuffer&&g instanceof ArrayBuffer?"arraybuffer":void 0},d.checkSupport=function(g){if(!c[g.toLowerCase()])throw new Error(g+" is not supported by this platform")},d.MAX_VALUE_16BITS=65535,d.MAX_VALUE_32BITS=-1,d.pretty=function(g){var b,j,O="";for(j=0;j<(g||"").length;j++)O+="\\x"+((b=g.charCodeAt(j))<16?"0":"")+b.toString(16).toUpperCase();return O},d.delay=function(g,b,j){setImmediate(function(){g.apply(j||null,b||[])})},d.inherits=function(g,b){function j(){}j.prototype=b.prototype,g.prototype=new j},d.extend=function(){var g,b,j={};for(g=0;g<arguments.length;g++)for(b in arguments[g])Object.prototype.hasOwnProperty.call(arguments[g],b)&&j[b]===void 0&&(j[b]=arguments[g][b]);return j},d.prepareContent=function(g,b,j,O,R){return v.Promise.resolve(b).then(function(A){return c.blob&&(A instanceof Blob||["[object File]","[object Blob]"].indexOf(Object.prototype.toString.call(A))!==-1)&&typeof FileReader<"u"?new v.Promise(function(T,P){var H=new FileReader;H.onload=function(K){T(K.target.result)},H.onerror=function(K){P(K.target.error)},H.readAsArrayBuffer(A)}):A}).then(function(A){var T=d.getTypeOf(A);return T?(T==="arraybuffer"?A=d.transformTo("uint8array",A):T==="string"&&(R?A=l.decode(A):j&&O!==!0&&(A=function(P){return C(P,c.uint8array?new Uint8Array(P.length):new Array(P.length))}(A))),A):v.Promise.reject(new Error("Can't read the data of '"+g+"'. Is it in a supported JavaScript type (String, Blob, ArrayBuffer, etc) ?"))})}},{"./base64":1,"./external":6,"./nodejsUtils":14,"./support":30,setimmediate:54}],33:[function(o,p,d){var c=o("./reader/readerFor"),l=o("./utils"),f=o("./signature"),v=o("./zipEntry"),h=o("./support");function C(k){this.files=[],this.loadOptions=k}C.prototype={checkSignature:function(k){if(!this.reader.readAndCheckSignature(k)){this.reader.index-=4;var I=this.reader.readString(4);throw new Error("Corrupted zip or bug: unexpected signature ("+l.pretty(I)+", expected "+l.pretty(k)+")")}},isSignature:function(k,I){var x=this.reader.index;this.reader.setIndex(k);var S=this.reader.readString(4)===I;return this.reader.setIndex(x),S},readBlockEndOfCentral:function(){this.diskNumber=this.reader.readInt(2),this.diskWithCentralDirStart=this.reader.readInt(2),this.centralDirRecordsOnThisDisk=this.reader.readInt(2),this.centralDirRecords=this.reader.readInt(2),this.centralDirSize=this.reader.readInt(4),this.centralDirOffset=this.reader.readInt(4),this.zipCommentLength=this.reader.readInt(2);var k=this.reader.readData(this.zipCommentLength),I=h.uint8array?"uint8array":"array",x=l.transformTo(I,k);this.zipComment=this.loadOptions.decodeFileName(x)},readBlockZip64EndOfCentral:function(){this.zip64EndOfCentralSize=this.reader.readInt(8),this.reader.skip(4),this.diskNumber=this.reader.readInt(4),this.diskWithCentralDirStart=this.reader.readInt(4),this.centralDirRecordsOnThisDisk=this.reader.readInt(8),this.centralDirRecords=this.reader.readInt(8),this.centralDirSize=this.reader.readInt(8),this.centralDirOffset=this.reader.readInt(8),this.zip64ExtensibleData={};for(var k,I,x,S=this.zip64EndOfCentralSize-44;0<S;)k=this.reader.readInt(2),I=this.reader.readInt(4),x=this.reader.readData(I),this.zip64ExtensibleData[k]={id:k,length:I,value:x}},readBlockZip64EndOfCentralLocator:function(){if(this.diskWithZip64CentralDirStart=this.reader.readInt(4),this.relativeOffsetEndOfZip64CentralDir=this.reader.readInt(8),this.disksCount=this.reader.readInt(4),1<this.disksCount)throw new Error("Multi-volumes zip are not supported")},readLocalFiles:function(){var k,I;for(k=0;k<this.files.length;k++)I=this.files[k],this.reader.setIndex(I.localHeaderOffset),this.checkSignature(f.LOCAL_FILE_HEADER),I.readLocalPart(this.reader),I.handleUTF8(),I.processAttributes()},readCentralDir:function(){var k;for(this.reader.setIndex(this.centralDirOffset);this.reader.readAndCheckSignature(f.CENTRAL_FILE_HEADER);)(k=new v({zip64:this.zip64},this.loadOptions)).readCentralPart(this.reader),this.files.push(k);if(this.centralDirRecords!==this.files.length&&this.centralDirRecords!==0&&this.files.length===0)throw new Error("Corrupted zip or bug: expected "+this.centralDirRecords+" records in central dir, got "+this.files.length)},readEndOfCentral:function(){var k=this.reader.lastIndexOfSignature(f.CENTRAL_DIRECTORY_END);if(k<0)throw this.isSignature(0,f.LOCAL_FILE_HEADER)?new Error("Corrupted zip: can't find end of central directory"):new Error("Can't find end of central directory : is this a zip file ? If it is, see https://stuk.github.io/jszip/documentation/howto/read_zip.html");this.reader.setIndex(k);var I=k;if(this.checkSignature(f.CENTRAL_DIRECTORY_END),this.readBlockEndOfCentral(),this.diskNumber===l.MAX_VALUE_16BITS||this.diskWithCentralDirStart===l.MAX_VALUE_16BITS||this.centralDirRecordsOnThisDisk===l.MAX_VALUE_16BITS||this.centralDirRecords===l.MAX_VALUE_16BITS||this.centralDirSize===l.MAX_VALUE_32BITS||this.centralDirOffset===l.MAX_VALUE_32BITS){if(this.zip64=!0,(k=this.reader.lastIndexOfSignature(f.ZIP64_CENTRAL_DIRECTORY_LOCATOR))<0)throw new Error("Corrupted zip: can't find the ZIP64 end of central directory locator");if(this.reader.setIndex(k),this.checkSignature(f.ZIP64_CENTRAL_DIRECTORY_LOCATOR),this.readBlockZip64EndOfCentralLocator(),!this.isSignature(this.relativeOffsetEndOfZip64CentralDir,f.ZIP64_CENTRAL_DIRECTORY_END)&&(this.relativeOffsetEndOfZip64CentralDir=this.reader.lastIndexOfSignature(f.ZIP64_CENTRAL_DIRECTORY_END),this.relativeOffsetEndOfZip64CentralDir<0))throw new Error("Corrupted zip: can't find the ZIP64 end of central directory");this.reader.setIndex(this.relativeOffsetEndOfZip64CentralDir),this.checkSignature(f.ZIP64_CENTRAL_DIRECTORY_END),this.readBlockZip64EndOfCentral()}var x=this.centralDirOffset+this.centralDirSize;this.zip64&&(x+=20,x+=12+this.zip64EndOfCentralSize);var S=I-x;if(0<S)this.isSignature(I,f.CENTRAL_FILE_HEADER)||(this.reader.zero=S);else if(S<0)throw new Error("Corrupted zip: missing "+Math.abs(S)+" bytes.")},prepareReader:function(k){this.reader=c(k)},load:function(k){this.prepareReader(k),this.readEndOfCentral(),this.readCentralDir(),this.readLocalFiles()}},p.exports=C},{"./reader/readerFor":22,"./signature":23,"./support":30,"./utils":32,"./zipEntry":34}],34:[function(o,p,d){var c=o("./reader/readerFor"),l=o("./utils"),f=o("./compressedObject"),v=o("./crc32"),h=o("./utf8"),C=o("./compressions"),k=o("./support");function I(x,S){this.options=x,this.loadOptions=S}I.prototype={isEncrypted:function(){return(1&this.bitFlag)==1},useUTF8:function(){return(2048&this.bitFlag)==2048},readLocalPart:function(x){var S,g;if(x.skip(22),this.fileNameLength=x.readInt(2),g=x.readInt(2),this.fileName=x.readData(this.fileNameLength),x.skip(g),this.compressedSize===-1||this.uncompressedSize===-1)throw new Error("Bug or corrupted zip : didn't get enough information from the central directory (compressedSize === -1 || uncompressedSize === -1)");if((S=function(b){for(var j in C)if(Object.prototype.hasOwnProperty.call(C,j)&&C[j].magic===b)return C[j];return null}(this.compressionMethod))===null)throw new Error("Corrupted zip : compression "+l.pretty(this.compressionMethod)+" unknown (inner file : "+l.transformTo("string",this.fileName)+")");this.decompressed=new f(this.compressedSize,this.uncompressedSize,this.crc32,S,x.readData(this.compressedSize))},readCentralPart:function(x){this.versionMadeBy=x.readInt(2),x.skip(2),this.bitFlag=x.readInt(2),this.compressionMethod=x.readString(2),this.date=x.readDate(),this.crc32=x.readInt(4),this.compressedSize=x.readInt(4),this.uncompressedSize=x.readInt(4);var S=x.readInt(2);if(this.extraFieldsLength=x.readInt(2),this.fileCommentLength=x.readInt(2),this.diskNumberStart=x.readInt(2),this.internalFileAttributes=x.readInt(2),this.externalFileAttributes=x.readInt(4),this.localHeaderOffset=x.readInt(4),this.isEncrypted())throw new Error("Encrypted zip are not supported");x.skip(S),this.readExtraFields(x),this.parseZIP64ExtraField(x),this.fileComment=x.readData(this.fileCommentLength)},processAttributes:function(){this.unixPermissions=null,this.dosPermissions=null;var x=this.versionMadeBy>>8;this.dir=!!(16&this.externalFileAttributes),x==0&&(this.dosPermissions=63&this.externalFileAttributes),x==3&&(this.unixPermissions=this.externalFileAttributes>>16&65535),this.dir||this.fileNameStr.slice(-1)!=="/"||(this.dir=!0)},parseZIP64ExtraField:function(){if(this.extraFields[1]){var x=c(this.extraFields[1].value);this.uncompressedSize===l.MAX_VALUE_32BITS&&(this.uncompressedSize=x.readInt(8)),this.compressedSize===l.MAX_VALUE_32BITS&&(this.compressedSize=x.readInt(8)),this.localHeaderOffset===l.MAX_VALUE_32BITS&&(this.localHeaderOffset=x.readInt(8)),this.diskNumberStart===l.MAX_VALUE_32BITS&&(this.diskNumberStart=x.readInt(4))}},readExtraFields:function(x){var S,g,b,j=x.index+this.extraFieldsLength;for(this.extraFields||(this.extraFields={});x.index+4<j;)S=x.readInt(2),g=x.readInt(2),b=x.readData(g),this.extraFields[S]={id:S,length:g,value:b};x.setIndex(j)},handleUTF8:function(){var x=k.uint8array?"uint8array":"array";if(this.useUTF8())this.fileNameStr=h.utf8decode(this.fileName),this.fileCommentStr=h.utf8decode(this.fileComment);else{var S=this.findExtraFieldUnicodePath();if(S!==null)this.fileNameStr=S;else{var g=l.transformTo(x,this.fileName);this.fileNameStr=this.loadOptions.decodeFileName(g)}var b=this.findExtraFieldUnicodeComment();if(b!==null)this.fileCommentStr=b;else{var j=l.transformTo(x,this.fileComment);this.fileCommentStr=this.loadOptions.decodeFileName(j)}}},findExtraFieldUnicodePath:function(){var x=this.extraFields[28789];if(x){var S=c(x.value);return S.readInt(1)!==1||v(this.fileName)!==S.readInt(4)?null:h.utf8decode(S.readData(x.length-5))}return null},findExtraFieldUnicodeComment:function(){var x=this.extraFields[25461];if(x){var S=c(x.value);return S.readInt(1)!==1||v(this.fileComment)!==S.readInt(4)?null:h.utf8decode(S.readData(x.length-5))}return null}},p.exports=I},{"./compressedObject":2,"./compressions":3,"./crc32":4,"./reader/readerFor":22,"./support":30,"./utf8":31,"./utils":32}],35:[function(o,p,d){function c(S,g,b){this.name=S,this.dir=b.dir,this.date=b.date,this.comment=b.comment,this.unixPermissions=b.unixPermissions,this.dosPermissions=b.dosPermissions,this._data=g,this._dataBinary=b.binary,this.options={compression:b.compression,compressionOptions:b.compressionOptions}}var l=o("./stream/StreamHelper"),f=o("./stream/DataWorker"),v=o("./utf8"),h=o("./compressedObject"),C=o("./stream/GenericWorker");c.prototype={internalStream:function(S){var g=null,b="string";try{if(!S)throw new Error("No output type specified.");var j=(b=S.toLowerCase())==="string"||b==="text";b!=="binarystring"&&b!=="text"||(b="string"),g=this._decompressWorker();var O=!this._dataBinary;O&&!j&&(g=g.pipe(new v.Utf8EncodeWorker)),!O&&j&&(g=g.pipe(new v.Utf8DecodeWorker))}catch(R){(g=new C("error")).error(R)}return new l(g,b,"")},async:function(S,g){return this.internalStream(S).accumulate(g)},nodeStream:function(S,g){return this.internalStream(S||"nodebuffer").toNodejsStream(g)},_compressWorker:function(S,g){if(this._data instanceof h&&this._data.compression.magic===S.magic)return this._data.getCompressedWorker();var b=this._decompressWorker();return this._dataBinary||(b=b.pipe(new v.Utf8EncodeWorker)),h.createWorkerFrom(b,S,g)},_decompressWorker:function(){return this._data instanceof h?this._data.getContentWorker():this._data instanceof C?this._data:new f(this._data)}};for(var k=["asText","asBinary","asNodeBuffer","asUint8Array","asArrayBuffer"],I=function(){throw new Error("This method has been removed in JSZip 3.0, please check the upgrade guide.")},x=0;x<k.length;x++)c.prototype[k[x]]=I;p.exports=c},{"./compressedObject":2,"./stream/DataWorker":27,"./stream/GenericWorker":28,"./stream/StreamHelper":29,"./utf8":31}],36:[function(o,p,d){(function(c){var l,f,v=c.MutationObserver||c.WebKitMutationObserver;if(v){var h=0,C=new v(S),k=c.document.createTextNode("");C.observe(k,{characterData:!0}),l=function(){k.data=h=++h%2}}else if(c.setImmediate||c.MessageChannel===void 0)l="document"in c&&"onreadystatechange"in c.document.createElement("script")?function(){var g=c.document.createElement("script");g.onreadystatechange=function(){S(),g.onreadystatechange=null,g.parentNode.removeChild(g),g=null},c.document.documentElement.appendChild(g)}:function(){setTimeout(S,0)};else{var I=new c.MessageChannel;I.port1.onmessage=S,l=function(){I.port2.postMessage(0)}}var x=[];function S(){var g,b;f=!0;for(var j=x.length;j;){for(b=x,x=[],g=-1;++g<j;)b[g]();j=x.length}f=!1}p.exports=function(g){x.push(g)!==1||f||l()}}).call(this,typeof vi<"u"?vi:typeof self<"u"?self:typeof window<"u"?window:{})},{}],37:[function(o,p,d){var c=o("immediate");function l(){}var f={},v=["REJECTED"],h=["FULFILLED"],C=["PENDING"];function k(j){if(typeof j!="function")throw new TypeError("resolver must be a function");this.state=C,this.queue=[],this.outcome=void 0,j!==l&&g(this,j)}function I(j,O,R){this.promise=j,typeof O=="function"&&(this.onFulfilled=O,this.callFulfilled=this.otherCallFulfilled),typeof R=="function"&&(this.onRejected=R,this.callRejected=this.otherCallRejected)}function x(j,O,R){c(function(){var A;try{A=O(R)}catch(T){return f.reject(j,T)}A===j?f.reject(j,new TypeError("Cannot resolve promise with itself")):f.resolve(j,A)})}function S(j){var O=j&&j.then;if(j&&(typeof j=="object"||typeof j=="function")&&typeof O=="function")return function(){O.apply(j,arguments)}}function g(j,O){var R=!1;function A(H){R||(R=!0,f.reject(j,H))}function T(H){R||(R=!0,f.resolve(j,H))}var P=b(function(){O(T,A)});P.status==="error"&&A(P.value)}function b(j,O){var R={};try{R.value=j(O),R.status="success"}catch(A){R.status="error",R.value=A}return R}(p.exports=k).prototype.finally=function(j){if(typeof j!="function")return this;var O=this.constructor;return this.then(function(R){return O.resolve(j()).then(function(){return R})},function(R){return O.resolve(j()).then(function(){throw R})})},k.prototype.catch=function(j){return this.then(null,j)},k.prototype.then=function(j,O){if(typeof j!="function"&&this.state===h||typeof O!="function"&&this.state===v)return this;var R=new this.constructor(l);return this.state!==C?x(R,this.state===h?j:O,this.outcome):this.queue.push(new I(R,j,O)),R},I.prototype.callFulfilled=function(j){f.resolve(this.promise,j)},I.prototype.otherCallFulfilled=function(j){x(this.promise,this.onFulfilled,j)},I.prototype.callRejected=function(j){f.reject(this.promise,j)},I.prototype.otherCallRejected=function(j){x(this.promise,this.onRejected,j)},f.resolve=function(j,O){var R=b(S,O);if(R.status==="error")return f.reject(j,R.value);var A=R.value;if(A)g(j,A);else{j.state=h,j.outcome=O;for(var T=-1,P=j.queue.length;++T<P;)j.queue[T].callFulfilled(O)}return j},f.reject=function(j,O){j.state=v,j.outcome=O;for(var R=-1,A=j.queue.length;++R<A;)j.queue[R].callRejected(O);return j},k.resolve=function(j){return j instanceof this?j:f.resolve(new this(l),j)},k.reject=function(j){var O=new this(l);return f.reject(O,j)},k.all=function(j){var O=this;if(Object.prototype.toString.call(j)!=="[object Array]")return this.reject(new TypeError("must be an array"));var R=j.length,A=!1;if(!R)return this.resolve([]);for(var T=new Array(R),P=0,H=-1,K=new this(l);++H<R;)W(j[H],H);return K;function W(B,Y){O.resolve(B).then(function(q){T[Y]=q,++P!==R||A||(A=!0,f.resolve(K,T))},function(q){A||(A=!0,f.reject(K,q))})}},k.race=function(j){var O=this;if(Object.prototype.toString.call(j)!=="[object Array]")return this.reject(new TypeError("must be an array"));var R=j.length,A=!1;if(!R)return this.resolve([]);for(var T=-1,P=new this(l);++T<R;)H=j[T],O.resolve(H).then(function(K){A||(A=!0,f.resolve(P,K))},function(K){A||(A=!0,f.reject(P,K))});var H;return P}},{immediate:36}],38:[function(o,p,d){var c={};(0,o("./lib/utils/common").assign)(c,o("./lib/deflate"),o("./lib/inflate"),o("./lib/zlib/constants")),p.exports=c},{"./lib/deflate":39,"./lib/inflate":40,"./lib/utils/common":41,"./lib/zlib/constants":44}],39:[function(o,p,d){var c=o("./zlib/deflate"),l=o("./utils/common"),f=o("./utils/strings"),v=o("./zlib/messages"),h=o("./zlib/zstream"),C=Object.prototype.toString,k=0,I=-1,x=0,S=8;function g(j){if(!(this instanceof g))return new g(j);this.options=l.assign({level:I,method:S,chunkSize:16384,windowBits:15,memLevel:8,strategy:x,to:""},j||{});var O=this.options;O.raw&&0<O.windowBits?O.windowBits=-O.windowBits:O.gzip&&0<O.windowBits&&O.windowBits<16&&(O.windowBits+=16),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new h,this.strm.avail_out=0;var R=c.deflateInit2(this.strm,O.level,O.method,O.windowBits,O.memLevel,O.strategy);if(R!==k)throw new Error(v[R]);if(O.header&&c.deflateSetHeader(this.strm,O.header),O.dictionary){var A;if(A=typeof O.dictionary=="string"?f.string2buf(O.dictionary):C.call(O.dictionary)==="[object ArrayBuffer]"?new Uint8Array(O.dictionary):O.dictionary,(R=c.deflateSetDictionary(this.strm,A))!==k)throw new Error(v[R]);this._dict_set=!0}}function b(j,O){var R=new g(O);if(R.push(j,!0),R.err)throw R.msg||v[R.err];return R.result}g.prototype.push=function(j,O){var R,A,T=this.strm,P=this.options.chunkSize;if(this.ended)return!1;A=O===~~O?O:O===!0?4:0,typeof j=="string"?T.input=f.string2buf(j):C.call(j)==="[object ArrayBuffer]"?T.input=new Uint8Array(j):T.input=j,T.next_in=0,T.avail_in=T.input.length;do{if(T.avail_out===0&&(T.output=new l.Buf8(P),T.next_out=0,T.avail_out=P),(R=c.deflate(T,A))!==1&&R!==k)return this.onEnd(R),!(this.ended=!0);T.avail_out!==0&&(T.avail_in!==0||A!==4&&A!==2)||(this.options.to==="string"?this.onData(f.buf2binstring(l.shrinkBuf(T.output,T.next_out))):this.onData(l.shrinkBuf(T.output,T.next_out)))}while((0<T.avail_in||T.avail_out===0)&&R!==1);return A===4?(R=c.deflateEnd(this.strm),this.onEnd(R),this.ended=!0,R===k):A!==2||(this.onEnd(k),!(T.avail_out=0))},g.prototype.onData=function(j){this.chunks.push(j)},g.prototype.onEnd=function(j){j===k&&(this.options.to==="string"?this.result=this.chunks.join(""):this.result=l.flattenChunks(this.chunks)),this.chunks=[],this.err=j,this.msg=this.strm.msg},d.Deflate=g,d.deflate=b,d.deflateRaw=function(j,O){return(O=O||{}).raw=!0,b(j,O)},d.gzip=function(j,O){return(O=O||{}).gzip=!0,b(j,O)}},{"./utils/common":41,"./utils/strings":42,"./zlib/deflate":46,"./zlib/messages":51,"./zlib/zstream":53}],40:[function(o,p,d){var c=o("./zlib/inflate"),l=o("./utils/common"),f=o("./utils/strings"),v=o("./zlib/constants"),h=o("./zlib/messages"),C=o("./zlib/zstream"),k=o("./zlib/gzheader"),I=Object.prototype.toString;function x(g){if(!(this instanceof x))return new x(g);this.options=l.assign({chunkSize:16384,windowBits:0,to:""},g||{});var b=this.options;b.raw&&0<=b.windowBits&&b.windowBits<16&&(b.windowBits=-b.windowBits,b.windowBits===0&&(b.windowBits=-15)),!(0<=b.windowBits&&b.windowBits<16)||g&&g.windowBits||(b.windowBits+=32),15<b.windowBits&&b.windowBits<48&&(15&b.windowBits)==0&&(b.windowBits|=15),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new C,this.strm.avail_out=0;var j=c.inflateInit2(this.strm,b.windowBits);if(j!==v.Z_OK)throw new Error(h[j]);this.header=new k,c.inflateGetHeader(this.strm,this.header)}function S(g,b){var j=new x(b);if(j.push(g,!0),j.err)throw j.msg||h[j.err];return j.result}x.prototype.push=function(g,b){var j,O,R,A,T,P,H=this.strm,K=this.options.chunkSize,W=this.options.dictionary,B=!1;if(this.ended)return!1;O=b===~~b?b:b===!0?v.Z_FINISH:v.Z_NO_FLUSH,typeof g=="string"?H.input=f.binstring2buf(g):I.call(g)==="[object ArrayBuffer]"?H.input=new Uint8Array(g):H.input=g,H.next_in=0,H.avail_in=H.input.length;do{if(H.avail_out===0&&(H.output=new l.Buf8(K),H.next_out=0,H.avail_out=K),(j=c.inflate(H,v.Z_NO_FLUSH))===v.Z_NEED_DICT&&W&&(P=typeof W=="string"?f.string2buf(W):I.call(W)==="[object ArrayBuffer]"?new Uint8Array(W):W,j=c.inflateSetDictionary(this.strm,P)),j===v.Z_BUF_ERROR&&B===!0&&(j=v.Z_OK,B=!1),j!==v.Z_STREAM_END&&j!==v.Z_OK)return this.onEnd(j),!(this.ended=!0);H.next_out&&(H.avail_out!==0&&j!==v.Z_STREAM_END&&(H.avail_in!==0||O!==v.Z_FINISH&&O!==v.Z_SYNC_FLUSH)||(this.options.to==="string"?(R=f.utf8border(H.output,H.next_out),A=H.next_out-R,T=f.buf2string(H.output,R),H.next_out=A,H.avail_out=K-A,A&&l.arraySet(H.output,H.output,R,A,0),this.onData(T)):this.onData(l.shrinkBuf(H.output,H.next_out)))),H.avail_in===0&&H.avail_out===0&&(B=!0)}while((0<H.avail_in||H.avail_out===0)&&j!==v.Z_STREAM_END);return j===v.Z_STREAM_END&&(O=v.Z_FINISH),O===v.Z_FINISH?(j=c.inflateEnd(this.strm),this.onEnd(j),this.ended=!0,j===v.Z_OK):O!==v.Z_SYNC_FLUSH||(this.onEnd(v.Z_OK),!(H.avail_out=0))},x.prototype.onData=function(g){this.chunks.push(g)},x.prototype.onEnd=function(g){g===v.Z_OK&&(this.options.to==="string"?this.result=this.chunks.join(""):this.result=l.flattenChunks(this.chunks)),this.chunks=[],this.err=g,this.msg=this.strm.msg},d.Inflate=x,d.inflate=S,d.inflateRaw=function(g,b){return(b=b||{}).raw=!0,S(g,b)},d.ungzip=S},{"./utils/common":41,"./utils/strings":42,"./zlib/constants":44,"./zlib/gzheader":47,"./zlib/inflate":49,"./zlib/messages":51,"./zlib/zstream":53}],41:[function(o,p,d){var c=typeof Uint8Array<"u"&&typeof Uint16Array<"u"&&typeof Int32Array<"u";d.assign=function(v){for(var h=Array.prototype.slice.call(arguments,1);h.length;){var C=h.shift();if(C){if(typeof C!="object")throw new TypeError(C+"must be non-object");for(var k in C)C.hasOwnProperty(k)&&(v[k]=C[k])}}return v},d.shrinkBuf=function(v,h){return v.length===h?v:v.subarray?v.subarray(0,h):(v.length=h,v)};var l={arraySet:function(v,h,C,k,I){if(h.subarray&&v.subarray)v.set(h.subarray(C,C+k),I);else for(var x=0;x<k;x++)v[I+x]=h[C+x]},flattenChunks:function(v){var h,C,k,I,x,S;for(h=k=0,C=v.length;h<C;h++)k+=v[h].length;for(S=new Uint8Array(k),h=I=0,C=v.length;h<C;h++)x=v[h],S.set(x,I),I+=x.length;return S}},f={arraySet:function(v,h,C,k,I){for(var x=0;x<k;x++)v[I+x]=h[C+x]},flattenChunks:function(v){return[].concat.apply([],v)}};d.setTyped=function(v){v?(d.Buf8=Uint8Array,d.Buf16=Uint16Array,d.Buf32=Int32Array,d.assign(d,l)):(d.Buf8=Array,d.Buf16=Array,d.Buf32=Array,d.assign(d,f))},d.setTyped(c)},{}],42:[function(o,p,d){var c=o("./common"),l=!0,f=!0;try{String.fromCharCode.apply(null,[0])}catch{l=!1}try{String.fromCharCode.apply(null,new Uint8Array(1))}catch{f=!1}for(var v=new c.Buf8(256),h=0;h<256;h++)v[h]=252<=h?6:248<=h?5:240<=h?4:224<=h?3:192<=h?2:1;function C(k,I){if(I<65537&&(k.subarray&&f||!k.subarray&&l))return String.fromCharCode.apply(null,c.shrinkBuf(k,I));for(var x="",S=0;S<I;S++)x+=String.fromCharCode(k[S]);return x}v[254]=v[254]=1,d.string2buf=function(k){var I,x,S,g,b,j=k.length,O=0;for(g=0;g<j;g++)(64512&(x=k.charCodeAt(g)))==55296&&g+1<j&&(64512&(S=k.charCodeAt(g+1)))==56320&&(x=65536+(x-55296<<10)+(S-56320),g++),O+=x<128?1:x<2048?2:x<65536?3:4;for(I=new c.Buf8(O),g=b=0;b<O;g++)(64512&(x=k.charCodeAt(g)))==55296&&g+1<j&&(64512&(S=k.charCodeAt(g+1)))==56320&&(x=65536+(x-55296<<10)+(S-56320),g++),x<128?I[b++]=x:(x<2048?I[b++]=192|x>>>6:(x<65536?I[b++]=224|x>>>12:(I[b++]=240|x>>>18,I[b++]=128|x>>>12&63),I[b++]=128|x>>>6&63),I[b++]=128|63&x);return I},d.buf2binstring=function(k){return C(k,k.length)},d.binstring2buf=function(k){for(var I=new c.Buf8(k.length),x=0,S=I.length;x<S;x++)I[x]=k.charCodeAt(x);return I},d.buf2string=function(k,I){var x,S,g,b,j=I||k.length,O=new Array(2*j);for(x=S=0;x<j;)if((g=k[x++])<128)O[S++]=g;else if(4<(b=v[g]))O[S++]=65533,x+=b-1;else{for(g&=b===2?31:b===3?15:7;1<b&&x<j;)g=g<<6|63&k[x++],b--;1<b?O[S++]=65533:g<65536?O[S++]=g:(g-=65536,O[S++]=55296|g>>10&1023,O[S++]=56320|1023&g)}return C(O,S)},d.utf8border=function(k,I){var x;for((I=I||k.length)>k.length&&(I=k.length),x=I-1;0<=x&&(192&k[x])==128;)x--;return x<0||x===0?I:x+v[k[x]]>I?x:I}},{"./common":41}],43:[function(o,p,d){p.exports=function(c,l,f,v){for(var h=65535&c|0,C=c>>>16&65535|0,k=0;f!==0;){for(f-=k=2e3<f?2e3:f;C=C+(h=h+l[v++]|0)|0,--k;);h%=65521,C%=65521}return h|C<<16|0}},{}],44:[function(o,p,d){p.exports={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_ERRNO:-1,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_BUF_ERROR:-5,Z_NO_COMPRESSION:0,Z_BEST_SPEED:1,Z_BEST_COMPRESSION:9,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_BINARY:0,Z_TEXT:1,Z_UNKNOWN:2,Z_DEFLATED:8}},{}],45:[function(o,p,d){var c=function(){for(var l,f=[],v=0;v<256;v++){l=v;for(var h=0;h<8;h++)l=1&l?3988292384^l>>>1:l>>>1;f[v]=l}return f}();p.exports=function(l,f,v,h){var C=c,k=h+v;l^=-1;for(var I=h;I<k;I++)l=l>>>8^C[255&(l^f[I])];return-1^l}},{}],46:[function(o,p,d){var c,l=o("../utils/common"),f=o("./trees"),v=o("./adler32"),h=o("./crc32"),C=o("./messages"),k=0,I=4,x=0,S=-2,g=-1,b=4,j=2,O=8,R=9,A=286,T=30,P=19,H=2*A+1,K=15,W=3,B=258,Y=B+W+1,q=42,Q=113,N=1,Z=2,oe=3,fe=4;function ye(E,ge){return E.msg=C[ge],ge}function ue(E){return(E<<1)-(4<E?9:0)}function z(E){for(var ge=E.length;0<=--ge;)E[ge]=0}function _(E){var ge=E.state,re=ge.pending;re>E.avail_out&&(re=E.avail_out),re!==0&&(l.arraySet(E.output,ge.pending_buf,ge.pending_out,re,E.next_out),E.next_out+=re,ge.pending_out+=re,E.total_out+=re,E.avail_out-=re,ge.pending-=re,ge.pending===0&&(ge.pending_out=0))}function F(E,ge){f._tr_flush_block(E,0<=E.block_start?E.block_start:-1,E.strstart-E.block_start,ge),E.block_start=E.strstart,_(E.strm)}function de(E,ge){E.pending_buf[E.pending++]=ge}function he(E,ge){E.pending_buf[E.pending++]=ge>>>8&255,E.pending_buf[E.pending++]=255&ge}function ie(E,ge){var re,$,G=E.max_chain_length,ee=E.strstart,ce=E.prev_length,le=E.nice_match,ne=E.strstart>E.w_size-Y?E.strstart-(E.w_size-Y):0,je=E.window,Me=E.w_mask,Te=E.prev,ze=E.strstart+B,ut=je[ee+ce-1],rt=je[ee+ce];E.prev_length>=E.good_match&&(G>>=2),le>E.lookahead&&(le=E.lookahead);do if(je[(re=ge)+ce]===rt&&je[re+ce-1]===ut&&je[re]===je[ee]&&je[++re]===je[ee+1]){ee+=2,re++;do;while(je[++ee]===je[++re]&&je[++ee]===je[++re]&&je[++ee]===je[++re]&&je[++ee]===je[++re]&&je[++ee]===je[++re]&&je[++ee]===je[++re]&&je[++ee]===je[++re]&&je[++ee]===je[++re]&&ee<ze);if($=B-(ze-ee),ee=ze-B,ce<$){if(E.match_start=ge,le<=(ce=$))break;ut=je[ee+ce-1],rt=je[ee+ce]}}while((ge=Te[ge&Me])>ne&&--G!=0);return ce<=E.lookahead?ce:E.lookahead}function be(E){var ge,re,$,G,ee,ce,le,ne,je,Me,Te=E.w_size;do{if(G=E.window_size-E.lookahead-E.strstart,E.strstart>=Te+(Te-Y)){for(l.arraySet(E.window,E.window,Te,Te,0),E.match_start-=Te,E.strstart-=Te,E.block_start-=Te,ge=re=E.hash_size;$=E.head[--ge],E.head[ge]=Te<=$?$-Te:0,--re;);for(ge=re=Te;$=E.prev[--ge],E.prev[ge]=Te<=$?$-Te:0,--re;);G+=Te}if(E.strm.avail_in===0)break;if(ce=E.strm,le=E.window,ne=E.strstart+E.lookahead,je=G,Me=void 0,Me=ce.avail_in,je<Me&&(Me=je),re=Me===0?0:(ce.avail_in-=Me,l.arraySet(le,ce.input,ce.next_in,Me,ne),ce.state.wrap===1?ce.adler=v(ce.adler,le,Me,ne):ce.state.wrap===2&&(ce.adler=h(ce.adler,le,Me,ne)),ce.next_in+=Me,ce.total_in+=Me,Me),E.lookahead+=re,E.lookahead+E.insert>=W)for(ee=E.strstart-E.insert,E.ins_h=E.window[ee],E.ins_h=(E.ins_h<<E.hash_shift^E.window[ee+1])&E.hash_mask;E.insert&&(E.ins_h=(E.ins_h<<E.hash_shift^E.window[ee+W-1])&E.hash_mask,E.prev[ee&E.w_mask]=E.head[E.ins_h],E.head[E.ins_h]=ee,ee++,E.insert--,!(E.lookahead+E.insert<W)););}while(E.lookahead<Y&&E.strm.avail_in!==0)}function Ne(E,ge){for(var re,$;;){if(E.lookahead<Y){if(be(E),E.lookahead<Y&&ge===k)return N;if(E.lookahead===0)break}if(re=0,E.lookahead>=W&&(E.ins_h=(E.ins_h<<E.hash_shift^E.window[E.strstart+W-1])&E.hash_mask,re=E.prev[E.strstart&E.w_mask]=E.head[E.ins_h],E.head[E.ins_h]=E.strstart),re!==0&&E.strstart-re<=E.w_size-Y&&(E.match_length=ie(E,re)),E.match_length>=W)if($=f._tr_tally(E,E.strstart-E.match_start,E.match_length-W),E.lookahead-=E.match_length,E.match_length<=E.max_lazy_match&&E.lookahead>=W){for(E.match_length--;E.strstart++,E.ins_h=(E.ins_h<<E.hash_shift^E.window[E.strstart+W-1])&E.hash_mask,re=E.prev[E.strstart&E.w_mask]=E.head[E.ins_h],E.head[E.ins_h]=E.strstart,--E.match_length!=0;);E.strstart++}else E.strstart+=E.match_length,E.match_length=0,E.ins_h=E.window[E.strstart],E.ins_h=(E.ins_h<<E.hash_shift^E.window[E.strstart+1])&E.hash_mask;else $=f._tr_tally(E,0,E.window[E.strstart]),E.lookahead--,E.strstart++;if($&&(F(E,!1),E.strm.avail_out===0))return N}return E.insert=E.strstart<W-1?E.strstart:W-1,ge===I?(F(E,!0),E.strm.avail_out===0?oe:fe):E.last_lit&&(F(E,!1),E.strm.avail_out===0)?N:Z}function Se(E,ge){for(var re,$,G;;){if(E.lookahead<Y){if(be(E),E.lookahead<Y&&ge===k)return N;if(E.lookahead===0)break}if(re=0,E.lookahead>=W&&(E.ins_h=(E.ins_h<<E.hash_shift^E.window[E.strstart+W-1])&E.hash_mask,re=E.prev[E.strstart&E.w_mask]=E.head[E.ins_h],E.head[E.ins_h]=E.strstart),E.prev_length=E.match_length,E.prev_match=E.match_start,E.match_length=W-1,re!==0&&E.prev_length<E.max_lazy_match&&E.strstart-re<=E.w_size-Y&&(E.match_length=ie(E,re),E.match_length<=5&&(E.strategy===1||E.match_length===W&&4096<E.strstart-E.match_start)&&(E.match_length=W-1)),E.prev_length>=W&&E.match_length<=E.prev_length){for(G=E.strstart+E.lookahead-W,$=f._tr_tally(E,E.strstart-1-E.prev_match,E.prev_length-W),E.lookahead-=E.prev_length-1,E.prev_length-=2;++E.strstart<=G&&(E.ins_h=(E.ins_h<<E.hash_shift^E.window[E.strstart+W-1])&E.hash_mask,re=E.prev[E.strstart&E.w_mask]=E.head[E.ins_h],E.head[E.ins_h]=E.strstart),--E.prev_length!=0;);if(E.match_available=0,E.match_length=W-1,E.strstart++,$&&(F(E,!1),E.strm.avail_out===0))return N}else if(E.match_available){if(($=f._tr_tally(E,0,E.window[E.strstart-1]))&&F(E,!1),E.strstart++,E.lookahead--,E.strm.avail_out===0)return N}else E.match_available=1,E.strstart++,E.lookahead--}return E.match_available&&($=f._tr_tally(E,0,E.window[E.strstart-1]),E.match_available=0),E.insert=E.strstart<W-1?E.strstart:W-1,ge===I?(F(E,!0),E.strm.avail_out===0?oe:fe):E.last_lit&&(F(E,!1),E.strm.avail_out===0)?N:Z}function ke(E,ge,re,$,G){this.good_length=E,this.max_lazy=ge,this.nice_length=re,this.max_chain=$,this.func=G}function Ae(){this.strm=null,this.status=0,this.pending_buf=null,this.pending_buf_size=0,this.pending_out=0,this.pending=0,this.wrap=0,this.gzhead=null,this.gzindex=0,this.method=O,this.last_flush=-1,this.w_size=0,this.w_bits=0,this.w_mask=0,this.window=null,this.window_size=0,this.prev=null,this.head=null,this.ins_h=0,this.hash_size=0,this.hash_bits=0,this.hash_mask=0,this.hash_shift=0,this.block_start=0,this.match_length=0,this.prev_match=0,this.match_available=0,this.strstart=0,this.match_start=0,this.lookahead=0,this.prev_length=0,this.max_chain_length=0,this.max_lazy_match=0,this.level=0,this.strategy=0,this.good_match=0,this.nice_match=0,this.dyn_ltree=new l.Buf16(2*H),this.dyn_dtree=new l.Buf16(2*(2*T+1)),this.bl_tree=new l.Buf16(2*(2*P+1)),z(this.dyn_ltree),z(this.dyn_dtree),z(this.bl_tree),this.l_desc=null,this.d_desc=null,this.bl_desc=null,this.bl_count=new l.Buf16(K+1),this.heap=new l.Buf16(2*A+1),z(this.heap),this.heap_len=0,this.heap_max=0,this.depth=new l.Buf16(2*A+1),z(this.depth),this.l_buf=0,this.lit_bufsize=0,this.last_lit=0,this.d_buf=0,this.opt_len=0,this.static_len=0,this.matches=0,this.insert=0,this.bi_buf=0,this.bi_valid=0}function Pe(E){var ge;return E&&E.state?(E.total_in=E.total_out=0,E.data_type=j,(ge=E.state).pending=0,ge.pending_out=0,ge.wrap<0&&(ge.wrap=-ge.wrap),ge.status=ge.wrap?q:Q,E.adler=ge.wrap===2?0:1,ge.last_flush=k,f._tr_init(ge),x):ye(E,S)}function Ye(E){var ge=Pe(E);return ge===x&&function(re){re.window_size=2*re.w_size,z(re.head),re.max_lazy_match=c[re.level].max_lazy,re.good_match=c[re.level].good_length,re.nice_match=c[re.level].nice_length,re.max_chain_length=c[re.level].max_chain,re.strstart=0,re.block_start=0,re.lookahead=0,re.insert=0,re.match_length=re.prev_length=W-1,re.match_available=0,re.ins_h=0}(E.state),ge}function Re(E,ge,re,$,G,ee){if(!E)return S;var ce=1;if(ge===g&&(ge=6),$<0?(ce=0,$=-$):15<$&&(ce=2,$-=16),G<1||R<G||re!==O||$<8||15<$||ge<0||9<ge||ee<0||b<ee)return ye(E,S);$===8&&($=9);var le=new Ae;return(E.state=le).strm=E,le.wrap=ce,le.gzhead=null,le.w_bits=$,le.w_size=1<<le.w_bits,le.w_mask=le.w_size-1,le.hash_bits=G+7,le.hash_size=1<<le.hash_bits,le.hash_mask=le.hash_size-1,le.hash_shift=~~((le.hash_bits+W-1)/W),le.window=new l.Buf8(2*le.w_size),le.head=new l.Buf16(le.hash_size),le.prev=new l.Buf16(le.w_size),le.lit_bufsize=1<<G+6,le.pending_buf_size=4*le.lit_bufsize,le.pending_buf=new l.Buf8(le.pending_buf_size),le.d_buf=1*le.lit_bufsize,le.l_buf=3*le.lit_bufsize,le.level=ge,le.strategy=ee,le.method=re,Ye(E)}c=[new ke(0,0,0,0,function(E,ge){var re=65535;for(re>E.pending_buf_size-5&&(re=E.pending_buf_size-5);;){if(E.lookahead<=1){if(be(E),E.lookahead===0&&ge===k)return N;if(E.lookahead===0)break}E.strstart+=E.lookahead,E.lookahead=0;var $=E.block_start+re;if((E.strstart===0||E.strstart>=$)&&(E.lookahead=E.strstart-$,E.strstart=$,F(E,!1),E.strm.avail_out===0)||E.strstart-E.block_start>=E.w_size-Y&&(F(E,!1),E.strm.avail_out===0))return N}return E.insert=0,ge===I?(F(E,!0),E.strm.avail_out===0?oe:fe):(E.strstart>E.block_start&&(F(E,!1),E.strm.avail_out),N)}),new ke(4,4,8,4,Ne),new ke(4,5,16,8,Ne),new ke(4,6,32,32,Ne),new ke(4,4,16,16,Se),new ke(8,16,32,32,Se),new ke(8,16,128,128,Se),new ke(8,32,128,256,Se),new ke(32,128,258,1024,Se),new ke(32,258,258,4096,Se)],d.deflateInit=function(E,ge){return Re(E,ge,O,15,8,0)},d.deflateInit2=Re,d.deflateReset=Ye,d.deflateResetKeep=Pe,d.deflateSetHeader=function(E,ge){return E&&E.state?E.state.wrap!==2?S:(E.state.gzhead=ge,x):S},d.deflate=function(E,ge){var re,$,G,ee;if(!E||!E.state||5<ge||ge<0)return E?ye(E,S):S;if($=E.state,!E.output||!E.input&&E.avail_in!==0||$.status===666&&ge!==I)return ye(E,E.avail_out===0?-5:S);if($.strm=E,re=$.last_flush,$.last_flush=ge,$.status===q)if($.wrap===2)E.adler=0,de($,31),de($,139),de($,8),$.gzhead?(de($,($.gzhead.text?1:0)+($.gzhead.hcrc?2:0)+($.gzhead.extra?4:0)+($.gzhead.name?8:0)+($.gzhead.comment?16:0)),de($,255&$.gzhead.time),de($,$.gzhead.time>>8&255),de($,$.gzhead.time>>16&255),de($,$.gzhead.time>>24&255),de($,$.level===9?2:2<=$.strategy||$.level<2?4:0),de($,255&$.gzhead.os),$.gzhead.extra&&$.gzhead.extra.length&&(de($,255&$.gzhead.extra.length),de($,$.gzhead.extra.length>>8&255)),$.gzhead.hcrc&&(E.adler=h(E.adler,$.pending_buf,$.pending,0)),$.gzindex=0,$.status=69):(de($,0),de($,0),de($,0),de($,0),de($,0),de($,$.level===9?2:2<=$.strategy||$.level<2?4:0),de($,3),$.status=Q);else{var ce=O+($.w_bits-8<<4)<<8;ce|=(2<=$.strategy||$.level<2?0:$.level<6?1:$.level===6?2:3)<<6,$.strstart!==0&&(ce|=32),ce+=31-ce%31,$.status=Q,he($,ce),$.strstart!==0&&(he($,E.adler>>>16),he($,65535&E.adler)),E.adler=1}if($.status===69)if($.gzhead.extra){for(G=$.pending;$.gzindex<(65535&$.gzhead.extra.length)&&($.pending!==$.pending_buf_size||($.gzhead.hcrc&&$.pending>G&&(E.adler=h(E.adler,$.pending_buf,$.pending-G,G)),_(E),G=$.pending,$.pending!==$.pending_buf_size));)de($,255&$.gzhead.extra[$.gzindex]),$.gzindex++;$.gzhead.hcrc&&$.pending>G&&(E.adler=h(E.adler,$.pending_buf,$.pending-G,G)),$.gzindex===$.gzhead.extra.length&&($.gzindex=0,$.status=73)}else $.status=73;if($.status===73)if($.gzhead.name){G=$.pending;do{if($.pending===$.pending_buf_size&&($.gzhead.hcrc&&$.pending>G&&(E.adler=h(E.adler,$.pending_buf,$.pending-G,G)),_(E),G=$.pending,$.pending===$.pending_buf_size)){ee=1;break}ee=$.gzindex<$.gzhead.name.length?255&$.gzhead.name.charCodeAt($.gzindex++):0,de($,ee)}while(ee!==0);$.gzhead.hcrc&&$.pending>G&&(E.adler=h(E.adler,$.pending_buf,$.pending-G,G)),ee===0&&($.gzindex=0,$.status=91)}else $.status=91;if($.status===91)if($.gzhead.comment){G=$.pending;do{if($.pending===$.pending_buf_size&&($.gzhead.hcrc&&$.pending>G&&(E.adler=h(E.adler,$.pending_buf,$.pending-G,G)),_(E),G=$.pending,$.pending===$.pending_buf_size)){ee=1;break}ee=$.gzindex<$.gzhead.comment.length?255&$.gzhead.comment.charCodeAt($.gzindex++):0,de($,ee)}while(ee!==0);$.gzhead.hcrc&&$.pending>G&&(E.adler=h(E.adler,$.pending_buf,$.pending-G,G)),ee===0&&($.status=103)}else $.status=103;if($.status===103&&($.gzhead.hcrc?($.pending+2>$.pending_buf_size&&_(E),$.pending+2<=$.pending_buf_size&&(de($,255&E.adler),de($,E.adler>>8&255),E.adler=0,$.status=Q)):$.status=Q),$.pending!==0){if(_(E),E.avail_out===0)return $.last_flush=-1,x}else if(E.avail_in===0&&ue(ge)<=ue(re)&&ge!==I)return ye(E,-5);if($.status===666&&E.avail_in!==0)return ye(E,-5);if(E.avail_in!==0||$.lookahead!==0||ge!==k&&$.status!==666){var le=$.strategy===2?function(ne,je){for(var Me;;){if(ne.lookahead===0&&(be(ne),ne.lookahead===0)){if(je===k)return N;break}if(ne.match_length=0,Me=f._tr_tally(ne,0,ne.window[ne.strstart]),ne.lookahead--,ne.strstart++,Me&&(F(ne,!1),ne.strm.avail_out===0))return N}return ne.insert=0,je===I?(F(ne,!0),ne.strm.avail_out===0?oe:fe):ne.last_lit&&(F(ne,!1),ne.strm.avail_out===0)?N:Z}($,ge):$.strategy===3?function(ne,je){for(var Me,Te,ze,ut,rt=ne.window;;){if(ne.lookahead<=B){if(be(ne),ne.lookahead<=B&&je===k)return N;if(ne.lookahead===0)break}if(ne.match_length=0,ne.lookahead>=W&&0<ne.strstart&&(Te=rt[ze=ne.strstart-1])===rt[++ze]&&Te===rt[++ze]&&Te===rt[++ze]){ut=ne.strstart+B;do;while(Te===rt[++ze]&&Te===rt[++ze]&&Te===rt[++ze]&&Te===rt[++ze]&&Te===rt[++ze]&&Te===rt[++ze]&&Te===rt[++ze]&&Te===rt[++ze]&&ze<ut);ne.match_length=B-(ut-ze),ne.match_length>ne.lookahead&&(ne.match_length=ne.lookahead)}if(ne.match_length>=W?(Me=f._tr_tally(ne,1,ne.match_length-W),ne.lookahead-=ne.match_length,ne.strstart+=ne.match_length,ne.match_length=0):(Me=f._tr_tally(ne,0,ne.window[ne.strstart]),ne.lookahead--,ne.strstart++),Me&&(F(ne,!1),ne.strm.avail_out===0))return N}return ne.insert=0,je===I?(F(ne,!0),ne.strm.avail_out===0?oe:fe):ne.last_lit&&(F(ne,!1),ne.strm.avail_out===0)?N:Z}($,ge):c[$.level].func($,ge);if(le!==oe&&le!==fe||($.status=666),le===N||le===oe)return E.avail_out===0&&($.last_flush=-1),x;if(le===Z&&(ge===1?f._tr_align($):ge!==5&&(f._tr_stored_block($,0,0,!1),ge===3&&(z($.head),$.lookahead===0&&($.strstart=0,$.block_start=0,$.insert=0))),_(E),E.avail_out===0))return $.last_flush=-1,x}return ge!==I?x:$.wrap<=0?1:($.wrap===2?(de($,255&E.adler),de($,E.adler>>8&255),de($,E.adler>>16&255),de($,E.adler>>24&255),de($,255&E.total_in),de($,E.total_in>>8&255),de($,E.total_in>>16&255),de($,E.total_in>>24&255)):(he($,E.adler>>>16),he($,65535&E.adler)),_(E),0<$.wrap&&($.wrap=-$.wrap),$.pending!==0?x:1)},d.deflateEnd=function(E){var ge;return E&&E.state?(ge=E.state.status)!==q&&ge!==69&&ge!==73&&ge!==91&&ge!==103&&ge!==Q&&ge!==666?ye(E,S):(E.state=null,ge===Q?ye(E,-3):x):S},d.deflateSetDictionary=function(E,ge){var re,$,G,ee,ce,le,ne,je,Me=ge.length;if(!E||!E.state||(ee=(re=E.state).wrap)===2||ee===1&&re.status!==q||re.lookahead)return S;for(ee===1&&(E.adler=v(E.adler,ge,Me,0)),re.wrap=0,Me>=re.w_size&&(ee===0&&(z(re.head),re.strstart=0,re.block_start=0,re.insert=0),je=new l.Buf8(re.w_size),l.arraySet(je,ge,Me-re.w_size,re.w_size,0),ge=je,Me=re.w_size),ce=E.avail_in,le=E.next_in,ne=E.input,E.avail_in=Me,E.next_in=0,E.input=ge,be(re);re.lookahead>=W;){for($=re.strstart,G=re.lookahead-(W-1);re.ins_h=(re.ins_h<<re.hash_shift^re.window[$+W-1])&re.hash_mask,re.prev[$&re.w_mask]=re.head[re.ins_h],re.head[re.ins_h]=$,$++,--G;);re.strstart=$,re.lookahead=W-1,be(re)}return re.strstart+=re.lookahead,re.block_start=re.strstart,re.insert=re.lookahead,re.lookahead=0,re.match_length=re.prev_length=W-1,re.match_available=0,E.next_in=le,E.input=ne,E.avail_in=ce,re.wrap=ee,x},d.deflateInfo="pako deflate (from Nodeca project)"},{"../utils/common":41,"./adler32":43,"./crc32":45,"./messages":51,"./trees":52}],47:[function(o,p,d){p.exports=function(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name="",this.comment="",this.hcrc=0,this.done=!1}},{}],48:[function(o,p,d){p.exports=function(c,l){var f,v,h,C,k,I,x,S,g,b,j,O,R,A,T,P,H,K,W,B,Y,q,Q,N,Z;f=c.state,v=c.next_in,N=c.input,h=v+(c.avail_in-5),C=c.next_out,Z=c.output,k=C-(l-c.avail_out),I=C+(c.avail_out-257),x=f.dmax,S=f.wsize,g=f.whave,b=f.wnext,j=f.window,O=f.hold,R=f.bits,A=f.lencode,T=f.distcode,P=(1<<f.lenbits)-1,H=(1<<f.distbits)-1;e:do{R<15&&(O+=N[v++]<<R,R+=8,O+=N[v++]<<R,R+=8),K=A[O&P];t:for(;;){if(O>>>=W=K>>>24,R-=W,(W=K>>>16&255)===0)Z[C++]=65535&K;else{if(!(16&W)){if((64&W)==0){K=A[(65535&K)+(O&(1<<W)-1)];continue t}if(32&W){f.mode=12;break e}c.msg="invalid literal/length code",f.mode=30;break e}B=65535&K,(W&=15)&&(R<W&&(O+=N[v++]<<R,R+=8),B+=O&(1<<W)-1,O>>>=W,R-=W),R<15&&(O+=N[v++]<<R,R+=8,O+=N[v++]<<R,R+=8),K=T[O&H];r:for(;;){if(O>>>=W=K>>>24,R-=W,!(16&(W=K>>>16&255))){if((64&W)==0){K=T[(65535&K)+(O&(1<<W)-1)];continue r}c.msg="invalid distance code",f.mode=30;break e}if(Y=65535&K,R<(W&=15)&&(O+=N[v++]<<R,(R+=8)<W&&(O+=N[v++]<<R,R+=8)),x<(Y+=O&(1<<W)-1)){c.msg="invalid distance too far back",f.mode=30;break e}if(O>>>=W,R-=W,(W=C-k)<Y){if(g<(W=Y-W)&&f.sane){c.msg="invalid distance too far back",f.mode=30;break e}if(Q=j,(q=0)===b){if(q+=S-W,W<B){for(B-=W;Z[C++]=j[q++],--W;);q=C-Y,Q=Z}}else if(b<W){if(q+=S+b-W,(W-=b)<B){for(B-=W;Z[C++]=j[q++],--W;);if(q=0,b<B){for(B-=W=b;Z[C++]=j[q++],--W;);q=C-Y,Q=Z}}}else if(q+=b-W,W<B){for(B-=W;Z[C++]=j[q++],--W;);q=C-Y,Q=Z}for(;2<B;)Z[C++]=Q[q++],Z[C++]=Q[q++],Z[C++]=Q[q++],B-=3;B&&(Z[C++]=Q[q++],1<B&&(Z[C++]=Q[q++]))}else{for(q=C-Y;Z[C++]=Z[q++],Z[C++]=Z[q++],Z[C++]=Z[q++],2<(B-=3););B&&(Z[C++]=Z[q++],1<B&&(Z[C++]=Z[q++]))}break}}break}}while(v<h&&C<I);v-=B=R>>3,O&=(1<<(R-=B<<3))-1,c.next_in=v,c.next_out=C,c.avail_in=v<h?h-v+5:5-(v-h),c.avail_out=C<I?I-C+257:257-(C-I),f.hold=O,f.bits=R}},{}],49:[function(o,p,d){var c=o("../utils/common"),l=o("./adler32"),f=o("./crc32"),v=o("./inffast"),h=o("./inftrees"),C=1,k=2,I=0,x=-2,S=1,g=852,b=592;function j(q){return(q>>>24&255)+(q>>>8&65280)+((65280&q)<<8)+((255&q)<<24)}function O(){this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new c.Buf16(320),this.work=new c.Buf16(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}function R(q){var Q;return q&&q.state?(Q=q.state,q.total_in=q.total_out=Q.total=0,q.msg="",Q.wrap&&(q.adler=1&Q.wrap),Q.mode=S,Q.last=0,Q.havedict=0,Q.dmax=32768,Q.head=null,Q.hold=0,Q.bits=0,Q.lencode=Q.lendyn=new c.Buf32(g),Q.distcode=Q.distdyn=new c.Buf32(b),Q.sane=1,Q.back=-1,I):x}function A(q){var Q;return q&&q.state?((Q=q.state).wsize=0,Q.whave=0,Q.wnext=0,R(q)):x}function T(q,Q){var N,Z;return q&&q.state?(Z=q.state,Q<0?(N=0,Q=-Q):(N=1+(Q>>4),Q<48&&(Q&=15)),Q&&(Q<8||15<Q)?x:(Z.window!==null&&Z.wbits!==Q&&(Z.window=null),Z.wrap=N,Z.wbits=Q,A(q))):x}function P(q,Q){var N,Z;return q?(Z=new O,(q.state=Z).window=null,(N=T(q,Q))!==I&&(q.state=null),N):x}var H,K,W=!0;function B(q){if(W){var Q;for(H=new c.Buf32(512),K=new c.Buf32(32),Q=0;Q<144;)q.lens[Q++]=8;for(;Q<256;)q.lens[Q++]=9;for(;Q<280;)q.lens[Q++]=7;for(;Q<288;)q.lens[Q++]=8;for(h(C,q.lens,0,288,H,0,q.work,{bits:9}),Q=0;Q<32;)q.lens[Q++]=5;h(k,q.lens,0,32,K,0,q.work,{bits:5}),W=!1}q.lencode=H,q.lenbits=9,q.distcode=K,q.distbits=5}function Y(q,Q,N,Z){var oe,fe=q.state;return fe.window===null&&(fe.wsize=1<<fe.wbits,fe.wnext=0,fe.whave=0,fe.window=new c.Buf8(fe.wsize)),Z>=fe.wsize?(c.arraySet(fe.window,Q,N-fe.wsize,fe.wsize,0),fe.wnext=0,fe.whave=fe.wsize):(Z<(oe=fe.wsize-fe.wnext)&&(oe=Z),c.arraySet(fe.window,Q,N-Z,oe,fe.wnext),(Z-=oe)?(c.arraySet(fe.window,Q,N-Z,Z,0),fe.wnext=Z,fe.whave=fe.wsize):(fe.wnext+=oe,fe.wnext===fe.wsize&&(fe.wnext=0),fe.whave<fe.wsize&&(fe.whave+=oe))),0}d.inflateReset=A,d.inflateReset2=T,d.inflateResetKeep=R,d.inflateInit=function(q){return P(q,15)},d.inflateInit2=P,d.inflate=function(q,Q){var N,Z,oe,fe,ye,ue,z,_,F,de,he,ie,be,Ne,Se,ke,Ae,Pe,Ye,Re,E,ge,re,$,G=0,ee=new c.Buf8(4),ce=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15];if(!q||!q.state||!q.output||!q.input&&q.avail_in!==0)return x;(N=q.state).mode===12&&(N.mode=13),ye=q.next_out,oe=q.output,z=q.avail_out,fe=q.next_in,Z=q.input,ue=q.avail_in,_=N.hold,F=N.bits,de=ue,he=z,ge=I;e:for(;;)switch(N.mode){case S:if(N.wrap===0){N.mode=13;break}for(;F<16;){if(ue===0)break e;ue--,_+=Z[fe++]<<F,F+=8}if(2&N.wrap&&_===35615){ee[N.check=0]=255&_,ee[1]=_>>>8&255,N.check=f(N.check,ee,2,0),F=_=0,N.mode=2;break}if(N.flags=0,N.head&&(N.head.done=!1),!(1&N.wrap)||(((255&_)<<8)+(_>>8))%31){q.msg="incorrect header check",N.mode=30;break}if((15&_)!=8){q.msg="unknown compression method",N.mode=30;break}if(F-=4,E=8+(15&(_>>>=4)),N.wbits===0)N.wbits=E;else if(E>N.wbits){q.msg="invalid window size",N.mode=30;break}N.dmax=1<<E,q.adler=N.check=1,N.mode=512&_?10:12,F=_=0;break;case 2:for(;F<16;){if(ue===0)break e;ue--,_+=Z[fe++]<<F,F+=8}if(N.flags=_,(255&N.flags)!=8){q.msg="unknown compression method",N.mode=30;break}if(57344&N.flags){q.msg="unknown header flags set",N.mode=30;break}N.head&&(N.head.text=_>>8&1),512&N.flags&&(ee[0]=255&_,ee[1]=_>>>8&255,N.check=f(N.check,ee,2,0)),F=_=0,N.mode=3;case 3:for(;F<32;){if(ue===0)break e;ue--,_+=Z[fe++]<<F,F+=8}N.head&&(N.head.time=_),512&N.flags&&(ee[0]=255&_,ee[1]=_>>>8&255,ee[2]=_>>>16&255,ee[3]=_>>>24&255,N.check=f(N.check,ee,4,0)),F=_=0,N.mode=4;case 4:for(;F<16;){if(ue===0)break e;ue--,_+=Z[fe++]<<F,F+=8}N.head&&(N.head.xflags=255&_,N.head.os=_>>8),512&N.flags&&(ee[0]=255&_,ee[1]=_>>>8&255,N.check=f(N.check,ee,2,0)),F=_=0,N.mode=5;case 5:if(1024&N.flags){for(;F<16;){if(ue===0)break e;ue--,_+=Z[fe++]<<F,F+=8}N.length=_,N.head&&(N.head.extra_len=_),512&N.flags&&(ee[0]=255&_,ee[1]=_>>>8&255,N.check=f(N.check,ee,2,0)),F=_=0}else N.head&&(N.head.extra=null);N.mode=6;case 6:if(1024&N.flags&&(ue<(ie=N.length)&&(ie=ue),ie&&(N.head&&(E=N.head.extra_len-N.length,N.head.extra||(N.head.extra=new Array(N.head.extra_len)),c.arraySet(N.head.extra,Z,fe,ie,E)),512&N.flags&&(N.check=f(N.check,Z,ie,fe)),ue-=ie,fe+=ie,N.length-=ie),N.length))break e;N.length=0,N.mode=7;case 7:if(2048&N.flags){if(ue===0)break e;for(ie=0;E=Z[fe+ie++],N.head&&E&&N.length<65536&&(N.head.name+=String.fromCharCode(E)),E&&ie<ue;);if(512&N.flags&&(N.check=f(N.check,Z,ie,fe)),ue-=ie,fe+=ie,E)break e}else N.head&&(N.head.name=null);N.length=0,N.mode=8;case 8:if(4096&N.flags){if(ue===0)break e;for(ie=0;E=Z[fe+ie++],N.head&&E&&N.length<65536&&(N.head.comment+=String.fromCharCode(E)),E&&ie<ue;);if(512&N.flags&&(N.check=f(N.check,Z,ie,fe)),ue-=ie,fe+=ie,E)break e}else N.head&&(N.head.comment=null);N.mode=9;case 9:if(512&N.flags){for(;F<16;){if(ue===0)break e;ue--,_+=Z[fe++]<<F,F+=8}if(_!==(65535&N.check)){q.msg="header crc mismatch",N.mode=30;break}F=_=0}N.head&&(N.head.hcrc=N.flags>>9&1,N.head.done=!0),q.adler=N.check=0,N.mode=12;break;case 10:for(;F<32;){if(ue===0)break e;ue--,_+=Z[fe++]<<F,F+=8}q.adler=N.check=j(_),F=_=0,N.mode=11;case 11:if(N.havedict===0)return q.next_out=ye,q.avail_out=z,q.next_in=fe,q.avail_in=ue,N.hold=_,N.bits=F,2;q.adler=N.check=1,N.mode=12;case 12:if(Q===5||Q===6)break e;case 13:if(N.last){_>>>=7&F,F-=7&F,N.mode=27;break}for(;F<3;){if(ue===0)break e;ue--,_+=Z[fe++]<<F,F+=8}switch(N.last=1&_,F-=1,3&(_>>>=1)){case 0:N.mode=14;break;case 1:if(B(N),N.mode=20,Q!==6)break;_>>>=2,F-=2;break e;case 2:N.mode=17;break;case 3:q.msg="invalid block type",N.mode=30}_>>>=2,F-=2;break;case 14:for(_>>>=7&F,F-=7&F;F<32;){if(ue===0)break e;ue--,_+=Z[fe++]<<F,F+=8}if((65535&_)!=(_>>>16^65535)){q.msg="invalid stored block lengths",N.mode=30;break}if(N.length=65535&_,F=_=0,N.mode=15,Q===6)break e;case 15:N.mode=16;case 16:if(ie=N.length){if(ue<ie&&(ie=ue),z<ie&&(ie=z),ie===0)break e;c.arraySet(oe,Z,fe,ie,ye),ue-=ie,fe+=ie,z-=ie,ye+=ie,N.length-=ie;break}N.mode=12;break;case 17:for(;F<14;){if(ue===0)break e;ue--,_+=Z[fe++]<<F,F+=8}if(N.nlen=257+(31&_),_>>>=5,F-=5,N.ndist=1+(31&_),_>>>=5,F-=5,N.ncode=4+(15&_),_>>>=4,F-=4,286<N.nlen||30<N.ndist){q.msg="too many length or distance symbols",N.mode=30;break}N.have=0,N.mode=18;case 18:for(;N.have<N.ncode;){for(;F<3;){if(ue===0)break e;ue--,_+=Z[fe++]<<F,F+=8}N.lens[ce[N.have++]]=7&_,_>>>=3,F-=3}for(;N.have<19;)N.lens[ce[N.have++]]=0;if(N.lencode=N.lendyn,N.lenbits=7,re={bits:N.lenbits},ge=h(0,N.lens,0,19,N.lencode,0,N.work,re),N.lenbits=re.bits,ge){q.msg="invalid code lengths set",N.mode=30;break}N.have=0,N.mode=19;case 19:for(;N.have<N.nlen+N.ndist;){for(;ke=(G=N.lencode[_&(1<<N.lenbits)-1])>>>16&255,Ae=65535&G,!((Se=G>>>24)<=F);){if(ue===0)break e;ue--,_+=Z[fe++]<<F,F+=8}if(Ae<16)_>>>=Se,F-=Se,N.lens[N.have++]=Ae;else{if(Ae===16){for($=Se+2;F<$;){if(ue===0)break e;ue--,_+=Z[fe++]<<F,F+=8}if(_>>>=Se,F-=Se,N.have===0){q.msg="invalid bit length repeat",N.mode=30;break}E=N.lens[N.have-1],ie=3+(3&_),_>>>=2,F-=2}else if(Ae===17){for($=Se+3;F<$;){if(ue===0)break e;ue--,_+=Z[fe++]<<F,F+=8}F-=Se,E=0,ie=3+(7&(_>>>=Se)),_>>>=3,F-=3}else{for($=Se+7;F<$;){if(ue===0)break e;ue--,_+=Z[fe++]<<F,F+=8}F-=Se,E=0,ie=11+(127&(_>>>=Se)),_>>>=7,F-=7}if(N.have+ie>N.nlen+N.ndist){q.msg="invalid bit length repeat",N.mode=30;break}for(;ie--;)N.lens[N.have++]=E}}if(N.mode===30)break;if(N.lens[256]===0){q.msg="invalid code -- missing end-of-block",N.mode=30;break}if(N.lenbits=9,re={bits:N.lenbits},ge=h(C,N.lens,0,N.nlen,N.lencode,0,N.work,re),N.lenbits=re.bits,ge){q.msg="invalid literal/lengths set",N.mode=30;break}if(N.distbits=6,N.distcode=N.distdyn,re={bits:N.distbits},ge=h(k,N.lens,N.nlen,N.ndist,N.distcode,0,N.work,re),N.distbits=re.bits,ge){q.msg="invalid distances set",N.mode=30;break}if(N.mode=20,Q===6)break e;case 20:N.mode=21;case 21:if(6<=ue&&258<=z){q.next_out=ye,q.avail_out=z,q.next_in=fe,q.avail_in=ue,N.hold=_,N.bits=F,v(q,he),ye=q.next_out,oe=q.output,z=q.avail_out,fe=q.next_in,Z=q.input,ue=q.avail_in,_=N.hold,F=N.bits,N.mode===12&&(N.back=-1);break}for(N.back=0;ke=(G=N.lencode[_&(1<<N.lenbits)-1])>>>16&255,Ae=65535&G,!((Se=G>>>24)<=F);){if(ue===0)break e;ue--,_+=Z[fe++]<<F,F+=8}if(ke&&(240&ke)==0){for(Pe=Se,Ye=ke,Re=Ae;ke=(G=N.lencode[Re+((_&(1<<Pe+Ye)-1)>>Pe)])>>>16&255,Ae=65535&G,!(Pe+(Se=G>>>24)<=F);){if(ue===0)break e;ue--,_+=Z[fe++]<<F,F+=8}_>>>=Pe,F-=Pe,N.back+=Pe}if(_>>>=Se,F-=Se,N.back+=Se,N.length=Ae,ke===0){N.mode=26;break}if(32&ke){N.back=-1,N.mode=12;break}if(64&ke){q.msg="invalid literal/length code",N.mode=30;break}N.extra=15&ke,N.mode=22;case 22:if(N.extra){for($=N.extra;F<$;){if(ue===0)break e;ue--,_+=Z[fe++]<<F,F+=8}N.length+=_&(1<<N.extra)-1,_>>>=N.extra,F-=N.extra,N.back+=N.extra}N.was=N.length,N.mode=23;case 23:for(;ke=(G=N.distcode[_&(1<<N.distbits)-1])>>>16&255,Ae=65535&G,!((Se=G>>>24)<=F);){if(ue===0)break e;ue--,_+=Z[fe++]<<F,F+=8}if((240&ke)==0){for(Pe=Se,Ye=ke,Re=Ae;ke=(G=N.distcode[Re+((_&(1<<Pe+Ye)-1)>>Pe)])>>>16&255,Ae=65535&G,!(Pe+(Se=G>>>24)<=F);){if(ue===0)break e;ue--,_+=Z[fe++]<<F,F+=8}_>>>=Pe,F-=Pe,N.back+=Pe}if(_>>>=Se,F-=Se,N.back+=Se,64&ke){q.msg="invalid distance code",N.mode=30;break}N.offset=Ae,N.extra=15&ke,N.mode=24;case 24:if(N.extra){for($=N.extra;F<$;){if(ue===0)break e;ue--,_+=Z[fe++]<<F,F+=8}N.offset+=_&(1<<N.extra)-1,_>>>=N.extra,F-=N.extra,N.back+=N.extra}if(N.offset>N.dmax){q.msg="invalid distance too far back",N.mode=30;break}N.mode=25;case 25:if(z===0)break e;if(ie=he-z,N.offset>ie){if((ie=N.offset-ie)>N.whave&&N.sane){q.msg="invalid distance too far back",N.mode=30;break}be=ie>N.wnext?(ie-=N.wnext,N.wsize-ie):N.wnext-ie,ie>N.length&&(ie=N.length),Ne=N.window}else Ne=oe,be=ye-N.offset,ie=N.length;for(z<ie&&(ie=z),z-=ie,N.length-=ie;oe[ye++]=Ne[be++],--ie;);N.length===0&&(N.mode=21);break;case 26:if(z===0)break e;oe[ye++]=N.length,z--,N.mode=21;break;case 27:if(N.wrap){for(;F<32;){if(ue===0)break e;ue--,_|=Z[fe++]<<F,F+=8}if(he-=z,q.total_out+=he,N.total+=he,he&&(q.adler=N.check=N.flags?f(N.check,oe,he,ye-he):l(N.check,oe,he,ye-he)),he=z,(N.flags?_:j(_))!==N.check){q.msg="incorrect data check",N.mode=30;break}F=_=0}N.mode=28;case 28:if(N.wrap&&N.flags){for(;F<32;){if(ue===0)break e;ue--,_+=Z[fe++]<<F,F+=8}if(_!==(4294967295&N.total)){q.msg="incorrect length check",N.mode=30;break}F=_=0}N.mode=29;case 29:ge=1;break e;case 30:ge=-3;break e;case 31:return-4;case 32:default:return x}return q.next_out=ye,q.avail_out=z,q.next_in=fe,q.avail_in=ue,N.hold=_,N.bits=F,(N.wsize||he!==q.avail_out&&N.mode<30&&(N.mode<27||Q!==4))&&Y(q,q.output,q.next_out,he-q.avail_out)?(N.mode=31,-4):(de-=q.avail_in,he-=q.avail_out,q.total_in+=de,q.total_out+=he,N.total+=he,N.wrap&&he&&(q.adler=N.check=N.flags?f(N.check,oe,he,q.next_out-he):l(N.check,oe,he,q.next_out-he)),q.data_type=N.bits+(N.last?64:0)+(N.mode===12?128:0)+(N.mode===20||N.mode===15?256:0),(de==0&&he===0||Q===4)&&ge===I&&(ge=-5),ge)},d.inflateEnd=function(q){if(!q||!q.state)return x;var Q=q.state;return Q.window&&(Q.window=null),q.state=null,I},d.inflateGetHeader=function(q,Q){var N;return q&&q.state?(2&(N=q.state).wrap)==0?x:((N.head=Q).done=!1,I):x},d.inflateSetDictionary=function(q,Q){var N,Z=Q.length;return q&&q.state?(N=q.state).wrap!==0&&N.mode!==11?x:N.mode===11&&l(1,Q,Z,0)!==N.check?-3:Y(q,Q,Z,Z)?(N.mode=31,-4):(N.havedict=1,I):x},d.inflateInfo="pako inflate (from Nodeca project)"},{"../utils/common":41,"./adler32":43,"./crc32":45,"./inffast":48,"./inftrees":50}],50:[function(o,p,d){var c=o("../utils/common"),l=[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0],f=[16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78],v=[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0],h=[16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64];p.exports=function(C,k,I,x,S,g,b,j){var O,R,A,T,P,H,K,W,B,Y=j.bits,q=0,Q=0,N=0,Z=0,oe=0,fe=0,ye=0,ue=0,z=0,_=0,F=null,de=0,he=new c.Buf16(16),ie=new c.Buf16(16),be=null,Ne=0;for(q=0;q<=15;q++)he[q]=0;for(Q=0;Q<x;Q++)he[k[I+Q]]++;for(oe=Y,Z=15;1<=Z&&he[Z]===0;Z--);if(Z<oe&&(oe=Z),Z===0)return S[g++]=20971520,S[g++]=20971520,j.bits=1,0;for(N=1;N<Z&&he[N]===0;N++);for(oe<N&&(oe=N),q=ue=1;q<=15;q++)if(ue<<=1,(ue-=he[q])<0)return-1;if(0<ue&&(C===0||Z!==1))return-1;for(ie[1]=0,q=1;q<15;q++)ie[q+1]=ie[q]+he[q];for(Q=0;Q<x;Q++)k[I+Q]!==0&&(b[ie[k[I+Q]]++]=Q);if(H=C===0?(F=be=b,19):C===1?(F=l,de-=257,be=f,Ne-=257,256):(F=v,be=h,-1),q=N,P=g,ye=Q=_=0,A=-1,T=(z=1<<(fe=oe))-1,C===1&&852<z||C===2&&592<z)return 1;for(;;){for(K=q-ye,B=b[Q]<H?(W=0,b[Q]):b[Q]>H?(W=be[Ne+b[Q]],F[de+b[Q]]):(W=96,0),O=1<<q-ye,N=R=1<<fe;S[P+(_>>ye)+(R-=O)]=K<<24|W<<16|B|0,R!==0;);for(O=1<<q-1;_&O;)O>>=1;if(O!==0?(_&=O-1,_+=O):_=0,Q++,--he[q]==0){if(q===Z)break;q=k[I+b[Q]]}if(oe<q&&(_&T)!==A){for(ye===0&&(ye=oe),P+=N,ue=1<<(fe=q-ye);fe+ye<Z&&!((ue-=he[fe+ye])<=0);)fe++,ue<<=1;if(z+=1<<fe,C===1&&852<z||C===2&&592<z)return 1;S[A=_&T]=oe<<24|fe<<16|P-g|0}}return _!==0&&(S[P+_]=q-ye<<24|64<<16|0),j.bits=oe,0}},{"../utils/common":41}],51:[function(o,p,d){p.exports={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"}},{}],52:[function(o,p,d){var c=o("../utils/common"),l=0,f=1;function v(G){for(var ee=G.length;0<=--ee;)G[ee]=0}var h=0,C=29,k=256,I=k+1+C,x=30,S=19,g=2*I+1,b=15,j=16,O=7,R=256,A=16,T=17,P=18,H=[0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0],K=[0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13],W=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7],B=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15],Y=new Array(2*(I+2));v(Y);var q=new Array(2*x);v(q);var Q=new Array(512);v(Q);var N=new Array(256);v(N);var Z=new Array(C);v(Z);var oe,fe,ye,ue=new Array(x);function z(G,ee,ce,le,ne){this.static_tree=G,this.extra_bits=ee,this.extra_base=ce,this.elems=le,this.max_length=ne,this.has_stree=G&&G.length}function _(G,ee){this.dyn_tree=G,this.max_code=0,this.stat_desc=ee}function F(G){return G<256?Q[G]:Q[256+(G>>>7)]}function de(G,ee){G.pending_buf[G.pending++]=255&ee,G.pending_buf[G.pending++]=ee>>>8&255}function he(G,ee,ce){G.bi_valid>j-ce?(G.bi_buf|=ee<<G.bi_valid&65535,de(G,G.bi_buf),G.bi_buf=ee>>j-G.bi_valid,G.bi_valid+=ce-j):(G.bi_buf|=ee<<G.bi_valid&65535,G.bi_valid+=ce)}function ie(G,ee,ce){he(G,ce[2*ee],ce[2*ee+1])}function be(G,ee){for(var ce=0;ce|=1&G,G>>>=1,ce<<=1,0<--ee;);return ce>>>1}function Ne(G,ee,ce){var le,ne,je=new Array(b+1),Me=0;for(le=1;le<=b;le++)je[le]=Me=Me+ce[le-1]<<1;for(ne=0;ne<=ee;ne++){var Te=G[2*ne+1];Te!==0&&(G[2*ne]=be(je[Te]++,Te))}}function Se(G){var ee;for(ee=0;ee<I;ee++)G.dyn_ltree[2*ee]=0;for(ee=0;ee<x;ee++)G.dyn_dtree[2*ee]=0;for(ee=0;ee<S;ee++)G.bl_tree[2*ee]=0;G.dyn_ltree[2*R]=1,G.opt_len=G.static_len=0,G.last_lit=G.matches=0}function ke(G){8<G.bi_valid?de(G,G.bi_buf):0<G.bi_valid&&(G.pending_buf[G.pending++]=G.bi_buf),G.bi_buf=0,G.bi_valid=0}function Ae(G,ee,ce,le){var ne=2*ee,je=2*ce;return G[ne]<G[je]||G[ne]===G[je]&&le[ee]<=le[ce]}function Pe(G,ee,ce){for(var le=G.heap[ce],ne=ce<<1;ne<=G.heap_len&&(ne<G.heap_len&&Ae(ee,G.heap[ne+1],G.heap[ne],G.depth)&&ne++,!Ae(ee,le,G.heap[ne],G.depth));)G.heap[ce]=G.heap[ne],ce=ne,ne<<=1;G.heap[ce]=le}function Ye(G,ee,ce){var le,ne,je,Me,Te=0;if(G.last_lit!==0)for(;le=G.pending_buf[G.d_buf+2*Te]<<8|G.pending_buf[G.d_buf+2*Te+1],ne=G.pending_buf[G.l_buf+Te],Te++,le===0?ie(G,ne,ee):(ie(G,(je=N[ne])+k+1,ee),(Me=H[je])!==0&&he(G,ne-=Z[je],Me),ie(G,je=F(--le),ce),(Me=K[je])!==0&&he(G,le-=ue[je],Me)),Te<G.last_lit;);ie(G,R,ee)}function Re(G,ee){var ce,le,ne,je=ee.dyn_tree,Me=ee.stat_desc.static_tree,Te=ee.stat_desc.has_stree,ze=ee.stat_desc.elems,ut=-1;for(G.heap_len=0,G.heap_max=g,ce=0;ce<ze;ce++)je[2*ce]!==0?(G.heap[++G.heap_len]=ut=ce,G.depth[ce]=0):je[2*ce+1]=0;for(;G.heap_len<2;)je[2*(ne=G.heap[++G.heap_len]=ut<2?++ut:0)]=1,G.depth[ne]=0,G.opt_len--,Te&&(G.static_len-=Me[2*ne+1]);for(ee.max_code=ut,ce=G.heap_len>>1;1<=ce;ce--)Pe(G,je,ce);for(ne=ze;ce=G.heap[1],G.heap[1]=G.heap[G.heap_len--],Pe(G,je,1),le=G.heap[1],G.heap[--G.heap_max]=ce,G.heap[--G.heap_max]=le,je[2*ne]=je[2*ce]+je[2*le],G.depth[ne]=(G.depth[ce]>=G.depth[le]?G.depth[ce]:G.depth[le])+1,je[2*ce+1]=je[2*le+1]=ne,G.heap[1]=ne++,Pe(G,je,1),2<=G.heap_len;);G.heap[--G.heap_max]=G.heap[1],function(rt,bt){var Ue,Ke,ot,it,Ot,Ht,ft=bt.dyn_tree,pt=bt.max_code,Ve=bt.stat_desc.static_tree,jr=bt.stat_desc.has_stree,cr=bt.stat_desc.extra_bits,Rr=bt.stat_desc.extra_base,qt=bt.stat_desc.max_length,pn=0;for(it=0;it<=b;it++)rt.bl_count[it]=0;for(ft[2*rt.heap[rt.heap_max]+1]=0,Ue=rt.heap_max+1;Ue<g;Ue++)qt<(it=ft[2*ft[2*(Ke=rt.heap[Ue])+1]+1]+1)&&(it=qt,pn++),ft[2*Ke+1]=it,pt<Ke||(rt.bl_count[it]++,Ot=0,Rr<=Ke&&(Ot=cr[Ke-Rr]),Ht=ft[2*Ke],rt.opt_len+=Ht*(it+Ot),jr&&(rt.static_len+=Ht*(Ve[2*Ke+1]+Ot)));if(pn!==0){do{for(it=qt-1;rt.bl_count[it]===0;)it--;rt.bl_count[it]--,rt.bl_count[it+1]+=2,rt.bl_count[qt]--,pn-=2}while(0<pn);for(it=qt;it!==0;it--)for(Ke=rt.bl_count[it];Ke!==0;)pt<(ot=rt.heap[--Ue])||(ft[2*ot+1]!==it&&(rt.opt_len+=(it-ft[2*ot+1])*ft[2*ot],ft[2*ot+1]=it),Ke--)}}(G,ee),Ne(je,ut,G.bl_count)}function E(G,ee,ce){var le,ne,je=-1,Me=ee[1],Te=0,ze=7,ut=4;for(Me===0&&(ze=138,ut=3),ee[2*(ce+1)+1]=65535,le=0;le<=ce;le++)ne=Me,Me=ee[2*(le+1)+1],++Te<ze&&ne===Me||(Te<ut?G.bl_tree[2*ne]+=Te:ne!==0?(ne!==je&&G.bl_tree[2*ne]++,G.bl_tree[2*A]++):Te<=10?G.bl_tree[2*T]++:G.bl_tree[2*P]++,je=ne,ut=(Te=0)===Me?(ze=138,3):ne===Me?(ze=6,3):(ze=7,4))}function ge(G,ee,ce){var le,ne,je=-1,Me=ee[1],Te=0,ze=7,ut=4;for(Me===0&&(ze=138,ut=3),le=0;le<=ce;le++)if(ne=Me,Me=ee[2*(le+1)+1],!(++Te<ze&&ne===Me)){if(Te<ut)for(;ie(G,ne,G.bl_tree),--Te!=0;);else ne!==0?(ne!==je&&(ie(G,ne,G.bl_tree),Te--),ie(G,A,G.bl_tree),he(G,Te-3,2)):Te<=10?(ie(G,T,G.bl_tree),he(G,Te-3,3)):(ie(G,P,G.bl_tree),he(G,Te-11,7));je=ne,ut=(Te=0)===Me?(ze=138,3):ne===Me?(ze=6,3):(ze=7,4)}}v(ue);var re=!1;function $(G,ee,ce,le){he(G,(h<<1)+(le?1:0),3),function(ne,je,Me,Te){ke(ne),de(ne,Me),de(ne,~Me),c.arraySet(ne.pending_buf,ne.window,je,Me,ne.pending),ne.pending+=Me}(G,ee,ce)}d._tr_init=function(G){re||(function(){var ee,ce,le,ne,je,Me=new Array(b+1);for(ne=le=0;ne<C-1;ne++)for(Z[ne]=le,ee=0;ee<1<<H[ne];ee++)N[le++]=ne;for(N[le-1]=ne,ne=je=0;ne<16;ne++)for(ue[ne]=je,ee=0;ee<1<<K[ne];ee++)Q[je++]=ne;for(je>>=7;ne<x;ne++)for(ue[ne]=je<<7,ee=0;ee<1<<K[ne]-7;ee++)Q[256+je++]=ne;for(ce=0;ce<=b;ce++)Me[ce]=0;for(ee=0;ee<=143;)Y[2*ee+1]=8,ee++,Me[8]++;for(;ee<=255;)Y[2*ee+1]=9,ee++,Me[9]++;for(;ee<=279;)Y[2*ee+1]=7,ee++,Me[7]++;for(;ee<=287;)Y[2*ee+1]=8,ee++,Me[8]++;for(Ne(Y,I+1,Me),ee=0;ee<x;ee++)q[2*ee+1]=5,q[2*ee]=be(ee,5);oe=new z(Y,H,k+1,I,b),fe=new z(q,K,0,x,b),ye=new z(new Array(0),W,0,S,O)}(),re=!0),G.l_desc=new _(G.dyn_ltree,oe),G.d_desc=new _(G.dyn_dtree,fe),G.bl_desc=new _(G.bl_tree,ye),G.bi_buf=0,G.bi_valid=0,Se(G)},d._tr_stored_block=$,d._tr_flush_block=function(G,ee,ce,le){var ne,je,Me=0;0<G.level?(G.strm.data_type===2&&(G.strm.data_type=function(Te){var ze,ut=4093624447;for(ze=0;ze<=31;ze++,ut>>>=1)if(1&ut&&Te.dyn_ltree[2*ze]!==0)return l;if(Te.dyn_ltree[18]!==0||Te.dyn_ltree[20]!==0||Te.dyn_ltree[26]!==0)return f;for(ze=32;ze<k;ze++)if(Te.dyn_ltree[2*ze]!==0)return f;return l}(G)),Re(G,G.l_desc),Re(G,G.d_desc),Me=function(Te){var ze;for(E(Te,Te.dyn_ltree,Te.l_desc.max_code),E(Te,Te.dyn_dtree,Te.d_desc.max_code),Re(Te,Te.bl_desc),ze=S-1;3<=ze&&Te.bl_tree[2*B[ze]+1]===0;ze--);return Te.opt_len+=3*(ze+1)+5+5+4,ze}(G),ne=G.opt_len+3+7>>>3,(je=G.static_len+3+7>>>3)<=ne&&(ne=je)):ne=je=ce+5,ce+4<=ne&&ee!==-1?$(G,ee,ce,le):G.strategy===4||je===ne?(he(G,2+(le?1:0),3),Ye(G,Y,q)):(he(G,4+(le?1:0),3),function(Te,ze,ut,rt){var bt;for(he(Te,ze-257,5),he(Te,ut-1,5),he(Te,rt-4,4),bt=0;bt<rt;bt++)he(Te,Te.bl_tree[2*B[bt]+1],3);ge(Te,Te.dyn_ltree,ze-1),ge(Te,Te.dyn_dtree,ut-1)}(G,G.l_desc.max_code+1,G.d_desc.max_code+1,Me+1),Ye(G,G.dyn_ltree,G.dyn_dtree)),Se(G),le&&ke(G)},d._tr_tally=function(G,ee,ce){return G.pending_buf[G.d_buf+2*G.last_lit]=ee>>>8&255,G.pending_buf[G.d_buf+2*G.last_lit+1]=255&ee,G.pending_buf[G.l_buf+G.last_lit]=255&ce,G.last_lit++,ee===0?G.dyn_ltree[2*ce]++:(G.matches++,ee--,G.dyn_ltree[2*(N[ce]+k+1)]++,G.dyn_dtree[2*F(ee)]++),G.last_lit===G.lit_bufsize-1},d._tr_align=function(G){he(G,2,3),ie(G,R,Y),function(ee){ee.bi_valid===16?(de(ee,ee.bi_buf),ee.bi_buf=0,ee.bi_valid=0):8<=ee.bi_valid&&(ee.pending_buf[ee.pending++]=255&ee.bi_buf,ee.bi_buf>>=8,ee.bi_valid-=8)}(G)}},{"../utils/common":41}],53:[function(o,p,d){p.exports=function(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.msg="",this.state=null,this.data_type=2,this.adler=0}},{}],54:[function(o,p,d){(function(c){(function(l,f){if(!l.setImmediate){var v,h,C,k,I=1,x={},S=!1,g=l.document,b=Object.getPrototypeOf&&Object.getPrototypeOf(l);b=b&&b.setTimeout?b:l,v={}.toString.call(l.process)==="[object process]"?function(A){process.nextTick(function(){O(A)})}:function(){if(l.postMessage&&!l.importScripts){var A=!0,T=l.onmessage;return l.onmessage=function(){A=!1},l.postMessage("","*"),l.onmessage=T,A}}()?(k="setImmediate$"+Math.random()+"$",l.addEventListener?l.addEventListener("message",R,!1):l.attachEvent("onmessage",R),function(A){l.postMessage(k+A,"*")}):l.MessageChannel?((C=new MessageChannel).port1.onmessage=function(A){O(A.data)},function(A){C.port2.postMessage(A)}):g&&"onreadystatechange"in g.createElement("script")?(h=g.documentElement,function(A){var T=g.createElement("script");T.onreadystatechange=function(){O(A),T.onreadystatechange=null,h.removeChild(T),T=null},h.appendChild(T)}):function(A){setTimeout(O,0,A)},b.setImmediate=function(A){typeof A!="function"&&(A=new Function(""+A));for(var T=new Array(arguments.length-1),P=0;P<T.length;P++)T[P]=arguments[P+1];var H={callback:A,args:T};return x[I]=H,v(I),I++},b.clearImmediate=j}function j(A){delete x[A]}function O(A){if(S)setTimeout(O,0,A);else{var T=x[A];if(T){S=!0;try{(function(P){var H=P.callback,K=P.args;switch(K.length){case 0:H();break;case 1:H(K[0]);break;case 2:H(K[0],K[1]);break;case 3:H(K[0],K[1],K[2]);break;default:H.apply(f,K)}})(T)}finally{j(A),S=!1}}}}function R(A){A.source===l&&typeof A.data=="string"&&A.data.indexOf(k)===0&&O(+A.data.slice(k.length))}})(typeof self>"u"?c===void 0?this:c:self)}).call(this,typeof vi<"u"?vi:typeof self<"u"?self:typeof window<"u"?window:{})},{}]},{},[10])(10)})}(Ec)),Ec.exports}var Sg=kg();const jg=oo(Sg);var Nc={exports:{}};const Eg={},Ng=Object.freeze(Object.defineProperty({__proto__:null,default:Eg},Symbol.toStringTag,{value:"Module"})),_c=bp(Ng);var xf;function _g(){return xf||(xf=1,function(n,i){var o=void 0,p=function(d){return o||(o=new Promise(function(c,l){var f=typeof d<"u"?d:{},v=f.onAbort;f.onAbort=function(u){l(new Error(u)),v&&v(u)},f.postRun=f.postRun||[],f.postRun.push(function(){c(f)}),n=void 0;var h;h||(h=typeof f<"u"?f:{}),h.onRuntimeInitialized=function(){function u(pe,_e){switch(typeof _e){case"boolean":Ji(pe,_e?1:0);break;case"number":Yi(pe,_e);break;case"string":Vi(pe,_e,-1,-1);break;case"object":if(_e===null)Ks(pe);else if(_e.length!=null){var We=xs(_e,gs);Ki(pe,We,_e.length,-1),an(We)}else Ss(pe,"Wrong API use : tried to return a value of an unknown type ("+_e+").",-1);break;default:Ks(pe)}}function y(pe,_e){for(var We=[],nt=0;nt<pe;nt+=1){var ct=re(_e+4*nt,"i32"),wt=$i(ct);if(wt===1||wt===2)ct=Qi(ct);else if(wt===3)ct=Gi(ct);else if(wt===4){wt=ct,ct=So(wt),wt=Wi(wt);for(var Zt=new Uint8Array(ct),pr=0;pr<ct;pr+=1)Zt[pr]=B[wt+pr];ct=Zt}else ct=null;We.push(ct)}return We}function D(pe,_e){this.La=pe,this.db=_e,this.Ja=1,this.fb=[]}function U(pe,_e){if(this.db=_e,_e=bt(pe)+1,this.Ya=vs(_e),this.Ya===null)throw Error("Unable to allocate memory for the SQL string");Ue(pe,Y,this.Ya,_e),this.eb=this.Ya,this.Ua=this.ib=null}function X(pe){if(this.filename="dbfile_"+(4294967295*Math.random()>>>0),pe!=null){var _e=this.filename,We="/",nt=_e;if(We&&(We=typeof We=="string"?We:In(We),nt=_e?ne(We+"/"+_e):We),_e=jr(!0,!0),nt=as(nt,(_e!==void 0?_e:438)&4095|32768,0),pe){if(typeof pe=="string"){We=Array(pe.length);for(var ct=0,wt=pe.length;ct<wt;++ct)We[ct]=pe.charCodeAt(ct);pe=We}ls(nt,_e|146),We=Dn(nt,577),po(We,pe,0,pe.length,0),qs(We),ls(nt,_e)}}this.handleError(Xe(this.filename,we)),this.db=re(we,"i32"),Eo(this.db),this.Za={},this.Na={}}var we=Qr(4),Ee=h.cwrap,Xe=Ee("sqlite3_open","number",["string","number"]),ht=Ee("sqlite3_close_v2","number",["number"]),tt=Ee("sqlite3_exec","number",["number","string","number","number","number"]),Nt=Ee("sqlite3_changes","number",["number"]),Ct=Ee("sqlite3_prepare_v2","number",["number","string","number","number","number"]),ja=Ee("sqlite3_sql","string",["number"]),Ys=Ee("sqlite3_normalized_sql","string",["number"]),ws=Ee("sqlite3_prepare_v2","number",["number","number","number","number","number"]),bo=Ee("sqlite3_bind_text","number",["number","number","number","number","number"]),tr=Ee("sqlite3_bind_blob","number",["number","number","number","number","number"]),Fn=Ee("sqlite3_bind_double","number",["number","number","number"]),Ea=Ee("sqlite3_bind_int","number",["number","number","number"]),bs=Ee("sqlite3_bind_parameter_index","number",["number","string"]),Fi=Ee("sqlite3_step","number",["number"]),Na=Ee("sqlite3_errmsg","string",["number"]),_a=Ee("sqlite3_column_count","number",["number"]),ks=Ee("sqlite3_data_count","number",["number"]),Vs=Ee("sqlite3_column_double","number",["number","number"]),Ca=Ee("sqlite3_column_text","string",["number","number"]),Pi=Ee("sqlite3_column_blob","number",["number","number"]),Ui=Ee("sqlite3_column_bytes","number",["number","number"]),zi=Ee("sqlite3_column_type","number",["number","number"]),Ia=Ee("sqlite3_column_name","string",["number","number"]),Bi=Ee("sqlite3_reset","number",["number"]),Hi=Ee("sqlite3_clear_bindings","number",["number"]),qi=Ee("sqlite3_finalize","number",["number"]),ko=Ee("sqlite3_create_function_v2","number","number string number number number number number number number".split(" ")),$i=Ee("sqlite3_value_type","number",["number"]),So=Ee("sqlite3_value_bytes","number",["number"]),Gi=Ee("sqlite3_value_text","string",["number"]),Wi=Ee("sqlite3_value_blob","number",["number"]),Qi=Ee("sqlite3_value_double","number",["number"]),Yi=Ee("sqlite3_result_double","",["number","number"]),Ks=Ee("sqlite3_result_null","",["number"]),Vi=Ee("sqlite3_result_text","",["number","string","number","number"]),Ki=Ee("sqlite3_result_blob","",["number","number","number","number"]),Ji=Ee("sqlite3_result_int","",["number","number"]),Ss=Ee("sqlite3_result_error","",["number","string","number"]),jo=Ee("sqlite3_aggregate_context","number",["number","number"]),Eo=Ee("RegisterExtensionFunctions","number",["number"]);D.prototype.bind=function(pe){if(!this.La)throw"Statement closed";return this.reset(),Array.isArray(pe)?this.wb(pe):pe!=null&&typeof pe=="object"?this.xb(pe):!0},D.prototype.step=function(){if(!this.La)throw"Statement closed";this.Ja=1;var pe=Fi(this.La);switch(pe){case 100:return!0;case 101:return!1;default:throw this.db.handleError(pe)}},D.prototype.rb=function(pe){return pe==null&&(pe=this.Ja,this.Ja+=1),Vs(this.La,pe)},D.prototype.Ab=function(pe){if(pe==null&&(pe=this.Ja,this.Ja+=1),pe=Ca(this.La,pe),typeof BigInt!="function")throw Error("BigInt is not supported");return BigInt(pe)},D.prototype.Bb=function(pe){return pe==null&&(pe=this.Ja,this.Ja+=1),Ca(this.La,pe)},D.prototype.getBlob=function(pe){pe==null&&(pe=this.Ja,this.Ja+=1);var _e=Ui(this.La,pe);pe=Pi(this.La,pe);for(var We=new Uint8Array(_e),nt=0;nt<_e;nt+=1)We[nt]=B[pe+nt];return We},D.prototype.get=function(pe,_e){_e=_e||{},pe!=null&&this.bind(pe)&&this.step(),pe=[];for(var We=ks(this.La),nt=0;nt<We;nt+=1)switch(zi(this.La,nt)){case 1:var ct=_e.useBigInt?this.Ab(nt):this.rb(nt);pe.push(ct);break;case 2:pe.push(this.rb(nt));break;case 3:pe.push(this.Bb(nt));break;case 4:pe.push(this.getBlob(nt));break;default:pe.push(null)}return pe},D.prototype.getColumnNames=function(){for(var pe=[],_e=_a(this.La),We=0;We<_e;We+=1)pe.push(Ia(this.La,We));return pe},D.prototype.getAsObject=function(pe,_e){pe=this.get(pe,_e),_e=this.getColumnNames();for(var We={},nt=0;nt<_e.length;nt+=1)We[_e[nt]]=pe[nt];return We},D.prototype.getSQL=function(){return ja(this.La)},D.prototype.getNormalizedSQL=function(){return Ys(this.La)},D.prototype.run=function(pe){return pe!=null&&this.bind(pe),this.step(),this.reset()},D.prototype.nb=function(pe,_e){_e==null&&(_e=this.Ja,this.Ja+=1),pe=Ke(pe);var We=xs(pe,gs);this.fb.push(We),this.db.handleError(bo(this.La,_e,We,pe.length-1,0))},D.prototype.vb=function(pe,_e){_e==null&&(_e=this.Ja,this.Ja+=1);var We=xs(pe,gs);this.fb.push(We),this.db.handleError(tr(this.La,_e,We,pe.length,0))},D.prototype.mb=function(pe,_e){_e==null&&(_e=this.Ja,this.Ja+=1),this.db.handleError((pe===(pe|0)?Ea:Fn)(this.La,_e,pe))},D.prototype.yb=function(pe){pe==null&&(pe=this.Ja,this.Ja+=1),tr(this.La,pe,0,0,0)},D.prototype.ob=function(pe,_e){switch(_e==null&&(_e=this.Ja,this.Ja+=1),typeof pe){case"string":this.nb(pe,_e);return;case"number":this.mb(pe,_e);return;case"bigint":this.nb(pe.toString(),_e);return;case"boolean":this.mb(pe+0,_e);return;case"object":if(pe===null){this.yb(_e);return}if(pe.length!=null){this.vb(pe,_e);return}}throw"Wrong API use : tried to bind a value of an unknown type ("+pe+")."},D.prototype.xb=function(pe){var _e=this;return Object.keys(pe).forEach(function(We){var nt=bs(_e.La,We);nt!==0&&_e.ob(pe[We],nt)}),!0},D.prototype.wb=function(pe){for(var _e=0;_e<pe.length;_e+=1)this.ob(pe[_e],_e+1);return!0},D.prototype.reset=function(){return this.freemem(),Hi(this.La)===0&&Bi(this.La)===0},D.prototype.freemem=function(){for(var pe;(pe=this.fb.pop())!==void 0;)an(pe)},D.prototype.free=function(){this.freemem();var pe=qi(this.La)===0;return delete this.db.Za[this.La],this.La=0,pe},U.prototype.next=function(){if(this.Ya===null)return{done:!0};if(this.Ua!==null&&(this.Ua.free(),this.Ua=null),!this.db.db)throw this.gb(),Error("Database closed");var pe=Mn(),_e=Qr(4);$(we),$(_e);try{this.db.handleError(ws(this.db.db,this.eb,-1,we,_e)),this.eb=re(_e,"i32");var We=re(we,"i32");return We===0?(this.gb(),{done:!0}):(this.Ua=new D(We,this.db),this.db.Za[We]=this.Ua,{value:this.Ua,done:!1})}catch(nt){throw this.ib=ce(this.eb),this.gb(),nt}finally{on(pe)}},U.prototype.gb=function(){an(this.Ya),this.Ya=null},U.prototype.getRemainingSQL=function(){return this.ib!==null?this.ib:ce(this.eb)},typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"&&(U.prototype[Symbol.iterator]=function(){return this}),X.prototype.run=function(pe,_e){if(!this.db)throw"Database closed";if(_e){pe=this.prepare(pe,_e);try{pe.step()}finally{pe.free()}}else this.handleError(tt(this.db,pe,0,0,we));return this},X.prototype.exec=function(pe,_e,We){if(!this.db)throw"Database closed";var nt=Mn(),ct=null;try{var wt=ps(pe),Zt=Qr(4);for(pe=[];re(wt,"i8")!==0;){$(we),$(Zt),this.handleError(ws(this.db,wt,-1,we,Zt));var pr=re(we,"i32");if(wt=re(Zt,"i32"),pr!==0){var rr=null;for(ct=new D(pr,this),_e!=null&&ct.bind(_e);ct.step();)rr===null&&(rr={columns:ct.getColumnNames(),values:[]},pe.push(rr)),rr.values.push(ct.get(null,We));ct.free()}}return pe}catch(gr){throw ct&&ct.free(),gr}finally{on(nt)}},X.prototype.each=function(pe,_e,We,nt,ct){typeof _e=="function"&&(nt=We,We=_e,_e=void 0),pe=this.prepare(pe,_e);try{for(;pe.step();)We(pe.getAsObject(null,ct))}finally{pe.free()}if(typeof nt=="function")return nt()},X.prototype.prepare=function(pe,_e){if($(we),this.handleError(Ct(this.db,pe,-1,we,0)),pe=re(we,"i32"),pe===0)throw"Nothing to prepare";var We=new D(pe,this);return _e!=null&&We.bind(_e),this.Za[pe]=We},X.prototype.iterateStatements=function(pe){return new U(pe,this)},X.prototype.export=function(){Object.values(this.Za).forEach(function(_e){_e.free()}),Object.values(this.Na).forEach(ur),this.Na={},this.handleError(ht(this.db));var pe=Cr(this.filename);return this.handleError(Xe(this.filename,we)),this.db=re(we,"i32"),Eo(this.db),pe},X.prototype.close=function(){this.db!==null&&(Object.values(this.Za).forEach(function(pe){pe.free()}),Object.values(this.Na).forEach(ur),this.Na={},this.handleError(ht(this.db)),mo("/"+this.filename),this.db=null)},X.prototype.handleError=function(pe){if(pe===0)return null;throw pe=Na(this.db),Error(pe)},X.prototype.getRowsModified=function(){return Nt(this.db)},X.prototype.create_function=function(pe,_e){Object.prototype.hasOwnProperty.call(this.Na,pe)&&(ur(this.Na[pe]),delete this.Na[pe]);var We=Ir(function(nt,ct,wt){ct=y(ct,wt);try{var Zt=_e.apply(null,ct)}catch(pr){Ss(nt,pr,-1);return}u(nt,Zt)},"viii");return this.Na[pe]=We,this.handleError(ko(this.db,pe,_e.length,1,0,We,0,0,0)),this},X.prototype.create_aggregate=function(pe,_e){var We=_e.init||function(){return null},nt=_e.finalize||function(rr){return rr},ct=_e.step;if(!ct)throw"An aggregate function must have a step function in "+pe;var wt={};Object.hasOwnProperty.call(this.Na,pe)&&(ur(this.Na[pe]),delete this.Na[pe]),_e=pe+"__finalize",Object.hasOwnProperty.call(this.Na,_e)&&(ur(this.Na[_e]),delete this.Na[_e]);var Zt=Ir(function(rr,gr,Js){var ln=jo(rr,1);Object.hasOwnProperty.call(wt,ln)||(wt[ln]=We()),gr=y(gr,Js),gr=[wt[ln]].concat(gr);try{wt[ln]=ct.apply(null,gr)}catch(No){delete wt[ln],Ss(rr,No,-1)}},"viii"),pr=Ir(function(rr){var gr=jo(rr,1);try{var Js=nt(wt[gr])}catch(ln){delete wt[gr],Ss(rr,ln,-1);return}u(rr,Js),delete wt[gr]},"vi");return this.Na[pe]=Zt,this.Na[_e]=pr,this.handleError(ko(this.db,pe,ct.length-1,1,0,0,Zt,pr,0)),this},h.Database=X};var C=Object.assign({},h),k="./this.program",I=typeof window=="object",x=typeof importScripts=="function",S=typeof process=="object"&&typeof process.versions=="object"&&typeof process.versions.node=="string",g="",b,j,O;if(S){var R=_c,A=_c;g=x?A.dirname(g)+"/":__dirname+"/",b=(u,y)=>(u=be(u)?new URL(u):A.normalize(u),R.readFileSync(u,y?void 0:"utf8")),O=u=>(u=b(u,!0),u.buffer||(u=new Uint8Array(u)),u),j=(u,y,D,U=!0)=>{u=be(u)?new URL(u):A.normalize(u),R.readFile(u,U?void 0:"utf8",(X,we)=>{X?D(X):y(U?we.buffer:we)})},!h.thisProgram&&1<process.argv.length&&(k=process.argv[1].replace(/\\/g,"/")),process.argv.slice(2),n.exports=h,h.inspect=()=>"[Emscripten Module object]"}else(I||x)&&(x?g=self.location.href:typeof document<"u"&&document.currentScript&&(g=document.currentScript.src),g=g.indexOf("blob:")!==0?g.substr(0,g.replace(/[?#].*/,"").lastIndexOf("/")+1):"",b=u=>{var y=new XMLHttpRequest;return y.open("GET",u,!1),y.send(null),y.responseText},x&&(O=u=>{var y=new XMLHttpRequest;return y.open("GET",u,!1),y.responseType="arraybuffer",y.send(null),new Uint8Array(y.response)}),j=(u,y,D)=>{var U=new XMLHttpRequest;U.open("GET",u,!0),U.responseType="arraybuffer",U.onload=()=>{U.status==200||U.status==0&&U.response?y(U.response):D()},U.onerror=D,U.send(null)});var T=h.print||console.log.bind(console),P=h.printErr||console.error.bind(console);Object.assign(h,C),C=null,h.thisProgram&&(k=h.thisProgram);var H;h.wasmBinary&&(H=h.wasmBinary),typeof WebAssembly!="object"&&he("no native wasm support detected");var K,W=!1,B,Y,q,Q,N,Z,oe;function fe(){var u=K.buffer;h.HEAP8=B=new Int8Array(u),h.HEAP16=q=new Int16Array(u),h.HEAPU8=Y=new Uint8Array(u),h.HEAPU16=new Uint16Array(u),h.HEAP32=Q=new Int32Array(u),h.HEAPU32=N=new Uint32Array(u),h.HEAPF32=Z=new Float32Array(u),h.HEAPF64=oe=new Float64Array(u)}var ye=[],ue=[],z=[];function _(){var u=h.preRun.shift();ye.unshift(u)}var F=0,de=null;function he(u){var y;throw(y=h.onAbort)==null||y.call(h,u),u="Aborted("+u+")",P(u),W=!0,new WebAssembly.RuntimeError(u+". Build with -sASSERTIONS for more info.")}var ie=u=>u.startsWith("data:application/octet-stream;base64,"),be=u=>u.startsWith("file://"),Ne;if(Ne="sql-wasm.wasm",!ie(Ne)){var Se=Ne;Ne=h.locateFile?h.locateFile(Se,g):g+Se}function ke(u){if(u==Ne&&H)return new Uint8Array(H);if(O)return O(u);throw"both async and sync fetching of the wasm failed"}function Ae(u){if(!H&&(I||x)){if(typeof fetch=="function"&&!be(u))return fetch(u,{credentials:"same-origin"}).then(y=>{if(!y.ok)throw"failed to load wasm binary file at '"+u+"'";return y.arrayBuffer()}).catch(()=>ke(u));if(j)return new Promise((y,D)=>{j(u,U=>y(new Uint8Array(U)),D)})}return Promise.resolve().then(()=>ke(u))}function Pe(u,y,D){return Ae(u).then(U=>WebAssembly.instantiate(U,y)).then(U=>U).then(D,U=>{P(`failed to asynchronously prepare wasm: ${U}`),he(U)})}function Ye(u,y){var D=Ne;H||typeof WebAssembly.instantiateStreaming!="function"||ie(D)||be(D)||S||typeof fetch!="function"?Pe(D,u,y):fetch(D,{credentials:"same-origin"}).then(U=>WebAssembly.instantiateStreaming(U,u).then(y,function(X){return P(`wasm streaming compile failed: ${X}`),P("falling back to ArrayBuffer instantiation"),Pe(D,u,y)}))}var Re,E,ge=u=>{for(;0<u.length;)u.shift()(h)};function re(u,y="i8"){switch(y.endsWith("*")&&(y="*"),y){case"i1":return B[u>>0];case"i8":return B[u>>0];case"i16":return q[u>>1];case"i32":return Q[u>>2];case"i64":he("to do getValue(i64) use WASM_BIGINT");case"float":return Z[u>>2];case"double":return oe[u>>3];case"*":return N[u>>2];default:he(`invalid type for getValue: ${y}`)}}function $(u){var y="i32";switch(y.endsWith("*")&&(y="*"),y){case"i1":B[u>>0]=0;break;case"i8":B[u>>0]=0;break;case"i16":q[u>>1]=0;break;case"i32":Q[u>>2]=0;break;case"i64":he("to do setValue(i64) use WASM_BIGINT");case"float":Z[u>>2]=0;break;case"double":oe[u>>3]=0;break;case"*":N[u>>2]=0;break;default:he(`invalid type for setValue: ${y}`)}}var G=typeof TextDecoder<"u"?new TextDecoder("utf8"):void 0,ee=(u,y,D)=>{var U=y+D;for(D=y;u[D]&&!(D>=U);)++D;if(16<D-y&&u.buffer&&G)return G.decode(u.subarray(y,D));for(U="";y<D;){var X=u[y++];if(X&128){var we=u[y++]&63;if((X&224)==192)U+=String.fromCharCode((X&31)<<6|we);else{var Ee=u[y++]&63;X=(X&240)==224?(X&15)<<12|we<<6|Ee:(X&7)<<18|we<<12|Ee<<6|u[y++]&63,65536>X?U+=String.fromCharCode(X):(X-=65536,U+=String.fromCharCode(55296|X>>10,56320|X&1023))}}else U+=String.fromCharCode(X)}return U},ce=(u,y)=>u?ee(Y,u,y):"",le=(u,y)=>{for(var D=0,U=u.length-1;0<=U;U--){var X=u[U];X==="."?u.splice(U,1):X===".."?(u.splice(U,1),D++):D&&(u.splice(U,1),D--)}if(y)for(;D;D--)u.unshift("..");return u},ne=u=>{var y=u.charAt(0)==="/",D=u.substr(-1)==="/";return(u=le(u.split("/").filter(U=>!!U),!y).join("/"))||y||(u="."),u&&D&&(u+="/"),(y?"/":"")+u},je=u=>{var y=/^(\/?|)([\s\S]*?)((?:\.{1,2}|[^\/]+?|)(\.[^.\/]*|))(?:[\/]*)$/.exec(u).slice(1);return u=y[0],y=y[1],!u&&!y?".":(y&&(y=y.substr(0,y.length-1)),u+y)},Me=u=>{if(u==="/")return"/";u=ne(u),u=u.replace(/\/$/,"");var y=u.lastIndexOf("/");return y===-1?u:u.substr(y+1)},Te=()=>{if(typeof crypto=="object"&&typeof crypto.getRandomValues=="function")return D=>crypto.getRandomValues(D);if(S)try{var u=_c;if(u.randomFillSync)return D=>u.randomFillSync(D);var y=u.randomBytes;return D=>(D.set(y(D.byteLength)),D)}catch{}he("initRandomDevice")},ze=u=>(ze=Te())(u);function ut(){for(var u="",y=!1,D=arguments.length-1;-1<=D&&!y;D--){if(y=0<=D?arguments[D]:"/",typeof y!="string")throw new TypeError("Arguments to path.resolve must be strings");if(!y)return"";u=y+"/"+u,y=y.charAt(0)==="/"}return u=le(u.split("/").filter(U=>!!U),!y).join("/"),(y?"/":"")+u||"."}var rt=[],bt=u=>{for(var y=0,D=0;D<u.length;++D){var U=u.charCodeAt(D);127>=U?y++:2047>=U?y+=2:55296<=U&&57343>=U?(y+=4,++D):y+=3}return y},Ue=(u,y,D,U)=>{if(!(0<U))return 0;var X=D;U=D+U-1;for(var we=0;we<u.length;++we){var Ee=u.charCodeAt(we);if(55296<=Ee&&57343>=Ee){var Xe=u.charCodeAt(++we);Ee=65536+((Ee&1023)<<10)|Xe&1023}if(127>=Ee){if(D>=U)break;y[D++]=Ee}else{if(2047>=Ee){if(D+1>=U)break;y[D++]=192|Ee>>6}else{if(65535>=Ee){if(D+2>=U)break;y[D++]=224|Ee>>12}else{if(D+3>=U)break;y[D++]=240|Ee>>18,y[D++]=128|Ee>>12&63}y[D++]=128|Ee>>6&63}y[D++]=128|Ee&63}}return y[D]=0,D-X};function Ke(u,y){var D=Array(bt(u)+1);return u=Ue(u,D,0,D.length),y&&(D.length=u),D}var ot=[];function it(u,y){ot[u]={input:[],output:[],Xa:y},zs(u,Ot)}var Ot={open(u){var y=ot[u.node.rdev];if(!y)throw new Fe(43);u.tty=y,u.seekable=!1},close(u){u.tty.Xa.fsync(u.tty)},fsync(u){u.tty.Xa.fsync(u.tty)},read(u,y,D,U){if(!u.tty||!u.tty.Xa.sb)throw new Fe(60);for(var X=0,we=0;we<U;we++){try{var Ee=u.tty.Xa.sb(u.tty)}catch{throw new Fe(29)}if(Ee===void 0&&X===0)throw new Fe(6);if(Ee==null)break;X++,y[D+we]=Ee}return X&&(u.node.timestamp=Date.now()),X},write(u,y,D,U){if(!u.tty||!u.tty.Xa.jb)throw new Fe(60);try{for(var X=0;X<U;X++)u.tty.Xa.jb(u.tty,y[D+X])}catch{throw new Fe(29)}return U&&(u.node.timestamp=Date.now()),X}},Ht={sb(){e:{if(!rt.length){var u=null;if(S){var y=Buffer.alloc(256),D=0,U=process.stdin.fd;try{D=R.readSync(U,y)}catch(X){if(X.toString().includes("EOF"))D=0;else throw X}0<D?u=y.slice(0,D).toString("utf-8"):u=null}else typeof window<"u"&&typeof window.prompt=="function"?(u=window.prompt("Input: "),u!==null&&(u+=`
`)):typeof readline=="function"&&(u=readline(),u!==null&&(u+=`
`));if(!u){u=null;break e}rt=Ke(u,!0)}u=rt.shift()}return u},jb(u,y){y===null||y===10?(T(ee(u.output,0)),u.output=[]):y!=0&&u.output.push(y)},fsync(u){u.output&&0<u.output.length&&(T(ee(u.output,0)),u.output=[])},Mb(){return{Ib:25856,Kb:5,Hb:191,Jb:35387,Gb:[3,28,127,21,4,0,1,0,17,19,26,0,18,15,23,22,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]}},Nb(){return 0},Ob(){return[24,80]}},ft={jb(u,y){y===null||y===10?(P(ee(u.output,0)),u.output=[]):y!=0&&u.output.push(y)},fsync(u){u.output&&0<u.output.length&&(P(ee(u.output,0)),u.output=[])}};function pt(u,y){var D=u.Ia?u.Ia.length:0;D>=y||(y=Math.max(y,D*(1048576>D?2:1.125)>>>0),D!=0&&(y=Math.max(y,256)),D=u.Ia,u.Ia=new Uint8Array(y),0<u.Ma&&u.Ia.set(D.subarray(0,u.Ma),0))}var Ve={Qa:null,Ra(){return Ve.createNode(null,"/",16895,0)},createNode(u,y,D,U){if((D&61440)===24576||(D&61440)===4096)throw new Fe(63);return Ve.Qa||(Ve.Qa={dir:{node:{Pa:Ve.Ga.Pa,Oa:Ve.Ga.Oa,lookup:Ve.Ga.lookup,ab:Ve.Ga.ab,rename:Ve.Ga.rename,unlink:Ve.Ga.unlink,rmdir:Ve.Ga.rmdir,readdir:Ve.Ga.readdir,symlink:Ve.Ga.symlink},stream:{Ta:Ve.Ha.Ta}},file:{node:{Pa:Ve.Ga.Pa,Oa:Ve.Ga.Oa},stream:{Ta:Ve.Ha.Ta,read:Ve.Ha.read,write:Ve.Ha.write,lb:Ve.Ha.lb,bb:Ve.Ha.bb,cb:Ve.Ha.cb}},link:{node:{Pa:Ve.Ga.Pa,Oa:Ve.Ga.Oa,readlink:Ve.Ga.readlink},stream:{}},pb:{node:{Pa:Ve.Ga.Pa,Oa:Ve.Ga.Oa},stream:uo}}),D=lo(u,y,D,U),Gt(D.mode)?(D.Ga=Ve.Qa.dir.node,D.Ha=Ve.Qa.dir.stream,D.Ia={}):(D.mode&61440)===32768?(D.Ga=Ve.Qa.file.node,D.Ha=Ve.Qa.file.stream,D.Ma=0,D.Ia=null):(D.mode&61440)===40960?(D.Ga=Ve.Qa.link.node,D.Ha=Ve.Qa.link.stream):(D.mode&61440)===8192&&(D.Ga=Ve.Qa.pb.node,D.Ha=Ve.Qa.pb.stream),D.timestamp=Date.now(),u&&(u.Ia[y]=D,u.timestamp=D.timestamp),D},Lb(u){return u.Ia?u.Ia.subarray?u.Ia.subarray(0,u.Ma):new Uint8Array(u.Ia):new Uint8Array(0)},Ga:{Pa(u){var y={};return y.dev=(u.mode&61440)===8192?u.id:1,y.ino=u.id,y.mode=u.mode,y.nlink=1,y.uid=0,y.gid=0,y.rdev=u.rdev,Gt(u.mode)?y.size=4096:(u.mode&61440)===32768?y.size=u.Ma:(u.mode&61440)===40960?y.size=u.link.length:y.size=0,y.atime=new Date(u.timestamp),y.mtime=new Date(u.timestamp),y.ctime=new Date(u.timestamp),y.zb=4096,y.blocks=Math.ceil(y.size/y.zb),y},Oa(u,y){if(y.mode!==void 0&&(u.mode=y.mode),y.timestamp!==void 0&&(u.timestamp=y.timestamp),y.size!==void 0&&(y=y.size,u.Ma!=y))if(y==0)u.Ia=null,u.Ma=0;else{var D=u.Ia;u.Ia=new Uint8Array(y),D&&u.Ia.set(D.subarray(0,Math.min(y,u.Ma))),u.Ma=y}},lookup(){throw Fs[44]},ab(u,y,D,U){return Ve.createNode(u,y,D,U)},rename(u,y,D){if(Gt(u.mode)){try{var U=Er(y,D)}catch{}if(U)for(var X in U.Ia)throw new Fe(55)}delete u.parent.Ia[u.name],u.parent.timestamp=Date.now(),u.name=D,y.Ia[D]=u,y.timestamp=u.parent.timestamp,u.parent=y},unlink(u,y){delete u.Ia[y],u.timestamp=Date.now()},rmdir(u,y){var D=Er(u,y),U;for(U in D.Ia)throw new Fe(55);delete u.Ia[y],u.timestamp=Date.now()},readdir(u){var y=[".",".."],D;for(D of Object.keys(u.Ia))y.push(D);return y},symlink(u,y,D){return u=Ve.createNode(u,y,41471,0),u.link=D,u},readlink(u){if((u.mode&61440)!==40960)throw new Fe(28);return u.link}},Ha:{read(u,y,D,U,X){var we=u.node.Ia;if(X>=u.node.Ma)return 0;if(u=Math.min(u.node.Ma-X,U),8<u&&we.subarray)y.set(we.subarray(X,X+u),D);else for(U=0;U<u;U++)y[D+U]=we[X+U];return u},write(u,y,D,U,X,we){if(y.buffer===B.buffer&&(we=!1),!U)return 0;if(u=u.node,u.timestamp=Date.now(),y.subarray&&(!u.Ia||u.Ia.subarray)){if(we)return u.Ia=y.subarray(D,D+U),u.Ma=U;if(u.Ma===0&&X===0)return u.Ia=y.slice(D,D+U),u.Ma=U;if(X+U<=u.Ma)return u.Ia.set(y.subarray(D,D+U),X),U}if(pt(u,X+U),u.Ia.subarray&&y.subarray)u.Ia.set(y.subarray(D,D+U),X);else for(we=0;we<U;we++)u.Ia[X+we]=y[D+we];return u.Ma=Math.max(u.Ma,X+U),U},Ta(u,y,D){if(D===1?y+=u.position:D===2&&(u.node.mode&61440)===32768&&(y+=u.node.Ma),0>y)throw new Fe(28);return y},lb(u,y,D){pt(u.node,y+D),u.node.Ma=Math.max(u.node.Ma,y+D)},bb(u,y,D,U,X){if((u.node.mode&61440)!==32768)throw new Fe(43);if(u=u.node.Ia,X&2||u.buffer!==B.buffer){if((0<D||D+y<u.length)&&(u.subarray?u=u.subarray(D,D+y):u=Array.prototype.slice.call(u,D,D+y)),D=!0,y=65536*Math.ceil(y/65536),(X=wo(65536,y))?(Y.fill(0,X,X+y),y=X):y=0,!y)throw new Fe(48);B.set(u,y)}else D=!1,y=u.byteOffset;return{Db:y,ub:D}},cb(u,y,D,U){return Ve.Ha.write(u,y,0,U,D,!1),0}}},jr=(u,y)=>{var D=0;return u&&(D|=365),y&&(D|=146),D},cr=null,Rr={},qt=[],pn=1,qr=null,ka=!0,Fe=null,Fs={};function $t(u,y={}){if(u=ut(u),!u)return{path:"",node:null};if(y=Object.assign({qb:!0,kb:0},y),8<y.kb)throw new Fe(32);u=u.split("/").filter(Ee=>!!Ee);for(var D=cr,U="/",X=0;X<u.length;X++){var we=X===u.length-1;if(we&&y.parent)break;if(D=Er(D,u[X]),U=ne(U+"/"+u[X]),D.Va&&(!we||we&&y.qb)&&(D=D.Va.root),!we||y.Sa){for(we=0;(D.mode&61440)===40960;)if(D=Et(U),U=ut(je(U),D),D=$t(U,{kb:y.kb+1}).node,40<we++)throw new Fe(32)}}return{path:U,node:D}}function In(u){for(var y;;){if(u===u.parent)return u=u.Ra.tb,y?u[u.length-1]!=="/"?`${u}/${y}`:u+y:u;y=y?`${u.name}/${y}`:u.name,u=u.parent}}function gn(u,y){for(var D=0,U=0;U<y.length;U++)D=(D<<5)-D+y.charCodeAt(U)|0;return(u+D>>>0)%qr.length}function Ps(u){var y=gn(u.parent.id,u.name);if(qr[y]===u)qr[y]=u.Wa;else for(y=qr[y];y;){if(y.Wa===u){y.Wa=u.Wa;break}y=y.Wa}}function Er(u,y){var D;if(D=(D=$r(u,"x"))?D:u.Ga.lookup?0:2)throw new Fe(D,u);for(D=qr[gn(u.id,y)];D;D=D.Wa){var U=D.name;if(D.parent.id===u.id&&U===y)return D}return u.Ga.lookup(u,y)}function lo(u,y,D,U){return u=new Rn(u,y,D,U),y=gn(u.parent.id,u.name),u.Wa=qr[y],qr[y]=u}function Gt(u){return(u&61440)===16384}function ss(u){var y=["r","w","rw"][u&3];return u&512&&(y+="w"),y}function $r(u,y){if(ka)return 0;if(!y.includes("r")||u.mode&292){if(y.includes("w")&&!(u.mode&146)||y.includes("x")&&!(u.mode&73))return 2}else return 2;return 0}function Us(u,y){try{return Er(u,y),20}catch{}return $r(u,"wx")}function co(u,y,D){try{var U=Er(u,y)}catch(X){return X.Ka}if(u=$r(u,"wx"))return u;if(D){if(!Gt(U.mode))return 54;if(U===U.parent||In(U)==="/")return 10}else if(Gt(U.mode))return 31;return 0}function Mi(){for(var u=0;4096>=u;u++)if(!qt[u])return u;throw new Fe(33)}function Jt(u){if(u=qt[u],!u)throw new Fe(8);return u}function sn(u,y=-1){return Gr||(Gr=function(){this.$a={}},Gr.prototype={},Object.defineProperties(Gr.prototype,{object:{get(){return this.node},set(D){this.node=D}},flags:{get(){return this.$a.flags},set(D){this.$a.flags=D}},position:{get(){return this.$a.position},set(D){this.$a.position=D}}})),u=Object.assign(new Gr,u),y==-1&&(y=Mi()),u.fd=y,qt[y]=u}var uo={open(u){var y,D;u.Ha=Rr[u.node.rdev].Ha,(D=(y=u.Ha).open)==null||D.call(y,u)},Ta(){throw new Fe(70)}};function zs(u,y){Rr[u]={Ha:y}}function fo(u,y){var D=y==="/",U=!y;if(D&&cr)throw new Fe(10);if(!D&&!U){var X=$t(y,{qb:!1});if(y=X.path,X=X.node,X.Va)throw new Fe(10);if(!Gt(X.mode))throw new Fe(54)}y={type:u,Pb:{},tb:y,Cb:[]},u=u.Ra(y),u.Ra=y,y.root=u,D?cr=u:X&&(X.Va=y,X.Ra&&X.Ra.Cb.push(y))}function as(u,y,D){var U=$t(u,{parent:!0}).node;if(u=Me(u),!u||u==="."||u==="..")throw new Fe(28);var X=Us(U,u);if(X)throw new Fe(X);if(!U.Ga.ab)throw new Fe(63);return U.Ga.ab(U,u,y,D)}function Nr(u,y){return as(u,(y!==void 0?y:511)&1023|16384,0)}function os(u,y,D){typeof D>"u"&&(D=y,y=438),as(u,y|8192,D)}function Bs(u,y){if(!ut(u))throw new Fe(44);var D=$t(y,{parent:!0}).node;if(!D)throw new Fe(44);y=Me(y);var U=Us(D,y);if(U)throw new Fe(U);if(!D.Ga.symlink)throw new Fe(63);D.Ga.symlink(D,y,u)}function ho(u){var y=$t(u,{parent:!0}).node;u=Me(u);var D=Er(y,u),U=co(y,u,!0);if(U)throw new Fe(U);if(!y.Ga.rmdir)throw new Fe(63);if(D.Va)throw new Fe(10);y.Ga.rmdir(y,u),Ps(D)}function mo(u){var y=$t(u,{parent:!0}).node;if(!y)throw new Fe(44);u=Me(u);var D=Er(y,u),U=co(y,u,!1);if(U)throw new Fe(U);if(!y.Ga.unlink)throw new Fe(63);if(D.Va)throw new Fe(10);y.Ga.unlink(y,u),Ps(D)}function Et(u){if(u=$t(u).node,!u)throw new Fe(44);if(!u.Ga.readlink)throw new Fe(28);return ut(In(u.parent),u.Ga.readlink(u))}function is(u,y){if(u=$t(u,{Sa:!y}).node,!u)throw new Fe(44);if(!u.Ga.Pa)throw new Fe(63);return u.Ga.Pa(u)}function Hs(u){return is(u,!0)}function ls(u,y){if(u=typeof u=="string"?$t(u,{Sa:!0}).node:u,!u.Ga.Oa)throw new Fe(63);u.Ga.Oa(u,{mode:y&4095|u.mode&-4096,timestamp:Date.now()})}function cs(u,y){if(0>y)throw new Fe(28);if(u=typeof u=="string"?$t(u,{Sa:!0}).node:u,!u.Ga.Oa)throw new Fe(63);if(Gt(u.mode))throw new Fe(31);if((u.mode&61440)!==32768)throw new Fe(28);var D=$r(u,"w");if(D)throw new Fe(D);u.Ga.Oa(u,{size:y,timestamp:Date.now()})}function Dn(u,y,D){if(u==="")throw new Fe(44);if(typeof y=="string"){var U={r:0,"r+":2,w:577,"w+":578,a:1089,"a+":1090}[y];if(typeof U>"u")throw Error(`Unknown file open mode: ${y}`);y=U}if(D=y&64?(typeof D>"u"?438:D)&4095|32768:0,typeof u=="object")var X=u;else{u=ne(u);try{X=$t(u,{Sa:!(y&131072)}).node}catch{}}if(U=!1,y&64)if(X){if(y&128)throw new Fe(20)}else X=as(u,D,0),U=!0;if(!X)throw new Fe(44);if((X.mode&61440)===8192&&(y&=-513),y&65536&&!Gt(X.mode))throw new Fe(54);if(!U&&(D=X?(X.mode&61440)===40960?32:Gt(X.mode)&&(ss(y)!=="r"||y&512)?31:$r(X,ss(y)):44))throw new Fe(D);return y&512&&!U&&cs(X,0),y&=-131713,X=sn({node:X,path:In(X),flags:y,seekable:!0,position:0,Ha:X.Ha,Fb:[],error:!1}),X.Ha.open&&X.Ha.open(X),!h.logReadFiles||y&1||(Tn||(Tn={}),u in Tn||(Tn[u]=1)),X}function qs(u){if(u.fd===null)throw new Fe(8);u.hb&&(u.hb=null);try{u.Ha.close&&u.Ha.close(u)}catch(y){throw y}finally{qt[u.fd]=null}u.fd=null}function us(u,y,D){if(u.fd===null)throw new Fe(8);if(!u.seekable||!u.Ha.Ta)throw new Fe(70);if(D!=0&&D!=1&&D!=2)throw new Fe(28);u.position=u.Ha.Ta(u,y,D),u.Fb=[]}function _r(u,y,D,U,X){if(0>U||0>X)throw new Fe(28);if(u.fd===null)throw new Fe(8);if((u.flags&2097155)===1)throw new Fe(8);if(Gt(u.node.mode))throw new Fe(31);if(!u.Ha.read)throw new Fe(28);var we=typeof X<"u";if(!we)X=u.position;else if(!u.seekable)throw new Fe(70);return y=u.Ha.read(u,y,D,U,X),we||(u.position+=y),y}function po(u,y,D,U,X){if(0>U||0>X)throw new Fe(28);if(u.fd===null)throw new Fe(8);if((u.flags&2097155)===0)throw new Fe(8);if(Gt(u.node.mode))throw new Fe(31);if(!u.Ha.write)throw new Fe(28);u.seekable&&u.flags&1024&&us(u,0,2);var we=typeof X<"u";if(!we)X=u.position;else if(!u.seekable)throw new Fe(70);return y=u.Ha.write(u,y,D,U,X,void 0),we||(u.position+=y),y}function Cr(u){var y,D=Dn(u,D||0);u=is(u).size;var U=new Uint8Array(u);return _r(D,U,0,u,0),y=U,qs(D),y}function go(){Fe||(Fe=function(u,y){this.name="ErrnoError",this.node=y,this.Eb=function(D){this.Ka=D},this.Eb(u),this.message="FS error"},Fe.prototype=Error(),Fe.prototype.constructor=Fe,[44].forEach(u=>{Fs[u]=new Fe(u),Fs[u].stack="<generic error, no stack>"}))}var xo;function ds(u,y,D){u=ne("/dev/"+u);var U=jr(!!y,!!D);fs||(fs=64);var X=fs++<<8|0;zs(X,{open(we){we.seekable=!1},close(){var we;(we=D==null?void 0:D.buffer)!=null&&we.length&&D(10)},read(we,Ee,Xe,ht){for(var tt=0,Nt=0;Nt<ht;Nt++){try{var Ct=y()}catch{throw new Fe(29)}if(Ct===void 0&&tt===0)throw new Fe(6);if(Ct==null)break;tt++,Ee[Xe+Nt]=Ct}return tt&&(we.node.timestamp=Date.now()),tt},write(we,Ee,Xe,ht){for(var tt=0;tt<ht;tt++)try{D(Ee[Xe+tt])}catch{throw new Fe(29)}return ht&&(we.node.timestamp=Date.now()),tt}}),os(u,U,X)}var fs,vt={},Gr,Tn;function xn(u,y,D){if(y.charAt(0)==="/")return y;if(u=u===-100?"/":Jt(u).path,y.length==0){if(!D)throw new Fe(44);return u}return ne(u+"/"+y)}function $s(u,y,D){try{var U=u(y)}catch(we){if(we&&we.node&&ne(y)!==ne(In(we.node)))return-54;throw we}Q[D>>2]=U.dev,Q[D+4>>2]=U.mode,N[D+8>>2]=U.nlink,Q[D+12>>2]=U.uid,Q[D+16>>2]=U.gid,Q[D+20>>2]=U.rdev,E=[U.size>>>0,(Re=U.size,1<=+Math.abs(Re)?0<Re?+Math.floor(Re/4294967296)>>>0:~~+Math.ceil((Re-+(~~Re>>>0))/4294967296)>>>0:0)],Q[D+24>>2]=E[0],Q[D+28>>2]=E[1],Q[D+32>>2]=4096,Q[D+36>>2]=U.blocks,u=U.atime.getTime(),y=U.mtime.getTime();var X=U.ctime.getTime();return E=[Math.floor(u/1e3)>>>0,(Re=Math.floor(u/1e3),1<=+Math.abs(Re)?0<Re?+Math.floor(Re/4294967296)>>>0:~~+Math.ceil((Re-+(~~Re>>>0))/4294967296)>>>0:0)],Q[D+40>>2]=E[0],Q[D+44>>2]=E[1],N[D+48>>2]=u%1e3*1e3,E=[Math.floor(y/1e3)>>>0,(Re=Math.floor(y/1e3),1<=+Math.abs(Re)?0<Re?+Math.floor(Re/4294967296)>>>0:~~+Math.ceil((Re-+(~~Re>>>0))/4294967296)>>>0:0)],Q[D+56>>2]=E[0],Q[D+60>>2]=E[1],N[D+64>>2]=y%1e3*1e3,E=[Math.floor(X/1e3)>>>0,(Re=Math.floor(X/1e3),1<=+Math.abs(Re)?0<Re?+Math.floor(Re/4294967296)>>>0:~~+Math.ceil((Re-+(~~Re>>>0))/4294967296)>>>0:0)],Q[D+72>>2]=E[0],Q[D+76>>2]=E[1],N[D+80>>2]=X%1e3*1e3,E=[U.ino>>>0,(Re=U.ino,1<=+Math.abs(Re)?0<Re?+Math.floor(Re/4294967296)>>>0:~~+Math.ceil((Re-+(~~Re>>>0))/4294967296)>>>0:0)],Q[D+88>>2]=E[0],Q[D+92>>2]=E[1],0}var An=void 0;function hs(){var u=Q[+An>>2];return An+=4,u}var yn=(u,y)=>y+2097152>>>0<4194305-!!u?(u>>>0)+4294967296*y:NaN,ms=[0,31,60,91,121,152,182,213,244,274,305,335],Li=[0,31,59,90,120,151,181,212,243,273,304,334],Gs=u=>{var y=bt(u)+1,D=vs(y);return D&&Ue(u,Y,D,y),D},gt={},Sa=()=>{if(!Ws){var u={USER:"web_user",LOGNAME:"web_user",PATH:"/",PWD:"/",HOME:"/home/web_user",LANG:(typeof navigator=="object"&&navigator.languages&&navigator.languages[0]||"C").replace("-","_")+".UTF-8",_:k||"./this.program"},y;for(y in gt)gt[y]===void 0?delete u[y]:u[y]=gt[y];var D=[];for(y in u)D.push(`${y}=${u[y]}`);Ws=D}return Ws},Ws,ps=u=>{var y=bt(u)+1,D=Qr(y);return Ue(u,Y,D,y),D},yo=(u,y,D,U)=>{var X={string:tt=>{var Nt=0;return tt!=null&&tt!==0&&(Nt=ps(tt)),Nt},array:tt=>{var Nt=Qr(tt.length);return B.set(tt,Nt),Nt}};u=h["_"+u];var we=[],Ee=0;if(U)for(var Xe=0;Xe<U.length;Xe++){var ht=X[D[Xe]];ht?(Ee===0&&(Ee=Mn()),we[Xe]=ht(U[Xe])):we[Xe]=U[Xe]}return D=u.apply(null,we),D=function(tt){return Ee!==0&&on(Ee),y==="string"?tt?ee(Y,tt):"":y==="boolean"?!!tt:tt}(D)},gs=0,xs=(u,y)=>(y=y==1?Qr(u.length):vs(u.length),u.subarray||u.slice||(u=new Uint8Array(u)),Y.set(u,y),y),Wr,On=[],Wt,ur=u=>{Wr.delete(Wt.get(u)),Wt.set(u,null),On.push(u)},Ir=(u,y)=>{if(!Wr){Wr=new WeakMap;var D=Wt.length;if(Wr)for(var U=0;U<0+D;U++){var X=Wt.get(U);X&&Wr.set(X,U)}}if(D=Wr.get(u)||0)return D;if(On.length)D=On.pop();else{try{Wt.grow(1)}catch(Xe){throw Xe instanceof RangeError?"Unable to grow wasm table. Set ALLOW_TABLE_GROWTH.":Xe}D=Wt.length-1}try{Wt.set(D,u)}catch(Xe){if(!(Xe instanceof TypeError))throw Xe;if(typeof WebAssembly.Function=="function"){U=WebAssembly.Function,X={i:"i32",j:"i64",f:"f32",d:"f64",e:"externref",p:"i32"};for(var we={parameters:[],results:y[0]=="v"?[]:[X[y[0]]]},Ee=1;Ee<y.length;++Ee)we.parameters.push(X[y[Ee]]);y=new U(we,u)}else{for(U=[1],X=y.slice(0,1),y=y.slice(1),we={i:127,p:127,j:126,f:125,d:124,e:111},U.push(96),Ee=y.length,128>Ee?U.push(Ee):U.push(Ee%128|128,Ee>>7),Ee=0;Ee<y.length;++Ee)U.push(we[y[Ee]]);X=="v"?U.push(0):U.push(1,we[X]),y=[0,97,115,109,1,0,0,0,1],X=U.length,128>X?y.push(X):y.push(X%128|128,X>>7),y.push.apply(y,U),y.push(2,7,1,1,101,1,102,0,0,7,5,1,1,102,0,0),y=new WebAssembly.Module(new Uint8Array(y)),y=new WebAssembly.Instance(y,{e:{f:u}}).exports.f}Wt.set(D,y)}return Wr.set(u,D),D};function Rn(u,y,D,U){u||(u=this),this.parent=u,this.Ra=u.Ra,this.Va=null,this.id=pn++,this.name=y,this.mode=D,this.Ga={},this.Ha={},this.rdev=U}Object.defineProperties(Rn.prototype,{read:{get:function(){return(this.mode&365)===365},set:function(u){u?this.mode|=365:this.mode&=-366}},write:{get:function(){return(this.mode&146)===146},set:function(u){u?this.mode|=146:this.mode&=-147}}}),go(),qr=Array(4096),fo(Ve,"/"),Nr("/tmp"),Nr("/home"),Nr("/home/web_user"),function(){Nr("/dev"),zs(259,{read:()=>0,write:(U,X,we,Ee)=>Ee}),os("/dev/null",259),it(1280,Ht),it(1536,ft),os("/dev/tty",1280),os("/dev/tty1",1536);var u=new Uint8Array(1024),y=0,D=()=>(y===0&&(y=ze(u).byteLength),u[--y]);ds("random",D),ds("urandom",D),Nr("/dev/shm"),Nr("/dev/shm/tmp")}(),function(){Nr("/proc");var u=Nr("/proc/self");Nr("/proc/self/fd"),fo({Ra(){var y=lo(u,"fd",16895,73);return y.Ga={lookup(D,U){var X=Jt(+U);return D={parent:null,Ra:{tb:"fake"},Ga:{readlink:()=>X.path}},D.parent=D}},y}},"/proc/self/fd")}();var ys={a:(u,y,D,U)=>{he(`Assertion failed: ${u?ee(Y,u):""}, at: `+[y?y?ee(Y,y):"":"unknown filename",D,U?U?ee(Y,U):"":"unknown function"])},h:function(u,y){try{return u=u?ee(Y,u):"",ls(u,y),0}catch(D){if(typeof vt>"u"||D.name!=="ErrnoError")throw D;return-D.Ka}},H:function(u,y,D){try{if(y=y?ee(Y,y):"",y=xn(u,y),D&-8)return-28;var U=$t(y,{Sa:!0}).node;return U?(u="",D&4&&(u+="r"),D&2&&(u+="w"),D&1&&(u+="x"),u&&$r(U,u)?-2:0):-44}catch(X){if(typeof vt>"u"||X.name!=="ErrnoError")throw X;return-X.Ka}},i:function(u,y){try{var D=Jt(u);return ls(D.node,y),0}catch(U){if(typeof vt>"u"||U.name!=="ErrnoError")throw U;return-U.Ka}},g:function(u){try{var y=Jt(u).node,D=typeof y=="string"?$t(y,{Sa:!0}).node:y;if(!D.Ga.Oa)throw new Fe(63);return D.Ga.Oa(D,{timestamp:Date.now()}),0}catch(U){if(typeof vt>"u"||U.name!=="ErrnoError")throw U;return-U.Ka}},b:function(u,y,D){An=D;try{var U=Jt(u);switch(y){case 0:var X=hs();if(0>X)return-28;for(;qt[X];)X++;return sn(U,X).fd;case 1:case 2:return 0;case 3:return U.flags;case 4:return X=hs(),U.flags|=X,0;case 5:return X=hs(),q[X+0>>1]=2,0;case 6:case 7:return 0;case 16:case 8:return-28;case 9:return Q[vo()>>2]=28,-1;default:return-28}}catch(we){if(typeof vt>"u"||we.name!=="ErrnoError")throw we;return-we.Ka}},f:function(u,y){try{var D=Jt(u);return $s(is,D.path,y)}catch(U){if(typeof vt>"u"||U.name!=="ErrnoError")throw U;return-U.Ka}},n:function(u,y,D){y=yn(y,D);try{if(isNaN(y))return 61;var U=Jt(u);if((U.flags&2097155)===0)throw new Fe(28);return cs(U.node,y),0}catch(X){if(typeof vt>"u"||X.name!=="ErrnoError")throw X;return-X.Ka}},C:function(u,y){try{if(y===0)return-28;var D=bt("/")+1;return y<D?-68:(Ue("/",Y,u,y),D)}catch(U){if(typeof vt>"u"||U.name!=="ErrnoError")throw U;return-U.Ka}},F:function(u,y){try{return u=u?ee(Y,u):"",$s(Hs,u,y)}catch(D){if(typeof vt>"u"||D.name!=="ErrnoError")throw D;return-D.Ka}},z:function(u,y,D){try{return y=y?ee(Y,y):"",y=xn(u,y),y=ne(y),y[y.length-1]==="/"&&(y=y.substr(0,y.length-1)),Nr(y,D),0}catch(U){if(typeof vt>"u"||U.name!=="ErrnoError")throw U;return-U.Ka}},E:function(u,y,D,U){try{y=y?ee(Y,y):"";var X=U&256;return y=xn(u,y,U&4096),$s(X?Hs:is,y,D)}catch(we){if(typeof vt>"u"||we.name!=="ErrnoError")throw we;return-we.Ka}},y:function(u,y,D,U){An=U;try{y=y?ee(Y,y):"",y=xn(u,y);var X=U?hs():0;return Dn(y,D,X).fd}catch(we){if(typeof vt>"u"||we.name!=="ErrnoError")throw we;return-we.Ka}},w:function(u,y,D,U){try{if(y=y?ee(Y,y):"",y=xn(u,y),0>=U)return-28;var X=Et(y),we=Math.min(U,bt(X)),Ee=B[D+we];return Ue(X,Y,D,U+1),B[D+we]=Ee,we}catch(Xe){if(typeof vt>"u"||Xe.name!=="ErrnoError")throw Xe;return-Xe.Ka}},v:function(u){try{return u=u?ee(Y,u):"",ho(u),0}catch(y){if(typeof vt>"u"||y.name!=="ErrnoError")throw y;return-y.Ka}},G:function(u,y){try{return u=u?ee(Y,u):"",$s(is,u,y)}catch(D){if(typeof vt>"u"||D.name!=="ErrnoError")throw D;return-D.Ka}},r:function(u,y,D){try{return y=y?ee(Y,y):"",y=xn(u,y),D===0?mo(y):D===512?ho(y):he("Invalid flags passed to unlinkat"),0}catch(U){if(typeof vt>"u"||U.name!=="ErrnoError")throw U;return-U.Ka}},q:function(u,y,D){try{if(y=y?ee(Y,y):"",y=xn(u,y,!0),D){var U=N[D>>2]+4294967296*Q[D+4>>2],X=Q[D+8>>2];we=1e3*U+X/1e6,D+=16,U=N[D>>2]+4294967296*Q[D+4>>2],X=Q[D+8>>2],Ee=1e3*U+X/1e6}else var we=Date.now(),Ee=we;u=we;var Xe=$t(y,{Sa:!0}).node;return Xe.Ga.Oa(Xe,{timestamp:Math.max(u,Ee)}),0}catch(ht){if(typeof vt>"u"||ht.name!=="ErrnoError")throw ht;return-ht.Ka}},l:function(u,y,D){u=new Date(1e3*yn(u,y)),Q[D>>2]=u.getSeconds(),Q[D+4>>2]=u.getMinutes(),Q[D+8>>2]=u.getHours(),Q[D+12>>2]=u.getDate(),Q[D+16>>2]=u.getMonth(),Q[D+20>>2]=u.getFullYear()-1900,Q[D+24>>2]=u.getDay(),y=u.getFullYear(),Q[D+28>>2]=(y%4!==0||y%100===0&&y%400!==0?Li:ms)[u.getMonth()]+u.getDate()-1|0,Q[D+36>>2]=-(60*u.getTimezoneOffset()),y=new Date(u.getFullYear(),6,1).getTimezoneOffset();var U=new Date(u.getFullYear(),0,1).getTimezoneOffset();Q[D+32>>2]=(y!=U&&u.getTimezoneOffset()==Math.min(U,y))|0},j:function(u,y,D,U,X,we,Ee,Xe){X=yn(X,we);try{if(isNaN(X))return 61;var ht=Jt(U);if((y&2)!==0&&(D&2)===0&&(ht.flags&2097155)!==2)throw new Fe(2);if((ht.flags&2097155)===1)throw new Fe(2);if(!ht.Ha.bb)throw new Fe(43);var tt=ht.Ha.bb(ht,u,X,y,D),Nt=tt.Db;return Q[Ee>>2]=tt.ub,N[Xe>>2]=Nt,0}catch(Ct){if(typeof vt>"u"||Ct.name!=="ErrnoError")throw Ct;return-Ct.Ka}},k:function(u,y,D,U,X,we,Ee){we=yn(we,Ee);try{if(isNaN(we))return 61;var Xe=Jt(X);if(D&2){if((Xe.node.mode&61440)!==32768)throw new Fe(43);if(!(U&2)){var ht=Y.slice(u,u+y);Xe.Ha.cb&&Xe.Ha.cb(Xe,ht,we,y,U)}}}catch(tt){if(typeof vt>"u"||tt.name!=="ErrnoError")throw tt;return-tt.Ka}},s:(u,y,D)=>{function U(ht){return(ht=ht.toTimeString().match(/\(([A-Za-z ]+)\)$/))?ht[1]:"GMT"}var X=new Date().getFullYear(),we=new Date(X,0,1),Ee=new Date(X,6,1);X=we.getTimezoneOffset();var Xe=Ee.getTimezoneOffset();N[u>>2]=60*Math.max(X,Xe),Q[y>>2]=+(X!=Xe),u=U(we),y=U(Ee),u=Gs(u),y=Gs(y),Xe<X?(N[D>>2]=u,N[D+4>>2]=y):(N[D>>2]=y,N[D+4>>2]=u)},d:()=>Date.now(),t:()=>2147483648,c:()=>performance.now(),o:u=>{var y=Y.length;if(u>>>=0,2147483648<u)return!1;for(var D=1;4>=D;D*=2){var U=y*(1+.2/D);U=Math.min(U,u+100663296);var X=Math;U=Math.max(u,U);e:{X=(X.min.call(X,2147483648,U+(65536-U%65536)%65536)-K.buffer.byteLength+65535)/65536;try{K.grow(X),fe();var we=1;break e}catch{}we=void 0}if(we)return!0}return!1},A:(u,y)=>{var D=0;return Sa().forEach((U,X)=>{var we=y+D;for(X=N[u+4*X>>2]=we,we=0;we<U.length;++we)B[X++>>0]=U.charCodeAt(we);B[X>>0]=0,D+=U.length+1}),0},B:(u,y)=>{var D=Sa();N[u>>2]=D.length;var U=0;return D.forEach(X=>U+=X.length+1),N[y>>2]=U,0},e:function(u){try{var y=Jt(u);return qs(y),0}catch(D){if(typeof vt>"u"||D.name!=="ErrnoError")throw D;return D.Ka}},p:function(u,y){try{var D=Jt(u);return B[y>>0]=D.tty?2:Gt(D.mode)?3:(D.mode&61440)===40960?7:4,q[y+2>>1]=0,E=[0,(Re=0,1<=+Math.abs(Re)?0<Re?+Math.floor(Re/4294967296)>>>0:~~+Math.ceil((Re-+(~~Re>>>0))/4294967296)>>>0:0)],Q[y+8>>2]=E[0],Q[y+12>>2]=E[1],E=[0,(Re=0,1<=+Math.abs(Re)?0<Re?+Math.floor(Re/4294967296)>>>0:~~+Math.ceil((Re-+(~~Re>>>0))/4294967296)>>>0:0)],Q[y+16>>2]=E[0],Q[y+20>>2]=E[1],0}catch(U){if(typeof vt>"u"||U.name!=="ErrnoError")throw U;return U.Ka}},x:function(u,y,D,U){try{e:{var X=Jt(u);u=y;for(var we,Ee=y=0;Ee<D;Ee++){var Xe=N[u>>2],ht=N[u+4>>2];u+=8;var tt=_r(X,B,Xe,ht,we);if(0>tt){var Nt=-1;break e}if(y+=tt,tt<ht)break;typeof we<"u"&&(we+=tt)}Nt=y}return N[U>>2]=Nt,0}catch(Ct){if(typeof vt>"u"||Ct.name!=="ErrnoError")throw Ct;return Ct.Ka}},m:function(u,y,D,U,X){y=yn(y,D);try{if(isNaN(y))return 61;var we=Jt(u);return us(we,y,U),E=[we.position>>>0,(Re=we.position,1<=+Math.abs(Re)?0<Re?+Math.floor(Re/4294967296)>>>0:~~+Math.ceil((Re-+(~~Re>>>0))/4294967296)>>>0:0)],Q[X>>2]=E[0],Q[X+4>>2]=E[1],we.hb&&y===0&&U===0&&(we.hb=null),0}catch(Ee){if(typeof vt>"u"||Ee.name!=="ErrnoError")throw Ee;return Ee.Ka}},D:function(u){var D;try{var y=Jt(u);return(D=y.Ha)!=null&&D.fsync?y.Ha.fsync(y):0}catch(U){if(typeof vt>"u"||U.name!=="ErrnoError")throw U;return U.Ka}},u:function(u,y,D,U){try{e:{var X=Jt(u);u=y;for(var we,Ee=y=0;Ee<D;Ee++){var Xe=N[u>>2],ht=N[u+4>>2];u+=8;var tt=po(X,B,Xe,ht,we);if(0>tt){var Nt=-1;break e}y+=tt,typeof we<"u"&&(we+=tt)}Nt=y}return N[U>>2]=Nt,0}catch(Ct){if(typeof vt>"u"||Ct.name!=="ErrnoError")throw Ct;return Ct.Ka}}},$e=function(){var D;function u(U){var X;return $e=U.exports,K=$e.I,fe(),Wt=$e.Aa,ue.unshift($e.J),F--,(X=h.monitorRunDependencies)==null||X.call(h,F),F==0&&de&&(U=de,de=null,U()),$e}var y={a:ys};if(F++,(D=h.monitorRunDependencies)==null||D.call(h,F),h.instantiateWasm)try{return h.instantiateWasm(y,u)}catch(U){return P(`Module.instantiateWasm callback failed with error: ${U}`),!1}return Ye(y,function(U){u(U.instance)}),{}}();h._sqlite3_free=u=>(h._sqlite3_free=$e.K)(u),h._sqlite3_value_text=u=>(h._sqlite3_value_text=$e.L)(u);var vo=()=>(vo=$e.M)();h._sqlite3_prepare_v2=(u,y,D,U,X)=>(h._sqlite3_prepare_v2=$e.N)(u,y,D,U,X),h._sqlite3_step=u=>(h._sqlite3_step=$e.O)(u),h._sqlite3_reset=u=>(h._sqlite3_reset=$e.P)(u),h._sqlite3_exec=(u,y,D,U,X)=>(h._sqlite3_exec=$e.Q)(u,y,D,U,X),h._sqlite3_finalize=u=>(h._sqlite3_finalize=$e.R)(u),h._sqlite3_column_name=(u,y)=>(h._sqlite3_column_name=$e.S)(u,y),h._sqlite3_column_text=(u,y)=>(h._sqlite3_column_text=$e.T)(u,y),h._sqlite3_column_type=(u,y)=>(h._sqlite3_column_type=$e.U)(u,y),h._sqlite3_errmsg=u=>(h._sqlite3_errmsg=$e.V)(u),h._sqlite3_clear_bindings=u=>(h._sqlite3_clear_bindings=$e.W)(u),h._sqlite3_value_blob=u=>(h._sqlite3_value_blob=$e.X)(u),h._sqlite3_value_bytes=u=>(h._sqlite3_value_bytes=$e.Y)(u),h._sqlite3_value_double=u=>(h._sqlite3_value_double=$e.Z)(u),h._sqlite3_value_int=u=>(h._sqlite3_value_int=$e._)(u),h._sqlite3_value_type=u=>(h._sqlite3_value_type=$e.$)(u),h._sqlite3_result_blob=(u,y,D,U)=>(h._sqlite3_result_blob=$e.aa)(u,y,D,U),h._sqlite3_result_double=(u,y)=>(h._sqlite3_result_double=$e.ba)(u,y),h._sqlite3_result_error=(u,y,D)=>(h._sqlite3_result_error=$e.ca)(u,y,D),h._sqlite3_result_int=(u,y)=>(h._sqlite3_result_int=$e.da)(u,y),h._sqlite3_result_int64=(u,y,D)=>(h._sqlite3_result_int64=$e.ea)(u,y,D),h._sqlite3_result_null=u=>(h._sqlite3_result_null=$e.fa)(u),h._sqlite3_result_text=(u,y,D,U)=>(h._sqlite3_result_text=$e.ga)(u,y,D,U),h._sqlite3_aggregate_context=(u,y)=>(h._sqlite3_aggregate_context=$e.ha)(u,y),h._sqlite3_column_count=u=>(h._sqlite3_column_count=$e.ia)(u),h._sqlite3_data_count=u=>(h._sqlite3_data_count=$e.ja)(u),h._sqlite3_column_blob=(u,y)=>(h._sqlite3_column_blob=$e.ka)(u,y),h._sqlite3_column_bytes=(u,y)=>(h._sqlite3_column_bytes=$e.la)(u,y),h._sqlite3_column_double=(u,y)=>(h._sqlite3_column_double=$e.ma)(u,y),h._sqlite3_bind_blob=(u,y,D,U,X)=>(h._sqlite3_bind_blob=$e.na)(u,y,D,U,X),h._sqlite3_bind_double=(u,y,D)=>(h._sqlite3_bind_double=$e.oa)(u,y,D),h._sqlite3_bind_int=(u,y,D)=>(h._sqlite3_bind_int=$e.pa)(u,y,D),h._sqlite3_bind_text=(u,y,D,U,X)=>(h._sqlite3_bind_text=$e.qa)(u,y,D,U,X),h._sqlite3_bind_parameter_index=(u,y)=>(h._sqlite3_bind_parameter_index=$e.ra)(u,y),h._sqlite3_sql=u=>(h._sqlite3_sql=$e.sa)(u),h._sqlite3_normalized_sql=u=>(h._sqlite3_normalized_sql=$e.ta)(u),h._sqlite3_changes=u=>(h._sqlite3_changes=$e.ua)(u),h._sqlite3_close_v2=u=>(h._sqlite3_close_v2=$e.va)(u),h._sqlite3_create_function_v2=(u,y,D,U,X,we,Ee,Xe,ht)=>(h._sqlite3_create_function_v2=$e.wa)(u,y,D,U,X,we,Ee,Xe,ht),h._sqlite3_open=(u,y)=>(h._sqlite3_open=$e.xa)(u,y);var vs=h._malloc=u=>(vs=h._malloc=$e.ya)(u),an=h._free=u=>(an=h._free=$e.za)(u);h._RegisterExtensionFunctions=u=>(h._RegisterExtensionFunctions=$e.Ba)(u);var wo=(u,y)=>(wo=$e.Ca)(u,y),Mn=()=>(Mn=$e.Da)(),on=u=>(on=$e.Ea)(u),Qr=u=>(Qr=$e.Fa)(u);h.stackAlloc=Qr,h.stackSave=Mn,h.stackRestore=on,h.cwrap=(u,y,D,U)=>{var X=!D||D.every(we=>we==="number"||we==="boolean");return y!=="string"&&X&&!U?h["_"+u]:function(){return yo(u,y,D,arguments)}},h.addFunction=Ir,h.removeFunction=ur,h.UTF8ToString=ce,h.ALLOC_NORMAL=gs,h.allocate=xs,h.allocateUTF8OnStack=ps;var Qs;de=function u(){Qs||Ln(),Qs||(de=u)};function Ln(){function u(){if(!Qs&&(Qs=!0,h.calledRun=!0,!W)){if(h.noFSInit||xo||(xo=!0,go(),h.stdin=h.stdin,h.stdout=h.stdout,h.stderr=h.stderr,h.stdin?ds("stdin",h.stdin):Bs("/dev/tty","/dev/stdin"),h.stdout?ds("stdout",null,h.stdout):Bs("/dev/tty","/dev/stdout"),h.stderr?ds("stderr",null,h.stderr):Bs("/dev/tty1","/dev/stderr"),Dn("/dev/stdin",0),Dn("/dev/stdout",1),Dn("/dev/stderr",1)),ka=!1,ge(ue),h.onRuntimeInitialized&&h.onRuntimeInitialized(),h.postRun)for(typeof h.postRun=="function"&&(h.postRun=[h.postRun]);h.postRun.length;){var y=h.postRun.shift();z.unshift(y)}ge(z)}}if(!(0<F)){if(h.preRun)for(typeof h.preRun=="function"&&(h.preRun=[h.preRun]);h.preRun.length;)_();ge(ye),0<F||(h.setStatus?(h.setStatus("Running..."),setTimeout(function(){setTimeout(function(){h.setStatus("")},1),u()},1)):u())}}if(h.preInit)for(typeof h.preInit=="function"&&(h.preInit=[h.preInit]);0<h.preInit.length;)h.preInit.pop()();return Ln(),f}),o)};n.exports=p,n.exports.default=p}(Nc)),Nc.exports}var Cg=_g();const Ig=oo(Cg);function em(n){return new Promise((i,o)=>{const p=new Worker(new URL("/CogniFlow/assets/ankiImport.worker-iea3fFsE.js",import.meta.url),{type:"module"});p.onmessage=d=>{const{status:c,decks:l,error:f}=d.data;c==="success"?i(l):o(new Error(f)),p.terminate()},p.onerror=d=>{console.error("Worker error:",d);const c=d.message||"The worker script could not be loaded or an unexpected error occurred.";o(new Error(`Anki import worker failed: ${c}`)),p.terminate()},p.postMessage(n,[n])})}let Cc=null;async function Dg(){return Cc||(Cc=await Ig({locateFile:n=>`https://esm.sh/sql.js@1.10.3/dist/${n}`})),Cc}function yf(n,i){let o=n;return o=o.replace(/<img\s[^>]*?src=(["'])(.*?)\1[^>]*?>/gi,(p,d,c)=>{const l=decodeURIComponent(c),f=i.get(l);if(f){const v=btoa(new Uint8Array(f.data).reduce((C,k)=>C+String.fromCharCode(k),"")),h=`src="data:${f.type};base64,${v}"`;return p.replace(/src=(["']).*?\1/i,h)}return p}),o=o.replace(/\[sound:(.*?)\]/g,(p,d)=>{const c=decodeURIComponent(d.trim()),l=i.get(c);if(l){const f=btoa(new Uint8Array(l.data).reduce((v,h)=>v+String.fromCharCode(h),""));return l.type.startsWith("video/")?`<video controls playsinline src="data:${l.type};base64,${f}"></video>`:`<audio controls src="data:${l.type};base64,${f}"></audio>`}return""}),o}function vf(n,i,o,p,d){let c=n;const l=/{{c(\d+)::(.*?)(?:::(.*?))?}}/gs;c=c.replace(l,(C,k,I,x)=>{const S=parseInt(k,10);return p?S===o+1?`<span class="cloze">[${x||"..."}]</span>`:`<span class="cloze-inactive">${I}</span>`:S===o+1?`<span class="cloze"><b>${I}</b></span>`:`<span class="cloze-inactive">${I}</span>`}),d&&(c=c.replace(/<hr id=answer>/g,"").replace(/{{FrontSide}}/g,d));const f=/{{#([^}]+?)}}(.*?){{\/\1}}/gs;let v;do v=c,c=c.replace(f,(C,k,I)=>{const x=i.get(k.trim());return x&&x.trim()!==""?I:""});while(c!==v);const h=/{{\^([^}]+?)}}(.*?){{\/\1}}/gs;do v=c,c=c.replace(h,(C,k,I)=>{const x=i.get(k.trim());return!x||x.trim()===""?I:""});while(c!==v);return i.forEach((C,k)=>{const I=new RegExp(`{{${k}}}`,"g");c=c.replace(I,C)}),c=c.replace(/{{(.*?)}}/g,""),c}async function tm(n){var A;const i=await Dg(),o=await jg.loadAsync(n),p=o.file(/collection.anki2[1]?/);if(!p||p.length===0)throw new Error("collection.anki2 or .anki21 file not found.");const d=await p[0].async("uint8array"),c=new i.Database(d),l=o.file("media");let f={};if(l)try{f=JSON.parse(await l.async("string"))}catch(T){console.warn("Could not parse media file.",T)}const v=new Map;for(const T in f){const P=f[T],H=o.file(T);if(H){const K=await H.async("uint8array"),W=((A=P.split(".").pop())==null?void 0:A.toLowerCase())||"";let B="application/octet-stream";["jpg","jpeg"].includes(W)?B="image/jpeg":W==="png"?B="image/png":W==="gif"?B="image/gif":W==="svg"?B="image/svg+xml":W==="mp3"?B="audio/mpeg":W==="ogg"?B="audio/ogg":W==="wav"?B="audio/wav":W==="m4a"?B="audio/mp4":W==="opus"?B="audio/opus":W==="mp4"?B="video/mp4":W==="webm"?B="video/webm":W==="ogv"&&(B="video/ogg"),v.set(P,{data:K,type:B})}}const h=c.exec("SELECT models, decks, crt FROM col");if(!h[0])throw new Error("Could not read collection data.");const[C,k,I]=h[0].values[0],x=JSON.parse(C),S=JSON.parse(k),g=c.exec("SELECT id, mid, flds FROM notes"),b=new Map(g[0].values.map(T=>[T[0],{mid:T[1],flds:T[2].split("")}])),O=c.exec("SELECT id, nid, did, ord, due, ivl, factor, type, lapses FROM cards")[0].values,R=new Map;for(const T in S){const P=S[T];R.set(T,{id:crypto.randomUUID(),name:P.name,description:P.desc||"Imported Anki deck.",type:De.Flashcard,cards:[]})}for(const T of O){const[P,H,K,W,B,Y,q,Q,N]=T,Z=b.get(H);if(!Z)continue;const oe=x[Z.mid];if(!(oe!=null&&oe.tmpls))continue;const fe=R.get(K.toString());if(!fe)continue;const ye=oe.tmpls[W];if(!ye)continue;const ue=new Map((oe.flds||[]).map((ie,be)=>[ie.name,Z.flds[be]||""]));let z=vf(ye.qfmt,ue,W,!0),_=vf(ye.afmt,ue,W,!1,z);z=yf(z,v),_=yf(_,v);let F,de;Q===2&&Y>0?(F=new Date(I*1e3),F.setDate(F.getDate()+B),de=new Date(F.getTime()),de.setDate(de.getDate()-Y)):(F=new Date,F.setHours(0,0,0,0));const he=Math.min(1,Math.log1p(Y)/Math.log1p(90));fe.cards.push({id:P.toString(),front:z,back:_,css:oe.css?`<style>${oe.css}</style>`:"",dueDate:F.toISOString(),interval:Y,easeFactor:q?Math.max(q/1e3,Uc):ts,masteryLevel:he,lastReviewed:de==null?void 0:de.toISOString(),lapses:N||0})}return c.close(),Array.from(R.values()).filter(T=>T.cards.length>0)}const Tg={},wf=n=>{let i;const o=new Set,p=(C,k)=>{const I=typeof C=="function"?C(i):C;if(!Object.is(I,i)){const x=i;i=k??(typeof I!="object"||I===null)?I:Object.assign({},i,I),o.forEach(S=>S(i,x))}},d=()=>i,v={setState:p,getState:d,getInitialState:()=>h,subscribe:C=>(o.add(C),()=>o.delete(C)),destroy:()=>{(Tg?"production":void 0)!=="production"&&console.warn("[DEPRECATED] The `destroy` method will be unsupported in a future version. Instead use unsubscribe function returned by subscribe. Everything will be garbage-collected if store is garbage-collected."),o.clear()}},h=i=n(p,d,v);return v},Ag=n=>n?wf(n):wf;var Ic={exports:{}},Dc={},Tc={exports:{}},Ac={};/**
 * @license React
 * use-sync-external-store-shim.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var bf;function Og(){if(bf)return Ac;bf=1;var n=io();function i(k,I){return k===I&&(k!==0||1/k===1/I)||k!==k&&I!==I}var o=typeof Object.is=="function"?Object.is:i,p=n.useState,d=n.useEffect,c=n.useLayoutEffect,l=n.useDebugValue;function f(k,I){var x=I(),S=p({inst:{value:x,getSnapshot:I}}),g=S[0].inst,b=S[1];return c(function(){g.value=x,g.getSnapshot=I,v(g)&&b({inst:g})},[k,x,I]),d(function(){return v(g)&&b({inst:g}),k(function(){v(g)&&b({inst:g})})},[k]),l(x),x}function v(k){var I=k.getSnapshot;k=k.value;try{var x=I();return!o(k,x)}catch{return!0}}function h(k,I){return I()}var C=typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"?h:f;return Ac.useSyncExternalStore=n.useSyncExternalStore!==void 0?n.useSyncExternalStore:C,Ac}var kf;function Rg(){return kf||(kf=1,Tc.exports=Og()),Tc.exports}/**
 * @license React
 * use-sync-external-store-shim/with-selector.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Sf;function Mg(){if(Sf)return Dc;Sf=1;var n=io(),i=Rg();function o(h,C){return h===C&&(h!==0||1/h===1/C)||h!==h&&C!==C}var p=typeof Object.is=="function"?Object.is:o,d=i.useSyncExternalStore,c=n.useRef,l=n.useEffect,f=n.useMemo,v=n.useDebugValue;return Dc.useSyncExternalStoreWithSelector=function(h,C,k,I,x){var S=c(null);if(S.current===null){var g={hasValue:!1,value:null};S.current=g}else g=S.current;S=f(function(){function j(P){if(!O){if(O=!0,R=P,P=I(P),x!==void 0&&g.hasValue){var H=g.value;if(x(H,P))return A=H}return A=P}if(H=A,p(R,P))return H;var K=I(P);return x!==void 0&&x(H,K)?H:(R=P,A=K)}var O=!1,R,A,T=k===void 0?null:k;return[function(){return j(C())},T===null?void 0:function(){return j(T())}]},[C,k,I,x]);var b=d(h,S[0],S[1]);return l(function(){g.hasValue=!0,g.value=b},[b]),v(b),b},Dc}var jf;function Lg(){return jf||(jf=1,Ic.exports=Mg()),Ic.exports}var Fg=Lg();const Pg=oo(Fg),rm={},{useDebugValue:Ug}=so,{useSyncExternalStoreWithSelector:zg}=Pg;let Ef=!1;const Bg=n=>n;function Hg(n,i=Bg,o){(rm?"production":void 0)!=="production"&&o&&!Ef&&(console.warn("[DEPRECATED] Use `createWithEqualityFn` instead of `create` or use `useStoreWithEqualityFn` instead of `useStore`. They can be imported from 'zustand/traditional'. https://github.com/pmndrs/zustand/discussions/1937"),Ef=!0);const p=zg(n.subscribe,n.getState,n.getServerState||n.getInitialState,i,o);return Ug(p),p}const Nf=n=>{(rm?"production":void 0)!=="production"&&typeof n!="function"&&console.warn("[DEPRECATED] Passing a vanilla store will be unsupported in a future version. Instead use `import { useStore } from 'zustand'`.");const i=typeof n=="function"?Ag(n):n,o=(p,d)=>Hg(i,p,d);return Object.assign(o,i),o},qg=n=>n?Nf(n):Nf;function $g(n,i){var p,d;const o={...n,lastModified:Date.now()};switch(i.type){case"SET_LOADING":return{...n,isLoading:i.payload};case"SET_SERIES_PROGRESS":return{...n,seriesProgress:i.payload};case"LOAD_DATA":return{...n,...i.payload,isLoading:!1,lastModified:null};case"SET_AI_GENERATION_STATUS":return{...n,aiGenerationStatus:{...n.aiGenerationStatus,...i.payload}};case"ADD_AI_TASK_TO_QUEUE":return{...n,aiGenerationStatus:{...n.aiGenerationStatus,queue:[...n.aiGenerationStatus.queue,i.payload]}};case"START_NEXT_AI_TASK":{const c=n.aiGenerationStatus.queue.slice(1),{task:l,abortController:f}=i.payload;return{...n,aiGenerationStatus:{...n.aiGenerationStatus,queue:c,currentTask:{...l,abortController:f}}}}case"UPDATE_CURRENT_AI_TASK_STATUS":{if(!n.aiGenerationStatus.currentTask)return n;const{statusText:c,deckId:l,seriesId:f}=i.payload,v={...n.aiGenerationStatus.currentTask,statusText:c,deckId:l,seriesId:f};return{...n,aiGenerationStatus:{...n.aiGenerationStatus,currentTask:v}}}case"FINISH_CURRENT_AI_TASK":return{...n,aiGenerationStatus:{...n.aiGenerationStatus,currentTask:null}};case"CANCEL_AI_TASK":return(p=i.payload)!=null&&p.taskId?{...n,aiGenerationStatus:{...n.aiGenerationStatus,queue:n.aiGenerationStatus.queue.filter(c=>c.id!==i.payload.taskId)}}:((d=n.aiGenerationStatus.currentTask)==null||d.abortController.abort(),{...n,aiGenerationStatus:{...n.aiGenerationStatus,currentTask:null}});case"SET_AI_CHAT_HISTORY":return{...n,aiChatHistory:i.payload};case"ADD_DECKS":{const c=new Map(n.decks.map(l=>[l.id,l]));return i.payload.forEach(l=>c.set(l.id,l)),{...o,decks:Array.from(c.values())}}case"RESTORE_DATA":{const{decks:c,folders:l,deckSeries:f}=i.payload,v=new Map(n.decks.map(k=>[k.id,k]));c.forEach(k=>v.set(k.id,k));const h=new Map(n.folders.map(k=>[k.id,k]));l.forEach(k=>h.set(k.id,k));const C=new Map(n.deckSeries.map(k=>[k.id,k]));return f.forEach(k=>C.set(k.id,k)),{...o,decks:Array.from(v.values()),folders:Array.from(h.values()),deckSeries:Array.from(C.values())}}case"DELETE_DECK":return{...o,decks:n.decks.filter(c=>c.id!==i.payload),deckSeries:n.deckSeries.map(c=>c.levels?{...c,levels:c.levels.map(l=>({...l,deckIds:(l.deckIds||[]).filter(f=>f!==i.payload)}))}:c)};case"UPDATE_DECK":return{...o,decks:n.decks.map(c=>c.id===i.payload.id?i.payload:c)};case"BULK_UPDATE_DECKS":{const c=new Map(n.decks.map(l=>[l.id,l]));return i.payload.forEach(l=>c.set(l.id,l)),{...o,decks:Array.from(c.values())}}case"ADD_FOLDER":return{...o,folders:[...n.folders,i.payload]};case"UPDATE_FOLDER":return{...o,folders:n.folders.map(c=>c.id===i.payload.id?i.payload:c)};case"DELETE_FOLDER":return{...o,folders:n.folders.filter(c=>c.id!==i.payload),decks:n.decks.map(c=>c.folderId===i.payload?{...c,folderId:null}:c)};case"ADD_SERIES":return{...o,deckSeries:[...n.deckSeries,i.payload]};case"ADD_SERIES_WITH_DECKS":{const{series:c,decks:l}=i.payload,f=new Map(n.decks.map(v=>[v.id,v]));return l.forEach(v=>f.set(v.id,v)),{...o,decks:Array.from(f.values()),deckSeries:[...n.deckSeries,c]}}case"UPDATE_SERIES":return{...o,deckSeries:n.deckSeries.map(c=>c.id===i.payload.id?i.payload:c)};case"DELETE_SERIES":return{...o,deckSeries:n.deckSeries.filter(c=>c.id!==i.payload)};default:return n}}const Gg={decks:[],folders:[],deckSeries:[],seriesProgress:new Map,isLoading:!0,lastModified:null,aiGenerationStatus:{isGenerating:!1,statusText:null,generatingDeckId:null,generatingSeriesId:null,queue:[],currentTask:null},aiChatHistory:[]},at=qg(n=>({...Gg,dispatch:i=>n(o=>$g(o,i))})),Wg=n=>{const i=new Date;i.setHours(23,59,59,999);const o=n.type===De.Quiz||n.type===De.Learning?n.questions:n.cards;return Array.isArray(o)?o.filter(p=>!p.suspended&&new Date(p.dueDate)<=i).length:0},nm=()=>at(n=>{const i=new Set;return n.deckSeries.forEach(o=>{(o.levels||[]).forEach(p=>(p.deckIds||[]).forEach(d=>i.add(d)))}),n.decks.filter(o=>!o.archived&&!o.deletedAt&&!i.has(o.id))}),Qg=()=>at(n=>n.deckSeries.filter(i=>!i.archived&&!i.deletedAt)),Yg=()=>at(n=>{const i=new Set;n.deckSeries.forEach(p=>{p.levels.forEach(d=>d.deckIds.forEach(c=>i.add(c)))});const o=new Set;return n.deckSeries.forEach(p=>{var d;if(!p.archived&&!p.deletedAt){const c=((d=n.seriesProgress.get(p.id))==null?void 0:d.size)||0;let l=0;p.levels.forEach(f=>{f.deckIds.forEach(v=>{l<=c&&o.add(v),l++})})}}),n.decks.filter(p=>!(p.archived||p.deletedAt||i.has(p.id)&&!o.has(p.id))).reduce((p,d)=>p+Wg(d),0)}),sm=M.createContext(void 0),Oi=()=>{const n=M.useContext(sm);if(!n)throw new Error("useModal must be used within a ModalProvider");return n},Vg=({children:n})=>{const[i,o]=M.useState({type:null,payload:null}),p=M.useRef(null),d=M.useCallback((l,f={})=>{p.current=document.activeElement,o({type:l,payload:f})},[]),c=M.useCallback(()=>{o({type:null,payload:null}),setTimeout(()=>{var l;return(l=p.current)==null?void 0:l.focus()},100)},[]);return r.jsx(sm.Provider,{value:{modalType:i.type,modalPayload:i.payload,openModal:d,closeModal:c},children:n})},Hr=(n,i,o)=>{const p=new Date;p.setHours(0,0,0,0);const d=i.map(l=>({id:crypto.randomUUID(),text:l.text,explanation:l.explanation})),c=d[i.findIndex(l=>l.correct)];if(!c)throw new Error(`No correct option specified for question: "${n}"`);return{id:crypto.randomUUID(),questionType:"multipleChoice",questionText:n,tags:["nature","sample"],detailedExplanation:o,options:d,correctAnswerId:c.id,dueDate:p.toISOString(),interval:0,easeFactor:ts,suspended:!1,masteryLevel:0,lastReviewed:void 0}},Kg=()=>{const n={id:crypto.randomUUID(),name:"Level 1.1: Simple Addition",description:"Practice basic addition problems.",type:De.Quiz,questions:[Hr("What is 1 + 1?",[{text:"2",correct:!0},{text:"1"},{text:"3"}],"1 plus 1 equals 2."),Hr("What is 2 + 3?",[{text:"5",correct:!0},{text:"4"},{text:"6"}],"2 plus 3 equals 5."),Hr("What is 5 + 4?",[{text:"9",correct:!0},{text:"8"},{text:"10"}],"5 plus 4 equals 9.")]},i={id:crypto.randomUUID(),name:"Level 1.2: Simple Subtraction",description:"Practice basic subtraction problems.",type:De.Quiz,questions:[Hr("What is 5 - 2?",[{text:"3",correct:!0},{text:"2"},{text:"4"}],"5 minus 2 equals 3."),Hr("What is 10 - 4?",[{text:"6",correct:!0},{text:"5"},{text:"7"}],"10 minus 4 equals 6.")]},o={id:crypto.randomUUID(),name:"Level 2.1: Simple Multiplication",description:"Practice basic multiplication problems.",type:De.Quiz,questions:[Hr("What is 2 * 3?",[{text:"6",correct:!0},{text:"5"},{text:"8"}],"2 times 3 is 6."),Hr("What is 4 * 5?",[{text:"20",correct:!0},{text:"15"},{text:"25"}],"4 times 5 is 20.")]},p=[n,i,o];return{series:{id:crypto.randomUUID(),type:"series",name:"Sample: Basic Math Series",description:"A sample series to demonstrate the progressive learning path feature. Complete each deck to unlock the next!",levels:[{title:"Level 1: Fundamentals",deckIds:[n.id,i.id]},{title:"Level 2: Next Steps",deckIds:[o.id]}],createdAt:new Date().toISOString()},decks:p}},Jg=()=>{const n=[Hr("Which process allows plants to convert light energy into chemical energy?",[{text:"Respiration"},{text:"Photosynthesis",correct:!0},{text:"Transpiration"},{text:"Germination"}],"Photosynthesis is the vital process used by plants, algae, and certain bacteria to harness energy from sunlight and turn it into chemical energy in the form of glucose."),Hr("What is the largest rainforest in the world?",[{text:"The Congo Rainforest"},{text:"The Valdivian Temperate Rainforest"},{text:"The Daintree Rainforest"},{text:"The Amazon Rainforest",correct:!0}],"The Amazon Rainforest is the world's largest tropical rainforest, famed for its biodiversity. It spans across nine countries in South America."),Hr("What type of rock is formed from the cooling and solidification of magma or lava?",[{text:"Igneous Rock",correct:!0},{text:"Sedimentary Rock"},{text:"Metamorphic Rock"},{text:"Sandstone"}],"Igneous rock is formed through the cooling and solidification of magma (molten rock below the surface) or lava (molten rock on the surface). Examples include granite and basalt."),Hr("Which layer of the Earth's atmosphere is closest to the surface?",[{text:"Stratosphere"},{text:"Mesosphere"},{text:"Troposphere",correct:!0},{text:"Thermosphere"}],"The Troposphere is the lowest layer of Earth's atmosphere, and is also where nearly all weather conditions take place. It contains about 75% of the atmosphere's mass."),Hr("What is the name for the process of water movement through a plant and its evaporation from aerial parts, such as leaves, stems and flowers?",[{text:"Condensation"},{text:"Precipitation"},{text:"Transpiration",correct:!0},{text:"Photosynthesis"}],"Transpiration is essentially evaporation of water from plant leaves. It is a key part of the water cycle, and an important process in plant life.")];return{id:crypto.randomUUID(),name:"Sample: Wonders of Nature",description:"A sample quiz deck to introduce you to CogniFlow. Test your knowledge about the natural world!",type:De.Quiz,questions:n,lastOpened:new Date().toISOString()}},Zg=({dispatch:n,addToast:i,triggerSync:o,openConfirmModal:p})=>{const d=M.useCallback(async(S,g)=>{n({type:"UPDATE_DECK",payload:S}),g!=null&&g.silent||(g!=null&&g.toastMessage?i(g.toastMessage,"success"):S.archived?i(`Deck "${S.name}" archived.`,"success"):S.archived===!1?i(`Deck "${S.name}" unarchived.`,"success"):i(`Deck "${S.name}" updated.`,"success"));try{await Ih(S),o()}catch(b){console.error("Failed to update deck:",b),i("There was an error syncing the deck update.","error")}},[n,i,o]),c=M.useCallback(async S=>{const g=at.getState().decks.find(b=>b.id===S);if(g){const b={...g,lastOpened:new Date().toISOString()};await d(b,{silent:!0})}},[d]),l=M.useCallback(async S=>{try{n({type:"ADD_DECKS",payload:S}),await Di(S),o()}catch(g){console.error("Failed to add decks:",g),i("There was an error saving the new deck(s).","error")}},[n,i,o]),f=M.useCallback(()=>{const S=Jg();l([S]),i(`Sample deck "${S.name}" created!`,"success")},[l,i]),v=M.useCallback(async S=>{const g=at.getState().decks.find(j=>j.id===S);if(!g)return;const b={...g,deletedAt:new Date().toISOString(),archived:!1};await d(b,{toastMessage:`Moved "${g.name}" to Trash.`})},[d]),h=M.useCallback(async(S,g)=>{const{decks:b,folders:j}=at.getState(),O=b.find(P=>P.id===S),R=j.find(P=>P.id===g);if(!O||O.folderId===g)return;const A={...O,folderId:g},T=R?`"${R.name}"`:"the ungrouped area";await d(A,{toastMessage:`Moved "${O.name}" to ${T}.`})},[d]),C=M.useCallback(async S=>{try{if(S.id){const g={id:S.id,name:S.name};n({type:"UPDATE_FOLDER",payload:g}),i(`Folder "${g.name}" updated.`,"success"),await Ah(g)}else{const g={id:crypto.randomUUID(),name:S.name};n({type:"ADD_FOLDER",payload:g}),i(`Folder "${g.name}" created.`,"success"),await Th(g)}o()}catch(g){console.error("Failed to save folder:",g),i("There was an error saving the folder.","error")}},[n,i,o]),k=M.useCallback(async S=>{const{folders:g,decks:b}=at.getState(),j=g.find(O=>O.id===S);j&&p({title:"Delete Folder",message:`Are you sure you want to delete folder "${j.name}"? Decks inside will not be deleted.`,onConfirm:async()=>{try{n({type:"DELETE_FOLDER",payload:S}),i(`Folder "${j.name}" deleted.`,"success");const O=b.filter(R=>R.folderId===S).map(R=>({...R,folderId:null}));O.length>0&&await Gc(O),await Oh(S),o()}catch(O){console.error("Failed to delete folder:",O),i("There was an error deleting the folder.","error")}}})},[n,i,o,p]),I=M.useCallback(async S=>{const g=at.getState().decks.find(O=>O.id===S);if(!g)return;const{deletedAt:b,...j}=g;await d(j,{toastMessage:`Restored deck "${j.name}".`})},[d]),x=M.useCallback(async S=>{var g;try{const b=(g=at.getState().decks.find(j=>j.id===S))==null?void 0:g.name;n({type:"DELETE_DECK",payload:S}),i(`Deck "${b||"Deck"}" permanently deleted.`,"success"),await Wc(S),o()}catch(b){console.error("Failed to permanently delete deck:",b),i("There was an error permanently deleting the deck.","error")}},[n,i,o]);return{handleUpdateDeck:d,updateLastOpened:c,handleAddDecks:l,handleCreateSampleDeck:f,handleDeleteDeck:v,handleMoveDeck:h,handleSaveFolder:C,handleDeleteFolder:k,handleRestoreDeck:I,handleDeleteDeckPermanently:x}},Xg=({dispatch:n,addToast:i,navigate:o,triggerSync:p,handleAddDecks:d,handleUpdateDeck:c})=>{const l=M.useCallback(async(b,j)=>{n({type:"UPDATE_SERIES",payload:b}),j!=null&&j.silent||(j!=null&&j.toastMessage?i(j.toastMessage,"success"):b.archived?i(`Series "${b.name}" archived.`,"success"):b.archived===!1?i(`Series "${b.name}" unarchived.`,"success"):i(`Series "${b.name}" updated.`,"success"));try{await Pc(b),p()}catch(O){console.error("Failed to update series:",O),i("There was an error updating the series.","error")}},[n,i,p]),f=M.useCallback(async b=>{const j=at.getState().deckSeries.find(O=>O.id===b);if(j){const O={...j,lastOpened:new Date().toISOString()};await l(O,{silent:!0})}},[l]),v=M.useCallback(async(b,j)=>{try{n({type:"ADD_SERIES_WITH_DECKS",payload:{series:b,decks:j}}),await Promise.all([Di(j),Fc([b])]),p(),i(`Successfully imported series "${b.name}" with ${j.length} decks.`,"success")}catch(O){console.error("Failed to create series with decks:",O),i("There was an error creating the new series.","error")}},[n,i,p]),h=M.useCallback(()=>{const{series:b,decks:j}=Kg();v(b,j),i(`Sample series "${b.name}" created!`,"success"),o(`/series/${b.id}`)},[v,i,o]),C=M.useCallback(async b=>{try{if(b.id){const j=at.getState().deckSeries.find(O=>O.id===b.id);if(j){const O={...j,name:b.name,description:b.description};await l(O)}}else if(b.scaffold&&Array.isArray(b.scaffold.levels)){const{levels:j}=b.scaffold,O=[],R=j.map(T=>{const P=(T.decks||[]).map(H=>({id:crypto.randomUUID(),name:H.name,description:H.description,type:De.Quiz,questions:ba(Array.isArray(H.questions)?H.questions:[])}));return O.push(...P),{title:T.title,deckIds:P.map(H=>H.id)}}),A={id:crypto.randomUUID(),type:"series",name:b.name,description:b.description,levels:R,archived:!1,createdAt:new Date().toISOString()};await v(A,O),i(`Series "${A.name}" created from scaffold.`,"success"),o(`/series/${A.id}?edit=true`)}else{const j={id:crypto.randomUUID(),type:"series",name:b.name,description:b.description,levels:[],createdAt:new Date().toISOString()};n({type:"ADD_SERIES",payload:j}),i(`Series "${j.name}" created.`,"success"),await Fc([j]),p(),o(`/series/${j.id}?edit=true`)}}catch(j){console.error("Failed to save series:",j),i("There was an error saving the series.","error")}},[i,l,n,o,v,p]),k=M.useCallback(async b=>{const{deckSeries:j,decks:O}=at.getState(),R=j.find(H=>H.id===b);if(!R)return;const A=R.levels.flatMap(H=>H.deckIds),T=O.filter(H=>A.includes(H.id)).map(H=>({...H,deletedAt:new Date().toISOString(),archived:!1})),P={...R,deletedAt:new Date().toISOString(),archived:!1};n({type:"BULK_UPDATE_DECKS",payload:T}),n({type:"UPDATE_SERIES",payload:P}),i(`Series "${R.name}" and its ${T.length} deck(s) moved to Trash.`,"success");try{await Promise.all([Gc(T),Pc(P)]),p()}catch(H){console.error("Failed to move series and its decks to trash:",H),i("Error moving series to trash.","error")}},[n,i,p]),I=M.useCallback(async(b,j)=>{const O=at.getState().deckSeries.find(T=>T.id===b);if(!O)return;await d([j]);const R={title:j.name,deckIds:[j.id]},A={...O,levels:[...O.levels,R]};await l(A)},[d,l]),x=M.useCallback(async b=>{const j=at.getState().deckSeries.find(A=>A.id===b);if(!j)return;const{deletedAt:O,...R}=j;await l(R,{toastMessage:`Restored series "${R.name}".`})},[l]),S=M.useCallback(async b=>{const j=at.getState().deckSeries.find(A=>A.id===b);if(!j)return;const O=j.levels.flatMap(A=>A.deckIds),R=j.name;try{O.forEach(A=>{n({type:"DELETE_DECK",payload:A})}),n({type:"DELETE_SERIES",payload:b}),i(`Series "${R}" and its ${O.length} deck(s) permanently deleted.`,"success"),await Promise.all([...O.map(A=>Wc(A)),Mh(b)]),p()}catch(A){console.error("Failed to permanently delete series and its decks:",A),i("There was an error permanently deleting the series.","error")}},[n,i,p]),g=M.useCallback(()=>{const{deckSeries:b,decks:j,seriesProgress:O}=at.getState();if(!b.length||!j.length)return;let R=!1;const A=new Map(O);for(const T of b){if(T.archived||T.deletedAt)continue;const P=A.get(T.id),H=new Set(P instanceof Set?P:[]);let K=!1;const W=T.levels.flatMap(B=>B.deckIds||[]).filter(B=>typeof B=="string");for(const B of W){if(H.has(B))continue;const Y=j.find(N=>N.id===B);if(!Y)continue;let q;if(Y.type===De.Flashcard?q=Y.cards:(Y.type===De.Quiz||Y.type===De.Learning)&&(q=Y.questions),!q)continue;!q.some(N=>!N.suspended&&N.interval===0)&&q.length>0&&(H.add(B),K=!0)}K&&(A.set(T.id,H),R=!0)}if(R){const T=Array.from(A.entries()).map(([P,H])=>Vc(P,H));Promise.all(T).catch(P=>console.error("Could not save reconciled series progress to DB",P)),i("Unlocked decks based on your progress.","info"),n({type:"SET_SERIES_PROGRESS",payload:A})}},[i,n]);return{handleUpdateSeries:l,updateLastOpenedSeries:f,handleAddSeriesWithDecks:v,handleCreateSampleSeries:h,handleSaveSeries:C,handleDeleteSeries:k,handleAddDeckToSeries:I,handleRestoreSeries:x,handleDeleteSeriesPermanently:S,reconcileSeriesProgress:g}};function ex(n,i){const o=new Date(n);return o.setDate(o.getDate()+i),o}const tx=(n,i)=>{const o=new Date;o.setHours(0,0,0,0);let p=n.lapses||0;i===lt.Again?p++:p>0&&(p=0);let d=Xp[i];i===lt.Again&&p>2&&(d-=(p-2)*.05);let c=n.easeFactor+d;c<Uc&&(c=Uc);let l;if(i===lt.Again)l=Kp;else if(n.interval===0)switch(i){case lt.Hard:l=1;break;case lt.Good:l=3;break;case lt.Easy:l=5;break;default:l=1}else{let h=1;i===lt.Hard&&(h=Jp),i===lt.Easy&&(h=Zp),l=Math.ceil(n.interval*c*h)}const f=ex(o,l),v=Math.min(1,Math.log1p(l)/Math.log1p(90));return{...n,interval:l,easeFactor:c,dueDate:f.toISOString(),lastReviewed:o.toISOString(),masteryLevel:v,lapses:p}},_f=n=>{const i=new Date;return i.setHours(0,0,0,0),{...n,dueDate:i.toISOString(),interval:0,easeFactor:ts,suspended:!1,masteryLevel:0,lastReviewed:void 0,lapses:0}},nn=n=>{const i=n.masteryLevel||0;if(i===0||!n.lastReviewed||n.suspended)return 0;const o=(n.interval||1)*2,p=new Date(n.lastReviewed),c=Math.max(0,(new Date().getTime()-p.getTime())/(1e3*60*60*24));if(c<=0)return i;const l=Math.pow(.5,c/o);return i*l},rx=({sessionsToResume:n,setSessionsToResume:i,setGeneralStudyDeck:o,navigate:p,dispatch:d,addToast:c,handleUpdateDeck:l})=>{const f=M.useCallback(async(x,S)=>{const g=`session_deck_${x}`;if(n.has(x)){const b=new Set(n);b.delete(x),i(b)}try{await ao(g)}catch(b){console.error(`Failed to clean up session state for ${g} from DB`,b)}x==="general-study-deck"&&o(null),p(S?`/series/${S}`:"/")},[p,n,i,o]),v=M.useCallback(async(x,S,g)=>{const b=`session_deck_${x}`;if(n.has(x)){const j=new Set(n);j.delete(x),i(j)}try{await ao(b)}catch(j){console.error(`Failed to clean up session state for ${b} from DB`,j)}x==="general-study-deck"&&o(null),p(`/decks/${g}/study?seriesId=${S}`)},[p,n,i,o]),h=M.useCallback(async(x,S,g,b)=>{const{decks:j,deckSeries:O,seriesProgress:R}=at.getState(),A=j.find(Z=>Z.id===x);if(!A)return;let T;const{id:P,dueDate:H,interval:K,easeFactor:W,suspended:B,masteryLevel:Y,lastReviewed:q,lapses:Q}=S,N={dueDate:H,interval:K,easeFactor:W,suspended:B,masteryLevel:Y,lastReviewed:q,lapses:Q};A.type===De.Flashcard?T={...A,cards:A.cards.map(Z=>Z.id===P?{...Z,...N}:Z)}:A.type===De.Learning?T={...A,questions:A.questions.map(Z=>Z.id===P?{...Z,...N}:Z)}:T={...A,questions:A.questions.map(Z=>Z.id===P?{...Z,...N}:Z)},await l(T,{silent:!0});try{const Z={itemId:S.id,deckId:x,seriesId:b,timestamp:new Date().toISOString(),rating:g,newInterval:S.interval,easeFactor:S.easeFactor,masteryLevel:S.masteryLevel||0};await Uh(Z)}catch(Z){console.error("Failed to log review:",Z)}if(b){const Z=T,oe="cards"in Z?Z.cards:Z.questions,fe=Array.isArray(oe)&&oe.some(ue=>!ue.suspended&&ue.interval===0),ye=(R.get(b)||new Set).has(x);if(!fe&&!ye&&(oe==null?void 0:oe.length)>0){const ue=new Map(R),z=ue.get(b),_=new Set(z instanceof Set?z:[]);_.add(x),ue.set(b,_);try{await Vc(b,_);const F=O.find(ie=>ie.id===b),de=(F==null?void 0:F.levels.flatMap(ie=>ie.deckIds))||[];de.indexOf(x)===de.length-1&&de.length>0?c(`Congratulations! You've completed the series: "${F==null?void 0:F.name}"!`,"success"):c(`Deck "${Z.name}" completed! Next chapter unlocked.`,"success"),d({type:"SET_SERIES_PROGRESS",payload:ue})}catch(F){console.error("Could not save series progress",F)}}}},[l,c,d]),C=M.useCallback(async x=>{const S=at.getState().decks.find(b=>b.id===x);if(!S)return;let g;S.type===De.Flashcard?g={...S,cards:S.cards.map(b=>_f(b))}:g={...S,questions:S.questions.map(b=>_f(b))},await l(g,{toastMessage:`Progress for deck "${g.name}" has been reset.`})},[l]),k=M.useCallback(()=>{const{decks:x,deckSeries:S,seriesProgress:g}=at.getState(),b=new Set;S.forEach(T=>T.levels.forEach(P=>P.deckIds.forEach(H=>b.add(H))));const j=new Set;S.forEach(T=>{var P;if(!T.archived&&!T.deletedAt){const H=((P=g.get(T.id))==null?void 0:P.size)||0;let K=0;T.levels.forEach(W=>{W.deckIds.forEach(B=>{K<=H&&j.add(B),K++})})}});const O=new Date;O.setHours(23,59,59,999);const R=x.filter(T=>!(T.type!==De.Quiz||T.archived||T.deletedAt||b.has(T.id)&&!j.has(T.id))).flatMap(T=>T.questions.filter(P=>!P.suspended&&new Date(P.dueDate)<=O).map(P=>({...P,originalDeckId:T.id,originalDeckName:T.name}))).sort(()=>Math.random()-.5),A={id:"general-study-deck",name:"General Study Session",type:De.Quiz,questions:R};o(A),p("/study/general")},[p,o]),I=M.useCallback(async x=>{var W;const{decks:S,deckSeries:g,seriesProgress:b}=at.getState(),j=g.find(B=>B.id===x);if(!j)return;const O=new Set,R=((W=b.get(j.id))==null?void 0:W.size)||0;let A=0;j.levels.forEach(B=>{B.deckIds.forEach(Y=>{A<=R&&O.add(Y),A++})});const T=new Date;T.setHours(23,59,59,999);const H=j.levels.flatMap(B=>B.deckIds).map(B=>S.find(Y=>Y.id===B)).filter(B=>!!(B&&B.type===De.Quiz)).filter(B=>O.has(B.id)).flatMap(B=>B.questions.filter(Y=>!Y.suspended&&new Date(Y.dueDate)<=T).map(Y=>({...Y,originalDeckId:B.id,originalDeckName:B.name}))).sort(()=>Math.random()-.5),K={id:"general-study-deck",name:`${j.name} - Study Session`,type:De.Quiz,questions:H};o(K),p(`/study/general?seriesId=${x}`)},[p,o]);return{handleSessionEnd:f,handleStudyNextDeckInSeries:v,handleItemReviewed:h,handleResetDeckProgress:C,handleStartGeneralStudy:k,handleStartSeriesStudy:I}},nx=({dispatch:n,addToast:i,handleAddSeriesWithDecks:o,handleAddDecks:p,handleUpdateDeck:d,handleUpdateSeries:c,handleMoveDeck:l,handleDeleteDeck:f,handleSaveFolder:v,handleDeleteFolder:h})=>{const C=M.useCallback(async A=>{const{generationType:T,generateQuestions:P,isLearningMode:H,...K}=A,W={id:crypto.randomUUID(),payload:A,statusText:`Initializing AI generation for '${A.topic}'...`};T==="series"?W.type=H?"generateSeriesLearningContentInBatches":P?"generateSeriesQuestionsInBatches":"generateSeriesScaffoldWithAI":W.type=H?"generateLearningDeckWithAI":"generateDeckWithAI",n({type:"ADD_AI_TASK_TO_QUEUE",payload:W}),i("AI task has been added to the queue.","info")},[n,i]),k=M.useCallback(async A=>{const T={id:crypto.randomUUID(),type:"generateQuestionsForDeck",payload:{deckId:A.id,count:A.suggestedQuestionCount||15},statusText:`Queueing question generation for "${A.name}"...`,deckId:A.id};n({type:"ADD_AI_TASK_TO_QUEUE",payload:T}),i(`Task to generate questions for "${A.name}" has been queued.`,"info")},[n,i]),I=M.useCallback(async A=>{const T={id:crypto.randomUUID(),type:"generateLearningDeckWithAI",payload:{deckId:A.id},statusText:`Queueing content generation for "${A.name}"...`,deckId:A.id};n({type:"ADD_AI_TASK_TO_QUEUE",payload:T}),i(`Task to generate content for "${A.name}" has been queued.`,"info")},[i,n]),x=M.useCallback(async A=>{const T={id:crypto.randomUUID(),type:"generateMoreLevelsForSeries",payload:{seriesId:A},statusText:"Queueing task to expand series...",seriesId:A};n({type:"ADD_AI_TASK_TO_QUEUE",payload:T}),i("Task to expand series has been queued.","info")},[n,i]),S=M.useCallback(async(A,T)=>{const P={id:crypto.randomUUID(),type:"generateMoreDecksForLevel",payload:{seriesId:A,levelIndex:T},statusText:`Queueing task to add decks to level ${T+1}...`,seriesId:A};n({type:"ADD_AI_TASK_TO_QUEUE",payload:P}),i("Task to add more decks has been queued.","info")},[n,i]),g=M.useCallback(async A=>{const{decks:T,folders:P,deckSeries:H}=at.getState(),{payload:K}=A;switch(A.action){case Or.CREATE_DECK:K.name&&p([{id:crypto.randomUUID(),name:K.name,type:De.Quiz,questions:[],description:"Generated by AI Assistant"}]);break;case Or.RENAME_DECK:if(K.deckId&&K.newName){const W=T.find(B=>B.id===K.deckId);W&&d({...W,name:K.newName})}break;case Or.MOVE_DECK_TO_FOLDER:K.deckId&&l(K.deckId,K.folderId);break;case Or.DELETE_DECK:K.deckId&&f(K.deckId);break;case Or.CREATE_FOLDER:K.name&&v({id:null,name:K.name});break;case Or.RENAME_FOLDER:K.folderId&&K.newName&&v({id:K.folderId,name:K.newName});break;case Or.DELETE_FOLDER:K.folderId&&h(K.folderId);break;case Or.EXPAND_SERIES_ADD_LEVELS:K.seriesId&&x(K.seriesId);break;case Or.EXPAND_SERIES_ADD_DECKS:K.seriesId&&typeof K.levelIndex=="number"&&S(K.seriesId,K.levelIndex);break;case Or.GENERATE_QUESTIONS_FOR_DECK:if(K.deckId){const W=T.find(B=>B.id===K.deckId);W&&(W.type===De.Quiz||W.type===De.Learning)&&k(W)}break;case Or.NO_ACTION:break;default:i(`Action "${A.action}" is not implemented.`,"error")}},[i,p,f,h,l,v,d,S,x,k]),b=M.useCallback(async A=>{const{decks:T,deckSeries:P,aiGenerationStatus:H}=at.getState(),K=P.find(Y=>Y.id===A);if(!K){i("Series not found.","error");return}const W=K.levels.flatMap(Y=>Y.deckIds).map(Y=>T.find(q=>q.id===Y)).filter(Y=>!!Y&&(Y.type===De.Quiz||Y.type===De.Learning)&&Y.questions.length===0);if(W.length===0){i("No empty decks to generate questions for.","info");return}if(H.currentTask||H.queue.length>0){i("An AI task is already running. Please wait.","info");return}const B=W.map(Y=>({id:crypto.randomUUID(),type:Y.type===De.Learning?"generateLearningDeckWithAI":"generateQuestionsForDeck",payload:{deckId:Y.id,count:Y.suggestedQuestionCount||15},statusText:`Queueing task for "${Y.name}"...`,deckId:Y.id,seriesId:A}));B.forEach(Y=>n({type:"ADD_AI_TASK_TO_QUEUE",payload:Y})),i(`Queued ${B.length} AI generation tasks for "${K.name}".`,"info")},[i,n]),j=M.useCallback(A=>{n({type:"CANCEL_AI_TASK",payload:{taskId:A}}),i("AI generation task cancelled.","info")},[n,i]),O=M.useCallback(async(A,T)=>{const P=at.getState().decks.find(q=>q.id===A);if(!P||P.type!==De.Learning)return;const{infoCard:H,questions:K}=T,W=P.infoCards.some(q=>q.id===H.id);let B,Y;W?(B=P.infoCards.map(Q=>Q.id===H.id?H:Q),Y=[...P.questions.filter(Q=>!H.unlocksQuestionIds.includes(Q.id)),...K]):(B=[...P.infoCards,H],Y=[...P.questions,...K]),await d({...P,infoCards:B,questions:Y}),i(`Learning block ${W?"updated":"added"}.`,"success")},[d,i]),R=M.useCallback(async(A,T)=>{const P=at.getState().decks.find(Y=>Y.id===A);if(!P||P.type!==De.Learning)return;const H=P.infoCards.find(Y=>Y.id===T);if(!H)return;const K=new Set(H.unlocksQuestionIds),W=P.infoCards.filter(Y=>Y.id!==T),B=P.questions.filter(Y=>!K.has(Y.id));await d({...P,infoCards:W,questions:B}),i("Learning block deleted.","success")},[d,i]);return{handleGenerateWithAI:C,handleGenerateQuestionsForDeck:k,handleGenerateContentForLearningDeck:I,handleAiAddLevelsToSeries:x,handleAiAddDecksToLevel:S,handleExecuteAIAction:g,handleGenerateQuestionsForEmptyDecksInSeries:b,handleCancelAIGeneration:j,handleSaveLearningBlock:O,handleDeleteLearningBlock:R}},sx=({addToast:n,openConfirmModal:i,onRestoreData:o,triggerSync:p,isSyncing:d,setIsSyncing:c,setLastSyncStatus:l})=>{const f=M.useCallback(async(x=!1)=>{if(console.log(`[Restore] Starting fetch from server. Force: ${x}`),d){n("A sync operation is already in progress.","info");return}if(c(!0),l("Fetching from server..."),x)try{const S=await Ti();localStorage.setItem("cogniflow-pre-fetch-backup",JSON.stringify({version:6,...S})),n("Created a temporary local backup before fetching.","info")}catch{n("Could not create pre-fetch backup. Aborting.","error"),c(!1);return}try{const S=await Hc(),g=await ag().catch(b=>{if(b.status===404)return[];throw b});await o({...S,aiChatHistory:g}),console.log("[Restore] Fetch and restore successful.")}catch(S){const g=S instanceof Error?S.message:"Unknown error";console.error("[Restore] Fetch from server failed:",S),S.status===404||g.includes("404")?(l("No sync file found on the server."),n("No sync file found on the server.","info")):(l(`Error: ${g}`),n(`Failed to fetch server data: ${g}`,"error")),c(!1)}},[n,o,c,l,d]),v=M.useCallback(()=>{i({title:"Force Fetch from Server",message:"This will overwrite your local data with the data from the server. A local backup will be made that you can revert to from the settings page. Are you sure?",confirmText:"Fetch",onConfirm:()=>f(!0)})},[i,f]),h=M.useCallback(()=>{i({title:"Force Upload to Server",message:"This will overwrite the server data with your current local data. This is useful if you know your local data is more up-to-date. Are you sure?",confirmText:"Upload",onConfirm:()=>p({isManual:!0,force:!0})})},[i,p]),C=M.useCallback(()=>{i({title:"Create Manual Backup",message:"Are you sure you want to create a new manual backup on the server? This does not affect your live sync file.",onConfirm:async()=>{try{const x=await Vh();n(`Successfully created backup: ${x.filename}`,"success")}catch(x){const S=x instanceof Error?x.message:"Failed to create backup.";n(S,"error")}}})},[n,i]),k=M.useCallback(x=>{i({title:"Restore Live Sync from Backup",message:`This will overwrite your current live sync file on the server with the contents of "${x}". Your local data will not be changed until you fetch from the server. Are you sure?`,onConfirm:async()=>{try{await ig(x),n(`Successfully restored live sync from "${x}". You may want to 'Force Fetch' now.`,"success")}catch(S){const g=S instanceof Error?S.message:"Failed to restore from backup.";n(g,"error")}}})},[n,i]),I=M.useCallback(async x=>{try{await lg(x),n(`Deleted backup: ${x}`,"success")}catch(S){const g=S instanceof Error?S.message:"Failed to delete backup.";throw n(g,"error"),S}},[n]);return{fetchAndRestoreFromServer:f,handleForceFetchFromServer:v,handleForceUploadToServer:h,handleCreateServerBackup:C,handleRestoreFromServerBackup:k,handleDeleteServerBackup:I}};let ax=[];const ox=(n,i)=>{ax.forEach(o=>o(n,i))},ix=()=>{{console.error("Google services not ready for sign-in.");return}},lx=()=>{const n=gapi.client.getToken();gapi.client.setToken(null),localStorage.removeItem("gdrive-previously-signed-in"),ox(!1),n!==null&&google.accounts.oauth2.revoke(n.access_token,()=>{console.log("Google token revoked.")})},cx=async()=>{const n=await Ti();if(n.decks.length===0&&n.folders.length===0&&n.deckSeries.length===0)throw new Error("There is no data to back up.");const i={version:6,...n},o=JSON.stringify(i),c={name:`cogniflow-backup-${$c()}.json`,parents:["appDataFolder"]},l="-------314159265358979323846",f=`\r
--${l}\r
`,v=`\r
--${l}--`,h=f+`Content-Type: application/json; charset=UTF-8\r
\r
`+JSON.stringify(c)+f+`Content-Type: application/json; charset=UTF-8\r
\r
`+o+v,C=await gapi.client.request({path:"https://www.googleapis.com/upload/drive/v3/files",method:"POST",params:{uploadType:"multipart",fields:"id, name, modifiedTime"},headers:{"Content-Type":`multipart/related; boundary=${l}`},body:h});if(C.status!==200)throw new Error("Failed to upload backup file.");return C.result},ux=async()=>(await gapi.client.drive.files.list({spaces:"appDataFolder",fields:"files(id, name, modifiedTime)",orderBy:"modifiedTime desc"})).result.files,dx=async n=>{const i=await gapi.client.drive.files.get({fileId:n,alt:"media"});if(i.status!==200)throw new Error("Failed to download backup file.");const o=typeof i.body=="string"?i.body:JSON.stringify(i.result);return Ai(o)},fx=({addToast:n,openConfirmModal:i,openRestoreFromDriveModal:o,setDriveFiles:p,handleRestoreData:d})=>{const c=M.useCallback(()=>{ix()},[]),l=M.useCallback(()=>{lx(),n("Signed out of Google Drive.","info")},[n]),f=M.useCallback(()=>{i({title:"Backup to Google Drive",message:"This will create a new backup file in a private application folder in your Google Drive. Are you sure?",onConfirm:async()=>{try{const C=await cx();n(`Successfully created backup: ${C.name}`,"success")}catch(C){const k=C instanceof Error?C.message:"Failed to create backup.";n(k,"error")}}})},[n,i]),v=M.useCallback(async()=>{try{const C=await ux();p(C),o()}catch(C){const k=C instanceof Error?C.message:"Failed to list files from Google Drive.";n(k,"error")}},[n,p,o]),h=M.useCallback(async C=>{i({title:"Restore from Google Drive",message:"Restoring from a backup will merge and overwrite data. Decks and folders with the same ID will be replaced. This action cannot be undone. Are you sure?",onConfirm:async()=>{try{const k=await dx(C);await d(k)}catch(k){const I=k instanceof Error?k.message:"Failed to restore from backup.";n(I,"error")}}})},[n,i,d]);return{handleGoogleSignIn:c,handleGoogleSignOut:l,handleBackupToDrive:f,handleListDriveFiles:v,handleRestoreFromDrive:h,openRestoreFromDriveModal:v}},hx=n=>{const{sessionsToResume:i,setSessionsToResume:o,setGeneralStudyDeck:p,triggerSync:d,setDriveFiles:c,isSyncing:l,setIsSyncing:f,setLastSyncStatus:v}=n,{dispatch:h}=at(),{addToast:C}=Kt(),{navigate:k}=Cn(),{openModal:I,closeModal:x}=Oi(),S=M.useCallback(Q=>I("confirm",Q),[I]),g=M.useCallback(async Q=>{try{await Gh(Q),C("Data restored successfully. The app will now reload.","success"),setTimeout(()=>window.location.reload(),1500)}catch(N){throw console.error("Failed to restore data:",N),C("There was an error restoring your data.","error"),N}},[C]);M.useCallback(async Q=>{await g(Q),setTimeout(()=>d({force:!0}),2e3)},[g,d]);const b=Zg({dispatch:h,addToast:C,triggerSync:d,openConfirmModal:S}),j=Xg({dispatch:h,addToast:C,navigate:k,triggerSync:d,handleAddDecks:b.handleAddDecks,handleUpdateDeck:b.handleUpdateDeck}),O=rx({sessionsToResume:i,setSessionsToResume:o,setGeneralStudyDeck:p,navigate:k,dispatch:h,addToast:C,handleUpdateDeck:b.handleUpdateDeck}),R=nx({dispatch:h,addToast:C,...b,...j}),A=sx({addToast:C,openConfirmModal:S,onRestoreData:g,triggerSync:d,isSyncing:l,setIsSyncing:f,setLastSyncStatus:v}),T=fx({addToast:C,openConfirmModal:S,openRestoreFromDriveModal:()=>I("restoreFromDrive"),setDriveFiles:c,onRestoreData:g}),P=M.useCallback(async()=>{try{const Q=await $h();C(`Successfully exported data to ${Q}`,"success")}catch(Q){C(Q instanceof Error?Q.message:"Failed to export data.","error")}},[C]),H=M.useCallback(()=>{I("confirm",{title:"Factory Reset",message:"Are you sure you want to perform a factory reset? All of your local data, including decks, progress, and settings, will be permanently deleted. This action cannot be undone.",confirmText:"delete everything",onConfirm:async()=>{try{await Wh(),localStorage.clear(),C("Factory reset complete. The application will now reload.","success"),setTimeout(()=>window.location.reload(),2e3)}catch(Q){C(Q instanceof Error?Q.message:"Failed to perform factory reset.","error")}}})},[C,I]),K=M.useCallback(()=>{"serviceWorker"in navigator&&navigator.serviceWorker.controller&&(navigator.serviceWorker.controller.postMessage({type:"CLEAR_APP_CACHE"}),C("App cache cleared. Please reload for changes to take effect.","success"))},[C]),W=M.useCallback(()=>{"serviceWorker"in navigator&&navigator.serviceWorker.controller&&(navigator.serviceWorker.controller.postMessage({type:"CLEAR_CDN_CACHE"}),C("CDN cache cleared. Please reload for changes to take effect.","success"))},[C]),B=M.useCallback(()=>{I("confirm",{title:"Revert Last Fetch",message:'This will restore your local data to the state it was in before your last "Force Fetch from Server". This is useful if a fetch overwrote important local changes. Are you sure?',onConfirm:async()=>{const Q=localStorage.getItem("cogniflow-pre-fetch-backup");if(Q)try{const N=JSON.parse(Q);await g(N),localStorage.removeItem("cogniflow-pre-fetch-backup")}catch{C("Failed to parse or restore pre-fetch backup.","error")}else C("No pre-fetch backup found.","error")}})},[C,I,g]),Y=M.useCallback(()=>d({isManual:!0}),[d]),q=M.useCallback(async Q=>{await g(Q),setTimeout(()=>d({force:!0}),2e3)},[g,d]);return{...b,...j,...O,...R,...A,...T,handleRestoreData:g,handleMergeResolution:q,handleExportData:P,handleFactoryReset:H,handleClearAppCache:K,handleClearCdnCache:W,handleRevertLastFetch:B,handleSync:Y,openImportModal:()=>I("import"),openRestoreModal:()=>I("restore"),openResetProgressModal:()=>I("resetProgress"),openAIGenerationModal:()=>I("aiGeneration"),openAIStatusModal:()=>I("aiStatus"),openServerBackupModal:()=>I("serverBackup"),openConfirmModal:S,openFolderEditor:Q=>I("folder",{folder:Q}),openSeriesEditor:Q=>I("series",{series:Q})}},ji=120,mx=()=>{const[n,i]=M.useState({startY:0,pullDistance:0,isRefreshing:!1,thresholdMet:!1}),{hapticsEnabled:o}=rn(),p=M.useCallback(l=>{const f=l.target;window.scrollY===0&&!f.closest('input, textarea, button, a[href], select, [role="button"], [role="switch"]')?i(v=>({...v,startY:l.touches[0].clientY,pullDistance:0,isRefreshing:!1,thresholdMet:!1})):i(v=>({...v,startY:0}))},[]),d=M.useCallback(l=>{if(n.startY===0)return;const f=l.touches[0].clientY-n.startY;f>5&&(l.preventDefault(),f>ji&&!n.thresholdMet&&o&&"vibrate"in navigator&&navigator.vibrate(50),i(h=>({...h,pullDistance:f,thresholdMet:f>ji})))},[n.startY,n.thresholdMet,o]),c=M.useCallback(()=>{n.startY!==0&&(n.pullDistance>ji?(i(l=>({...l,isRefreshing:!0})),setTimeout(()=>{window.location.reload()},500)):i({startY:0,pullDistance:0,isRefreshing:!1,thresholdMet:!1}))},[n.startY,n.pullDistance]);return{pullToRefreshState:n,handleTouchStart:p,handleTouchMove:d,handleTouchEnd:c,REFRESH_THRESHOLD:ji}},px=({onOpenMenu:n,onOpenCommandPalette:i,activeDeck:o})=>{const{path:p,navigate:d}=Cn();let c;const[l]=p.split("?"),f=r.jsx("span",{className:"text-xl font-bold text-transparent bg-clip-text bg-gradient-to-r from-blue-400 to-teal-300",children:"CogniFlow"}),v=o==null?void 0:o.id;if(l.startsWith("/decks/")&&l.endsWith("/study")){const h=new URLSearchParams(window.location.hash.split("?")[1]).get("seriesId"),C=v?`/decks/${v}?${h?`seriesId=${h}`:""}`:h?`/series/${h}`:"/decks";c=r.jsxs(se,{variant:"ghost",onClick:()=>d(C),className:"flex items-center space-x-2 -ml-3 min-w-0",children:[r.jsx(J,{name:"chevron-left"}),r.jsx("span",{className:"truncate",children:(o==null?void 0:o.name)||"Back"})]})}else if(l.startsWith("/decks/")){const h=new URLSearchParams(window.location.hash.split("?")[1]).get("seriesId");h?c=r.jsxs(se,{variant:"ghost",onClick:()=>d(`/series/${h}`),className:"flex items-center space-x-2 -ml-3",children:[r.jsx(J,{name:"chevron-left"}),r.jsx("span",{children:"Back to Series"})]}):c=r.jsxs(se,{variant:"ghost",onClick:()=>d("/decks"),className:"flex items-center space-x-2 -ml-3",children:[r.jsx(J,{name:"chevron-left"}),r.jsx("span",{children:"All Decks"})]})}else l.startsWith("/series/")?c=r.jsxs(se,{variant:"ghost",onClick:()=>d("/series"),className:"flex items-center space-x-2 -ml-3",children:[r.jsx(J,{name:"chevron-left"}),r.jsx("span",{children:"All Series"})]}):l==="/study/general"||["/settings","/instructions/json","/archive","/trash","/decks","/series","/progress"].includes(l)?c=r.jsxs(se,{variant:"ghost",onClick:()=>d("/"),className:"flex items-center space-x-2 -ml-3",children:[r.jsx(J,{name:"chevron-left"}),f]}):c=r.jsx(Tt,{href:"/",className:"no-underline",children:r.jsx("h1",{className:"text-2xl font-bold text-transparent bg-clip-text bg-gradient-to-r from-blue-400 to-teal-300",children:"CogniFlow"})});return r.jsx("header",{className:"bg-surface/80 backdrop-blur-sm sticky top-0 z-20 border-b border-border",children:r.jsxs("nav",{className:"container mx-auto px-4 sm:px-6 lg:px-8 flex items-center justify-between h-16",children:[r.jsx("div",{className:"flex items-center flex-1 min-w-0",children:c}),r.jsxs("div",{className:"flex items-center space-x-1",children:[r.jsx(se,{variant:"ghost",onClick:i,className:"p-1 h-auto","aria-label":"Open command palette",children:r.jsx(J,{name:"search"})}),r.jsx(se,{variant:"ghost",onClick:n,className:"p-1 h-auto","aria-label":"Open menu",children:r.jsx(J,{name:"menu"})})]})]})})},Xn=({html:n,className:i,as:o="div"})=>{const p=`html-container-${so.useId()}`;return so.useEffect(()=>{const d=document.getElementById(p);if(!d)return;const c=Array.from(d.getElementsByTagName("script")),l=[];return c.forEach(f=>{const v=document.createElement("script");Array.from(f.attributes).forEach(h=>{v.setAttribute(h.name,h.value)}),v.text=f.text,document.body.appendChild(v),l.push(v)}),()=>{l.forEach(f=>document.body.removeChild(f))}},[n,p]),r.jsx(o,{id:p,className:i,dangerouslySetInnerHTML:{__html:n}})},ns=({level:n})=>{const i=Math.round(n*100);let o="bg-red-500",p="Novice";return i>85?(o="bg-green-500",p="Mastered"):i>65?(o="bg-teal-500",p="Proficient"):i>40?(o="bg-blue-500",p="Familiar"):i>15&&(o="bg-orange-500",p="Learning"),r.jsxs("div",{className:"w-full",children:[r.jsxs("div",{className:"flex justify-between mb-1 text-xs",children:[r.jsxs("span",{className:"font-semibold text-gray-600 dark:text-gray-300",children:["Mastery: ",p]}),r.jsxs("span",{className:"font-semibold text-gray-500 dark:text-gray-400",children:[i,"%"]})]}),r.jsx("div",{className:"w-full bg-gray-200 dark:bg-gray-700 rounded-full h-2",children:r.jsx("div",{className:`${o} h-2 rounded-full transition-all duration-500`,style:{width:`${i}%`},role:"progressbar","aria-valuenow":i,"aria-valuemin":0,"aria-valuemax":100,"aria-label":`Mastery level: ${p}, ${i}%`})})]})},gx=({card:n,isFlipped:i})=>{const o="text-xl text-left text-text break-words prose dark:prose-invert max-w-none prose-img:mx-auto prose-img:max-h-64 prose-audio:mx-auto",p=nn(n);return r.jsxs("div",{className:"w-full bg-surface rounded-lg shadow-lg border border-border",children:[n.css&&r.jsx("div",{dangerouslySetInnerHTML:{__html:n.css}}),r.jsx("div",{className:"p-6 md:p-8 min-h-[12rem] flex items-center justify-center",children:r.jsx(Xn,{html:n.front,className:o})}),i&&r.jsxs("div",{className:"animate-fade-in",style:{animationDuration:"400ms"},children:[r.jsx("hr",{className:"border-border/50"}),r.jsxs("div",{className:"p-6 md:p-8 bg-background/30 dark:bg-black/10",children:[r.jsx(Xn,{html:n.back,className:o}),r.jsx("div",{className:"mt-6 pt-6 border-t border-border/50",children:r.jsx(ns,{level:p})})]})]})]})},xx=({question:n,selectedAnswerId:i,onSelectAnswer:o,deckName:p,onShowInfo:d})=>{const c=i!==null,l=M.useMemo(()=>{const h=[...n.options];for(let C=h.length-1;C>0;C--){const k=Math.floor(Math.random()*(C+1));[h[C],h[k]]=[h[k],h[C]]}return h},[n.id]),f=h=>{let C="flex items-start text-left w-full p-4 rounded-lg border-2 transition-all duration-200";if(!c)return`${C} bg-surface border-border hover:border-primary cursor-pointer`;const k=h.id===n.correctAnswerId,I=h.id===i;return k?`${C} border-green-500 bg-green-500/10 cursor-not-allowed`:I?`${C} border-red-500 bg-red-500/10 cursor-not-allowed`:`${C} border-border bg-background/50 cursor-not-allowed`},v=nn(n);return r.jsxs("div",{className:"bg-surface rounded-lg shadow-lg border border-border",children:[r.jsxs("div",{className:"p-6 md:p-8",children:[r.jsxs("div",{className:"flex justify-between items-start mb-2",children:[p&&r.jsx("p",{className:"text-xs text-text-muted uppercase tracking-wider font-semibold",children:p}),n.tags&&n.tags.length>0&&r.jsx("div",{className:"flex flex-wrap items-center gap-1",children:n.tags.map(h=>r.jsx("span",{className:"bg-border/50 text-text-muted text-xs px-2 py-0.5 rounded-full",children:h},h))})]}),r.jsx(Xn,{html:n.questionText,className:"text-xl font-semibold text-text",as:"h3"})]}),r.jsx("div",{className:"px-6 md:px-8 pb-6 md:pb-8",children:r.jsx("div",{className:"space-y-3",children:l.map(h=>r.jsxs("button",{onClick:()=>o(h.id),disabled:c,className:f(h),"aria-pressed":i===h.id,children:[r.jsxs("div",{className:"flex-1 min-w-0",children:[r.jsx(Xn,{html:h.text,className:"prose dark:prose-invert max-w-none"}),c&&h.explanation&&r.jsx("p",{className:"text-xs mt-1 text-text-muted",children:h.explanation})]}),c&&r.jsx("div",{className:"ml-4 flex-shrink-0",children:h.id===n.correctAnswerId?r.jsx(J,{name:"check-circle",className:"w-6 h-6 text-green-500"}):h.id===i?r.jsx(J,{name:"x-circle",className:"w-6 h-6 text-red-500"}):null})]},h.id))})}),c&&r.jsxs("div",{className:"p-6 bg-background/30 dark:bg-black/10 border-t border-border/50 animate-fade-in",children:[r.jsxs("div",{className:"flex justify-between items-start",children:[r.jsx("div",{children:n.detailedExplanation&&r.jsxs(r.Fragment,{children:[r.jsx("h4",{className:"text-sm font-semibold uppercase tracking-wider text-text-muted mb-2",children:"Explanation"}),r.jsx(Xn,{html:n.detailedExplanation,className:"prose dark:prose-invert max-w-none prose-sm"})]})}),d&&r.jsxs(se,{variant:"ghost",size:"sm",onClick:d,className:"ml-4 flex-shrink-0",children:[r.jsx(J,{name:"info",className:"w-4 h-4 mr-1"}),"View Related Info"]})]}),r.jsx("div",{className:n.detailedExplanation?"mt-6 pt-6 border-t border-border/50":"",children:r.jsx(ns,{level:v})})]})]})},Xc=({current:n,total:i})=>{const o=i>0?n/i*100:0;return r.jsx("div",{className:"w-full bg-border/30 rounded-full h-2.5",children:r.jsx("div",{className:"bg-primary h-2.5 rounded-full transition-all duration-500",style:{width:`${o}%`}})})},yx=({infoCard:n})=>r.jsx("div",{className:"w-full bg-surface rounded-lg shadow-lg border border-border",children:r.jsx("div",{className:"p-6 md:p-8 min-h-[12rem] flex items-center justify-center",children:r.jsx(Xn,{html:n.content,className:"text-lg text-left text-text break-words prose dark:prose-invert max-w-none prose-img:mx-auto prose-img:max-h-64"})})}),vx=({isOpen:n,onClose:i,infoCards:o})=>{const p=M.useRef(null);return Pt(p,n),n?r.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-75 flex items-center justify-center z-[60] p-4",children:r.jsxs("div",{ref:p,className:"bg-surface rounded-lg shadow-xl w-full max-w-2xl transform transition-all relative max-h-[90vh] flex flex-col",role:"dialog","aria-modal":"true","aria-labelledby":"info-modal-title",children:[r.jsxs("div",{className:"flex-shrink-0 flex justify-between items-center p-4 border-b border-border",children:[r.jsx("h2",{id:"info-modal-title",className:"text-xl font-bold text-text",children:"Related Information"}),r.jsx(se,{type:"button",variant:"ghost",onClick:i,className:"p-1 h-auto","aria-label":"Close",children:r.jsx(J,{name:"x"})})]}),r.jsx("div",{className:"p-6 overflow-y-auto space-y-6",children:o.map((d,c)=>r.jsxs("div",{children:[r.jsx(Xn,{html:d.content,className:"prose dark:prose-invert max-w-none"}),c<o.length-1&&r.jsx("hr",{className:"my-6 border-border"})]},d.id))}),r.jsx("div",{className:"flex-shrink-0 flex justify-end p-4 bg-background/50 border-t border-border",children:r.jsx(se,{type:"button",variant:"primary",onClick:i,children:"Close"})})]})}):null},wx=(n,i,o)=>{const[p,d]=M.useState([]),[c,l]=M.useState(!1),[f,v]=M.useState(new Set),[h,C]=M.useState(new Set),[k,I]=M.useState(0),[x,S]=M.useState(0);return M.useEffect(()=>{(async()=>{var O;if(c)return;const b=n.type===De.Learning;if(o){const R=n.type===De.Flashcard?n.cards:n.questions;d(R),I(0),S(0),l(!0);return}let j=!1;try{const R=await Fh(i);((O=R==null?void 0:R.reviewQueue)==null?void 0:O.length)>0&&typeof R.currentIndex=="number"?(d(R.reviewQueue),I(R.currentIndex),S(R.itemsCompleted??R.currentIndex),b&&(v(new Set(R.readInfoCardIds||[])),C(new Set(R.unlockedQuestionIds||[]))),j=!0):R&&await ao(i)}catch(R){console.error("Failed to load saved session from DB",R)}if(!j){const R=new Date;if(R.setHours(23,59,59,999),b)d(n.infoCards),v(new Set),C(new Set);else{const T=(n.type===De.Flashcard?n.cards:n.questions).filter(P=>!P.suspended&&new Date(P.dueDate)<=R).sort(()=>Math.random()-.5);d(T)}I(0),S(0)}l(!0)})()},[n,i,o,c]),{sessionQueue:p,setSessionQueue:d,isSessionInitialized:c,initialIndex:k,initialItemsCompleted:x,readInfoCardIds:f,setReadInfoCardIds:v,unlockedQuestionIds:h,setUnlockedQuestionIds:C}};var eu={};(function n(i,o,p,d){var c=!!(i.Worker&&i.Blob&&i.Promise&&i.OffscreenCanvas&&i.OffscreenCanvasRenderingContext2D&&i.HTMLCanvasElement&&i.HTMLCanvasElement.prototype.transferControlToOffscreen&&i.URL&&i.URL.createObjectURL),l=typeof Path2D=="function"&&typeof DOMMatrix=="function",f=function(){if(!i.OffscreenCanvas)return!1;var z=new OffscreenCanvas(1,1),_=z.getContext("2d");_.fillRect(0,0,1,1);var F=z.transferToImageBitmap();try{_.createPattern(F,"no-repeat")}catch{return!1}return!0}();function v(){}function h(z){var _=o.exports.Promise,F=_!==void 0?_:i.Promise;return typeof F=="function"?new F(z):(z(v,v),null)}var C=function(z,_){return{transform:function(F){if(z)return F;if(_.has(F))return _.get(F);var de=new OffscreenCanvas(F.width,F.height),he=de.getContext("2d");return he.drawImage(F,0,0),_.set(F,de),de},clear:function(){_.clear()}}}(f,new Map),k=function(){var z=Math.floor(16.666666666666668),_,F,de={},he=0;return typeof requestAnimationFrame=="function"&&typeof cancelAnimationFrame=="function"?(_=function(ie){var be=Math.random();return de[be]=requestAnimationFrame(function Ne(Se){he===Se||he+z-1<Se?(he=Se,delete de[be],ie()):de[be]=requestAnimationFrame(Ne)}),be},F=function(ie){de[ie]&&cancelAnimationFrame(de[ie])}):(_=function(ie){return setTimeout(ie,z)},F=function(ie){return clearTimeout(ie)}),{frame:_,cancel:F}}(),I=function(){var z,_,F={};function de(he){function ie(be,Ne){he.postMessage({options:be||{},callback:Ne})}he.init=function(Ne){var Se=Ne.transferControlToOffscreen();he.postMessage({canvas:Se},[Se])},he.fire=function(Ne,Se,ke){if(_)return ie(Ne,null),_;var Ae=Math.random().toString(36).slice(2);return _=h(function(Pe){function Ye(Re){Re.data.callback===Ae&&(delete F[Ae],he.removeEventListener("message",Ye),_=null,C.clear(),ke(),Pe())}he.addEventListener("message",Ye),ie(Ne,Ae),F[Ae]=Ye.bind(null,{data:{callback:Ae}})}),_},he.reset=function(){he.postMessage({reset:!0});for(var Ne in F)F[Ne](),delete F[Ne]}}return function(){if(z)return z;if(!p&&c){var he=["var CONFETTI, SIZE = {}, module = {};","("+n.toString()+")(this, module, true, SIZE);","onmessage = function(msg) {","  if (msg.data.options) {","    CONFETTI(msg.data.options).then(function () {","      if (msg.data.callback) {","        postMessage({ callback: msg.data.callback });","      }","    });","  } else if (msg.data.reset) {","    CONFETTI && CONFETTI.reset();","  } else if (msg.data.resize) {","    SIZE.width = msg.data.resize.width;","    SIZE.height = msg.data.resize.height;","  } else if (msg.data.canvas) {","    SIZE.width = msg.data.canvas.width;","    SIZE.height = msg.data.canvas.height;","    CONFETTI = module.exports.create(msg.data.canvas);","  }","}"].join(`
`);try{z=new Worker(URL.createObjectURL(new Blob([he])))}catch(ie){return typeof console!==void 0&&typeof console.warn=="function"&&console.warn(" Could not load worker",ie),null}de(z)}return z}}(),x={particleCount:50,angle:90,spread:45,startVelocity:45,decay:.9,gravity:1,drift:0,ticks:200,x:.5,y:.5,shapes:["square","circle"],zIndex:100,colors:["#26ccff","#a25afd","#ff5e7e","#88ff5a","#fcff42","#ffa62d","#ff36ff"],disableForReducedMotion:!1,scalar:1};function S(z,_){return _?_(z):z}function g(z){return z!=null}function b(z,_,F){return S(z&&g(z[_])?z[_]:x[_],F)}function j(z){return z<0?0:Math.floor(z)}function O(z,_){return Math.floor(Math.random()*(_-z))+z}function R(z){return parseInt(z,16)}function A(z){return z.map(T)}function T(z){var _=String(z).replace(/[^0-9a-f]/gi,"");return _.length<6&&(_=_[0]+_[0]+_[1]+_[1]+_[2]+_[2]),{r:R(_.substring(0,2)),g:R(_.substring(2,4)),b:R(_.substring(4,6))}}function P(z){var _=b(z,"origin",Object);return _.x=b(_,"x",Number),_.y=b(_,"y",Number),_}function H(z){z.width=document.documentElement.clientWidth,z.height=document.documentElement.clientHeight}function K(z){var _=z.getBoundingClientRect();z.width=_.width,z.height=_.height}function W(z){var _=document.createElement("canvas");return _.style.position="fixed",_.style.top="0px",_.style.left="0px",_.style.pointerEvents="none",_.style.zIndex=z,_}function B(z,_,F,de,he,ie,be,Ne,Se){z.save(),z.translate(_,F),z.rotate(ie),z.scale(de,he),z.arc(0,0,1,be,Ne,Se),z.restore()}function Y(z){var _=z.angle*(Math.PI/180),F=z.spread*(Math.PI/180);return{x:z.x,y:z.y,wobble:Math.random()*10,wobbleSpeed:Math.min(.11,Math.random()*.1+.05),velocity:z.startVelocity*.5+Math.random()*z.startVelocity,angle2D:-_+(.5*F-Math.random()*F),tiltAngle:(Math.random()*(.75-.25)+.25)*Math.PI,color:z.color,shape:z.shape,tick:0,totalTicks:z.ticks,decay:z.decay,drift:z.drift,random:Math.random()+2,tiltSin:0,tiltCos:0,wobbleX:0,wobbleY:0,gravity:z.gravity*3,ovalScalar:.6,scalar:z.scalar,flat:z.flat}}function q(z,_){_.x+=Math.cos(_.angle2D)*_.velocity+_.drift,_.y+=Math.sin(_.angle2D)*_.velocity+_.gravity,_.velocity*=_.decay,_.flat?(_.wobble=0,_.wobbleX=_.x+10*_.scalar,_.wobbleY=_.y+10*_.scalar,_.tiltSin=0,_.tiltCos=0,_.random=1):(_.wobble+=_.wobbleSpeed,_.wobbleX=_.x+10*_.scalar*Math.cos(_.wobble),_.wobbleY=_.y+10*_.scalar*Math.sin(_.wobble),_.tiltAngle+=.1,_.tiltSin=Math.sin(_.tiltAngle),_.tiltCos=Math.cos(_.tiltAngle),_.random=Math.random()+2);var F=_.tick++/_.totalTicks,de=_.x+_.random*_.tiltCos,he=_.y+_.random*_.tiltSin,ie=_.wobbleX+_.random*_.tiltCos,be=_.wobbleY+_.random*_.tiltSin;if(z.fillStyle="rgba("+_.color.r+", "+_.color.g+", "+_.color.b+", "+(1-F)+")",z.beginPath(),l&&_.shape.type==="path"&&typeof _.shape.path=="string"&&Array.isArray(_.shape.matrix))z.fill(fe(_.shape.path,_.shape.matrix,_.x,_.y,Math.abs(ie-de)*.1,Math.abs(be-he)*.1,Math.PI/10*_.wobble));else if(_.shape.type==="bitmap"){var Ne=Math.PI/10*_.wobble,Se=Math.abs(ie-de)*.1,ke=Math.abs(be-he)*.1,Ae=_.shape.bitmap.width*_.scalar,Pe=_.shape.bitmap.height*_.scalar,Ye=new DOMMatrix([Math.cos(Ne)*Se,Math.sin(Ne)*Se,-Math.sin(Ne)*ke,Math.cos(Ne)*ke,_.x,_.y]);Ye.multiplySelf(new DOMMatrix(_.shape.matrix));var Re=z.createPattern(C.transform(_.shape.bitmap),"no-repeat");Re.setTransform(Ye),z.globalAlpha=1-F,z.fillStyle=Re,z.fillRect(_.x-Ae/2,_.y-Pe/2,Ae,Pe),z.globalAlpha=1}else if(_.shape==="circle")z.ellipse?z.ellipse(_.x,_.y,Math.abs(ie-de)*_.ovalScalar,Math.abs(be-he)*_.ovalScalar,Math.PI/10*_.wobble,0,2*Math.PI):B(z,_.x,_.y,Math.abs(ie-de)*_.ovalScalar,Math.abs(be-he)*_.ovalScalar,Math.PI/10*_.wobble,0,2*Math.PI);else if(_.shape==="star")for(var E=Math.PI/2*3,ge=4*_.scalar,re=8*_.scalar,$=_.x,G=_.y,ee=5,ce=Math.PI/ee;ee--;)$=_.x+Math.cos(E)*re,G=_.y+Math.sin(E)*re,z.lineTo($,G),E+=ce,$=_.x+Math.cos(E)*ge,G=_.y+Math.sin(E)*ge,z.lineTo($,G),E+=ce;else z.moveTo(Math.floor(_.x),Math.floor(_.y)),z.lineTo(Math.floor(_.wobbleX),Math.floor(he)),z.lineTo(Math.floor(ie),Math.floor(be)),z.lineTo(Math.floor(de),Math.floor(_.wobbleY));return z.closePath(),z.fill(),_.tick<_.totalTicks}function Q(z,_,F,de,he){var ie=_.slice(),be=z.getContext("2d"),Ne,Se,ke=h(function(Ae){function Pe(){Ne=Se=null,be.clearRect(0,0,de.width,de.height),C.clear(),he(),Ae()}function Ye(){p&&!(de.width===d.width&&de.height===d.height)&&(de.width=z.width=d.width,de.height=z.height=d.height),!de.width&&!de.height&&(F(z),de.width=z.width,de.height=z.height),be.clearRect(0,0,de.width,de.height),ie=ie.filter(function(Re){return q(be,Re)}),ie.length?Ne=k.frame(Ye):Pe()}Ne=k.frame(Ye),Se=Pe});return{addFettis:function(Ae){return ie=ie.concat(Ae),ke},canvas:z,promise:ke,reset:function(){Ne&&k.cancel(Ne),Se&&Se()}}}function N(z,_){var F=!z,de=!!b(_||{},"resize"),he=!1,ie=b(_,"disableForReducedMotion",Boolean),be=c&&!!b(_||{},"useWorker"),Ne=be?I():null,Se=F?H:K,ke=z&&Ne?!!z.__confetti_initialized:!1,Ae=typeof matchMedia=="function"&&matchMedia("(prefers-reduced-motion)").matches,Pe;function Ye(E,ge,re){for(var $=b(E,"particleCount",j),G=b(E,"angle",Number),ee=b(E,"spread",Number),ce=b(E,"startVelocity",Number),le=b(E,"decay",Number),ne=b(E,"gravity",Number),je=b(E,"drift",Number),Me=b(E,"colors",A),Te=b(E,"ticks",Number),ze=b(E,"shapes"),ut=b(E,"scalar"),rt=!!b(E,"flat"),bt=P(E),Ue=$,Ke=[],ot=z.width*bt.x,it=z.height*bt.y;Ue--;)Ke.push(Y({x:ot,y:it,angle:G,spread:ee,startVelocity:ce,color:Me[Ue%Me.length],shape:ze[O(0,ze.length)],ticks:Te,decay:le,gravity:ne,drift:je,scalar:ut,flat:rt}));return Pe?Pe.addFettis(Ke):(Pe=Q(z,Ke,Se,ge,re),Pe.promise)}function Re(E){var ge=ie||b(E,"disableForReducedMotion",Boolean),re=b(E,"zIndex",Number);if(ge&&Ae)return h(function(ce){ce()});F&&Pe?z=Pe.canvas:F&&!z&&(z=W(re),document.body.appendChild(z)),de&&!ke&&Se(z);var $={width:z.width,height:z.height};Ne&&!ke&&Ne.init(z),ke=!0,Ne&&(z.__confetti_initialized=!0);function G(){if(Ne){var ce={getBoundingClientRect:function(){if(!F)return z.getBoundingClientRect()}};Se(ce),Ne.postMessage({resize:{width:ce.width,height:ce.height}});return}$.width=$.height=null}function ee(){Pe=null,de&&(he=!1,i.removeEventListener("resize",G)),F&&z&&(document.body.contains(z)&&document.body.removeChild(z),z=null,ke=!1)}return de&&!he&&(he=!0,i.addEventListener("resize",G,!1)),Ne?Ne.fire(E,$,ee):Ye(E,$,ee)}return Re.reset=function(){Ne&&Ne.reset(),Pe&&Pe.reset()},Re}var Z;function oe(){return Z||(Z=N(null,{useWorker:!0,resize:!0})),Z}function fe(z,_,F,de,he,ie,be){var Ne=new Path2D(z),Se=new Path2D;Se.addPath(Ne,new DOMMatrix(_));var ke=new Path2D;return ke.addPath(Se,new DOMMatrix([Math.cos(be)*he,Math.sin(be)*he,-Math.sin(be)*ie,Math.cos(be)*ie,F,de])),ke}function ye(z){if(!l)throw new Error("path confetti are not supported in this browser");var _,F;typeof z=="string"?_=z:(_=z.path,F=z.matrix);var de=new Path2D(_),he=document.createElement("canvas"),ie=he.getContext("2d");if(!F){for(var be=1e3,Ne=be,Se=be,ke=0,Ae=0,Pe,Ye,Re=0;Re<be;Re+=2)for(var E=0;E<be;E+=2)ie.isPointInPath(de,Re,E,"nonzero")&&(Ne=Math.min(Ne,Re),Se=Math.min(Se,E),ke=Math.max(ke,Re),Ae=Math.max(Ae,E));Pe=ke-Ne,Ye=Ae-Se;var ge=10,re=Math.min(ge/Pe,ge/Ye);F=[re,0,0,re,-Math.round(Pe/2+Ne)*re,-Math.round(Ye/2+Se)*re]}return{type:"path",path:_,matrix:F}}function ue(z){var _,F=1,de="#000000",he='"Apple Color Emoji", "Segoe UI Emoji", "Segoe UI Symbol", "Noto Color Emoji", "EmojiOne Color", "Android Emoji", "Twemoji Mozilla", "system emoji", sans-serif';typeof z=="string"?_=z:(_=z.text,F="scalar"in z?z.scalar:F,he="fontFamily"in z?z.fontFamily:he,de="color"in z?z.color:de);var ie=10*F,be=""+ie+"px "+he,Ne=new OffscreenCanvas(ie,ie),Se=Ne.getContext("2d");Se.font=be;var ke=Se.measureText(_),Ae=Math.ceil(ke.actualBoundingBoxRight+ke.actualBoundingBoxLeft),Pe=Math.ceil(ke.actualBoundingBoxAscent+ke.actualBoundingBoxDescent),Ye=2,Re=ke.actualBoundingBoxLeft+Ye,E=ke.actualBoundingBoxAscent+Ye;Ae+=Ye+Ye,Pe+=Ye+Ye,Ne=new OffscreenCanvas(Ae,Pe),Se=Ne.getContext("2d"),Se.font=be,Se.fillStyle=de,Se.fillText(_,Re,E);var ge=1/F;return{type:"bitmap",bitmap:Ne.transferToImageBitmap(),matrix:[ge,0,0,ge,-Ae*ge/2,-Pe*ge/2]}}o.exports=function(){return oe().apply(this,arguments)},o.exports.reset=function(){oe().reset()},o.exports.create=N,o.exports.shapeFromPath=ye,o.exports.shapeFromText=ue})(function(){return typeof window<"u"?window:typeof self<"u"?self:this||{}}(),eu,!1);const Oc=eu.exports;eu.exports.create;const Cf=()=>(M.useEffect(()=>{const i=Date.now()+1e3,p={startVelocity:30,spread:360,ticks:90,zIndex:99,colors:["#60a5fa","#5eead4","#a78bfa","#fde047","#f9fafb"]};function d(l,f){return Math.random()*(f-l)+l}const c=window.setInterval(()=>{const l=i-Date.now();if(l<=0)return clearInterval(c);const f=50*(l/1e3);Oc({...p,particleCount:f,origin:{x:d(.1,.3),y:Math.random()-.2}}),Oc({...p,particleCount:f,origin:{x:d(.7,.9),y:Math.random()-.2}})},250);return()=>{clearInterval(c),Oc.reset()}},[]),null),bx=({deckId:n,seriesId:i,reviewedItems:o,nextDeckId:p,onSessionEnd:d,onStudyNextDeck:c,isCramSession:l})=>{if(l)return r.jsxs("div",{className:"text-center p-8 animate-fade-in relative",children:[r.jsx(Cf,{}),r.jsx("h2",{className:"text-2xl font-bold text-green-500",children:"Cram Session Complete!"}),r.jsxs("p",{className:"text-text-muted mt-2",children:["You've reviewed all ",o.length," items in this deck."]}),r.jsx(se,{onClick:()=>d(n,i),className:"mt-8",children:"Finish Session"})]});const f=o.reduce((C,{rating:k})=>(k&&(C[k]=(C[k]||0)+1),C),{}),v=o.map(({oldItem:C,newItem:k})=>{const I=nn(C);return(k.masteryLevel||0)-I}),h=v.length>0?v.reduce((C,k)=>C+k,0)/v.length*100:0;return r.jsxs("div",{className:"text-center p-8 animate-fade-in relative",children:[r.jsx(Cf,{}),r.jsx("h2",{className:"text-2xl font-bold text-green-500",children:"Session Complete!"}),r.jsxs("p",{className:"text-text-muted mt-2",children:["You reviewed ",o.length," item",o.length!==1?"s":"","."]}),r.jsxs("div",{className:"mt-8 max-w-sm mx-auto bg-surface p-4 rounded-lg border border-border",children:[r.jsx("h3",{className:"font-semibold text-lg mb-3",children:"Session Summary"}),r.jsxs("div",{className:"flex justify-around text-center",children:[r.jsxs("div",{children:[r.jsx("p",{className:"text-2xl font-bold text-red-500",children:f[lt.Again]||0}),r.jsx("p",{className:"text-xs text-text-muted",children:"Again"})]}),r.jsxs("div",{children:[r.jsx("p",{className:"text-2xl font-bold text-orange-500",children:f[lt.Hard]||0}),r.jsx("p",{className:"text-xs text-text-muted",children:"Hard"})]}),r.jsxs("div",{children:[r.jsx("p",{className:"text-2xl font-bold text-green-500",children:f[lt.Good]||0}),r.jsx("p",{className:"text-xs text-text-muted",children:"Good"})]}),r.jsxs("div",{children:[r.jsx("p",{className:"text-2xl font-bold text-blue-500",children:f[lt.Easy]||0}),r.jsx("p",{className:"text-xs text-text-muted",children:"Easy"})]})]}),r.jsx("div",{className:"mt-4 text-sm",children:r.jsxs("p",{children:["Average Mastery Change: ",r.jsxs("strong",{className:h>=0?"text-green-500":"text-red-500",children:[h>=0?"+":"",h.toFixed(1),"%"]})]})})]}),r.jsxs("div",{className:"flex flex-col sm:flex-row justify-center items-center gap-4 mt-8",children:[p&&c&&i&&r.jsxs(se,{onClick:()=>c(n,i,p),variant:"primary",size:"lg",children:[r.jsx(J,{name:"zap",className:"w-5 h-5 mr-2"}),"Start Next Deck"]}),r.jsx(se,{onClick:()=>d(n,i),variant:p?"secondary":"primary",size:"lg",children:"Finish Session"})]})]})},kx=({isCurrent:n,isHistorical:i,isFlipped:o,isAnswered:p,isReviewing:d,isQuiz:c,isInfoCard:l,isCramSession:f,showNavArrows:v,displayIndex:h,currentIndex:C,queueLength:k,onReview:I,onSuspend:x,onReadInfoCard:S,onFlip:g,onReturnToCurrent:b,onNavigatePrevious:j,onNavigateNext:O,itemsCompleted:R,totalSessionItems:A})=>{const T=(o||c&&p)&&n;return r.jsxs("div",{className:"flex-shrink-0 mt-4 flex flex-col items-center justify-center space-y-4 min-h-[10rem]",children:[r.jsx("div",{className:"w-full flex-grow flex items-center justify-center",children:i?r.jsxs("div",{className:"text-center animate-fade-in",children:[r.jsx(se,{onClick:b,variant:"primary",className:"text-lg py-3",children:"Return to Current Item"}),r.jsx("div",{className:"text-xs mt-2 font-semibold text-yellow-600 dark:text-yellow-400",children:"(Reviewing Past Item)"})]}):T?r.jsxs("div",{className:"space-y-4 animate-fade-in w-full",children:[r.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[r.jsx(se,{onClick:()=>I(lt.Again),className:"bg-red-600 hover:bg-red-700 focus:ring-red-500 py-3 text-base text-white",disabled:d,children:"Again"}),r.jsx(se,{onClick:()=>I(lt.Hard),className:"bg-orange-500 hover:bg-orange-600 focus:ring-orange-400 py-3 text-base text-white",disabled:d,children:"Hard"}),r.jsx(se,{onClick:()=>I(lt.Good),className:"bg-green-600 hover:bg-green-700 focus:ring-green-500 py-3 text-base text-white",disabled:d,children:"Good"}),r.jsx(se,{onClick:()=>I(lt.Easy),className:"bg-blue-600 hover:bg-blue-700 focus:ring-blue-500 py-3 text-base text-white",disabled:d,children:"Easy"})]}),!f&&r.jsx("div",{className:"text-center",children:r.jsxs(se,{variant:"ghost",onClick:x,className:"text-xs",disabled:d,children:[r.jsx(J,{name:"eye-off",className:"w-4 h-4 mr-1"})," Suspend this item"]})})]}):l&&n?r.jsx(se,{onClick:S,variant:"primary",className:"w-full max-w-md text-lg py-3 animate-fade-in mx-auto flex items-center justify-center",children:"Continue"}):!c&&n&&r.jsx(se,{onClick:g,variant:"primary",className:"w-full max-w-md text-lg py-3 animate-fade-in mx-auto flex items-center justify-center",children:"Show Answer"})}),v&&r.jsxs("div",{className:"flex justify-center items-center w-full max-w-xs gap-4 animate-fade-in h-12",children:[r.jsx(se,{variant:"ghost",onClick:j,disabled:h===0,className:"p-3 rounded-full disabled:opacity-30","aria-label":"Previous item",children:r.jsx(J,{name:"chevron-left",className:"w-8 h-8"})}),r.jsx("div",{className:"text-center w-28",children:r.jsxs("span",{className:"text-sm text-text-muted",children:["Item ",Math.min(R+1,A)," of ",A]})}),r.jsx(se,{variant:"ghost",onClick:O,disabled:h>=C,className:"p-3 rounded-full disabled:opacity-30","aria-label":"Next item",children:r.jsx(J,{name:"chevron-left",className:"w-8 h-8 rotate-180"})})]})]})},eo=({deck:n,onSessionEnd:i,onItemReviewed:o,onUpdateLastOpened:p,sessionKeySuffix:d="",seriesId:c,onStudyNextDeck:l})=>{const[f,v]=M.useState([]),[h,C]=M.useState(0),[k,I]=M.useState(0),[x,S]=M.useState(0),[g,b]=M.useState(!1),[j,O]=M.useState(null),[R,A]=M.useState(!1),[T,P]=M.useState(!1),[H,K]=M.useState([]),{hapticsEnabled:W}=rn(),{addToast:B}=Kt(),{deckSeries:Y,seriesProgress:q}=at(),Q=M.useMemo(()=>n.id==="general-study-deck"||["_cram","_flip","_reversed"].includes(d),[n.id,d]),N=`session_deck_${n.id}${d}`,Z=n.type==="learning",{sessionQueue:oe,setSessionQueue:fe,isSessionInitialized:ye,initialIndex:ue,readInfoCardIds:z,setReadInfoCardIds:_,unlockedQuestionIds:F,setUnlockedQuestionIds:de,initialItemsCompleted:he}=wx(n,N,Q),ie=M.useMemo(()=>{if(Q)return n.type===De.Flashcard?n.cards.length:n.questions.length;if(Z){const ne=n,je=new Date;je.setHours(23,59,59,999);const Me=ne.questions.filter(Te=>!Te.suspended&&new Date(Te.dueDate)<=je).length;return ne.infoCards.length+Me}const ce=n.type===De.Flashcard?n.cards:n.questions,le=new Date;return le.setHours(23,59,59,999),ce.filter(ne=>!ne.suspended&&new Date(ne.dueDate)<=le).length},[n,Z,Q]);M.useEffect(()=>{ye&&(C(ue),I(ue),S(he))},[ye,ue,he]),M.useEffect(()=>{p(n.id)},[n.id,p]),M.useEffect(()=>{if(!Q&&ye&&h<oe.length){const ce={id:N,reviewQueue:oe,currentIndex:h,readInfoCardIds:Array.from(z),unlockedQuestionIds:Array.from(F),itemsCompleted:x};Lh(N,ce).catch(le=>{console.error("Could not save session state to DB",le),B("Could not save session progress.","error")})}},[oe,h,z,F,N,Q,ye,B,x]);const be=M.useMemo(()=>oe[k],[oe,k]),Ne=k<h,Se=k===h,ke=be&&"questionText"in be,Ae=be&&"content"in be&&!("front"in be),Pe=j!==null,Ye=be&&"originalDeckName"in be?be.originalDeckName:void 0,Re=M.useMemo(()=>{if(!c||x<ie)return null;const ce=Y.find(je=>je.id===c);if(!ce)return null;const le=ce.levels.flatMap(je=>je.deckIds),ne=le.indexOf(n.id);if(ne>-1&&ne<le.length-1){const je=q.get(c)||new Set,Me=ne+1;if(Me<=je.size)return le[Me]}return null},[c,n.id,Y,x,ie,q]),E=M.useCallback(()=>{b(!1),O(null),S(le=>le+1);const ce=h+1;C(ce),I(ce),ce>=oe.length&&!Q&&ao(N).catch(le=>console.error("Failed to delete session state",le))},[h,oe.length,Q,N]),ge=M.useCallback(async ce=>{if(!be||!Se||R||Ae)return;if(d==="_cram"){A(!0),E(),A(!1);return}A(!0),W&&"vibrate"in navigator&&navigator.vibrate(20);let le=tx(be,ce);(le.lapses||0)>=8&&!be.suspended&&(le={...le,suspended:!0},B("Item suspended due to repeated failures.","info")),nn(be)<=.85&&(le.masteryLevel||0)>.85&&B("Item Mastered!","success"),v(ne=>[...ne,{oldItem:be,newItem:le,rating:ce}]);try{const ne=be.originalDeckId||n.id;await o(ne,le,ce,c)}catch(ne){console.error("Failed to save review:",ne),B("Failed to save review progress for this card.","error")}finally{fe(ne=>ne.map((je,Me)=>Me===h?le:je)),setTimeout(()=>{E(),A(!1)},800)}},[be,Se,R,Ae,d,E,W,B,n.id,o,c,h,fe]),re=M.useCallback(async()=>{if(!be||!Se||R||Ae)return;A(!0);const ce={...be,suspended:!0};v(le=>[...le,{oldItem:be,newItem:ce,rating:null}]);try{const le=be.originalDeckId||n.id;await o(le,ce,null,c),B("Card suspended.","info")}catch{B("Failed to suspend card.","error")}finally{setTimeout(()=>{E(),A(!1)},300)}},[be,Se,R,Ae,E,B,n.id,o,c]),$=M.useCallback(()=>{if(!Z||!Ae||!Se)return;const ce=be,le=new Set(z).add(ce.id);_(le);const ne=new Set(F);ce.unlocksQuestionIds.forEach(ze=>ne.add(ze)),de(ne);const je=new Date;je.setHours(23,59,59,999);const Me=n.questions.filter(ze=>ce.unlocksQuestionIds.includes(ze.id)&&!ze.suspended&&new Date(ze.dueDate)<=je),Te=[...oe];Te.splice(h,1,...Me),fe(Te),S(ze=>ze+1)},[Z,Ae,Se,be,z,F,n,oe,h,_,de,fe]),G=M.useCallback(()=>{var ne;if(!Z||!ke)return;const ce=be,le=n;(ne=ce.infoCardIds)!=null&&ne.length&&(K(le.infoCards.filter(je=>{var Me;return(Me=ce.infoCardIds)==null?void 0:Me.includes(je.id)})),P(!0))},[Z,ke,be,n]);return M.useEffect(()=>{const ce=le=>{if(!(le.target instanceof HTMLInputElement||le.target instanceof HTMLTextAreaElement)){if(le.key==="ArrowLeft"&&k>0){le.preventDefault(),I(ne=>ne-1);return}if(le.key==="ArrowRight"&&k<h){le.preventDefault(),I(ne=>ne+1);return}!Se||R||(Ae&&(le.code==="Space"||le.key==="Enter")?(le.preventDefault(),$()):ke&&Pe?(le.key==="1"&&ge(lt.Again),le.key==="2"&&ge(lt.Hard),le.key==="3"&&ge(lt.Good),le.key==="4"&&ge(lt.Easy)):!ke&&!Ae&&(g?(le.key==="1"&&ge(lt.Again),le.key==="2"&&ge(lt.Hard),le.key==="3"&&ge(lt.Good),le.key==="4"&&ge(lt.Easy)):le.code==="Space"&&(le.preventDefault(),b(!0))))}};return window.addEventListener("keydown",ce),()=>window.removeEventListener("keydown",ce)},[g,Pe,ke,Se,R,ge,k,h,Ae,$]),ye?ye&&ie===0?r.jsxs("div",{className:"text-center p-8",children:[r.jsx("h2",{className:"text-2xl font-bold",children:"All caught up!"}),r.jsx("p",{className:"text-text-muted mt-2",children:Q?"No items to review.":"No items due for review in this deck."}),r.jsx(se,{onClick:()=>i(n.id,c),className:"mt-6",children:"Back"})]}):ye&&ie>0&&(x>=ie||h>=oe.length)?r.jsx(bx,{deckId:n.id,seriesId:c,reviewedItems:f,nextDeckId:Re,onSessionEnd:i,onStudyNextDeck:l,isCramSession:d==="_cram"}):r.jsxs("div",{className:"w-full max-w-3xl mx-auto p-4 flex flex-col h-full overflow-x-hidden",children:[r.jsx(vx,{isOpen:T,onClose:()=>P(!1),infoCards:H}),r.jsx(Xc,{current:x,total:ie}),r.jsx("div",{className:"flex-grow flex flex-col items-center justify-center my-4 w-full",children:be&&r.jsx("div",{className:"w-full relative animate-fade-in",children:ke?r.jsx(xx,{question:be,selectedAnswerId:Ne?be.correctAnswerId:j,onSelectAnswer:ce=>Se&&!Pe&&O(ce),deckName:Ye,onShowInfo:Z?G:void 0}):Ae?r.jsx(yx,{infoCard:be}):r.jsx(gx,{card:be,isFlipped:g||Ne})},k)}),r.jsx(kx,{isCurrent:Se,isHistorical:Ne,isFlipped:g,isAnswered:Pe,isReviewing:R,isQuiz:!!ke,isInfoCard:!!Ae,isCramSession:d==="_cram",showNavArrows:oe.length>1,displayIndex:k,currentIndex:h,queueLength:oe.length,onReview:ge,onSuspend:re,onReadInfoCard:$,onFlip:()=>b(!0),onReturnToCurrent:()=>I(h),onNavigatePrevious:()=>I(ce=>ce-1),onNavigateNext:()=>I(ce=>ce+1),itemsCompleted:x,totalSessionItems:ie})]}):r.jsx("div",{className:"text-center p-8",children:r.jsx("p",{className:"text-text-muted",children:"Initializing session..."})})},Ls=({label:n,checked:i,onChange:o,description:p,disabled:d=!1})=>{const c=so.useId();return r.jsxs("div",{className:`flex items-center justify-between ${d?"opacity-50":""}`,children:[r.jsxs("span",{className:"flex flex-col",children:[r.jsx("label",{htmlFor:c,className:`font-medium text-text ${d?"cursor-not-allowed":"cursor-pointer"}`,children:n}),p&&r.jsx("span",{id:`${c}-description`,className:"text-sm text-text-muted",children:p})]}),r.jsx("button",{id:c,type:"button",role:"switch","aria-checked":i,"aria-describedby":p?`${c}-description`:void 0,onClick:()=>o(!i),disabled:d,className:`${i?"bg-primary":"bg-border"} relative inline-flex h-6 w-11 flex-shrink-0 cursor-pointer rounded-full border-2 border-transparent transition-colors duration-200 ease-in-out focus:outline-none focus:ring-2 focus:ring-primary focus:ring-offset-2 dark:focus:ring-offset-surface`,children:r.jsx("span",{"aria-hidden":"true",className:`${i?"translate-x-5":"translate-x-0"} pointer-events-none inline-block h-5 w-5 transform rounded-full bg-white shadow ring-0 transition duration-200 ease-in-out`})})]})},Rc="cogniflow-themeId",es=[{id:"system",name:"System",isDark:!1,metaColor:"#f9fafb",metaColorDark:"#111827",palette:{background:"249 250 251",surface:"255 255 255",primary:"37 99 235",text:"17 24 39"},paletteDark:{background:"17 24 39",surface:"31 41 55",primary:"37 99 235",text:"243 244 246"}},{id:"light",name:"Light",isDark:!1,metaColor:"#f9fafb",palette:{background:"249 250 251",surface:"255 255 255",primary:"37 99 235",text:"17 24 39"}},{id:"rose",name:"Rose",isDark:!1,metaColor:"#fff1f2",palette:{background:"255 241 242",surface:"254 226 226",primary:"225 29 72",text:"136 25 55"}},{id:"matcha",name:"Matcha",isDark:!1,metaColor:"#f0fdf4",palette:{background:"240 253 244",surface:"220 252 231",primary:"22 163 74",text:"21 94 53"}},{id:"latte",name:"Latte",isDark:!1,metaColor:"#fffbeb",palette:{background:"255 251 235",surface:"254 243 199",primary:"217 119 6",text:"113 63 18"}},{id:"sky",name:"Sky",isDark:!1,metaColor:"#f0f9ff",palette:{background:"240 249 255",surface:"224 242 254",primary:"14 165 233",text:"7 89 133"}},{id:"sunrise",name:"Sunrise",isDark:!1,metaColor:"#fffbeb",palette:{background:"255 251 235",surface:"254 243 199",primary:"249 115 22",text:"124 45 18"}},{id:"lavender",name:"Lavender",isDark:!1,metaColor:"#f5f3ff",palette:{background:"245 243 255",surface:"237 233 254",primary:"124 58 237",text:"76 29 149"}},{id:"terracotta",name:"Terracotta",isDark:!1,metaColor:"#faf3e8",palette:{background:"250 243 232",surface:"245 233 218",primary:"226 114 91",text:"93 64 55"}},{id:"alabaster",name:"Alabaster",isDark:!1,metaColor:"#fcfcfc",palette:{background:"252 252 252",surface:"255 255 255",primary:"96 165 250",text:"50 50 50"}},{id:"dark",name:"Dark",isDark:!0,metaColor:"#111827",palette:{background:"17 24 39",surface:"31 41 55",primary:"37 99 235",text:"243 244 246"}},{id:"espresso",name:"Espresso",isDark:!0,metaColor:"#211713",palette:{background:"33 23 19",surface:"58 45 39",primary:"196 154 108",text:"224 213 208"}},{id:"midnight",name:"Midnight",isDark:!0,metaColor:"#0c0d11",palette:{background:"12 13 17",surface:"26 27 38",primary:"133 137 230",text:"200 201 215"}}],am=M.createContext(void 0),If=n=>{let i=es.find(l=>l.id===n);i||(i=es[0]);const o=window.document.documentElement,p=document.querySelector('meta[name="theme-color"]');let d,c;i.id==="system"?(d=window.matchMedia("(prefers-color-scheme: dark)").matches,c=d?i.metaColorDark:i.metaColor):(d=i.isDark,c=i.metaColor),es.forEach(l=>{l.id!=="system"&&o.classList.remove(`theme-${l.id}`)}),o.classList.remove("theme-dark","theme-light"),i.id!=="system"&&o.classList.add(`theme-${i.id}`),o.classList.toggle("dark",d),p&&c&&p.setAttribute("content",c)},Sx=({children:n})=>{const[i,o]=M.useState(()=>{try{const c=localStorage.getItem(Rc);return es.some(l=>l.id===c)?c:"system"}catch(c){return console.error("Could not access localStorage. Defaulting to 'system'.",c),"system"}});M.useEffect(()=>{try{localStorage.setItem(Rc,i)}catch(c){console.error("Could not set theme in localStorage.",c)}If(i)},[i]),M.useEffect(()=>{const c=window.matchMedia("(prefers-color-scheme: dark)"),l=()=>{let f="system";try{f=localStorage.getItem(Rc)||"system"}catch{}f==="system"&&If("system")};return c.addEventListener("change",l),()=>c.removeEventListener("change",l)},[]);const p=M.useCallback(c=>{o(c)},[]),d=es.find(c=>c.id===i)||es[0];return r.jsx(am.Provider,{value:{themeId:i,setThemeById:p,currentTheme:d},children:n})},jx=()=>{const n=M.useContext(am);if(n===void 0)throw new Error("useTheme must be used within a ThemeProvider");return n},Ex=({themeId:n,isSelected:i,onClick:o})=>{const p=es.find(h=>h.id===n);if(!p)return null;const d=p.id==="system",c=p.isDark,l=p.palette,f=d?p.paletteDark:c?p.palette:null,v=`w-full h-24 rounded-lg border-2 transition-all duration-200 cursor-pointer flex flex-col justify-between p-2 text-left relative ${i?"border-primary ring-2 ring-primary ring-offset-2 ring-offset-background":"border-border hover:border-text-muted"}`;return r.jsxs("div",{children:[r.jsxs("button",{onClick:o,className:v,"aria-pressed":i,"aria-label":`Select ${p.name} theme`,children:[r.jsx("div",{className:"w-full h-full absolute top-0 left-0 overflow-hidden rounded-[5px]",children:d?r.jsxs(r.Fragment,{children:[r.jsx("div",{className:"w-1/2 h-full absolute top-0 left-0",style:{backgroundColor:`rgb(${l.surface})`}}),r.jsx("div",{className:"w-1/2 h-full absolute top-0 right-0",style:{backgroundColor:`rgb(${f.surface})`}})]}):r.jsx("div",{className:"w-full h-full absolute top-0 left-0",style:{backgroundColor:`rgb(${l.surface})`}})}),r.jsxs("div",{className:"relative flex items-center justify-between w-full",children:[r.jsxs("div",{className:"flex items-center gap-1.5 px-2 py-1 rounded-full text-xs backdrop-blur-sm",style:{backgroundColor:`rgba(${l.background}, 0.6)`},children:[r.jsx("div",{className:"w-3 h-3 rounded-full",style:{backgroundColor:`rgb(${l.primary})`}}),r.jsx("span",{style:{color:`rgb(${l.text})`},children:"Aa"})]}),i&&r.jsx("div",{className:"w-6 h-6 rounded-full flex items-center justify-center bg-primary",children:r.jsx(J,{name:"check-circle",className:"w-4 h-4 text-on-primary"})})]}),r.jsxs("div",{className:"relative flex items-center gap-2",children:[d&&r.jsx(r.Fragment,{children:r.jsx(J,{name:"monitor",className:"w-4 h-4",style:{color:`rgb(${l.text})`}})}),!d&&c&&r.jsx(J,{name:"moon",className:"w-4 h-4",style:{color:`rgb(${l.text})`}}),!d&&!c&&r.jsx(J,{name:"sun",className:"w-4 h-4",style:{color:`rgb(${l.text})`}})]})]}),r.jsx("p",{className:`text-center text-sm font-medium mt-2 transition-colors ${i?"text-primary":"text-text"}`,children:p.name})]})},Nx=({selectedTheme:n,onThemeChange:i})=>r.jsxs("div",{children:[r.jsx("label",{className:"block text-sm font-medium text-text-muted mb-2",children:"Theme"}),r.jsx("div",{className:"grid grid-cols-3 sm:grid-cols-4 md:grid-cols-5 gap-4",children:es.map(o=>r.jsx(Ex,{themeId:o.id,isSelected:n===o.id,onClick:()=>i(o.id)},o.id))})]}),om=M.createContext(null),im=()=>{const n=M.useContext(om);if(!n)throw new Error("Accordion components must be used within an <Accordion> component.");return n},lm=M.createContext(null),cm=()=>{const n=M.useContext(lm);if(!n)throw new Error("AccordionTrigger/Content must be used within an <AccordionItem> component.");return n},_x=({children:n,type:i="single",defaultValue:o,className:p=""})=>{const[d,c]=M.useState(o||(i==="multiple"?[]:"")),l=f=>{c(i==="multiple"?v=>{const h=Array.isArray(v)?v:[];return h.includes(f)?h.filter(C=>C!==f):[...h,f]}:v=>v===f?"":f)};return M.useEffect(()=>{c(o===void 0?i==="multiple"?[]:"":o)},[o,i]),r.jsx(om.Provider,{value:{value:d,onValueChange:l,type:i},children:r.jsx("div",{className:p,children:n})})},ya=({children:n,value:i,className:o=""})=>{const{value:p,type:d}=im(),c=d==="multiple"?Array.isArray(p)&&p.includes(i):p===i;return r.jsx(lm.Provider,{value:{value:i,isOpen:c},children:r.jsx("div",{className:o,children:n})})},va=({children:n,className:i="",...o})=>{const{onValueChange:p}=im(),{value:d,isOpen:c}=cm(),l=`accordion-content-${d}`,f=`accordion-header-${d}`;return r.jsx("h3",{id:f,className:"m-0 font-medium",children:r.jsxs("button",{type:"button",onClick:()=>p(d),"aria-expanded":c,"aria-controls":l,className:`w-full flex justify-between items-center text-left p-4 bg-surface hover:bg-border/20 transition-colors ${i}`,...o,children:[n,r.jsx(J,{name:"chevron-down",className:`w-5 h-5 transition-transform duration-300 ${c?"rotate-180":""} text-text-muted`})]})})},wa=({children:n,className:i=""})=>{const{value:o,isOpen:p}=cm(),d=`accordion-content-${o}`,c=`accordion-header-${o}`;return p?r.jsx("div",{id:d,role:"region","aria-labelledby":c,className:`animate-fade-in ${i}`,children:n}):null},Cx=({onExport:n,onRestore:i,onResetProgress:o,onFactoryReset:p,onSync:d,onForceFetch:c,onForceUpload:l,onCreateServerBackup:f,onManageServerBackups:v,isSyncing:h,lastSyncStatus:C,isGapiReady:k,isGapiSignedIn:I,gapiUser:x,onGoogleSignIn:S,onGoogleSignOut:g,onBackupToDrive:b,onRestoreFromDrive:j,onClearAppCache:O,onClearCdnCache:R,onRevertLastFetch:A})=>{const T=rn(),{themeId:P,setThemeById:H}=jx(),[K,W]=M.useState(!1);return M.useEffect(()=>{localStorage.getItem("cogniflow-pre-fetch-backup")&&W(!0)},[]),r.jsxs("div",{className:"max-w-3xl mx-auto animate-fade-in space-y-8",children:[r.jsx("h1",{className:"text-3xl font-bold text-text border-b border-border pb-4",children:"Settings"}),r.jsxs(_x,{type:"multiple",defaultValue:["appearance","general","cloud-sync","gdrive-backup","data-management","cache-management"],className:"w-full space-y-4",children:[r.jsxs(ya,{value:"data-management",className:"border border-border rounded-lg overflow-hidden",children:[r.jsx(va,{children:r.jsx("h2",{className:"text-2xl font-semibold text-text",children:"Data Management"})}),r.jsxs(wa,{className:"bg-surface p-6 flex flex-wrap gap-4 justify-center",children:[r.jsxs(se,{variant:"secondary",onClick:n,children:[r.jsx(J,{name:"download",className:"mr-2"})," Export All Data"]}),r.jsxs(se,{variant:"secondary",onClick:i,children:[r.jsx(J,{name:"upload-cloud",className:"mr-2"})," Restore from File"]}),r.jsxs(se,{variant:"secondary",onClick:o,children:[r.jsx(J,{name:"refresh-ccw",className:"mr-2"})," Reset Progress"]}),K&&r.jsxs(se,{variant:"secondary",onClick:A,children:[r.jsx(J,{name:"refresh-ccw",className:"mr-2"})," Revert Last Fetch"]})]})]}),r.jsxs(ya,{value:"cloud-sync",className:"border border-border rounded-lg overflow-hidden",children:[r.jsx(va,{children:r.jsx("h2",{className:"text-2xl font-semibold text-text",children:"Cloud Sync"})}),r.jsxs(wa,{className:"bg-surface p-6 space-y-6",children:[r.jsx(Ls,{label:"Enable Cloud Sync",description:"Automatically sync your data to the server.",checked:T.backupEnabled,onChange:T.setBackupEnabled}),r.jsx(Ls,{label:"Sync on Cellular Data",description:"Allow auto-sync when on a mobile network.",checked:T.syncOnCellular,onChange:T.setSyncOnCellular,disabled:!T.backupEnabled}),r.jsxs("div",{children:[r.jsx("label",{htmlFor:"backup-api-key",className:"block text-sm font-medium text-text-muted mb-1",children:"Server Backup API Key"}),r.jsx("input",{id:"backup-api-key",type:"password",value:T.backupApiKey,onChange:B=>T.setBackupApiKey(B.target.value),className:"w-full p-2 bg-background border border-border rounded-md focus:ring-2 focus:ring-primary focus:outline-none",disabled:!T.backupEnabled})]}),r.jsxs("div",{className:"pt-4 border-t border-border flex flex-col sm:flex-row gap-2 items-center justify-between",children:[r.jsx("p",{className:"text-sm text-text-muted",children:h?"Syncing...":C}),r.jsx("div",{className:"flex gap-2 flex-wrap justify-end",children:r.jsxs(se,{variant:"primary",onClick:d,disabled:!T.backupEnabled||h,children:[r.jsx(J,{name:"refresh-ccw",className:"w-4 h-4 mr-2"})," Sync Now"]})})]}),r.jsxs("div",{className:"pt-4 border-t border-border",children:[r.jsx("h3",{className:"text-lg font-semibold text-text-muted",children:"Advanced Sync Options"}),r.jsx("p",{className:"text-sm text-text-muted mt-1 mb-4",children:"Use these options to resolve sync conflicts manually. These are destructive actions and should be used with caution."}),r.jsxs("div",{className:"flex flex-wrap gap-4 justify-start",children:[r.jsxs(se,{variant:"secondary",onClick:l,disabled:!T.backupEnabled||h,children:[r.jsx(J,{name:"upload-cloud",className:"w-4 h-4 mr-2"})," Force Upload to Server"]}),r.jsxs(se,{variant:"secondary",onClick:c,disabled:!T.backupEnabled||h,children:[r.jsx(J,{name:"download",className:"w-4 h-4 mr-2"})," Force Fetch from Server"]})]})]}),r.jsxs("div",{className:"pt-4 border-t border-border flex flex-wrap gap-2 justify-center",children:[r.jsxs(se,{variant:"secondary",onClick:f,disabled:!T.backupEnabled||h,children:[r.jsx(J,{name:"plus",className:"w-4 h-4 mr-2"})," Create Manual Backup"]}),r.jsxs(se,{variant:"secondary",onClick:v,disabled:!T.backupEnabled||h,children:[r.jsx(J,{name:"settings",className:"w-4 h-4 mr-2"})," Manage Backups"]})]})]})]}),r.jsxs(ya,{value:"appearance",className:"border border-border rounded-lg overflow-hidden",children:[r.jsx(va,{children:r.jsx("h2",{className:"text-2xl font-semibold text-text",children:"Appearance"})}),r.jsxs(wa,{className:"bg-surface p-6 space-y-6",children:[r.jsx(Nx,{selectedTheme:P,onThemeChange:H}),r.jsx(Ls,{label:"Disable Animations",description:"Reduces motion for a faster experience.",checked:T.disableAnimations,onChange:T.setDisableAnimations})]})]}),r.jsxs(ya,{value:"general",className:"border border-border rounded-lg overflow-hidden",children:[r.jsx(va,{children:r.jsx("h2",{className:"text-2xl font-semibold text-text",children:"General"})}),r.jsxs(wa,{className:"bg-surface p-6 space-y-6",children:[r.jsx(Ls,{label:"Enable Haptic Feedback",description:"Provides physical feedback on supported devices.",checked:T.hapticsEnabled,onChange:T.setHapticsEnabled}),r.jsx(Ls,{label:"Enable AI Features",description:"Allows content generation using the Gemini API.",checked:T.aiFeaturesEnabled,onChange:T.setAiFeaturesEnabled})]})]}),r.jsxs(ya,{value:"gdrive-backup",className:"border border-border rounded-lg overflow-hidden",children:[r.jsx(va,{children:r.jsx("h2",{className:"text-2xl font-semibold text-text",children:"Google Drive Backup"})}),r.jsx(wa,{className:"bg-surface p-6 space-y-6",children:k?I?r.jsxs("div",{className:"space-y-4",children:[r.jsxs("div",{className:"flex items-center gap-4 p-3 bg-background rounded-md",children:[r.jsx("img",{src:x==null?void 0:x.picture,alt:"User profile",className:"w-12 h-12 rounded-full"}),r.jsxs("div",{children:[r.jsx("p",{className:"font-semibold text-text",children:x==null?void 0:x.name}),r.jsx("p",{className:"text-sm text-text-muted",children:x==null?void 0:x.email})]})]}),r.jsxs("div",{className:"flex flex-wrap gap-4 justify-center",children:[r.jsxs(se,{variant:"secondary",onClick:b,children:[r.jsx(J,{name:"upload-cloud",className:"mr-2"})," Backup to Drive"]}),r.jsxs(se,{variant:"secondary",onClick:j,children:[r.jsx(J,{name:"download",className:"mr-2"})," Restore from Drive"]}),r.jsx(se,{variant:"danger",onClick:g,children:"Sign Out"})]})]}):r.jsxs("div",{className:"text-center",children:[r.jsx("p",{className:"text-text-muted mb-4",children:"Sign in with your Google account to back up and restore your data to a private folder in your Google Drive."}),r.jsxs(se,{variant:"primary",onClick:S,className:"inline-flex items-center gap-2",children:[r.jsx(J,{name:"google",className:"w-5 h-5"}),"Sign in with Google"]})]}):r.jsx("p",{className:"text-text-muted text-center",children:"Loading Google Drive services..."})})]}),r.jsxs(ya,{value:"cache-management",className:"border border-border rounded-lg overflow-hidden",children:[r.jsx(va,{children:r.jsx("h2",{className:"text-2xl font-semibold text-text",children:"Cache Management"})}),r.jsxs(wa,{className:"bg-surface p-6 space-y-4",children:[r.jsx("p",{className:"text-sm text-text-muted text-center w-full",children:"Clearing the cache can resolve issues by forcing the app to download the latest files. This does not affect your saved data."}),r.jsxs("div",{className:"flex flex-wrap gap-4 justify-center",children:[r.jsxs(se,{variant:"secondary",onClick:O,children:[r.jsx(J,{name:"refresh-ccw",className:"mr-2"})," Clear App Cache"]}),r.jsxs(se,{variant:"secondary",onClick:R,children:[r.jsx(J,{name:"download",className:"mr-2"})," Clear CDN Cache"]})]})]})]})]}),r.jsxs("div",{className:"bg-red-900/20 border border-red-500/30 rounded-lg p-6",children:[r.jsx("h2",{className:"text-xl font-semibold text-red-400 dark:text-red-300",children:"Danger Zone"}),r.jsx("p",{className:"text-red-500/80 dark:text-red-300/80 mb-4",children:"This will permanently delete all your decks, folders, and progress. This action cannot be undone."}),r.jsxs(se,{variant:"danger",onClick:p,children:[r.jsx(J,{name:"broom",className:"mr-2"})," Factory Reset"]})]})]})},Ix=({card:n,onClose:i,onSave:o})=>{const[p,d]=M.useState(""),[c,l]=M.useState(""),[f,v]=M.useState(""),{addToast:h}=Kt(),C=M.useRef(null);Pt(C,!0),M.useEffect(()=>{n&&(d(n.front),l(n.back),v(n.css||""))},[n]);const k=x=>{if(x.preventDefault(),!p.trim()||!c.trim()){h("Both front and back fields are required.","error");return}o({id:(n==null?void 0:n.id)||"",front:p.trim(),back:c.trim(),css:f.trim()})},I=x=>{if(x.key==="Tab"){x.preventDefault();const S=x.target,g=S.selectionStart,b=S.selectionEnd;S.value=S.value.substring(0,g)+"	"+S.value.substring(b),S.selectionStart=S.selectionEnd=g+1}};return r.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-75 flex items-center justify-center z-[60] p-4",children:r.jsx("div",{ref:C,className:"bg-surface rounded-lg shadow-xl w-full max-w-2xl transform transition-all relative",children:r.jsxs("form",{onSubmit:k,children:[r.jsxs("div",{className:"flex justify-between items-center p-4 border-b border-border",children:[r.jsx("h2",{className:"text-xl font-bold",children:n?"Edit Card":"Add New Card"}),r.jsx(se,{type:"button",variant:"ghost",onClick:i,className:"p-1 h-auto",children:r.jsx(J,{name:"x"})})]}),r.jsxs("div",{className:"p-6 space-y-4",children:[r.jsxs("div",{children:[r.jsx("label",{htmlFor:"card-front",className:"block text-sm font-medium text-text-muted mb-1",children:"Front"}),r.jsx("textarea",{id:"card-front",value:p,onChange:x=>d(x.target.value),onKeyDown:I,rows:5,className:"w-full p-2 bg-background border border-border rounded-md focus:ring-2 focus:ring-primary focus:outline-none",placeholder:"Enter front content (question, term, etc.)"})]}),r.jsxs("div",{children:[r.jsx("label",{htmlFor:"card-back",className:"block text-sm font-medium text-text-muted mb-1",children:"Back"}),r.jsx("textarea",{id:"card-back",value:c,onChange:x=>l(x.target.value),onKeyDown:I,rows:5,className:"w-full p-2 bg-background border border-border rounded-md focus:ring-2 focus:ring-primary focus:outline-none",placeholder:"Enter back content (answer, definition, etc.)"})]}),r.jsxs("details",{className:"space-y-2",children:[r.jsx("summary",{className:"cursor-pointer text-sm font-medium text-primary hover:underline",children:"Advanced CSS Styling"}),r.jsxs("div",{className:"pt-2",children:[r.jsx("label",{htmlFor:"card-css",className:"block text-sm font-medium text-text-muted mb-1",children:"Custom CSS"}),r.jsx("textarea",{id:"card-css",value:f,onChange:x=>v(x.target.value),onKeyDown:I,rows:5,className:"w-full p-2 bg-background border border-border rounded-md focus:ring-2 focus:ring-primary focus:outline-none font-mono text-xs",placeholder:".card { color: blue; }"}),r.jsx("p",{className:"text-xs text-text-muted mt-1",children:"CSS is applied directly to the card. Useful for Anki imports."})]})]})]}),r.jsxs("div",{className:"flex justify-end p-4 bg-background/50 border-t border-border",children:[r.jsx(se,{type:"button",variant:"secondary",onClick:i,className:"mr-2",children:"Cancel"}),r.jsx(se,{type:"submit",variant:"primary",children:n?"Save Changes":"Add Card"})]})]})})})},Ri=({isOpen:n,onClose:i,onConfirm:o,title:p,message:d,confirmText:c})=>{const[l,f]=M.useState(""),[v,h]=M.useState(!1),C=M.useRef(null);Pt(C,n),M.useEffect(()=>{n&&(f(""),h(!1))},[n]);const k=!c||l===c,I=async()=>{if(k){h(!0);try{await Promise.resolve(o()),C.current&&i()}catch(x){console.error("Confirmation action failed:",x)}finally{C.current&&h(!1)}}};return n?r.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-75 flex items-center justify-center z-[60] p-4",children:r.jsxs("div",{ref:C,className:"bg-surface rounded-lg shadow-xl w-full max-w-md transform transition-all relative",role:"alertdialog","aria-modal":"true","aria-labelledby":"confirm-title","aria-describedby":"confirm-message",children:[r.jsxs("div",{className:"flex justify-between items-center p-4 border-b border-border",children:[r.jsx("h2",{id:"confirm-title",className:"text-xl font-bold text-text",children:p}),r.jsx(se,{type:"button",variant:"ghost",onClick:i,className:"p-1 h-auto","aria-label":"Close",disabled:v,children:r.jsx(J,{name:"x"})})]}),r.jsxs("div",{className:"p-6 space-y-4",children:[r.jsx("p",{id:"confirm-message",className:"text-text-muted",children:d}),c&&r.jsxs("div",{children:[r.jsxs("label",{htmlFor:"confirm-input",className:"block text-sm font-medium text-text-muted mb-1",children:['To confirm, type "',r.jsx("strong",{className:"text-text",children:c}),'" below:']}),r.jsx("input",{id:"confirm-input",type:"text",value:l,onChange:x=>f(x.target.value),className:"w-full p-2 bg-background border border-border rounded-md focus:ring-2 focus:ring-red-500 focus:outline-none",disabled:v})]})]}),r.jsxs("div",{className:"flex justify-end p-4 bg-background/50 border-t border-border",children:[r.jsx(se,{type:"button",variant:"secondary",onClick:i,className:"mr-2",disabled:v,children:"Cancel"}),r.jsx(se,{type:"button",variant:"danger",onClick:I,disabled:!k||v,children:v?r.jsx(Bt,{size:"sm"}):c||"Confirm"})]})]})}):null},Dx=n=>{const i=new Date;i.setHours(0,0,0,0);const o=new Date(n);o.setHours(0,0,0,0);const p=o.getTime()-i.getTime(),d=Math.round(p/(1e3*60*60*24)),c=d<=0;let l;return d<0?l="Due":d===0?l="Due today":d===1?l="Due tomorrow":l=`Due in ${d} days`,{text:l,isDue:c}},Tx=({cards:n,onCardsChange:i,onAddCard:o,onBulkAdd:p})=>{const[d,c]=M.useState(null),[l,f]=M.useState(!1),[v,h]=M.useState(null),[C,k]=M.useState(!0),I=M.useRef(null),x=(R,A)=>{c(R),A&&(I.current=A.currentTarget),f(!0)},S=()=>{var R;f(!1),(R=I.current)==null||R.focus(),c(null)},g=(R,A)=>{h(R),A&&(I.current=A.currentTarget)},b=()=>{v&&i(n.filter(R=>R.id!==v.id)),h(null)},j=R=>{d?i(n.map(A=>A.id===R.id?{...A,...R}:A)):o(R),S()},O=R=>{i(n.map(A=>A.id===R?{...A,suspended:!1}:A))};return r.jsxs("div",{children:[r.jsx("div",{className:"border-b border-border",children:r.jsxs("button",{onClick:()=>k(!C),className:"w-full flex justify-between items-center text-left p-6","aria-expanded":C,"aria-controls":"card-list-content",children:[r.jsx("h3",{className:"text-xl font-semibold text-text",children:"Cards"}),r.jsx(J,{name:"chevron-down",className:`w-6 h-6 transition-transform duration-300 ${C?"":"-rotate-90"} text-text-muted`})]})}),C&&r.jsxs("div",{id:"card-list-content",className:"animate-fade-in",children:[r.jsx("div",{className:"p-6",children:n.length>0?r.jsx("ul",{className:"space-y-4",children:n.map(R=>{const{text:A,isDue:T}=Dx(R.dueDate);return r.jsxs("li",{className:`p-4 rounded-lg flex items-start justify-between transition-all ${R.suspended?"bg-yellow-500/10 opacity-70":"bg-background"}`,children:[r.jsxs("div",{className:"flex-1 min-w-0 mr-4",children:[r.jsxs("p",{className:"text-sm font-medium text-text truncate",children:[r.jsx("strong",{children:"Front:"})," ",R.front.replace(/<[^>]+>/g,"")]}),r.jsxs("p",{className:"text-sm text-text-muted truncate",children:[r.jsx("strong",{children:"Back:"})," ",R.back.replace(/<[^>]+>/g,"")]}),r.jsxs("div",{className:"mt-3 space-y-2",children:[r.jsx(ns,{level:nn(R)}),r.jsx("div",{className:"flex items-center gap-4 text-xs text-text-muted",children:r.jsxs("span",{className:`font-semibold ${T?"text-primary":""}`,children:[r.jsx(J,{name:"zap",className:"w-3 h-3 inline-block mr-1"}),A]})})]})]}),r.jsxs("div",{className:"flex-shrink-0 flex items-center gap-2",children:[R.suspended?r.jsx(se,{variant:"ghost",className:"p-2 h-auto text-yellow-600 dark:text-yellow-400",onClick:()=>O(R.id),title:"Unsuspend this card",children:r.jsx(J,{name:"eye",className:"w-4 h-4"})}):r.jsx(se,{variant:"ghost",className:"p-2 h-auto",onClick:P=>x(R,P),title:"Edit this card",children:r.jsx(J,{name:"edit",className:"w-4 h-4"})}),r.jsx(se,{variant:"ghost",className:"p-2 h-auto text-text-muted hover:text-red-500",onClick:P=>g(R,P),title:"Delete this card",children:r.jsx(J,{name:"trash-2",className:"w-4 h-4"})})]})]},R.id)})}):r.jsxs("div",{className:"text-center text-text-muted py-8",children:[r.jsx(J,{name:"laptop",className:"w-12 h-12 mx-auto mb-2 opacity-50"}),r.jsx("p",{children:"This deck has no cards yet."})]})}),r.jsxs("div",{className:"px-6 py-4 border-t border-border flex flex-wrap gap-2",children:[r.jsxs(se,{variant:"secondary",onClick:R=>x(null,R),className:"flex-grow sm:flex-grow-0",children:[r.jsx(J,{name:"plus",className:"w-5 h-5 mr-2"}),"Add New Card"]}),r.jsxs(se,{variant:"ghost",onClick:p,className:"flex-grow sm:flex-grow-0",children:[r.jsx(J,{name:"code",className:"w-5 h-5 mr-2"}),"Bulk Add via JSON"]})]})]}),l&&r.jsx(Ix,{card:d,onClose:S,onSave:j}),v&&r.jsx(Ri,{isOpen:!!v,onClose:()=>h(null),onConfirm:b,title:"Delete Card",message:"Are you sure you want to delete this card? This action cannot be undone."})]})},Ax=({question:n,onClose:i,onSave:o})=>{const[p,d]=M.useState(""),[c,l]=M.useState(""),[f,v]=M.useState([]),[h,C]=M.useState(""),[k,I]=M.useState([]),[x,S]=M.useState(""),[g,b]=M.useState(new Set),{addToast:j}=Kt(),O=M.useRef(null);Pt(O,!0),M.useEffect(()=>{if(n)d(n.questionText),l(n.detailedExplanation),v(n.options.map(Y=>({...Y}))),C(n.correctAnswerId),I(n.tags||[]);else{const Y=[{id:crypto.randomUUID(),text:""},{id:crypto.randomUUID(),text:""}];v(Y),I([])}},[n]);const R=(Y,q,Q)=>{v(f.map(N=>N.id===Y?{...N,[q]:Q}:N))},A=Y=>{b(q=>{const Q=new Set(q);return Q.has(Y)?Q.delete(Y):Q.add(Y),Q})},T=()=>{v([...f,{id:crypto.randomUUID(),text:""}])},P=Y=>{if(f.length<=2){j("A question must have at least two options.","error");return}v(f.filter(q=>q.id!==Y)),h===Y&&C("")},H=Y=>{S(Y.target.value)},K=Y=>{if(Y.key===","||Y.key==="Enter"){Y.preventDefault();const q=x.trim();q&&!k.includes(q)&&I([...k,q]),S("")}else Y.key==="Backspace"&&!x&&k.length>0&&I(k.slice(0,-1))},W=Y=>{I(k.filter(q=>q!==Y))},B=Y=>{if(Y.preventDefault(),!p.trim()){j("Question text is required.","error");return}if(f.some(q=>!q.text.trim())){j("All options must have text.","error");return}if(!h){j("You must select a correct answer.","error");return}o({id:n==null?void 0:n.id,questionText:p.trim(),detailedExplanation:c.trim(),options:f,correctAnswerId:h,tags:k})};return r.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-75 flex items-center justify-center z-[60] p-4",children:r.jsx("div",{ref:O,className:"bg-surface rounded-lg shadow-xl w-full max-w-3xl transform transition-all relative max-h-[90vh] flex flex-col",children:r.jsxs("form",{onSubmit:B,className:"flex flex-col h-full",children:[r.jsxs("div",{className:"flex-shrink-0 flex justify-between items-center p-4 border-b border-border",children:[r.jsx("h2",{className:"text-xl font-bold",children:n?"Edit Question":"Add New Question"}),r.jsx(se,{type:"button",variant:"ghost",onClick:i,className:"p-1 h-auto",children:r.jsx(J,{name:"x"})})]}),r.jsxs("div",{className:"p-6 space-y-4 overflow-y-auto",children:[r.jsxs("div",{children:[r.jsx("label",{htmlFor:"question-text",className:"block text-sm font-medium text-text-muted mb-1",children:"Question Text"}),r.jsx("textarea",{id:"question-text",value:p,onChange:Y=>d(Y.target.value),rows:3,className:"w-full p-2 bg-background border border-border rounded-md focus:ring-2 focus:ring-primary focus:outline-none",placeholder:"What is the capital of France?"})]}),r.jsxs("div",{children:[r.jsx("label",{className:"block text-sm font-medium text-text-muted mb-1",children:"Options"}),r.jsx("div",{className:"space-y-2",children:f.map((Y,q)=>r.jsxs("div",{children:[r.jsxs("div",{className:"flex items-center gap-2",children:[r.jsx("input",{type:"radio",name:"correct-answer",checked:h===Y.id,onChange:()=>C(Y.id),className:"h-5 w-5 text-primary bg-border/50 border-border focus:ring-primary","aria-label":`Set option ${q+1} as correct`}),r.jsx("input",{type:"text",value:Y.text,onChange:Q=>R(Y.id,"text",Q.target.value),className:"flex-grow p-2 bg-background border border-border rounded-md focus:ring-2 focus:ring-primary focus:outline-none",placeholder:`Option ${q+1}`}),r.jsx(se,{type:"button",variant:"ghost",onClick:()=>A(Y.id),className:`p-2 h-auto ${g.has(Y.id)||Y.explanation?"text-primary":"text-text-muted"}`,"aria-label":`Add explanation for option ${q+1}`,children:r.jsx(J,{name:"info",className:"w-4 h-4"})}),r.jsx(se,{type:"button",variant:"ghost",onClick:()=>P(Y.id),className:"p-2 h-auto","aria-label":`Remove option ${q+1}`,children:r.jsx(J,{name:"trash-2",className:"w-4 h-4"})})]}),g.has(Y.id)&&r.jsx("div",{className:"pl-7 mt-1 animate-fade-in",children:r.jsx("textarea",{value:Y.explanation||"",onChange:Q=>R(Y.id,"explanation",Q.target.value),rows:2,className:"w-full p-2 bg-background border border-border rounded-md focus:ring-2 focus:ring-primary focus:outline-none text-sm",placeholder:"Optional: Explain why this option is correct or incorrect..."})})]},Y.id))}),r.jsxs(se,{type:"button",variant:"ghost",onClick:T,className:"mt-2 text-primary",children:[r.jsx(J,{name:"plus",className:"w-4 h-4 mr-2"}),"Add Option"]})]}),r.jsxs("div",{children:[r.jsx("label",{htmlFor:"tags-input",className:"block text-sm font-medium text-text-muted mb-1",children:"Tags (Optional)"}),r.jsxs("div",{className:"flex flex-wrap items-center gap-2 w-full p-2 bg-background border border-border rounded-md focus-within:ring-2 focus-within:ring-primary",children:[k.map((Y,q)=>r.jsxs("span",{className:"flex items-center gap-1 bg-border/50 text-text-muted text-sm px-2 py-0.5 rounded-md",children:[Y,r.jsx("button",{type:"button",onClick:()=>W(Y),className:"text-text-muted hover:text-text",children:r.jsx(J,{name:"x",className:"w-3 h-3"})})]},q)),r.jsx("input",{id:"tags-input",type:"text",value:x,onChange:H,onKeyDown:K,className:"flex-grow bg-transparent focus:outline-none min-w-[100px]",placeholder:"Add a tag..."})]}),r.jsx("p",{className:"text-xs text-text-muted mt-1",children:"Separate tags with a comma or Enter. Use Backspace to delete the last tag."})]}),r.jsxs("div",{children:[r.jsx("label",{htmlFor:"detailed-explanation",className:"block text-sm font-medium text-text-muted mb-1",children:"Detailed Explanation (Optional)"}),r.jsx("textarea",{id:"detailed-explanation",value:c,onChange:Y=>l(Y.target.value),rows:4,className:"w-full p-2 bg-background border border-border rounded-md focus:ring-2 focus:ring-primary focus:outline-none",placeholder:"Explain why the correct answer is right and others are wrong."})]})]}),r.jsxs("div",{className:"flex-shrink-0 flex justify-end p-4 bg-background/50 border-t border-border",children:[r.jsx(se,{type:"button",variant:"secondary",onClick:i,className:"mr-2",children:"Cancel"}),r.jsx(se,{type:"submit",variant:"primary",children:n?"Save Changes":"Add Question"})]})]})})})},hr=n=>{if(!n)return"";try{return new DOMParser().parseFromString(n,"text/html").body.textContent||""}catch{return String(n).replace(/<[^>]+>/g,"")}},Ox=n=>{const i=new Date;i.setHours(0,0,0,0);const o=new Date(n);o.setHours(0,0,0,0);const p=o.getTime()-i.getTime(),d=Math.round(p/(1e3*60*60*24)),c=d<=0;let l;return d<0?l="Due":d===0?l="Due today":d===1?l="Due tomorrow":l=`Due in ${d} days`,{text:l,isDue:c}},Rx=({questions:n,onQuestionsChange:i,onAddQuestion:o,onBulkAdd:p,onGenerateAI:d,isGeneratingAI:c})=>{const[l,f]=M.useState(null),[v,h]=M.useState(!1),[C,k]=M.useState(null),[I,x]=M.useState(!0),[S,g]=M.useState(null),b=M.useRef(null),j=M.useRef(null),{aiFeaturesEnabled:O}=rn();M.useEffect(()=>{const B=Y=>{j.current&&!j.current.contains(Y.target)&&g(null)};return S&&document.addEventListener("mousedown",B),()=>{document.removeEventListener("mousedown",B)}},[S]);const R=(B,Y)=>{f(B),Y&&(b.current=Y.currentTarget),h(!0)},A=()=>{var B;h(!1),(B=b.current)==null||B.focus(),f(null)},T=(B,Y)=>{k(B),Y&&(b.current=Y.currentTarget)},P=()=>{C&&i(n.filter(B=>B.id!==C.id)),k(null)},H=B=>{if(l&&B.id)i(n.map(Y=>Y.id===B.id?{...Y,...B}:Y));else{const{id:Y,...q}=B,Q={...q,questionType:"multipleChoice",suspended:!1};o(Q)}A()},K=B=>{i(n.map(Y=>Y.id===B?{...Y,suspended:!0}:Y)),g(null)},W=B=>{i(n.map(Y=>Y.id===B?{...Y,suspended:!1}:Y)),g(null)};return r.jsxs("div",{children:[r.jsx("div",{className:"border-b border-border",children:r.jsxs("button",{onClick:()=>x(!I),className:"w-full flex justify-between items-center text-left p-6","aria-expanded":I,"aria-controls":"question-list-content",children:[r.jsx("h3",{className:"text-xl font-semibold text-text",children:"Questions"}),r.jsx(J,{name:"chevron-down",className:`w-6 h-6 transition-transform duration-300 ${I?"":"-rotate-90"} text-text-muted`})]})}),I&&r.jsxs("div",{id:"question-list-content",className:"animate-fade-in",children:[r.jsx("div",{className:"p-6",children:n.length>0?r.jsx("ul",{className:"space-y-4",children:n.map(B=>{const{text:Y,isDue:q}=Ox(B.dueDate),Q=hr(B.questionText);return r.jsxs("li",{className:`p-4 rounded-lg flex items-start justify-between transition-all ${B.suspended?"bg-yellow-500/10 opacity-70":"bg-background"}`,children:[r.jsxs("div",{className:"flex-1 min-w-0 mr-4",children:[r.jsx("p",{className:"text-base font-medium text-text break-words truncate",title:Q,children:Q}),r.jsxs("div",{className:"mt-3 space-y-2",children:[r.jsx(ns,{level:nn(B)}),r.jsxs("div",{className:"flex items-center gap-4 text-xs text-text-muted",children:[r.jsxs("span",{className:`font-semibold ${q?"text-primary":""}`,children:[r.jsx(J,{name:"zap",className:"w-3 h-3 inline-block mr-1"}),Y]}),r.jsxs("span",{children:[r.jsx(J,{name:"list",className:"w-3 h-3 inline-block mr-1"}),B.options.length," options"]})]}),B.tags&&B.tags.length>0&&r.jsx("div",{className:"flex flex-wrap items-center gap-1 mt-2",children:B.tags.map(N=>r.jsx("span",{className:"bg-border/50 text-text-muted text-xs px-2 py-0.5 rounded-full",children:N},N))})]})]}),r.jsxs("div",{className:"flex-shrink-0 relative",ref:S===B.id?j:null,children:[r.jsx(se,{variant:"ghost",className:"p-2 h-auto",onClick:N=>{N.stopPropagation(),g(Z=>Z===B.id?null:B.id)},"aria-label":"More options for question",children:r.jsx(J,{name:"more-vertical",className:"w-5 h-5"})}),S===B.id&&r.jsxs("div",{className:"absolute right-0 mt-2 w-48 bg-surface rounded-md shadow-lg py-1 z-10 ring-1 ring-black ring-opacity-5 animate-fade-in",style:{animationDuration:"150ms"},children:[r.jsxs("button",{type:"button",onClick:N=>{R(B,N),g(null)},className:"flex items-center w-full px-4 py-2 text-sm text-left text-text hover:bg-border/20",children:[r.jsx(J,{name:"edit",className:"w-4 h-4 mr-3"}),"Edit"]}),B.suspended?r.jsxs("button",{type:"button",onClick:()=>W(B.id),className:"flex items-center w-full px-4 py-2 text-sm text-left text-text hover:bg-border/20",children:[r.jsx(J,{name:"eye",className:"w-4 h-4 mr-3"}),"Unsuspend"]}):r.jsxs("button",{type:"button",onClick:()=>K(B.id),className:"flex items-center w-full px-4 py-2 text-sm text-left text-text hover:bg-border/20",children:[r.jsx(J,{name:"eye-off",className:"w-4 h-4 mr-3"}),"Suspend"]}),r.jsx("div",{className:"border-t border-border my-1"}),r.jsxs("button",{type:"button",onClick:N=>{T(B,N),g(null)},className:"flex items-center w-full px-4 py-2 text-sm text-left text-red-600 dark:text-red-400 hover:bg-red-50 dark:hover:bg-red-900/20",children:[r.jsx(J,{name:"trash-2",className:"w-4 h-4 mr-3"}),"Delete"]})]})]})]},B.id)})}):r.jsxs("div",{className:"text-center text-text-muted py-8",children:[r.jsx(J,{name:"help-circle",className:"w-12 h-12 mx-auto mb-2 opacity-50"}),r.jsx("p",{children:"This deck has no questions yet."})]})}),r.jsxs("div",{className:"px-6 py-4 border-t border-border flex flex-wrap gap-2",children:[r.jsxs(se,{variant:"secondary",onClick:B=>R(null,B),className:"flex-grow sm:flex-grow-0",children:[r.jsx(J,{name:"plus",className:"w-5 h-5 mr-2"}),"Add New Question"]}),r.jsxs(se,{variant:"ghost",onClick:p,className:"flex-grow sm:flex-grow-0",children:[r.jsx(J,{name:"code",className:"w-5 h-5 mr-2"}),"Bulk Add via JSON"]}),O&&d&&r.jsxs(se,{variant:"ghost",onClick:d,className:"flex-grow sm:flex-grow-0",disabled:c,children:[c?r.jsx(Bt,{size:"sm"}):r.jsx(J,{name:"zap",className:"w-5 h-5 mr-2"}),c?"Generating...":"Generate with AI"]})]})]}),v&&r.jsx(Ax,{question:l,onClose:A,onSave:H}),C&&r.jsx(Ri,{isOpen:!!C,onClose:()=>k(null),onConfirm:P,title:"Delete Question",message:"Are you sure you want to delete this question? This action cannot be undone."})]})},Mx=({isOpen:n,onClose:i,onAddItems:o,deckType:p})=>{const[d,c]=M.useState(""),{addToast:l}=Kt(),f=M.useRef(null);Pt(f,n);const v=M.useMemo(()=>p===De.Flashcard?`[
  {
    "front": "What is the capital of Japan?",
    "back": "Tokyo"
  },
  {
    "front": "What is 2 + 2?",
    "back": "4"
  }
]`:`[
  {
    "questionText": "Which planet is known as the Red Planet?",
    "options": [
      { "id": "1", "text": "Earth" },
      { "id": "2", "text": "Mars" }
    ],
    "correctAnswerId": "2",
    "detailedExplanation": "Mars is called the Red Planet because of its reddish appearance."
  }
]`,[p]),h=k=>{if(k.preventDefault(),!d.trim()){l("JSON content cannot be empty.","error");return}try{const I=eg(d,p);if(I.length===0){l("The JSON array is empty. No items were added.","info"),i();return}o(I),l(`Successfully added ${I.length} item(s).`,"success"),i()}catch(I){l(I instanceof Error?I.message:"Invalid JSON format.","error")}},C=k=>{if(k.key==="Tab"){k.preventDefault();const I=k.target,x=I.selectionStart,S=I.selectionEnd;I.value=I.value.substring(0,x)+"  "+I.value.substring(S),I.selectionStart=I.selectionEnd=x+2}};return n?r.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-75 flex items-center justify-center z-[60] p-4",children:r.jsx("div",{ref:f,className:"bg-surface rounded-lg shadow-xl w-full max-w-2xl transform transition-all relative",children:r.jsxs("form",{onSubmit:h,children:[r.jsxs("div",{className:"flex justify-between items-center p-4 border-b border-border",children:[r.jsx("h2",{className:"text-xl font-bold",children:"Bulk Add via JSON"}),r.jsx(se,{type:"button",variant:"ghost",onClick:i,className:"p-1 h-auto",children:r.jsx(J,{name:"x"})})]}),r.jsxs("div",{className:"p-6",children:[r.jsxs("div",{className:"flex justify-between items-baseline mb-1",children:[r.jsxs("label",{htmlFor:"json-content",className:"block text-sm font-medium text-text-muted",children:["Paste an array of ",p===De.Flashcard?"card":"question"," objects"]}),r.jsxs(Tt,{href:"/instructions/json",onClick:i,className:"text-sm text-primary hover:underline inline-flex items-center gap-1",children:[r.jsx(J,{name:"help-circle",className:"w-4 h-4"}),"Format Guide"]})]}),r.jsx("textarea",{id:"json-content",value:d,onChange:k=>c(k.target.value),onKeyDown:C,rows:15,className:"w-full p-2 bg-background border border-border rounded-md focus:ring-2 focus:ring-primary focus:outline-none font-mono text-sm",placeholder:v})]}),r.jsxs("div",{className:"flex justify-end p-4 bg-background/50 border-t border-border",children:[r.jsx(se,{type:"button",variant:"secondary",onClick:i,className:"mr-2",children:"Cancel"}),r.jsx(se,{type:"submit",variant:"primary",children:"Add Items"})]})]})})}):null},Lx=({data:n,total:i})=>i===0?r.jsx("div",{className:"w-full bg-gray-200 dark:bg-gray-700 rounded-full h-4"}):r.jsx("div",{className:"flex w-full h-4 bg-gray-200 dark:bg-gray-700 rounded-full overflow-hidden",role:"progressbar","aria-valuenow":n.reduce((o,p)=>o+p.value,0),"aria-valuemin":0,"aria-valuemax":i,children:n.map((o,p)=>{if(o.value===0)return null;const d=o.value/i*100;return r.jsx("div",{className:`${o.color} transition-all duration-500`,style:{width:`${d}%`},title:`${o.label}: ${o.value} item(s)`},p)})}),Fx=({data:n})=>{const i=Math.max(...n.map(h=>h.count),1),o=350,p=120,d={top:25,right:15,bottom:25,left:15},c=o-d.left-d.right,l=p-d.top-d.bottom,f=c/n.length,v=Math.max(6,f*.1);return r.jsxs("div",{className:"w-full",children:[r.jsx("h4",{className:"text-sm font-semibold text-gray-700 dark:text-gray-300 mb-2",children:"Upcoming Due Dates (Next 7 Days)"}),r.jsx("div",{className:"bg-gray-50 dark:bg-gray-900/50 p-2 rounded-lg border border-gray-200 dark:border-gray-700/50",children:r.jsxs("svg",{viewBox:`0 0 ${o} ${p}`,width:"100%",height:"auto","aria-labelledby":"due-date-graph-title",role:"img",className:"overflow-visible",children:[r.jsx("title",{id:"due-date-graph-title",children:"A bar chart showing the number of items due over the next 7 days."}),n.map((h,C)=>{const k=h.count>0?h.count/i*l:0,I=d.left+C*f+(f-v)/2,x=d.top+l-k;return r.jsxs("g",{className:"group",style:{cursor:"pointer"},children:[r.jsxs("title",{children:[h.date,": ",h.count," item",h.count!==1?"s":""," due"]}),r.jsx("rect",{x:I,y:x,width:v,height:k,rx:"2",className:"fill-blue-500 transition-colors group-hover:fill-blue-400"}),r.jsx("text",{x:I+v/2,y:x-6,textAnchor:"middle",className:"fill-gray-600 dark:fill-gray-300 font-semibold text-sm transition-opacity opacity-0 group-hover:opacity-100 pointer-events-none",children:h.count}),r.jsx("text",{x:I+v/2,y:p-d.bottom+15,textAnchor:"middle",className:"fill-gray-400 dark:fill-gray-500 text-xs pointer-events-none",children:h.dayLabel})]},C)})]})})]})},Px=({reviews:n})=>{const[i,o]=M.useState(null),p=M.useMemo(()=>{if(!n||n.length===0)return[];const g=new Map;n.forEach(j=>{const O=new Date(j.timestamp).toISOString().split("T")[0],R=g.get(O)||{totalMastery:0,count:0};R.totalMastery+=j.masteryLevel,R.count++,g.set(O,R)});const b=Array.from(g.entries()).map(([j,{totalMastery:O,count:R}])=>({date:new Date(j),avgMastery:O/R}));return b.sort((j,O)=>j.date.getTime()-O.date.getTime()),b.slice(-90)},[n]);if(p.length<2)return r.jsx("div",{className:"text-center text-sm text-text-muted py-8",children:"Not enough review history to plot a graph."});const d=350,c=150,l={top:10,right:10,bottom:20,left:30},f=d-l.left-l.right,v=c-l.top-l.bottom,h=p[0].date.getTime(),C=p[p.length-1].date.getTime(),k=g=>(g.getTime()-h)/(C-h)*f+l.left,I=g=>c-l.bottom-g*v,x=p.map(g=>`${k(g.date)},${I(g.avgMastery)}`).join(" L "),S=g=>{const b=g.currentTarget.getBoundingClientRect(),j=g.clientX-b.left;let O=p[0],R=1/0;p.forEach(A=>{const T=k(A.date),P=Math.abs(j-T);P<R&&(R=P,O=A)}),R<20?o({x:k(O.date),y:I(O.avgMastery),data:O}):o(null)};return r.jsx("div",{className:"w-full",children:r.jsxs("svg",{viewBox:`0 0 ${d} ${c}`,width:"100%",height:"auto","aria-labelledby":"mastery-graph-title",role:"img",className:"overflow-visible",onMouseMove:S,onMouseLeave:()=>o(null),children:[r.jsx("title",{id:"mastery-graph-title",children:"A line chart showing average mastery over time."}),[0,.25,.5,.75,1].map(g=>r.jsxs("g",{children:[r.jsx("line",{x1:l.left,y1:I(g),x2:d-l.right,y2:I(g),className:"stroke-current text-border/70",strokeWidth:"0.5"}),r.jsx("text",{x:l.left-8,y:I(g)+4,textAnchor:"end",className:"text-xs fill-text-muted",children:`${g*100}%`})]},g)),r.jsx("text",{x:l.left,y:c-5,textAnchor:"start",className:"text-xs fill-text-muted",children:p[0].date.toLocaleDateString("en-us",{month:"short",day:"numeric"})}),r.jsx("text",{x:d-l.right,y:c-5,textAnchor:"end",className:"text-xs fill-text-muted",children:p[p.length-1].date.toLocaleDateString("en-us",{month:"short",day:"numeric"})}),r.jsx("path",{d:`M ${x}`,className:"stroke-primary",fill:"none",strokeWidth:"2",strokeLinejoin:"round",strokeLinecap:"round"}),i&&r.jsxs("g",{children:[r.jsx("line",{x1:i.x,y1:l.top,x2:i.x,y2:c-l.bottom,className:"stroke-current text-border",strokeDasharray:"2,2"}),r.jsx("circle",{cx:i.x,cy:i.y,r:"4",className:"fill-primary"}),r.jsxs("g",{transform:`translate(${i.x>d/2?i.x-100:i.x+10}, ${l.top})`,children:[r.jsx("rect",{x:"0",y:"0",width:"90",height:"35",rx:"4",className:"fill-surface opacity-90",stroke:"rgb(var(--color-border))"}),r.jsx("text",{x:"5",y:"15",className:"text-xs fill-text font-semibold",children:i.data.date.toLocaleDateString("en-us",{month:"short",day:"numeric"})}),r.jsxs("text",{x:"5",y:"30",className:"text-xs fill-text-muted",children:["Mastery: ",Math.round(i.data.avgMastery*100),"%"]})]})]})]})})},Ux=({block:n,onClose:i,onSave:o})=>{const[p,d]=M.useState(""),[c,l]=M.useState([]),{addToast:f}=Kt(),v=M.useRef(null);Pt(v,!0),M.useEffect(()=>{n?(d(n.infoCard.content),l(n.questions.map(b=>({...b})))):l([{id:crypto.randomUUID(),questionText:"",options:[{id:crypto.randomUUID(),text:""},{id:crypto.randomUUID(),text:""}],correctAnswerId:"",detailedExplanation:""}])},[n]);const h=(b,j,O)=>{const R=[...c];R[b][j]=O,l(R)},C=(b,j,O)=>{const R=[...c];R[b].options&&(R[b].options[j].text=O,l(R))},k=()=>{l([...c,{id:crypto.randomUUID(),questionText:"",options:[{id:crypto.randomUUID(),text:""},{id:crypto.randomUUID(),text:""}],correctAnswerId:"",detailedExplanation:""}])},I=b=>{if(c.length<=1){f("A learning block must have at least one question.","error");return}l(c.filter((j,O)=>O!==b))},x=b=>{var O;const j=[...c];(O=j[b].options)==null||O.push({id:crypto.randomUUID(),text:""}),l(j)},S=(b,j)=>{const O=[...c],R=O[b];if(R.options&&R.options.length>2){const A=R.options.splice(j,1)[0];R.correctAnswerId===A.id&&(R.correctAnswerId=""),l(O)}else f("A question must have at least two options.","error")},g=b=>{var A,T;if(b.preventDefault(),!p.trim()){f("Informational content cannot be empty.","error");return}for(const P of c){if(!((A=P.questionText)!=null&&A.trim())){f("Question text is required.","error");return}if((T=P.options)!=null&&T.some(H=>!H.text.trim())){f("All options must have text.","error");return}if(!P.correctAnswerId){f("You must select a correct answer for each question.","error");return}}const j=new Date().toISOString(),O={id:(n==null?void 0:n.infoCard.id)||crypto.randomUUID(),content:p,unlocksQuestionIds:c.map(P=>P.id)},R=c.map((P,H)=>{const K=n==null?void 0:n.questions[H];return{...K,...P,id:P.id,questionType:"multipleChoice",infoCardIds:[O.id],dueDate:(K==null?void 0:K.dueDate)||j,interval:(K==null?void 0:K.interval)||0,easeFactor:(K==null?void 0:K.easeFactor)||ts,tags:P.tags||[]}});o({infoCard:O,questions:R})};return r.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-75 flex items-center justify-center z-[60] p-4",children:r.jsx("div",{ref:v,className:"bg-surface rounded-lg shadow-xl w-full max-w-4xl transform transition-all relative max-h-[90vh] flex flex-col",children:r.jsxs("form",{onSubmit:g,className:"flex flex-col h-full",children:[r.jsxs("header",{className:"flex-shrink-0 flex justify-between items-center p-4 border-b border-border",children:[r.jsx("h2",{className:"text-xl font-bold",children:n?"Edit Learning Block":"Add New Learning Block"}),r.jsx(se,{type:"button",variant:"ghost",onClick:i,className:"p-1 h-auto",children:r.jsx(J,{name:"x"})})]}),r.jsxs("main",{className:"p-6 space-y-6 overflow-y-auto",children:[r.jsxs("div",{children:[r.jsx("label",{htmlFor:"info-content",className:"block text-sm font-bold text-text mb-1",children:"Informational Content (Supports HTML)"}),r.jsx("textarea",{id:"info-content",value:p,onChange:b=>d(b.target.value),rows:8,className:"w-full p-2 bg-background border border-border rounded-md focus:ring-2 focus:ring-primary focus:outline-none",placeholder:"Explain a concept here..."})]}),r.jsxs("div",{className:"border-t border-border pt-4",children:[r.jsx("h3",{className:"text-lg font-bold text-text mb-2",children:"Questions"}),r.jsxs("div",{className:"space-y-6",children:[c.map((b,j)=>{var O;return r.jsxs("div",{className:"p-4 bg-background rounded-lg border border-border space-y-3 relative",children:[r.jsxs("label",{className:"block text-sm font-medium text-text-muted",children:["Question ",j+1]}),r.jsx("textarea",{value:b.questionText,onChange:R=>h(j,"questionText",R.target.value),rows:2,className:"w-full p-2 bg-surface border border-border rounded-md focus:ring-2 focus:ring-primary focus:outline-none",placeholder:"Question related to the info above"}),r.jsx("div",{className:"space-y-2",children:(O=b.options)==null?void 0:O.map((R,A)=>r.jsxs("div",{className:"flex items-center gap-2",children:[r.jsx("input",{type:"radio",name:`correct-answer-${j}`,checked:b.correctAnswerId===R.id,onChange:()=>h(j,"correctAnswerId",R.id),className:"h-5 w-5 text-primary bg-border/50 border-border focus:ring-primary"}),r.jsx("input",{type:"text",value:R.text,onChange:T=>C(j,A,T.target.value),className:"flex-grow p-2 bg-surface border border-border rounded-md focus:ring-2 focus:ring-primary focus:outline-none",placeholder:`Option ${A+1}`}),r.jsx(se,{type:"button",variant:"ghost",onClick:()=>S(j,A),className:"p-2 h-auto text-text-muted hover:text-red-500",children:r.jsx(J,{name:"x",className:"w-4 h-4"})})]},R.id||A))}),r.jsxs(se,{type:"button",variant:"ghost",onClick:()=>x(j),size:"sm",children:[r.jsx(J,{name:"plus",className:"w-4 h-4 mr-1"}),"Add Option"]}),r.jsx("textarea",{value:b.detailedExplanation,onChange:R=>h(j,"detailedExplanation",R.target.value),rows:2,className:"w-full p-2 bg-surface border border-border rounded-md focus:ring-2 focus:ring-primary focus:outline-none",placeholder:"Detailed explanation for the answer"}),r.jsx(se,{type:"button",variant:"ghost",onClick:()=>I(j),className:"absolute top-2 right-2 p-2 h-auto text-text-muted hover:text-red-500",children:r.jsx(J,{name:"trash-2",className:"w-4 h-4"})})]},b.id||j)}),r.jsxs(se,{type:"button",variant:"secondary",onClick:k,children:[r.jsx(J,{name:"plus",className:"w-4 h-4 mr-2"}),"Add Question"]})]})]})]}),r.jsxs("footer",{className:"flex-shrink-0 flex justify-end p-4 bg-background/50 border-t border-border",children:[r.jsx(se,{type:"button",variant:"secondary",onClick:i,className:"mr-2",children:"Cancel"}),r.jsx(se,{type:"submit",variant:"primary",children:n?"Save Changes":"Add Block"})]})]})})})},zx=({deck:n,onSaveBlock:i,onDeleteBlock:o,onBlockClick:p})=>{const[d,c]=M.useState(null),[l,f]=M.useState(!1),v=M.useRef(null),h=(x,S)=>{c(x),S&&(v.current=S.currentTarget),f(!0)},C=()=>{var x;f(!1),(x=v.current)==null||x.focus(),c(null)},k=x=>{i(x),C()},I=M.useMemo(()=>n.infoCards.map(x=>({infoCard:x,questions:n.questions.filter(S=>{var g;return(g=S.infoCardIds)==null?void 0:g.includes(x.id)})})),[n.infoCards,n.questions]);return r.jsxs("div",{children:[r.jsxs("div",{className:"border-b border-border p-6",children:[r.jsx("h3",{className:"text-xl font-semibold text-text",children:"Learning Blocks"}),r.jsx("p",{className:"text-sm text-text-muted mt-1",children:"Each block contains an info card and its related questions."})]}),r.jsx("div",{className:"p-6",children:I.length>0?r.jsx("ul",{className:"space-y-4",children:I.map(x=>r.jsx("li",{className:"p-4 rounded-lg bg-background border border-border transition-all duration-200 hover:border-primary hover:shadow-md cursor-pointer",onClick:()=>p(x),onKeyDown:S=>{(S.key==="Enter"||S.key===" ")&&p(x)},tabIndex:0,role:"button",children:r.jsxs("div",{className:"flex items-start justify-between",children:[r.jsxs("div",{className:"flex-1 min-w-0 mr-4",children:[r.jsxs("div",{className:"flex items-center gap-2 text-text font-semibold",children:[r.jsx(J,{name:"book-open",className:"w-5 h-5 text-purple-500 flex-shrink-0"}),r.jsx("p",{className:"truncate",title:hr(x.infoCard.content),children:hr(x.infoCard.content)})]}),x.questions.length>0&&r.jsx("ul",{className:"mt-2 pl-7 space-y-1",children:x.questions.map(S=>r.jsxs("li",{className:"flex items-center gap-2 text-sm text-text-muted",children:[r.jsx(J,{name:"help-circle",className:"w-4 h-4 flex-shrink-0"}),r.jsx("span",{className:"truncate",title:hr(S.questionText),children:hr(S.questionText)})]},S.id))})]}),r.jsxs("div",{className:"flex-shrink-0 flex items-center gap-1",children:[r.jsx(se,{variant:"ghost",className:"p-2 h-auto",onClick:S=>{S.stopPropagation(),h(x,S)},title:"Edit this block",children:r.jsx(J,{name:"edit",className:"w-4 h-4"})}),r.jsx(se,{variant:"ghost",className:"p-2 h-auto text-text-muted hover:text-red-500",onClick:S=>{S.stopPropagation(),o(x.infoCard.id)},title:"Delete this block",children:r.jsx(J,{name:"trash-2",className:"w-4 h-4"})})]})]})},x.infoCard.id))}):r.jsxs("div",{className:"text-center text-text-muted py-8",children:[r.jsx(J,{name:"layers",className:"w-12 h-12 mx-auto mb-2 opacity-50"}),r.jsx("p",{children:"This deck has no learning blocks yet."})]})}),r.jsx("div",{className:"px-6 py-4 border-t border-border flex flex-wrap gap-2",children:r.jsxs(se,{variant:"secondary",onClick:x=>h(null,x),className:"flex-grow sm:flex-grow-0",children:[r.jsx(J,{name:"plus",className:"w-5 h-5 mr-2"}),"Add Learning Block"]})}),l&&r.jsx(Ux,{block:d,onClose:C,onSave:k})]})},Bx=({isOpen:n,onClose:i,block:o})=>{const p=M.useRef(null);return Pt(p,n),!n||!o?null:r.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-75 flex items-center justify-center z-[60] p-4",children:r.jsxs("div",{ref:p,className:"bg-surface rounded-lg shadow-xl w-full max-w-3xl transform transition-all relative max-h-[90vh] flex flex-col",role:"dialog","aria-modal":"true","aria-labelledby":"block-detail-title",children:[r.jsxs("div",{className:"flex-shrink-0 flex justify-between items-center p-4 border-b border-border",children:[r.jsx("h2",{id:"block-detail-title",className:"text-xl font-bold text-text",children:"Learning Block Details"}),r.jsx(se,{type:"button",variant:"ghost",onClick:i,className:"p-1 h-auto","aria-label":"Close",children:r.jsx(J,{name:"x"})})]}),r.jsxs("div",{className:"p-6 overflow-y-auto space-y-6",children:[r.jsxs("div",{children:[r.jsx("h3",{className:"text-sm font-semibold uppercase tracking-wider text-text-muted mb-2",children:"Informational Content"}),r.jsx("div",{className:"p-4 bg-background rounded-lg border border-border",children:r.jsx(Xn,{html:o.infoCard.content,className:"prose dark:prose-invert max-w-none"})})]}),r.jsxs("div",{children:[r.jsxs("h3",{className:"text-sm font-semibold uppercase tracking-wider text-text-muted mb-2",children:["Associated Questions (",o.questions.length,")"]}),r.jsx("ul",{className:"space-y-3",children:o.questions.map(d=>r.jsxs("li",{className:"p-3 bg-background rounded-lg border border-border",children:[r.jsx("p",{className:"font-semibold text-text",dangerouslySetInnerHTML:{__html:d.questionText}}),r.jsx("ul",{className:"mt-2 pl-4 text-sm space-y-1",children:d.options.map(c=>r.jsxs("li",{className:`flex items-start gap-2 ${c.id===d.correctAnswerId?"text-green-600 dark:text-green-400 font-medium":"text-text-muted"}`,children:[c.id===d.correctAnswerId?r.jsx(J,{name:"check-circle",className:"w-4 h-4 flex-shrink-0 mt-0.5"}):r.jsx("div",{className:"w-4 h-4 flex-shrink-0"}),r.jsx("span",{dangerouslySetInnerHTML:{__html:c.text}})]},c.id))})]},d.id))})]})]}),r.jsx("div",{className:"flex-shrink-0 flex justify-end p-4 bg-background/50 border-t border-border",children:r.jsx(se,{type:"button",variant:"primary",onClick:i,children:"Close"})})]})})},Hx=n=>{const i=new Date;i.setHours(23,59,59,999);const o=n.type===De.Flashcard?n.cards:(n.type===De.Learning,n.questions);return Array.isArray(o)?o.filter(p=>!p.suspended&&new Date(p.dueDate)<=i).length:0},qx=n=>{const i={new:0,learning:0,young:0,mature:0};return n.forEach(o=>{o.interval===0?i.new++:o.interval<7?i.learning++:o.interval<21?i.young++:i.mature++}),i},$x=({deck:n})=>{const[i,o]=M.useState([]),[p,d]=M.useState(!0),c=n.type===De.Flashcard?n.cards:(n.type===De.Learning,n.questions);M.useEffect(()=>{(async()=>{d(!0);try{const v=await Bh(n.id);o(v)}catch(v){console.error("Failed to fetch review history for deck:",v)}finally{d(!1)}})()},[n.id]);const l=M.useMemo(()=>{if(!i.length)return[];const f=new Map;return i.forEach(v=>{v.rating===lt.Again&&f.set(v.itemId,(f.get(v.itemId)||0)+1)}),Array.from(f.entries()).sort((v,h)=>h[1]-v[1]).slice(0,5).map(([v,h])=>{const C=c.find(k=>k.id===v);return C?{...C,failureCount:h}:null}).filter(v=>!!v)},[i,c]);return p?r.jsx("div",{className:"flex justify-center items-center p-8",children:r.jsx(Bt,{})}):i.length===0?r.jsxs("div",{className:"text-center py-10 bg-surface rounded-lg border border-border",children:[r.jsx(J,{name:"trending-up",className:"w-12 h-12 mx-auto text-text-muted/50"}),r.jsx("h3",{className:"mt-2 text-xl font-medium text-text",children:"No Statistics Yet"}),r.jsx("p",{className:"mt-1 text-sm text-text-muted",children:"Complete a study session for this deck to see your stats."})]}):r.jsx("div",{className:"space-y-8",children:r.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-8",children:[r.jsxs("div",{className:"bg-surface p-6 rounded-lg shadow-md border border-border",children:[r.jsx("h3",{className:"text-xl font-semibold text-text mb-4",children:"Mastery Over Time"}),r.jsx("p",{className:"text-sm text-text-muted mb-4",children:"Average mastery level of reviewed cards per day over the last 90 days of activity."}),r.jsx(Px,{reviews:i})]}),r.jsxs("div",{className:"bg-surface p-6 rounded-lg shadow-md border border-border",children:[r.jsx("h3",{className:"text-xl font-semibold text-text mb-4",children:"Most Difficult Items"}),r.jsx("p",{className:"text-sm text-text-muted mb-4",children:`Items you've marked "Again" most frequently.`}),l.length>0?r.jsx("ul",{className:"space-y-3",children:l.map(f=>{const h=("questionText"in f?f.questionText:f.front).replace(/<[^>]+>/g,"").trim();return r.jsxs("li",{className:"p-3 bg-background rounded-md border border-border",children:[r.jsx("p",{className:"font-semibold text-sm text-text break-words truncate",title:h,children:h}),r.jsxs("p",{className:"text-xs text-red-500 font-medium",children:['Marked "Again" ',f.failureCount," time",f.failureCount>1?"s":""]})]},f.id)})}):r.jsx("p",{className:"text-sm text-text-muted",children:"No items have been repeatedly marked as difficult. Great job!"})]})]})})},Gx=({deck:n,sessionsToResume:i,onUpdateDeck:o,onDeleteDeck:p,onUpdateLastOpened:d,openConfirmModal:c,onGenerateQuestionsForDeck:l,onGenerateContentForLearningDeck:f,onCancelAIGeneration:v,onSaveLearningBlock:h,onDeleteLearningBlock:C})=>{var E,ge;const[k,I]=M.useState(!1),[x,S]=M.useState(n.name),[g,b]=M.useState(n.description||""),[j,O]=M.useState(n.folderId||""),[R,A]=M.useState(!1),[T,P]=M.useState("overview"),[H,K]=M.useState(!1),[W,B]=M.useState(null),{navigate:Y}=Cn(),{addToast:q}=Kt(),{aiFeaturesEnabled:Q}=rn(),{folders:N,aiGenerationStatus:Z}=at(),oe=n.type===De.Flashcard?n.cards:(n.type===De.Learning,n.questions);M.useEffect(()=>{d(n.id)},[n.id,d]),M.useEffect(()=>{(n.archived||n.deletedAt)&&Y("/")},[n.archived,n.deletedAt,Y]);const fe=()=>{o({...n,name:x,description:g,folderId:j||null}),I(!1)},ye=()=>{S(n.name),b(n.description||""),O(n.folderId||""),I(!1)},ue=re=>{if(n.type===De.Flashcard&&re.every($=>"front"in $)){const $=Kc(re),G=[...n.cards,...$];o({...n,cards:G})}else if((n.type===De.Quiz||n.type===De.Learning)&&re.every($=>"questionText"in $)){const $=ba(re),ee=[...n.questions,...$];o({...n,questions:ee})}},z=()=>{c({title:"Move Deck to Trash",message:`Are you sure you want to move the deck "${n.name}" to the trash? It will be permanently deleted after 10 days. This will also remove it from any series it belongs to.`,onConfirm:()=>p(n.id)})},_=re=>{B(re),K(!0)},F=((E=Z.currentTask)==null?void 0:E.deckId)===n.id,de=oe.filter(re=>!re.suspended),he=oe.length-de.length,ie=qx(de),be=Hx(n),Ne=i.has(n.id),Se=M.useMemo(()=>de.length===0?0:de.reduce(($,G)=>$+nn(G),0)/de.length,[de]),ke=M.useMemo(()=>{const re=new Date;re.setHours(0,0,0,0);const $=Array(7).fill(0),G=[],ee=[];for(let ce=0;ce<7;ce++){const le=new Date(re);le.setDate(re.getDate()+ce),ce===0?G.push("Today"):ce===1?G.push("Tom"):G.push(le.toLocaleDateString("en-US",{weekday:"short"})),ee.push(le.toLocaleDateString("en-US",{month:"short",day:"numeric"}));const ne=le.getTime();oe.forEach(je=>{if(je.suspended)return;const Me=new Date(je.dueDate);Me.setHours(0,0,0,0),Me.getTime()===ne&&$[ce]++})}return G.map((ce,le)=>({dayLabel:ce,count:$[le],date:ee[le]}))},[oe]),Ae=M.useMemo(()=>oe.length===0?"No Items to Study":n.locked?"Deck is Locked":n.type===De.Quiz||n.type===De.Learning?Ne?"Resume Quiz":`Start Quiz (${be} due)`:Ne?"Resume Study":`Study Cards (${be} due)`,[n.type,Ne,be,n.locked,oe.length]),Pe=[{value:ie.new,color:"bg-blue-500",label:"New"},{value:ie.learning,color:"bg-orange-500",label:"Learning"},{value:ie.young,color:"bg-teal-500",label:"Young"},{value:ie.mature,color:"bg-green-500",label:"Mature"}],Ye=re=>`px-4 py-2 text-sm font-medium transition-colors ${T===re?"border-b-2 border-primary text-text":"text-text-muted hover:text-text"}`,Re=(n.type===De.Quiz||n.type===De.Learning)&&oe.length===0;return r.jsxs("div",{className:"max-w-4xl mx-auto animate-fade-in space-y-6",children:[r.jsx("div",{className:"bg-surface rounded-lg shadow-md p-6 border border-border",children:k?r.jsxs("div",{className:"space-y-4 animate-fade-in",children:[r.jsxs("div",{children:[r.jsx("label",{htmlFor:"deck-name-edit",className:"block text-sm font-medium text-text-muted mb-1",children:"Deck Name"}),r.jsx("input",{id:"deck-name-edit",type:"text",value:x,onChange:re=>S(re.target.value),className:"w-full p-2 bg-background border border-border rounded-md focus:ring-2 focus:ring-primary focus:outline-none text-2xl font-bold",autoFocus:!0})]}),r.jsxs("div",{children:[r.jsx("label",{htmlFor:"deck-folder",className:"block text-sm font-medium text-text-muted mb-1",children:"Folder"}),r.jsxs("select",{id:"deck-folder",value:j,onChange:re=>O(re.target.value),className:"w-full p-2 bg-background border border-border rounded-md focus:ring-2 focus:ring-primary focus:outline-none",children:[r.jsx("option",{value:"",children:"No folder"}),N.map(re=>r.jsx("option",{value:re.id,children:re.name},re.id))]})]}),r.jsxs("div",{children:[r.jsx("label",{htmlFor:"deck-desc",className:"block text-sm font-medium text-text-muted mb-1",children:"Description"}),r.jsx("textarea",{id:"deck-desc",value:g,onChange:re=>b(re.target.value),rows:4,className:"w-full p-2 bg-background border border-border rounded-md focus:ring-2 focus:ring-primary focus:outline-none"})]}),r.jsxs("div",{className:"flex justify-start gap-2 pt-2",children:[r.jsxs(se,{onClick:fe,children:[r.jsx(J,{name:"save",className:"mr-2"})," Save Changes"]}),r.jsx(se,{variant:"secondary",onClick:ye,children:"Cancel"})]})]}):r.jsxs("div",{children:[r.jsxs("div",{className:"min-w-0",children:[r.jsx("h2",{className:"text-3xl font-bold mb-2 text-text break-words",children:n.name}),n.folderId&&r.jsxs("div",{className:"flex items-center text-sm text-text-muted mb-2",children:[r.jsx(J,{name:"folder",className:"w-4 h-4 mr-2"}),r.jsx("span",{children:((ge=N.find(re=>re.id===n.folderId))==null?void 0:ge.name)||"..."})]})]}),r.jsxs("div",{className:"flex items-center gap-2 mb-4",children:[r.jsxs(se,{variant:"ghost",onClick:()=>I(!0),children:[r.jsx(J,{name:"edit",className:"mr-2"})," Edit"]}),r.jsxs(se,{variant:"ghost",onClick:()=>o({...n,archived:!0}),children:[r.jsx(J,{name:"archive",className:"mr-2"})," Archive"]})]}),n.description&&r.jsx("p",{className:"text-text-muted mt-1 mb-4 prose dark:prose-invert max-w-none",dangerouslySetInnerHTML:{__html:n.description}})]})}),r.jsxs("div",{className:"border-b border-border flex space-x-4",children:[r.jsx("button",{className:Ye("overview"),onClick:()=>P("overview"),children:"Overview"}),r.jsxs("button",{className:Ye("items"),onClick:()=>P("items"),children:["Items (",oe.length,")"]}),r.jsx("button",{className:Ye("stats"),onClick:()=>P("stats"),children:"Statistics"})]}),r.jsxs("div",{className:"mt-6",children:[T==="overview"&&r.jsxs("div",{className:"space-y-8 animate-fade-in",children:[r.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-8",children:[r.jsxs("div",{className:"space-y-4 bg-surface p-6 rounded-lg shadow-md border border-border",children:[r.jsxs("div",{children:[r.jsx("h4",{className:"text-sm font-semibold text-text mb-2",children:"Deck Statistics"}),r.jsxs("div",{className:"space-y-1",children:[n.type===De.Learning&&r.jsxs("p",{className:"text-sm text-text-muted",children:["Info Cards: ",r.jsx("strong",{className:"text-text",children:n.infoCards.length})]}),r.jsxs("p",{className:"text-sm text-text-muted",children:["Active ",n.type===De.Learning?"Questions":"Items",": ",r.jsx("strong",{className:"text-text",children:de.length})]}),r.jsxs("p",{className:"text-sm text-text-muted",children:["Items Due Today: ",r.jsx("strong",{className:be>0?"text-primary":"text-text",children:be})]}),he>0&&r.jsxs("p",{className:"text-sm text-yellow-600 dark:text-yellow-400",children:["Suspended Items: ",r.jsx("strong",{children:he})]})]})]}),r.jsxs("div",{children:[r.jsx("h4",{className:"text-sm font-semibold text-text mb-2",children:"Overall Mastery"}),r.jsx(ns,{level:Se})]}),r.jsxs("div",{children:[r.jsx("h4",{className:"text-sm font-semibold text-text mb-2",children:"Progress by Stage"}),r.jsx(Lx,{data:Pe,total:de.length}),r.jsxs("div",{className:"grid grid-cols-2 gap-x-4 gap-y-1 mt-3 text-xs",children:[r.jsxs("div",{className:"flex items-center",children:[r.jsx("span",{className:"w-2.5 h-2.5 rounded-full bg-blue-500 mr-2"}),r.jsxs("span",{className:"text-text-muted",children:["New: ",r.jsx("strong",{children:ie.new})]})]}),r.jsxs("div",{className:"flex items-center",children:[r.jsx("span",{className:"w-2.5 h-2.5 rounded-full bg-orange-500 mr-2"}),r.jsxs("span",{className:"text-text-muted",children:["Learning: ",r.jsx("strong",{children:ie.learning})]})]}),r.jsxs("div",{className:"flex items-center",children:[r.jsx("span",{className:"w-2.5 h-2.5 rounded-full bg-teal-500 mr-2"}),r.jsxs("span",{className:"text-text-muted",children:["Young: ",r.jsx("strong",{children:ie.young})]})]}),r.jsxs("div",{className:"flex items-center",children:[r.jsx("span",{className:"w-2.5 h-2.5 rounded-full bg-green-500 mr-2"}),r.jsxs("span",{className:"text-text-muted",children:["Mature: ",r.jsx("strong",{children:ie.mature})]})]})]})]})]}),r.jsx("div",{className:"bg-surface p-6 rounded-lg shadow-md border border-border",children:r.jsx(Fx,{data:ke})})]}),r.jsxs("div",{className:"border-t border-border pt-6 flex flex-wrap items-center justify-center gap-4",children:[Re&&Q?F?r.jsxs("div",{className:"flex items-center justify-center w-full sm:w-auto text-lg py-3 px-6 font-semibold",children:[r.jsx(Bt,{size:"sm"}),r.jsx("span",{className:"ml-3 text-text-muted",children:"Generating..."})]}):r.jsxs(se,{variant:"primary",size:"lg",className:"font-semibold w-full sm:w-auto",onClick:()=>{n.type===De.Quiz?l(n):n.type===De.Learning&&f(n)},children:[r.jsx(J,{name:"zap",className:"w-5 h-5 mr-2"}),n.type===De.Quiz?"Generate Questions":"Generate Content"]}):r.jsxs(Tt,{href:`/decks/${n.id}/study`,passAs:se,variant:"primary",size:"lg",onClick:()=>d(n.id),disabled:be===0&&!Ne||!!n.locked||oe.length===0,className:"font-semibold w-full sm:w-auto",children:[r.jsx(J,{name:n.locked?"lock":Ne?"zap":"laptop",className:"w-5 h-5 mr-2"})," ",Ae]}),r.jsxs(Tt,{href:`/decks/${n.id}/cram`,passAs:se,variant:"secondary",size:"lg",onClick:()=>d(n.id),disabled:oe.length===0,className:"font-semibold w-full sm:w-auto",title:"Review all cards in random order, without affecting your SRS schedule.",children:[r.jsx(J,{name:"refresh-ccw",className:"w-5 h-5 mr-2"})," Cram"]}),n.type===De.Flashcard&&de.length>0&&r.jsxs(Tt,{href:`/decks/${n.id}/study-reversed`,passAs:se,variant:"secondary",size:"lg",onClick:()=>d(n.id),disabled:!!n.locked,className:"font-semibold w-full sm:w-auto",title:"Study cards from back to front.",children:[r.jsx(J,{name:"repeat",className:"w-5 h-5 mr-2"})," Study Reversed"]}),n.type===De.Quiz&&de.length>0&&r.jsxs(Tt,{href:`/decks/${n.id}/study-flip`,passAs:se,variant:"secondary",size:"lg",onClick:()=>d(n.id),disabled:!!n.locked,className:"font-semibold w-full sm:w-auto",children:[r.jsx(J,{name:"refresh-ccw",className:"w-5 h-5 mr-2"})," Review as Flashcards"]})]})]}),T==="items"&&r.jsx("div",{className:"bg-surface rounded-lg shadow-md border border-border animate-fade-in",children:n.type===De.Flashcard?r.jsx(Tx,{cards:n.cards,onCardsChange:re=>o({...n,cards:re},{silent:!0}),onAddCard:re=>o({...n,cards:[...n.cards,{...re,id:crypto.randomUUID(),dueDate:new Date().toISOString(),interval:0,easeFactor:ts}]},{silent:!0}),onBulkAdd:()=>A(!0)}):n.type===De.Quiz?r.jsx(Rx,{questions:n.questions,onQuestionsChange:re=>o({...n,questions:re},{silent:!0}),onAddQuestion:re=>o({...n,questions:[...n.questions,{...re,id:crypto.randomUUID(),dueDate:new Date().toISOString(),interval:0,easeFactor:ts}]},{silent:!0}),onBulkAdd:()=>A(!0),onGenerateAI:()=>l(n),isGeneratingAI:F}):n.type===De.Learning?r.jsx(zx,{deck:n,onSaveBlock:re=>h(n.id,re),onDeleteBlock:re=>C(n.id,re),onBlockClick:_}):r.jsx("div",{className:"p-6 text-center text-text-muted",children:r.jsx("p",{children:"Unsupported deck type."})})}),T==="stats"&&r.jsx("div",{className:"animate-fade-in",children:r.jsx($x,{deck:n})})]}),r.jsxs("div",{className:"bg-red-900/20 border border-red-500/30 rounded-lg p-6",children:[r.jsx("h3",{className:"text-xl font-semibold text-red-400 dark:text-red-300 mb-2",children:"Danger Zone"}),r.jsx("p",{className:"text-red-500/80 dark:text-red-300/80 mb-4",children:"Moving a deck to the trash will make it unavailable for study. It will be permanently deleted after 10 days."}),r.jsxs(se,{variant:"danger",onClick:z,children:[r.jsx(J,{name:"trash-2",className:"mr-2"})," Move to Trash"]})]}),R&&r.jsx(Mx,{isOpen:R,onClose:()=>A(!1),onAddItems:ue,deckType:n.type}),H&&r.jsx(Bx,{isOpen:H,onClose:()=>K(!1),block:W})]})},Zn=({children:n})=>r.jsx("pre",{className:"bg-gray-100 dark:bg-gray-900/70 p-4 rounded-lg overflow-x-auto text-sm text-gray-800 dark:text-gray-200 border border-gray-200 dark:border-gray-700",children:r.jsx("code",{children:n})}),_n=({title:n,iconName:i,children:o,defaultOpen:p=!1})=>{const[d,c]=M.useState(p);return r.jsxs("div",{className:"border border-gray-200 dark:border-gray-700 rounded-lg overflow-hidden",children:[r.jsxs("button",{onClick:()=>c(!d),className:"w-full flex justify-between items-center text-left p-4 bg-gray-50 dark:bg-gray-800/50 hover:bg-gray-100 dark:hover:bg-gray-700/50 transition-colors","aria-expanded":d,children:[r.jsxs("div",{className:"flex items-center",children:[i&&r.jsx(J,{name:i,className:"w-6 h-6 mr-3 text-gray-500 dark:text-gray-400"}),r.jsx("h3",{className:"text-xl font-semibold text-gray-800 dark:text-gray-200",children:n})]}),r.jsx(J,{name:"chevron-down",className:`w-6 h-6 transition-transform duration-300 ${d?"":"-rotate-90"} text-gray-500`})]}),d&&r.jsx("div",{className:"p-6 bg-white dark:bg-gray-800 animate-fade-in",children:o})]})},Df=({fields:n})=>r.jsx("div",{className:"overflow-x-auto",children:r.jsxs("table",{className:"w-full text-left border-collapse mt-4 min-w-[500px]",children:[r.jsx("thead",{children:r.jsxs("tr",{children:[r.jsx("th",{className:"border-b-2 dark:border-gray-600 p-2 text-sm font-semibold text-gray-700 dark:text-gray-300",children:"Field"}),r.jsx("th",{className:"border-b-2 dark:border-gray-600 p-2 text-sm font-semibold text-gray-700 dark:text-gray-300",children:"Type"}),r.jsx("th",{className:"border-b-2 dark:border-gray-600 p-2 text-sm font-semibold text-gray-700 dark:text-gray-300",children:"Required"}),r.jsx("th",{className:"border-b-2 dark:border-gray-600 p-2 text-sm font-semibold text-gray-700 dark:text-gray-300",children:"Description"})]})}),r.jsx("tbody",{children:n.map(({field:i,type:o,description:p,required:d})=>r.jsxs("tr",{className:"border-b dark:border-gray-700/50",children:[r.jsx("td",{className:"p-2 align-top",children:r.jsx("code",{className:"bg-gray-200 dark:bg-gray-700 px-1 py-0.5 rounded-sm",children:i})}),r.jsx("td",{className:"p-2 align-top text-gray-600 dark:text-gray-400",children:o}),r.jsx("td",{className:"p-2 align-top",children:d?r.jsx(J,{name:"check-circle",className:"text-green-500"}):"No"}),r.jsx("td",{className:"p-2 align-top text-gray-600 dark:text-gray-400",dangerouslySetInnerHTML:{__html:p}})]},i))})]})}),Wx=()=>{const{addToast:n}=Kt(),[i,o]=M.useState(""),[p,d]=M.useState("Beginner"),[c,l]=M.useState(""),[f,v]=M.useState(""),[h,C]=M.useState("Beginner"),[k,I]=M.useState("Beginner"),[x,S]=M.useState(null),g=["Novice","Beginner","Intermediate","Advanced","Expert","Mastery"],b=`[
  {
    "front": "What is the capital of France?",
    "back": "Paris"
  },
  {
    "front": "What is H2O?",
    "back": "Water"
  }
]`,j=`{
  "name": "Sample Science Quiz",
  "description": "A few questions to test your <b>basic</b> science knowledge.",
  "questions": [
    {
      "questionType": "multipleChoice",
      "questionText": "Which planet is known as the Red Planet?",
      "tags": ["astronomy", "planets"],
      "detailedExplanation": "Mars is often called the Red Planet...",
      "options": [
        { "id": "opt1", "text": "Venus" },
        { "id": "opt2", "text": "Mars" },
        { "id": "opt3", "text": "Jupiter", "explanation": "Jupiter is a gas giant..." }
      ],
      "correctAnswerId": "opt2"
    }
  ]
}`,O=[{field:"name",type:"string",required:!0,description:"The title of the quiz deck."},{field:"description",type:"string",required:!0,description:"A brief summary of the deck's content. Can include basic HTML for formatting (e.g., `<b>`, `<i>`, `<br>`)."},{field:"questions",type:"Array<Question>",required:!0,description:"An array containing all question objects for the deck."},{field:"questionType",type:"string",required:!0,description:'Must be "multipleChoice" for now.'},{field:"questionText",type:"string",required:!0,description:"The question being asked."},{field:"tags",type:"Array<string>",required:!1,description:"An array of keywords for organization."},{field:"detailedExplanation",type:"string",required:!0,description:"The full explanation shown after answering."},{field:"options",type:"Array<Option>",required:!0,description:"An array of possible answers."},{field:"correctAnswerId",type:"string",required:!0,description:"The `id` of the correct option."},{field:"options[].id",type:"string",required:!0,description:"A unique identifier for this option within the question."},{field:"options[].text",type:"string",required:!0,description:"The answer text shown to the user."},{field:"options[].explanation",type:"string",required:!1,description:"A brief explanation for why this specific option is right or wrong."}],R=`{
  "seriesName": "Intro to Web Development",
  "seriesDescription": "A progressive series covering the <b>fundamentals</b> of web development.",
  "levels": [
    {
      "title": "Level 1: The Foundation",
      "decks": [
        {
          "name": "Level 1.1: HTML Basics",
          "description": "The building blocks of the web.",
          "questions": [
            {
              "questionType": "multipleChoice",
              "questionText": "What does HTML stand for?",
              "tags": ["html", "basics"],
              "detailedExplanation": "HTML stands for HyperText Markup Language...",
              "options": [
                { "id": "1", "text": "HyperText Markup Language" },
                { "id": "2", "text": "High-Level Text Machine Language" }
              ],
              "correctAnswerId": "1"
            }
          ]
        },
        { "name": "Level 1.2: CSS Fundamentals", "description": "...", "questions": [] }
      ]
    }
  ]
}`,A=[{field:"seriesName",type:"string",required:!0,description:"The title for the entire series."},{field:"seriesDescription",type:"string",required:!0,description:"A brief summary of what the whole series covers. Can include basic HTML for formatting."},{field:"levels",type:"Array<Level>",required:!0,description:"An array containing all the levels in the series."},{field:"levels[].title",type:"string",required:!0,description:'The heading for a group of decks (e.g., "Level 1: Core Concepts").'},{field:"levels[].decks",type:"Array<QuizDeck>",required:!0,description:"An array of quiz decks for that level. The schema for each deck is the same as the Single Quiz Deck format."}],T=`Please act as a world-class instructional designer and subject matter expert. Your task is to generate a comprehensive, detailed, and world-class TEXT outline for a learning path. The output must be plain text, not a JSON object.

**Topic:** [YOUR TOPIC HERE]
**User's Current Level:** [USER'S LEVEL HERE]

The goal is to create a structured and progressive learning path that guides the user towards deep, comprehensive mastery of the topic, similar in quality and detail to the provided example structure.

**INSTRUCTIONS & REQUIREMENTS:**

1.  **Learning Path Structure:**
    -   Organize the learning path into logical "Levels" (e.g., Level 1, Level 2, up to Level 4 or 5). Each level must have a title and represent a significant step up in knowledge.
    -   Each Level should contain one or more related "Decks".
    -   The name of each deck must reflect this structure, e.g., "Level 1.1: Foundations of X", "Level 1.2: Core Concepts of Y", "Level 2.1: Advanced Techniques in Z".

2.  **High-Quality Content (Crucial):**
    -   **Comprehensive Coverage:** The outline must cover the topic in sufficient depth for the specified user level, ensuring a thorough understanding.
    -   **Series Name & Description:** Create a compelling and descriptive name (e.g., "Topic Mastery Path: The Contextual Approach") and a comprehensive summary for the entire learning path. The description can use basic HTML for formatting (e.g., <b>, <i>, <br>).
    -   **Engaging Tone:** All names and descriptions should be written to be engaging and spark curiosity, not just be descriptive. Avoid a dry, academic tone.
    -   **Level Goal & Focus:** For each Level, provide a clear "Goal" and "Focus".
    -   **Deck Topics:** For each Deck, provide a detailed, itemized list of specific "Topics" to be covered.
    -   **Progressive Difficulty:** The path must be logically sequenced, starting with foundational definitions and historical context, moving to practical applications, then to assessment and planning, and finally to interdisciplinary challenges.
    -   **Context-Specific:** If the user's topic has a specific context (e.g., a geographical location, a particular framework), embed that context deeply into the entire outline.
    -   **Clarity with Acronyms:** When using an acronym, write it out fully in parentheses the first time it is used (e.g., "Sustainable Forest Management (SFM)").
    -   **Approximate Question Count:** Suggest an approximate number of questions for each deck.
    -   **Metric System:** All generated content should prefer the metric system (e.g., meters, kilograms, Celsius).

**EXAMPLE STRUCTURE:**
Ecological Sustainable Forestry Mastery Path: The Scanian Approach
This learning path provides a deep understanding of...
Level 1: Core Principles & Historical Context in Skne
Goal: Define ecological sustainable forestry...
Focus: Shifting from purely extractive forestry...
Level 1.1: Foundations of Sustainable Forest Management (SFM) in Skne
Topics: Definitional evolution of forestry...
Approx. Questions: 30-40

---

Now, based on all the above requirements, generate the complete text outline.

Finally, at the very end of your response, provide a JSON object with the series name and description you created, like this:
{
  "seriesName": "The full series name you generated above",
  "seriesDescription": "The full series description you generated above"
}
`,P=`You are an expert content creator. I have provided a text outline for a learning path. Your task is to convert this outline into a structured JSON object that will serve as a scaffold.

**PRIMARY INSTRUCTIONS:**

1.  **Source Material:** Use ONLY the text outline I've provided as your source.
2.  **Structure:** Create a single JSON object with \`seriesName\`, \`seriesDescription\`, and a \`levels\` array.
3.  **Levels and Decks:** Inside the \`levels\` array, create objects for each level, including its \`title\`. Each level object should have a \`decks\` array. Populate this with deck objects, each containing its \`name\` and \`description\` from the outline.
4.  **Empty Questions:** For every deck object, include a \`"questions": []\` key-value pair. The questions array MUST be empty.

**JSON OUTPUT FORMAT:**
- The final output MUST be ONLY a single, raw JSON object, starting with \`{\` and ending with \`}\`. Do not include any surrounding text, explanations, or markdown formatting.
- The JSON object must follow this exact schema:
{
  "seriesName": "The full series name from the outline",
  "seriesDescription": "The full series description from the outline",
  "levels": [
    {
      "title": "The title of the first level",
      "decks": [
        {
          "name": "The name of the first deck in this level",
          "description": "The description for this deck",
          "questions": []
        },
        {
          "name": "The name of the second deck in this level",
          "description": "The description for this deck",
          "questions": []
        }
      ]
    }
  ]
}

Now, based on the text outline I provided, please generate the complete JSON scaffold.`,H=`You are an expert content creator. I have provided a text outline for a learning path. Your task is to generate the JSON for the **first deck (e.g., Level 1.1)** from that outline.

**PRIMARY INSTRUCTIONS:**

1.  **Source Material:** Use ONLY the text outline I've provided as your source.
2.  **Question Quantity:** Generate the approximate number of questions specified in the outline for this first deck.
3.  **Content Generation:** Create world-class questions and answers based *only* on the "Topics" listed for this specific deck in the outline.

**CRITICAL CONTENT QUALITY REQUIREMENTS:**
- **Factual Accuracy:** This is paramount. The correct answer and all parts of the explanation must be unequivocally correct and verifiable.
- **In-Depth Coverage:** The questions must cover the deck's topics comprehensively, moving beyond surface-level facts to ensure a deep understanding.
- **Relevance & Practical Application:** Frame questions in real-world scenarios to help a user apply the information. Questions must be relevant to the deck's topics.
- **Clarity & Simplicity:** Questions must be easy to understand, unambiguous, and free of jargon (unless the jargon is the learning objective). Test only one core concept per question.
- **Clarity with Acronyms:** When using an acronym, provide the full term in parentheses upon its first use (e.g., 'Central Processing Unit (CPU)').
- **Problem-Solving Focus:** Design questions that require applying knowledge, not just recalling facts. Avoid trivial pursuit and focus on genuinely useful information. For practical topics, ask skill-based questions that test the ability to perform a task or make a decision.
- **High-Quality Explanations:** The \`detailedExplanation\` is crucial. It must explain the reasoning, principles, or facts behind the correct answer. Provide additional context, examples, or connections to related concepts to deepen understanding. If applicable, cite sources for complex information.
- **Metric System:** Prefer the metric system (e.g., meters, kilograms, Celsius) for all units.
- **Engaging Content:** Write questions and explanations in an interesting way that makes the user want to learn more. Use surprising facts, real-world scenarios, or narrative elements where appropriate to maintain learner interest.

**JSON OUTPUT FORMAT:**
- The final output MUST be ONLY a single, raw JSON object, starting with \`{\` and ending with \`}\`. Do not include any surrounding text, explanations, or markdown formatting.
- The JSON object must follow this exact schema:
{
  "name": "The exact name for the deck from your outline, e.g., 'Level 1.1: Foundations...'",
  "description": "A concise description of this specific deck's content, based on its topics.",
  "questions": [
    {
      "questionType": "multipleChoice",
      "questionText": "The text of the first question...",
      "tags": ["relevant", "tags"],
      "detailedExplanation": "A thorough explanation that meets all quality requirements.",
      "options": [
        { "id": "q1_opt1", "text": "First answer option" },
        { "id": "q1_opt2", "text": "Second answer option" }
      ],
      "correctAnswerId": "q1_opt2"
    }
  ]
}

Now, based on the text outline I provided, please generate the JSON for the **first deck**.`,K=`Please act as an expert instructional designer and generate a complete, structured Deck Series in a single JSON object.

**Topic:** [YOUR TOPIC HERE]
**User's Current Level:** [USER'S LEVEL HERE]

**CONTENT REQUIREMENTS FOR ALL QUESTIONS:**
-   **Comprehensive Coverage:** The generated series must be comprehensive, covering the topic in-depth to provide a thorough understanding for the specified user level.
-   **Factual Accuracy:** All correct answers and explanations must be verifiable and factually correct.
-   **Engaging Content Style:** Frame questions and explanations in an interesting way. Use surprising facts, real-world examples, or historical context to make the material more memorable and engaging. Avoid a dry, academic tone.
-   **Practical Application:** Frame questions to enable the user to put the learned information into practice.
-   **Clarity:** Questions must be easy to understand and unambiguous.
-   **Clarity with Acronyms:** When using an acronym, provide the full term in parentheses upon its first use (e.g., 'CPU (Central Processing Unit)').
-   **Metric System:** Prefer the metric system (e.g., meters, kilograms, Celsius) for all units.

**FINAL JSON OUTPUT FORMAT:**
The final output MUST be ONLY a single, raw JSON object without any surrounding text or markdown. The root object must have this exact schema:
{
  "seriesName": "A descriptive name for the whole series",
  "seriesDescription": "A brief description of what the series covers. Can include basic HTML for formatting.",
  "levels": [
    {
      "title": "Level 1: The Basics",
      "decks": [
        {
          "name": "Level 1.1: Deck Name",
          "description": "Description of this deck's content. Can include basic HTML for formatting.",
          "questions": [
            {
              "questionType": "multipleChoice",
              "questionText": "...",
              "tags": ["tag1", "tag2"],
              "detailedExplanation": "...",
              "options": [ { "id": "q1_opt1", "text": "..." }, { "id": "q1_opt2", "text": "..." } ],
              "correctAnswerId": "q1_opt2"
            }
          ]
        }
      ]
    }
  ]
}

Now, generate the complete JSON object based on all the above requirements.`,W="Please generate a JSON object for a single multiple-choice quiz.\n\n**Topic:** [YOUR TOPIC HERE]\n**Designed for Level:** [USER'S LEVEL HERE]\n\n**CONTENT REQUIREMENTS:**\n-   **In-Depth Questions:** The questions should cover the topic comprehensively, moving beyond surface-level facts to ensure a deep understanding.\n-   **Factual Accuracy:** All correct answers and explanations must be verifiable and factually correct.\n-   **Relevance:** Questions must be directly pertinent to the chosen topic and appropriate for the specified level.\n-   **Engaging Content:** Frame questions and explanations in an interesting way that makes the user want to learn more. Use surprising facts, real-world scenarios, or narrative elements where appropriate.\n-   **Practical Application:** Frame questions to enable the user to put the learned information into practice.\n-   **Question Quantity:** Generate 10-100 high-quality questions. Do not include multiple questions that are essentially asking the same thing.\n-   **Clarity:** Questions must be easy to understand and unambiguous.\n-   **Clarity with Acronyms:** When using an acronym, provide the full term in parentheses upon its first use (e.g., 'CPU (Central Processing Unit)').\n-   **Problem-Solving Focus:** Prioritize questions that require applying knowledge to solve a problem.\n-   **Explanation Quality:** The `detailedExplanation` must explain the reasoning behind the correct answer and provide additional context.\n-   **Metric System:** Prefer the metric system (e.g., meters, kilograms, Celsius) for all units.\n\n**JSON SCHEMA & RULES:**\n-   The final output must be ONLY the raw JSON object, starting with `{` and ending with `}`.\n-   The root object must contain `name`, `description`, and `questions` (array).\n-   Each question object must contain `questionType` (\"multipleChoice\"), `questionText`, `tags` (array), `detailedExplanation`, `options` (array), and `correctAnswerId`.\n-   Each option object must contain a unique `id` and `text`.\n-   Do NOT include top-level SRS fields like `id` or `dueDate` on the questions.\n\nNow, generate the complete JSON deck based on all the above requirements.",B=(oe,fe)=>{navigator.clipboard.writeText(oe).then(()=>{n("Prompt copied to clipboard!","success"),S(fe),setTimeout(()=>S(null),2e3)}).catch(ye=>{n("Failed to copy prompt.","error"),console.error("Could not copy text: ",ye)})},Y=()=>{const oe=i.trim()||"[YOUR TOPIC HERE]",fe=T.replace("[YOUR TOPIC HERE]",oe).replace("[USER'S LEVEL HERE]",p);B(fe,"outline-prompt")},q=()=>{B(P,"scaffold-prompt")},Q=()=>{B(H,"deck-from-outline-prompt")},N=()=>{const oe=c.trim()||"[YOUR TOPIC HERE]",fe=K.replace("[YOUR TOPIC HERE]",oe).replace("[USER'S LEVEL HERE]",h);B(fe,"series-prompt")},Z=()=>{const oe=f.trim()||"[YOUR TOPIC HERE]",fe=W.replace("[YOUR TOPIC HERE]",oe).replace("[USER'S LEVEL HERE]",k);B(fe,"quiz-prompt")};return r.jsxs("div",{className:"max-w-4xl mx-auto animate-fade-in space-y-6 pb-10",children:[r.jsxs("div",{children:[r.jsx("h1",{className:"text-4xl font-bold text-gray-900 dark:text-gray-100",children:"AI & JSON Import Guide"}),r.jsx("p",{className:"mt-2 text-lg text-gray-500 dark:text-gray-400",children:"Use this expert-led workflow to generate high-quality learning content with AI, or follow the formats to import your own data."})]}),r.jsx(_n,{title:"Step 1: Generate Learning Outline (Text)",iconName:"list",defaultOpen:!0,children:r.jsxs("div",{className:"space-y-4 bg-green-900/10 dark:bg-green-900/20 p-6 rounded-lg border border-green-500/20",children:[r.jsx("p",{className:"text-green-800/90 dark:text-green-200/90",children:"Begin by generating a high-level, human-readable outline for your learning path using an external AI chat service. This allows you to review and approve the structure before generating the full content."}),r.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[r.jsxs("div",{children:[r.jsx("label",{htmlFor:"outline-topic-input",className:"block text-sm font-medium text-green-700 dark:text-green-300",children:"Enter Topic"}),r.jsx("input",{id:"outline-topic-input",type:"text",value:i,onChange:oe=>o(oe.target.value),className:"w-full p-2 mt-1 bg-green-50 dark:bg-gray-900 border border-green-300 dark:border-green-700 rounded-md focus:ring-2 focus:ring-green-500 focus:outline-none",placeholder:"e.g., The History of Ancient Rome"})]}),r.jsxs("div",{children:[r.jsx("label",{htmlFor:"outline-level-select",className:"block text-sm font-medium text-green-700 dark:text-green-300",children:"My Current Level Is"}),r.jsx("select",{id:"outline-level-select",value:p,onChange:oe=>d(oe.target.value),className:"w-full p-2 mt-1 bg-green-50 dark:bg-gray-900 border border-green-300 dark:border-green-700 rounded-md focus:ring-2 focus:ring-green-500 focus:outline-none",children:g.map(oe=>r.jsx("option",{value:oe,children:oe},oe))})]})]}),r.jsx("p",{className:"text-xs text-green-600/80 dark:text-green-400/80 mt-1",children:"Your topic and level will be inserted into the prompt."}),r.jsxs("div",{className:"relative",children:[r.jsx(Zn,{children:T}),r.jsx(se,{variant:"secondary",className:"absolute top-2 right-2 px-2 py-1 text-xs bg-gray-200/50 dark:bg-gray-900/50 border border-gray-300 dark:border-gray-600",onClick:Y,children:x==="outline-prompt"?r.jsxs(r.Fragment,{children:[r.jsx(J,{name:"check-circle",className:"w-4 h-4 mr-1"})," Copied!"]}):r.jsxs(r.Fragment,{children:[r.jsx(J,{name:"download",className:"w-4 h-4 mr-1"})," Copy Prompt"]})})]})]})}),r.jsx(_n,{title:"Step 2: Create the Series Scaffold",iconName:"code",children:r.jsxs("div",{className:"space-y-4 bg-yellow-900/10 dark:bg-yellow-900/20 p-6 rounded-lg border border-yellow-500/20",children:[r.jsx("p",{className:"text-yellow-800/90 dark:text-yellow-200/90",children:'You can now create the series structure in CogniFlow. Use the in-app "Generate with AI" feature with your topic. This will automatically create the series with empty decks, ready for you to populate.'}),r.jsx("p",{className:"text-sm text-yellow-700/90 dark:text-yellow-300/90",children:'Alternatively, you can manually convert your text outline from Step 1 into a JSON "scaffold" using the prompt below and import it via the "Create / Import" modal.'}),r.jsxs("div",{className:"relative",children:[r.jsx(Zn,{children:P}),r.jsx(se,{variant:"secondary",className:"absolute top-2 right-2 px-2 py-1 text-xs bg-gray-200/50 dark:bg-gray-900/50 border border-gray-300 dark:border-gray-600",onClick:q,children:x==="scaffold-prompt"?r.jsxs(r.Fragment,{children:[r.jsx(J,{name:"check-circle",className:"w-4 h-4 mr-1"})," Copied!"]}):r.jsxs(r.Fragment,{children:[r.jsx(J,{name:"download",className:"w-4 h-4 mr-1"})," Copy Prompt"]})})]})]})}),r.jsx(_n,{title:"Step 3: Generate Questions for Each Deck",iconName:"zap",children:r.jsxs("div",{className:"space-y-4 bg-blue-900/10 dark:bg-blue-900/20 p-6 rounded-lg border border-blue-500/20",children:[r.jsx("p",{className:"text-blue-800/90 dark:text-blue-200/90",children:'Navigate to your newly created series page in CogniFlow. Each empty deck will have a "Generate Questions" button. Click it to have the AI populate that specific deck with high-quality, relevant questions automatically.'}),r.jsx("p",{className:"text-sm text-blue-700/90 dark:text-blue-300/90",children:"If you are working with an external AI and your JSON scaffold from Step 2, you can use the prompt below to generate the questions for each deck. Paste your text outline into the chat first, then use the prompt. Copy the generated `questions` array into the correct deck in your scaffold JSON. Repeat for all decks, then import the final JSON file."}),r.jsxs("div",{className:"relative",children:[r.jsx(Zn,{children:H}),r.jsx(se,{variant:"secondary",className:"absolute top-2 right-2 px-2 py-1 text-xs bg-gray-200/50 dark:bg-gray-900/50 border border-gray-300 dark:border-gray-600",onClick:Q,children:x==="deck-from-outline-prompt"?r.jsxs(r.Fragment,{children:[r.jsx(J,{name:"check-circle",className:"w-4 h-4 mr-1"})," Copied!"]}):r.jsxs(r.Fragment,{children:[r.jsx(J,{name:"download",className:"w-4 h-4 mr-1"})," Copy Prompt"]})})]})]})}),r.jsx(_n,{title:"Alternative: Generate Full Series at Once (JSON)",iconName:"zap",children:r.jsxs("div",{className:"space-y-4 bg-purple-900/10 dark:bg-purple-900/20 p-6 rounded-lg border border-purple-500/20",children:[r.jsx("p",{className:"text-purple-700/90 dark:text-purple-300/90",children:"For a faster, one-shot approach, use this powerful prompt to generate a complete, structured learning path on any topic. This is less controlled but much quicker."}),r.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[r.jsxs("div",{children:[r.jsx("label",{htmlFor:"series-topic-input",className:"block text-sm font-medium text-purple-700 dark:text-purple-300",children:"Enter Topic"}),r.jsx("input",{id:"series-topic-input",type:"text",value:c,onChange:oe=>l(oe.target.value),className:"w-full p-2 mt-1 bg-purple-50 dark:bg-gray-900 border border-purple-300 dark:border-purple-700 rounded-md focus:ring-2 focus:ring-purple-500 focus:outline-none",placeholder:"e.g., Quantum Physics"})]}),r.jsxs("div",{children:[r.jsx("label",{htmlFor:"series-level-select",className:"block text-sm font-medium text-purple-700 dark:text-purple-300",children:"My Current Level Is"}),r.jsx("select",{id:"series-level-select",value:h,onChange:oe=>C(oe.target.value),className:"w-full p-2 mt-1 bg-purple-50 dark:bg-gray-900 border border-purple-300 dark:border-purple-700 rounded-md focus:ring-2 focus:ring-purple-500 focus:outline-none",children:g.map(oe=>r.jsx("option",{value:oe,children:oe},oe))})]})]}),r.jsx("p",{className:"text-xs text-purple-600/80 dark:text-purple-400/80 mt-1",children:"Your topic and level will be inserted into the prompt."}),r.jsxs("div",{className:"relative",children:[r.jsx(Zn,{children:K}),r.jsx(se,{variant:"secondary",className:"absolute top-2 right-2 px-2 py-1 text-xs bg-gray-200/50 dark:bg-gray-900/50 border border-gray-300 dark:border-gray-600",onClick:N,children:x==="series-prompt"?r.jsxs(r.Fragment,{children:[r.jsx(J,{name:"check-circle",className:"w-4 h-4 mr-1"})," Copied!"]}):r.jsxs(r.Fragment,{children:[r.jsx(J,{name:"download",className:"w-4 h-4 mr-1"})," Copy Prompt"]})})]})]})}),r.jsx(_n,{title:"Alternative: Generate a Single Quiz Deck",iconName:"zap",children:r.jsxs("div",{className:"space-y-4 bg-blue-900/10 dark:bg-blue-900/20 p-6 rounded-lg border border-blue-500/20",children:[r.jsx("p",{className:"text-blue-700/90 dark:text-blue-300/90",children:"Use this prompt to generate a single quiz deck on any topic, tailored to a specific difficulty level."}),r.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 mb-4",children:[r.jsxs("div",{children:[r.jsx("label",{htmlFor:"quiz-topic-input",className:"block text-sm font-medium text-blue-700 dark:text-blue-300",children:"Enter Topic"}),r.jsx("input",{id:"quiz-topic-input",type:"text",value:f,onChange:oe=>v(oe.target.value),className:"w-full p-2 mt-1 bg-blue-50 dark:bg-gray-900 border border-blue-300 dark:border-blue-700 rounded-md focus:ring-2 focus:ring-blue-500 focus:outline-none",placeholder:"e.g., The Roman Empire"})]}),r.jsxs("div",{children:[r.jsx("label",{htmlFor:"quiz-level-select",className:"block text-sm font-medium text-blue-700 dark:text-blue-300",children:"Deck Difficulty Level"}),r.jsx("select",{id:"quiz-level-select",value:k,onChange:oe=>I(oe.target.value),className:"w-full p-2 mt-1 bg-blue-50 dark:bg-gray-900 border border-blue-300 dark:border-blue-700 rounded-md focus:ring-2 focus:ring-blue-500 focus:outline-none",children:g.map(oe=>r.jsx("option",{value:oe,children:oe},oe))})]})]}),r.jsxs("div",{className:"relative",children:[r.jsx(Zn,{children:W}),r.jsx(se,{variant:"secondary",className:"absolute top-2 right-2 px-2 py-1 text-xs bg-gray-200/50 dark:bg-gray-900/50 border border-gray-300 dark:border-gray-600",onClick:Z,children:x==="quiz-prompt"?r.jsxs(r.Fragment,{children:[r.jsx(J,{name:"check-circle",className:"w-4 h-4 mr-1"})," Copied!"]}):r.jsxs(r.Fragment,{children:[r.jsx(J,{name:"download",className:"w-4 h-4 mr-1"})," Copy Prompt"]})})]})]})}),r.jsxs(_n,{title:"Format 1: Full Deck Series (JSON)",iconName:"list",children:[r.jsx("p",{className:"text-gray-600 dark:text-gray-400 mb-4",children:"To import an entire learning path at once, provide a single JSON object containing the series details and a `levels` array. Each level has a title and contains its own array of decks."}),r.jsx(Zn,{children:R}),r.jsx("h4",{className:"text-lg font-semibold mt-6 mb-2",children:"Field Definitions"}),r.jsx(Df,{fields:A})]}),r.jsxs(_n,{title:"Format 2: Single Quiz Deck (JSON)",iconName:"help-circle",children:[r.jsx("p",{className:"text-gray-600 dark:text-gray-400 mb-4",children:"For a single multiple-choice quiz, provide a JSON object with a name, description, and an array of question objects. See the field definitions below for more details."}),r.jsx(Zn,{children:j}),r.jsx("h4",{className:"text-lg font-semibold mt-6 mb-2",children:"Field Definitions"}),r.jsx(Df,{fields:O})]}),r.jsxs(_n,{title:"Format 3: Simple Flashcard Deck (JSON)",iconName:"laptop",children:[r.jsxs("p",{className:"text-gray-600 dark:text-gray-400 mb-4",children:["For basic front-and-back flashcards, provide a JSON array. Each object in the array must have a ",r.jsx("code",{className:"bg-gray-200 dark:bg-gray-700 px-1 py-0.5 rounded-sm",children:"front"})," and a ",r.jsx("code",{className:"bg-gray-200 dark:bg-gray-700 px-1 py-0.5 rounded-sm",children:"back"})," key, both with string values. This format is ideal for quick, manual creation or for exporting from other simple flashcard apps."]}),r.jsx(Zn,{children:b})]}),r.jsx(_n,{title:"General Tips & Troubleshooting",iconName:"settings",children:r.jsxs("ul",{className:"space-y-4 list-disc list-inside text-gray-600 dark:text-gray-400",children:[r.jsxs("li",{children:[r.jsx("strong",{children:"Validate Your JSON:"})," Before importing, it's a good idea to paste your JSON into an online validator to check for syntax errors. A common mistake is a trailing comma after the last item in an array or object.",r.jsx("br",{}),r.jsx("code",{children:'[ { "key": "value" }, ] &larr; Invalid Trailing Comma'})]}),r.jsxs("li",{children:[r.jsx("strong",{children:"Check Your Quotes:"}),` All keys and string values in JSON must be enclosed in double quotes ("). Single quotes (') are not valid.`]}),r.jsxs("li",{children:[r.jsx("strong",{children:"Schema Mismatches:"}),' Ensure your JSON structure matches one of the three formats above. For example, pasting an array of flashcards into the "Bulk Add" modal inside a quiz deck will fail. The main "Import" modal is more flexible and can detect the format automatically.']}),r.jsxs("li",{children:[r.jsx("strong",{children:"Unique IDs:"}),' When creating quiz questions, ensure the `id` for each option within a single question is unique. You can use simple strings like "opt1", "opt2", or a UUID.']}),r.jsxs("li",{children:[r.jsx("strong",{children:"AI-Generated Content:"})," Always review content generated by an AI for factual accuracy before studying it. The prompts are designed to request accuracy, but AI can still make mistakes."]})]})})]})},Tf=n=>{if(!n)return 0;const i=new Date;return i.setHours(23,59,59,999),n.questions.filter(o=>!o.suspended&&new Date(o.dueDate)<=i).length},Qx=({series:n,sessionsToResume:i,onUpdateSeries:o,onDeleteSeries:p,onAddDeckToSeries:d,onUpdateDeck:c,onStartSeriesStudy:l,onUpdateLastOpened:f,openConfirmModal:v,onAiAddLevelsToSeries:h,onAiAddDecksToLevel:C,onGenerateQuestionsForEmptyDecksInSeries:k,onGenerateQuestionsForDeck:I})=>{var Se;const{decks:x,seriesProgress:S,aiGenerationStatus:g,dispatch:b}=at(),{navigate:j,path:O}=Cn(),{addToast:R}=Kt(),{aiFeaturesEnabled:A}=rn(),[T,P]=M.useState(!1),[H,K]=M.useState(!1),[W,B]=M.useState(n.name),[Y,q]=M.useState(n.description),[Q,N]=M.useState(!1),[Z,oe]=M.useState(null);M.useEffect(()=>{new URLSearchParams(O.split("?")[1]).get("edit")==="true"&&(P(!0),j(`/series/${n.id}`,{replace:!0}))},[O,n.id,j]),M.useEffect(()=>{f(n.id)},[n.id,f]),M.useEffect(()=>{(n.archived||n.deletedAt)&&j("/series")},[n.archived,n.deletedAt,j]);const fe=M.useMemo(()=>{const ke=new Map,Ae=new Set(n.levels.flatMap(Pe=>Pe.deckIds));return x.forEach(Pe=>{Ae.has(Pe.id)&&(Pe.type===De.Quiz||Pe.type===De.Learning)&&ke.set(Pe.id,Pe)}),ke},[n.levels,x]),ye=M.useMemo(()=>S.get(n.id)||new Set,[S,n.id]),ue=n.levels.reduce((ke,Ae)=>ke+Ae.deckIds.length,0),{totalDueCount:z,averageMastery:_}=M.useMemo(()=>{let ke=0;const Ae=[];let Pe=0;for(const Re of n.levels)for(const E of Re.deckIds){const ge=fe.get(E);ge&&(Pe<=ye.size&&(ke+=Tf(ge)),Ae.push(...ge.questions.filter(re=>!re.suspended))),Pe++}const Ye=Ae.length>0?Ae.reduce((Re,E)=>Re+nn(E),0)/Ae.length:0;return{totalDueCount:ke,averageMastery:Ye}},[n.levels,fe,ye]),F=()=>{o({...n,name:W,description:Y}),K(!1)},de=()=>{const ke=n.levels.reduce((Ae,Pe)=>Ae+Pe.deckIds.length,0);v({title:"Move Series to Trash",message:`Are you sure you want to move the series "${n.name}" and all of its ${ke} deck(s) to the trash?`,onConfirm:()=>p(n.id)})},he=async()=>{N(!0);try{await h(n.id)}catch(ke){const Ae=ke instanceof Error?ke.message:"Failed to add levels.";R(Ae,"error")}finally{N(!1)}},ie=async ke=>{oe(ke);try{await C(n.id,ke)}catch(Ae){const Pe=Ae instanceof Error?Ae.message:"Failed to add decks.";R(Pe,"error")}finally{oe(null)}},be=M.useMemo(()=>Array.from(fe.values()).some(ke=>{var Ae;return(((Ae=ke.questions)==null?void 0:Ae.length)||0)===0}),[fe]),Ne=g.currentTask!==null||g.queue.length>0;return r.jsxs("div",{className:"max-w-4xl mx-auto animate-fade-in space-y-6",children:[r.jsx("div",{className:"bg-surface rounded-lg shadow-md p-6 border border-border",children:H?r.jsxs("div",{className:"space-y-4",children:[r.jsxs("div",{children:[r.jsx("label",{htmlFor:"series-name-edit",className:"block text-sm font-medium text-text-muted mb-1",children:"Series Name"}),r.jsx("input",{id:"series-name-edit",type:"text",value:W,onChange:ke=>B(ke.target.value),className:"w-full p-2 bg-background border border-border rounded-md focus:ring-2 focus:ring-primary focus:outline-none text-2xl font-bold",autoFocus:!0})]}),r.jsxs("div",{children:[r.jsx("label",{htmlFor:"series-desc-edit",className:"block text-sm font-medium text-text-muted mb-1",children:"Description"}),r.jsx("textarea",{id:"series-desc-edit",value:Y,onChange:ke=>q(ke.target.value),rows:3,className:"w-full p-2 bg-background border border-border rounded-md focus:ring-2 focus:ring-primary focus:outline-none"})]}),r.jsxs("div",{className:"flex justify-start gap-2 pt-2",children:[r.jsxs(se,{onClick:F,children:[r.jsx(J,{name:"save",className:"mr-2"})," Save Changes"]}),r.jsx(se,{variant:"secondary",onClick:()=>K(!1),children:"Cancel"})]})]}):r.jsxs("div",{children:[r.jsx("h2",{className:"text-3xl font-bold mb-2 text-text break-words",children:n.name}),r.jsxs("div",{className:"flex items-center gap-2 mb-4",children:[r.jsxs(se,{variant:"ghost",onClick:()=>K(!0),children:[r.jsx(J,{name:"edit",className:"mr-2"})," Edit"]}),r.jsxs(se,{variant:"ghost",onClick:()=>o({...n,archived:!0}),children:[r.jsx(J,{name:"archive",className:"mr-2"})," Archive"]}),r.jsxs(se,{variant:"ghost",onClick:()=>P(ke=>!ke),children:[r.jsx(J,{name:"list",className:"mr-2"})," ",T?"Done Organizing":"Organize"]})]}),r.jsx("div",{className:"text-text-muted mt-1 prose dark:prose-invert max-w-none",dangerouslySetInnerHTML:{__html:n.description}})]})}),r.jsxs("div",{className:"bg-surface rounded-lg shadow-md p-6 border border-border space-y-4",children:[r.jsxs("div",{children:[r.jsxs("div",{className:"flex justify-between items-center text-sm mb-1",children:[r.jsx("span",{className:"font-medium text-text-muted",children:"Completion"}),r.jsxs("span",{className:"font-semibold text-text-muted",children:[ye.size," / ",ue," Decks"]})]}),r.jsx(Xc,{current:ye.size,total:ue})]}),r.jsxs("div",{children:[r.jsx("h4",{className:"text-sm font-medium text-text-muted mb-1",children:"Overall Mastery"}),r.jsx(ns,{level:_})]}),r.jsxs("div",{className:"border-t border-border pt-4 flex flex-wrap items-center justify-center gap-4",children:[r.jsxs(se,{variant:"primary",size:"lg",onClick:()=>l(n.id),disabled:z===0,className:"font-semibold w-full sm:w-auto",children:[r.jsx(J,{name:"zap",className:"w-5 h-5 mr-2"}),"Study Due Items (",z,")"]}),A&&be&&r.jsxs(se,{variant:"secondary",size:"lg",onClick:()=>k(n.id),disabled:Ne,className:"font-semibold w-full sm:w-auto",children:[((Se=g.currentTask)==null?void 0:Se.seriesId)===n.id?r.jsx(Bt,{size:"sm"}):r.jsx(J,{name:"zap",className:"w-5 h-5 mr-2"}),"Generate All Questions"]})]})]}),r.jsxs("div",{className:"space-y-6",children:[n.levels.map((ke,Ae)=>{let Pe=0;for(let Ye=0;Ye<Ae;Ye++)Pe+=n.levels[Ye].deckIds.length;return r.jsxs("div",{className:"bg-surface rounded-lg shadow-md border border-border p-6",children:[r.jsx("h3",{className:"text-xl font-bold text-text mb-4",children:ke.title}),r.jsx("div",{className:"space-y-4",children:ke.deckIds.map((Ye,Re)=>{var le,ne;const E=fe.get(Ye),ge=Pe+Re,re=ye.has(Ye),$=ge>ye.size,G=Tf(E);if(!E)return r.jsxs("div",{className:"text-red-500",children:["Deck with ID ",Ye," not found."]},Ye);const ee=((le=g.currentTask)==null?void 0:le.deckId)===E.id,ce=A&&T&&(((ne=E.questions)==null?void 0:ne.length)||0)===0&&E.type===De.Quiz;return r.jsxs("div",{className:`p-4 rounded-lg flex items-center justify-between transition-opacity ${$?"opacity-50 bg-background":"bg-background"}`,children:[r.jsxs("div",{className:"flex items-center min-w-0",children:[r.jsx("div",{className:`mr-4 flex-shrink-0 ${$?"text-text-muted":re?"text-green-500":"text-primary"}`,children:$?r.jsx(J,{name:"lock"}):re?r.jsx(J,{name:"check-circle"}):r.jsx(J,{name:"unlock"})}),r.jsxs("div",{className:"min-w-0",children:[r.jsx(Tt,{href:`/decks/${E.id}?seriesId=${n.id}`,className:`font-bold truncate ${$?"text-text-muted cursor-not-allowed":"text-text hover:underline hover:text-primary"}`,onClick:je=>{$&&(je.preventDefault(),R("This deck is locked. Complete the previous deck to unlock it.","info"))},"aria-disabled":$,children:E.name}),r.jsx("div",{className:"prose prose-sm dark:prose-invert max-w-none text-text-muted truncate",title:hr(E.description),dangerouslySetInnerHTML:{__html:E.description}}),r.jsxs("p",{className:"text-xs text-text-muted mt-1 flex items-center",children:[r.jsx(J,{name:E.type===De.Learning?"book-open":"help-circle",className:"inline-block w-3.5 h-3.5 mr-1.5"}),E.questions.length," questions",!$&&r.jsx("span",{className:"mx-1.5",children:""}),!$&&`${G} due`]})]})]}),r.jsx("div",{className:"flex-shrink-0 ml-4 flex items-center gap-2",children:ee?r.jsx("div",{className:"flex items-center justify-center p-2 h-auto min-w-[6rem]",children:r.jsx(Bt,{size:"sm"})}):r.jsxs(r.Fragment,{children:[ce&&r.jsxs(se,{variant:"ghost",size:"sm",onClick:()=>I(E),disabled:Ne,children:[r.jsx(J,{name:"zap",className:"w-4 h-4 mr-1"})," Generate"]}),r.jsx(Tt,{href:`/decks/${E.id}/study?seriesId=${n.id}`,passAs:se,variant:"secondary",size:"sm",disabled:$,children:"Study"})]})})]},Ye)})}),A&&T&&r.jsx("div",{className:"mt-4 pt-4 border-t border-border/50 flex justify-end",children:r.jsxs(se,{variant:"ghost",size:"sm",onClick:()=>ie(Ae),disabled:Z===Ae||Q||Ne,children:[Z===Ae?r.jsx(Bt,{size:"sm"}):r.jsx(J,{name:"zap",className:"w-4 h-4 mr-2"}),"Add Decks with AI"]})})]},Ae)}),A&&T&&r.jsx("div",{className:"mt-4 pt-4 flex justify-center",children:r.jsxs(se,{variant:"secondary",onClick:he,disabled:Q||Z!==null||Ne,children:[Q?r.jsx(Bt,{size:"sm"}):r.jsx(J,{name:"zap",className:"w-5 h-5 mr-2"}),"Add Levels with AI"]})})]}),r.jsxs("div",{className:"bg-red-900/20 border border-red-500/30 rounded-lg p-6",children:[r.jsx("h3",{className:"text-xl font-semibold text-red-400 dark:text-red-300 mb-2",children:"Danger Zone"}),r.jsx("p",{className:"text-red-500/80 dark:text-red-300/80 mb-4",children:"Moving a series to the trash will also move all of its decks to the trash."}),r.jsxs(se,{variant:"danger",onClick:de,children:[r.jsx(J,{name:"trash-2",className:"mr-2"})," Move to Trash"]})]})]})},Yx=({onUpdateDeck:n,onUpdateSeries:i,onDeleteDeck:o,onDeleteSeries:p,openConfirmModal:d})=>{const{decks:c,deckSeries:l}=at(),f=M.useMemo(()=>c.filter(x=>x.archived&&!x.deletedAt),[c]),v=M.useMemo(()=>l.filter(x=>x.archived&&!x.deletedAt),[l]),h=x=>{n({...x,archived:!1})},C=x=>{i({...x,archived:!1})},k=x=>{d({title:"Move Deck to Trash",message:`Are you sure you want to move the archived deck "${x.name}" to the trash? This will un-archive it and place it in the trash for 10 days, after which it will be permanently deleted.`,onConfirm:()=>o(x.id)})},I=x=>{d({title:"Move Series to Trash",message:`Are you sure you want to move the archived series "${x.name}" to the trash? It will be un-archived and placed in the trash for 10 days. Decks within the series will NOT be deleted.`,onConfirm:()=>p(x.id)})};return r.jsxs("div",{className:"max-w-4xl mx-auto animate-fade-in space-y-8",children:[r.jsx("h1",{className:"text-3xl font-bold mb-6 text-text border-b border-border pb-4",children:"Archive"}),r.jsxs("section",{children:[r.jsx("h2",{className:"text-2xl font-semibold text-text mb-4",children:"Archived Series"}),v.length>0?r.jsx("div",{className:"bg-surface rounded-lg shadow-md divide-y divide-border",children:v.map(x=>r.jsxs("div",{className:"p-4 flex justify-between items-center",children:[r.jsxs("div",{className:"flex items-center min-w-0",children:[r.jsx(J,{name:"list",className:"w-6 h-6 mr-4 text-purple-500 dark:text-purple-400 flex-shrink-0"}),r.jsxs("div",{className:"min-w-0",children:[r.jsx("p",{className:"font-semibold truncate text-text",children:x.name}),r.jsx("div",{className:"prose prose-sm dark:prose-invert max-w-none text-text-muted truncate",title:hr(x.description),dangerouslySetInnerHTML:{__html:x.description}})]})]}),r.jsxs("div",{className:"flex-shrink-0 flex items-center gap-2",children:[r.jsxs(se,{variant:"secondary",size:"sm",onClick:()=>C(x),children:[r.jsx(J,{name:"unarchive",className:"w-4 h-4 mr-2"}),"Unarchive"]}),r.jsxs(se,{variant:"danger",size:"sm",onClick:()=>I(x),children:[r.jsx(J,{name:"trash-2",className:"w-4 h-4 mr-2"}),"Move to Trash"]})]})]},x.id))}):r.jsxs("div",{className:"text-center py-10 bg-surface rounded-lg border border-border",children:[r.jsx(J,{name:"archive",className:"w-12 h-12 mx-auto text-text-muted/50"}),r.jsx("h3",{className:"mt-2 text-xl font-medium text-text",children:"No Archived Series"}),r.jsx("p",{className:"mt-1 text-sm text-text-muted",children:"You can archive series from their page to hide them from the main list."})]})]}),r.jsxs("section",{children:[r.jsx("h2",{className:"text-2xl font-semibold text-text mb-4",children:"Archived Decks"}),f.length>0?r.jsx("div",{className:"bg-surface rounded-lg shadow-md divide-y divide-border",children:f.map(x=>r.jsxs("div",{className:"p-4 flex justify-between items-center",children:[r.jsxs("div",{className:"flex items-center min-w-0",children:[r.jsx(J,{name:x.type==="quiz"?"help-circle":"laptop",className:"w-6 h-6 mr-4 text-text-muted flex-shrink-0"}),r.jsxs("div",{className:"min-w-0",children:[r.jsx("p",{className:"font-semibold truncate text-text",children:x.name}),r.jsx("div",{className:"prose prose-sm dark:prose-invert max-w-none text-text-muted truncate",title:hr(x.description),dangerouslySetInnerHTML:{__html:x.description}})]})]}),r.jsxs("div",{className:"flex-shrink-0 flex items-center gap-2",children:[r.jsxs(se,{variant:"secondary",size:"sm",onClick:()=>h(x),children:[r.jsx(J,{name:"unarchive",className:"w-4 h-4 mr-2"}),"Unarchive"]}),r.jsxs(se,{variant:"danger",size:"sm",onClick:()=>k(x),children:[r.jsx(J,{name:"trash-2",className:"w-4 h-4 mr-2"}),"Move to Trash"]})]})]},x.id))}):r.jsxs("div",{className:"text-center py-10 bg-surface rounded-lg border border-border",children:[r.jsx(J,{name:"archive",className:"w-12 h-12 mx-auto text-text-muted/50"}),r.jsx("h3",{className:"mt-2 text-xl font-medium text-text",children:"No Archived Decks"}),r.jsx("p",{className:"mt-1 text-sm text-text-muted",children:"You can archive decks from their details page to hide them from view."})]})]})]})},_i=10,Af=n=>{const i=new Date(n),d=(new Date().getTime()-i.getTime())/(1e3*60*60*24);return Math.max(0,Math.ceil(_i-d))},Vx=({onRestoreDeck:n,onRestoreSeries:i,onDeleteDeckPermanently:o,onDeleteSeriesPermanently:p,openConfirmModal:d})=>{const{decks:c,deckSeries:l}=at(),f=M.useMemo(()=>c.filter(k=>k.deletedAt),[c]),v=M.useMemo(()=>l.filter(k=>k.deletedAt),[l]),h=k=>{d({title:"Permanently Delete Deck",message:`Are you sure you want to permanently delete the deck "${k.name}"? This action cannot be undone.`,onConfirm:()=>o(k.id)})},C=k=>{const I=k.levels.reduce((x,S)=>x+S.deckIds.length,0);d({title:"Permanently Delete Series",message:`Are you sure you want to permanently delete the series "${k.name}"? All ${I} deck(s) inside it will also be permanently deleted. This action cannot be undone.`,onConfirm:()=>p(k.id)})};return r.jsxs("div",{className:"max-w-4xl mx-auto animate-fade-in space-y-8",children:[r.jsxs("div",{className:"border-b border-border pb-4",children:[r.jsx("h1",{className:"text-3xl font-bold text-text",children:"Trash"}),r.jsxs("p",{className:"mt-2 text-text-muted",children:["Items in the trash will be permanently deleted after ",_i," days."]})]}),r.jsxs("section",{children:[r.jsx("h2",{className:"text-2xl font-semibold text-text mb-4",children:"Trashed Series"}),v.length>0?r.jsx("div",{className:"bg-surface rounded-lg shadow-md divide-y divide-border",children:v.map(k=>{const I=Af(k.deletedAt);return r.jsxs("div",{className:"p-4 flex justify-between items-center",children:[r.jsxs("div",{className:"flex items-center min-w-0",children:[r.jsx(J,{name:"list",className:"w-6 h-6 mr-4 text-purple-500 dark:text-purple-400 flex-shrink-0"}),r.jsxs("div",{className:"min-w-0",children:[r.jsx("p",{className:"font-semibold truncate text-text",children:k.name}),r.jsx("p",{className:`text-sm ${I<=2?"text-red-500":"text-text-muted"}`,children:I>0?`${I} days left`:"Deleting soon..."})]})]}),r.jsxs("div",{className:"flex-shrink-0 flex items-center gap-2",children:[r.jsxs(se,{variant:"secondary",size:"sm",onClick:()=>i(k.id),children:[r.jsx(J,{name:"unarchive",className:"w-4 h-4 mr-2"}),"Restore"]}),r.jsxs(se,{variant:"danger",size:"sm",onClick:()=>C(k),children:[r.jsx(J,{name:"trash-2",className:"w-4 h-4 mr-2"}),"Delete Now"]})]})]},k.id)})}):r.jsxs("div",{className:"text-center py-10 bg-surface rounded-lg border border-border",children:[r.jsx(J,{name:"trash-2",className:"w-12 h-12 mx-auto text-text-muted/50"}),r.jsx("h3",{className:"mt-2 text-xl font-medium text-text",children:"Trash is Empty"}),r.jsxs("p",{className:"mt-1 text-sm text-text-muted",children:["Deleted series will appear here for ",_i," days."]})]})]}),r.jsxs("section",{children:[r.jsx("h2",{className:"text-2xl font-semibold text-text mb-4",children:"Trashed Decks"}),f.length>0?r.jsx("div",{className:"bg-surface rounded-lg shadow-md divide-y divide-border",children:f.map(k=>{const I=Af(k.deletedAt);return r.jsxs("div",{className:"p-4 flex justify-between items-center",children:[r.jsxs("div",{className:"flex items-center min-w-0",children:[r.jsx(J,{name:k.type==="quiz"?"help-circle":"laptop",className:"w-6 h-6 mr-4 text-text-muted flex-shrink-0"}),r.jsxs("div",{className:"min-w-0",children:[r.jsx("p",{className:"font-semibold truncate text-text",children:k.name}),r.jsx("p",{className:`text-sm ${I<=2?"text-red-500":"text-text-muted"}`,children:I>0?`${I} days left`:"Deleting soon..."})]})]}),r.jsxs("div",{className:"flex-shrink-0 flex items-center gap-2",children:[r.jsxs(se,{variant:"secondary",size:"sm",onClick:()=>n(k.id),children:[r.jsx(J,{name:"unarchive",className:"w-4 h-4 mr-2"}),"Restore"]}),r.jsxs(se,{variant:"danger",size:"sm",onClick:()=>h(k),children:[r.jsx(J,{name:"trash-2",className:"w-4 h-4 mr-2"}),"Delete Now"]})]})]},k.id)})}):r.jsxs("div",{className:"text-center py-10 bg-surface rounded-lg border border-border",children:[r.jsx(J,{name:"trash-2",className:"w-12 h-12 mx-auto text-text-muted/50"}),r.jsx("h3",{className:"mt-2 text-xl font-medium text-text",children:"Trash is Empty"}),r.jsxs("p",{className:"mt-1 text-sm text-text-muted",children:["Deleted decks will appear here for ",_i," days."]})]})]})]})},um=({series:n,completedCount:i,dueCount:o,onStartSeriesStudy:p,masteryLevel:d,nextUpDeckId:c,onGenerateAllQuestions:l})=>{var x;const{aiGenerationStatus:f,decks:v}=at(),h=n.levels.reduce((S,g)=>S+g.deckIds.length,0),C=i>=h&&h>0,k=((x=f.currentTask)==null?void 0:x.seriesId)===n.id,I=M.useMemo(()=>{const S=new Set(n.levels.flatMap(b=>b.deckIds));return v.filter(b=>S.has(b.id)).some(b=>{var j;return(b.type===De.Quiz||b.type===De.Learning)&&(((j=b.questions)==null?void 0:j.length)||0)===0})},[n.levels,v]);return r.jsx(Tt,{href:`/series/${n.id}`,className:"block bg-surface rounded-lg shadow-md hover:shadow-lg transition-all duration-200 border border-transparent hover:border-primary",children:r.jsxs("div",{className:"p-4",children:[r.jsxs("div",{className:"flex items-start justify-between",children:[r.jsxs("div",{className:"flex-1 min-w-0 mr-4",children:[r.jsxs("div",{className:"flex items-center mb-1",children:[r.jsx(J,{name:"layers",className:"w-5 h-5 mr-2 text-purple-500 dark:text-purple-400"}),r.jsx("h3",{className:"text-xl font-bold text-text break-words",children:n.name})]}),n.description&&r.jsx("div",{className:"prose prose-sm dark:prose-invert max-w-none text-text-muted mt-1 truncate",title:hr(n.description),dangerouslySetInnerHTML:{__html:n.description}})]}),C&&r.jsxs("div",{className:"flex-shrink-0 flex items-center gap-2 text-green-500 dark:text-green-400 bg-green-100 dark:bg-green-900/50 px-3 py-1 rounded-full",children:[r.jsx(J,{name:"check-circle",className:"w-4 h-4"}),r.jsx("span",{className:"text-sm font-semibold",children:"Completed"})]})]}),h>0&&r.jsxs("div",{className:"mt-3 space-y-3",children:[r.jsxs("div",{children:[r.jsxs("div",{className:"flex justify-between items-center text-sm mb-1",children:[r.jsx("span",{className:"font-medium text-text-muted",children:"Completion"}),r.jsxs("span",{className:"font-semibold text-text-muted",children:[i," / ",h]})]}),r.jsx(Xc,{current:i,total:h})]}),r.jsx("div",{children:r.jsx(ns,{level:d})})]}),r.jsx("div",{className:"mt-4 pt-4 border-t border-border/50 flex justify-end gap-2",children:k?r.jsxs("div",{className:"flex items-center text-text-muted",children:[r.jsx(Bt,{size:"sm"}),r.jsx("span",{className:"ml-2 text-sm font-semibold",children:"Generating..."})]}):r.jsxs(r.Fragment,{children:[c&&r.jsxs(Tt,{href:`/decks/${c}/study?seriesId=${n.id}`,passAs:se,variant:"primary",size:"sm",onClick:S=>{S.stopPropagation()},children:[r.jsx(J,{name:"laptop",className:"w-4 h-4 mr-2"}),"Continue"]}),I&&o===0&&!c&&l&&r.jsxs(se,{variant:"secondary",size:"sm",onClick:S=>{S.preventDefault(),S.stopPropagation(),l(n.id)},children:[r.jsx(J,{name:"zap",className:"w-4 h-4 mr-2"}),"Generate Questions"]}),r.jsxs(se,{variant:"secondary",size:"sm",onClick:S=>{S.preventDefault(),S.stopPropagation(),p(n.id)},disabled:o===0,children:[r.jsx(J,{name:"zap",className:"w-4 h-4 mr-2"}),"Study Due (",o,")"]})]})})]})})},Kx=n=>{const i=new Date;i.setHours(23,59,59,999);const o=n.type===De.Quiz||n.type===De.Learning?n.questions:n.cards;return Array.isArray(o)?o.filter(p=>!p.suspended&&new Date(p.dueDate)<=i).length:0},tu=({deck:n,sessionsToResume:i,onUpdateLastOpened:o,draggedDeckId:p,onDragStart:d,onDragEnd:c,onUpdateDeck:l,onDeleteDeck:f,openConfirmModal:v,onGenerateQuestionsForDeck:h,onGenerateContentForLearningDeck:C})=>{const{navigate:k}=Cn(),{aiGenerationStatus:I}=at(),{aiFeaturesEnabled:x}=rn(),S=Kx(n),g=i.has(n.id),b=n.type===De.Quiz||n.type===De.Learning?n.questions:n.cards,j=(b==null?void 0:b.length)||0;let O,R;n.type===De.Quiz||n.type===De.Learning?(O=j===1?"question":"questions",R=n.type===De.Learning?"book-open":"help-circle"):(O=j===1?"card":"cards",R="laptop");const[A,T]=M.useState(!1),P=M.useRef(null),H=M.useMemo(()=>{const{currentTask:N,queue:Z}=I;return(N==null?void 0:N.deckId)===n.id?!0:Z.some(oe=>oe.deckId===n.id)},[I,n.id]),K=(n.type===De.Quiz||n.type===De.Learning)&&j===0;M.useEffect(()=>{const N=Z=>{P.current&&!P.current.contains(Z.target)&&T(!1)};return A?document.addEventListener("mousedown",N):document.removeEventListener("mousedown",N),()=>document.removeEventListener("mousedown",N)},[A]);const W=N=>{N.target.closest("button, a")||(o(n.id),k(`/decks/${n.id}`))},B=N=>{N.stopPropagation(),l({...n,archived:!0}),T(!1)},Y=N=>{N.stopPropagation(),v({title:"Move Deck to Trash",message:`Are you sure you want to move the deck "${n.name}" to the trash?`,onConfirm:()=>f(n.id)}),T(!1)},q=M.useMemo(()=>{const N=b==null?void 0:b.filter(oe=>!oe.suspended);return!N||N.length===0?0:N.reduce((oe,fe)=>oe+nn(fe),0)/N.length},[b]),Q=N=>{N.stopPropagation(),n.type===De.Quiz&&h?h(n):n.type===De.Learning&&C&&C(n)};return r.jsx("div",{draggable:!0,onDragStart:N=>{N.dataTransfer.setData("text/plain",n.id),d(n.id)},onDragEnd:c,onClick:W,className:`bg-surface rounded-lg shadow-md hover:shadow-lg transition-all duration-200 border border-transparent hover:border-primary cursor-pointer relative ${p===n.id?"opacity-50 scale-95":""}`,children:r.jsxs("div",{className:"p-4",children:[r.jsxs("div",{className:"flex items-start justify-between",children:[r.jsxs("div",{className:"flex-1 min-w-0 mr-4",children:[r.jsxs("div",{className:"flex items-center mb-1",children:[r.jsx(J,{name:R,className:"w-5 h-5 mr-2 text-text-muted"}),r.jsx("h3",{className:"text-xl font-bold text-text break-words",children:n.name})]}),n.description&&r.jsx("div",{className:"prose prose-sm dark:prose-invert max-w-none text-text-muted mt-1 truncate",title:hr(n.description),dangerouslySetInnerHTML:{__html:n.description}})]}),r.jsxs("div",{className:"flex-shrink-0 flex items-center gap-1",ref:P,children:[r.jsx(se,{variant:"ghost",className:"p-2 h-auto",onClick:N=>{N.stopPropagation(),T(Z=>!Z)},"aria-label":`More options for deck ${n.name}`,children:r.jsx(J,{name:"more-vertical",className:"w-5 h-5"})}),A&&r.jsxs("div",{className:"absolute top-12 right-4 w-48 bg-surface rounded-md shadow-lg py-1 z-10 ring-1 ring-black ring-opacity-5 animate-fade-in",style:{animationDuration:"150ms"},onClick:N=>N.stopPropagation(),children:[r.jsxs("button",{type:"button",onClick:B,className:"flex items-center w-full px-4 py-2 text-sm text-left text-text hover:bg-border/20",children:[r.jsx(J,{name:"archive",className:"w-4 h-4 mr-3"})," Archive"]}),r.jsx("div",{className:"border-t border-border my-1"}),r.jsxs("button",{type:"button",onClick:Y,className:"flex items-center w-full px-4 py-2 text-sm text-left text-red-600 dark:text-red-400 hover:bg-red-50 dark:hover:bg-red-900/20",children:[r.jsx(J,{name:"trash-2",className:"w-4 h-4 mr-3"})," Move to Trash"]})]})]})]}),r.jsxs("div",{className:"mt-3 space-y-3",children:[r.jsx(ns,{level:q}),r.jsxs("div",{className:"flex justify-between items-center",children:[r.jsxs("p",{className:"text-sm text-text-muted",children:[j," ",O]}),r.jsxs("p",{className:`text-sm font-semibold ${S>0?"text-primary":"text-text-muted"}`,children:[S," due"]})]})]}),r.jsx("div",{className:"mt-4 pt-4 border-t border-border/50 flex justify-end gap-2",children:H?r.jsxs("div",{className:"flex items-center text-text-muted",children:[r.jsx(Bt,{size:"sm"}),r.jsx("span",{className:"ml-2 text-sm font-semibold",children:"Generating..."})]}):r.jsxs(r.Fragment,{children:[K&&x&&r.jsxs(se,{variant:"secondary",size:"sm",onClick:Q,children:[r.jsx(J,{name:"zap",className:"w-4 h-4 mr-2"}),"Generate Content"]}),r.jsxs(Tt,{href:`/decks/${n.id}/study`,passAs:se,variant:"primary",size:"sm",disabled:n.locked||S===0&&!g||j===0,onClick:N=>{N.stopPropagation(),o(n.id)},children:[r.jsx(J,{name:n.locked?"lock":g?"zap":"laptop",className:"w-4 h-4 mr-2"}),g?"Resume":"Study"]})]})})]})})},Jx=n=>{const i=new Date;i.setHours(23,59,59,999);const o=n.type===De.Quiz||n.type===De.Learning?n.questions:n.cards;return Array.isArray(o)?o.filter(p=>!p.suspended&&new Date(p.dueDate)<=i).length:0},Zx=({totalDueQuestions:n,onStartGeneralStudy:i,sessionsToResume:o,onUpdateLastOpened:p,onUpdateDeck:d,onDeleteDeck:c,openConfirmModal:l,seriesProgress:f,onStartSeriesStudy:v,onGenerateQuestionsForDeck:h,onGenerateContentForLearningDeck:C,onGenerateQuestionsForEmptyDecksInSeries:k})=>{const{decks:I,deckSeries:x}=at(),{recentDecks:S,recentSeries:g,seriesData:b}=M.useMemo(()=>{const j=new Set;x.forEach(H=>{(H.levels||[]).forEach(K=>(K.deckIds||[]).forEach(W=>j.add(W)))});const O=I.filter(H=>!H.archived&&!H.deletedAt&&!j.has(H.id)),A=[...x.filter(H=>!H.archived&&!H.deletedAt)].sort((H,K)=>{const W=H.levels.flatMap(Q=>Q.deckIds).map(Q=>I.find(N=>N.id===Q)).filter(Boolean),B=K.levels.flatMap(Q=>Q.deckIds).map(Q=>I.find(N=>N.id===Q)).filter(Boolean),Y=Math.max(new Date(H.lastOpened||H.createdAt||0).getTime(),...W.map(Q=>new Date(Q.lastOpened||0).getTime()));return Math.max(new Date(K.lastOpened||K.createdAt||0).getTime(),...B.map(Q=>new Date(Q.lastOpened||0).getTime()))-Y}).slice(0,2),T=[...O].sort((H,K)=>(K.lastOpened||"").localeCompare(H.lastOpened||"")).slice(0,2),P=new Map;return x.forEach(H=>{var Z;const K=(H.levels||[]).flatMap(oe=>oe.deckIds||[]).map(oe=>I.find(fe=>fe.id===oe)).filter(Boolean),W=((Z=f.get(H.id))==null?void 0:Z.size)||0,B=new Set;(H.levels||[]).flatMap(oe=>oe.deckIds||[]).forEach((oe,fe)=>{fe<=W&&B.add(oe)});const q=K.reduce((oe,fe)=>B.has(fe.id)?oe+Jx(fe):oe,0),Q=K.flatMap(oe=>oe.type===De.Flashcard?oe.cards:oe.questions||[]).filter(oe=>!oe.suspended),N=Q.length>0?Q.reduce((oe,fe)=>oe+nn(fe),0)/Q.length:0;P.set(H.id,{dueCount:q,mastery:N})}),{recentDecks:T,recentSeries:A,seriesData:P}},[I,x,f]);return r.jsxs("div",{className:"space-y-12",children:[n>0&&r.jsx("div",{className:"mb-6",children:r.jsxs(se,{onClick:i,variant:"primary",className:"w-full sm:w-auto text-lg py-3",children:[r.jsx(J,{name:"zap",className:"w-5 h-5 mr-2"}),"Study All Due Items (",n,")"]})}),g.length>0&&r.jsxs("section",{children:[r.jsxs("div",{className:"flex justify-between items-center mb-4",children:[r.jsx("h2",{className:"text-3xl font-bold text-gray-900 dark:text-gray-100",children:"Recent Series"}),r.jsxs(Tt,{href:"/series",passAs:se,variant:"ghost",children:["View all ",r.jsx(J,{name:"chevron-left",className:"w-4 h-4 ml-2 rotate-180"})]})]}),r.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:g.map(j=>{var P;const O=b.get(j.id)||{dueCount:0,mastery:0},R=f.get(j.id)||new Set,T=(j.levels||[]).flatMap(H=>H.deckIds||[]).find(H=>!R.has(H))||null;return r.jsx(um,{series:j,completedCount:((P=f.get(j.id))==null?void 0:P.size)||0,dueCount:O.dueCount,masteryLevel:O.mastery,onStartSeriesStudy:v,nextUpDeckId:T,onGenerateAllQuestions:k},j.id)})})]}),S.length>0&&r.jsxs("section",{children:[r.jsxs("div",{className:"flex justify-between items-center mb-4",children:[r.jsx("h2",{className:"text-3xl font-bold text-gray-900 dark:text-gray-100",children:"Recent Decks"}),r.jsxs(Tt,{href:"/decks",passAs:se,variant:"ghost",children:["View all ",r.jsx(J,{name:"chevron-left",className:"w-4 h-4 ml-2 rotate-180"})]})]}),r.jsx("div",{className:"space-y-4",children:S.map(j=>r.jsx(tu,{deck:j,sessionsToResume:o,onUpdateLastOpened:p,draggedDeckId:null,onDragStart:()=>{},onDragEnd:()=>{},onUpdateDeck:d,onDeleteDeck:c,openConfirmModal:l,onGenerateQuestionsForDeck:h,onGenerateContentForLearningDeck:C},j.id))})]})]})},Xx=({folder:n,decks:i,isOpen:o,onToggle:p,sessionsToResume:d,onUpdateLastOpened:c,onDeleteFolder:l,draggedDeckId:f,onDragStart:v,onDragEnd:h,onMoveDeck:C,onUpdateDeck:k,onDeleteDeck:I,openConfirmModal:x,onSaveFolder:S,onGenerateQuestionsForDeck:g,onGenerateContentForLearningDeck:b})=>{const[j,O]=M.useState(!1),[R,A]=M.useState(!1),[T,P]=M.useState(n.name),H=M.useRef(null),{addToast:K}=Kt();M.useEffect(()=>{R&&H.current&&(H.current.focus(),H.current.select())},[R]);const W=Z=>{Z.stopPropagation(),P(n.name),A(!0)},B=Z=>{Z.stopPropagation(),A(!1)},Y=Z=>{if(Z==null||Z.stopPropagation(),T.trim()===""){K("Folder name cannot be empty.","error");return}S({id:n.id,name:T.trim()}),A(!1)},q=Z=>{Z.preventDefault(),Z.stopPropagation();const oe=Z.dataTransfer.getData("text/plain");oe&&oe===f&&(C(oe,n.id),h()),O(!1)},Q=Z=>{Z.preventDefault(),Z.dataTransfer.dropEffect="move",O(!0)},N=()=>{O(!1)};return r.jsxs("div",{className:`rounded-lg transition-all duration-200 ${j?"bg-primary/20 ring-2 ring-primary ring-inset":"bg-surface border border-border"}`,onDrop:q,onDragOver:Q,onDragLeave:N,children:[r.jsx("div",{className:"border-b border-border",children:r.jsxs("div",{onClick:R?void 0:p,className:"w-full flex justify-between items-center text-left p-4 cursor-pointer","aria-expanded":o,children:[r.jsxs("div",{className:"flex items-center flex-grow min-w-0",children:[r.jsx(J,{name:"chevron-down",className:`w-5 h-5 transition-transform duration-300 mr-3 ${o?"":"-rotate-90"} text-text-muted`}),R?r.jsxs("div",{className:"flex items-center flex-grow gap-2 min-w-0",onClick:Z=>Z.stopPropagation(),children:[r.jsx(J,{name:"folder",className:"w-6 h-6 text-yellow-600 dark:text-yellow-500 flex-shrink-0"}),r.jsx("input",{ref:H,type:"text",value:T,onChange:Z=>P(Z.target.value),onKeyDown:Z=>{Z.key==="Enter"&&Y(Z),Z.key==="Escape"&&B(Z)},className:"text-xl font-bold p-1 bg-background rounded-md w-full"})]}):r.jsxs(r.Fragment,{children:[r.jsx(J,{name:"folder",className:"w-6 h-6 mr-3 text-yellow-600 dark:text-yellow-500"}),r.jsx("h3",{className:"text-xl font-bold text-text truncate",children:n.name})]})]}),r.jsx("div",{className:"flex items-center gap-1 flex-shrink-0",children:R?r.jsxs(r.Fragment,{children:[r.jsx(se,{variant:"primary",size:"sm",onClick:Y,"aria-label":`Save changes for folder ${n.name}`,children:"Save"}),r.jsx(se,{variant:"secondary",size:"sm",onClick:B,"aria-label":"Cancel editing",children:"Cancel"})]}):r.jsxs(r.Fragment,{children:[r.jsx(se,{variant:"ghost",className:"p-2 h-auto",onClick:W,"aria-label":`Edit folder ${n.name}`,children:r.jsx(J,{name:"edit",className:"w-4 h-4"})}),r.jsx(se,{variant:"ghost",className:"p-2 h-auto hover:text-red-500",onClick:Z=>{Z.stopPropagation(),l(n.id)},"aria-label":`Delete folder ${n.name}`,children:r.jsx(J,{name:"trash-2",className:"w-4 h-4"})})]})})]})}),o&&r.jsx("div",{className:"p-4 space-y-4",children:i.length>0?i.map(Z=>r.jsx(tu,{deck:Z,sessionsToResume:d,onUpdateLastOpened:c,draggedDeckId:f,onDragStart:v,onDragEnd:h,onUpdateDeck:k,onDeleteDeck:I,openConfirmModal:x,onGenerateQuestionsForDeck:g,onGenerateContentForLearningDeck:b},Z.id)):r.jsxs("div",{className:"flex flex-col items-center justify-center p-6 border-2 border-dashed border-border rounded-md m-4 text-center",children:[r.jsx(J,{name:"grip-vertical",className:"w-8 h-8 text-text-muted mb-2"}),r.jsx("p",{className:"text-sm font-medium text-text-muted",children:"Drag a deck here to organize it!"})]})})]})},ey=({decks:n,folders:i,sessionsToResume:o,onUpdateLastOpened:p,onDeleteFolder:d,draggedDeckId:c,onDragStart:l,onDragEnd:f,onMoveDeck:v,openFolderIds:h,onToggleFolder:C,onUpdateDeck:k,onDeleteDeck:I,openConfirmModal:x,onSaveFolder:S,onGenerateQuestionsForDeck:g,onGenerateContentForLearningDeck:b})=>{const{decksByFolder:j,ungroupedDecks:O}=M.useMemo(()=>{const H=new Map,K=[];return n.forEach(W=>{W.folderId&&i.some(B=>B.id===W.folderId)?(H.has(W.folderId)||H.set(W.folderId,[]),H.get(W.folderId).push(W)):K.push(W)}),{decksByFolder:H,ungroupedDecks:K}},[n,i]),[R,A]=M.useState(!1),T=H=>{H.preventDefault();const K=H.dataTransfer.getData("text/plain");K&&K===c&&(v(K,null),f()),A(!1)},P=H=>{H.preventDefault(),H.dataTransfer.dropEffect="move",A(!0)};return r.jsxs("div",{className:"space-y-4",children:[i.map(H=>r.jsx(Xx,{folder:H,decks:j.get(H.id)||[],isOpen:h.has(H.id),onToggle:()=>C(H.id),sessionsToResume:o,onUpdateLastOpened:p,onDeleteFolder:d,draggedDeckId:c,onDragStart:l,onDragEnd:f,onMoveDeck:v,onUpdateDeck:k,onDeleteDeck:I,openConfirmModal:x,onSaveFolder:S,onGenerateQuestionsForDeck:g,onGenerateContentForLearningDeck:b},H.id)),r.jsx("div",{onDrop:T,onDragOver:P,onDragLeave:()=>A(!1),className:`p-2 -m-2 rounded-lg transition-all duration-200 ${R?"bg-primary/20 ring-2 ring-primary ring-inset":""}`,children:r.jsx("div",{className:"space-y-4",children:O.map(H=>r.jsx(tu,{deck:H,sessionsToResume:o,onUpdateLastOpened:p,draggedDeckId:c,onDragStart:l,onDragEnd:f,onUpdateDeck:k,onDeleteDeck:I,openConfirmModal:x,onGenerateQuestionsForDeck:g,onGenerateContentForLearningDeck:b},H.id))})})]})},ty=[{key:"lastOpened",label:"Recent"},{key:"name",label:"Name"},{key:"dueCount",label:"Due"}],qc=({currentSort:n,onSortChange:i,sortOptions:o})=>{const p=o??ty;return r.jsx("div",{className:"inline-flex rounded-md shadow-sm bg-gray-100 dark:bg-gray-800 p-1",role:"group",children:p&&p.map((d,c)=>r.jsx("button",{type:"button",onClick:()=>i(d.key),className:`px-4 py-1.5 text-sm font-medium transition-colors focus:z-10 focus:outline-none focus:ring-2 focus:ring-blue-500
            ${n===d.key?"bg-white dark:bg-gray-700 text-blue-600 dark:text-blue-300 shadow-sm":"text-gray-600 dark:text-gray-400 hover:bg-gray-200/50 dark:hover:bg-gray-700/50"}
            ${c===0?"rounded-l-md":""}
            ${c===p.length-1?"rounded-r-md":""}
          `,"aria-pressed":n===d.key,children:d.label},d.key))})},Ei=n=>{const i=new Date;i.setHours(23,59,59,999);const o=n.type==="quiz"||n.type==="learning"?n.questions:n.cards;return Array.isArray(o)?o.filter(p=>!p.suspended&&new Date(p.dueDate)<=i).length:0},ry=n=>{const[i,o]=M.useState(""),p=at(v=>v.folders),d=nm(),c=M.useMemo(()=>{const v=i.toLowerCase().trim();if(!v){const k=[...d];switch(n.sortPreference){case"name":return k.sort((I,x)=>I.name.localeCompare(x.name));case"dueCount":return k.sort((I,x)=>Ei(x)-Ei(I));case"lastOpened":default:return k.sort((I,x)=>(x.lastOpened||"").localeCompare(I.lastOpened||""))}}const h=v.split(/\s+/).filter(Boolean),C=d.map(k=>{let I=0;const x=k.name.toLowerCase(),S=hr(k.description).toLowerCase();x.startsWith(v)?I+=20:x.includes(v)&&(I+=10),S.includes(v)&&(I+=2);for(const j of h)x.includes(j)&&(I+=5),S.includes(j)&&(I+=1);const g=k.type===De.Flashcard?k.cards:(k.type===De.Learning,k.questions);let b=0;if(g)for(const j of g){let O;if(k.type===De.Flashcard){const R=j;O=hr(`${R.front} ${R.back}`).toLowerCase()}else{const R=j,A=R.options.map(T=>T.text).join(" ");O=hr(`${R.questionText} ${A} ${R.detailedExplanation}`).toLowerCase()}h.some(R=>O.includes(R))&&b++}return I+=Math.min(b,20)*.5,{deck:k,score:I}}).filter(({score:k})=>k>0);return C.sort((k,I)=>{if(k.score!==I.score)return I.score-k.score;switch(n.sortPreference){case"name":return k.deck.name.localeCompare(I.deck.name);case"dueCount":return Ei(I.deck)-Ei(k.deck);case"lastOpened":default:return(I.deck.lastOpened||"").localeCompare(k.deck.lastOpened||"")}}),C.map(({deck:k})=>k)},[d,i,n.sortPreference]),l=M.useMemo(()=>[...p].sort((v,h)=>v.name.localeCompare(h.name)),[p]);return d.length>0||p.length>0?r.jsxs("div",{className:"space-y-6",children:[r.jsxs("div",{className:"flex flex-col sm:flex-row justify-between items-center gap-4",children:[r.jsx("h1",{className:"text-3xl font-bold text-text",children:"All Decks"}),r.jsxs(se,{variant:"primary",onClick:n.onImportDecks,children:[r.jsx(J,{name:"plus",className:"w-5 h-5 mr-2"}),"Create / Import Deck"]})]}),r.jsxs("div",{className:"flex flex-col md:flex-row justify-between items-center gap-4 p-4 bg-surface rounded-lg border border-border",children:[r.jsxs("div",{className:"relative w-full md:max-w-xs",children:[r.jsx(J,{name:"search",className:"absolute left-3 top-1/2 -translate-y-1/2 w-5 h-5 text-text-muted"}),r.jsx("input",{type:"text",placeholder:"Search decks...",value:i,onChange:v=>o(v.target.value),className:"w-full pl-10 pr-4 py-2 bg-background border border-border rounded-md focus:ring-2 focus:ring-primary focus:outline-none"})]}),r.jsxs("div",{className:"flex flex-wrap items-center justify-center gap-2",children:[r.jsxs(se,{variant:"ghost",onClick:n.onNewFolder,children:[r.jsx(J,{name:"folder-plus",className:"w-5 h-5 mr-2"}),r.jsx("span",{className:"hidden sm:inline",children:"New Folder"})]}),r.jsx(qc,{currentSort:n.sortPreference,onSortChange:n.onSortChange})]})]}),c.length===0&&i?r.jsxs("div",{className:"text-center py-20",children:[r.jsx(J,{name:"search",className:"w-16 h-16 mx-auto text-text-muted/50"}),r.jsx("h2",{className:"mt-4 text-2xl font-bold text-text-muted",children:"No Decks Found"}),r.jsxs("p",{className:"mt-2 text-text-muted",children:['Your search for "',i,'" did not match any decks.']}),r.jsx(se,{variant:"secondary",onClick:()=>o(""),className:"mt-6",children:"Clear Search"})]}):r.jsx(ey,{decks:c,folders:l,sessionsToResume:n.sessionsToResume,onUpdateLastOpened:n.onUpdateLastOpened,onDeleteFolder:n.onDeleteFolder,draggedDeckId:n.draggedDeckId,onDragStart:n.onDragStart,onDragEnd:n.onDragEnd,onMoveDeck:n.onMoveDeck,openFolderIds:n.openFolderIds,onToggleFolder:n.onToggleFolder,onUpdateDeck:n.onUpdateDeck,onDeleteDeck:n.onDeleteDeck,openConfirmModal:n.openConfirmModal,onSaveFolder:n.handleSaveFolder,onGenerateQuestionsForDeck:n.onGenerateQuestionsForDeck,onGenerateContentForLearningDeck:n.onGenerateContentForLearningDeck})]}):r.jsxs("div",{className:"text-center py-20",children:[r.jsx(J,{name:"folder",className:"w-16 h-16 mx-auto text-gray-300 dark:text-gray-600"}),r.jsx("h2",{className:"mt-4 text-2xl font-bold text-text-muted",children:"Your deck collection is empty"}),r.jsx("p",{className:"mt-2 text-text-muted",children:"Create a new deck, import from a file, or try a sample deck to get started."}),r.jsxs("div",{className:"flex flex-col sm:flex-row items-center justify-center gap-4 mt-8",children:[r.jsxs(se,{onClick:n.onImportDecks,children:[r.jsx(J,{name:"plus",className:"w-5 h-5 mr-2"}),"Create or Import Deck"]}),r.jsxs(se,{onClick:n.onCreateSampleDeck,variant:"secondary",children:[r.jsx(J,{name:"laptop",className:"w-5 h-5 mr-2"}),"Create Sample Deck"]})]})]})},ny=n=>{const i=new Date;i.setHours(23,59,59,999);const o=n.type==="quiz"||n.type==="learning"?n.questions:n.cards;return Array.isArray(o)?o.filter(p=>!p.suspended&&new Date(p.dueDate)<=i).length:0},sy=({onStartSeriesStudy:n,onCreateNewSeries:i,onCreateSampleSeries:o,onGenerateAI:p,onGenerateQuestionsForEmptyDecksInSeries:d})=>{const{deckSeries:c,decks:l,seriesProgress:f}=at(),{aiFeaturesEnabled:v}=rn(),[h,C]=M.useState(""),[k,I]=M.useState("recent"),[x,S]=M.useState("all"),g=M.useMemo(()=>c.filter(A=>!A.archived&&!A.deletedAt),[c]),b=M.useMemo(()=>{const A=new Map;return g.forEach(T=>{var Q;const P=(T.levels||[]).flatMap(N=>N.deckIds||[]).map(N=>l.find(Z=>Z.id===N)).filter(Boolean),H=((Q=f.get(T.id))==null?void 0:Q.size)||0,K=new Set;(T.levels||[]).flatMap(N=>N.deckIds||[]).forEach((N,Z)=>{Z<=H&&K.add(N)});const B=P.reduce((N,Z)=>K.has(Z.id)?N+ny(Z):N,0),Y=P.flatMap(N=>N.type===De.Flashcard?N.cards:N.questions).filter(N=>!N.suspended),q=Y.length>0?Y.reduce((N,Z)=>N+nn(Z),0)/Y.length:0;A.set(T.id,{dueCount:B,mastery:q})}),A},[g,l,f]),j=M.useMemo(()=>{let A=g.filter(T=>T.name.toLowerCase().includes(h.toLowerCase())||T.description.toLowerCase().includes(h.toLowerCase()));switch(x!=="all"&&(A=A.filter(T=>{var W;const P=(T.levels||[]).reduce((B,Y)=>B+(Y.deckIds||[]).length,0);if(P===0)return x==="inProgress";const K=(((W=f.get(T.id))==null?void 0:W.size)||0)>=P;return x==="completed"?K:!K})),k){case"recent":return A.sort((T,P)=>{const H=new Date(T.lastOpened||T.createdAt||0).getTime();return new Date(P.lastOpened||P.createdAt||0).getTime()-H});case"progress":return A.sort((T,P)=>{var W,B;const H=(((W=f.get(T.id))==null?void 0:W.size)||0)/((T.levels||[]).reduce((Y,q)=>Y+(q.deckIds||[]).length,0)||1);return(((B=f.get(P.id))==null?void 0:B.size)||0)/((P.levels||[]).reduce((Y,q)=>Y+(q.deckIds||[]).length,0)||1)-H});case"mastery":return A.sort((T,P)=>{var W,B;const H=((W=b.get(T.id))==null?void 0:W.mastery)||0;return(((B=b.get(P.id))==null?void 0:B.mastery)||0)-H});case"name":default:return A.sort((T,P)=>T.name.localeCompare(P.name))}},[g,h,k,x,f,b]),O=[{key:"recent",label:"Recent"},{key:"name",label:"Name"},{key:"progress",label:"Progress"},{key:"mastery",label:"Mastery"}],R=[{key:"all",label:"All"},{key:"inProgress",label:"In Progress"},{key:"completed",label:"Completed"}];return r.jsxs("div",{className:"space-y-6",children:[r.jsxs("div",{className:"flex flex-col sm:flex-row justify-between items-center gap-4",children:[r.jsx("h1",{className:"text-3xl font-bold text-text",children:"All Series"}),r.jsxs("div",{className:"flex gap-2",children:[v&&r.jsxs(se,{variant:"primary",onClick:p,children:[r.jsx(J,{name:"zap",className:"w-5 h-5 mr-2"}),"Generate with AI"]}),r.jsxs(se,{variant:"secondary",onClick:i,children:[r.jsx(J,{name:"layers",className:"w-5 h-5 mr-2"}),"Create New Series"]})]})]}),r.jsxs("div",{className:"flex flex-col md:flex-row justify-between items-center gap-4 p-4 bg-surface rounded-lg border border-border",children:[r.jsxs("div",{className:"relative w-full md:max-w-xs",children:[r.jsx(J,{name:"search",className:"absolute left-3 top-1/2 -translate-y-1/2 w-5 h-5 text-text-muted"}),r.jsx("input",{type:"text",placeholder:"Search series...",value:h,onChange:A=>C(A.target.value),className:"w-full pl-10 pr-4 py-2 bg-background border border-border rounded-md focus:ring-2 focus:ring-primary focus:outline-none"})]}),r.jsxs("div",{className:"flex flex-wrap items-center justify-center gap-4",children:[r.jsxs("div",{className:"flex items-center gap-2",children:[r.jsx(J,{name:"filter",className:"w-5 h-5 text-text-muted"}),r.jsx(qc,{currentSort:x,onSortChange:A=>S(A),sortOptions:R})]}),r.jsx(qc,{currentSort:k,onSortChange:A=>I(A),sortOptions:O})]})]}),j.length>0?r.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:j.map(A=>{const T=b.get(A.id)||{dueCount:0,mastery:0},P=f.get(A.id)||new Set,K=(A.levels||[]).flatMap(W=>W.deckIds||[]).find(W=>!P.has(W))||null;return r.jsx(um,{series:A,completedCount:P.size,dueCount:T.dueCount,masteryLevel:T.mastery,onStartSeriesStudy:n,nextUpDeckId:K,onGenerateAllQuestions:d},A.id)})}):r.jsxs("div",{className:"text-center py-10",children:[r.jsx(J,{name:"layers",className:"w-12 h-12 mx-auto text-gray-300 dark:text-gray-600"}),r.jsx("h3",{className:"mt-2 text-xl font-medium text-text",children:h?"No series found":"Your series collection is empty"}),r.jsx("p",{className:"mt-1 text-sm text-text-muted",children:h?"Try adjusting your search or filter.":"Create a new series or try a sample to get started."}),!h&&g.length===0&&r.jsx("div",{className:"mt-6",children:r.jsxs(se,{onClick:o,variant:"secondary",children:[r.jsx(J,{name:"zap",className:"w-4 h-4 mr-2"})," Create Sample Series"]})})]})]})},Mc=({icon:n,label:i,value:o})=>r.jsxs("div",{className:"bg-surface p-6 rounded-lg shadow-md border border-border flex items-center",children:[r.jsx("div",{className:"flex-shrink-0",children:n}),r.jsxs("div",{className:"ml-5 w-0 flex-1",children:[r.jsx("dt",{className:"text-sm font-medium text-text-muted truncate",children:i}),r.jsx("dd",{className:"text-2xl font-bold text-text",children:o})]})]}),ay=({stats:n})=>r.jsxs("div",{className:"grid grid-cols-1 gap-5 sm:grid-cols-3",children:[r.jsx(Mc,{icon:r.jsx(J,{name:"zap",className:"h-8 w-8 text-orange-400"}),label:"Current Streak",value:`${n.streak} day${n.streak!==1?"s":""}`}),r.jsx(Mc,{icon:r.jsx(J,{name:"check-circle",className:"h-8 w-8 text-blue-400"}),label:"Total Reviews",value:n.totalReviews.toLocaleString()}),r.jsx(Mc,{icon:r.jsx(J,{name:"trending-up",className:"h-8 w-8 text-green-400"}),label:"Mature Items",value:n.matureCount.toLocaleString()})]}),oy=({reviews:n})=>{const{grid:i,maxCount:o}=M.useMemo(()=>{const c=new Date;c.setHours(0,0,0,0);const l=new Date(c);l.setDate(l.getDate()+1);const f=new Date(l);f.setDate(f.getDate()-364-c.getDay());const v=new Map;n.forEach(I=>{const x=new Date(I.timestamp);x.setHours(0,0,0,0);const S=x.toISOString().split("T")[0];v.set(S,(v.get(S)||0)+1)});const h=Math.max(...Array.from(v.values()),1),C=[];let k=new Date(f);for(;C.length<371;){const I=k.toISOString().split("T")[0],x=v.get(I)||0;C.push({date:new Date(k),count:x}),k.setDate(k.getDate()+1)}return{grid:C,maxCount:h}},[n]),p=c=>{if(c===0)return"fill-gray-200 dark:fill-gray-700/50";const l=Math.min(c/(o*.75),1);return l>.8?"fill-green-600":l>.5?"fill-green-500":l>.2?"fill-green-400":"fill-green-300"},d=M.useMemo(()=>{var f;const c=[];let l=-1;for(let v=0;v<53;v++){const h=(f=i[v*7])==null?void 0:f.date;if(h){const C=h.getMonth();C!==l&&c.push({month:h.toLocaleString("default",{month:"short"}),col:v}),l=C}}return c},[i]);return r.jsx("div",{className:"overflow-x-auto",children:r.jsxs("svg",{width:"100%",viewBox:"0 0 848 128",children:[d.map(({month:c,col:l})=>r.jsx("text",{x:16*l+24,y:"15",className:"text-xs fill-text-muted",children:c},l)),r.jsx("text",{x:"0",y:"37",className:"text-xs fill-text-muted",children:"Mon"}),r.jsx("text",{x:"0",y:"69",className:"text-xs fill-text-muted",children:"Wed"}),r.jsx("text",{x:"0",y:"101",className:"text-xs fill-text-muted",children:"Fri"}),i.map((c,l)=>{if(!c)return null;const f=Math.floor(l/7),v=l%7;return r.jsx("rect",{x:16*f+24,y:16*v+24,width:"12",height:"12",rx:"2",ry:"2",className:p(c.count),children:r.jsx("title",{children:`${c.date.toDateString()}: ${c.count} review${c.count!==1?"s":""}`})},l)})]})})},iy=({items:n})=>{const i=M.useMemo(()=>{const h=new Date;h.setHours(0,0,0,0);const C=Array(30).fill(0);n.forEach(I=>{const x=new Date(I.dueDate);x.setHours(0,0,0,0);const S=x.getTime()-h.getTime();if(S>=0){const g=Math.floor(S/864e5);g<30&&C[g]++}});const k=Array.from({length:30},(I,x)=>{const S=new Date(h);return S.setDate(S.getDate()+x),x%7===0||x===0?S.toLocaleDateString("en-US",{month:"short",day:"numeric"}):""});return{counts:C,labels:k}},[n]),o=Math.max(...i.counts,1),p=350,d=180,c={top:25,right:10,bottom:25,left:10},l=p-c.left-c.right,f=d-c.top-c.bottom,v=l/i.counts.length-2;return r.jsx("div",{className:"w-full",children:r.jsxs("svg",{viewBox:`0 0 ${p} ${d}`,width:"100%",height:"auto","aria-labelledby":"forecast-graph-title",role:"img",className:"overflow-visible",children:[r.jsx("title",{id:"forecast-graph-title",children:"A bar chart showing the number of items due each day for the next 30 days."}),i.counts.map((h,C)=>{const k=h>0?h/o*f:0,I=c.left+C*(v+2),x=c.top+f-k;return r.jsxs("g",{className:"group cursor-pointer",children:[r.jsxs("title",{children:[i.labels[C]||new Date(new Date().setDate(new Date().getDate()+C)).toLocaleDateString(),": ",h," items"]}),r.jsx("rect",{x:I,y:x,width:v,height:k,rx:"2",className:"fill-primary/60 transition-colors group-hover:fill-primary"}),r.jsx("text",{x:I+v/2,y:x-6,textAnchor:"middle",className:"text-xs font-semibold fill-text-muted transition-opacity opacity-0 group-hover:opacity-100 pointer-events-none",children:h})]},C)}),i.labels.map((h,C)=>h?r.jsx("text",{x:c.left+C*(v+2)+v/2,y:d-c.bottom+15,textAnchor:"middle",className:"text-xs fill-text-muted",children:h},C):null)]})})},ly=({reviews:n})=>{const i=M.useMemo(()=>{const p=new Date;p.setDate(p.getDate()-30);const d=n.filter(v=>v.rating!==null&&new Date(v.timestamp)>=p),c={[lt.Again]:0,[lt.Hard]:0,[lt.Good]:0,[lt.Easy]:0};let l=0;d.forEach(v=>{v.rating&&c.hasOwnProperty(v.rating)&&(c[v.rating]++,l++)});const f=v=>l>0?(v/l*100).toFixed(1):"0.0";return{total:l,again:{count:c[lt.Again],percent:f(c[lt.Again])},hard:{count:c[lt.Hard],percent:f(c[lt.Hard])},good:{count:c[lt.Good],percent:f(c[lt.Good])},easy:{count:c[lt.Easy],percent:f(c[lt.Easy])},correctPercent:f(c[lt.Hard]+c[lt.Good]+c[lt.Easy])}},[n]);if(i.total===0)return r.jsx("div",{className:"text-center py-10",children:r.jsx("p",{className:"text-text-muted",children:"Not enough data from the last 30 days."})});const o=[{label:"Again",percent:i.again.percent,color:"bg-red-500"},{label:"Hard",percent:i.hard.percent,color:"bg-orange-500"},{label:"Good",percent:i.good.percent,color:"bg-green-500"},{label:"Easy",percent:i.easy.percent,color:"bg-blue-500"}];return r.jsxs("div",{className:"space-y-6",children:[r.jsxs("div",{className:"text-center",children:[r.jsx("p",{className:"text-lg text-text-muted",children:"Reviews Marked Correct"}),r.jsxs("p",{className:"text-4xl font-bold text-green-500",children:[i.correctPercent,"%"]})]}),r.jsx("div",{className:"flex w-full h-4 rounded-full overflow-hidden",role:"progressbar",children:o.map(p=>p.percent!=="0.0"&&r.jsx("div",{className:p.color,style:{width:`${p.percent}%`},title:`${p.label}: ${p.percent}%`},p.label))}),r.jsxs("div",{className:"grid grid-cols-2 gap-x-4 gap-y-2 text-sm",children:[r.jsxs("div",{className:"flex items-center",children:[r.jsx("span",{className:"w-2.5 h-2.5 rounded-full bg-red-500 mr-2"}),r.jsxs("span",{className:"text-text-muted",children:["Again: ",r.jsx("strong",{children:i.again.count})," (",i.again.percent,"%)"]})]}),r.jsxs("div",{className:"flex items-center",children:[r.jsx("span",{className:"w-2.5 h-2.5 rounded-full bg-orange-500 mr-2"}),r.jsxs("span",{className:"text-text-muted",children:["Hard: ",r.jsx("strong",{children:i.hard.count})," (",i.hard.percent,"%)"]})]}),r.jsxs("div",{className:"flex items-center",children:[r.jsx("span",{className:"w-2.5 h-2.5 rounded-full bg-green-500 mr-2"}),r.jsxs("span",{className:"text-text-muted",children:["Good: ",r.jsx("strong",{children:i.good.count})," (",i.good.percent,"%)"]})]}),r.jsxs("div",{className:"flex items-center",children:[r.jsx("span",{className:"w-2.5 h-2.5 rounded-full bg-blue-500 mr-2"}),r.jsxs("span",{className:"text-text-muted",children:["Easy: ",r.jsx("strong",{children:i.easy.count})," (",i.easy.percent,"%)"]})]})]})]})},cy=()=>{const[n,i]=M.useState([]),[o,p]=M.useState(!0),[d,c]=M.useState(null),l=at(h=>h.decks);M.useEffect(()=>{(async()=>{try{const C=new Date;C.setFullYear(C.getFullYear()-1);const k=await zh(C);i(k)}catch(C){console.error("Failed to load review data:",C),c("Could not load your review data. Please try again later.")}finally{p(!1)}})()},[]);const f=M.useMemo(()=>{if(o)return null;let h=0;const C=n.map(S=>new Date(S.timestamp).setHours(0,0,0,0)),k=[...new Set(C)];if(k.sort((S,g)=>g-S),k.length>0){const S=new Date().setHours(0,0,0,0),g=new Date(S).setDate(new Date(S).getDate()-1);if(k[0]===S||k[0]===g){h=1;for(let b=1;b<k.length;b++){const j=k[b-1],O=k[b],R=new Date(j).setDate(new Date(j).getDate()-1);if(O===R)h++;else break}}}const x=l.reduce((S,g)=>g.type==="flashcard"?S.concat(g.cards):S.concat(g.questions),[]).filter(S=>(S.interval||0)>=21&&!S.suspended).length;return{streak:h,totalReviews:n.length,matureCount:x}},[n,l,o]),v=M.useMemo(()=>l.reduce((C,k)=>k.type==="flashcard"?C.concat(k.cards):C.concat(k.questions),[]).filter(C=>!C.suspended),[l]);return o?r.jsxs("div",{className:"flex items-center justify-center h-64",children:[r.jsx(Bt,{size:"lg"}),r.jsx("p",{className:"ml-4 text-text-muted",children:"Calculating your progress..."})]}):d?r.jsx("div",{className:"text-center py-10",children:r.jsx("p",{className:"text-red-500",children:d})}):n.length===0?r.jsxs("div",{className:"text-center py-20",children:[r.jsx("h2",{className:"text-2xl font-bold text-text-muted",children:"No review history yet."}),r.jsx("p",{className:"mt-2 text-text-muted",children:"Complete a study session to start tracking your progress!"})]}):r.jsxs("div",{className:"max-w-5xl mx-auto animate-fade-in space-y-8",children:[r.jsx("h1",{className:"text-3xl font-bold text-text border-b border-border pb-4",children:"Your Progress"}),r.jsx(ay,{stats:f}),r.jsxs("div",{className:"bg-surface p-6 rounded-lg shadow-md border border-border",children:[r.jsx("h2",{className:"text-xl font-semibold text-text mb-4",children:"Activity"}),r.jsx(oy,{reviews:n})]}),r.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-8",children:[r.jsxs("div",{className:"bg-surface p-6 rounded-lg shadow-md border border-border",children:[r.jsx("h2",{className:"text-xl font-semibold text-text mb-4",children:"30-Day Forecast"}),r.jsx(iy,{items:v})]}),r.jsxs("div",{className:"bg-surface p-6 rounded-lg shadow-md border border-border",children:[r.jsx("h2",{className:"text-xl font-semibold text-text mb-4",children:"Retention (Last 30 Days)"}),r.jsx(ly,{reviews:n})]})]})]})},dm=M.createContext(null),fm=()=>{const n=M.useContext(dm);if(!n)throw new Error("useData must be used within a DataManagementProvider");return n},uy=({children:n,value:i})=>r.jsx(dm.Provider,{value:i,children:n}),dy=({items:n})=>n.length<=1?null:r.jsx("nav",{"aria-label":"Breadcrumb",className:"mb-6",children:r.jsx("ol",{className:"flex items-center space-x-2 text-sm text-text-muted flex-wrap",children:n.map((i,o)=>{const p=o===n.length-1;return r.jsxs("li",{className:"flex items-center",children:[o>0&&r.jsx(J,{name:"chevron-left",className:"w-4 h-4 rotate-180 mx-2 flex-shrink-0"}),p?r.jsx("span",{className:"font-semibold text-text truncate","aria-current":"page",title:i.label,children:i.label}):r.jsx(Tt,{href:i.href,className:"hover:underline hover:text-primary truncate",title:i.label,children:i.label})]},o)})})}),fy=n=>{const{path:i}=Cn(),{activeDeck:o,activeSeries:p,generalStudyDeck:d}=n,{aiFeaturesEnabled:c}=rn(),l=fm(),[f]=i.split("?"),{deckSeries:v}=at(),h=nm(),C=Qg(),k=Yg(),I=M.useMemo(()=>{const S=[{label:"Home",href:"/"}],g=new URLSearchParams(window.location.hash.split("?")[1]);if(f==="/series")S.push({label:"Series"});else if(f.startsWith("/series/")&&p)S.push({label:"Series",href:"/series"}),S.push({label:p.name});else if(f==="/decks")S.push({label:"Decks"});else if(f.startsWith("/decks/")&&o){const b=g.get("seriesId");if(b){const j=v.find(O=>O.id===b);j&&(S.push({label:"Series",href:"/series"}),S.push({label:j.name,href:`/series/${j.id}`}))}else S.push({label:"Decks",href:"/decks"});S.push({label:o.name})}else f==="/settings"?S.push({label:"Settings"}):f==="/trash"?S.push({label:"Trash"}):f==="/archive"?S.push({label:"Archive"}):f==="/progress"?S.push({label:"Progress"}):f==="/instructions/json"&&S.push({label:"JSON Guide"});return S},[i,o,p,v]),x=()=>{if(f==="/settings")return r.jsx(Cx,{onExport:l.handleExportData,onRestore:l.openRestoreModal,onResetProgress:l.openResetProgressModal,onFactoryReset:l.handleFactoryReset,onSync:l.handleSync,onForceFetch:l.handleForceFetchFromServer,onForceUpload:l.handleForceUploadToServer,isSyncing:n.isSyncing,lastSyncStatus:n.lastSyncStatus,onManageServerBackups:l.openServerBackupModal,onCreateServerBackup:l.handleCreateServerBackup,isGapiReady:n.isGapiReady,isGapiSignedIn:n.isGapiSignedIn,gapiUser:n.gapiUser,onGoogleSignIn:l.handleGoogleSignIn,onGoogleSignOut:l.handleGoogleSignOut,onBackupToDrive:l.handleBackupToDrive,onRestoreFromDrive:l.openRestoreFromDriveModal,onClearAppCache:l.handleClearAppCache,onClearCdnCache:l.handleClearCdnCache,onRevertLastFetch:l.handleRevertLastFetch});if(f==="/trash")return r.jsx(Vx,{onRestoreDeck:l.handleRestoreDeck,onRestoreSeries:l.handleRestoreSeries,onDeleteDeckPermanently:l.handleDeleteDeckPermanently,onDeleteSeriesPermanently:l.handleDeleteSeriesPermanently,openConfirmModal:l.openConfirmModal});if(f==="/archive")return r.jsx(Yx,{onUpdateDeck:l.handleUpdateDeck,onUpdateSeries:l.handleUpdateSeries,onDeleteDeck:l.handleDeleteDeck,onDeleteSeries:l.handleDeleteSeries,openConfirmModal:l.openConfirmModal});if(f==="/progress")return r.jsx(cy,{});if(f.startsWith("/series/")&&p)return r.jsx(Qx,{series:p,sessionsToResume:n.sessionsToResume,onUpdateSeries:l.handleUpdateSeries,onDeleteSeries:l.handleDeleteSeries,onAddDeckToSeries:l.handleAddDeckToSeries,onUpdateDeck:l.handleUpdateDeck,onStartSeriesStudy:l.handleStartSeriesStudy,onUpdateLastOpened:l.updateLastOpenedSeries,openConfirmModal:l.openConfirmModal,onAiAddLevelsToSeries:l.handleAiAddLevelsToSeries,onAiAddDecksToLevel:l.handleAiAddDecksToLevel,onGenerateQuestionsForEmptyDecksInSeries:l.handleGenerateQuestionsForEmptyDecksInSeries,onGenerateQuestionsForDeck:l.handleGenerateQuestionsForDeck,onCancelAIGeneration:l.handleCancelAIGeneration},p.id);if(f==="/study/general"){const S=new URLSearchParams(window.location.hash.split("?")[1]).get("seriesId")||void 0;return d&&r.jsx(eo,{deck:d,seriesId:S,onSessionEnd:l.handleSessionEnd,onItemReviewed:l.handleItemReviewed,onUpdateLastOpened:()=>{},onStudyNextDeck:l.handleStudyNextDeckInSeries},"general-study")}if(f.startsWith("/decks/")&&f.endsWith("/cram")){if(!o)return r.jsxs("div",{className:"text-center py-20",children:[r.jsx("h2",{className:"text-3xl font-bold text-gray-600 dark:text-gray-400",children:"Deck Not Found"}),r.jsx("p",{className:"mt-4 text-gray-500 dark:text-gray-500",children:"The deck you are trying to study does not exist."})]});const g=[...(o.type===De.Flashcard?o.cards:o.questions).filter(O=>!O.suspended)].sort(()=>Math.random()-.5),b=o.type===De.Flashcard?{...o,name:`${o.name} (Cram)`,cards:g}:{...o,name:`${o.name} (Cram)`,questions:g},j=new URLSearchParams(window.location.hash.split("?")[1]).get("seriesId")||void 0;return r.jsx(eo,{deck:b,seriesId:j,onSessionEnd:l.handleSessionEnd,onItemReviewed:l.handleItemReviewed,onUpdateLastOpened:l.updateLastOpened,sessionKeySuffix:"_cram",onStudyNextDeck:l.handleStudyNextDeckInSeries},`${o.id}-cram`)}if(f.startsWith("/decks/")&&f.endsWith("/study-reversed")){if(!o)return r.jsxs("div",{className:"text-center py-20",children:[r.jsx("h2",{className:"text-3xl font-bold text-gray-600 dark:text-gray-400",children:"Deck Not Found"}),r.jsx("p",{className:"mt-4 text-gray-500 dark:text-gray-500",children:"The deck you are trying to study does not exist."})]});if(o.type==="flashcard"){const S={...o,name:`${o.name} (Reversed)`,cards:o.cards.map(b=>({...b,front:b.back,back:b.front}))},g=new URLSearchParams(window.location.hash.split("?")[1]).get("seriesId")||void 0;return r.jsx(eo,{deck:S,seriesId:g,onSessionEnd:l.handleSessionEnd,onItemReviewed:l.handleItemReviewed,onUpdateLastOpened:l.updateLastOpened,sessionKeySuffix:"_reversed",onStudyNextDeck:l.handleStudyNextDeckInSeries},`${o.id}-reversed`)}}if(f.startsWith("/decks/")&&f.endsWith("/study-flip")){if(!o)return r.jsxs("div",{className:"text-center py-20",children:[r.jsx("h2",{className:"text-3xl font-bold text-gray-600 dark:text-gray-400",children:"Deck Not Found"}),r.jsx("p",{className:"mt-4 text-gray-500 dark:text-gray-500",children:"The deck you are trying to study does not exist."})]});if(o.type==="quiz"||o.type==="learning"){const S=o,g=(S.questions||[]).filter(O=>!O.suspended).map(O=>{const R=O.options.find(T=>T.id===O.correctAnswerId),A=`
                            <div class="text-left w-full">
                                <p class="text-xl"><b>Answer:</b> ${(R==null?void 0:R.text)||"N/A"}</p>
                                <hr class="my-4 border-gray-300 dark:border-gray-600"/>
                                <p class="text-sm font-semibold uppercase tracking-wider text-gray-500 dark:text-gray-400">Explanation</p>
                                <div class="prose prose-sm dark:prose-invert max-w-none mt-2">${O.detailedExplanation||"No detailed explanation provided."}</div>
                            </div>
                        `;return{...O,front:O.questionText,back:A}}),b={...S,name:`${S.name} (Review)`,type:De.Flashcard,cards:g.sort(()=>Math.random()-.5)},j=new URLSearchParams(window.location.hash.split("?")[1]).get("seriesId")||void 0;return r.jsx(eo,{deck:b,seriesId:j,onSessionEnd:l.handleSessionEnd,onItemReviewed:l.handleItemReviewed,onUpdateLastOpened:l.updateLastOpened,sessionKeySuffix:"_flip",onStudyNextDeck:l.handleStudyNextDeckInSeries},`${o.id}-flip`)}}if(f.startsWith("/decks/")&&f.endsWith("/study")){if(!o)return r.jsxs("div",{className:"text-center py-20",children:[r.jsx("h2",{className:"text-3xl font-bold text-gray-600 dark:text-gray-400",children:"Deck Not Found"}),r.jsx("p",{className:"mt-4 text-gray-500 dark:text-gray-500",children:"The deck you are trying to study does not exist."})]});const S=new URLSearchParams(window.location.hash.split("?")[1]).get("seriesId")||void 0;return r.jsx(eo,{deck:o,seriesId:S,onSessionEnd:l.handleSessionEnd,onItemReviewed:l.handleItemReviewed,onUpdateLastOpened:l.updateLastOpened,onStudyNextDeck:l.handleStudyNextDeckInSeries},o.id)}return f.startsWith("/decks/")?o&&r.jsx(Gx,{deck:o,sessionsToResume:n.sessionsToResume,onUpdateDeck:l.handleUpdateDeck,onDeleteDeck:l.handleDeleteDeck,onUpdateLastOpened:l.updateLastOpened,openConfirmModal:l.openConfirmModal,onGenerateQuestionsForDeck:l.handleGenerateQuestionsForDeck,onGenerateContentForLearningDeck:l.handleGenerateContentForLearningDeck,onCancelAIGeneration:l.handleCancelAIGeneration,onSaveLearningBlock:l.handleSaveLearningBlock,onDeleteLearningBlock:l.handleDeleteLearningBlock},o.id):f==="/instructions/json"?r.jsx(Wx,{}):f==="/decks"?r.jsx(ry,{sessionsToResume:n.sessionsToResume,sortPreference:n.sortPreference,onSortChange:n.setSortPreference,onUpdateLastOpened:l.updateLastOpened,onDeleteFolder:l.handleDeleteFolder,draggedDeckId:n.draggedDeckId,onDragStart:n.setDraggedDeckId,onDragEnd:()=>n.setDraggedDeckId(null),onMoveDeck:l.handleMoveDeck,openFolderIds:n.openFolderIds,onToggleFolder:n.onToggleFolder,onUpdateDeck:l.handleUpdateDeck,onDeleteDeck:l.handleDeleteDeck,openConfirmModal:l.openConfirmModal,onNewFolder:()=>l.openFolderEditor("new"),onImportDecks:l.openImportModal,onCreateSampleDeck:l.handleCreateSampleDeck,handleSaveFolder:l.handleSaveFolder,onGenerateQuestionsForDeck:l.handleGenerateQuestionsForDeck,onGenerateContentForLearningDeck:l.handleGenerateContentForLearningDeck,onCancelAIGeneration:l.handleCancelAIGeneration}):f==="/series"?r.jsx(sy,{onStartSeriesStudy:l.handleStartSeriesStudy,onCreateNewSeries:()=>l.openSeriesEditor("new"),onCreateSampleSeries:l.handleCreateSampleSeries,onGenerateAI:l.openAIGenerationModal,onGenerateQuestionsForEmptyDecksInSeries:l.handleGenerateQuestionsForEmptyDecksInSeries,onCancelAIGeneration:l.handleCancelAIGeneration}):h.length>0||C.length>0?r.jsx(Zx,{totalDueQuestions:k,onStartGeneralStudy:l.handleStartGeneralStudy,sessionsToResume:n.sessionsToResume,onUpdateLastOpened:l.updateLastOpened,onUpdateDeck:l.handleUpdateDeck,onDeleteDeck:l.handleDeleteDeck,openConfirmModal:l.openConfirmModal,seriesProgress:at.getState().seriesProgress,onStartSeriesStudy:l.handleStartSeriesStudy,onGenerateQuestionsForDeck:l.handleGenerateQuestionsForDeck,onGenerateContentForLearningDeck:l.handleGenerateContentForLearningDeck,onGenerateQuestionsForEmptyDecksInSeries:l.handleGenerateQuestionsForEmptyDecksInSeries,onCancelAIGeneration:l.handleCancelAIGeneration}):r.jsxs("div",{className:"text-center py-20",children:[r.jsx("h2",{className:"text-3xl font-bold text-gray-600 dark:text-gray-400",children:"Welcome to CogniFlow"}),r.jsx("p",{className:"mt-4 text-gray-500 dark:text-gray-500",children:"Create decks, import content, restore from a backup, or try a sample to get started."}),r.jsxs("div",{className:"flex flex-col sm:flex-row items-center justify-center gap-4 mt-8 flex-wrap",children:[c&&r.jsxs(se,{onClick:l.openAIGenerationModal,variant:"primary",children:[r.jsx(J,{name:"zap",className:"w-5 h-5 mr-2"}),"Generate with AI"]}),r.jsxs(se,{onClick:l.openImportModal,children:[r.jsx(J,{name:"plus",className:"w-5 h-5 mr-2"}),"Create or Import Deck"]}),r.jsxs(se,{onClick:l.openRestoreModal,variant:"secondary",children:[r.jsx(J,{name:"upload-cloud",className:"w-5 h-5 mr-2"}),"Restore from Backup"]}),r.jsxs(se,{onClick:()=>l.openSeriesEditor("new"),variant:"secondary",children:[r.jsx(J,{name:"layers",className:"w-5 h-5 mr-2"}),"Create New Series"]}),r.jsxs(se,{onClick:l.handleCreateSampleDeck,variant:"ghost",children:[r.jsx(J,{name:"laptop",className:"w-5 h-5 mr-2"}),"Create Sample Deck"]}),r.jsxs(se,{onClick:l.handleCreateSampleSeries,variant:"ghost",children:[r.jsx(J,{name:"zap",className:"w-5 h-5 mr-2"}),"Create Sample Series"]})]})]})};return r.jsxs(r.Fragment,{children:[r.jsx(dy,{items:I}),x()]})},hy=({isOpen:n,onClose:i,actions:o})=>{const[p,d]=M.useState(""),[c,l]=M.useState(0),f=M.useRef(null),v=M.useRef(null),{navigate:h}=Cn(),{decks:C,deckSeries:k}=at();Pt(f,n);const I=M.useMemo(()=>{const A=[];return o.forEach(T=>A.push({type:"action",id:T.id,label:T.label,icon:T.icon,run:T.action,keywords:T.keywords,searchableOnly:T.searchableOnly})),C.filter(T=>!T.archived&&!T.deletedAt).forEach(T=>A.push({type:"deck",id:T.id,name:T.name,itemType:T.type})),k.filter(T=>!T.archived&&!T.deletedAt).forEach(T=>A.push({type:"series",id:T.id,name:T.name})),C.filter(T=>!T.archived&&!T.deletedAt).forEach(T=>{T.type==="flashcard"?T.cards.forEach(P=>A.push({type:"card",id:P.id,deckId:T.id,deckName:T.name,front:P.front})):T.questions.forEach(P=>A.push({type:"question",id:P.id,deckId:T.id,deckName:T.name,text:P.questionText}))}),A},[o,C,k]),x=M.useMemo(()=>{if(!p.trim())return I.filter(P=>P.type==="action"&&!P.searchableOnly);const A=p.toLowerCase();return I.filter(P=>{switch(P.type){case"action":{const H=P,K=H.label.toLowerCase().includes(A),W=(H.keywords||[]).some(B=>B.toLowerCase().includes(A));return K||W}case"deck":return P.name.toLowerCase().includes(A);case"series":return P.name.toLowerCase().includes(A);case"card":return hr(P.front).toLowerCase().includes(A);case"question":return P.text.toLowerCase().includes(A);default:return!1}}).slice(0,50)},[p,I]),S=M.useMemo(()=>{const A={Actions:[],Series:[],Decks:[],Cards:[]};return x.forEach(T=>{T.type==="action"?A.Actions.push(T):T.type==="series"?A.Series.push(T):T.type==="deck"?A.Decks.push(T):(T.type==="card"||T.type==="question")&&A.Cards.push(T)}),Object.entries(A).filter(([,T])=>T.length>0)},[x]),g=M.useMemo(()=>S.flatMap(([,A])=>A),[S]),b=M.useCallback(A=>{switch(A.type){case"action":A.run();break;case"deck":h(`/decks/${A.id}`);break;case"series":h(`/series/${A.id}`);break;case"card":case"question":h(`/decks/${A.deckId}`);break}i()},[h,i]);M.useEffect(()=>{const A=T=>{if(n)if(T.key==="ArrowDown")T.preventDefault(),l(P=>(P+1)%(g.length||1));else if(T.key==="ArrowUp")T.preventDefault(),l(P=>(P-1+(g.length||1))%(g.length||1));else if(T.key==="Enter"){T.preventDefault();const P=g[c];P&&b(P)}else T.key==="Escape"&&i()};return window.addEventListener("keydown",A),()=>window.removeEventListener("keydown",A)},[n,c,g,b,i]),M.useEffect(()=>{n&&(d(""),l(0))},[n]),M.useEffect(()=>{l(0)},[p]),M.useEffect(()=>{var A;(A=document.getElementById(`cmdk-item-${c}`))==null||A.scrollIntoView({block:"nearest"})},[c]);const j=A=>{A.target===A.currentTarget&&i()};if(!n)return null;const O=(A,T)=>{let P,H="",K;switch(A.type){case"action":P=A.icon,H=A.label;break;case"deck":P="help-circle",A.itemType===De.Flashcard?P="laptop":A.itemType===De.Learning&&(P="layers"),H=A.name;break;case"series":P="layers",H=A.name;break;case"card":P="laptop",H=hr(A.front),K=`In: ${A.deckName}`;break;case"question":P="help-circle",H=A.text,K=`In: ${A.deckName}`;break}return r.jsxs("li",{id:`cmdk-item-${T}`,role:"option","aria-selected":c===T,onClick:()=>b(A),className:`flex items-center gap-4 px-4 py-3 cursor-pointer rounded-md ${c===T?"bg-primary/10":"hover:bg-border/30"}`,children:[r.jsx(J,{name:P,className:"w-5 h-5 text-text-muted flex-shrink-0"}),r.jsxs("div",{className:"flex-grow min-w-0",children:[r.jsx("p",{className:`font-medium truncate ${c===T?"text-primary":"text-text"}`,children:H}),K&&r.jsx("p",{className:`text-sm truncate ${c===T?"text-primary/80":"text-text-muted"}`,children:K})]})]},A.id)};let R=0;return r.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-70 flex justify-center items-start pt-4 sm:pt-[15vh] z-[60] p-4",onClick:j,children:r.jsxs("div",{ref:f,role:"dialog","aria-modal":"true",className:"bg-surface rounded-lg shadow-xl w-full max-w-2xl transform transition-all relative max-h-[70vh] flex flex-col",children:[r.jsxs("div",{className:"flex items-center gap-2 p-4 border-b border-border",children:[r.jsx(J,{name:"search",className:"w-5 h-5 text-text-muted"}),r.jsx("input",{type:"text",value:p,onChange:A=>d(A.target.value),placeholder:"Search for anything or type a command...",className:"w-full bg-transparent focus:outline-none text-lg placeholder:text-text-muted",autoFocus:!0}),r.jsx("div",{className:"hidden sm:block text-xs text-text-muted border border-border rounded px-1.5 py-0.5",children:"ESC"})]}),r.jsx("div",{className:"flex-grow overflow-y-auto p-2",children:g.length>0?r.jsx("ul",{ref:v,role:"listbox",children:S.map(([A,T])=>r.jsxs("li",{children:[r.jsx("p",{className:"px-4 py-2 text-xs font-semibold text-text-muted uppercase tracking-wider",children:A}),r.jsx("ul",{className:"space-y-1",children:T.map(P=>O(P,R++))})]},A))}):r.jsx("div",{className:"text-center py-10 px-4",children:r.jsxs("p",{className:"text-text-muted",children:['No results found for "',p,'".']})})}),r.jsx("div",{className:"hidden sm:flex flex-shrink-0 justify-end items-center p-2 border-t border-border",children:r.jsxs("span",{className:"text-sm text-text-muted",children:[r.jsx(J,{name:"terminal",className:"inline-block w-4 h-4 mr-2"}),r.jsx("kbd",{className:"font-sans",children:"Cmd+K"})," to toggle"]})})]})})},my=()=>{const{openModal:n}=Oi(),i=()=>{n("aiChat")};return r.jsx("div",{className:"fixed bottom-6 right-6 z-40",children:r.jsx(se,{variant:"primary",onClick:i,className:"rounded-full w-16 h-16 shadow-lg flex items-center justify-center","aria-label":"Open AI Assistant",children:r.jsx(J,{name:"bot",className:"w-8 h-8"})})})},py=({onOpen:n,onCancel:i})=>{const{currentTask:o,queue:p}=at(l=>l.aiGenerationStatus),d=o!==null,c=(o?1:0)+p.length;return c===0?null:r.jsx("div",{className:"fixed bottom-6 left-6 z-40 flex items-center gap-2",children:r.jsxs("button",{onClick:n,className:"bg-surface rounded-full shadow-lg flex items-center justify-center p-2 group relative","aria-label":"View AI generation status",title:(o==null?void 0:o.statusText)||`${p.length} task(s) queued...`,children:[r.jsxs("div",{className:"relative w-12 h-12 flex items-center justify-center",children:[r.jsx("svg",{className:"absolute w-full h-full",style:{animation:d?"spin 1.5s linear infinite":"none"},viewBox:"0 0 24 24",children:r.jsx("circle",{cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"2",fill:"none",className:d?"text-primary/50":"text-text-muted/50",strokeDasharray:d?"40 100":"5 15"})}),r.jsx(J,{name:"bot",className:`w-6 h-6 ${d?"text-primary":"text-text-muted"}`})]}),c>0&&r.jsx("span",{className:"absolute -top-1 -right-1 bg-primary text-on-primary text-xs font-bold rounded-full h-5 w-5 flex items-center justify-center",children:c})]})})},gy=({isOpen:n,onClose:i,onAddDecks:o,onAddSeriesWithDecks:p})=>{const[d,c]=M.useState("create"),[l,f]=M.useState(""),[v,h]=M.useState(""),[C,k]=M.useState(""),[I,x]=M.useState(!1),S=M.useRef(null),{addToast:g}=Kt(),b=M.useRef(null);Pt(b,n);const j=M.useCallback(()=>{c("create"),f(""),h(""),k(""),x(!1)},[]),O=M.useCallback(()=>{j(),i()},[j,i]),R=M.useCallback(W=>{h(W);try{const B=zc(W);(B==null?void 0:B.type)===De.Quiz?f(B.data.name):(B==null?void 0:B.type)==="quiz_series"&&f(B.data.seriesName)}catch{}},[]),A=M.useCallback(async W=>{if(W){k(W.name),x(!0);try{if(W.name.toLowerCase().endsWith(".apkg")){f("");const B=await W.arrayBuffer(),Y=B.slice(0);let q=[];try{q=await em(B)}catch(Q){console.warn("Anki worker failed, trying main thread fallback:",Q),g("Import via worker failed. Trying a slower fallback method... this may freeze the app.","info");try{q=await tm(Y)}catch(N){throw console.error("Anki main thread fallback also failed:",N),N}}q.length>0?(o(q),g(`Successfully imported ${q.length} deck(s) from ${W.name}.`,"success"),O()):(g("No valid decks found in the Anki package.","info"),j())}else if(W.name.toLowerCase().endsWith(".json")){const B=await W.text();R(B),x(!1),g("File loaded. Confirm name and import, or paste content directly.","info")}else g("Unsupported file type. Please upload a '.json' or '.apkg' file.","error"),k(""),x(!1)}catch(B){console.error("Failed to process file:",B),g(`An error occurred: ${B instanceof Error?B.message:"Unknown error"}`,"error"),j()}}},[g,O,R,o,j]),T=M.useCallback(()=>{if(d==="create"){if(!l.trim()){g("Please enter a deck name.","error");return}const W={id:crypto.randomUUID(),name:l.trim(),type:De.Flashcard,cards:[],description:`An empty deck created on ${Rp()}`};o([W]),g(`Deck "${W.name}" created.`,"success"),O();return}if(!v){g("Please paste or upload content.","error");return}try{const W=zc(v);if(!W)return;if(W.type==="quiz_series"){const{seriesName:Y,seriesDescription:q,levels:Q}=W.data,N=[],Z=Q.map(fe=>{const ye=fe.decks.map(ue=>({id:crypto.randomUUID(),name:ue.name,description:ue.description,type:De.Quiz,questions:ba(ue.questions)}));return N.push(...ye),{title:fe.title,deckIds:ye.map(ue=>ue.id)}}),oe={id:crypto.randomUUID(),type:"series",name:Y,description:q,levels:Z,archived:!1,createdAt:new Date().toISOString()};p(oe,N),O();return}if(!l.trim()){g("Please enter a deck name.","error");return}let B;if(W.type===De.Flashcard){const Y=Kc(W.data);B={id:crypto.randomUUID(),name:l.trim(),type:De.Flashcard,cards:Y,description:`${Y.length} imported flashcard${Y.length===1?"":"s"}.`}}else{const Y=ba(W.data.questions);B={id:crypto.randomUUID(),name:l.trim(),description:W.data.description,type:De.Quiz,questions:Y}}o([B]),g(`Deck "${B.name}" imported successfully.`,"success"),O()}catch(W){g(W instanceof Error?W.message:"Invalid JSON content.","error")}},[l,d,v,o,O,g,p]),P=W=>{var Y;const B=(Y=W.target.files)==null?void 0:Y[0];B&&A(B),W.target&&(W.target.value="")};if(!n)return null;const H=()=>{const W=C.toLowerCase().endsWith(".apkg");if(d==="upload"&&W)return r.jsx("div",{className:"text-text-muted text-center py-12",children:"Anki file selected. Decks will be imported automatically."});switch(d){case"paste":return r.jsxs("div",{children:[r.jsx("textarea",{className:"w-full h-48 p-2 bg-background border border-border rounded-md focus:ring-2 focus:ring-primary focus:outline-none text-text",placeholder:'Paste JSON here... e.g., [{"front": "Q1", "back": "A1"}] or a Quiz/Series object.',value:v,onChange:B=>R(B.target.value)}),r.jsxs(Tt,{href:"/instructions/json",onClick:i,className:"text-sm text-primary hover:underline mt-2 inline-flex items-center gap-1",children:[r.jsx(J,{name:"help-circle",className:"w-4 h-4"}),"View JSON format guide"]})]});case"upload":return r.jsxs(r.Fragment,{children:[r.jsx("input",{type:"file",ref:S,className:"hidden",accept:".json,application/json,.apkg,application/zip,application/x-zip-compressed,application/octet-stream",onChange:P}),r.jsxs("label",{className:"flex flex-col items-center justify-center w-full h-48 border-2 border-dashed border-border rounded-lg cursor-pointer hover:bg-background transition-colors",children:[r.jsx(J,{name:"upload-cloud",className:"w-10 h-10 text-text-muted mb-2"}),r.jsxs("p",{className:"text-sm text-text-muted",children:[r.jsx("span",{className:"font-semibold text-primary",onClick:B=>{var Y;B.preventDefault(),(Y=S.current)==null||Y.click()},children:"Click to upload"})," or drag and drop anywhere"]}),r.jsx("p",{className:"text-xs text-text-muted/70",children:"JSON or Anki Package (.apkg)"}),C&&r.jsx("p",{className:"text-sm text-green-500 dark:text-green-400 mt-2 truncate",title:C,children:C})]})]});case"create":default:return r.jsx("p",{className:"text-text-muted text-center py-12",children:"Create an empty flashcard deck."})}},K=!(d==="upload"&&C.toLowerCase().endsWith(".apkg"));return r.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-75 flex items-center justify-center z-[60] p-4",children:r.jsxs("div",{ref:b,className:"bg-surface rounded-lg shadow-xl w-full max-w-lg overflow-hidden transform transition-all relative",children:[I&&r.jsxs("div",{className:"absolute inset-0 bg-surface/80 flex flex-col items-center justify-center z-20",children:[r.jsx(Bt,{}),r.jsx("p",{className:"text-lg text-text mt-4",children:"Processing file..."})]}),r.jsxs("div",{className:"flex justify-between items-center p-4 border-b border-border",children:[r.jsx("h2",{className:"text-xl font-bold text-text",children:"Create / Import"}),r.jsx(se,{variant:"ghost",onClick:O,className:"p-1 h-auto",children:r.jsx(J,{name:"x"})})]}),r.jsxs("div",{className:"p-6 space-y-4",children:[K&&r.jsxs("div",{children:[r.jsx("label",{htmlFor:"deck-name",className:"block text-sm font-medium text-text-muted mb-1",children:"Deck / Series Name"}),r.jsx("input",{type:"text",id:"deck-name",value:l,onChange:W=>f(W.target.value),className:"w-full p-2 bg-background border border-border rounded-md focus:ring-2 focus:ring-primary focus:outline-none",placeholder:"e.g. Japanese Vocabulary"}),r.jsx("p",{className:"text-xs text-text-muted mt-1",children:"For single deck or new deck creation. This is auto-filled when pasting a Series object."})]}),r.jsx("div",{className:"flex border-b border-border",children:["create","paste","upload"].map(W=>r.jsx("button",{onClick:()=>c(W),className:`capitalize px-4 py-2 text-sm font-medium transition-colors ${d===W?"border-b-2 border-primary text-text":"text-text-muted hover:text-text"}`,children:W==="create"?"Create Empty":W},W))}),r.jsx("div",{className:"mt-4",children:H()})]}),r.jsxs("div",{className:"flex justify-end p-4 bg-background/50 border-t border-border",children:[r.jsx(se,{variant:"secondary",onClick:O,className:"mr-2",children:"Cancel"}),r.jsx(se,{variant:"primary",onClick:T,disabled:I||d==="create"&&!l.trim()||d!=="create"&&!v&&!C,children:d==="create"?"Create Deck":"Import"})]})]})})},xy=({isOpen:n,onClose:i,onRestore:o})=>{const[p,d]=M.useState(""),[c,l]=M.useState(null),[f,v]=M.useState(null),[h,C]=M.useState(!1),k=M.useRef(null),{addToast:I}=Kt(),x=M.useRef(null);Pt(x,n);const S=()=>{d(""),l(null),v(null),i()},g=async A=>{if(A){d(A.name),v(null),l("Processing file...");try{if(A.name.toLowerCase().endsWith(".json")){const T=await A.text(),P=Ai(T);v(P),I(`Backup file "${A.name}" is valid and ready to restore.`,"success")}else I("Unsupported file type. Please upload a '.json' backup file.","error"),d("")}catch(T){console.error("Failed to process file:",T),I(`Restore failed: ${T instanceof Error?T.message:"Unknown error"}`,"error"),d("")}finally{l(null)}}},b=A=>{var P;if(c)return;const T=(P=A.target.files)==null?void 0:P[0];T&&g(T),A.target&&(A.target.value="")},j=A=>{var P;if(A.preventDefault(),c)return;const T=(P=A.dataTransfer.files)==null?void 0:P[0];T&&g(T)},O=A=>A.preventDefault(),R=async()=>{if(f){C(!1),l("Restoring data...");try{await o(f),S()}catch{l(null)}}};return n?r.jsxs(r.Fragment,{children:[r.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-75 flex items-center justify-center z-[60] p-4",children:r.jsxs("div",{ref:x,className:"bg-surface rounded-lg shadow-xl w-full max-w-lg overflow-hidden transform transition-all relative",children:[c&&r.jsxs("div",{className:"absolute inset-0 bg-surface/80 flex flex-col items-center justify-center z-20",children:[r.jsx(Bt,{}),r.jsx("p",{className:"text-lg text-text mt-4",children:c})]}),r.jsxs("div",{className:"flex justify-between items-center p-4 border-b border-border",children:[r.jsx("h2",{className:"text-xl font-bold",children:"Restore from Backup"}),r.jsx(se,{variant:"ghost",onClick:S,className:"p-1 h-auto",disabled:!!c,children:r.jsx(J,{name:"x"})})]}),r.jsxs("div",{className:"p-6 space-y-4",children:[r.jsx("div",{className:"bg-red-900/20 border border-red-500/30 rounded-lg p-4 text-sm text-red-700 dark:text-red-200",children:r.jsxs("p",{children:[r.jsx("strong",{className:"font-bold",children:"Warning:"})," Restoring from a backup will merge and overwrite data. Decks and folders with the same ID will be replaced. This action cannot be undone."]})}),r.jsx("input",{type:"file",ref:k,className:"hidden",accept:".json,application/json",onChange:b,disabled:!!c}),r.jsxs("label",{onDragOver:O,onDrop:j,className:`flex flex-col items-center justify-center w-full h-48 border-2 border-dashed border-border rounded-lg transition-colors ${c?"cursor-not-allowed opacity-70":"cursor-pointer hover:bg-background"}`,children:[r.jsx(J,{name:"upload-cloud",className:"w-10 h-10 text-text-muted mb-2"}),r.jsxs("p",{className:"text-sm text-text-muted",children:[r.jsx("span",{className:"font-semibold text-primary",onClick:A=>{var T;c||(A.preventDefault(),(T=k.current)==null||T.click())},children:"Click to upload"})," or drag and drop"]}),r.jsx("p",{className:"text-xs text-text-muted/70",children:"CogniFlow Backup JSON file"}),p&&r.jsx("p",{className:`text-sm mt-2 truncate ${f?"text-green-600":"text-red-600"}`,title:p,children:p})]})]}),r.jsxs("div",{className:"flex justify-end p-4 bg-background/50 border-t border-border",children:[r.jsx(se,{variant:"secondary",onClick:S,className:"mr-2",disabled:!!c,children:"Cancel"}),r.jsx(se,{variant:"danger",onClick:()=>C(!0),disabled:!f||!!c,children:c?"Please wait...":"Restore"})]})]})}),h&&r.jsx(Ri,{isOpen:h,onClose:()=>C(!1),onConfirm:R,title:"Confirm Restore",message:"Restoring from a backup will overwrite existing decks and folders with the same ID. This action cannot be undone. Are you sure you want to continue?"})]}):null},yy=({isOpen:n,onClose:i,onReset:o,decks:p})=>{const[d,c]=M.useState(""),[l,f]=M.useState(""),{addToast:v}=Kt(),h=M.useRef(null);Pt(h,n);const C=M.useMemo(()=>p.find(S=>S.id===d),[p,d]),k=C?l===C.name:!1,I=()=>{if(!k||!C){v("Confirmation text does not match.","error");return}o(C.id),i()},x=()=>{c(""),f(""),i()};return n?r.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-75 flex items-center justify-center z-[60] p-4",children:r.jsxs("div",{ref:h,className:"bg-surface rounded-lg shadow-xl w-full max-w-lg transform transition-all relative",children:[r.jsxs("div",{className:"flex justify-between items-center p-4 border-b border-border",children:[r.jsx("h2",{className:"text-xl font-bold",children:"Reset Deck Progress"}),r.jsx(se,{type:"button",variant:"ghost",onClick:x,className:"p-1 h-auto",children:r.jsx(J,{name:"x"})})]}),r.jsxs("div",{className:"p-6 space-y-4",children:[r.jsx("div",{className:"bg-red-900/20 border border-red-500/30 rounded-lg p-4 text-sm text-red-700 dark:text-red-200",children:r.jsxs("p",{children:[r.jsx("strong",{className:"font-bold",children:"Warning:"})," This will reset all spaced repetition data (due dates, intervals) for the selected deck. The cards themselves will not be deleted. This action cannot be undone."]})}),r.jsxs("div",{children:[r.jsx("label",{htmlFor:"deck-select",className:"block text-sm font-medium text-text-muted mb-1",children:"Select Deck"}),r.jsxs("select",{id:"deck-select",value:d,onChange:S=>{c(S.target.value),f("")},className:"w-full p-2 bg-background border border-border rounded-md focus:ring-2 focus:ring-primary focus:outline-none",children:[r.jsx("option",{value:"",disabled:!0,children:"-- Select a deck --"}),p.map(S=>r.jsx("option",{value:S.id,children:S.name},S.id))]})]}),C&&r.jsxs("div",{className:"animate-fade-in",children:[r.jsxs("label",{htmlFor:"confirm-text",className:"block text-sm font-medium text-text-muted mb-1",children:['To confirm, type "',r.jsx("strong",{className:"text-text",children:C.name}),'" below:']}),r.jsx("input",{id:"confirm-text",type:"text",value:l,onChange:S=>f(S.target.value),className:"w-full p-2 bg-background border border-border rounded-md focus:ring-2 focus:ring-primary focus:outline-none"})]})]}),r.jsxs("div",{className:"flex justify-end p-4 bg-background/50 border-t border-border",children:[r.jsx(se,{type:"button",variant:"secondary",onClick:x,className:"mr-2",children:"Cancel"}),r.jsxs(se,{type:"button",variant:"danger",onClick:I,disabled:!k,children:[r.jsx(J,{name:"refresh-ccw",className:"w-5 h-5 mr-2"}),"Reset Progress"]})]})]})}):null},vy=({folder:n,isOpen:i,onClose:o,onSave:p})=>{const[d,c]=M.useState(""),{addToast:l}=Kt(),f=M.useRef(null);Pt(f,i),M.useEffect(()=>{c(n?n.name:"")},[n]);const v=h=>{if(h.preventDefault(),!d.trim()){l("Folder name cannot be empty.","error");return}p({id:(n==null?void 0:n.id)||null,name:d.trim()}),o()};return i?r.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-75 flex items-center justify-center z-[60] p-4",children:r.jsx("div",{ref:f,className:"bg-surface rounded-lg shadow-xl w-full max-w-md transform transition-all relative",children:r.jsxs("form",{onSubmit:v,children:[r.jsxs("div",{className:"flex justify-between items-center p-4 border-b border-border",children:[r.jsx("h2",{className:"text-xl font-bold",children:n?"Edit Folder":"Create New Folder"}),r.jsx(se,{type:"button",variant:"ghost",onClick:o,className:"p-1 h-auto",children:r.jsx(J,{name:"x"})})]}),r.jsx("div",{className:"p-6 space-y-4",children:r.jsxs("div",{children:[r.jsx("label",{htmlFor:"folder-name",className:"block text-sm font-medium text-text-muted mb-1",children:"Folder Name"}),r.jsx("input",{id:"folder-name",type:"text",value:d,onChange:h=>c(h.target.value),className:"w-full p-2 bg-background border border-border rounded-md focus:ring-2 focus:ring-primary focus:outline-none",placeholder:"e.g., University Courses",autoFocus:!0})]})}),r.jsxs("div",{className:"flex justify-end p-4 bg-background/50 border-t border-border",children:[r.jsx(se,{type:"button",variant:"secondary",onClick:o,className:"mr-2",children:"Cancel"}),r.jsxs(se,{type:"submit",variant:"primary",children:[r.jsx(J,{name:"save",className:"w-4 h-4 mr-2"}),n?"Save Changes":"Create Folder"]})]})]})})}):null},wy=({series:n,isOpen:i,onClose:o,onSave:p})=>{const[d,c]=M.useState(""),[l,f]=M.useState(""),[v,h]=M.useState(null),{addToast:C}=Kt(),k=M.useRef(null);Pt(k,i);const I=n===null;M.useEffect(()=>{n?(c(n.name),f(n.description),h(null)):(c(""),f(""),h(null))},[n]);const x=g=>{if(!I)return;const b=g.clipboardData.getData("text");if(b.trim().startsWith("{"))try{const j=JSON.parse(b);typeof j.seriesName=="string"&&typeof j.seriesDescription=="string"&&Array.isArray(j.levels)&&(g.preventDefault(),c(j.seriesName),f(j.seriesDescription),h(j),C("Series details and structure populated from JSON scaffold!","success"))}catch{}},S=g=>{if(g.preventDefault(),!d.trim()){C("Series name cannot be empty.","error");return}p({id:I?null:n.id,name:d.trim(),description:l.trim(),scaffold:I?v:null}),o()};return i?r.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-75 flex items-center justify-center z-[60] p-4",children:r.jsx("div",{ref:k,className:"bg-surface rounded-lg shadow-xl w-full max-w-lg transform transition-all relative",children:r.jsxs("form",{onSubmit:S,children:[r.jsxs("div",{className:"flex justify-between items-center p-4 border-b border-border",children:[r.jsx("h2",{className:"text-xl font-bold",children:I?"Create New Series":"Edit Series"}),r.jsx(se,{type:"button",variant:"ghost",onClick:o,className:"p-1 h-auto",children:r.jsx(J,{name:"x"})})]}),r.jsxs("div",{className:"p-6 space-y-4",children:[r.jsxs("div",{children:[r.jsx("label",{htmlFor:"series-name",className:"block text-sm font-medium text-text-muted mb-1",children:"Series Name"}),r.jsx("input",{id:"series-name",type:"text",value:d,onChange:g=>c(g.target.value),onPaste:x,className:"w-full p-2 bg-background border border-border rounded-md focus:ring-2 focus:ring-primary focus:outline-none",placeholder:"e.g., Introduction to Algebra",autoFocus:!0}),I&&r.jsx("p",{className:"text-xs text-text-muted mt-1",children:"You can paste a full JSON scaffold object here to auto-populate."})]}),r.jsxs("div",{children:[r.jsx("label",{htmlFor:"series-description",className:"block text-sm font-medium text-text-muted mb-1",children:"Description"}),r.jsx("textarea",{id:"series-description",value:l,onChange:g=>f(g.target.value),onPaste:x,rows:3,className:"w-full p-2 bg-background border border-border rounded-md focus:ring-2 focus:ring-primary focus:outline-none",placeholder:"A collection of decks covering core concepts."})]}),I&&v&&r.jsxs("div",{className:"space-y-2 animate-fade-in",children:[r.jsx("h4",{className:"text-sm font-semibold text-text-muted",children:"Structure Preview"}),r.jsx("div",{className:"bg-background border border-border rounded-md p-3 max-h-48 overflow-y-auto text-sm",children:r.jsx("ul",{className:"space-y-3",children:v.levels.map((g,b)=>r.jsxs("li",{children:[r.jsxs("div",{className:"flex items-center gap-2 font-medium text-text",children:[r.jsx(J,{name:"layers",className:"w-4 h-4 text-purple-500 flex-shrink-0"}),r.jsx("span",{className:"font-semibold",children:g.title})]}),r.jsxs("ul",{className:"pl-6 mt-1 space-y-1",children:[(g.decks||[]).map((j,O)=>r.jsxs("li",{className:"flex items-center gap-2 text-text-muted",children:[r.jsx(J,{name:"help-circle",className:"w-3.5 h-3.5 flex-shrink-0"}),r.jsx("span",{children:j.name})]},O)),(!g.decks||g.decks.length===0)&&r.jsx("li",{className:"flex items-center gap-2 text-xs text-text-muted/70 italic",children:"(No decks in this level)"})]})]},b))})})]})]}),r.jsxs("div",{className:"flex justify-end p-4 bg-background/50 border-t border-border",children:[r.jsx(se,{type:"button",variant:"secondary",onClick:o,className:"mr-2",children:"Cancel"}),r.jsxs(se,{type:"submit",variant:"primary",children:[r.jsx(J,{name:"save",className:"w-4 h-4 mr-2"}),I?"Create Series":"Save Changes"]})]})]})})}):null},hm="cogniflow-ai-options",Of={understandingLevels:["Novice","Beginner","Intermediate","Advanced","Expert"],comprehensivenessLevels:["Quick Overview","Standard","Comprehensive","Exhaustive"],learningGoalOptions:["Master a subject","Learn for the sake of curiosity","Explore a new interest","Become more informed","Understand a complex topic","Practically learn the topic"],learningStyleOptions:["Conceptual Understanding (Why & How)","Factual Recall (What, Who, When)","Practical Application & Scenarios"],languageOptions:["English","Swedish","Spanish","French","German","Japanese","Mandarin","Russian"]},by=()=>{try{const n=localStorage.getItem(hm);if(n){const i=JSON.parse(n);return{...Of,...i}}}catch(n){console.error("Failed to parse AI options from localStorage",n)}return Of},mm=()=>{const[n,i]=M.useState(by),o=l=>{try{localStorage.setItem(hm,JSON.stringify(l)),i(l)}catch(f){console.error("Failed to save AI options to localStorage",f)}},p=M.useCallback((l,f)=>{f.trim()&&i(v=>{const h=[...v[l],f.trim()],C={...v,[l]:h};return o(C),C})},[]),d=M.useCallback((l,f,v)=>{v.trim()&&i(h=>{const C=[...h[l]];C[f]=v.trim();const k={...h,[l]:C};return o(k),k})},[]),c=M.useCallback((l,f)=>{i(v=>{const h=v[l].filter((k,I)=>I!==f),C={...v,[l]:h};return o(C),C})},[]);return{options:n,addOption:p,updateOption:d,deleteOption:c}},to=({title:n,category:i,options:o,addOption:p,updateOption:d,deleteOption:c})=>{const[l,f]=M.useState(""),[v,h]=M.useState(null),[C,k]=M.useState(""),I=()=>{p(i,l),f("")},x=(g,b)=>{h(g),k(b)},S=()=>{v!==null&&d(i,v,C),h(null),k("")};return r.jsxs("div",{className:"space-y-3 p-4 bg-background rounded-lg border border-border",children:[r.jsx("h4",{className:"font-semibold text-text",children:n}),r.jsx("ul",{className:"space-y-2",children:o.map((g,b)=>r.jsxs("li",{className:"flex items-center gap-2 p-2 bg-surface rounded-md",children:[v===b?r.jsx("input",{type:"text",value:C,onChange:j=>k(j.target.value),onBlur:S,onKeyDown:j=>j.key==="Enter"&&S(),className:"flex-grow p-1 bg-background border border-primary rounded-md focus:outline-none",autoFocus:!0}):r.jsx("span",{className:"flex-grow text-text-muted",children:g}),v===b?r.jsx(se,{size:"sm",variant:"ghost",onClick:S,children:r.jsx(J,{name:"check-circle",className:"w-4 h-4 text-green-500"})}):r.jsxs(r.Fragment,{children:[r.jsx(se,{size:"sm",variant:"ghost",onClick:()=>x(b,g),children:r.jsx(J,{name:"edit",className:"w-4 h-4"})}),r.jsx(se,{size:"sm",variant:"ghost",onClick:()=>c(i,b),children:r.jsx(J,{name:"trash-2",className:"w-4 h-4 text-red-500"})})]})]},b))}),r.jsxs("div",{className:"flex items-center gap-2 pt-2 border-t border-border",children:[r.jsx("input",{type:"text",value:l,onChange:g=>f(g.target.value),onKeyDown:g=>g.key==="Enter"&&I(),placeholder:"Add new option...",className:"flex-grow p-2 bg-surface border border-border rounded-md focus:ring-2 focus:ring-primary focus:outline-none"}),r.jsx(se,{variant:"secondary",onClick:I,children:"Add"})]})]})},ky=({onBack:n})=>{const{options:i,addOption:o,updateOption:p,deleteOption:d}=mm();return r.jsxs("div",{className:"flex-grow overflow-y-auto p-6 space-y-6",children:[r.jsxs("div",{className:"flex items-center gap-2",children:[r.jsx(se,{variant:"ghost",size:"sm",className:"p-1",onClick:n,children:r.jsx(J,{name:"chevron-left"})}),r.jsx("h3",{className:"text-xl font-bold text-text",children:"Manage AI Options"})]}),r.jsx(to,{title:"Understanding Levels",category:"understandingLevels",options:i.understandingLevels,addOption:o,updateOption:p,deleteOption:d}),r.jsx(to,{title:"Comprehensiveness Levels",category:"comprehensivenessLevels",options:i.comprehensivenessLevels,addOption:o,updateOption:p,deleteOption:d}),r.jsx(to,{title:"Learning Goals",category:"learningGoalOptions",options:i.learningGoalOptions,addOption:o,updateOption:p,deleteOption:d}),r.jsx(to,{title:"Learning Styles",category:"learningStyleOptions",options:i.learningStyleOptions,addOption:o,updateOption:p,deleteOption:d}),r.jsx(to,{title:"Output Languages",category:"languageOptions",options:i.languageOptions,addOption:o,updateOption:p,deleteOption:d})]})},Sy=({isOpen:n,onClose:i,onGenerate:o})=>{const[p,d]=M.useState("form"),[c,l]=M.useState(null),[f,v]=M.useState(!1),[h,C]=M.useState(""),[k,I]=M.useState(""),[x,S]=M.useState(""),[g,b]=M.useState(""),[j,O]=M.useState(""),[R,A]=M.useState(""),[T,P]=M.useState(""),[H,K]=M.useState(""),[W,B]=M.useState(""),[Y,q]=M.useState(!0),{addToast:Q}=Kt(),N=M.useRef(null);Pt(N,n);const{aiGenerationStatus:Z}=at(),{options:oe}=mm();M.useEffect(()=>{n&&(S(oe.comprehensivenessLevels.includes("Standard")?"Standard":oe.comprehensivenessLevels[0]||""),K(oe.languageOptions.includes("English")?"English":oe.languageOptions[0]||""))},[n,oe]);const fe=()=>{l(null),v(!1),C(""),B(""),I(""),A(""),P(""),b(""),O(""),S(oe.comprehensivenessLevels.includes("Standard")?"Standard":oe.comprehensivenessLevels[0]||""),K(oe.languageOptions.includes("English")?"English":oe.languageOptions[0]||""),d("form"),i()},ye=z=>{if(z.preventDefault(),Z.currentTask||Z.queue.length>5){Q("The AI queue is full. Please wait for some tasks to complete.","info");return}if(!c)return;if(!h.trim()){Q("Please enter a topic.","error");return}const F={...{topic:h,level:W||void 0,comprehensiveness:x,customInstructions:k||void 0,learningGoal:g||void 0,learningStyle:j||void 0,focusTopics:R||void 0,excludeTopics:T||void 0,language:H||void 0},generationType:f?"learning":c,generateQuestions:c==="series"?Y:void 0,isLearningMode:f};o(F),fe()};if(!n)return null;const ue=()=>r.jsxs("form",{onSubmit:ye,className:"flex-grow overflow-y-auto p-6 space-y-6",children:[r.jsxs("div",{children:[r.jsxs("label",{htmlFor:"ai-topic",className:"block text-sm font-bold text-text mb-1",children:["Main Topic ",r.jsx("span",{className:"text-red-500",children:"*"})]}),r.jsx("input",{id:"ai-topic",type:"text",value:h,onChange:z=>C(z.target.value),className:"w-full p-2 bg-background border border-border rounded-md focus:ring-2 focus:ring-primary focus:outline-none",placeholder:"e.g., The History of Ancient Rome",required:!0,autoFocus:!0})]}),r.jsx("div",{className:"bg-primary/10 p-4 rounded-lg border border-primary/20",children:r.jsx(Ls,{label:"Enable Learning Mode",description:"Generates info cards followed by related questions.",checked:f,onChange:v})}),c==="series"&&!f&&r.jsx("div",{className:"bg-primary/10 p-4 rounded-lg border border-primary/20",children:r.jsx(Ls,{label:"Generate questions for all decks",description:"The AI will create the full series and populate all decks with questions.",checked:Y,onChange:q})}),r.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[r.jsxs("div",{children:[r.jsx("label",{htmlFor:"ai-level",className:"block text-sm font-medium text-text-muted mb-1",children:" My Current Understanding Is... "}),r.jsxs("select",{id:"ai-level",value:W,onChange:z=>B(z.target.value),className:"w-full p-2 bg-background border border-border rounded-md focus:ring-2 focus:ring-primary focus:outline-none",children:[r.jsx("option",{value:"",children:"(Optional)"}),oe.understandingLevels.map(z=>r.jsx("option",{value:z,children:z},z))]})]}),r.jsxs("div",{children:[r.jsx("label",{htmlFor:"ai-goal",className:"block text-sm font-medium text-text-muted mb-1",children:" My Primary Goal Is... "}),r.jsxs("select",{id:"ai-goal",value:g,onChange:z=>b(z.target.value),className:"w-full p-2 bg-background border border-border rounded-md focus:ring-2 focus:ring-primary focus:outline-none",children:[r.jsx("option",{value:"",children:"(Optional)"}),oe.learningGoalOptions.map(z=>r.jsx("option",{value:z,children:z},z))]})]})]}),r.jsxs("details",{className:"space-y-4",children:[r.jsx("summary",{className:"cursor-pointer text-sm font-medium text-primary hover:underline",children:" Advanced Options "}),r.jsxs("div",{className:"pt-4 space-y-6 animate-fade-in",children:[r.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[r.jsxs("div",{children:[r.jsx("label",{htmlFor:"ai-style",className:"block text-sm font-medium text-text-muted mb-1",children:" Preferred Learning Style "}),r.jsxs("select",{id:"ai-style",value:j,onChange:z=>O(z.target.value),className:"w-full p-2 bg-background border border-border rounded-md focus:ring-2 focus:ring-primary focus:outline-none",children:[r.jsx("option",{value:"",children:"(Optional)"}),oe.learningStyleOptions.map(z=>r.jsx("option",{value:z,children:z},z))]})]}),r.jsxs("div",{children:[r.jsx("label",{htmlFor:"ai-comp",className:"block text-sm font-medium text-text-muted mb-1",children:" Desired Comprehensiveness "}),r.jsx("select",{id:"ai-comp",value:x,onChange:z=>S(z.target.value),className:"w-full p-2 bg-background border border-border rounded-md focus:ring-2 focus:ring-primary focus:outline-none",children:oe.comprehensivenessLevels.map(z=>r.jsx("option",{value:z,children:z},z))})]})]}),r.jsxs("div",{children:[r.jsx("label",{htmlFor:"ai-focus",className:"block text-sm font-medium text-text-muted mb-1",children:" Specific Topics to Focus On "}),r.jsx("input",{id:"ai-focus",type:"text",value:R,onChange:z=>A(z.target.value),className:"w-full p-2 bg-background border border-border rounded-md focus:ring-2 focus:ring-primary focus:outline-none",placeholder:"e.g., The Roman Republic, not the Empire"})]}),r.jsxs("div",{children:[r.jsx("label",{htmlFor:"ai-exclude",className:"block text-sm font-medium text-text-muted mb-1",children:" Topics to Exclude "}),r.jsx("input",{id:"ai-exclude",type:"text",value:T,onChange:z=>P(z.target.value),className:"w-full p-2 bg-background border border-border rounded-md focus:ring-2 focus:ring-primary focus:outline-none",placeholder:"e.g., military history, specific emperors"})]}),r.jsxs("div",{children:[r.jsx("label",{htmlFor:"ai-instructions",className:"block text-sm font-medium text-text-muted mb-1",children:" Additional Instructions "}),r.jsx("textarea",{id:"ai-instructions",value:k,onChange:z=>I(z.target.value),rows:3,className:"w-full p-2 bg-background border border-border rounded-md focus:ring-2 focus:ring-primary focus:outline-none",placeholder:"e.g., 'Focus on practical examples for a beginner.'"})]}),r.jsxs("div",{children:[r.jsx("label",{htmlFor:"ai-lang",className:"block text-sm font-medium text-text-muted mb-1",children:" Output Language "}),r.jsx("select",{id:"ai-lang",value:H,onChange:z=>K(z.target.value),className:"w-full p-2 bg-background border border-border rounded-md focus:ring-2 focus:ring-primary focus:outline-none",children:oe.languageOptions.map(z=>r.jsx("option",{value:z,children:z},z))})]})]})]})]});return r.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-75 flex items-center justify-center z-[60] p-4",children:r.jsxs("div",{ref:N,className:"bg-surface rounded-lg shadow-xl w-full max-w-2xl transform transition-all relative max-h-[90vh] flex flex-col",children:[r.jsxs("div",{className:"flex-shrink-0 flex justify-between items-center p-4 border-b border-border",children:[r.jsxs("div",{className:"flex items-center gap-2",children:[c&&p==="form"&&r.jsx(se,{variant:"ghost",size:"sm",className:"p-1",onClick:()=>l(null),children:r.jsx(J,{name:"chevron-left"})}),r.jsx("h2",{className:"text-xl font-bold",children:"Generate with AI"})]}),r.jsxs("div",{className:"flex items-center gap-1",children:[p==="form"&&r.jsx(se,{type:"button",variant:"ghost",onClick:()=>d("manager"),className:"p-1 h-auto","aria-label":"Manage AI options",children:r.jsx(J,{name:"settings"})}),r.jsx(se,{type:"button",variant:"ghost",onClick:fe,className:"p-1 h-auto",children:r.jsx(J,{name:"x"})})]})]}),p==="manager"?r.jsx(ky,{onBack:()=>d("form")}):c?ue():r.jsxs("div",{className:"p-6 text-center space-y-4",children:[r.jsx("p",{className:"text-text-muted",children:"What would you like to create?"}),r.jsxs("div",{className:"flex flex-col sm:flex-row gap-4 justify-center",children:[r.jsxs(se,{variant:"secondary",size:"lg",onClick:()=>l("series"),className:"w-full sm:w-auto",children:[r.jsx(J,{name:"layers",className:"w-5 h-5 mr-2"}),"A Series of Decks"]}),r.jsxs(se,{variant:"secondary",size:"lg",onClick:()=>l("deck"),className:"w-full sm:w-auto",children:[r.jsx(J,{name:"help-circle",className:"w-5 h-5 mr-2"}),"A Single Deck"]})]})]}),p==="form"&&c&&r.jsxs("div",{className:"flex-shrink-0 flex justify-end p-4 bg-background/50 border-t border-border",children:[r.jsx(se,{type:"button",variant:"secondary",onClick:fe,children:"Cancel"}),r.jsx(se,{type:"submit",variant:"primary",onClick:ye,children:`Generate ${f?"Content":c==="series"?"Series":"Deck"}`})]})]})})},jy=({isOpen:n,onClose:i,onCancel:o})=>{const{currentTask:p,queue:d}=at(v=>v.aiGenerationStatus),c=M.useRef(null);Pt(c,n);const l=()=>{o()},f=v=>{o(v)};return n?r.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-75 flex items-center justify-center z-[60] p-4",children:r.jsxs("div",{ref:c,className:"bg-surface rounded-lg shadow-xl w-full max-w-lg transform transition-all relative max-h-[90vh] flex flex-col",role:"dialog","aria-modal":"true","aria-labelledby":"ai-status-title",children:[r.jsxs("div",{className:"flex-shrink-0 flex justify-between items-center p-4 border-b border-border",children:[r.jsx("h2",{id:"ai-status-title",className:"text-xl font-bold text-text",children:"AI Generation Status"}),r.jsx(se,{type:"button",variant:"ghost",onClick:i,className:"p-1 h-auto","aria-label":"Close",children:r.jsx(J,{name:"x"})})]}),r.jsxs("div",{className:"p-6 overflow-y-auto space-y-6",children:[r.jsxs("div",{children:[r.jsx("h3",{className:"text-sm font-semibold uppercase tracking-wider text-text-muted mb-2",children:"Current Task"}),r.jsx("div",{className:"bg-background p-4 rounded-lg",children:p?r.jsxs("div",{className:"flex items-center gap-4",children:[r.jsx(Bt,{size:"sm"}),r.jsx("p",{className:"text-text-muted flex-grow",children:p.statusText||"Processing your request..."}),r.jsx(se,{variant:"danger",size:"sm",onClick:l,children:"Cancel"})]}):r.jsx("p",{className:"text-text-muted text-center py-4",children:"No AI tasks are currently running."})})]}),d.length>0&&r.jsxs("div",{children:[r.jsxs("h3",{className:"text-sm font-semibold uppercase tracking-wider text-text-muted mb-2",children:["Queued Tasks (",d.length,")"]}),r.jsx("ul",{className:"space-y-2",children:d.map(v=>r.jsxs("li",{className:"bg-background p-3 rounded-lg flex items-center justify-between gap-4",children:[r.jsx("p",{className:"text-text-muted text-sm truncate flex-grow",children:v.statusText}),r.jsx(se,{variant:"ghost",size:"sm",className:"p-1 h-auto hover:text-red-500",onClick:()=>f(v.id),"aria-label":`Cancel task: ${v.statusText}`,children:r.jsx(J,{name:"x-circle",className:"w-5 h-5"})})]},v.id))})]})]}),r.jsx("div",{className:"flex-shrink-0 flex justify-end p-4 bg-background/50 border-t border-border",children:r.jsx(se,{type:"button",variant:"primary",onClick:i,children:"Close"})})]})}):null},Ey=({isOpen:n,onClose:i,onRestore:o,onDelete:p})=>{const[d,c]=M.useState([]),[l,f]=M.useState(!1),[v,h]=M.useState(null),[C,k]=M.useState(null),{addToast:I}=Kt(),x=M.useRef(null);Pt(x,n),M.useEffect(()=>{n&&(async()=>{f(!0),h(null),k("Loading sync file info...");try{const[j,{metadata:O}]=await Promise.all([og(),Ii()]),R=j.sort((A,T)=>new Date(T.modified).getTime()-new Date(A.modified).getTime());if(c(R),O){const A=new Date(O.modified),T=(O.size/1024).toFixed(1);k(`Live sync file: ${A.toLocaleString()} (${T} KB)`)}else k("No live sync file found on server.")}catch(j){const O=j instanceof Error?j.message:"Failed to load backups.";h(O),k("Could not retrieve live sync file info.")}finally{f(!1)}})()},[n]);const S=b=>{o(b),i()},g=async b=>{try{await p(b),c(j=>j.filter(O=>O.filename!==b)),I(`Deleted backup: ${b}`,"success")}catch{}};return r.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-75 flex items-center justify-center z-[60] p-4",children:r.jsxs("div",{ref:x,className:"bg-surface rounded-lg shadow-xl w-full max-w-2xl transform transition-all relative max-h-[90vh] flex flex-col",children:[r.jsxs("div",{className:"flex-shrink-0 flex justify-between items-center p-4 border-b border-border",children:[r.jsx("h2",{className:"text-xl font-bold",children:"Manage Server Backups"}),r.jsx(se,{type:"button",variant:"ghost",onClick:i,className:"p-1 h-auto",children:r.jsx(J,{name:"x"})})]}),r.jsxs("div",{className:"p-6 overflow-y-auto",children:[r.jsx("p",{className:"text-text-muted mb-2",children:"Select a backup to restore your live sync data from, or delete old backups. Restoring will overwrite the current sync file on the server."}),C&&r.jsx("p",{className:"text-sm text-text-muted mb-4 p-2 bg-background rounded-md",children:C}),l?r.jsx("div",{className:"text-center py-8",children:r.jsx(Bt,{})}):v?r.jsx("div",{className:"text-center py-8 text-red-500",children:v}):d.length>0?r.jsx("div",{className:"space-y-2 border border-border rounded-md",children:d.map(b=>r.jsxs("div",{className:"flex items-center justify-between p-3 hover:bg-background border-b border-border last:border-b-0",children:[r.jsxs("div",{className:"text-sm min-w-0",children:[r.jsx("p",{className:"font-medium text-text truncate",children:b.filename}),r.jsxs("p",{className:"text-text-muted",children:[new Date(b.modified).toLocaleString()," - ",(b.size/1024).toFixed(2)," KB"]})]}),r.jsxs("div",{className:"flex-shrink-0 flex items-center gap-1",children:[r.jsx(se,{variant:"secondary",size:"sm",onClick:()=>S(b.filename),children:"Restore"}),r.jsx(se,{variant:"danger",size:"sm",onClick:()=>g(b.filename),children:"Delete"})]})]},b.filename))}):r.jsx("div",{className:"text-center py-8 text-text-muted",children:r.jsx("p",{children:"No server backups found."})})]}),r.jsx("div",{className:"flex-shrink-0 flex justify-end p-4 bg-background/50 border-t border-border",children:r.jsx(se,{type:"button",variant:"primary",onClick:i,children:"Close"})})]})})},Ny=({isOpen:n,onClose:i,onConfirm:o,analysis:p})=>{const[d,c]=M.useState(""),l=M.useRef(null);Pt(l,n),M.useEffect(()=>{p.type==="quiz"&&p.data.name?c(p.data.name):c("")},[p]);const{title:f,message:v,confirmText:h}=M.useMemo(()=>{switch(p.type){case"backup":return{title:"Restore from Backup",message:`You dropped the backup file "${p.fileName}". Restoring will merge its content with your current data. Do you want to continue?`,confirmText:"Restore"};case"quiz_series":return{title:"Import Series",message:`You dropped a file containing the series "${p.data.seriesName}". Would you like to import it?`,confirmText:"Import Series"};case"quiz":return{title:"Import Quiz Deck",message:`You dropped a file for the quiz deck "${p.data.name}". Would you like to import it?`,confirmText:"Import Deck"};case"flashcard":return{title:"Import Flashcard Deck",message:`You dropped a file with ${p.data.length} flashcard(s). Please provide a name for the new deck.`,confirmText:"Import Deck"};default:return{title:"Confirm Import",message:"Unknown file type.",confirmText:"Confirm"}}},[p]),C=p.type==="flashcard"&&!d.trim(),k=()=>{o(p,d.trim())};return n?r.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-75 flex items-center justify-center z-[60] p-4",children:r.jsxs("div",{ref:l,className:"bg-surface rounded-lg shadow-xl w-full max-w-lg transform transition-all relative",children:[r.jsxs("div",{className:"flex justify-between items-center p-4 border-b border-border",children:[r.jsx("h2",{className:"text-xl font-bold text-text",children:f}),r.jsx(se,{type:"button",variant:"ghost",onClick:i,className:"p-1 h-auto","aria-label":"Close",children:r.jsx(J,{name:"x"})})]}),r.jsxs("div",{className:"p-6 space-y-4",children:[r.jsx("p",{className:"text-text-muted",children:v}),(p.type==="flashcard"||p.type==="quiz")&&r.jsxs("div",{children:[r.jsx("label",{htmlFor:"deck-name-input",className:"block text-sm font-medium text-text-muted mb-1",children:"Deck Name"}),r.jsx("input",{id:"deck-name-input",type:"text",value:d,onChange:I=>c(I.target.value),className:"w-full p-2 bg-background border border-border rounded-md focus:ring-2 focus:ring-primary focus:outline-none",placeholder:"Enter a name for the new deck",autoFocus:!0})]})]}),r.jsxs("div",{className:"flex justify-end p-4 bg-background/50 border-t border-border",children:[r.jsx(se,{type:"button",variant:"secondary",onClick:i,className:"mr-2",children:"Cancel"}),r.jsx(se,{type:"button",variant:"primary",onClick:k,disabled:C,children:h})]})]})}):null};/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 *//**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */var Rf;(function(n){n.OUTCOME_UNSPECIFIED="OUTCOME_UNSPECIFIED",n.OUTCOME_OK="OUTCOME_OK",n.OUTCOME_FAILED="OUTCOME_FAILED",n.OUTCOME_DEADLINE_EXCEEDED="OUTCOME_DEADLINE_EXCEEDED"})(Rf||(Rf={}));var Mf;(function(n){n.LANGUAGE_UNSPECIFIED="LANGUAGE_UNSPECIFIED",n.PYTHON="PYTHON"})(Mf||(Mf={}));var et;(function(n){n.TYPE_UNSPECIFIED="TYPE_UNSPECIFIED",n.STRING="STRING",n.NUMBER="NUMBER",n.INTEGER="INTEGER",n.BOOLEAN="BOOLEAN",n.ARRAY="ARRAY",n.OBJECT="OBJECT",n.NULL="NULL"})(et||(et={}));var Lf;(function(n){n.HARM_CATEGORY_UNSPECIFIED="HARM_CATEGORY_UNSPECIFIED",n.HARM_CATEGORY_HATE_SPEECH="HARM_CATEGORY_HATE_SPEECH",n.HARM_CATEGORY_DANGEROUS_CONTENT="HARM_CATEGORY_DANGEROUS_CONTENT",n.HARM_CATEGORY_HARASSMENT="HARM_CATEGORY_HARASSMENT",n.HARM_CATEGORY_SEXUALLY_EXPLICIT="HARM_CATEGORY_SEXUALLY_EXPLICIT",n.HARM_CATEGORY_CIVIC_INTEGRITY="HARM_CATEGORY_CIVIC_INTEGRITY",n.HARM_CATEGORY_IMAGE_HATE="HARM_CATEGORY_IMAGE_HATE",n.HARM_CATEGORY_IMAGE_DANGEROUS_CONTENT="HARM_CATEGORY_IMAGE_DANGEROUS_CONTENT",n.HARM_CATEGORY_IMAGE_HARASSMENT="HARM_CATEGORY_IMAGE_HARASSMENT",n.HARM_CATEGORY_IMAGE_SEXUALLY_EXPLICIT="HARM_CATEGORY_IMAGE_SEXUALLY_EXPLICIT"})(Lf||(Lf={}));var Ff;(function(n){n.HARM_BLOCK_METHOD_UNSPECIFIED="HARM_BLOCK_METHOD_UNSPECIFIED",n.SEVERITY="SEVERITY",n.PROBABILITY="PROBABILITY"})(Ff||(Ff={}));var Pf;(function(n){n.HARM_BLOCK_THRESHOLD_UNSPECIFIED="HARM_BLOCK_THRESHOLD_UNSPECIFIED",n.BLOCK_LOW_AND_ABOVE="BLOCK_LOW_AND_ABOVE",n.BLOCK_MEDIUM_AND_ABOVE="BLOCK_MEDIUM_AND_ABOVE",n.BLOCK_ONLY_HIGH="BLOCK_ONLY_HIGH",n.BLOCK_NONE="BLOCK_NONE",n.OFF="OFF"})(Pf||(Pf={}));var Uf;(function(n){n.MODE_UNSPECIFIED="MODE_UNSPECIFIED",n.MODE_DYNAMIC="MODE_DYNAMIC"})(Uf||(Uf={}));var zf;(function(n){n.AUTH_TYPE_UNSPECIFIED="AUTH_TYPE_UNSPECIFIED",n.NO_AUTH="NO_AUTH",n.API_KEY_AUTH="API_KEY_AUTH",n.HTTP_BASIC_AUTH="HTTP_BASIC_AUTH",n.GOOGLE_SERVICE_ACCOUNT_AUTH="GOOGLE_SERVICE_ACCOUNT_AUTH",n.OAUTH="OAUTH",n.OIDC_AUTH="OIDC_AUTH"})(zf||(zf={}));var Bf;(function(n){n.API_SPEC_UNSPECIFIED="API_SPEC_UNSPECIFIED",n.SIMPLE_SEARCH="SIMPLE_SEARCH",n.ELASTIC_SEARCH="ELASTIC_SEARCH"})(Bf||(Bf={}));var Hf;(function(n){n.URL_RETRIEVAL_STATUS_UNSPECIFIED="URL_RETRIEVAL_STATUS_UNSPECIFIED",n.URL_RETRIEVAL_STATUS_SUCCESS="URL_RETRIEVAL_STATUS_SUCCESS",n.URL_RETRIEVAL_STATUS_ERROR="URL_RETRIEVAL_STATUS_ERROR",n.URL_RETRIEVAL_STATUS_PAYWALL="URL_RETRIEVAL_STATUS_PAYWALL",n.URL_RETRIEVAL_STATUS_UNSAFE="URL_RETRIEVAL_STATUS_UNSAFE"})(Hf||(Hf={}));var qf;(function(n){n.FINISH_REASON_UNSPECIFIED="FINISH_REASON_UNSPECIFIED",n.STOP="STOP",n.MAX_TOKENS="MAX_TOKENS",n.SAFETY="SAFETY",n.RECITATION="RECITATION",n.LANGUAGE="LANGUAGE",n.OTHER="OTHER",n.BLOCKLIST="BLOCKLIST",n.PROHIBITED_CONTENT="PROHIBITED_CONTENT",n.SPII="SPII",n.MALFORMED_FUNCTION_CALL="MALFORMED_FUNCTION_CALL",n.IMAGE_SAFETY="IMAGE_SAFETY",n.UNEXPECTED_TOOL_CALL="UNEXPECTED_TOOL_CALL"})(qf||(qf={}));var $f;(function(n){n.HARM_PROBABILITY_UNSPECIFIED="HARM_PROBABILITY_UNSPECIFIED",n.NEGLIGIBLE="NEGLIGIBLE",n.LOW="LOW",n.MEDIUM="MEDIUM",n.HIGH="HIGH"})($f||($f={}));var Gf;(function(n){n.HARM_SEVERITY_UNSPECIFIED="HARM_SEVERITY_UNSPECIFIED",n.HARM_SEVERITY_NEGLIGIBLE="HARM_SEVERITY_NEGLIGIBLE",n.HARM_SEVERITY_LOW="HARM_SEVERITY_LOW",n.HARM_SEVERITY_MEDIUM="HARM_SEVERITY_MEDIUM",n.HARM_SEVERITY_HIGH="HARM_SEVERITY_HIGH"})(Gf||(Gf={}));var Wf;(function(n){n.BLOCKED_REASON_UNSPECIFIED="BLOCKED_REASON_UNSPECIFIED",n.SAFETY="SAFETY",n.OTHER="OTHER",n.BLOCKLIST="BLOCKLIST",n.PROHIBITED_CONTENT="PROHIBITED_CONTENT",n.IMAGE_SAFETY="IMAGE_SAFETY"})(Wf||(Wf={}));var Qf;(function(n){n.TRAFFIC_TYPE_UNSPECIFIED="TRAFFIC_TYPE_UNSPECIFIED",n.ON_DEMAND="ON_DEMAND",n.PROVISIONED_THROUGHPUT="PROVISIONED_THROUGHPUT"})(Qf||(Qf={}));var Yf;(function(n){n.MODALITY_UNSPECIFIED="MODALITY_UNSPECIFIED",n.TEXT="TEXT",n.IMAGE="IMAGE",n.AUDIO="AUDIO"})(Yf||(Yf={}));var Vf;(function(n){n.MEDIA_RESOLUTION_UNSPECIFIED="MEDIA_RESOLUTION_UNSPECIFIED",n.MEDIA_RESOLUTION_LOW="MEDIA_RESOLUTION_LOW",n.MEDIA_RESOLUTION_MEDIUM="MEDIA_RESOLUTION_MEDIUM",n.MEDIA_RESOLUTION_HIGH="MEDIA_RESOLUTION_HIGH"})(Vf||(Vf={}));var Kf;(function(n){n.JOB_STATE_UNSPECIFIED="JOB_STATE_UNSPECIFIED",n.JOB_STATE_QUEUED="JOB_STATE_QUEUED",n.JOB_STATE_PENDING="JOB_STATE_PENDING",n.JOB_STATE_RUNNING="JOB_STATE_RUNNING",n.JOB_STATE_SUCCEEDED="JOB_STATE_SUCCEEDED",n.JOB_STATE_FAILED="JOB_STATE_FAILED",n.JOB_STATE_CANCELLING="JOB_STATE_CANCELLING",n.JOB_STATE_CANCELLED="JOB_STATE_CANCELLED",n.JOB_STATE_PAUSED="JOB_STATE_PAUSED",n.JOB_STATE_EXPIRED="JOB_STATE_EXPIRED",n.JOB_STATE_UPDATING="JOB_STATE_UPDATING",n.JOB_STATE_PARTIALLY_SUCCEEDED="JOB_STATE_PARTIALLY_SUCCEEDED"})(Kf||(Kf={}));var Jf;(function(n){n.TUNING_MODE_UNSPECIFIED="TUNING_MODE_UNSPECIFIED",n.TUNING_MODE_FULL="TUNING_MODE_FULL",n.TUNING_MODE_PEFT_ADAPTER="TUNING_MODE_PEFT_ADAPTER"})(Jf||(Jf={}));var Zf;(function(n){n.ADAPTER_SIZE_UNSPECIFIED="ADAPTER_SIZE_UNSPECIFIED",n.ADAPTER_SIZE_ONE="ADAPTER_SIZE_ONE",n.ADAPTER_SIZE_TWO="ADAPTER_SIZE_TWO",n.ADAPTER_SIZE_FOUR="ADAPTER_SIZE_FOUR",n.ADAPTER_SIZE_EIGHT="ADAPTER_SIZE_EIGHT",n.ADAPTER_SIZE_SIXTEEN="ADAPTER_SIZE_SIXTEEN",n.ADAPTER_SIZE_THIRTY_TWO="ADAPTER_SIZE_THIRTY_TWO"})(Zf||(Zf={}));var Xf;(function(n){n.FEATURE_SELECTION_PREFERENCE_UNSPECIFIED="FEATURE_SELECTION_PREFERENCE_UNSPECIFIED",n.PRIORITIZE_QUALITY="PRIORITIZE_QUALITY",n.BALANCED="BALANCED",n.PRIORITIZE_COST="PRIORITIZE_COST"})(Xf||(Xf={}));var eh;(function(n){n.UNSPECIFIED="UNSPECIFIED",n.BLOCKING="BLOCKING",n.NON_BLOCKING="NON_BLOCKING"})(eh||(eh={}));var th;(function(n){n.MODE_UNSPECIFIED="MODE_UNSPECIFIED",n.MODE_DYNAMIC="MODE_DYNAMIC"})(th||(th={}));var rh;(function(n){n.ENVIRONMENT_UNSPECIFIED="ENVIRONMENT_UNSPECIFIED",n.ENVIRONMENT_BROWSER="ENVIRONMENT_BROWSER"})(rh||(rh={}));var nh;(function(n){n.MODE_UNSPECIFIED="MODE_UNSPECIFIED",n.AUTO="AUTO",n.ANY="ANY",n.NONE="NONE"})(nh||(nh={}));var sh;(function(n){n.BLOCK_LOW_AND_ABOVE="BLOCK_LOW_AND_ABOVE",n.BLOCK_MEDIUM_AND_ABOVE="BLOCK_MEDIUM_AND_ABOVE",n.BLOCK_ONLY_HIGH="BLOCK_ONLY_HIGH",n.BLOCK_NONE="BLOCK_NONE"})(sh||(sh={}));var ah;(function(n){n.DONT_ALLOW="DONT_ALLOW",n.ALLOW_ADULT="ALLOW_ADULT",n.ALLOW_ALL="ALLOW_ALL"})(ah||(ah={}));var oh;(function(n){n.auto="auto",n.en="en",n.ja="ja",n.ko="ko",n.hi="hi",n.zh="zh",n.pt="pt",n.es="es"})(oh||(oh={}));var ih;(function(n){n.MASK_MODE_DEFAULT="MASK_MODE_DEFAULT",n.MASK_MODE_USER_PROVIDED="MASK_MODE_USER_PROVIDED",n.MASK_MODE_BACKGROUND="MASK_MODE_BACKGROUND",n.MASK_MODE_FOREGROUND="MASK_MODE_FOREGROUND",n.MASK_MODE_SEMANTIC="MASK_MODE_SEMANTIC"})(ih||(ih={}));var lh;(function(n){n.CONTROL_TYPE_DEFAULT="CONTROL_TYPE_DEFAULT",n.CONTROL_TYPE_CANNY="CONTROL_TYPE_CANNY",n.CONTROL_TYPE_SCRIBBLE="CONTROL_TYPE_SCRIBBLE",n.CONTROL_TYPE_FACE_MESH="CONTROL_TYPE_FACE_MESH"})(lh||(lh={}));var ch;(function(n){n.SUBJECT_TYPE_DEFAULT="SUBJECT_TYPE_DEFAULT",n.SUBJECT_TYPE_PERSON="SUBJECT_TYPE_PERSON",n.SUBJECT_TYPE_ANIMAL="SUBJECT_TYPE_ANIMAL",n.SUBJECT_TYPE_PRODUCT="SUBJECT_TYPE_PRODUCT"})(ch||(ch={}));var uh;(function(n){n.EDIT_MODE_DEFAULT="EDIT_MODE_DEFAULT",n.EDIT_MODE_INPAINT_REMOVAL="EDIT_MODE_INPAINT_REMOVAL",n.EDIT_MODE_INPAINT_INSERTION="EDIT_MODE_INPAINT_INSERTION",n.EDIT_MODE_OUTPAINT="EDIT_MODE_OUTPAINT",n.EDIT_MODE_CONTROLLED_EDITING="EDIT_MODE_CONTROLLED_EDITING",n.EDIT_MODE_STYLE="EDIT_MODE_STYLE",n.EDIT_MODE_BGSWAP="EDIT_MODE_BGSWAP",n.EDIT_MODE_PRODUCT_IMAGE="EDIT_MODE_PRODUCT_IMAGE"})(uh||(uh={}));var dh;(function(n){n.FOREGROUND="FOREGROUND",n.BACKGROUND="BACKGROUND",n.PROMPT="PROMPT",n.SEMANTIC="SEMANTIC",n.INTERACTIVE="INTERACTIVE"})(dh||(dh={}));var fh;(function(n){n.OPTIMIZED="OPTIMIZED",n.LOSSLESS="LOSSLESS"})(fh||(fh={}));var hh;(function(n){n.STATE_UNSPECIFIED="STATE_UNSPECIFIED",n.PROCESSING="PROCESSING",n.ACTIVE="ACTIVE",n.FAILED="FAILED"})(hh||(hh={}));var mh;(function(n){n.SOURCE_UNSPECIFIED="SOURCE_UNSPECIFIED",n.UPLOADED="UPLOADED",n.GENERATED="GENERATED"})(mh||(mh={}));var ph;(function(n){n.MODALITY_UNSPECIFIED="MODALITY_UNSPECIFIED",n.TEXT="TEXT",n.IMAGE="IMAGE",n.VIDEO="VIDEO",n.AUDIO="AUDIO",n.DOCUMENT="DOCUMENT"})(ph||(ph={}));var gh;(function(n){n.START_SENSITIVITY_UNSPECIFIED="START_SENSITIVITY_UNSPECIFIED",n.START_SENSITIVITY_HIGH="START_SENSITIVITY_HIGH",n.START_SENSITIVITY_LOW="START_SENSITIVITY_LOW"})(gh||(gh={}));var xh;(function(n){n.END_SENSITIVITY_UNSPECIFIED="END_SENSITIVITY_UNSPECIFIED",n.END_SENSITIVITY_HIGH="END_SENSITIVITY_HIGH",n.END_SENSITIVITY_LOW="END_SENSITIVITY_LOW"})(xh||(xh={}));var yh;(function(n){n.ACTIVITY_HANDLING_UNSPECIFIED="ACTIVITY_HANDLING_UNSPECIFIED",n.START_OF_ACTIVITY_INTERRUPTS="START_OF_ACTIVITY_INTERRUPTS",n.NO_INTERRUPTION="NO_INTERRUPTION"})(yh||(yh={}));var vh;(function(n){n.TURN_COVERAGE_UNSPECIFIED="TURN_COVERAGE_UNSPECIFIED",n.TURN_INCLUDES_ONLY_ACTIVITY="TURN_INCLUDES_ONLY_ACTIVITY",n.TURN_INCLUDES_ALL_INPUT="TURN_INCLUDES_ALL_INPUT"})(vh||(vh={}));var wh;(function(n){n.SCHEDULING_UNSPECIFIED="SCHEDULING_UNSPECIFIED",n.SILENT="SILENT",n.WHEN_IDLE="WHEN_IDLE",n.INTERRUPT="INTERRUPT"})(wh||(wh={}));var bh;(function(n){n.SCALE_UNSPECIFIED="SCALE_UNSPECIFIED",n.C_MAJOR_A_MINOR="C_MAJOR_A_MINOR",n.D_FLAT_MAJOR_B_FLAT_MINOR="D_FLAT_MAJOR_B_FLAT_MINOR",n.D_MAJOR_B_MINOR="D_MAJOR_B_MINOR",n.E_FLAT_MAJOR_C_MINOR="E_FLAT_MAJOR_C_MINOR",n.E_MAJOR_D_FLAT_MINOR="E_MAJOR_D_FLAT_MINOR",n.F_MAJOR_D_MINOR="F_MAJOR_D_MINOR",n.G_FLAT_MAJOR_E_FLAT_MINOR="G_FLAT_MAJOR_E_FLAT_MINOR",n.G_MAJOR_E_MINOR="G_MAJOR_E_MINOR",n.A_FLAT_MAJOR_F_MINOR="A_FLAT_MAJOR_F_MINOR",n.A_MAJOR_G_FLAT_MINOR="A_MAJOR_G_FLAT_MINOR",n.B_FLAT_MAJOR_G_MINOR="B_FLAT_MAJOR_G_MINOR",n.B_MAJOR_A_FLAT_MINOR="B_MAJOR_A_FLAT_MINOR"})(bh||(bh={}));var kh;(function(n){n.MUSIC_GENERATION_MODE_UNSPECIFIED="MUSIC_GENERATION_MODE_UNSPECIFIED",n.QUALITY="QUALITY",n.DIVERSITY="DIVERSITY",n.VOCALIZATION="VOCALIZATION"})(kh||(kh={}));var Sh;(function(n){n.PLAYBACK_CONTROL_UNSPECIFIED="PLAYBACK_CONTROL_UNSPECIFIED",n.PLAY="PLAY",n.PAUSE="PAUSE",n.STOP="STOP",n.RESET_CONTEXT="RESET_CONTEXT"})(Sh||(Sh={}));/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */var jh;(function(n){n.PAGED_ITEM_BATCH_JOBS="batchJobs",n.PAGED_ITEM_MODELS="models",n.PAGED_ITEM_TUNING_JOBS="tuningJobs",n.PAGED_ITEM_FILES="files",n.PAGED_ITEM_CACHED_CONTENTS="cachedContents"})(jh||(jh={}));et.OBJECT,et.STRING,et.STRING,et.ARRAY,et.OBJECT,et.STRING,et.ARRAY,et.OBJECT,et.STRING,et.STRING,et.ARRAY,et.OBJECT,et.STRING,et.NUMBER;et.OBJECT,et.ARRAY,et.OBJECT,et.STRING,et.STRING,et.STRING,et.ARRAY,et.OBJECT,et.STRING,et.STRING;et.OBJECT,et.STRING,et.STRING;et.ARRAY;et.ARRAY;et.OBJECT,et.STRING,et.STRING,et.ARRAY,et.OBJECT,et.STRING,et.ARRAY;et.OBJECT;const _y={type:et.ARRAY,description:"An array of one or more actions the user wants to perform. If the user is just chatting, return an array with a single NO_ACTION.",items:{type:et.OBJECT,properties:{action:{type:et.STRING,enum:Object.values(Or),description:"The specific action the user wants to perform. Use NO_ACTION for conversational replies."},payload:{type:et.OBJECT,description:"The data needed to perform the action. Include only necessary fields.",properties:{deckId:{type:et.STRING,description:"The ID of the target deck."},folderId:{type:et.STRING,description:"The ID of the target folder. Use null to move a deck out of a folder."},name:{type:et.STRING,description:"The name for a new deck or folder."},newName:{type:et.STRING,description:"The new name for a deck or folder being renamed."},seriesId:{type:et.STRING,description:"The ID of the target series for expansion."},levelIndex:{type:et.NUMBER,description:"The 0-based index of the level within the series to add decks to."},count:{type:et.NUMBER,description:"The number of questions to generate for a deck."}}},confirmationMessage:{type:et.STRING,description:"A friendly message to the user asking them to confirm the action. For a NO_ACTION, this should be the AI's conversational reply."}},required:["action","payload","confirmationMessage"]}},Cy=()=>{throw new Error("AI features are disabled. A Google Gemini API key is required.")},Iy=async(n,i)=>{const o=Cy(),p=i.decks.map(f=>`- Deck: "${f.name}" (id: ${f.id}, folderId: ${f.folderId||"none"})`).join(`
`),d=i.folders.map(f=>`- Folder: "${f.name}" (id: ${f.id})`).join(`
`),c=i.series.map(f=>{const v=f.levels.map((h,C)=>`  - Level ${C}: ${h.title} (${h.deckIds.length} decks)`).join(`
`);return`- Series: "${f.name}" (id: ${f.id})
${v}`}).join(`
`),l=`
        You are an AI assistant for the 'CogniFlow' flashcard app. Your goal is to help users manage their decks and folders by interpreting their natural language requests.

        You MUST respond with a JSON object that is an array of actions, conforming to the provided schema.

        **Your Capabilities:**
        - Create, rename, move, and delete decks.
        - Create, rename, and delete folders.
        - Analyze and expand learning series by adding new levels or decks.
        - Generate new, unique questions for a specific quiz deck, with support for HTML formatting (e.g., \`<b>\`, \`<i>\`, \`<ruby>\`).

        **Instructions:**
        1.  Analyze the user's request.
        2.  Analyze the provided application state to find the relevant IDs for decks and folders mentioned by name.
        3.  If the user's request is ambiguous (e.g., "delete the history deck" when multiple exist), ask for clarification by using the 'NO_ACTION' type and formulating a question in the 'confirmationMessage'.
        4.  If the user is just chatting or asking a question you can't perform an action for, use the 'NO_ACTION' type and provide a helpful response in the 'confirmationMessage'.
        5.  For any action that modifies data, construct a clear and concise 'confirmationMessage' that will be presented as a button for the user to approve. Example: "Delete 'Ancient Rome' Deck?" or "Create 'Languages' Folder?".
        6.  For MOVE_DECK_TO_FOLDER, if the user wants to move a deck out of a folder, the 'folderId' in the payload should be \`null\`.
        7.  For EXPAND_SERIES_ADD_DECKS, you must identify the correct series by name to get its ID, and determine the correct 0-based 'levelIndex' from the user's request (e.g., "add a deck to the first level" means levelIndex: 0).
        8.  For GENERATE_QUESTIONS_FOR_DECK, identify the target deck by name to get its ID. If the user specifies a number (e.g., "add 10 questions"), include it in the 'count' payload property. The generated content should leverage HTML formatting where appropriate for clarity (e.g., using <b> for emphasis or <ruby> for annotations in language decks).

        **Current Application State:**
        
        **Folders:**
        ${d||"No folders exist."}
        
        **Decks:**
        ${p||"No decks exist."}

        **Series:**
        ${c||"No series exist."}
    `;try{const v=(await o.models.generateContent({model:"gemini-2.5-flash",contents:n,config:{systemInstruction:l,responseMimeType:"application/json",responseSchema:_y}})).text.trim(),h=JSON.parse(v);if(!Array.isArray(h))throw new Error("AI response was not a valid array of actions.");return h}catch(f){throw console.error("Error getting AI response:",f),f instanceof Error&&f.message.includes("SAFETY")?new Error("The request was blocked due to safety settings. Please try a different request."):new Error("Sorry, I had trouble understanding that. Could you try rephrasing?")}},Dy=({isOpen:n,onClose:i,onExecuteAction:o,history:p})=>{const{dispatch:d,decks:c,folders:l,deckSeries:f}=at(),[v,h]=M.useState(""),C=M.useRef(null);M.useEffect(()=>{var x;(x=C.current)==null||x.scrollIntoView({behavior:"smooth"})},[p]),M.useEffect(()=>{n&&Hh(p)},[p,n]);const k=async x=>{var O;x.preventDefault();const S=v.trim();if(!S)return;h("");const g={id:crypto.randomUUID(),role:"user",text:S},b={id:crypto.randomUUID(),role:"model",text:"",isLoading:!0},j=[...p,g,b];d({type:"SET_AI_CHAT_HISTORY",payload:j});try{const R=await Iy(S,{decks:c,folders:l,series:f}),A={id:crypto.randomUUID(),role:"model",text:((O=R.find(T=>T.confirmationMessage))==null?void 0:O.confirmationMessage)||"Here are the actions I can perform for you.",actions:R};d({type:"SET_AI_CHAT_HISTORY",payload:[...p,g,A]})}catch(R){const A={id:crypto.randomUUID(),role:"model",text:R instanceof Error?R.message:"An unknown error occurred."};d({type:"SET_AI_CHAT_HISTORY",payload:[...p,g,A]})}},I=x=>{o(x),i()};return n?r.jsxs("div",{className:"fixed inset-0 bg-black/50 z-[60] flex flex-col items-center justify-end",onClick:i,children:[r.jsxs("div",{className:"bg-surface w-full max-w-2xl h-[70vh] max-h-[600px] rounded-t-2xl shadow-2xl flex flex-col transform transition-transform duration-300 animate-fade-in",style:{animationName:"slideUp",animationDuration:"0.3s"},onClick:x=>x.stopPropagation(),children:[r.jsxs("header",{className:"flex-shrink-0 flex items-center justify-between p-4 border-b border-border",children:[r.jsxs("div",{className:"flex items-center gap-2",children:[r.jsx(J,{name:"bot",className:"w-6 h-6 text-primary"}),r.jsx("h2",{className:"text-xl font-bold text-text",children:"AI Assistant"})]}),r.jsx(se,{variant:"ghost",onClick:i,className:"p-1 h-auto",children:r.jsx(J,{name:"x"})})]}),r.jsx("main",{className:"flex-grow p-4 overflow-y-auto",children:r.jsxs("div",{className:"space-y-4",children:[p.map(x=>r.jsxs("div",{className:`flex gap-3 ${x.role==="user"?"justify-end":"justify-start"}`,children:[x.role==="model"&&r.jsx(J,{name:"bot",className:"w-6 h-6 text-primary flex-shrink-0 mt-1"}),r.jsxs("div",{className:`max-w-md p-3 rounded-2xl ${x.role==="user"?"bg-primary text-on-primary rounded-br-lg":"bg-background rounded-bl-lg"}`,children:[x.isLoading?r.jsxs("div",{className:"flex items-center gap-2",children:[r.jsx(Bt,{size:"sm"}),r.jsx("span",{className:"text-text-muted",children:"Thinking..."})]}):r.jsx("p",{className:"whitespace-pre-wrap",children:x.text}),x.actions&&x.actions.length>0&&r.jsx("div",{className:"mt-3 pt-3 border-t border-border/50 flex flex-wrap gap-2",children:x.actions.map((S,g)=>S.action!=="NO_ACTION"&&r.jsx(se,{size:"sm",variant:"secondary",onClick:()=>I(S),children:S.confirmationMessage},g))})]})]},x.id)),r.jsx("div",{ref:C})]})}),r.jsx("footer",{className:"flex-shrink-0 p-4 border-t border-border",children:r.jsxs("form",{onSubmit:k,className:"flex items-center gap-2",children:[r.jsx("input",{type:"text",value:v,onChange:x=>h(x.target.value),placeholder:"e.g., 'Rename my history deck...'",className:"flex-grow p-2 bg-background border border-border rounded-full focus:ring-2 focus:ring-primary focus:outline-none px-4",autoFocus:!0}),r.jsx(se,{type:"submit",variant:"primary",className:"rounded-full w-10 h-10 p-0","aria-label":"Send message",children:r.jsx(J,{name:"arrow-down",className:"w-5 h-5 -rotate-90"})})]})})]}),r.jsx("style",{children:`
              @keyframes slideUp {
                from { transform: translateY(100%); }
                to { transform: translateY(0); }
              }
            `})]}):null},Ty=({isOpen:n,onClose:i,onRestore:o,files:p})=>{const[d,c]=M.useState(""),l=M.useRef(null);Pt(l,n);const f=()=>{d&&o(d)};return n?r.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-75 flex items-center justify-center z-[60] p-4",children:r.jsxs("div",{ref:l,className:"bg-white dark:bg-gray-800 rounded-lg shadow-xl w-full max-w-lg transform transition-all relative max-h-[90vh] flex flex-col",children:[r.jsxs("div",{className:"flex-shrink-0 flex justify-between items-center p-4 border-b border-gray-200 dark:border-gray-700",children:[r.jsx("h2",{className:"text-xl font-bold",children:"Restore from Google Drive"}),r.jsx(se,{type:"button",variant:"ghost",onClick:i,className:"p-1 h-auto",children:r.jsx(J,{name:"x"})})]}),r.jsxs("div",{className:"p-6 overflow-y-auto",children:[r.jsx("p",{className:"text-gray-600 dark:text-gray-400 mb-4",children:"Select a backup file to restore. Restoring will overwrite decks with the same ID."}),p.length>0?r.jsx("div",{className:"space-y-2 border border-gray-200 dark:border-gray-700 rounded-md",children:p.map(v=>r.jsxs("label",{className:"flex items-center p-3 hover:bg-gray-100 dark:hover:bg-gray-700/50 cursor-pointer border-b border-gray-200 dark:border-gray-700 last:border-b-0",children:[r.jsx("input",{type:"radio",name:"backup-file",value:v.id,checked:d===v.id,onChange:()=>c(v.id),className:"h-4 w-4 text-blue-600 focus:ring-blue-500 border-gray-300 dark:border-gray-600 dark:bg-gray-900"}),r.jsxs("div",{className:"ml-3 text-sm",children:[r.jsx("p",{className:"font-medium text-gray-900 dark:text-gray-100",children:v.name}),r.jsxs("p",{className:"text-gray-500 dark:text-gray-400",children:["Last modified: ",new Date(v.modifiedTime).toLocaleString()]})]})]},v.id))}):r.jsx("div",{className:"text-center py-8 text-gray-500 dark:text-gray-400",children:r.jsx("p",{children:"No backup files found in your Google Drive application folder."})})]}),r.jsxs("div",{className:"flex-shrink-0 flex justify-end p-4 bg-gray-100/50 dark:bg-gray-900/50 border-t border-gray-200 dark:border-gray-700",children:[r.jsx(se,{type:"button",variant:"secondary",onClick:i,className:"mr-2",children:"Cancel"}),r.jsx(se,{type:"button",variant:"danger",onClick:f,disabled:!d,children:"Restore Selected"})]})]})}):null};function Lc(n,i,o){const p=new Map(n.map(v=>[v.id,v])),d=new Map(i.map(v=>[v.id,v])),c=new Set([...p.keys(),...d.keys()]),l=[],f=[];for(const v of c){const h=p.get(v),C=d.get(v);if(h&&!C)l.push({type:h.deletedAt?"removed":"added",itemType:o,item:h,source:"local"});else if(C&&!h)l.push({type:C.deletedAt?"removed":"added",itemType:o,item:C,source:"remote"});else if(h&&C){if(h.deletedAt||C.deletedAt)continue;const k=I=>{const{lastOpened:x,...S}=I;return JSON.stringify(S)};k(h)!==k(C)&&f.push({itemType:o,id:v,local:h,remote:C})}}return{changes:l,conflicts:f}}function pm(n,i){const o=Lc(n.decks,i.decks,"deck"),p=Lc(n.folders,i.folders,"folder"),d=Lc(n.deckSeries,i.deckSeries,"series"),c=[...o.changes,...p.changes,...d.changes],l=[...o.conflicts,...p.conflicts,...d.conflicts];return{unconflictedChanges:c,conflicts:l,hasConflicts:l.length>0}}function Ay(n,i,o){var x,S;const p=new Map;[...n.folders,...n.decks,...n.deckSeries].forEach(g=>g&&p.set(g.id,g)),[...i.folders,...i.decks,...i.deckSeries].forEach(g=>g&&p.set(g.id,g));const{conflicts:d}=pm(n,i);d.forEach(g=>{const b=o.get(g.id);b==="keep_local"?p.set(g.id,g.local):b==="keep_remote"&&p.set(g.id,g.remote)});const c=[...n.reviews||[],...i.reviews||[]],l=Array.from(new Map(c.map(g=>[`${g.itemId}-${g.timestamp}`,g])).values()),f={...n.seriesProgress||{},...i.seriesProgress||{}};new Set([...Object.keys(n.seriesProgress||{}),...Object.keys(i.seriesProgress||{})]).forEach(g=>{var O,R;const b=new Set(((O=n.seriesProgress)==null?void 0:O[g])||[]),j=new Set(((R=i.seriesProgress)==null?void 0:R[g])||[]);f[g]=Array.from(new Set([...b,...j]))});const h=(((x=i.aiChatHistory)==null?void 0:x.length)||0)>(((S=n.aiChatHistory)==null?void 0:S.length)||0)?i.aiChatHistory:n.aiChatHistory,C=[],k=[],I=[];return p.forEach(g=>{g&&("cards"in g||"questions"in g?C.push(g):"levels"in g?I.push(g):"name"in g&&k.push(g))}),{...n,decks:C,folders:k,deckSeries:I,reviews:l,seriesProgress:f,aiChatHistory:h}}const gm={deck:"laptop",series:"layers",folder:"folder"},Eh=({change:n})=>{const{type:i,item:o,itemType:p,source:d}=n,c=d==="local"?"border-blue-500":"border-green-500",l=i==="added"?"text-green-600":"text-red-600",f=i==="added"?"plus":"trash-2";return r.jsx("div",{className:`p-3 rounded-lg bg-background border-l-4 ${c}`,children:r.jsxs("div",{className:"flex justify-between items-center",children:[r.jsxs("div",{className:"flex items-center min-w-0",children:[r.jsx(J,{name:gm[p],className:"w-5 h-5 mr-3 text-text-muted flex-shrink-0"}),r.jsx("span",{className:"font-semibold text-text truncate",title:o.name,children:o.name})]}),r.jsxs("div",{className:`flex items-center text-sm font-medium ${l}`,children:[r.jsx(J,{name:f,className:"w-4 h-4 mr-1"}),r.jsx("span",{children:i})]})]})})},Oy=({conflict:n,resolution:i,onResolve:o})=>r.jsxs("div",{className:`p-3 rounded-lg border-2 ${i?"border-primary":"border-yellow-500"} bg-background`,children:[r.jsxs("div",{className:"flex items-center min-w-0 mb-3",children:[r.jsx(J,{name:gm[n.itemType],className:"w-5 h-5 mr-3 text-text-muted flex-shrink-0"}),r.jsx("span",{className:"font-semibold text-text truncate",title:n.local.name,children:n.local.name})]}),r.jsxs("p",{className:"text-sm text-text-muted mb-3",children:["This ",n.itemType," was modified on both your device and the server. Please choose which version to keep."]}),r.jsxs("div",{className:"flex justify-center gap-2",children:[r.jsx(se,{variant:i==="keep_local"?"primary":"secondary",size:"sm",onClick:()=>o("keep_local"),children:"Keep My Version"}),r.jsx(se,{variant:i==="keep_remote"?"primary":"secondary",size:"sm",onClick:()=>o("keep_remote"),children:"Take Server Version"})]})]}),Ry=({isOpen:n,onClose:i,localData:o,remoteData:p,onResolve:d})=>{const c=M.useRef(null),[l,f]=M.useState(null),[v,h]=M.useState(new Map);Pt(c,n),M.useEffect(()=>{if(n&&o&&p){const x=pm(o,p);f(x),h(new Map)}},[n,o,p]);const C=(x,S)=>{h(g=>new Map(g).set(x,S))},k=M.useMemo(()=>l?l.conflicts.every(x=>v.has(x.id)):!1,[l,v]),I=()=>{if(!k||!o||!p)return;const x=Ay(o,p,v);d(x),i()};return n?r.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-75 flex items-center justify-center z-[60] p-4",children:r.jsxs("div",{ref:c,className:"bg-surface rounded-lg shadow-xl w-full max-w-3xl transform transition-all relative max-h-[90vh] flex flex-col",children:[r.jsxs("div",{className:"flex-shrink-0 flex justify-between items-center p-4 border-b border-border",children:[r.jsx("h2",{className:"text-xl font-bold text-text",children:"Resolve Sync Conflicts"}),r.jsx(se,{type:"button",variant:"ghost",onClick:i,className:"p-1 h-auto",children:r.jsx(J,{name:"x"})})]}),r.jsx("div",{className:"p-6 overflow-y-auto space-y-6",children:l?r.jsxs(r.Fragment,{children:[l.hasConflicts&&r.jsxs("div",{children:[r.jsxs("h3",{className:"text-lg font-semibold text-yellow-600 dark:text-yellow-400 mb-2",children:["Resolve Conflicts (",l.conflicts.length,")"]}),r.jsx("p",{className:"text-sm text-text-muted mb-4",children:"The following items were modified on both devices. You must choose which version to keep for each."}),r.jsx("div",{className:"space-y-4",children:l.conflicts.map(x=>r.jsx(Oy,{conflict:x,resolution:v.get(x.id),onResolve:S=>C(x.id,S)},x.id))})]}),l.unconflictedChanges.length>0&&r.jsxs("div",{children:[r.jsxs("h3",{className:"text-lg font-semibold text-text mb-2",children:["Unconflicted Changes (",l.unconflictedChanges.length,")"]}),r.jsx("p",{className:"text-sm text-text-muted mb-4",children:"These changes were made on only one device and will be merged automatically."}),r.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[r.jsxs("div",{className:"space-y-3",children:[r.jsx("h4",{className:"text-center font-medium text-blue-600",children:"Your Device's Changes"}),l.unconflictedChanges.filter(x=>x.source==="local").map((x,S)=>r.jsx(Eh,{change:x},S))]}),r.jsxs("div",{className:"space-y-3",children:[r.jsx("h4",{className:"text-center font-medium text-green-600",children:"Server's Changes"}),l.unconflictedChanges.filter(x=>x.source==="remote").map((x,S)=>r.jsx(Eh,{change:x},S))]})]})]}),l.unconflictedChanges.length===0&&!l.hasConflicts&&r.jsx("p",{className:"text-text-muted text-center py-8",children:"It seems the only changes were to review progress, which will be merged automatically."})]}):r.jsx("div",{className:"text-center p-8",children:r.jsx(Bt,{})})}),r.jsxs("div",{className:"flex-shrink-0 flex justify-end p-4 bg-background/50 border-t border-border",children:[r.jsx(se,{type:"button",variant:"secondary",onClick:i,className:"mr-2",children:"Cancel Sync"}),r.jsx(se,{type:"button",variant:"primary",onClick:I,disabled:!k,children:"Resolve & Sync"})]})]})}):null},My=({driveFiles:n})=>{const{modalType:i,modalPayload:o,closeModal:p}=Oi(),d=fm(),{decks:c,aiChatHistory:l}=at();if(!i)return null;const f=o||{};return r.jsxs(r.Fragment,{children:[i==="import"&&r.jsx(gy,{isOpen:!0,onClose:p,onAddDecks:d.handleAddDecks,onAddSeriesWithDecks:d.handleAddSeriesWithDecks}),i==="restore"&&r.jsx(xy,{isOpen:!0,onClose:p,onRestore:d.handleRestoreData}),i==="resetProgress"&&r.jsx(yy,{isOpen:!0,onClose:p,onReset:d.handleResetDeckProgress,decks:c}),i==="confirm"&&r.jsx(Ri,{isOpen:!0,onClose:p,...f}),i==="folder"&&r.jsx(vy,{isOpen:!0,onClose:p,onSave:d.handleSaveFolder,folder:f.folder}),i==="series"&&r.jsx(wy,{isOpen:!0,onClose:p,onSave:d.handleSaveSeries,series:f.series}),i==="aiGeneration"&&r.jsx(Sy,{isOpen:!0,onClose:p,onGenerate:d.handleGenerateWithAI}),i==="aiStatus"&&r.jsx(jy,{isOpen:!0,onClose:p,onCancel:d.handleCancelAIGeneration}),i==="serverBackup"&&r.jsx(Ey,{isOpen:!0,onClose:p,onRestore:d.handleRestoreFromServerBackup,onDelete:d.handleDeleteServerBackup}),i==="droppedFile"&&r.jsx(Ny,{isOpen:!0,onClose:p,...f}),i==="aiChat"&&r.jsx(Dy,{isOpen:!0,onClose:p,onExecuteAction:d.handleExecuteAIAction,history:l}),i==="restoreFromDrive"&&r.jsx(Ty,{isOpen:!0,onClose:p,onRestore:d.handleRestoreFromDrive,files:n}),i==="mergeConflict"&&r.jsx(Ry,{isOpen:!0,onClose:p,onResolve:d.handleMergeResolution,localData:f.localData,remoteData:f.remoteData})]})},Ly=()=>{const{dispatch:n,...i}=at(),[o,p]=M.useState(null),[d,c]=M.useState(!1),[l,f]=M.useState(new Set),[v,h]=M.useState(null),[C,k]=M.useState("lastOpened"),[I,x]=M.useState(null),[S,g]=M.useState(new Set),[b,j]=M.useState(!1),O=M.useRef(0),[R,A]=ug(),{addToast:T}=Kt(),{path:P,navigate:H}=Cn(),{openModal:K}=Oi(),{aiFeaturesEnabled:W,backupEnabled:B,backupApiKey:Y,syncOnCellular:q}=rn(),{isMetered:Q}=Kh(),[N,Z]=M.useState(!1),[oe,fe]=M.useState("Never synced."),{pullToRefreshState:ye,handleTouchStart:ue,handleTouchMove:z,handleTouchEnd:_,REFRESH_THRESHOLD:F}=mx(),de=M.useRef(!1),he=M.useRef(!1),[ie,be]=M.useState(!1),[Ne,Se]=M.useState(!1),[ke,Ae]=M.useState(null),[Pe,Ye]=M.useState([]),Re=M.useCallback(Ue=>{g(Ke=>{const ot=new Set(Ke);return ot.has(Ue)?ot.delete(Ue):ot.add(Ue),ot})},[]),E=M.useCallback(()=>c(!0),[]),ge=M.useCallback(()=>c(!1),[]),re=M.useCallback(async(Ue={})=>{const{isManual:Ke=!1,dataToSync:ot,force:it=!1}=Ue;if(console.log(`[Sync] Triggered sync. Manual: ${!!Ke}, Force: ${!!it}.`),!Ke&&Q&&!q){fe("Sync paused on mobile data.");return}if(!B||!Y){Ke&&T("Server sync is not enabled or API key is missing.","error");return}const Ot=localStorage.getItem("cogniflow-lastSyncTimestamp"),{lastModified:Ht}=at.getState();if(!it&&!ot&&(Ht===null||Ot&&Ht<new Date(Ot).getTime())){Ke&&T("No local changes to sync.","info"),fe(Ot?`Up to date. Last synced: ${new Date(Ot).toLocaleTimeString()}`:"Up to date.");return}if(he.current){console.log("[Sync] Sync already in progress, skipping."),Ke&&T("A sync operation is already in progress.","info");return}he.current=!0,Z(!0),fe(it?"Force uploading...":"Syncing..."),console.log("[Sync] Starting sync operation..."),Ke&&T(it?"Force upload started...":"Sync started...","info");try{const{timestamp:ft,etag:pt}=await Ni(ot,it);W&&await sg();const Ve=Mp(ft);if(isNaN(Ve.getTime()))throw new Error("Received an invalid date from the server during sync.");console.log("[Sync] Sync successful. Server timestamp:",ft),localStorage.setItem("cogniflow-lastSyncTimestamp",Ve.toISOString()),localStorage.setItem("cogniflow-lastSyncEtag",pt),fe(`Last synced: ${Ve.toLocaleTimeString()}`),Ke&&T("Data successfully synced to server.","success")}catch(ft){const pt=ft instanceof Error?ft.message:"Unknown error";console.error("[Sync] Sync failed:",ft),fe(`Error: ${pt}`),T(`Server sync failed: ${pt}`,"error")}finally{he.current=!1,Z(!1),console.log("[Sync] Sync operation finished.")}},[B,Y,T,W,Q,q]),$=hx({sessionsToResume:l,setSessionsToResume:f,setGeneralStudyDeck:h,triggerSync:re,setDriveFiles:Ye,isSyncing:N,setIsSyncing:Z,setLastSyncStatus:fe}),{handleAddDecks:G,handleAddSeriesWithDecks:ee,handleRestoreData:ce,fetchAndRestoreFromServer:le}=$,ne=M.useCallback((Ue,Ke)=>{try{switch(Ue.type){case"backup":ce(Ue.data);break;case"quiz_series":{const{seriesName:ot,seriesDescription:it,levels:Ot}=Ue.data,Ht=[],ft=Ot.map(Ve=>{const jr=Ve.decks.map(cr=>({id:crypto.randomUUID(),name:cr.name,description:cr.description,type:De.Quiz,questions:ba(cr.questions)}));return Ht.push(...jr),{title:Ve.title,deckIds:jr.map(cr=>cr.id)}}),pt={id:crypto.randomUUID(),type:"series",name:ot,description:it,levels:ft,archived:!1,createdAt:new Date().toISOString()};ee(pt,Ht);break}case"quiz":{const ot={id:crypto.randomUUID(),name:Ke||Ue.data.name,description:Ue.data.description,type:De.Quiz,questions:ba(Ue.data.questions)};G([ot]),T(`Deck "${ot.name}" imported successfully.`,"success");break}case"flashcard":{if(!Ke){T("A deck name is required for flashcard imports.","error");return}const ot={id:crypto.randomUUID(),name:Ke,type:De.Flashcard,cards:Kc(Ue.data),description:`${Ue.data.length} imported flashcard${Ue.data.length===1?"":"s"}.`};G([ot]),T(`Deck "${ot.name}" imported successfully.`,"success");break}}}catch(ot){T(ot instanceof Error?ot.message:"Failed to process the dropped file.","error")}},[ce,ee,G,T]),je=M.useCallback(async()=>{try{const[Ue,Ke,ot,it,Ot,Ht]=await Promise.all([Ch(),Dh(),Rh(),Ph(),Yc(),qh()]);n({type:"LOAD_DATA",payload:{decks:Ue,folders:Ke,deckSeries:ot}});const ft=new Map;for(const[pt,Ve]of Object.entries(Ht))Array.isArray(Ve)&&ft.set(pt,new Set(Ve));if(n({type:"SET_SERIES_PROGRESS",payload:ft}),f(new Set(it.map(pt=>pt.replace("session_deck_","")))),Ot.length>0&&n({type:"SET_AI_CHAT_HISTORY",payload:Ot}),!de.current&&B&&Ue.length===0&&Ke.length===0&&ot.length===0){de.current=!0,console.log("Local data is empty, checking for server backup...");try{const{metadata:pt}=await Ii();pt&&pt.size>0&&(console.log("Server backup found. Prompting user to restore."),K("confirm",{title:"Restore from Server?",message:`Your local data is empty, but a backup was found on the server from ${new Date(pt.modified).toLocaleString()}. Would you like to restore it?`,onConfirm:le,confirmText:"Restore"}))}catch(pt){pt.status!==404&&console.warn("Failed to check for server backup on initial load:",pt)}}}catch(Ue){console.error("Initialization Error:",Ue),p(Ue),n({type:"SET_LOADING",payload:!1})}},[n,T,B,K,le]);M.useEffect(()=>{console.log("App mounted. To run backup service tests, type `runBackupServiceTests()` in the console."),je()},[je]),M.useEffect(()=>Op(()=>{T("Data updated in another tab. Refreshing...","info"),je()}),[T,je]),M.useEffect(()=>{try{const Ue=localStorage.getItem("cogniflow-openFolderIds");if(Ue){const Ke=JSON.parse(Ue);Array.isArray(Ke)&&Ke.every(ot=>typeof ot=="string")&&g(new Set(Ke))}}catch(Ue){console.error("Failed to load open folder IDs",Ue)}},[]),M.useEffect(()=>{try{localStorage.setItem("cogniflow-openFolderIds",JSON.stringify(Array.from(S)))}catch(Ue){console.error("Failed to save open folder IDs",Ue)}},[S]);const{activeDeck:Me,activeSeries:Te}=M.useMemo(()=>{const[Ue]=P.split("?");if(Ue.startsWith("/decks/")){const Ke=Ue.split("/")[2];return{activeDeck:i.decks.find(ot=>ot.id===Ke)||null,activeSeries:null}}if(Ue.startsWith("/series/")){const Ke=Ue.split("/")[2];return{activeDeck:null,activeSeries:i.deckSeries.find(ot=>ot.id===Ke)||null}}return{activeDeck:null,activeSeries:null}},[P,i.decks,i.deckSeries]),ze=Ue=>{Ue.preventDefault(),Ue.stopPropagation(),O.current++,Ue.dataTransfer.items&&Ue.dataTransfer.items.length>0&&j(!0)},ut=Ue=>{Ue.preventDefault(),Ue.stopPropagation(),O.current--,O.current===0&&j(!1)},rt=Ue=>{Ue.preventDefault(),Ue.stopPropagation()},bt=Ue=>{Ue.preventDefault(),Ue.stopPropagation(),j(!1),O.current=0;const Ke=Ue.dataTransfer.files[0];if(!Ke)return;const ot=new FileReader;ot.onload=async it=>{var Ht;const Ot=(Ht=it.target)==null?void 0:Ht.result;if(Ke.name.toLowerCase().endsWith(".apkg"))try{const ft=await Ke.arrayBuffer();let pt=[];try{pt=await em(ft.slice(0))}catch(Ve){console.warn("Anki worker failed, trying main thread fallback:",Ve),T("Import via worker failed. Trying a slower fallback method...","info");try{pt=await tm(ft)}catch(jr){throw jr}}pt.length>0?(G(pt),T(`Successfully imported ${pt.length} deck(s).`,"success")):T("No valid decks found in the Anki package.","info")}catch(ft){T(`Error processing Anki package: ${ft instanceof Error?ft.message:"Unknown error"}`,"error")}else{const ft=tg(Ot);ft?K("droppedFile",{analysis:{...ft,fileName:Ke.name},onConfirm:ne}):T("Unsupported or invalid file format.","error")}},ot.readAsText(Ke)};if(o){const Ue=o.message.includes("Could not open or delete the database");return r.jsx("div",{className:"min-h-screen flex items-center justify-center p-4 bg-background",children:r.jsxs("div",{className:"text-center bg-surface p-6 sm:p-8 rounded-lg shadow-xl max-w-lg w-full border border-border",children:[r.jsx(J,{name:"x-circle",className:"w-16 h-16 text-red-500 mx-auto mb-4"}),r.jsx("h1",{className:"text-2xl sm:text-3xl font-bold text-red-600 dark:text-red-500 mb-4",children:"Application Error"}),r.jsx("p",{className:"text-text-muted mb-6",children:Ue?"A critical database error occurred, and the app cannot start. This can happen if browser data becomes corrupted.":"An unexpected error occurred during startup. Please try reloading."}),Ue&&r.jsxs("div",{className:"text-left bg-background p-4 rounded-md mb-6 border border-border",children:[r.jsx("p",{className:"font-semibold text-text mb-2",children:"To fix this, please clear the website data for this app in your browser's settings, then reload the page."}),r.jsxs("p",{className:"text-sm text-text-muted mt-2",children:[r.jsx("strong",{children:"Warning:"})," This will permanently erase all your local decks and progress unless you have a backup."]})]}),r.jsx(se,{variant:"danger",onClick:()=>window.location.reload(),children:"Reload Page"})]})})}return r.jsx(uy,{value:$,children:r.jsxs("div",{className:"min-h-screen text-text flex flex-col overflow-x-hidden",onDragEnter:ze,onDragLeave:ut,onDragOver:rt,onDrop:bt,onTouchStart:ue,onTouchMove:z,onTouchEnd:_,children:[r.jsx(bg,{pullDistance:ye.pullDistance,isRefreshing:ye.isRefreshing,threshold:F}),r.jsx(xg,{isOpen:d,onClose:ge,onImport:$.openImportModal,onCreateSeries:()=>$.openSeriesEditor("new"),onGenerateAI:$.openAIGenerationModal,onInstall:R?A:null}),r.jsxs("div",{className:"flex-1 flex flex-col",children:[r.jsx(px,{onOpenMenu:E,onOpenCommandPalette:()=>K("commandPalette"),activeDeck:Me}),r.jsx("main",{className:"flex-1 container mx-auto p-4 sm:p-6 lg:p-8",children:i.isLoading?r.jsx("div",{className:"text-center p-8",children:r.jsx(Bt,{})}):r.jsx(fy,{sessionsToResume:l,sortPreference:C,setSortPreference:k,draggedDeckId:I,setDraggedDeckId:x,openFolderIds:S,onToggleFolder:Re,generalStudyDeck:v,activeDeck:Me,activeSeries:Te,onSync:$.handleSync,isSyncing:N,lastSyncStatus:oe,isGapiReady:ie,isGapiSignedIn:Ne,gapiUser:ke})})]}),r.jsx(dg,{}),r.jsx(My,{driveFiles:Pe}),r.jsx(hy,{isOpen:!1,onClose:()=>{},actions:[{id:"import",label:"Create / Import Deck",icon:"plus",action:$.openImportModal,keywords:["new","add"]},{id:"settings",label:"Settings",icon:"settings",action:()=>H("/settings")},{id:"trash",label:"View Trash",icon:"trash-2",action:()=>H("/trash")},{id:"archive",label:"View Archive",icon:"archive",action:()=>H("/archive")},{id:"progress",label:"View Progress",icon:"trending-up",action:()=>H("/progress")}]}),b&&r.jsx("div",{className:"fixed inset-0 bg-black/50 z-[55] flex items-center justify-center p-4",children:r.jsxs("div",{className:"bg-surface rounded-lg p-8 text-center border-4 border-dashed border-primary",children:[r.jsx(J,{name:"upload-cloud",className:"w-16 h-16 text-primary mx-auto mb-4"}),r.jsx("p",{className:"text-xl font-semibold",children:"Drop file to import"})]})}),W&&r.jsxs(r.Fragment,{children:[r.jsx(my,{}),r.jsx(py,{onOpen:$.openAIStatusModal,onCancel:$.handleCancelAIGeneration})]})]})})};class Fy extends M.Component{constructor(){super(...arguments),this.state={hasError:!1},this.handleReload=()=>{window.location.reload()}}static getDerivedStateFromError(i){return{hasError:!0,error:i}}componentDidCatch(i,o){console.error("Uncaught error:",i,o)}render(){var i;if(this.state.hasError){const o=(i=this.state.error)==null?void 0:i.message.includes("Could not open or delete the database");return r.jsx("div",{className:"min-h-screen flex items-center justify-center p-4 bg-background",children:r.jsxs("div",{className:"text-center bg-surface p-6 sm:p-8 rounded-lg shadow-xl max-w-lg w-full border border-border",children:[r.jsx(J,{name:"x-circle",className:"w-16 h-16 text-red-500 mx-auto mb-4"}),r.jsx("h1",{className:"text-2xl sm:text-3xl font-bold text-red-600 dark:text-red-500 mb-4",children:o?"Database Access Error":"Oops! Something went wrong."}),r.jsx("p",{className:"text-text-muted mb-6",children:o?"The application's local database has encountered a serious error and cannot be opened. This can sometimes happen after a browser update or if storage becomes corrupted.":"The application encountered an unexpected error. Please try reloading the page to continue."}),o&&r.jsxs("div",{className:"text-left bg-background p-4 rounded-md mb-6 border border-border",children:[r.jsx("p",{className:"font-semibold text-text mb-2",children:"To fix this, you may need to manually clear the website data for this app in your browser settings."}),r.jsxs("p",{className:"text-sm text-text-muted mt-2",children:[r.jsx("strong",{children:"Warning:"})," This will permanently erase all your local decks, series, and progress."]}),r.jsxs("details",{className:"mt-3 text-sm",children:[r.jsx("summary",{className:"cursor-pointer text-primary hover:underline font-medium",children:"Show instructions for clearing site data"}),r.jsxs("ul",{className:"list-disc list-inside text-text-muted mt-2 space-y-2 pt-2 border-t border-border",children:[r.jsxs("li",{children:[r.jsx("b",{children:"Chrome:"})," Settings  Privacy and security  Site Settings  View permissions and data stored across sites  Search for this site's URL  Clear data."]}),r.jsxs("li",{children:[r.jsx("b",{children:"Firefox:"})," Settings  Privacy & Security  Cookies and Site Data  Manage Data...  Search for this site's URL  Remove Selected."]}),r.jsxs("li",{children:[r.jsx("b",{children:"Safari:"})," Safari  Settings...  Privacy  Manage Website Data...  Search for this site's URL  Remove."]})]})]}),r.jsx("p",{className:"text-sm text-text-muted mt-4",children:"After clearing the data, reloading this page should fix the issue. If you have a backup file, you can restore your data afterwards."})]}),!o&&this.state.error&&r.jsx("pre",{className:"bg-background text-left text-xs text-red-500 dark:text-red-400 p-4 rounded-md overflow-x-auto mb-6",children:r.jsx("code",{children:this.state.error.stack||this.state.error.toString()})}),r.jsx(se,{variant:"danger",onClick:this.handleReload,children:"Reload Page"})]})})}return this.props.children}}window.addEventListener("error",n=>{console.error("Unhandled global error:",n.error,{message:n.message,filename:n.filename,lineno:n.lineno,colno:n.colno})});window.addEventListener("unhandledrejection",n=>{console.error("Unhandled promise rejection:",n.reason)});console.log(window.location);const xm=document.getElementById("root");if(!xm)throw new Error("Could not find root element to mount to");const Py=Tp.createRoot(xm);Py.render(r.jsx(so.StrictMode,{children:r.jsx(Sx,{children:r.jsx(wg,{children:r.jsx(gg,{children:r.jsx(mg,{children:r.jsx(Vg,{children:r.jsx(Fy,{children:r.jsx(Ly,{})})})})})})})}));
