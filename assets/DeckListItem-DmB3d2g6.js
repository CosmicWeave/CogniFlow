import{Q as U,F as V,d as I,r as l,u as W,e as n,H as X,g as Y,j as t,L as R,I as i,s as Z,B as j,S as k}from"./index-Db7ZDnWd.js";import{M as ee}from"./MasteryBar-DwmeWyCF.js";const ae=U.memo(({deck:e,sessionsToResume:E,onUpdateLastOpened:T,draggedDeckId:Q,onDragStart:$,onDragEnd:q,onUpdateDeck:A,onDeleteDeck:B,openConfirmModal:te,handleGenerateQuestionsForDeck:b,handleGenerateContentForLearningDeck:N,onRemoveFromSeries:w})=>{const{navigate:P}=V(),L=I(l.useCallback(s=>{const{currentTask:a,queue:r}=s.aiGenerationStatus;return(a==null?void 0:a.deckId)===e.id?a:(r||[]).find(c=>c.deckId===e.id)},[e.id])),p=I(s=>s.learningProgress[e.id]),{aiFeaturesEnabled:H}=W(),{dueCount:M,items:m,unlockedCount:O,totalQuestions:_}=l.useMemo(()=>{var D,S;let s=(e.type===n.Quiz||e.type===n.Learning?e.questions:e.cards)||[],a=0,r=0,c=s.length;if(e.type===n.Learning){const z=new Set((p==null?void 0:p.unlockedQuestionIds)||[]);r=((D=e.questions)==null?void 0:D.filter(x=>z.has(x.id)).length)||0,a=((S=e.questions)==null?void 0:S.filter(x=>!x.suspended&&z.has(x.id)&&new Date(x.dueDate)<=new Date).length)||0}else a=X(e);return{dueCount:a,items:s,unlockedCount:r,totalQuestions:c}},[e,p]),o=(m==null?void 0:m.length)||0;let g,f;e.icon?f=e.icon:e.type===n.Quiz||e.type===n.Learning?f=e.type===n.Learning?"book-open":"help-circle":f="laptop",e.type===n.Quiz||e.type===n.Learning?g=o===1?"question":"questions":g=o===1?"card":"cards";const[v,d]=l.useState(!1),y=l.useRef(null),h=!!L,u=(e.type===n.Quiz||e.type===n.Learning)&&o===0;l.useEffect(()=>{const s=a=>{y.current&&!y.current.contains(a.target)&&d(!1)};return v?document.addEventListener("mousedown",s):document.removeEventListener("mousedown",s),()=>document.removeEventListener("mousedown",s)},[v]);const G=l.useMemo(()=>{if(m.length===0)return 0;const s=m.filter(r=>!r.suspended);return s.length===0?0:s.reduce((r,c)=>r+Y(c),0)/s.length},[m]),C=E.has(e.id),F=l.useMemo(()=>e.locked?"Locked":u&&!h?"Generate":C?"Resume":e.type===n.Learning&&e.learningMode==="mixed"?"Start Course":`Study (${M})`,[e.locked,u,h,C,M,e.type,e.learningMode]),J=s=>{if(s.preventDefault(),s.stopPropagation(),!e.locked){if(u&&!h){e.type===n.Quiz&&b?b(e):e.type===n.Learning&&N&&N(e);return}o>0&&P(`/decks/${e.id}/study`)}},K=e.type===n.Learning&&e.learningMode!=="mixed";return t.jsx(R,{href:`/decks/${e.id}`,draggable:"true",onDragStart:s=>{s.dataTransfer.setData("text/plain",e.id),s.dataTransfer.effectAllowed="move",$(e.id)},onDragEnd:q,onClick:()=>T(e.id),className:`block bg-surface rounded-lg shadow-md hover:shadow-lg transition-all duration-200 border border-transparent hover:border-primary ${Q===e.id?"opacity-30":""}`,children:t.jsxs("div",{className:"p-4",children:[t.jsxs("div",{className:"flex items-start justify-between",children:[t.jsxs("div",{className:"flex-1 min-w-0 mr-4",children:[t.jsxs("div",{className:"flex items-center mb-1",children:[t.jsx(i,{name:f,className:`w-5 h-5 mr-2 flex-shrink-0 ${e.icon?"text-primary":"text-text-muted"}`}),t.jsx("h3",{className:"text-xl font-bold text-text break-words",children:e.name})]}),e.description&&t.jsx("div",{className:"prose prose-sm dark:prose-invert max-w-none text-text-muted mt-1 truncate",title:Z(e.description),dangerouslySetInnerHTML:{__html:e.description}}),e.type===n.Learning&&t.jsxs("p",{className:"text-xs text-text-muted mt-2 font-medium",children:[t.jsx(i,{name:"unlock",className:"w-3 h-3 inline mr-1"}),O," / ",_," questions unlocked"]})]}),t.jsxs("div",{ref:y,className:"relative flex-shrink-0 -mr-2",children:[t.jsx(j,{variant:"ghost",className:"p-2 h-auto",onClick:s=>{s.preventDefault(),s.stopPropagation(),d(a=>!a)},"aria-label":`More options for deck ${e.name}`,children:t.jsx(i,{name:"more-vertical",className:"w-5 h-5"})}),v&&t.jsxs("div",{className:"absolute right-0 mt-2 w-48 bg-surface rounded-md shadow-lg py-1 z-10 ring-1 ring-black ring-opacity-5 animate-fade-in",style:{animationDuration:"150ms"},children:[w&&t.jsxs("button",{onClick:s=>{s.preventDefault(),w(),d(!1)},className:"flex items-center w-full px-4 py-2 text-sm text-left text-text hover:bg-border/20",children:[t.jsx(i,{name:"x-circle",className:"w-4 h-4 mr-3"})," Remove from Series"]}),t.jsxs("button",{onClick:s=>{s.preventDefault(),A({...e,archived:!0},{toastMessage:`Deck "${e.name}" archived.`}),d(!1)},className:"flex items-center w-full px-4 py-2 text-sm text-left text-text hover:bg-border/20",children:[t.jsx(i,{name:"archive",className:"w-4 h-4 mr-3"})," Archive"]}),t.jsxs("button",{onClick:s=>{s.preventDefault(),B(e.id),d(!1)},className:"flex items-center w-full px-4 py-2 text-sm text-left text-red-600 dark:text-red-400 hover:bg-red-50 dark:hover:bg-red-900/20",children:[t.jsx(i,{name:"trash-2",className:"w-4 h-4 mr-3"})," Move to Trash"]})]})]})]}),o>0&&t.jsx("div",{className:"mt-3",children:t.jsx(ee,{level:G})}),t.jsxs("div",{className:"mt-4 pt-4 border-t border-border/50 flex justify-between items-center",children:[t.jsxs("div",{className:"text-sm text-text-muted",children:[o," ",g]}),h?t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsx(k,{size:"sm"}),t.jsx("span",{className:"text-sm font-semibold text-text-muted",children:L.statusText||"Generating..."})]}):t.jsxs("div",{className:"flex gap-2",children:[K&&t.jsxs(R,{href:`/decks/${e.id}/read`,passAs:j,variant:"secondary",size:"sm",onClick:s=>s.stopPropagation(),children:[t.jsx(i,{name:"book-open",className:"w-4 h-4 mr-2"})," Read"]}),t.jsxs(j,{variant:u&&H?"primary":"secondary",size:"sm",onClick:J,disabled:e.locked||o===0&&!u,children:[t.jsx(i,{name:e.locked?"lock":u?"zap":"laptop",className:"w-4 h-4 mr-2"}),F]})]})]})]})})});export{ae as D};
